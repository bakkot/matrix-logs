[
{"content":{"body":"Hi all, I just opened a PR to test Promise.prototype pollution combined with `import.defer` here https://github.com/tc39/test262/pull/4918. It still need to be discussed on plenary, but I'd like to get some early feedback from you regarding the way I'm testing `Promise.prototype.then` there, since I'm feeling it's a bit hacky right now. Since I'm polluting `.then`, If I do `import.defer(...).then(ns => { ... })`, this will cause the new defined `.then` function to be called and it will increase `thenCallCount`. Because of this, I took the direction to save built-in `Promise.prototype.then` to `originalThen` and use `originalThen.call` to chain promises. I can think in a couple of alternatives for it, like checking if `thenCount == 1` and keep using `.then`, or having a `Promise.prototype.originalThen`, to avoid `originalThen.call`. Do you have an opinion about it?","format":"org.matrix.custom.html","formatted_body":"Hi all, I just opened a PR to test Promise.prototype pollution combined with <code>import.defer</code> here https://github.com/tc39/test262/pull/4918. It still need to be discussed on plenary, but I'd like to get some early feedback from you regarding the way I'm testing <code>Promise.prototype.then</code> there, since I'm feeling it's a bit hacky right now. Since I'm polluting <code>.then</code>, If I do <code>import.defer(...).then(ns =&gt; { ... })</code>, this will cause the new defined <code>.then</code> function to be called and it will increase <code>thenCallCount</code>. Because of this, I took the direction to save built-in <code>Promise.prototype.then</code> to <code>originalThen</code> and use <code>originalThen.call</code> to chain promises. I can think in a couple of alternatives for it, like checking if <code>thenCount == 1</code> and keep using <code>.then</code>, or having a <code>Promise.prototype.originalThen</code>, to avoid <code>originalThen.call</code>. Do you have an opinion about it?","m.mentions":{},"msgtype":"m.text"},"ts":1770811997889,"senderName":"Caio Lima","senderId":"@caiolima:igalia.com","id":"$PQSIobiTWEuCPsbROFrFTwARAacgm1YfOBwdIyklCP4"},
{"content":{"body":"IMO each test file can basically pollute whatever it wants, the priority should be on making the test understandable (for reviewers, and for implementations debugging why it doesn't pass) and removing as much complexity as possible (less code, fewer hidden bugs)","m.mentions":{},"msgtype":"m.text"},"ts":1770843639914,"senderName":"ptomato","senderId":"@pchimento:igalia.com","id":"$woXuko5jiiMB9osVEzA7ZXHzmt_BSBbY3iOoybwdHNw"}
]
[
{"content":{"body":"as I missed the discussions about **ShadowRealm** yesterday, some async comments post reading the meeting notes.\n\n*For clarity and for the records, I no longer speak as a champion of the proposal, but as a regular delegate.*\n\nIt seems the only real blocker for Stage advancement is getting agreement from DOM vendors, which I agree. I don't think - and I hope I'm right - that stage 2.7 or stage 3 would change how DOM vendors would react or accept the proposal.\n\nThe challenge for DOM vendors to accept is having the design (resolved), tests (resolved), and **capacity for implementation**. \n\nI don't think DOM vendors would be able to prioritize or willing to implement it just for the sake of releasing a new feature. I believe this one is up to the champions finding sponsorship for the implementation. That's something I no longer control or can exercise much leverage.\n\nGiven all the facts and where we are at with ShadowRealm, offering funding for implementation of ShadowRealm is the best chance to get it accepted, and then yes, move it up to stages 3 and 4. This may still require vendors spending some cycles on review, but I think it's doable. \n\ncc ptomato dminor shu Michael Saboff ","format":"org.matrix.custom.html","formatted_body":"<p>as I missed the discussions about <strong>ShadowRealm</strong> yesterday, some async comments post reading the meeting notes.</p>\n<p><em>For clarity and for the records, I no longer speak as a champion of the proposal, but as a regular delegate.</em></p>\n<p>It seems the only real blocker for Stage advancement is getting agreement from DOM vendors, which I agree. I don't think - and I hope I'm right - that stage 2.7 or stage 3 would change how DOM vendors would react or accept the proposal.</p>\n<p>The challenge for DOM vendors to accept is having the design (resolved), tests (resolved), and <strong>capacity for implementation</strong>.</p>\n<p>I don't think DOM vendors would be able to prioritize or willing to implement it just for the sake of releasing a new feature. I believe this one is up to the champions finding sponsorship for the implementation. That's something I no longer control or can exercise much leverage.</p>\n<p>Given all the facts and where we are at with ShadowRealm, offering funding for implementation of ShadowRealm is the best chance to get it accepted, and then yes, move it up to stages 3 and 4. This may still require vendors spending some cycles on review, but I think it's doable.</p>\n<p>cc <a href=\"https://matrix.to/#/@pchimento:igalia.com\">ptomato</a> <a href=\"https://matrix.to/#/@dminor:mozilla.org\">dminor</a> <a href=\"https://matrix.to/#/@shuyuguo:matrix.org\">shu</a> <a href=\"https://matrix.to/#/@mlsaboff:matrix.org\">Michael Saboff</a></p>\n","m.mentions":{"user_ids":["@pchimento:igalia.com","@dminor:mozilla.org","@shuyuguo:matrix.org","@mlsaboff:matrix.org"]},"msgtype":"m.text"},"ts":1733272049368,"senderName":"leobalter","senderId":"@leobalter:matrix.org","id":"$XUpzzWZMjZrK0hzJEcD8GtKazhxIWvYSMqt0xULSt0Q"},
{"content":{"body":"it doesn’t, only immer’s maintainers","m.relates_to":{"event_id":"$TAdlU6FjI7A9CFX6NsRu1-NhOGsDD3O7Ig_cllTXZ9I","is_falling_back":true,"m.in_reply_to":{"event_id":"$4my-hzI_imscnHo-0llbiANWHmKBj6Iy2KKemqglAhU"},"rel_type":"m.thread"},"msgtype":"m.text"},"ts":1733277707529,"senderName":"ljharb","senderId":"@ljharb:matrix.org","id":"$MV61HWa1PDF7Qm8srqN_-V2rZd40NnKzbRBSk5OnqwQ"},
{"content":{"body":"I don't think the problem is capacity for implementation but rather that people remain unconvinced that ShadowRealm is a good idea for the web. In that case, even if the implementation of ShadowRealm was externally funded, there's no guarantee that patches would be reviewed and landed.","m.mentions":{},"msgtype":"m.text"},"ts":1733323001420,"senderName":"dminor","senderId":"@dminor:mozilla.org","id":"$GfMGMlWv5IWY8AMYd9rSv0UyVKPoKB3uAgKDlElizTs"},
{"content":{"body":"i unfortunately am likely gonna miss plenary today and tomorrow 😭\n\nbut something i wanted to just throw out there regarding error stacks\n\nrather than trying to standardize (or at least codify) what already exists, what if we created a new `Error.prototype.get standardizedStack` or something which we can build entirely from scratch (i.e. a uniform format across engines)?\n\nto be clear this wouldn't preclude engines from having their own `stack` that contains whatever details the engine wants to provide\n\ninstead it would give an opportunity for all of us to agree on at least some minimal meaning for \"what does a stack look like?\" and \"how do i get one?\"","format":"org.matrix.custom.html","formatted_body":"<p>i unfortunately am likely gonna miss plenary today and tomorrow 😭</p>\n<p>but something i wanted to just throw out there regarding error stacks</p>\n<p>rather than trying to standardize (or at least codify) what already exists, what if we created a new <code>Error.prototype.get standardizedStack</code> or something which we can build entirely from scratch (i.e. a uniform format across engines)?</p>\n<p>to be clear this wouldn't preclude engines from having their own <code>stack</code> that contains whatever details the engine wants to provide</p>\n<p>instead it would give an opportunity for all of us to agree on at least some minimal meaning for &quot;what does a stack look like?&quot; and &quot;how do i get one?&quot;</p>","msgtype":"m.text"},"ts":1733331524115,"senderName":"Devin Rousso","senderId":"@dcrousso:matrix.org","id":"$v5FLx-GM7u5eE-lQw8Ym0eGR_s_e9KLX9b3ElS27dHE"},
{"content":{"body":"is TLA considered harmful at this point","m.mentions":{},"msgtype":"m.text"},"ts":1733332076340,"senderName":"snek","senderId":"@devsnek:matrix.org","id":"$6Mnayk745-oENDljKFTYMC_0x8F9jzH8FV11ABs4dGQ"},
{"content":{"body":"🌏️🔫🧑‍🚀","m.mentions":{},"msgtype":"m.text"},"ts":1733332123524,"senderName":"ljharb","senderId":"@ljharb:matrix.org","id":"$NUpg-v790qli2kUbWC1ynyOZK_clvmnTen9-b5HZrdQ"},
{"content":{"body":"you mean standardized string, or standardized structured dataa?","format":"org.matrix.custom.html","formatted_body":"you mean standardized string, or standardized structured dataa?","m.mentions":{"user_ids":["@dcrousso:matrix.org"]},"m.relates_to":{"m.in_reply_to":{"event_id":"$v5FLx-GM7u5eE-lQw8Ym0eGR_s_e9KLX9b3ElS27dHE"}},"msgtype":"m.text"},"ts":1733332176929,"senderName":"snek","senderId":"@devsnek:matrix.org","id":"$ojfZburpDOIe5Soe-gEFnNm0L3Xq6X9VmCzL1kpgPwA"},
{"content":{"body":"if the former, why?","m.mentions":{},"msgtype":"m.text"},"ts":1733332182571,"senderName":"snek","senderId":"@devsnek:matrix.org","id":"$iKAQro2unR7RaLg5zK43nzZoKnhMODV3whErWctyoAQ"},
{"content":{"body":" * you mean standardized string, or standardized structured data?","format":"org.matrix.custom.html","formatted_body":" * you mean standardized string, or standardized structured data?","m.mentions":{},"m.new_content":{"body":"you mean standardized string, or standardized structured data?","format":"org.matrix.custom.html","formatted_body":"you mean standardized string, or standardized structured data?","m.mentions":{"user_ids":["@dcrousso:matrix.org"]},"msgtype":"m.text"},"m.relates_to":{"event_id":"$ojfZburpDOIe5Soe-gEFnNm0L3Xq6X9VmCzL1kpgPwA","rel_type":"m.replace"},"msgtype":"m.text"},"ts":1733332191318,"senderName":"snek","senderId":"@devsnek:matrix.org","id":"$HrUpGEXcMdsGYDvpWYoxzb5C1bgo-EWhK53Z5l_uId0"},
{"content":{"body":"PSA: we will be ending for the day at the break.  no afternoon session today","m.mentions":{},"msgtype":"m.text"},"ts":1733332837873,"senderName":"Chris de Almeida","senderId":"@softwarechris:matrix.org","id":"$FoHoptgN7HVbc9d6i7i5Wloij2qg4wam8JcmG843dCQ"},
{"content":{"body":"cf. https://matrix.to/#/!WgJwmjBNZEXhJnXHXw:matrix.org/$3kN3Fbul5yr4xdcqDvHKLhEzv9fQrgow7d_JyqG48_c / https://matrixlogs.bakkot.com/TC39_Delegates/2024-12-03#L118\n> I want standard error stacks just so I can deny (read) access to the call stack in a standardised way","format":"org.matrix.custom.html","formatted_body":"<p>cf. https://matrix.to/#/!WgJwmjBNZEXhJnXHXw:matrix.org/$3kN3Fbul5yr4xdcqDvHKLhEzv9fQrgow7d_JyqG48_c / https://matrixlogs.bakkot.com/TC39_Delegates/2024-12-03#L118</p>\n<blockquote>\n<p>I want standard error stacks just so I can deny (read) access to the call stack in a standardised way</p>\n</blockquote>\n","m.mentions":{"user_ids":["@dcrousso:matrix.org"]},"m.relates_to":{"m.in_reply_to":{"event_id":"$v5FLx-GM7u5eE-lQw8Ym0eGR_s_e9KLX9b3ElS27dHE"}},"msgtype":"m.text"},"ts":1733333340550,"senderName":"Richard Gibson","senderId":"@gibson042:matrix.org","id":"$c6ghEJu_4BfdfuL_yoIjl9Uboo73Iz19keeGP6xrxNw"},
{"content":{"body":"Sorry I missed some of this. Is import.sync + source modules insufficient for Node.js? Or is evaluation not going to permitted in import.sync if you already have the source?","m.mentions":{},"msgtype":"m.text"},"ts":1733333571527,"senderName":"keith_miller","senderId":"@keith_miller:matrix.org","id":"$OpThjf_55uokU2x_ooTZAcxcz31_pu7vRilQfPgmTO4"},
{"content":{"body":"What's insufficient is if `import.sync(\"./a/file.js\")` throws for a non-already-imported file","format":"org.matrix.custom.html","formatted_body":"What's insufficient is if <code>import.sync(\"./a/file.js\")</code> throws for a non-already-imported file","m.mentions":{},"msgtype":"m.text"},"ts":1733333601348,"senderName":"nicolo-ribaudo","senderId":"@nicolo-ribaudo:matrix.org","id":"$I4RdBp8U_JicCA3u9sR74KTnxuByQKnwMdC9GDCpEM8"},
{"content":{"body":"I understand maintenance is also a concern, but I believe we went through years of cycles on how realm access would be good for the web. \n\nShadowRealm is the form that was proposed using direct feedback from vendors and it still resolves the business proposition.","m.mentions":{},"m.relates_to":{"event_id":"$GfMGMlWv5IWY8AMYd9rSv0UyVKPoKB3uAgKDlElizTs","is_falling_back":true,"m.in_reply_to":{"event_id":"$GfMGMlWv5IWY8AMYd9rSv0UyVKPoKB3uAgKDlElizTs"},"rel_type":"m.thread"},"msgtype":"m.text"},"ts":1733333811777,"senderName":"leobalter","senderId":"@leobalter:matrix.org","id":"$IZJ1hxoQ8tvZMWTw5qxcxBguITUMUskxOoGuIX6yqzU"},
{"content":{"body":"we don't need to rediscuss this here, we can agree to disagree. It should be up to the champions to move the proposal forward.","m.mentions":{},"m.relates_to":{"event_id":"$GfMGMlWv5IWY8AMYd9rSv0UyVKPoKB3uAgKDlElizTs","is_falling_back":true,"m.in_reply_to":{"event_id":"$IZJ1hxoQ8tvZMWTw5qxcxBguITUMUskxOoGuIX6yqzU"},"rel_type":"m.thread"},"msgtype":"m.text"},"ts":1733333875197,"senderName":"leobalter","senderId":"@leobalter:matrix.org","id":"$6MmpZOFHsUMCOXffNy8Ze0k-lMBq6YsuMSi-eywvTnI"},
{"content":{"body":"For what reason? Because it's not possible to know all the files users want to import? Otherwise the bundling pass could just gather all the imports and replace `import.sync(\"./a.js\");` with a prepass that exposes a bunch of `aSourceModule`s and does `import.sync(aSourceModule)`","format":"org.matrix.custom.html","formatted_body":"For what reason? Because it's not possible to know all the files users want to import? Otherwise the bundling pass could just gather all the imports and replace <code>import.sync(\"./a.js\");</code> with a prepass that exposes a bunch of <code>aSourceModule</code>s and does <code>import.sync(aSourceModule)</code>","m.mentions":{"user_ids":["@nicolo-ribaudo:matrix.org"]},"m.relates_to":{"m.in_reply_to":{"event_id":"$I4RdBp8U_JicCA3u9sR74KTnxuByQKnwMdC9GDCpEM8"}},"msgtype":"m.text"},"ts":1733333979120,"senderName":"keith_miller","senderId":"@keith_miller:matrix.org","id":"$d7ZSSpdtu00szCyE8tApkrdDZ8I2gkBeeJU_5VBVnkQ"},
{"content":{"body":"There is no bundling pass in Node.js, it runs modules directly. The use cases for `import.meta.require(\"./a/file.js\")` is synchronous conditional loading, for example to only load a polyfill when running in Node.js and not when running in the browser","format":"org.matrix.custom.html","formatted_body":"There is no bundling pass in Node.js, it runs modules directly. The use cases for <code>import.meta.require(\"./a/file.js\")</code> is synchronous conditional loading, for example to only load a polyfill when running in Node.js and not when running in the browser","m.mentions":{},"msgtype":"m.text"},"ts":1733334129007,"senderName":"nicolo-ribaudo","senderId":"@nicolo-ribaudo:matrix.org","id":"$tcqz0lBTSuE6ory8YSnIF3Wid3P5s_EoABSdiTvecT4"},
{"content":{"body":"some of which could be done with an import map? Though I guess a library can't easily 'ship' an import map that it expects the final app to pull in","m.mentions":{},"msgtype":"m.text"},"ts":1733334600079,"senderName":"Ashley Claymore","senderId":"@aclaymore:matrix.org","id":"$w07yN-C51VlQ_guT7HTqAYvUhIZJLWyQAALENlGOge4"},
{"content":{"body":"would have to express via package.json","m.mentions":{},"msgtype":"m.text"},"ts":1733334616163,"senderName":"Ashley Claymore","senderId":"@aclaymore:matrix.org","id":"$hjdlZ6Qf0viNebakEFd8qJCJYSVkpIf4lKoEMmERcX0"},
{"content":{"body":"Sure, I guess I was thinking of `package.json` as the \"bundling pass\" ","format":"org.matrix.custom.html","formatted_body":"Sure, I guess I was thinking of <code>package.json</code> as the \"bundling pass\"","m.mentions":{},"msgtype":"m.text"},"ts":1733334652446,"senderName":"keith_miller","senderId":"@keith_miller:matrix.org","id":"$9aadhcQNDf6W2UJOUP47EYVdoGFmHqVHhwNIWCFzjIY"},
{"content":{"body":"It seems like it wouldn't be crazy or insurmountable to specify all the conditional packages your project uses in `package.json`. Or if you do some sync importing for some other package to require that package to list the ones it uses","format":"org.matrix.custom.html","formatted_body":"It seems like it wouldn't be crazy or insurmountable to specify all the conditional packages your project uses in <code>package.json</code>. Or if you do some sync importing for some other package to require that package to list the ones it uses","m.mentions":{},"msgtype":"m.text"},"ts":1733334737071,"senderName":"keith_miller","senderId":"@keith_miller:matrix.org","id":"$FXTlGeixWL4YjzKYOm0vqGZiWyOyUTghAmeKvzTp9Bw"},
{"content":{"body":"That would be a good security practice anyway, IMO","m.mentions":{},"msgtype":"m.text"},"ts":1733334753147,"senderName":"keith_miller","senderId":"@keith_miller:matrix.org","id":"$pZtvOLuW0NyNa53n2ZslWLsG44o7AXleeMTZi80fOI4"},
{"content":{"body":"Perhaps there's some details I'm missing though","m.mentions":{},"msgtype":"m.text"},"ts":1733334840071,"senderName":"keith_miller","senderId":"@keith_miller:matrix.org","id":"$efDMiULM4YVQ1vYaBUE55aFb0rXyqNH0i7yJ7g2SN7Y"},
{"content":{"body":"So, assuming that they are all in package.json (I was assuming the same), then what happens? Are you assuming that Node.js loads all the dependencies defined in package.json at startup, so they then they are already pre-loaded when you try to sync import them?","m.mentions":{},"msgtype":"m.text"},"ts":1733334880533,"senderName":"nicolo-ribaudo","senderId":"@nicolo-ribaudo:matrix.org","id":"$mdAtxZDsI8PgIVuVkPsNDqZOLDj3p53ZvFjXhofqerw"},
{"content":{"body":"Yeah, effectively.","m.mentions":{},"msgtype":"m.text"},"ts":1733334914988,"senderName":"keith_miller","senderId":"@keith_miller:matrix.org","id":"$bmUckw8EMYb5jyxYMKzSmENdMaB5FLx7V8si0JFckpg"},
{"content":{"body":"If it's just an fopen call that's probably sufficiently equivalent from a spec compliance PoV","m.mentions":{},"msgtype":"m.text"},"ts":1733334950050,"senderName":"keith_miller","senderId":"@keith_miller:matrix.org","id":"$m_I1djZnMbrDC2mQoPJjgbLM1e46ijTcX0Lo5badmR4"},
{"content":{"body":" * If it's just an fopen call at sync import time that's probably sufficiently equivalent from a spec compliance PoV","m.mentions":{},"m.new_content":{"body":"If it's just an fopen call at sync import time that's probably sufficiently equivalent from a spec compliance PoV","m.mentions":{},"msgtype":"m.text"},"m.relates_to":{"event_id":"$m_I1djZnMbrDC2mQoPJjgbLM1e46ijTcX0Lo5badmR4","rel_type":"m.replace"},"msgtype":"m.text"},"ts":1733334959323,"senderName":"keith_miller","senderId":"@keith_miller:matrix.org","id":"$qH-5uqJKhRnigG4X-F4Ekg7690rMGv1_poLXsdTuh2k"},
{"content":{"body":"Well, it also requires parsing to recourse into the dependencies of the modules you list as dependencies in package.json","m.mentions":{},"msgtype":"m.text"},"ts":1733334990056,"senderName":"nicolo-ribaudo","senderId":"@nicolo-ribaudo:matrix.org","id":"$exgvS4cU3uitg3TMhJ3JPzkcXts3bLU3em79tMxySHA"},
{"content":{"body":"This solution seems fine, but then it's equivalent to \"we allow Node.js to have different behavior from browsers\"","m.mentions":{},"msgtype":"m.text"},"ts":1733335050290,"senderName":"nicolo-ribaudo","senderId":"@nicolo-ribaudo:matrix.org","id":"$k3yok104-924RWKXLbn9tCBLZryTqJO4uxvvYcWg2Ww"},
{"content":{"body":"Since browsers don't pre-load the import map","m.mentions":{},"msgtype":"m.text"},"ts":1733335060982,"senderName":"nicolo-ribaudo","senderId":"@nicolo-ribaudo:matrix.org","id":"$Q32R7MJ3CGoqfmYJmnh5yDzdz6nlVJPcVswvA22yKMs"},
{"content":{"body":"Why would have to parse the source? It seems like that data should be transitively visible from the package.json","m.mentions":{},"msgtype":"m.text"},"ts":1733335072608,"senderName":"keith_miller","senderId":"@keith_miller:matrix.org","id":"$ykm0psIuXgR43P4cX76Xh0tmqlSEkhvG202OnC5GhZQ"},
{"content":{"body":"package.json dependencies point to a \"group of modules\". Only the entrypoints of each library are listed","m.mentions":{},"msgtype":"m.text"},"ts":1733335130634,"senderName":"nicolo-ribaudo","senderId":"@nicolo-ribaudo:matrix.org","id":"$2G0OZeWdvAGmLi8tQ8KBQvHsdcB6h-jOu0OZjnlWpXY"},
{"content":{"body":"Not the modules they load within the same package","m.mentions":{},"msgtype":"m.text"},"ts":1733335141119,"senderName":"nicolo-ribaudo","senderId":"@nicolo-ribaudo:matrix.org","id":"$caXkzM6XyeLFX4DDdZMsrYD4t8M1ZTSefG11TDyBuxA"},
{"content":{"body":"Yeah but those entrypoints also have a package.json(?) So that would tell you what modules are needed for that package, recursively","m.mentions":{},"msgtype":"m.text"},"ts":1733335192987,"senderName":"keith_miller","senderId":"@keith_miller:matrix.org","id":"$a0uvGRwp1FfDGHRMbNM2xKTHOsliL0p0M_Sz1Pdg-W4"},
{"content":{"body":"not necessarily, because package.json doesn't have to list every entrypoint unless it's using `exports`","format":"org.matrix.custom.html","formatted_body":"not necessarily, because package.json doesn't have to list every entrypoint unless it's using <code>exports</code>","m.mentions":{},"msgtype":"m.text"},"ts":1733335208633,"senderName":"ljharb","senderId":"@ljharb:matrix.org","id":"$QQVN006GuU-0KGyf84h4wkPHXT29QU7r07KKbnznD7U"},
{"content":{"body":"also, even with using `exports`, each entrypoint could be importing other files that aren't externally accessible","format":"org.matrix.custom.html","formatted_body":"also, even with using <code>exports</code>, each entrypoint could be importing other files that aren't externally accessible","m.mentions":{},"msgtype":"m.text"},"ts":1733335225554,"senderName":"ljharb","senderId":"@ljharb:matrix.org","id":"$QjkM3ovv_lfCtE2cJmQL9nFOLlDIYZxh_FsipcNOfso"},
{"content":{"body":" * also, even with using `exports`, each entrypoint could be importing other relative files that aren't externally accessible","format":"org.matrix.custom.html","formatted_body":" * also, even with using <code>exports</code>, each entrypoint could be importing other relative files that aren't externally accessible","m.mentions":{},"m.new_content":{"body":"also, even with using `exports`, each entrypoint could be importing other relative files that aren't externally accessible","format":"org.matrix.custom.html","formatted_body":"also, even with using <code>exports</code>, each entrypoint could be importing other relative files that aren't externally accessible","m.mentions":{},"msgtype":"m.text"},"m.relates_to":{"event_id":"$QjkM3ovv_lfCtE2cJmQL9nFOLlDIYZxh_FsipcNOfso","rel_type":"m.replace"},"msgtype":"m.text"},"ts":1733335230053,"senderName":"ljharb","senderId":"@ljharb:matrix.org","id":"$8nnhr_Lo-_ovnCb4lYvim2nvxP3pNZVlBEF-tJMgNrs"},
{"content":{"body":"> <@ljharb:matrix.org> also, even with using `exports`, each entrypoint could be importing other relative files that aren't externally accessible\n\n^ this is my point","format":"org.matrix.custom.html","formatted_body":"<mx-reply><blockquote><a href=\"https://matrix.to/#/!WgJwmjBNZEXhJnXHXw:matrix.org/$QjkM3ovv_lfCtE2cJmQL9nFOLlDIYZxh_FsipcNOfso?via=matrix.org&via=mozilla.org&via=igalia.com\">In reply to</a> <a href=\"https://matrix.to/#/@ljharb:matrix.org\">@ljharb:matrix.org</a><br>also, even with using <code>exports</code>, each entrypoint could be importing other relative files that aren't externally accessible</blockquote></mx-reply>^ this is my point","m.mentions":{"user_ids":["@ljharb:matrix.org"]},"m.relates_to":{"m.in_reply_to":{"event_id":"$QjkM3ovv_lfCtE2cJmQL9nFOLlDIYZxh_FsipcNOfso"}},"msgtype":"m.text"},"ts":1733335236495,"senderName":"nicolo-ribaudo","senderId":"@nicolo-ribaudo:matrix.org","id":"$K8b9z-kG5XBjs5v8CC67dAw5LJCEOyBwydBudyA-hf0"}
]
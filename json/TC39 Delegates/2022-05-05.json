[
{"content":{"body":"TabAtkins: the way you've written https://webidl.spec.whatwg.org/#es-map-iterator implies that `(new Map)[Symbol.iterator]().next.call(webIdlMapLike)` would work, which is... maybe not a thing you intended?","format":"org.matrix.custom.html","formatted_body":"<a href=\"https://matrix.to/#/@tabatkins:matrix.org\">TabAtkins</a>: the way you've written https://webidl.spec.whatwg.org/#es-map-iterator implies that <code>(new Map)[Symbol.iterator]().next.call(webIdlMapLike)</code> would work, which is... maybe not a thing you intended?","msgtype":"m.text","org.matrix.msc1767.message":[{"body":"TabAtkins: the way you've written https://webidl.spec.whatwg.org/#es-map-iterator implies that `(new Map)[Symbol.iterator]().next.call(webIdlMapLike)` would work, which is... maybe not a thing you intended?","mimetype":"text/plain"},{"body":"<a href=\"https://matrix.to/#/@tabatkins:matrix.org\">TabAtkins</a>: the way you've written https://webidl.spec.whatwg.org/#es-map-iterator implies that <code>(new Map)[Symbol.iterator]().next.call(webIdlMapLike)</code> would work, which is... maybe not a thing you intended?","mimetype":"text/html"}]},"ts":1651778105406,"senderName":"bakkot","senderId":"@bakkot:matrix.org","id":"$E2-Uzp7nf_ScuBFceFNrXsUte7t_P8_M1Gu8uZMjtvw"},
{"content":{"body":"I don't know where webidl map-likes are used though","msgtype":"m.text","org.matrix.msc1767.text":"I don't know where webidl map-likes are used though"},"ts":1651778128329,"senderName":"bakkot","senderId":"@bakkot:matrix.org","id":"$ZULKC9VM8TlGNDiNPDdAToFXHZFqABp8Tv2pt3Y83n4"},
{"content":{"body":"Hmmmmm, I dunno if that's a problem?","msgtype":"m.text","org.matrix.msc1767.text":"Hmmmmm, I dunno if that's a problem?"},"ts":1651778185165,"senderName":"TabAtkins","senderId":"@tabatkins:matrix.org","id":"$UmuwtfsgSL40--KAPeLaaqCietVF19V1LN5eNtoL-Lc"},
{"content":{"body":"(For an example usage, see https://tabatkins.github.io/css-toggle/#dom)","msgtype":"m.text","org.matrix.msc1767.text":"(For an example usage, see https://tabatkins.github.io/css-toggle/#dom)"},"ts":1651778191586,"senderName":"TabAtkins","senderId":"@tabatkins:matrix.org","id":"$_NtTqNiFu6KbGVY1mn7X55Px4FEzt0YvsD_9NVp-Vvo"},
{"content":{"body":"I think that is... probably not desirable, at least for implementations?","msgtype":"m.text","org.matrix.msc1767.text":"I think that is... probably not desirable, at least for implementations?"},"ts":1651778299163,"senderName":"bakkot","senderId":"@bakkot:matrix.org","id":"$PI-JCDofj8LA0uT4KGRMKzGQuODGOoSDpg7f5qscDqE"},
{"content":{"body":".next() isn't usable directly on a Map, right? You'd still have to actually extract an iterator, which has .next() from its proto.","msgtype":"m.text","org.matrix.msc1767.text":".next() isn't usable directly on a Map, right? You'd still have to actually extract an iterator, which has .next() from its proto."},"ts":1651778311726,"senderName":"TabAtkins","senderId":"@tabatkins:matrix.org","id":"$KxkRZQFATauEw59X7k-_W27SrIJnLmQ-F_tPzFZZ_38"},
{"content":{"body":"oh, yeah, so `(new Map)[Symbol.iterator]().next.call(webIdlMapLike[Symbol.iterator]())` ","format":"org.matrix.custom.html","formatted_body":"oh, yeah, so <code>(new Map)[Symbol.iterator]().next.call(webIdlMapLike[Symbol.iterator]())</code>","msgtype":"m.text","org.matrix.msc1767.message":[{"body":"oh, yeah, so `(new Map)[Symbol.iterator]().next.call(webIdlMapLike[Symbol.iterator]())` ","mimetype":"text/plain"},{"body":"oh, yeah, so <code>(new Map)[Symbol.iterator]().next.call(webIdlMapLike[Symbol.iterator]())</code>","mimetype":"text/html"}]},"ts":1651778354420,"senderName":"bakkot","senderId":"@bakkot:matrix.org","id":"$RnG8Mqb7-zUiAouXq8XulZyIZ5DY2jAjOCl4XgBJqgo"},
{"content":{"body":"I think you probably do not want to require that that work","msgtype":"m.text","org.matrix.msc1767.text":"I think you probably do not want to require that that work"},"ts":1651778363224,"senderName":"bakkot","senderId":"@bakkot:matrix.org","id":"$EuyFvEMl0UtSoBK_w6s0WJEr6ENbV7TVkDNjSyCa3aU"},
{"content":{"body":"Why not? Making it not work would presumably require us to *not* use MapIteratorPrototype at all, right?","format":"org.matrix.custom.html","formatted_body":"Why not? Making it not work would presumably require us to <em>not</em> use MapIteratorPrototype at all, right?","msgtype":"m.text","org.matrix.msc1767.message":[{"body":"Why not? Making it not work would presumably require us to *not* use MapIteratorPrototype at all, right?","mimetype":"text/plain"},{"body":"Why not? Making it not work would presumably require us to <em>not</em> use MapIteratorPrototype at all, right?","mimetype":"text/html"}]},"ts":1651778387525,"senderName":"TabAtkins","senderId":"@tabatkins:matrix.org","id":"$153FJiKsvXQjKw_9IK2CMAw03UUlAu6A_L4okfBQRmw"},
{"content":{"body":"oh, I missed that you are intending to use MapIteratorPrototype","msgtype":"m.text","org.matrix.msc1767.text":"oh, I missed that you are intending to use MapIteratorPrototype"},"ts":1651778411481,"senderName":"bakkot","senderId":"@bakkot:matrix.org","id":"$d8gQ09ORM5iyRsWdT_uLkv2TzVYVhkKpnzdAISmomaw"},
{"content":{"body":"(That was already required before my edits, btw.)","msgtype":"m.text","org.matrix.msc1767.text":"(That was already required before my edits, btw.)"},"ts":1651778416569,"senderName":"TabAtkins","senderId":"@tabatkins:matrix.org","id":"$2u-WKlGhiVlCCxg5j81KPuHthKAKHH0SQ97NWHXGWik"},
{"content":{"body":"Yeah we're manually reproducing Map's proto methods by hand, but there's no reason for us to do the same for its iterator.","msgtype":"m.text","org.matrix.msc1767.text":"Yeah we're manually reproducing Map's proto methods by hand, but there's no reason for us to do the same for its iterator."},"ts":1651778461917,"senderName":"TabAtkins","senderId":"@tabatkins:matrix.org","id":"$XK6z7-jRV2bFNK3N8bw3MPYqErQg0EjhBaAWpEgCzdw"},
{"content":{"body":"it's conceptually kind of weird? a \"real\" map iterator uses the [[MapData]] internal slot","msgtype":"m.text","org.matrix.msc1767.text":"it's conceptually kind of weird? a \"real\" map iterator uses the [[MapData]] internal slot"},"ts":1651778548421,"senderName":"bakkot","senderId":"@bakkot:matrix.org","id":"$SPuOz9JXXt6rrR17hsQNDqy8RldZPBQKzqAuA74eSro"},
{"content":{"body":"I don't think it's going to cause problems for users (or even be noticed), but it might trip up implementations","msgtype":"m.text","org.matrix.msc1767.text":"I don't think it's going to cause problems for users (or even be noticed), but it might trip up implementations"},"ts":1651778595411,"senderName":"bakkot","senderId":"@bakkot:matrix.org","id":"$RuTJfpFFAgqtYyYt5tPUt5TTd9f8f2KE3olIHqZvfjg"},
{"content":{"body":"when we wrote https://github.com/tc39/ecma262/pull/2045 the thinking was that brands would be single-use","msgtype":"m.text","org.matrix.msc1767.text":"when we wrote https://github.com/tc39/ecma262/pull/2045 the thinking was that brands would be single-use"},"ts":1651778628185,"senderName":"bakkot","senderId":"@bakkot:matrix.org","id":"$MlnLkZWsheyeEeZILY3-VrZu4Ub2p9PDpD0LcVjR9JM"},
{"content":{"body":"If that's problematic, the spec shouldn't be written in a way that implies it's pluggable. ^_^","msgtype":"m.text","org.matrix.msc1767.text":"If that's problematic, the spec shouldn't be written in a way that implies it's pluggable. ^_^"},"ts":1651778657083,"senderName":"TabAtkins","senderId":"@tabatkins:matrix.org","id":"$j_EPX6_ISg85dbe4_wl39Hb00mPkka8uYG9VtnyHXAs"},
{"content":{"body":"the spec is not an API","msgtype":"m.text","org.matrix.msc1767.text":"the spec is not an API"},"ts":1651778681416,"senderName":"bakkot","senderId":"@bakkot:matrix.org","id":"$tVTebjuP853XVZ8pTNAzjiiKPf-DyQdn-zsxmfcm4Mo"},
{"content":{"body":"what's this about brands?","msgtype":"m.text","org.matrix.msc1767.text":"what's this about brands?"},"ts":1651778691176,"senderName":"TabAtkins","senderId":"@tabatkins:matrix.org","id":"$11zg6bhdfJ1ra2-ZPPRWvbuAoaP4RAGI8ALHtkFOuMc"},
{"content":{"body":"the string argument to CreateIteratorFromClosure is a brand","msgtype":"m.text","org.matrix.msc1767.text":"the string argument to CreateIteratorFromClosure is a brand"},"ts":1651778710913,"senderName":"bakkot","senderId":"@bakkot:matrix.org","id":"$HTVHNr55B7tY0L0mX2RmgGEscrTg7LcremJhOWr3snM"},
{"content":{"body":"which is intended to prevent users from using `.next` from one kind of iterator with a different kind of iterator","format":"org.matrix.custom.html","formatted_body":"which is intended to prevent users from using <code>.next</code> from one kind of iterator with a different kind of iterator","msgtype":"m.text","org.matrix.msc1767.message":[{"body":"which is intended to prevent users from using `.next` from one kind of iterator with a different kind of iterator","mimetype":"text/plain"},{"body":"which is intended to prevent users from using <code>.next</code> from one kind of iterator with a different kind of iterator","mimetype":"text/html"}]},"ts":1651778732501,"senderName":"bakkot","senderId":"@bakkot:matrix.org","id":"$3zFfCMWML8ft2zNkbVIqhrzDTTj3QfcjIIr7jtZrpWk"},
{"content":{"body":" * which is intended to prevent users from using `.next` from one kind of iterator with a different kind of iterator","format":"org.matrix.custom.html","formatted_body":" * which is intended to prevent users from using <code>.next</code> from one kind of iterator with a different kind of iterator","m.new_content":{"body":"which is intended to prevent users from using `.next` from one kind of iterator with a different kind of iterator","format":"org.matrix.custom.html","formatted_body":"which is intended to prevent users from using <code>.next</code> from one kind of iterator with a different kind of iterator","msgtype":"m.text","org.matrix.msc1767.message":[{"body":"which is intended to prevent users from using `.next` from one kind of iterator with a different kind of iterator","mimetype":"text/plain"},{"body":"which is intended to prevent users from using <code>.next</code> from one kind of iterator with a different kind of iterator","mimetype":"text/html"}]},"m.relates_to":{"event_id":"$3zFfCMWML8ft2zNkbVIqhrzDTTj3QfcjIIr7jtZrpWk","rel_type":"m.replace"},"msgtype":"m.text","org.matrix.msc1767.message":[{"body":" * which is intended to prevent users from using `.next` from one kind of iterator with a different kind of iterator","mimetype":"text/plain"},{"body":" * which is intended to prevent users from using <code>.next</code> from one kind of iterator with a different kind of iterator","mimetype":"text/html"}]},"ts":1651778753638,"senderName":"bakkot","senderId":"@bakkot:matrix.org","id":"$oSfAZuN2ISBrwi9VbZn7OJ9J7oNqNzdDlm1Soub-B-Q"},
{"content":{"body":"Oh, if that's the issue we can change that.","msgtype":"m.text","org.matrix.msc1767.text":"Oh, if that's the issue we can change that."},"ts":1651778761600,"senderName":"TabAtkins","senderId":"@tabatkins:matrix.org","id":"$r_csnCBbcMLeytvWPPWCBtQKW73B7lG4DA_G6O-p5jc"},
{"content":{"body":"It didn't look like something I *needed* to change, is all.","format":"org.matrix.custom.html","formatted_body":"It didn't look like something I <em>needed</em> to change, is all.","msgtype":"m.text","org.matrix.msc1767.message":[{"body":"It didn't look like something I *needed* to change, is all.","mimetype":"text/plain"},{"body":"It didn't look like something I <em>needed</em> to change, is all.","mimetype":"text/html"}]},"ts":1651778775081,"senderName":"TabAtkins","senderId":"@tabatkins:matrix.org","id":"$gTYwEonRDmzgFYDYUA2Zp8zVefhLoEbYJE3NBioN04M"},
{"content":{"body":"if you change it you'll also need a new prototype, though","msgtype":"m.text","org.matrix.msc1767.text":"if you change it you'll also need a new prototype, though"},"ts":1651778794426,"senderName":"bakkot","senderId":"@bakkot:matrix.org","id":"$PuEs-PVKHsGne2u0yfpMYKNPTSxdEEHNVlZSFP5cSn8"},
{"content":{"body":"the way it works is, `CreateIteratorFromClosure` specifies a brand, which is stored on the iterator, and then the various `.next` methods check that brand","format":"org.matrix.custom.html","formatted_body":"the way it works is, <code>CreateIteratorFromClosure</code> specifies a brand, which is stored on the iterator, and then the various <code>.next</code> methods check that brand","msgtype":"m.text","org.matrix.msc1767.message":[{"body":"the way it works is, `CreateIteratorFromClosure` specifies a brand, which is stored on the iterator, and then the various `.next` methods check that brand","mimetype":"text/plain"},{"body":"the way it works is, <code>CreateIteratorFromClosure</code> specifies a brand, which is stored on the iterator, and then the various <code>.next</code> methods check that brand","mimetype":"text/html"}]},"ts":1651778832935,"senderName":"bakkot","senderId":"@bakkot:matrix.org","id":"$s5bkBiFgT2S-9vSlJHjz39N6vP_UTOFJCOTQ1WXSi7g"},
{"content":{"body":"please do not reuse MapIteratorPrototype on something that's not a Map, that's not right","msgtype":"m.text","org.matrix.msc1767.text":"please do not reuse MapIteratorPrototype on something that's not a Map, that's not right"},"ts":1651778870381,"senderName":"ljharb","senderId":"@ljharb:matrix.org","id":"$SyvMFFn0ovqcitoJ2oc--2vNhnWHnORp9rvo8qaGmT0"},
{"content":{"body":"so `CreateMapIterator` and `%MapIteratorPrototype%.next ( )` both specify the `\"%MapIteratorPrototype%\"` brand, which is how we achieve that only the MapIterator `.next` works with map iterators","format":"org.matrix.custom.html","formatted_body":"so <code>CreateMapIterator</code> and <code>%MapIteratorPrototype%.next ( )</code> both specify the <code>&quot;%MapIteratorPrototype%&quot;</code> brand, which is how we achieve that only the MapIterator <code>.next</code> works with map iterators","msgtype":"m.text","org.matrix.msc1767.message":[{"body":"so `CreateMapIterator` and `%MapIteratorPrototype%.next ( )` both specify the `\"%MapIteratorPrototype%\"` brand, which is how we achieve that only the MapIterator `.next` works with map iterators","mimetype":"text/plain"},{"body":"so <code>CreateMapIterator</code> and <code>%MapIteratorPrototype%.next ( )</code> both specify the <code>&quot;%MapIteratorPrototype%&quot;</code> brand, which is how we achieve that only the MapIterator <code>.next</code> works with map iterators","mimetype":"text/html"}]},"ts":1651778911292,"senderName":"bakkot","senderId":"@bakkot:matrix.org","id":"$XWE9w38RzoZrrH92sCTcxknpRrh_iXZd6e3SzMYiw28"},
{"content":{"body":"and it would be a bug if that brand check passed on something that wasn't a Map instance","msgtype":"m.text","org.matrix.msc1767.text":"and it would be a bug if that brand check passed on something that wasn't a Map instance"},"ts":1651778956512,"senderName":"ljharb","senderId":"@ljharb:matrix.org","id":"$nYJmYxoTsUAQ73cuhrRZM-70JdKuHVdomrj6F9-c4sQ"},
{"content":{"body":"ljharb: the brand check is only for Map _iterators_, not Map instances","format":"org.matrix.custom.html","formatted_body":"<a href=\"https://matrix.to/#/@ljharb:matrix.org\">ljharb</a>: the brand check is only for Map <em>iterators</em>, not Map instances","msgtype":"m.text","org.matrix.msc1767.message":[{"body":"ljharb: the brand check is only for Map _iterators_, not Map instances","mimetype":"text/plain"},{"body":"<a href=\"https://matrix.to/#/@ljharb:matrix.org\">ljharb</a>: the brand check is only for Map <em>iterators</em>, not Map instances","mimetype":"text/html"}]},"ts":1651778986362,"senderName":"bakkot","senderId":"@bakkot:matrix.org","id":"$dFSaKRv12l1Zlqd8RIUYbA0F7eh3VJ1ts1nZ_I9Gpuk"},
{"content":{"body":"oh right sorry","msgtype":"m.text","org.matrix.msc1767.text":"oh right sorry"},"ts":1651779005796,"senderName":"ljharb","senderId":"@ljharb:matrix.org","id":"$PnkKwjOl9bsteu0bR6Sdwmh7fxJLKk3L2yvpHUl2Z0M"},
{"content":{"body":"ok, Map iterator instance then :-p","msgtype":"m.text","org.matrix.msc1767.text":"ok, Map iterator instance then :-p"},"ts":1651779012551,"senderName":"ljharb","senderId":"@ljharb:matrix.org","id":"$ZILARAJz0Od7N4cQOwPgmi4Wb6_uSmzSPyKxaxfxYUg"},
{"content":{"body":"(obv that's way less important to brand check)","msgtype":"m.text","org.matrix.msc1767.text":"(obv that's way less important to brand check)"},"ts":1651779025351,"senderName":"ljharb","senderId":"@ljharb:matrix.org","id":"$BilvOF4OPwD1AXRg9FxdORlzxPmRtYEA7xGtPpPYqco"},
{"content":{"body":"TabAtkins: anyway, if you want to avoid re-implementing stuff, while also not pretending to be an _actual_ Map iterator, I think the simplest thing would be to pretend to be a userland generator - i.e. inherit from `Generator` rather than `MapIterator`, and use `~empty~` as the brand","format":"org.matrix.custom.html","formatted_body":"<a href=\"https://matrix.to/#/@tabatkins:matrix.org\">TabAtkins</a>: anyway, if you want to avoid re-implementing stuff, while also not pretending to be an <em>actual</em> Map iterator, I think the simplest thing would be to pretend to be a userland generator - i.e. inherit from <code>Generator</code> rather than <code>MapIterator</code>, and use <code>~empty~</code> as the brand","msgtype":"m.text","org.matrix.msc1767.message":[{"body":"TabAtkins: anyway, if you want to avoid re-implementing stuff, while also not pretending to be an _actual_ Map iterator, I think the simplest thing would be to pretend to be a userland generator - i.e. inherit from `Generator` rather than `MapIterator`, and use `~empty~` as the brand","mimetype":"text/plain"},{"body":"<a href=\"https://matrix.to/#/@tabatkins:matrix.org\">TabAtkins</a>: anyway, if you want to avoid re-implementing stuff, while also not pretending to be an <em>actual</em> Map iterator, I think the simplest thing would be to pretend to be a userland generator - i.e. inherit from <code>Generator</code> rather than <code>MapIterator</code>, and use <code>~empty~</code> as the brand","mimetype":"text/html"}]},"ts":1651779080080,"senderName":"bakkot","senderId":"@bakkot:matrix.org","id":"$sJu7msy75l3ML8F55wf6IdskY5JwR1tx05JlY8EjK4w"},
{"content":{"body":"this has the bonus that it would allow implementations to implement the iterator as a JS generator","msgtype":"m.text","org.matrix.msc1767.text":"this has the bonus that it would allow implementations to implement the iterator as a JS generator"},"ts":1651779113476,"senderName":"bakkot","senderId":"@bakkot:matrix.org","id":"$jUeeYMdxsJnnH72-EEWxUTsMh8Y2L1oyjHQkSnR40a0"},
{"content":{"body":" * this has the bonus that it would allow implementations to implement the iterator as a JS generator","m.new_content":{"body":"this has the bonus that it would allow implementations to implement the iterator as a JS generator","msgtype":"m.text","org.matrix.msc1767.text":"this has the bonus that it would allow implementations to implement the iterator as a JS generator"},"m.relates_to":{"event_id":"$jUeeYMdxsJnnH72-EEWxUTsMh8Y2L1oyjHQkSnR40a0","rel_type":"m.replace"},"msgtype":"m.text","org.matrix.msc1767.text":" * this has the bonus that it would allow implementations to implement the iterator as a JS generator"},"ts":1651779118474,"senderName":"bakkot","senderId":"@bakkot:matrix.org","id":"$c5sqNXQp2enUxQfLFQYABiLUmpHU5BMiduJLkZ1ceeE"},
{"content":{"body":"Hm, that would mean that future things put on MapIteratorPrototype wouldn't apply then, right?","msgtype":"m.text","org.matrix.msc1767.text":"Hm, that would mean that future things put on MapIteratorPrototype wouldn't apply then, right?"},"ts":1651779140775,"senderName":"TabAtkins","senderId":"@tabatkins:matrix.org","id":"$OoyH6w3G7SzR_FBIkv6NZg901tsGrW14VYaxPERQ5iI"},
{"content":{"body":"well, so","msgtype":"m.text","org.matrix.msc1767.text":"well, so"},"ts":1651779187294,"senderName":"bakkot","senderId":"@bakkot:matrix.org","id":"$NpAjgwoJatSvBMSzWp9Vd-Jo4KdqlmNCQ9yF0vYPUV8"},
{"content":{"body":"as long as MapIteratorPrototype is written as a spec generator, it can't really have more things put on it - the state is all internal to the closure created in CreateMapIterator","msgtype":"m.text","org.matrix.msc1767.text":"as long as MapIteratorPrototype is written as a spec generator, it can't really have more things put on it - the state is all internal to the closure created in CreateMapIterator"},"ts":1651779226599,"senderName":"bakkot","senderId":"@bakkot:matrix.org","id":"$KXJpOsA90tJgQCfx0mAE77eQvzaP51mHnhHm-jOBY0w"},
{"content":{"body":"so if we wanted to add more stuff, we'd have to revert the change from https://github.com/tc39/ecma262/pull/2045 anyway","msgtype":"m.text","org.matrix.msc1767.text":"so if we wanted to add more stuff, we'd have to revert the change from https://github.com/tc39/ecma262/pull/2045 anyway"},"ts":1651779251858,"senderName":"bakkot","senderId":"@bakkot:matrix.org","id":"$SgREtw8p9rSjK0_vMRN3ePobSvz1clDGHpY3GX1Gk7Q"},
{"content":{"body":"and go back to using specialized slots on the iterator instance to store the state of the iterator","msgtype":"m.text","org.matrix.msc1767.text":"and go back to using specialized slots on the iterator instance to store the state of the iterator"},"ts":1651779279355,"senderName":"bakkot","senderId":"@bakkot:matrix.org","id":"$aw31F8Tik_UHIctnNkQrS_xSXlAjoQN4HZtwemlIhHg"},
{"content":{"body":"which would break this part of webidl anyway","msgtype":"m.text","org.matrix.msc1767.text":"which would break this part of webidl anyway"},"ts":1651779288567,"senderName":"bakkot","senderId":"@bakkot:matrix.org","id":"$wH0xdtrmmewSEM9sO2EmWJTmkOqseIcOkPkWhxytzE0"},
{"content":{"body":"why would MapIteratorPrototype ever get something added to it? iterator helpers would be on a superclass, and generator-made iterators would have those too, i think","msgtype":"m.text","org.matrix.msc1767.text":"why would MapIteratorPrototype ever get something added to it? iterator helpers would be on a superclass, and generator-made iterators would have those too, i think"},"ts":1651779332962,"senderName":"ljharb","senderId":"@ljharb:matrix.org","id":"$pF6ijLZBPbwpyEAxwibrhsjK8p-HYoqHH5IOFKpBYts"},
{"content":{"body":"java's iterators have a `remove` method which is occasionally handy, e.g.","format":"org.matrix.custom.html","formatted_body":"java's iterators have a <code>remove</code> method which is occasionally handy, e.g.","msgtype":"m.text","org.matrix.msc1767.message":[{"body":"java's iterators have a `remove` method which is occasionally handy, e.g.","mimetype":"text/plain"},{"body":"java's iterators have a <code>remove</code> method which is occasionally handy, e.g.","mimetype":"text/html"}]},"ts":1651779347855,"senderName":"bakkot","senderId":"@bakkot:matrix.org","id":"$7Z3yxIXTbzwOfpDKTES1tMgliP0ayQ_8wwWHK2_agcM"},
{"content":{"body":"I don't think we'd want to add it but we conceptually could","msgtype":"m.text","org.matrix.msc1767.text":"I don't think we'd want to add it but we conceptually could"},"ts":1651779356252,"senderName":"bakkot","senderId":"@bakkot:matrix.org","id":"$SAnQHBoSndHtKQuVg_MHDCLmxeAlbK_qZP2voiceyFg"},
{"content":{"body":"for iterators for collections in particular, and not for arbitrary generators/iterators","msgtype":"m.text","org.matrix.msc1767.text":"for iterators for collections in particular, and not for arbitrary generators/iterators"},"ts":1651779366986,"senderName":"bakkot","senderId":"@bakkot:matrix.org","id":"$WVnv0TkQTRJml1z1OMR6sCNvWnYzp_Rm9D5byvw4r50"},
{"content":{"body":"Right, I was thinking about iterator helpers. But if they'll all show up on something that all userland generators get too, then I suppose my concern is moot.","msgtype":"m.text","org.matrix.msc1767.text":"Right, I was thinking about iterator helpers. But if they'll all show up on something that all userland generators get too, then I suppose my concern is moot."},"ts":1651779378452,"senderName":"TabAtkins","senderId":"@tabatkins:matrix.org","id":"$dJoHJ5HQiuNZz787XVYrDz3DlN6JCRsIuZ1ZvN73wWg"},
{"content":{"body":"`it.remove()` as a shorthand for \"get the key and remove it directly from the collection\"?","format":"org.matrix.custom.html","formatted_body":"<code>it.remove()</code> as a shorthand for &quot;get the key and remove it directly from the collection&quot;?","msgtype":"m.text","org.matrix.msc1767.message":[{"body":"`it.remove()` as a shorthand for \"get the key and remove it directly from the collection\"?","mimetype":"text/plain"},{"body":"<code>it.remove()</code> as a shorthand for &quot;get the key and remove it directly from the collection&quot;?","mimetype":"text/html"}]},"ts":1651779385370,"senderName":"ljharb","senderId":"@ljharb:matrix.org","id":"$PMK_ehqdqcntM3httjWSfKSo_3lYq4-OViV3NDBKAvo"},
{"content":{"body":" * `it.remove()` as a shorthand for \"get the key and remove it directly from the collection\"?","format":"org.matrix.custom.html","formatted_body":" * <code>it.remove()</code> as a shorthand for &quot;get the key and remove it directly from the collection&quot;?","m.new_content":{"body":"`it.remove()` as a shorthand for \"get the key and remove it directly from the collection\"?","format":"org.matrix.custom.html","formatted_body":"<code>it.remove()</code> as a shorthand for &quot;get the key and remove it directly from the collection&quot;?","msgtype":"m.text","org.matrix.msc1767.message":[{"body":"`it.remove()` as a shorthand for \"get the key and remove it directly from the collection\"?","mimetype":"text/plain"},{"body":"<code>it.remove()</code> as a shorthand for &quot;get the key and remove it directly from the collection&quot;?","mimetype":"text/html"}]},"m.relates_to":{"event_id":"$PMK_ehqdqcntM3httjWSfKSo_3lYq4-OViV3NDBKAvo","rel_type":"m.replace"},"msgtype":"m.text","org.matrix.msc1767.message":[{"body":" * `it.remove()` as a shorthand for \"get the key and remove it directly from the collection\"?","mimetype":"text/plain"},{"body":" * <code>it.remove()</code> as a shorthand for &quot;get the key and remove it directly from the collection&quot;?","mimetype":"text/html"}]},"ts":1651779397175,"senderName":"ljharb","senderId":"@ljharb:matrix.org","id":"$kyO2-LOGNSb6vAEMS1toT0G9WbjHaXP_mpHx-bLKu2g"},
{"content":{"body":"yup, iterator helpers add things to the root iterator prototype, which is shared by MapIterator and also the iterators produced by userland generators","msgtype":"m.text","org.matrix.msc1767.text":"yup, iterator helpers add things to the root iterator prototype, which is shared by MapIterator and also the iterators produced by userland generators"},"ts":1651779403750,"senderName":"bakkot","senderId":"@bakkot:matrix.org","id":"$rAf-r2r0SRL6pnnECyeQWVo3yC9qw1ksArMWDNn7CQk"},
{"content":{"body":"ljharb: in java it means \"remove the last thing yielded\"","format":"org.matrix.custom.html","formatted_body":"<a href=\"https://matrix.to/#/@ljharb:matrix.org\">ljharb</a>: in java it means &quot;remove the last thing yielded&quot;","msgtype":"m.text","org.matrix.msc1767.message":[{"body":"ljharb: in java it means \"remove the last thing yielded\"","mimetype":"text/plain"},{"body":"<a href=\"https://matrix.to/#/@ljharb:matrix.org\">ljharb</a>: in java it means &quot;remove the last thing yielded&quot;","mimetype":"text/html"}]},"ts":1651779432949,"senderName":"bakkot","senderId":"@bakkot:matrix.org","id":"$OzbAyXJ2UhZfeu40pd-exLZquMtu5yTws8fPd3EBnZg"},
{"content":{"body":" * yup, iterator helpers add things to the root iterator prototype, which is shared by MapIterator and also the iterators produced by userland generators","m.new_content":{"body":"yup, iterator helpers add things to the root iterator prototype, which is shared by MapIterator and also the iterators produced by userland generators","msgtype":"m.text","org.matrix.msc1767.text":"yup, iterator helpers add things to the root iterator prototype, which is shared by MapIterator and also the iterators produced by userland generators"},"m.relates_to":{"event_id":"$rAf-r2r0SRL6pnnECyeQWVo3yC9qw1ksArMWDNn7CQk","rel_type":"m.replace"},"msgtype":"m.text","org.matrix.msc1767.text":" * yup, iterator helpers add things to the root iterator prototype, which is shared by MapIterator and also the iterators produced by userland generators"},"ts":1651779447027,"senderName":"bakkot","senderId":"@bakkot:matrix.org","id":"$a6p7uP1kv2vgJX0kgibABLFjmtrpYBuNoI6qbz7VDmI"},
{"content":{"body":"weird, ok","msgtype":"m.text","org.matrix.msc1767.text":"weird, ok"},"ts":1651779466173,"senderName":"ljharb","senderId":"@ljharb:matrix.org","id":"$QFTOxa6ABsnB77PlbPO2hkhzoMWRnZ_HqfrGnnmK5Y0"},
{"content":{"body":"def weird","msgtype":"m.text","org.matrix.msc1767.text":"def weird"},"ts":1651779470216,"senderName":"TabAtkins","senderId":"@tabatkins:matrix.org","id":"$_ATx7l6R4S9nlb-a0M_UwmnA4SKemIZo29jlrQawTag"},
{"content":{"body":"TabAtkins: actually wait, forget my suggestion about inheriting from generator, though","format":"org.matrix.custom.html","formatted_body":"<a href=\"https://matrix.to/#/@tabatkins:matrix.org\">TabAtkins</a>: actually wait, forget my suggestion about inheriting from generator, though","msgtype":"m.text","org.matrix.msc1767.message":[{"body":"TabAtkins: actually wait, forget my suggestion about inheriting from generator, though","mimetype":"text/plain"},{"body":"<a href=\"https://matrix.to/#/@tabatkins:matrix.org\">TabAtkins</a>: actually wait, forget my suggestion about inheriting from generator, though","mimetype":"text/html"}]},"ts":1651779486725,"senderName":"bakkot","senderId":"@bakkot:matrix.org","id":"$383xxOZAW1rnyKnCvr9LTbvfhRIPH3rH2zqNRHGUY-g"},
{"content":{"body":"that would have other consequences which are bad","msgtype":"m.text","org.matrix.msc1767.text":"that would have other consequences which are bad"},"ts":1651779496990,"senderName":"bakkot","senderId":"@bakkot:matrix.org","id":"$imFgaZx3Z-hqEldVFASmP9NtcEnD7O5mOUcRBs7UF5o"},
{"content":{"body":"because generators also have `.return` which injects a return completion at the current `yeild`, which is... not a thing you want, almost certainly","format":"org.matrix.custom.html","formatted_body":"because generators also have <code>.return</code> which injects a return completion at the current <code>yeild</code>, which is... not a thing you want, almost certainly","msgtype":"m.text","org.matrix.msc1767.message":[{"body":"because generators also have `.return` which injects a return completion at the current `yeild`, which is... not a thing you want, almost certainly","mimetype":"text/plain"},{"body":"because generators also have <code>.return</code> which injects a return completion at the current <code>yeild</code>, which is... not a thing you want, almost certainly","mimetype":"text/html"}]},"ts":1651779522599,"senderName":"bakkot","senderId":"@bakkot:matrix.org","id":"$_6df7b4cd19n5YRByYz21xg7hSVz7wtbhuGOP0uihNQ"},
{"content":{"body":"I mean, userland generators have to deal with that too, right? Is there a simple way I can, like, intercept and either ignore it or bail or something?","msgtype":"m.text","org.matrix.msc1767.text":"I mean, userland generators have to deal with that too, right? Is there a simple way I can, like, intercept and either ignore it or bail or something?"},"ts":1651779608636,"senderName":"TabAtkins","senderId":"@tabatkins:matrix.org","id":"$njmC3w_yzSENOcE812otbSX3e6oWEQFcoWh0004rD8M"},
{"content":{"body":"(I'm willing to do a lot if it means (a) I don't have to redefine the entire interator infrastructure from ES and (b) iterator helpers will still work.)","msgtype":"m.text","org.matrix.msc1767.text":"(I'm willing to do a lot if it means (a) I don't have to redefine the entire interator infrastructure from ES and (b) iterator helpers will still work.)"},"ts":1651779653978,"senderName":"TabAtkins","senderId":"@tabatkins:matrix.org","id":"$FihPeT9atiKKHiuPVoxuh29MGH-woHYLPTjHZDWj0u8"},
{"content":{"body":"i think you probably should just make your own iterator thing that inherits from Iterator.prototype (which will make helpers work), just like map/string/set/etc are their own thing","msgtype":"m.text"},"ts":1651779679602,"senderName":"ljharb","senderId":"@ljharb:matrix.org","id":"$HThmFjlT3n4yzTxe1zAnNNw0bq4mYO1pm61JMuAdZhc"},
{"content":{"body":"userland generators do have to deal with it but the problem is that you have to think about it at all","msgtype":"m.text","org.matrix.msc1767.text":"userland generators do have to deal with it but the problem is that you have to think about it at all"},"ts":1651779679867,"senderName":"bakkot","senderId":"@bakkot:matrix.org","id":"$85Q7dM7KgGiO7gqCdsK4_oAoP2hemD38Nst05kfCxTU"},
{"content":{"body":"`.return` just doesn't exist on map iterators","format":"org.matrix.custom.html","formatted_body":"<code>.return</code> just doesn't exist on map iterators","msgtype":"m.text","org.matrix.msc1767.message":[{"body":"`.return` just doesn't exist on map iterators","mimetype":"text/plain"},{"body":"<code>.return</code> just doesn't exist on map iterators","mimetype":"text/html"}]},"ts":1651779684781,"senderName":"bakkot","senderId":"@bakkot:matrix.org","id":"$zZWtIXL-nHV9b2xAyjfgkzJ19Cl8NxJ0vWLfnqmEZJU"},
{"content":{"body":"anyway yeah, I think I would just add a new iterator prototype, like MapIteratorPrototype. that's what the language would do at least.","msgtype":"m.text","org.matrix.msc1767.text":"anyway yeah, I think I would just add a new iterator prototype, like MapIteratorPrototype. that's what the language would do at least."},"ts":1651779692163,"senderName":"bakkot","senderId":"@bakkot:matrix.org","id":"$RzEb8aQ9kgoBIrSbewFgVyO3RmfZCtOQnZ5bpfnSnno"},
{"content":{"body":"you can copy-paste the whole of the MapIteratorPrototype clause; it's actually quite short now","msgtype":"m.text","org.matrix.msc1767.text":"you can copy-paste the whole of the MapIteratorPrototype clause; it's actually quite short now"},"ts":1651779736820,"senderName":"bakkot","senderId":"@bakkot:matrix.org","id":"$K_Ta10Zxlsd9qsV-QAnLwjeLBkWywH_cIL-1HUBM2bw"},
{"content":{"body":"yeah, https://tc39.es/ecma262/#sec-%mapiteratorprototype%-object is doable","msgtype":"m.text","org.matrix.msc1767.text":"yeah, https://tc39.es/ecma262/#sec-%mapiteratorprototype%-object is doable"},"ts":1651779750302,"senderName":"TabAtkins","senderId":"@tabatkins:matrix.org","id":"$Qcu79k2HOShSq2qHmIVNXv_8Ij8XJRM4XBNo3sbbggc"},
{"content":{"body":"okay, sigh, thought i was done with this edit but back into the breach","msgtype":"m.text","org.matrix.msc1767.text":"okay, sigh, thought i was done with this edit but back into the breach"},"ts":1651779771511,"senderName":"TabAtkins","senderId":"@tabatkins:matrix.org","id":"$loPXTWjOVbXC-GIRb_YzwaaKcWOYkmsH2e5YFbB5AT0"},
{"content":{"body":"apologies","msgtype":"m.text","org.matrix.msc1767.text":"apologies"},"ts":1651779915813,"senderName":"bakkot","senderId":"@bakkot:matrix.org","id":"$Bb38pIY24GPnvHIQbuaU3hMJbnxUWRXlMWJ0jqcdjfI"},
{"content":{"body":"So just to be clear, the overriding issue here is that, in practice, the second and third arguments to CreateIteratorFromClosure (giving the brand and prototype) should be unique per call site, more or less?","msgtype":"m.text","org.matrix.msc1767.text":"So just to be clear, the overriding issue here is that, in practice, the second and third arguments to CreateIteratorFromClosure (giving the brand and prototype) should be unique per call site, more or less?"},"ts":1651780370521,"senderName":"TabAtkins","senderId":"@tabatkins:matrix.org","id":"$X35rFFN3DudMseAsXVV_h0kOBbfeG09HfCZ_CQ4Ismo"},
{"content":{"body":"I would put it a different way: if the second and third arguments are _not_ different, you are saying that these two things are actually the same thing, even though they have different behavior, and you should be really sure you want that","format":"org.matrix.custom.html","formatted_body":"I would put it a different way: if the second and third arguments are <em>not</em> different, you are saying that these two things are actually the same thing, even though they have different behavior, and you should be really sure you want that","msgtype":"m.text","org.matrix.msc1767.message":[{"body":"I would put it a different way: if the second and third arguments are _not_ different, you are saying that these two things are actually the same thing, even though they have different behavior, and you should be really sure you want that","mimetype":"text/plain"},{"body":"I would put it a different way: if the second and third arguments are <em>not</em> different, you are saying that these two things are actually the same thing, even though they have different behavior, and you should be really sure you want that","mimetype":"text/html"}]},"ts":1651781116569,"senderName":"bakkot","senderId":"@bakkot:matrix.org","id":"$WHF0JJD0MDdP6HBVhgPH0GMgQMpmlLCUTApypu2hDJo"}
]
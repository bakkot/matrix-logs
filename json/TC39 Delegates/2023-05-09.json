[
{"content":{"body":"> <@shuyuguo:matrix.org> i guarantee you adding a check to Array.prototype object lookups will regress speedometer\n\nIs this done by analyzing the creation of, or transition to, a new map that has an JS_ARRAY_TYPE type, or are you talking about patching actual assignments (i.e., to catch code that may not have moved to the optimizing compiler)?","format":"org.matrix.custom.html","formatted_body":"<mx-reply><blockquote><a href=\"https://matrix.to/#/!WgJwmjBNZEXhJnXHXw:matrix.org/$RmdoURPrz0GlnmwaETsc49Ko29zKy5zAhQ1YwXCAhaY?via=matrix.org&via=igalia.com&via=mozilla.org\">In reply to</a> <a href=\"https://matrix.to/#/@shuyuguo:matrix.org\">@shuyuguo:matrix.org</a><br>i guarantee you adding a check to Array.prototype object lookups will regress speedometer</blockquote></mx-reply>Is this done by analyzing the creation of, or transition to, a new map that has an JS_ARRAY_TYPE type, or are you talking about patching actual assignments (i.e., to catch code that may not have moved to the optimizing compiler)?","m.relates_to":{"m.in_reply_to":{"event_id":"$RmdoURPrz0GlnmwaETsc49Ko29zKy5zAhQ1YwXCAhaY"}},"msgtype":"m.text"},"ts":1683670706636,"senderName":"rbuckton","senderId":"@rbuckton:matrix.org","id":"$pIv9jyOsx2jl6iUCbOsNY1wsBhaC10aC3Vi95GWbz3k"},
{"content":{"body":"well, i elided a few thoughts","msgtype":"m.text"},"ts":1683670964497,"senderName":"shu","senderId":"@shuyuguo:matrix.org","id":"$LsMXSGKZR5d2mR2r-MF1VWG5oUq27jExoksZ22W_62M"},
{"content":{"body":"i don't think it's sufficient to just check if e.g. someone added a new property named `group` to `Array.prototype`, because we know unconditional assignment is unproblematic","format":"org.matrix.custom.html","formatted_body":"i don't think it's sufficient to just check if e.g. someone added a new property named <code>group</code> to <code>Array.prototype</code>, because we know unconditional assignment is unproblematic","msgtype":"m.text"},"ts":1683671009218,"senderName":"shu","senderId":"@shuyuguo:matrix.org","id":"$rKsKSZk0HTUkrMyzBfbq8WZro7UuTuuJEe5_znqJCbY"},
{"content":{"body":"so to add a more nuanced check that's a better measure of whether there's a problematic assignment to a particular `Array.prototype` name:\n\n1. i don't know how to write that use counter\n2. it's probably spread through enough parts of the code that adding that many branches is slow?","format":"org.matrix.custom.html","formatted_body":"<p>so to add a more nuanced check that's a better measure of whether there's a problematic assignment to a particular <code>Array.prototype</code> name:</p>\n<ol>\n<li>i don't know how to write that use counter</li>\n<li>it's probably spread through enough parts of the code that adding that many branches is slow?</li>\n</ol>\n","msgtype":"m.text"},"ts":1683671055807,"senderName":"shu","senderId":"@shuyuguo:matrix.org","id":"$tWTPyE0Ok2Q7CnXl0UNUiRTLr5S-P6N2xtc1TyAULAk"},
{"content":{"body":"we _could_ probably add a check just to see if someone added a new property named `group` to Array.prototype but i'd need to audit for all the places where we do that","format":"org.matrix.custom.html","formatted_body":"we <em>could</em> probably add a check just to see if someone added a new property named <code>group</code> to Array.prototype but i'd need to audit for all the places where we do that","msgtype":"m.text"},"ts":1683671125388,"senderName":"shu","senderId":"@shuyuguo:matrix.org","id":"$MheHfkgsKLDs8ql2nb0DoOM_kMj7b9v6HRqys8GZWGQ"},
{"content":{"body":"the actual problem with `group` was triggered by someone relying on the _absence_ of a property named `group` on array objects, IIRC","format":"org.matrix.custom.html","formatted_body":"the actual problem with <code>group</code> was triggered by someone relying on the <em>absence</em> of a property named <code>group</code> on array objects, IIRC","msgtype":"m.text"},"ts":1683671530529,"senderName":"bakkot","senderId":"@bakkot:matrix.org","id":"$c3kCAVSxwHGPOSFTwtXEBk2LzehQZf7qsEAOQYbDDOE"},
{"content":{"body":"so you'd need a use counter for lookup, not just assignment","msgtype":"m.text"},"ts":1683671546040,"senderName":"bakkot","senderId":"@bakkot:matrix.org","id":"$TN27Gn8Yu6et7pPabAGXthZSzAiX9XPMABobkR2B3e0"},
{"content":{"body":"right, that's what i obliquely referred to as \"lookup\"","msgtype":"m.text"},"ts":1683671550766,"senderName":"shu","senderId":"@shuyuguo:matrix.org","id":"$Qc8U95tDxUYgFaoaI6092xgzEEzqgChHKp0twSvSshg"},
{"content":{"body":"i can imagine a use counter \"through time\" like, if i looked up 'group' then assigned to 'group', then maybe we bump the counter","msgtype":"m.text"},"ts":1683671578189,"senderName":"shu","senderId":"@shuyuguo:matrix.org","id":"$Nny3ykq-xCyqK5GHSq8psXGjvSo0mefc85R9H20VTAU"},
{"content":{"body":"but there is just no way i can add a branch to every lookup","msgtype":"m.text"},"ts":1683671585959,"senderName":"shu","senderId":"@shuyuguo:matrix.org","id":"$XlcL9E0doZsrBS7k0aIQR3MaMl4BNa00GMHLzlhQZQ8"},
{"content":{"body":"> <@bakkot:matrix.org> the actual problem with `group` was triggered by someone relying on the _absence_ of a property named `group` on array objects, IIRC\n\nBut did they then still assign to it, or just test for its presence and that's it?","format":"org.matrix.custom.html","formatted_body":"<mx-reply><blockquote><a href=\"https://matrix.to/#/!WgJwmjBNZEXhJnXHXw:matrix.org/$c3kCAVSxwHGPOSFTwtXEBk2LzehQZf7qsEAOQYbDDOE?via=matrix.org&via=igalia.com&via=mozilla.org\">In reply to</a> <a href=\"https://matrix.to/#/@bakkot:matrix.org\">@bakkot:matrix.org</a><br>the actual problem with <code>group</code> was triggered by someone relying on the <em>absence</em> of a property named <code>group</code> on array objects, IIRC</blockquote></mx-reply>But did they then still assign to it, or just test for its presence and that's it?","m.relates_to":{"m.in_reply_to":{"event_id":"$c3kCAVSxwHGPOSFTwtXEBk2LzehQZf7qsEAOQYbDDOE"}},"msgtype":"m.text"},"ts":1683671644412,"senderName":"rbuckton","senderId":"@rbuckton:matrix.org","id":"$bHlydovyTX2OnqUiTP7odiOfFabF1gAvMIlqUNdhT_c"},
{"content":{"body":"just test for presence","msgtype":"m.text"},"ts":1683671651032,"senderName":"bakkot","senderId":"@bakkot:matrix.org","id":"$X-FHHAM7qBgaowtVVGoUSWhUOW0THeIz_W9L7f0jclo"},
{"content":{"body":"oh they didn't even assign to it?","msgtype":"m.text"},"ts":1683671662102,"senderName":"shu","senderId":"@shuyuguo:matrix.org","id":"$s8PK47v4YvzQWO5fl0ImH8ioPXH-a6lzfPozM9rIVi8"},
{"content":{"body":"they were using it as a type discriminant","msgtype":"m.text"},"ts":1683671662758,"senderName":"bakkot","senderId":"@bakkot:matrix.org","id":"$aSpu-Rn27ueVYlx22JhvoumUnlRNVp_ysFBFYpqCCPQ"},
{"content":{"body":"word","msgtype":"m.text"},"ts":1683671677739,"senderName":"shu","senderId":"@shuyuguo:matrix.org","id":"$UAvCFJseiSzI0bEBa9kjoK5qnh6y7uhOZDhXczCg4qA"},
{"content":{"body":"ain't nothing i can do ","msgtype":"m.text"},"ts":1683671679824,"senderName":"shu","senderId":"@shuyuguo:matrix.org","id":"$bW3bvg_VIDvMDp9fge5qumm1d1hA9D67Cn9kv-FS3nk"}
]
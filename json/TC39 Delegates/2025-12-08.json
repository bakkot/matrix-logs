[
{"content":{"body":"yeah I've been wondering about ways to defang Function.prototype.constructor for a while","msgtype":"m.text"},"ts":1765174753553,"senderName":"snek","senderId":"@devsnek:matrix.org","id":"$Vse9KcVBF0NZU-LK8ElQwv5H9vpvncwWSnZbhyHQS6k"},
{"content":{"body":"would be neat if references in js engines could be poisoned somehow","msgtype":"m.text"},"ts":1765174772672,"senderName":"snek","senderId":"@devsnek:matrix.org","id":"$AAYYwrXSf6ImE96G22v8Y7Vl874FSuS83QJiy0tkyMU"},
{"content":{"body":"maybe being able to see whether a call to Function is \"direct\", like with eval, could be beneficial","msgtype":"m.text"},"ts":1765175034587,"senderName":"snek","senderId":"@devsnek:matrix.org","id":"$vDv5kVtCEs5NmSDsMwvd45mfnd7KuPJeD56ZoO7akKg"},
{"content":{"body":"Trusted types could be some part of the answer but obviously as opt-in as CSPs or the all-or-nothing flag in nodejs to disallow string eval.","m.mentions":{},"msgtype":"m.text"},"ts":1765207059662,"senderName":"Jan Olaf Martin","senderId":"@jkrems:matrix.org","id":"$tJUe3jZPn6c4rQ_ar98I-i1sD-emW4znIVS1q70jRR4"},
{"content":{"body":"maybe not a common use case, but if code is only using the Function constructor to feature check syntax - that only requires the constructor - and doesn't need to call the actual function AFAIK","m.mentions":{},"msgtype":"m.text"},"ts":1765207366972,"senderName":"Ashley Claymore","senderId":"@aclaymore:matrix.org","id":"$SBAmsgS32P4fm1htDUAkj_a2AS18JEpEeJF6U6oalJA"},
{"content":{"body":"as a slightly less restrictive form of dissalow-eval that still prevents these exploits","m.mentions":{},"msgtype":"m.text"},"ts":1765207409899,"senderName":"Ashley Claymore","senderId":"@aclaymore:matrix.org","id":"$J_W9jBtQsRYSBIVbmVJDP8DH064Ws-Xxiyx5reHLscI"},
{"content":{"body":"https://github.com/tc39/proposal-symbol-proto did discuss defanging Function.prototype.constructor as well","m.mentions":{},"msgtype":"m.text"},"ts":1765208014800,"senderName":"bakkot","senderId":"@bakkot:matrix.org","id":"$a0ekUnXDJB8_EymRyZF1opf5pNmtAN3dC_x-JiBWttM"},
{"content":{"body":"though I don't think its ideas are actually workable as written","m.mentions":{},"msgtype":"m.text"},"ts":1765208062706,"senderName":"bakkot","senderId":"@bakkot:matrix.org","id":"$s0IbSXcWYHRrULjD-1Qju4ebDw97rgrp32tys1mlVoY"},
{"content":{"body":"I do kind of enjoy the idea of saying that you can only access `Function.prototype.constructor` by literal `fn.constructor` syntax, not `fn['constructor']`, even though that would be a crazy violation of the language invariants","format":"org.matrix.custom.html","formatted_body":"I do kind of enjoy the idea of saying that you can only access <code>Function.prototype.constructor</code> by literal <code>fn.constructor</code> syntax, not <code>fn['constructor']</code>, even though that would be a crazy violation of the language invariants","m.mentions":{},"msgtype":"m.text"},"ts":1765208148994,"senderName":"bakkot","senderId":"@bakkot:matrix.org","id":"$URfNC6l28rstnv7tdDcOOoo1M4DEFATvACasjzzXA2k"},
{"content":{"body":"we can just say that it's kinda like `{ __proto__: null }` and `{[\"__proto__\"]: null }` being different and runway","format":"org.matrix.custom.html","formatted_body":"we can just say that it's kinda like <code>{ __proto__: null }</code> and <code>{[\"__proto__\"]: null }</code> being different and runway","m.mentions":{},"msgtype":"m.text"},"ts":1765208774598,"senderName":"Ashley Claymore","senderId":"@aclaymore:matrix.org","id":"$U-KoHbHDO8GElZO0T9KIKYgMn-t-NXgk76fsppFPhKQ"},
{"content":{"body":"> <@devsnek:matrix.org> yeah I've been wondering about ways to defang Function.prototype.constructor for a while\n\nDoes any legit code actually rely on `Function.prototype.constructor` being functional, or even matching `Function`? Why can't we just change it with something that doesn't evaluate? Possibly opt-in","format":"org.matrix.custom.html","formatted_body":"<mx-reply><blockquote><a href=\"https://matrix.to/#/!WgJwmjBNZEXhJnXHXw:matrix.org/$Vse9KcVBF0NZU-LK8ElQwv5H9vpvncwWSnZbhyHQS6k?via=matrix.org&via=mozilla.org&via=igalia.com\">In reply to</a> <a href=\"https://matrix.to/#/@devsnek:matrix.org\">@devsnek:matrix.org</a><br />yeah I've been wondering about ways to defang Function.prototype.constructor for a while</blockquote></mx-reply>Does any legit code actually rely on <code>Function.prototype.constructor</code> being functional, or even matching <code>Function</code>? Why can't we just change it with something that doesn't evaluate? Possibly opt-in","m.relates_to":{"m.in_reply_to":{"event_id":"$Vse9KcVBF0NZU-LK8ElQwv5H9vpvncwWSnZbhyHQS6k"}},"msgtype":"m.text"},"ts":1765218366917,"senderName":"Mathieu Hofman","senderId":"@mhofman:matrix.org","id":"$SsyTBJY47By0W6kT5viJQ-eFI4csGaX_WjfVcBVozqs"},
{"content":{"body":"> <@aclaymore:matrix.org> we can just say that it's kinda like `{ __proto__: null }` and `{[\"__proto__\"]: null }` being different and runway\n\nI think there's a difference between declaration and property access. On the access side, only `eval` behaves strangely. ","format":"org.matrix.custom.html","formatted_body":"<mx-reply><blockquote><a href=\"https://matrix.to/#/!WgJwmjBNZEXhJnXHXw:matrix.org/$U-KoHbHDO8GElZO0T9KIKYgMn-t-NXgk76fsppFPhKQ?via=matrix.org&via=mozilla.org&via=igalia.com\">In reply to</a> <a href=\"https://matrix.to/#/@aclaymore:matrix.org\">@aclaymore:matrix.org</a><br />we can just say that it's kinda like <code>{ __proto__: null }</code> and <code>{[\"__proto__\"]: null }</code> being different and runway</blockquote></mx-reply>I think there's a difference between declaration and property access. On the access side, only <code>eval</code> behaves strangely.","m.relates_to":{"m.in_reply_to":{"event_id":"$U-KoHbHDO8GElZO0T9KIKYgMn-t-NXgk76fsppFPhKQ"}},"msgtype":"m.text"},"ts":1765218457915,"senderName":"Mathieu Hofman","senderId":"@mhofman:matrix.org","id":"$WEApeNsKGTHNrVF5ji6JWrWOxZPhMO5qFGOyGB19dbg"},
{"content":{"body":"* I think there's a difference between declaration and reference access. On the access side, only \neval behaves strangely.","m.new_content":{"body":"> <@aclaymore:matrix.org> we can just say that it's kinda like `{ __proto__: null }` and `{[\"__proto__\"]: null }` being different and runway\n\nI think there's a difference between declaration and reference access. On the access side, only \neval behaves strangely.","format":"org.matrix.custom.html","formatted_body":"<mx-reply><blockquote><a href=\"https://matrix.to/#/!WgJwmjBNZEXhJnXHXw:matrix.org/$U-KoHbHDO8GElZO0T9KIKYgMn-t-NXgk76fsppFPhKQ?via=matrix.org&via=mozilla.org&via=igalia.com\">In reply to</a> <a href=\"https://matrix.to/#/@aclaymore:matrix.org\">Ashley Claymore</a><br />we can just say that it's kinda like <code>{ __proto__: null }</code> and <code>{[\"__proto__\"]: null }</code> being different and runway</blockquote></mx-reply>I think there's a difference between declaration and reference access. On the access side, only<br />eval behaves strangely.","msgtype":"m.text"},"m.relates_to":{"event_id":"$WEApeNsKGTHNrVF5ji6JWrWOxZPhMO5qFGOyGB19dbg","rel_type":"m.replace"},"msgtype":"m.text"},"ts":1765218485643,"senderName":"Mathieu Hofman","senderId":"@mhofman:matrix.org","id":"$IVeHGAre_Dgvif52Oha1WGxPV1qgng7djsYy7sF5ooo"},
{"content":{"body":"make it a function that's the same as the Function constructor but param lists must be simple and the body is prefixed with `return`?","format":"org.matrix.custom.html","formatted_body":"make it a function that&#39;s the same as the Function constructor but param lists must be simple and the body is prefixed with <code data-md=\"`\">return</code>?","m.mentions":{"user_ids":["@mhofman:matrix.org"]},"m.relates_to":{"m.in_reply_to":{"event_id":"$SsyTBJY47By0W6kT5viJQ-eFI4csGaX_WjfVcBVozqs"}},"msgtype":"m.text"},"ts":1765218715987,"senderName":"Michael Ficarra","senderId":"@michaelficarra:matrix.org","id":"$WZ0D110-NxR6cnwzPTegfIleEQM4ekodx77K7WUmgro"},
{"content":{"body":"In HardenedJS, we replace Function.prototype.constructor with an exception thrower. Users of HardenedJS do sometimes run into libraries that are not ecosystem compatible, but I don’t recall any cases where this was a relevant hindrance. It doesn’t break `instanceof`. Nobody seems to legitimately depend on `(() => {}).constructor(code)` to do what is much more easily accomplished with `Function(code)`.","format":"org.matrix.custom.html","formatted_body":"In HardenedJS, we replace Function.prototype.constructor with an exception thrower. Users of HardenedJS do sometimes run into libraries that are not ecosystem compatible, but I don’t recall any cases where this was a relevant hindrance. It doesn’t break <code>instanceof</code>. Nobody seems to legitimately depend on <code>(() =&gt; {}).constructor(code)</code> to do what is much more easily accomplished with <code>Function(code)</code>.","m.mentions":{"user_ids":["@devsnek:matrix.org"]},"m.relates_to":{"m.in_reply_to":{"event_id":"$AAYYwrXSf6ImE96G22v8Y7Vl874FSuS83QJiy0tkyMU"}},"msgtype":"m.text"},"ts":1765220138626,"senderName":"kriskowal","senderId":"@kriskowal:aelf.land","id":"$1xUl0mEUSSqleLxlKbcYDdifc2TcNgqqz2yTaMDchp0"},
{"content":{"body":"lots of stuff depends on it matching; being functional is much rarer https://github.com/search?q=%28lang%3Ajs+OR+lang%3Ats%29+%22.constructor+%3D%3D%3D+Function%22&type=code","m.mentions":{"user_ids":["@mhofman:matrix.org"]},"m.relates_to":{"m.in_reply_to":{"event_id":"$SsyTBJY47By0W6kT5viJQ-eFI4csGaX_WjfVcBVozqs"}},"msgtype":"m.text"},"ts":1765221395772,"senderName":"bakkot","senderId":"@bakkot:matrix.org","id":"$RGKHN93VgT-UyIL0AEC9mOEty8V31AY8aAH7rrUF0Qw"},
{"content":{"body":"has there been a proposal for like a `parses(src: string): boolean` method people could use instead of checking if calling `Function` throws?","format":"org.matrix.custom.html","formatted_body":"has there been a proposal for like a <code>parses(src: string): boolean</code> method people could use instead of checking if calling <code>Function</code> throws?","m.mentions":{},"msgtype":"m.text"},"ts":1765221579079,"senderName":"bakkot","senderId":"@bakkot:matrix.org","id":"$xmolgZBmO-xk3eQy_X9hFoNbzJ-FP95B6i-3xFYiSek"},
{"content":{"body":"so that people could use it in no-eval contexts","m.mentions":{},"msgtype":"m.text"},"ts":1765221579662,"senderName":"bakkot","senderId":"@bakkot:matrix.org","id":"$LeKsz5winy4b2Xr3RxW1aW9_q6HzmcAJZZC5l5bUkow"},
{"content":{"body":"I guess ideally a `parses(src: string, asModule: boolean)`","format":"org.matrix.custom.html","formatted_body":"I guess ideally a <code>parses(src: string, asModule: boolean)</code>","m.mentions":{},"msgtype":"m.text"},"ts":1765221593989,"senderName":"bakkot","senderId":"@bakkot:matrix.org","id":"$l-5453CpfBQMSgiCmZQ1NhQX23nidEI_m2i_NwipQOo"},
{"content":{"body":"what I was suggesting was relaxing no-eval to throw when the code is actually evaluated - rather than when the function is constructed.\nassuming the goal was to support existing code.","format":"org.matrix.custom.html","formatted_body":"what I was suggesting was relaxing no-eval to throw when the code is actually evaluated - rather than when the function is constructed.<br />assuming the goal was to support existing code.","msgtype":"m.text"},"ts":1765230899070,"senderName":"Ashley Claymore","senderId":"@aclaymore:matrix.org","id":"$t8V4CUXSkb7l89JBFuno5_3iGEUVWvW6PMuyPZYb2X4"}
]
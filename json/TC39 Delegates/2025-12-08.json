[
{"content":{"body":"yeah I've been wondering about ways to defang Function.prototype.constructor for a while","msgtype":"m.text"},"ts":1765174753553,"senderName":"snek","senderId":"@devsnek:matrix.org","id":"$Vse9KcVBF0NZU-LK8ElQwv5H9vpvncwWSnZbhyHQS6k"},
{"content":{"body":"would be neat if references in js engines could be poisoned somehow","msgtype":"m.text"},"ts":1765174772672,"senderName":"snek","senderId":"@devsnek:matrix.org","id":"$AAYYwrXSf6ImE96G22v8Y7Vl874FSuS83QJiy0tkyMU"},
{"content":{"body":"maybe being able to see whether a call to Function is \"direct\", like with eval, could be beneficial","msgtype":"m.text"},"ts":1765175034587,"senderName":"snek","senderId":"@devsnek:matrix.org","id":"$vDv5kVtCEs5NmSDsMwvd45mfnd7KuPJeD56ZoO7akKg"},
{"content":{"body":"Trusted types could be some part of the answer but obviously as opt-in as CSPs or the all-or-nothing flag in nodejs to disallow string eval.","m.mentions":{},"msgtype":"m.text"},"ts":1765207059662,"senderName":"Jan Olaf Martin","senderId":"@jkrems:matrix.org","id":"$tJUe3jZPn6c4rQ_ar98I-i1sD-emW4znIVS1q70jRR4"},
{"content":{"body":"maybe not a common use case, but if code is only using the Function constructor to feature check syntax - that only requires the constructor - and doesn't need to call the actual function AFAIK","m.mentions":{},"msgtype":"m.text"},"ts":1765207366972,"senderName":"Ashley Claymore","senderId":"@aclaymore:matrix.org","id":"$SBAmsgS32P4fm1htDUAkj_a2AS18JEpEeJF6U6oalJA"},
{"content":{"body":"as a slightly less restrictive form of dissalow-eval that still prevents these exploits","m.mentions":{},"msgtype":"m.text"},"ts":1765207409899,"senderName":"Ashley Claymore","senderId":"@aclaymore:matrix.org","id":"$J_W9jBtQsRYSBIVbmVJDP8DH064Ws-Xxiyx5reHLscI"},
{"content":{"body":"https://github.com/tc39/proposal-symbol-proto did discuss defanging Function.prototype.constructor as well","m.mentions":{},"msgtype":"m.text"},"ts":1765208014800,"senderName":"bakkot","senderId":"@bakkot:matrix.org","id":"$a0ekUnXDJB8_EymRyZF1opf5pNmtAN3dC_x-JiBWttM"},
{"content":{"body":"though I don't think its ideas are actually workable as written","m.mentions":{},"msgtype":"m.text"},"ts":1765208062706,"senderName":"bakkot","senderId":"@bakkot:matrix.org","id":"$s0IbSXcWYHRrULjD-1Qju4ebDw97rgrp32tys1mlVoY"},
{"content":{"body":"I do kind of enjoy the idea of saying that you can only access `Function.prototype.constructor` by literal `fn.constructor` syntax, not `fn['constructor']`, even though that would be a crazy violation of the language invariants","format":"org.matrix.custom.html","formatted_body":"I do kind of enjoy the idea of saying that you can only access <code>Function.prototype.constructor</code> by literal <code>fn.constructor</code> syntax, not <code>fn['constructor']</code>, even though that would be a crazy violation of the language invariants","m.mentions":{},"msgtype":"m.text"},"ts":1765208148994,"senderName":"bakkot","senderId":"@bakkot:matrix.org","id":"$URfNC6l28rstnv7tdDcOOoo1M4DEFATvACasjzzXA2k"},
{"content":{"body":"we can just say that it's kinda like `{ __proto__: null }` and `{[\"__proto__\"]: null }` being different and runway","format":"org.matrix.custom.html","formatted_body":"we can just say that it's kinda like <code>{ __proto__: null }</code> and <code>{[\"__proto__\"]: null }</code> being different and runway","m.mentions":{},"msgtype":"m.text"},"ts":1765208774598,"senderName":"Ashley Claymore","senderId":"@aclaymore:matrix.org","id":"$U-KoHbHDO8GElZO0T9KIKYgMn-t-NXgk76fsppFPhKQ"},
{"content":{"body":"> <@devsnek:matrix.org> yeah I've been wondering about ways to defang Function.prototype.constructor for a while\n\nDoes any legit code actually rely on `Function.prototype.constructor` being functional, or even matching `Function`? Why can't we just change it with something that doesn't evaluate? Possibly opt-in","format":"org.matrix.custom.html","formatted_body":"<mx-reply><blockquote><a href=\"https://matrix.to/#/!WgJwmjBNZEXhJnXHXw:matrix.org/$Vse9KcVBF0NZU-LK8ElQwv5H9vpvncwWSnZbhyHQS6k?via=matrix.org&via=mozilla.org&via=igalia.com\">In reply to</a> <a href=\"https://matrix.to/#/@devsnek:matrix.org\">@devsnek:matrix.org</a><br />yeah I've been wondering about ways to defang Function.prototype.constructor for a while</blockquote></mx-reply>Does any legit code actually rely on <code>Function.prototype.constructor</code> being functional, or even matching <code>Function</code>? Why can't we just change it with something that doesn't evaluate? Possibly opt-in","m.relates_to":{"m.in_reply_to":{"event_id":"$Vse9KcVBF0NZU-LK8ElQwv5H9vpvncwWSnZbhyHQS6k"}},"msgtype":"m.text"},"ts":1765218366917,"senderName":"Mathieu Hofman","senderId":"@mhofman:matrix.org","id":"$SsyTBJY47By0W6kT5viJQ-eFI4csGaX_WjfVcBVozqs"},
{"content":{"body":"> <@aclaymore:matrix.org> we can just say that it's kinda like `{ __proto__: null }` and `{[\"__proto__\"]: null }` being different and runway\n\nI think there's a difference between declaration and property access. On the access side, only `eval` behaves strangely. ","format":"org.matrix.custom.html","formatted_body":"<mx-reply><blockquote><a href=\"https://matrix.to/#/!WgJwmjBNZEXhJnXHXw:matrix.org/$U-KoHbHDO8GElZO0T9KIKYgMn-t-NXgk76fsppFPhKQ?via=matrix.org&via=mozilla.org&via=igalia.com\">In reply to</a> <a href=\"https://matrix.to/#/@aclaymore:matrix.org\">@aclaymore:matrix.org</a><br />we can just say that it's kinda like <code>{ __proto__: null }</code> and <code>{[\"__proto__\"]: null }</code> being different and runway</blockquote></mx-reply>I think there's a difference between declaration and property access. On the access side, only <code>eval</code> behaves strangely.","m.relates_to":{"m.in_reply_to":{"event_id":"$U-KoHbHDO8GElZO0T9KIKYgMn-t-NXgk76fsppFPhKQ"}},"msgtype":"m.text"},"ts":1765218457915,"senderName":"Mathieu Hofman","senderId":"@mhofman:matrix.org","id":"$WEApeNsKGTHNrVF5ji6JWrWOxZPhMO5qFGOyGB19dbg"},
{"content":{"body":"* I think there's a difference between declaration and reference access. On the access side, only \neval behaves strangely.","m.new_content":{"body":"> <@aclaymore:matrix.org> we can just say that it's kinda like `{ __proto__: null }` and `{[\"__proto__\"]: null }` being different and runway\n\nI think there's a difference between declaration and reference access. On the access side, only \neval behaves strangely.","format":"org.matrix.custom.html","formatted_body":"<mx-reply><blockquote><a href=\"https://matrix.to/#/!WgJwmjBNZEXhJnXHXw:matrix.org/$U-KoHbHDO8GElZO0T9KIKYgMn-t-NXgk76fsppFPhKQ?via=matrix.org&via=mozilla.org&via=igalia.com\">In reply to</a> <a href=\"https://matrix.to/#/@aclaymore:matrix.org\">Ashley Claymore</a><br />we can just say that it's kinda like <code>{ __proto__: null }</code> and <code>{[\"__proto__\"]: null }</code> being different and runway</blockquote></mx-reply>I think there's a difference between declaration and reference access. On the access side, only<br />eval behaves strangely.","msgtype":"m.text"},"m.relates_to":{"event_id":"$WEApeNsKGTHNrVF5ji6JWrWOxZPhMO5qFGOyGB19dbg","rel_type":"m.replace"},"msgtype":"m.text"},"ts":1765218485643,"senderName":"Mathieu Hofman","senderId":"@mhofman:matrix.org","id":"$IVeHGAre_Dgvif52Oha1WGxPV1qgng7djsYy7sF5ooo"}
]
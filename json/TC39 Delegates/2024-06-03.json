[
{"content":{"body":"If we seriously have extra time on the agenda, there are a couple wild open discussion topics which might be fun. Emoji-react something if you're interested in them. (Apologies for not raising this before the agenda deadline.)","m.mentions":{},"msgtype":"m.text"},"ts":1717409984481,"senderName":"littledan","senderId":"@littledan:matrix.org","id":"$wze4NORaJ4Y3ZZ5iFKm4qOuOTeaV0LjqTPKQi15hlJU"},
{"content":{"body":"Cancellable promises","m.mentions":{},"msgtype":"m.text"},"ts":1717409988061,"senderName":"littledan","senderId":"@littledan:matrix.org","id":"$NuWaj5MS7IMvyQhoF19Pyw1BNzpHEXDi0FzaI9oXuSQ"},
{"content":{"body":"Private name declarations outside of classes","m.mentions":{},"msgtype":"m.text"},"ts":1717410002708,"senderName":"littledan","senderId":"@littledan:matrix.org","id":"$NQAx4vx3n94f3r9XdnB9OZTcOpjHwrIJffP8Qk9y_lw"},
{"content":{"body":"> <@littledan:matrix.org> Cancellable promises\n\nWould it make sense to discuss this on https://github.com/tc39/proposal-cancellation? ","format":"org.matrix.custom.html","formatted_body":"<mx-reply><blockquote><a href=\"https://matrix.to/#/!WgJwmjBNZEXhJnXHXw:matrix.org/$NuWaj5MS7IMvyQhoF19Pyw1BNzpHEXDi0FzaI9oXuSQ?via=matrix.org&via=mozilla.org&via=igalia.com\">In reply to</a> <a href=\"https://matrix.to/#/@littledan:matrix.org\">@littledan:matrix.org</a><br />Cancellable promises</blockquote></mx-reply>Would it make sense to discuss this on https://github.com/tc39/proposal-cancellation?","m.relates_to":{"m.in_reply_to":{"event_id":"$NuWaj5MS7IMvyQhoF19Pyw1BNzpHEXDi0FzaI9oXuSQ"}},"msgtype":"m.text"},"ts":1717410895090,"senderName":"rbuckton","senderId":"@rbuckton:matrix.org","id":"$9C7pEP5G1hXuAuEGI9ryV8Vwurxd8IGYLq85jL0mm10"},
{"content":{"body":"> <@rbuckton:matrix.org> Would it make sense to discuss this on https://github.com/tc39/proposal-cancellation?\n\noh thanks that gives a lot of helpful references to review. I have been thinking about this area again in the context of AsyncContext, which gives us more options for propagating the cancel token.","format":"org.matrix.custom.html","formatted_body":"<mx-reply><blockquote><a href=\"https://matrix.to/#/!WgJwmjBNZEXhJnXHXw:matrix.org/$9C7pEP5G1hXuAuEGI9ryV8Vwurxd8IGYLq85jL0mm10?via=matrix.org&via=mozilla.org&via=igalia.com\">In reply to</a> <a href=\"https://matrix.to/#/@rbuckton:matrix.org\">@rbuckton:matrix.org</a><br>Would it make sense to discuss this on https://github.com/tc39/proposal-cancellation?</blockquote></mx-reply>oh thanks that gives a lot of helpful references to review. I have been thinking about this area again in the context of AsyncContext, which gives us more options for propagating the cancel token.","m.mentions":{"user_ids":["@rbuckton:matrix.org"]},"m.relates_to":{"m.in_reply_to":{"event_id":"$9C7pEP5G1hXuAuEGI9ryV8Vwurxd8IGYLq85jL0mm10"}},"msgtype":"m.text"},"ts":1717411027446,"senderName":"littledan","senderId":"@littledan:matrix.org","id":"$3vaKfNh2JD_TsUF_QEvYVOAjCTMhspxp_u8_Zq8Rj5s"},
{"content":{"body":"also AbortSignal.any is a very helpful, core capability in this area, which I don't think was there last time we discussed this","m.mentions":{},"msgtype":"m.text"},"ts":1717411064109,"senderName":"littledan","senderId":"@littledan:matrix.org","id":"$THkWwSHcS2KtM3Su9U-Omg5Bd3cNSao_LuIIuYMopRQ"},
{"content":{"body":"(I guess it basically enables what your previous proposal's `new CancellationTokenSource(linkedTokens?)` does, roughly)","format":"org.matrix.custom.html","formatted_body":"(I guess it basically enables what your previous proposal's <code>new CancellationTokenSource(linkedTokens?)</code> does, roughly)","m.mentions":{},"msgtype":"m.text"},"ts":1717411219801,"senderName":"littledan","senderId":"@littledan:matrix.org","id":"$-RX9q4fEJEgRqx7FXCxbckdDiabs8geDwTDfCVoGDFs"},
{"content":{"body":"Unfortunately, since `AbortSignal` is outside the purview of TC39 the best forum for that may be WHATWG. ","format":"org.matrix.custom.html","formatted_body":"Unfortunately, since <code>AbortSignal</code> is outside the purview of TC39 the best forum for that may be WHATWG.","msgtype":"m.text"},"ts":1717411596415,"senderName":"rbuckton","senderId":"@rbuckton:matrix.org","id":"$Ndftk7yg301jeJFWOdbWpPu_uCmHyvlaGI046S2n78s"},
{"content":{"body":"Though I've long held that cancellation graphs like that are very valuable","msgtype":"m.text"},"ts":1717411647488,"senderName":"rbuckton","senderId":"@rbuckton:matrix.org","id":"$wRaPbIquUpVW0Ig0wXdODBHO_blgL0bMsLdtkPwfcYY"},
{"content":{"body":"We'll definitely have to collaborate between standards groups to make this happen, but I think you were right to bring this to TC39, and believe we can make some progress together.","m.mentions":{},"msgtype":"m.text"},"ts":1717411670220,"senderName":"littledan","senderId":"@littledan:matrix.org","id":"$_LTL__2t1hFb-r0ufeLe5d0eLgvLR5-chD_wLrP3gZI"},
{"content":{"body":"also if we want integration with async/await (e.g., all awaits are implicitly racing with the cancel token), something would need to happen in TC39","m.mentions":{},"msgtype":"m.text"},"ts":1717411796372,"senderName":"littledan","senderId":"@littledan:matrix.org","id":"$IwLIcnrVqGbPDNLx-zElYW3ARuhEwJyHbHpfCGA2f0Q"},
{"content":{"body":"I also agree that AsyncContext would have been the way to traffic a cancellation token in the way Yehuda wanted, so long as there was a way to suppress async context flow when needed","msgtype":"m.text"},"ts":1717411801638,"senderName":"rbuckton","senderId":"@rbuckton:matrix.org","id":"$wM6R1E3aZ7Yd_pyvkdGC5dc5GQM_mZSWreNDN8KQpV0"},
{"content":{"body":"> <@rbuckton:matrix.org> I also agree that AsyncContext would have been the way to traffic a cancellation token in the way Yehuda wanted, so long as there was a way to suppress async context flow when needed\n\ncould you say more about this suppression use case?","format":"org.matrix.custom.html","formatted_body":"<mx-reply><blockquote><a href=\"https://matrix.to/#/!WgJwmjBNZEXhJnXHXw:matrix.org/$wM6R1E3aZ7Yd_pyvkdGC5dc5GQM_mZSWreNDN8KQpV0?via=matrix.org&via=mozilla.org&via=igalia.com\">In reply to</a> <a href=\"https://matrix.to/#/@rbuckton:matrix.org\">@rbuckton:matrix.org</a><br>I also agree that AsyncContext would have been the way to traffic a cancellation token in the way Yehuda wanted, so long as there was a way to suppress async context flow when needed</blockquote></mx-reply>could you say more about this suppression use case?","m.mentions":{"user_ids":["@rbuckton:matrix.org"]},"m.relates_to":{"m.in_reply_to":{"event_id":"$wM6R1E3aZ7Yd_pyvkdGC5dc5GQM_mZSWreNDN8KQpV0"}},"msgtype":"m.text"},"ts":1717411830594,"senderName":"littledan","senderId":"@littledan:matrix.org","id":"$FBsyu-f1-wH19HnjJxkC8XYY6vudgRIujyiFnObk_bo"},
{"content":{"body":"I mean, requirements for it","m.mentions":{},"msgtype":"m.text"},"ts":1717411841467,"senderName":"littledan","senderId":"@littledan:matrix.org","id":"$ZwtGtDeFY83TsCglRiJRR5K8IT7M20MTIzb9HwNBH78"},
{"content":{"body":"The only avenue given to us at this point is a host hook. ","format":"org.matrix.custom.html","formatted_body":"The only avenue given to us at this point is a host hook.","msgtype":"m.text"},"ts":1717411847027,"senderName":"rbuckton","senderId":"@rbuckton:matrix.org","id":"$UL00u1v3yLFQkocwvKpu8wSJDcUQJvXIo0KUPS0lGdY"},
{"content":{"body":"IIRC wanting the cancel token to be implicitly propagated was a goal of Domenic's as well","m.mentions":{},"msgtype":"m.text"},"ts":1717411876521,"senderName":"littledan","senderId":"@littledan:matrix.org","id":"$6xEXER19uzI-FuhfvRuuICFcpnba7VlzcBBqmdzz5Ag"},
{"content":{"body":"> <@littledan:matrix.org> could you say more about this suppression use case?\n\nSometimes you *don't* want to propagate the token.","format":"org.matrix.custom.html","formatted_body":"<mx-reply><blockquote><a href=\"https://matrix.to/#/!WgJwmjBNZEXhJnXHXw:matrix.org/$FBsyu-f1-wH19HnjJxkC8XYY6vudgRIujyiFnObk_bo?via=matrix.org&via=mozilla.org&via=igalia.com\">In reply to</a> <a href=\"https://matrix.to/#/@littledan:matrix.org\">@littledan:matrix.org</a><br>could you say more about this suppression use case?</blockquote></mx-reply>Sometimes you <em>don't</em> want to propagate the token.","m.mentions":{"user_ids":["@littledan:matrix.org"]},"m.relates_to":{"m.in_reply_to":{"event_id":"$FBsyu-f1-wH19HnjJxkC8XYY6vudgRIujyiFnObk_bo"}},"msgtype":"m.text"},"ts":1717411901981,"senderName":"rbuckton","senderId":"@rbuckton:matrix.org","id":"$_80vN5jVNuSWUhJTsG_FNFEBFESQibdDs3tzgU1iX6Q"},
{"content":{"body":"I have to step away, I'll discuss more shortly.","m.mentions":{},"msgtype":"m.text"},"ts":1717411915355,"senderName":"rbuckton","senderId":"@rbuckton:matrix.org","id":"$E-4w3T2JhN5V-IpVtE05TG319-9rw_C7CEvrNWvEG60"},
{"content":{"body":"> <@rbuckton:matrix.org> The only avenue given to us at this point is a host hook.\n\nI hope we can first think about the problem space and what's needed for developers (as you were trying to do) and then we can go from there to \"how do we lay this out across the various specs\"","format":"org.matrix.custom.html","formatted_body":"<mx-reply><blockquote><a href=\"https://matrix.to/#/!WgJwmjBNZEXhJnXHXw:matrix.org/$UL00u1v3yLFQkocwvKpu8wSJDcUQJvXIo0KUPS0lGdY?via=matrix.org&via=mozilla.org&via=igalia.com\">In reply to</a> <a href=\"https://matrix.to/#/@rbuckton:matrix.org\">@rbuckton:matrix.org</a><br>The only avenue given to us at this point is a host hook.</blockquote></mx-reply>I hope we can first think about the problem space and what's needed for developers (as you were trying to do) and then we can go from there to \"how do we lay this out across the various specs\"","m.mentions":{"user_ids":["@rbuckton:matrix.org"]},"m.relates_to":{"m.in_reply_to":{"event_id":"$UL00u1v3yLFQkocwvKpu8wSJDcUQJvXIo0KUPS0lGdY"}},"msgtype":"m.text"},"ts":1717411923559,"senderName":"littledan","senderId":"@littledan:matrix.org","id":"$0zpp7Tp_A-vUXZxJTH3r9NHld6FscjKormma71sQsk8"},
{"content":{"body":"With the token as a parameter, it is up to the caller to determine whether to pass the token to a function. If you had a function that invoked a REST API, you might want to allow it to be cancellable in some cases, but not others. If there is no suppression mechanism, then there is no way for the caller to make this determination. The structure of the Cancellation API (so far as that proposal was concerned) ensured an appropriate separation of concerns so that the correct level of control was available with respect to the caller and the call site. ","format":"org.matrix.custom.html","formatted_body":"With the token as a parameter, it is up to the caller to determine whether to pass the token to a function. If you had a function that invoked a REST API, you might want to allow it to be cancellable in some cases, but not others. If there is no suppression mechanism, then there is no way for the caller to make this determination. The structure of the Cancellation API (so far as that proposal was concerned) ensured an appropriate separation of concerns so that the correct level of control was available with respect to the caller and the call site.","msgtype":"m.text"},"ts":1717412535431,"senderName":"rbuckton","senderId":"@rbuckton:matrix.org","id":"$OHKC1G-8fV_OYElRCNKSXd8JhVygAt-Mme5w5mf7cUQ"},
{"content":{"body":"> <@littledan:matrix.org> (I guess it basically enables what your previous proposal's `new CancellationTokenSource(linkedTokens?)` does, roughly)\n\nOne of the major reasons I wanted a linked cancellation graph was to address memory overhead. If cancellation sources could be intrinsically linked, and could be disposed when cancellation was no longer needed, then all of the token subscriptions could be GC'd (incl. the callbacks and closed-over variables that they held).","format":"org.matrix.custom.html","formatted_body":"<mx-reply><blockquote><a href=\"https://matrix.to/#/!WgJwmjBNZEXhJnXHXw:matrix.org/$-RX9q4fEJEgRqx7FXCxbckdDiabs8geDwTDfCVoGDFs?via=matrix.org&via=mozilla.org&via=igalia.com\">In reply to</a> <a href=\"https://matrix.to/#/@littledan:matrix.org\">@littledan:matrix.org</a><br>(I guess it basically enables what your previous proposal's <code>new CancellationTokenSource(linkedTokens?)</code> does, roughly)</blockquote></mx-reply>One of the major reasons I wanted a linked cancellation graph was to address memory overhead. If cancellation sources could be intrinsically linked, and could be disposed when cancellation was no longer needed, then all of the token subscriptions could be GC'd (incl. the callbacks and closed-over variables that they held).","m.mentions":{"user_ids":["@littledan:matrix.org"]},"m.relates_to":{"m.in_reply_to":{"event_id":"$-RX9q4fEJEgRqx7FXCxbckdDiabs8geDwTDfCVoGDFs"}},"msgtype":"m.text"},"ts":1717413021273,"senderName":"rbuckton","senderId":"@rbuckton:matrix.org","id":"$LdOrq5nOs3VA3mkP-FC7GT-UTWgW1f7GczBJGQ6zIQk"},
{"content":{"body":"> <@rbuckton:matrix.org> With the token as a parameter, it is up to the caller to determine whether to pass the token to a function. If you had a function that invoked a REST API, you might want to allow it to be cancellable in some cases, but not others. If there is no suppression mechanism, then there is no way for the caller to make this determination. The structure of the Cancellation API (so far as that proposal was concerned) ensured an appropriate separation of concerns so that the correct level of control was available with respect to the caller and the call site.\n\nyes, so if we had an AsyncContext variable for the current cancel token, and then a function you could call to set that variable to a fresh token while running a callback, that would achieve suppression, right?","format":"org.matrix.custom.html","formatted_body":"<mx-reply><blockquote><a href=\"https://matrix.to/#/!WgJwmjBNZEXhJnXHXw:matrix.org/$OHKC1G-8fV_OYElRCNKSXd8JhVygAt-Mme5w5mf7cUQ?via=matrix.org&via=mozilla.org&via=igalia.com\">In reply to</a> <a href=\"https://matrix.to/#/@rbuckton:matrix.org\">@rbuckton:matrix.org</a><br>With the token as a parameter, it is up to the caller to determine whether to pass the token to a function. If you had a function that invoked a REST API, you might want to allow it to be cancellable in some cases, but not others. If there is no suppression mechanism, then there is no way for the caller to make this determination. The structure of the Cancellation API (so far as that proposal was concerned) ensured an appropriate separation of concerns so that the correct level of control was available with respect to the caller and the call site.</blockquote></mx-reply>yes, so if we had an AsyncContext variable for the current cancel token, and then a function you could call to set that variable to a fresh token while running a callback, that would achieve suppression, right?","m.mentions":{"user_ids":["@rbuckton:matrix.org"]},"m.relates_to":{"m.in_reply_to":{"event_id":"$OHKC1G-8fV_OYElRCNKSXd8JhVygAt-Mme5w5mf7cUQ"}},"msgtype":"m.text"},"ts":1717413062669,"senderName":"littledan","senderId":"@littledan:matrix.org","id":"$EpiGUN5_dlZmJgZk0PiQ1kBqYodMxuqXiKn0Xpq9h8M"},
{"content":{"body":"> <@rbuckton:matrix.org> One of the major reasons I wanted a linked cancellation graph was to address memory overhead. If cancellation sources could be intrinsically linked, and could be disposed when cancellation was no longer needed, then all of the token subscriptions could be GC'd (incl. the callbacks and closed-over variables that they held).\n\nyes, I agree this is important. Do you see AbortSignal.any as solving that issue too?","format":"org.matrix.custom.html","formatted_body":"<mx-reply><blockquote><a href=\"https://matrix.to/#/!WgJwmjBNZEXhJnXHXw:matrix.org/$LdOrq5nOs3VA3mkP-FC7GT-UTWgW1f7GczBJGQ6zIQk?via=matrix.org&via=mozilla.org&via=igalia.com\">In reply to</a> <a href=\"https://matrix.to/#/@rbuckton:matrix.org\">@rbuckton:matrix.org</a><br>One of the major reasons I wanted a linked cancellation graph was to address memory overhead. If cancellation sources could be intrinsically linked, and could be disposed when cancellation was no longer needed, then all of the token subscriptions could be GC'd (incl. the callbacks and closed-over variables that they held).</blockquote></mx-reply>yes, I agree this is important. Do you see AbortSignal.any as solving that issue too?","m.mentions":{"user_ids":["@rbuckton:matrix.org"]},"m.relates_to":{"m.in_reply_to":{"event_id":"$LdOrq5nOs3VA3mkP-FC7GT-UTWgW1f7GczBJGQ6zIQk"}},"msgtype":"m.text"},"ts":1717413080600,"senderName":"littledan","senderId":"@littledan:matrix.org","id":"$4fk_82FO-xWWV49v0SJce78ecqTBWBWSvsup73MMcdc"},
{"content":{"body":"A fresh token, or no token.","m.mentions":{},"msgtype":"m.text"},"ts":1717413083772,"senderName":"rbuckton","senderId":"@rbuckton:matrix.org","id":"$UtuuIG69k0DNHXv-yO8lNLHfEAClmYY-sD3NlJqAXfo"},
{"content":{"body":"I would have to think about that. IIRC, the issue with `any` is how ownership is controlled for a subgraph.","format":"org.matrix.custom.html","formatted_body":"I would have to think about that. IIRC, the issue with <code>any</code> is how ownership is controlled for a subgraph.","m.mentions":{},"msgtype":"m.text"},"ts":1717413111719,"senderName":"rbuckton","senderId":"@rbuckton:matrix.org","id":"$LLHQ-7uW_ckTJ0iSzgB-FYzms0-0hHUVAu4X_JykrvE"},
{"content":{"body":"> <@rbuckton:matrix.org> I would have to think about that. IIRC, the issue with `any` is how ownership is controlled for a subgraph.\n\nI think `any` has to be used in a sort of opinionated way to make things work","format":"org.matrix.custom.html","formatted_body":"<mx-reply><blockquote><a href=\"https://matrix.to/#/!WgJwmjBNZEXhJnXHXw:matrix.org/$LLHQ-7uW_ckTJ0iSzgB-FYzms0-0hHUVAu4X_JykrvE?via=matrix.org&via=mozilla.org&via=igalia.com\">In reply to</a> <a href=\"https://matrix.to/#/@rbuckton:matrix.org\">@rbuckton:matrix.org</a><br>I would have to think about that. IIRC, the issue with <code>any</code> is how ownership is controlled for a subgraph.</blockquote></mx-reply>I think <code>any</code> has to be used in a sort of opinionated way to make things work","m.mentions":{"user_ids":["@rbuckton:matrix.org"]},"m.relates_to":{"m.in_reply_to":{"event_id":"$LLHQ-7uW_ckTJ0iSzgB-FYzms0-0hHUVAu4X_JykrvE"}},"msgtype":"m.text"},"ts":1717413137977,"senderName":"littledan","senderId":"@littledan:matrix.org","id":"$3y7_onMaEreXQNDVRJAKCKn1--dHkQgE9iWneJudCcY"},
{"content":{"body":"and your proposed signature sort of already encapsulates that pattern","m.mentions":{},"msgtype":"m.text"},"ts":1717413168595,"senderName":"littledan","senderId":"@littledan:matrix.org","id":"$Uh7A9TvwaXneYfZd-7zkgjAIzRafxtxvZ2uJT_8hP6Y"},
{"content":{"body":"Let's say I receive a token and want to call another function with both that and my own token. With `any`, I can close *my* source, but since I have no control over the incoming token, the graph can't be GC'd","format":"org.matrix.custom.html","formatted_body":"Let's say I receive a token and want to call another function with both that and my own token. With <code>any</code>, I can close <em>my</em> source, but since I have no control over the incoming token, the graph can't be GC'd","m.mentions":{},"msgtype":"m.text"},"ts":1717413217431,"senderName":"rbuckton","senderId":"@rbuckton:matrix.org","id":"$Uoo9jmXrzM54JYLbqyDXNo4kfXxCA6zzQ98VCgsXRp4"},
{"content":{"body":"which graph do you mean?","m.mentions":{},"msgtype":"m.text"},"ts":1717413281288,"senderName":"littledan","senderId":"@littledan:matrix.org","id":"$8IdKRkmMmW2aMbyXW6iJqC4BotrwzsXjKqxasuoy-k0"},
{"content":{"body":"```js\nfunction outer(signal) {\n  const myController = new AbortController();\n  const combined = AbortController.any([signal, myController.signal]);\n  const promise = inner(combined.signal);\n  ...\n  // we've progressed to a point where cancellation shouldn't occur, \n  // but we can't signal that to `inner`\n  myController.dispose(); \n}\n```","format":"org.matrix.custom.html","formatted_body":"<pre><code class=\"language-js\">function outer(signal) {\n  const myController = new AbortController();\n  const combined = AbortController.any([signal, myController.signal]);\n  const promise = inner(combined.signal);\n  ...\n  // we've progressed to a point where cancellation shouldn't occur, \n  // but we can't signal that to `inner`\n  myController.dispose(); \n}\n</code></pre>\n","m.mentions":{},"msgtype":"m.text"},"ts":1717413403747,"senderName":"rbuckton","senderId":"@rbuckton:matrix.org","id":"$AC37JR8ls-XAwEgh3LV09oclQd0jpZrPRd6ayd0HFd0"},
{"content":{"body":" * ```js\nfunction outer(signal) {\n  const myController = new AbortController();\n  const combinedSignal = AbortController.any([signal, myController.signal]);\n  const promise = inner(combinedSignal);\n  ...\n  // we've progressed to a point where cancellation shouldn't occur, \n  // but we can't signal that to `inner`\n  myController.dispose(); \n}\n```","format":"org.matrix.custom.html","formatted_body":" * <pre><code class=\"language-js\">function outer(signal) {\n  const myController = new AbortController();\n  const combinedSignal = AbortController.any([signal, myController.signal]);\n  const promise = inner(combinedSignal);\n  ...\n  // we've progressed to a point where cancellation shouldn't occur, \n  // but we can't signal that to `inner`\n  myController.dispose(); \n}\n</code></pre>\n","m.mentions":{},"m.new_content":{"body":"```js\nfunction outer(signal) {\n  const myController = new AbortController();\n  const combinedSignal = AbortController.any([signal, myController.signal]);\n  const promise = inner(combinedSignal);\n  ...\n  // we've progressed to a point where cancellation shouldn't occur, \n  // but we can't signal that to `inner`\n  myController.dispose(); \n}\n```","format":"org.matrix.custom.html","formatted_body":"<pre><code class=\"language-js\">function outer(signal) {\n  const myController = new AbortController();\n  const combinedSignal = AbortController.any([signal, myController.signal]);\n  const promise = inner(combinedSignal);\n  ...\n  // we've progressed to a point where cancellation shouldn't occur, \n  // but we can't signal that to `inner`\n  myController.dispose(); \n}\n</code></pre>\n","m.mentions":{},"msgtype":"m.text"},"m.relates_to":{"event_id":"$AC37JR8ls-XAwEgh3LV09oclQd0jpZrPRd6ayd0HFd0","rel_type":"m.replace"},"msgtype":"m.text"},"ts":1717413423949,"senderName":"rbuckton","senderId":"@rbuckton:matrix.org","id":"$pr6nW4xaiyTmn1Uv3iChYX0QcxH8WVhLZto75-bYGWs"},
{"content":{"body":" * ```js\nfunction outer(signal) {\n  const myController = new AbortController();\n  const combinedSignal = AbortSignal.any([signal, myController.signal]);\n  const promise = inner(combinedSignal);\n  ...\n  // we've progressed to a point where cancellation shouldn't occur, \n  // but we can't signal that to `inner`\n  myController.dispose(); \n}\n```","format":"org.matrix.custom.html","formatted_body":" * <pre><code class=\"language-js\">function outer(signal) {\n  const myController = new AbortController();\n  const combinedSignal = AbortSignal.any([signal, myController.signal]);\n  const promise = inner(combinedSignal);\n  ...\n  // we've progressed to a point where cancellation shouldn't occur, \n  // but we can't signal that to `inner`\n  myController.dispose(); \n}\n</code></pre>\n","m.mentions":{},"m.new_content":{"body":"```js\nfunction outer(signal) {\n  const myController = new AbortController();\n  const combinedSignal = AbortSignal.any([signal, myController.signal]);\n  const promise = inner(combinedSignal);\n  ...\n  // we've progressed to a point where cancellation shouldn't occur, \n  // but we can't signal that to `inner`\n  myController.dispose(); \n}\n```","format":"org.matrix.custom.html","formatted_body":"<pre><code class=\"language-js\">function outer(signal) {\n  const myController = new AbortController();\n  const combinedSignal = AbortSignal.any([signal, myController.signal]);\n  const promise = inner(combinedSignal);\n  ...\n  // we've progressed to a point where cancellation shouldn't occur, \n  // but we can't signal that to `inner`\n  myController.dispose(); \n}\n</code></pre>\n","m.mentions":{},"msgtype":"m.text"},"m.relates_to":{"event_id":"$AC37JR8ls-XAwEgh3LV09oclQd0jpZrPRd6ayd0HFd0","rel_type":"m.replace"},"msgtype":"m.text"},"ts":1717413442439,"senderName":"rbuckton","senderId":"@rbuckton:matrix.org","id":"$4yCQ5R9IcU2boV66FLOsyY3WtLzl40senzYgiLa0gaM"},
{"content":{"body":"Here, even if we think `inner` should keep going, if `signal` is canceled then `combinedSignal` is cancelled.","format":"org.matrix.custom.html","formatted_body":"Here, even if we think <code>inner</code> should keep going, if <code>signal</code> is canceled then <code>combinedSignal</code> is cancelled.","m.mentions":{},"msgtype":"m.text"},"ts":1717413478738,"senderName":"rbuckton","senderId":"@rbuckton:matrix.org","id":"$_GVn4ERHIITcMJBefpGgbRz2HWvUh4wxdk-z2nlZvCQ"},
{"content":{"body":"If `any` returns a signal, then I can't model this relationship using it.","format":"org.matrix.custom.html","formatted_body":"If <code>any</code> returns a signal, then I can't model this relationship using it.","m.mentions":{},"msgtype":"m.text"},"ts":1717413498929,"senderName":"rbuckton","senderId":"@rbuckton:matrix.org","id":"$5gKMPjXoYfIl0IKwXrBXCv17AmR4KtJ3KaGZLG072G0"},
{"content":{"body":"But if `any` returns a controller, then I can exert this level of control:\n```js\nfunction outer(signal) {\n  const combinedController = AbortController.any([signal]);\n  const promise = inner(combinedController.signal);\n  ...\n  // we've progressed to a point where cancellation shouldn't occur\n  combinedController.dispose(); \n}\n```","format":"org.matrix.custom.html","formatted_body":"<p>But if <code>any</code> returns a controller, then I can exert this level of control:</p>\n<pre><code class=\"language-js\">function outer(signal) {\n  const combinedController = AbortController.any([signal]);\n  const promise = inner(combinedController.signal);\n  ...\n  // we've progressed to a point where cancellation shouldn't occur\n  combinedController.dispose(); \n}\n</code></pre>\n","m.mentions":{},"msgtype":"m.text"},"ts":1717413574859,"senderName":"rbuckton","senderId":"@rbuckton:matrix.org","id":"$qbfqhYhFs9hSE5Wd7XKwMNz3wTFgoXdxH7knyzhzyZk"},
{"content":{"body":"The `new CancellationTokenSource(linkedTokens?)` API allowed you to express this relationship. If you need control over the subgraph, you hold a reference to the source. If you don't need control over the subgraph, you don't hold a reference to the source and just pass along it's `token`.","format":"org.matrix.custom.html","formatted_body":"The <code>new CancellationTokenSource(linkedTokens?)</code> API allowed you to express this relationship. If you need control over the subgraph, you hold a reference to the source. If you don't need control over the subgraph, you don't hold a reference to the source and just pass along it's <code>token</code>.","m.mentions":{},"msgtype":"m.text"},"ts":1717413662607,"senderName":"rbuckton","senderId":"@rbuckton:matrix.org","id":"$C1Hj4G1TnVZoiqHSM2G3Sa_jYDtV28O6PWfBPAKTf10"},
{"content":{"body":"Btw did you point this out in any issue on the AbortSignal.any repo?","m.mentions":{},"msgtype":"m.text"},"ts":1717413702030,"senderName":"littledan","senderId":"@littledan:matrix.org","id":"$hEB1dhzO5B5-0zjzymSnceQPdp0ZBrNOfvq1EVCobZA"},
{"content":{"body":"I wasn't aware of an `AbortSignal.any` repo, but I've definitely discussed it many years ago in TC39 as part of the cancellation proposal.","format":"org.matrix.custom.html","formatted_body":"I wasn't aware of an <code>AbortSignal.any</code> repo, but I've definitely discussed it many years ago in TC39 as part of the cancellation proposal.","m.mentions":{},"msgtype":"m.text"},"ts":1717413749213,"senderName":"rbuckton","senderId":"@rbuckton:matrix.org","id":"$lx7eBoWzZhu3FVJfe4_K8McYWhVOUfwZW1pllwqkZ3Q"},
{"content":{"body":"This was the repo, but it's already shipping across browsers https://github.com/shaseley/abort-signal-any","m.mentions":{},"msgtype":"m.text"},"ts":1717413826088,"senderName":"littledan","senderId":"@littledan:matrix.org","id":"$JaJzeLXy3q2iE7YgnHLqJSG4Btg2p53D-yjp4SApY9M"},
{"content":{"body":"I had trouble following all the aspects of your previous presentation, and was watching this proposal later, and thought it was good and solved the problems you were raising.","m.mentions":{},"msgtype":"m.text"},"ts":1717413858854,"senderName":"littledan","senderId":"@littledan:matrix.org","id":"$I5NxlQ1poARjznvUWAW58YOF3vlxb800sLU6X2yZoK4"},
{"content":{"body":"Ah, that's unfortunate.","m.mentions":{},"msgtype":"m.text"},"ts":1717413965403,"senderName":"rbuckton","senderId":"@rbuckton:matrix.org","id":"$iUrkzY8Sa6Ck-YqhwpiqSTcJS990qQoLu0YAV0-zW1M"},
{"content":{"body":"I have trouble tracing the leak in the above code. It's that it's less apparent that the controller is dead?","m.mentions":{},"msgtype":"m.text"},"ts":1717413979641,"senderName":"littledan","senderId":"@littledan:matrix.org","id":"$xZY0hWgBsjjAuhwkPLCSL4rqBbJ3eSwet55DlPds7yU"},
{"content":{"body":"No, the problem is that the controller isn't dead in the first example.","m.mentions":{},"msgtype":"m.text"},"ts":1717414004432,"senderName":"rbuckton","senderId":"@rbuckton:matrix.org","id":"$gaZ8KWKiTlt4AkhJUX_0aZyGIZhbY-RouBv2pnjl2iI"},
{"content":{"body":"sure, that it isn't dead, so how big of a leak is that?","m.mentions":{},"msgtype":"m.text"},"ts":1717414021057,"senderName":"littledan","senderId":"@littledan:matrix.org","id":"$ak5rwPYD1HRVt3w8eInwuBdR1B4IwPuYW6-dzpp7A9U"},
{"content":{"body":"it's only referred to by that local variable, and that can be collected once you leave the scope. or is there anything else?","m.mentions":{},"msgtype":"m.text"},"ts":1717414040488,"senderName":"littledan","senderId":"@littledan:matrix.org","id":"$SlycV7iYU5Zw77aHum7BRNXfpuIKu6HFBQ_2aIrxh1w"},
{"content":{"body":"(I thought solving this particular GC issue was like 80% of the point of AbortSignal.any in the first place)","m.mentions":{},"msgtype":"m.text"},"ts":1717414086034,"senderName":"littledan","senderId":"@littledan:matrix.org","id":"$nGBrDYZvmeGvGL3-Dw_WVzLqT0y0SSpmYnNBGHb8aaY"},
{"content":{"body":"It's not a leak, it's bigger than that. If I wanted to be able to control whether `inner` could even be cancelled anymore after a certain point, I would not be able to do so in that approach, so it actually affects capabilities, not just memory.","format":"org.matrix.custom.html","formatted_body":"It's not a leak, it's bigger than that. If I wanted to be able to control whether <code>inner</code> could even be cancelled anymore after a certain point, I would not be able to do so in that approach, so it actually affects capabilities, not just memory.","m.mentions":{},"msgtype":"m.text"},"ts":1717414116231,"senderName":"rbuckton","senderId":"@rbuckton:matrix.org","id":"$noQOzbIrGWnN6ygpE9z59wl1MgeyNVN8urdCk6sOcu4"},
{"content":{"body":"Also, if there is no `dispose()`/`close()` then you're not addressing the GC concern at all.","format":"org.matrix.custom.html","formatted_body":"Also, if there is no <code>dispose()</code>/<code>close()</code> then you're not addressing the GC concern at all.","m.mentions":{},"msgtype":"m.text"},"ts":1717414140966,"senderName":"rbuckton","senderId":"@rbuckton:matrix.org","id":"$f7LdngL1uZigQdZqhxlMqoFAWfqaRzqJghPV4dUMpo8"},
{"content":{"body":"how can you do that with the API you're proposing?","m.mentions":{},"msgtype":"m.text"},"ts":1717414155895,"senderName":"littledan","senderId":"@littledan:matrix.org","id":"$K80oGweCRKdhcPLN3kH2e9jsU6nF533SlpQKhoj-kKg"},
{"content":{"body":"It's quite hard to explain in text without drawing a graph :/","m.mentions":{},"msgtype":"m.text"},"ts":1717414183061,"senderName":"rbuckton","senderId":"@rbuckton:matrix.org","id":"$cIih-fASY1xRauDxayPck92mRr4D25aD-9DDCt3FVIw"},
{"content":{"body":"Lets assume for a moment that an `AbortController` has a `dispose()` method. In example one, you have an outer abort controller `A` (and signal `a`) and create an inner abort controller `B` (and signal `b`). Calling `AbortSignal.any([a, b])` produces a signal `ab` with the following semantics:\n- Aborting `A` aborts `a` and `ab`\n- Aborting `B` aborts `b` and `ab` \n- Disposing `A` disposes `a` but not `ab`, because `ab` could still be aborted by `B`.\n- Disposing `B` disposes `b` but not `ab`, because `ab` could still be aborted by `A`.\n\nMy algorithm reaches a point of no return where I no longer want `inner` to be cancelable, at which point any subscriptions added by `inner` can be collected. Unfortunately, `AbortSignal.any` does not give me this capability since neither `A` nor `B` dominates the token `ab`.","format":"org.matrix.custom.html","formatted_body":"<p>Lets assume for a moment that an <code>AbortController</code> has a <code>dispose()</code> method. In example one, you have an outer abort controller <code>A</code> (and signal <code>a</code>) and create an inner abort controller <code>B</code> (and signal <code>b</code>). Calling <code>AbortSignal.any([a, b])</code> produces a signal <code>ab</code> with the following semantics:</p>\n<ul>\n<li>Aborting <code>A</code> aborts <code>a</code> and <code>ab</code></li>\n<li>Aborting <code>B</code> aborts <code>b</code> and <code>ab</code></li>\n<li>Disposing <code>A</code> disposes <code>a</code> but not <code>ab</code>, because <code>ab</code> could still be aborted by <code>B</code>.</li>\n<li>Disposing <code>B</code> disposes <code>b</code> but not <code>ab</code>, because <code>ab</code> could still be aborted by <code>A</code>.</li>\n</ul>\n<p>My algorithm reaches a point of no return where I no longer want <code>inner</code> to be cancelable, at which point any subscriptions added by <code>inner</code> can be collected. Unfortunately, <code>AbortSignal.any</code> does not give me this capability since neither <code>A</code> nor <code>B</code> dominates the token <code>ab</code>.</p>\n","m.mentions":{},"msgtype":"m.text"},"ts":1717415864560,"senderName":"rbuckton","senderId":"@rbuckton:matrix.org","id":"$gPEQMDPgRIE8NcU6RZqbRVzYletXeW2469hKRyQybBg"},
{"content":{"body":"In the `new CancellationTokenSource(linkedTokens?)` approach, you produce a new source/controller that dominates the cancellation interaction with `inner`. You have the same outer controller `A` (and signal `a`), and you wrap it with an inner controller `B(a)` with signal `b(a)`. Signal `b(a)` has the following semantics:\n\n- Aborting `A` aborts `a` and `b(a)`.\n- Aborting `B(a)` aborts `b(a)`.\n- Disposing `A` disposes `a` but not `b(a)`, because `b(a)` could still be aborted by `B(a)`. However, the link between `B(a)` and a` can be removed and the subscription can be GC'd\n- Disposing `B(a)` disposes `b(a)`, but not `a`. Any subscriptions to `b(a)` can be GC'd","format":"org.matrix.custom.html","formatted_body":"<p>In the <code>new CancellationTokenSource(linkedTokens?)</code> approach, you produce a new source/controller that dominates the cancellation interaction with <code>inner</code>. You have the same outer controller <code>A</code> (and signal <code>a</code>), and you wrap it with an inner controller <code>B(a)</code> with signal <code>b(a)</code>. Signal <code>b(a)</code> has the following semantics:</p>\n<ul>\n<li>Aborting <code>A</code> aborts <code>a</code> and <code>b(a)</code>.</li>\n<li>Aborting <code>B(a)</code> aborts <code>b(a)</code>.</li>\n<li>Disposing <code>A</code> disposes <code>a</code> but not <code>b(a)</code>, because <code>b(a)</code> could still be aborted by <code>B(a)</code>. However, the link between <code>B(a)</code> and a` can be removed and the subscription can be GC'd</li>\n<li>Disposing <code>B(a)</code> disposes <code>b(a)</code>, but not <code>a</code>. Any subscriptions to <code>b(a)</code> can be GC'd</li>\n</ul>\n","m.mentions":{},"msgtype":"m.text"},"ts":1717416195189,"senderName":"rbuckton","senderId":"@rbuckton:matrix.org","id":"$y50RtS0q_TbzcRi90Oufyxsg8dOEbltp0C_yf3fatbo"},
{"content":{"body":" * In the `new CancellationTokenSource(linkedTokens?)` approach, you produce a new source/controller that dominates the cancellation interaction with `inner`. You have the same outer controller `A` (and signal `a`), and you wrap it with an inner controller `B(a)` (with signal `b(a)`). Signal `b(a)` has the following semantics:\n\n- Aborting `A` aborts `a` and `b(a)`.\n- Aborting `B(a)` aborts `b(a)`.\n- Disposing `A` disposes `a` but not `b(a)`, because `b(a)` could still be aborted by `B(a)`. However, the link between `B(a)` and a\\` can be removed and the subscription can be GC'd\n- Disposing `B(a)` disposes `b(a)`, but not `a`. Any subscriptions to `b(a)` can be GC'd","format":"org.matrix.custom.html","formatted_body":" * <p>In the <code>new CancellationTokenSource(linkedTokens?)</code> approach, you produce a new source/controller that dominates the cancellation interaction with <code>inner</code>. You have the same outer controller <code>A</code> (and signal <code>a</code>), and you wrap it with an inner controller <code>B(a)</code> (with signal <code>b(a)</code>). Signal <code>b(a)</code> has the following semantics:</p>\n<ul>\n<li>Aborting <code>A</code> aborts <code>a</code> and <code>b(a)</code>.</li>\n<li>Aborting <code>B(a)</code> aborts <code>b(a)</code>.</li>\n<li>Disposing <code>A</code> disposes <code>a</code> but not <code>b(a)</code>, because <code>b(a)</code> could still be aborted by <code>B(a)</code>. However, the link between <code>B(a)</code> and a` can be removed and the subscription can be GC'd</li>\n<li>Disposing <code>B(a)</code> disposes <code>b(a)</code>, but not <code>a</code>. Any subscriptions to <code>b(a)</code> can be GC'd</li>\n</ul>\n","m.mentions":{},"m.new_content":{"body":"In the `new CancellationTokenSource(linkedTokens?)` approach, you produce a new source/controller that dominates the cancellation interaction with `inner`. You have the same outer controller `A` (and signal `a`), and you wrap it with an inner controller `B(a)` (with signal `b(a)`). Signal `b(a)` has the following semantics:\n\n- Aborting `A` aborts `a` and `b(a)`.\n- Aborting `B(a)` aborts `b(a)`.\n- Disposing `A` disposes `a` but not `b(a)`, because `b(a)` could still be aborted by `B(a)`. However, the link between `B(a)` and a\\` can be removed and the subscription can be GC'd\n- Disposing `B(a)` disposes `b(a)`, but not `a`. Any subscriptions to `b(a)` can be GC'd","format":"org.matrix.custom.html","formatted_body":"<p>In the <code>new CancellationTokenSource(linkedTokens?)</code> approach, you produce a new source/controller that dominates the cancellation interaction with <code>inner</code>. You have the same outer controller <code>A</code> (and signal <code>a</code>), and you wrap it with an inner controller <code>B(a)</code> (with signal <code>b(a)</code>). Signal <code>b(a)</code> has the following semantics:</p>\n<ul>\n<li>Aborting <code>A</code> aborts <code>a</code> and <code>b(a)</code>.</li>\n<li>Aborting <code>B(a)</code> aborts <code>b(a)</code>.</li>\n<li>Disposing <code>A</code> disposes <code>a</code> but not <code>b(a)</code>, because <code>b(a)</code> could still be aborted by <code>B(a)</code>. However, the link between <code>B(a)</code> and a` can be removed and the subscription can be GC'd</li>\n<li>Disposing <code>B(a)</code> disposes <code>b(a)</code>, but not <code>a</code>. Any subscriptions to <code>b(a)</code> can be GC'd</li>\n</ul>\n","m.mentions":{},"msgtype":"m.text"},"m.relates_to":{"event_id":"$y50RtS0q_TbzcRi90Oufyxsg8dOEbltp0C_yf3fatbo","rel_type":"m.replace"},"msgtype":"m.text"},"ts":1717416217928,"senderName":"rbuckton","senderId":"@rbuckton:matrix.org","id":"$Djdv-qn2rdMHWF_PdAUtbSIY-IRJ8IKODs_RUhjqocE"},
{"content":{"body":" * In the `new CancellationTokenSource(linkedTokens?)` approach, you produce a new source/controller that dominates the cancellation interaction with `inner`. You have the same outer controller `A` (and signal `a`), and you wrap it with an inner controller `B(a)` (with signal `b(a)`). Signal `b(a)` has the following semantics:\n\n- Aborting `A` aborts `a` and `b(a)`.\n- Aborting `B(a)` aborts `b(a)`.\n- Disposing `A` disposes `a` but not `b(a)`, because `b(a)` could still be aborted by `B(a)`. However, the link between `B(a)` and `a` can be removed and the subscription can be GC'd\n- Disposing `B(a)` disposes `b(a)`, but not `a`. Any subscriptions to `b(a)` can be GC'd","format":"org.matrix.custom.html","formatted_body":" * <p>In the <code>new CancellationTokenSource(linkedTokens?)</code> approach, you produce a new source/controller that dominates the cancellation interaction with <code>inner</code>. You have the same outer controller <code>A</code> (and signal <code>a</code>), and you wrap it with an inner controller <code>B(a)</code> (with signal <code>b(a)</code>). Signal <code>b(a)</code> has the following semantics:</p>\n<ul>\n<li>Aborting <code>A</code> aborts <code>a</code> and <code>b(a)</code>.</li>\n<li>Aborting <code>B(a)</code> aborts <code>b(a)</code>.</li>\n<li>Disposing <code>A</code> disposes <code>a</code> but not <code>b(a)</code>, because <code>b(a)</code> could still be aborted by <code>B(a)</code>. However, the link between <code>B(a)</code> and <code>a</code> can be removed and the subscription can be GC'd</li>\n<li>Disposing <code>B(a)</code> disposes <code>b(a)</code>, but not <code>a</code>. Any subscriptions to <code>b(a)</code> can be GC'd</li>\n</ul>\n","m.mentions":{},"m.new_content":{"body":"In the `new CancellationTokenSource(linkedTokens?)` approach, you produce a new source/controller that dominates the cancellation interaction with `inner`. You have the same outer controller `A` (and signal `a`), and you wrap it with an inner controller `B(a)` (with signal `b(a)`). Signal `b(a)` has the following semantics:\n\n- Aborting `A` aborts `a` and `b(a)`.\n- Aborting `B(a)` aborts `b(a)`.\n- Disposing `A` disposes `a` but not `b(a)`, because `b(a)` could still be aborted by `B(a)`. However, the link between `B(a)` and `a` can be removed and the subscription can be GC'd\n- Disposing `B(a)` disposes `b(a)`, but not `a`. Any subscriptions to `b(a)` can be GC'd","format":"org.matrix.custom.html","formatted_body":"<p>In the <code>new CancellationTokenSource(linkedTokens?)</code> approach, you produce a new source/controller that dominates the cancellation interaction with <code>inner</code>. You have the same outer controller <code>A</code> (and signal <code>a</code>), and you wrap it with an inner controller <code>B(a)</code> (with signal <code>b(a)</code>). Signal <code>b(a)</code> has the following semantics:</p>\n<ul>\n<li>Aborting <code>A</code> aborts <code>a</code> and <code>b(a)</code>.</li>\n<li>Aborting <code>B(a)</code> aborts <code>b(a)</code>.</li>\n<li>Disposing <code>A</code> disposes <code>a</code> but not <code>b(a)</code>, because <code>b(a)</code> could still be aborted by <code>B(a)</code>. However, the link between <code>B(a)</code> and <code>a</code> can be removed and the subscription can be GC'd</li>\n<li>Disposing <code>B(a)</code> disposes <code>b(a)</code>, but not <code>a</code>. Any subscriptions to <code>b(a)</code> can be GC'd</li>\n</ul>\n","m.mentions":{},"msgtype":"m.text"},"m.relates_to":{"event_id":"$y50RtS0q_TbzcRi90Oufyxsg8dOEbltp0C_yf3fatbo","rel_type":"m.replace"},"msgtype":"m.text"},"ts":1717416272980,"senderName":"rbuckton","senderId":"@rbuckton:matrix.org","id":"$wA4e4oIeYn73dJaBFxuogWSddUzvnydHPxx_E5RsggM"},
{"content":{"body":"So the difference between the two designs is not just one of memory efficiency, but capability. `b(a)` has a capability that `ab` does not.","format":"org.matrix.custom.html","formatted_body":"So the difference between the two designs is not just one of memory efficiency, but capability. <code>b(a)</code> has a capability that <code>ab</code> does not.","m.mentions":{},"msgtype":"m.text"},"ts":1717416491585,"senderName":"rbuckton","senderId":"@rbuckton:matrix.org","id":"$_6FjEgS-XowDbdu3yXFsGBSg2Z-LyP3c5ierznAYUU4"},
{"content":{"body":" * In the `new CancellationTokenSource(linkedTokens?)` approach, you produce a new source/controller that dominates the cancellation interaction with `inner`. You have the same outer controller `A` (and signal `a`), and you wrap it with an inner controller `B(a)` (with signal `b(a)`). Signal `b(a)` has the following semantics:\n\n- Aborting `A` aborts `a` and `b(a)` so long as a link still remains between `a` and `B(a)`.\n- Aborting `B(a)` aborts `b(a)`.\n- Disposing `A` disposes `a` but not `b(a)`, because `b(a)` could still be aborted by `B(a)`. However, the link between `B(a)` and `a` can be removed and the subscription can be GC'd\n- Disposing `B(a)` disposes `b(a)`, but not `a`. Any subscriptions to `b(a)` can be GC'd","format":"org.matrix.custom.html","formatted_body":" * <p>In the <code>new CancellationTokenSource(linkedTokens?)</code> approach, you produce a new source/controller that dominates the cancellation interaction with <code>inner</code>. You have the same outer controller <code>A</code> (and signal <code>a</code>), and you wrap it with an inner controller <code>B(a)</code> (with signal <code>b(a)</code>). Signal <code>b(a)</code> has the following semantics:</p>\n<ul>\n<li>Aborting <code>A</code> aborts <code>a</code> and <code>b(a)</code> so long as a link still remains between <code>a</code> and <code>B(a)</code>.</li>\n<li>Aborting <code>B(a)</code> aborts <code>b(a)</code>.</li>\n<li>Disposing <code>A</code> disposes <code>a</code> but not <code>b(a)</code>, because <code>b(a)</code> could still be aborted by <code>B(a)</code>. However, the link between <code>B(a)</code> and <code>a</code> can be removed and the subscription can be GC'd</li>\n<li>Disposing <code>B(a)</code> disposes <code>b(a)</code>, but not <code>a</code>. Any subscriptions to <code>b(a)</code> can be GC'd</li>\n</ul>\n","m.mentions":{},"m.new_content":{"body":"In the `new CancellationTokenSource(linkedTokens?)` approach, you produce a new source/controller that dominates the cancellation interaction with `inner`. You have the same outer controller `A` (and signal `a`), and you wrap it with an inner controller `B(a)` (with signal `b(a)`). Signal `b(a)` has the following semantics:\n\n- Aborting `A` aborts `a` and `b(a)` so long as a link still remains between `a` and `B(a)`.\n- Aborting `B(a)` aborts `b(a)`.\n- Disposing `A` disposes `a` but not `b(a)`, because `b(a)` could still be aborted by `B(a)`. However, the link between `B(a)` and `a` can be removed and the subscription can be GC'd\n- Disposing `B(a)` disposes `b(a)`, but not `a`. Any subscriptions to `b(a)` can be GC'd","format":"org.matrix.custom.html","formatted_body":"<p>In the <code>new CancellationTokenSource(linkedTokens?)</code> approach, you produce a new source/controller that dominates the cancellation interaction with <code>inner</code>. You have the same outer controller <code>A</code> (and signal <code>a</code>), and you wrap it with an inner controller <code>B(a)</code> (with signal <code>b(a)</code>). Signal <code>b(a)</code> has the following semantics:</p>\n<ul>\n<li>Aborting <code>A</code> aborts <code>a</code> and <code>b(a)</code> so long as a link still remains between <code>a</code> and <code>B(a)</code>.</li>\n<li>Aborting <code>B(a)</code> aborts <code>b(a)</code>.</li>\n<li>Disposing <code>A</code> disposes <code>a</code> but not <code>b(a)</code>, because <code>b(a)</code> could still be aborted by <code>B(a)</code>. However, the link between <code>B(a)</code> and <code>a</code> can be removed and the subscription can be GC'd</li>\n<li>Disposing <code>B(a)</code> disposes <code>b(a)</code>, but not <code>a</code>. Any subscriptions to <code>b(a)</code> can be GC'd</li>\n</ul>\n","m.mentions":{},"msgtype":"m.text"},"m.relates_to":{"event_id":"$y50RtS0q_TbzcRi90Oufyxsg8dOEbltp0C_yf3fatbo","rel_type":"m.replace"},"msgtype":"m.text"},"ts":1717416592035,"senderName":"rbuckton","senderId":"@rbuckton:matrix.org","id":"$67Yjunh-bgxZKR7YnV0cL22TGiFxJq6aEFR1IaRD23s"},
{"content":{"body":" * In the `new CancellationTokenSource(linkedTokens?)` approach, you produce a new source/controller that dominates the cancellation interaction with `inner`. You have the same outer controller `A` (and signal `a`), and you wrap it with an inner controller `B(a)` (with signal `b(a)`). Signal `b(a)` has the following semantics:\n\n- Aborting `A` aborts `a` and `b(a)` so long as a link still remains between `a` and `B(a)`.\n- Aborting `B(a)` aborts `b(a)`.\n- Disposing `A` disposes `a` but not `b(a)`, because `b(a)` could still be aborted by `B(a)`. However, the link between `B(a)` and `a` can be removed and the subscription can be GC'd.\n- Disposing `B(a)` disposes `b(a)`, but not `a`. Any subscriptions to `b(a)` can be GC'd.","format":"org.matrix.custom.html","formatted_body":" * <p>In the <code>new CancellationTokenSource(linkedTokens?)</code> approach, you produce a new source/controller that dominates the cancellation interaction with <code>inner</code>. You have the same outer controller <code>A</code> (and signal <code>a</code>), and you wrap it with an inner controller <code>B(a)</code> (with signal <code>b(a)</code>). Signal <code>b(a)</code> has the following semantics:</p>\n<ul>\n<li>Aborting <code>A</code> aborts <code>a</code> and <code>b(a)</code> so long as a link still remains between <code>a</code> and <code>B(a)</code>.</li>\n<li>Aborting <code>B(a)</code> aborts <code>b(a)</code>.</li>\n<li>Disposing <code>A</code> disposes <code>a</code> but not <code>b(a)</code>, because <code>b(a)</code> could still be aborted by <code>B(a)</code>. However, the link between <code>B(a)</code> and <code>a</code> can be removed and the subscription can be GC'd.</li>\n<li>Disposing <code>B(a)</code> disposes <code>b(a)</code>, but not <code>a</code>. Any subscriptions to <code>b(a)</code> can be GC'd.</li>\n</ul>\n","m.mentions":{},"m.new_content":{"body":"In the `new CancellationTokenSource(linkedTokens?)` approach, you produce a new source/controller that dominates the cancellation interaction with `inner`. You have the same outer controller `A` (and signal `a`), and you wrap it with an inner controller `B(a)` (with signal `b(a)`). Signal `b(a)` has the following semantics:\n\n- Aborting `A` aborts `a` and `b(a)` so long as a link still remains between `a` and `B(a)`.\n- Aborting `B(a)` aborts `b(a)`.\n- Disposing `A` disposes `a` but not `b(a)`, because `b(a)` could still be aborted by `B(a)`. However, the link between `B(a)` and `a` can be removed and the subscription can be GC'd.\n- Disposing `B(a)` disposes `b(a)`, but not `a`. Any subscriptions to `b(a)` can be GC'd.","format":"org.matrix.custom.html","formatted_body":"<p>In the <code>new CancellationTokenSource(linkedTokens?)</code> approach, you produce a new source/controller that dominates the cancellation interaction with <code>inner</code>. You have the same outer controller <code>A</code> (and signal <code>a</code>), and you wrap it with an inner controller <code>B(a)</code> (with signal <code>b(a)</code>). Signal <code>b(a)</code> has the following semantics:</p>\n<ul>\n<li>Aborting <code>A</code> aborts <code>a</code> and <code>b(a)</code> so long as a link still remains between <code>a</code> and <code>B(a)</code>.</li>\n<li>Aborting <code>B(a)</code> aborts <code>b(a)</code>.</li>\n<li>Disposing <code>A</code> disposes <code>a</code> but not <code>b(a)</code>, because <code>b(a)</code> could still be aborted by <code>B(a)</code>. However, the link between <code>B(a)</code> and <code>a</code> can be removed and the subscription can be GC'd.</li>\n<li>Disposing <code>B(a)</code> disposes <code>b(a)</code>, but not <code>a</code>. Any subscriptions to <code>b(a)</code> can be GC'd.</li>\n</ul>\n","m.mentions":{},"msgtype":"m.text"},"m.relates_to":{"event_id":"$y50RtS0q_TbzcRi90Oufyxsg8dOEbltp0C_yf3fatbo","rel_type":"m.replace"},"msgtype":"m.text"},"ts":1717416616142,"senderName":"rbuckton","senderId":"@rbuckton:matrix.org","id":"$fUoImsEsXKIjy9c2ntYRolkfVAIPFgaaksP5ejqkObM"},
{"content":{"body":"I also discuss a lot of this in https://github.com/tc39/proposal-cancellation/blob/master/stage0/README.md, which was pulled out of the explainer when it advanced to stage 1.","m.mentions":{},"msgtype":"m.text"},"ts":1717417678561,"senderName":"rbuckton","senderId":"@rbuckton:matrix.org","id":"$_qzFaxbi8kEo_waDS29tjqGh5MYXwj5CNokmDkURNwU"},
{"content":{"body":"I don't see anything in these docs about disposal. Is disposal really a necessary feature?","m.mentions":{},"msgtype":"m.text"},"ts":1717426363090,"senderName":"littledan","senderId":"@littledan:matrix.org","id":"$6j56Y0ZtrWTPKZH40bOM0OKw_Zkbd54SJDEbSGgW1AA"},
{"content":{"body":"There's some related discussion about being on AbortController vs AbortSignal in https://github.com/shaseley/abort-signal-any/#exposure-through-abortsignal-vs-abortcontroller","m.mentions":{},"msgtype":"m.text"},"ts":1717426620132,"senderName":"littledan","senderId":"@littledan:matrix.org","id":"$muV4kCVb8NC-GAfxoU6KTY3cq1z5wMlnJwOoBZ13GOY"}
]
[
{"content":{"body":"PHP got a pipeline operator: https://thephp.foundation/blog/2025/07/11/php-85-adds-pipe-operator/","msgtype":"m.text"},"ts":1754401171495,"senderName":"Justin Ridgewell","senderId":"@jridgewell:matrix.org","id":"$Cs9LZ7zHtq-nNMZxGmhqx86vfsR1KxnsumpvRmoMOrc"},
{"content":{"body":"It looks like its using F# style, since the RHS must be callable","m.mentions":{},"msgtype":"m.text"},"ts":1754401205513,"senderName":"rbuckton","senderId":"@rbuckton:matrix.org","id":"$Ol-UaVClD2e6r3z4pt5y_Nn5hfdGoSD8gQTi5CQDelk"},
{"content":{"body":"Yah, but PHP doesn’t have first class functions for every fn value, so it’s a bunch of `foo(…)`","format":"org.matrix.custom.html","formatted_body":"Yah, but PHP doesn’t have first class functions for every fn value, so it’s a bunch of <code>foo(…)</code>","msgtype":"m.text"},"ts":1754401749782,"senderName":"Justin Ridgewell","senderId":"@jridgewell:matrix.org","id":"$g3NqRp0SYZDzbKuoRnHu_uRPCPnMWsYUKtjjTs5i9XE"},
{"content":{"body":"Any arbitrary expressions are wrapped in a closure","msgtype":"m.text"},"ts":1754401791429,"senderName":"Justin Ridgewell","senderId":"@jridgewell:matrix.org","id":"$R2q96r1jJMagz3wQBQJzILY-mKTNjfCd2HVIOOFe8TY"},
{"content":{"body":"I think our F# supporters would still be unhappy with this syntax.","msgtype":"m.text"},"ts":1754401828366,"senderName":"Justin Ridgewell","senderId":"@jridgewell:matrix.org","id":"$dalNgS5jzf8mOlWklPadRqodtg1pNXSzLfBa_7ES7tQ"},
{"content":{"body":"In lieu of PFA, we would have had to do the same for F# style. And they did get first-class callables","m.mentions":{},"msgtype":"m.text"},"ts":1754401845850,"senderName":"rbuckton","senderId":"@rbuckton:matrix.org","id":"$8NJksSF5uAgyMcCthWDPdupH4pn7Ff8AlYqhTFj6maU"},
{"content":{"body":"https://wiki.php.net/rfc/first_class_callable_syntax","m.mentions":{},"msgtype":"m.text"},"ts":1754401852817,"senderName":"rbuckton","senderId":"@rbuckton:matrix.org","id":"$_oWKr0M0u9tMw3OQ2R6rTbYuzMOwu4_NR1oYGZZGgEk"},
{"content":{"body":"Yah, that’s the `(…)` to turn it into a first class callable function.","format":"org.matrix.custom.html","formatted_body":"Yah, that’s the <code>(…)</code> to turn it into a first class callable function.","msgtype":"m.text"},"ts":1754401901233,"senderName":"Justin Ridgewell","senderId":"@jridgewell:matrix.org","id":"$HMkB__lCaIH5auvhSRPhF_UrJN33m2glQ6uW68j1wZE"},
{"content":{"body":"Functions aren’t callable by pipe by default","msgtype":"m.text"},"ts":1754401931765,"senderName":"Justin Ridgewell","senderId":"@jridgewell:matrix.org","id":"$SImwJf4MBPC8cLg_KF5ZeUkPN0zNw4AHsT7BligLGdY"},
{"content":{"body":"Ah. My PFA proposal did have `...` in addition to `?`","format":"org.matrix.custom.html","formatted_body":"Ah. My PFA proposal did have <code>...</code> in addition to <code>?</code>","m.mentions":{},"msgtype":"m.text"},"ts":1754401960524,"senderName":"rbuckton","senderId":"@rbuckton:matrix.org","id":"$wmjKQ5SvTowlQeh-XaPE6BBIKiqX7i1jCk-29uegDXM"},
{"content":{"body":"You could assign the `var f = foo(…)` and pass that to pipe directly","format":"org.matrix.custom.html","formatted_body":"You could assign the <code>var f = foo(…)</code> and pass that to pipe directly","msgtype":"m.text"},"ts":1754401975740,"senderName":"Justin Ridgewell","senderId":"@jridgewell:matrix.org","id":"$OC99wwJUvsHu-DlaIEKk7_qxUmlHS3mGmjcFCxClIXE"},
{"content":{"body":"`x |> filter(isOnSale(...))`\n \nIt this calling filter passing the closure to it, and then calling the result of filter with x?","format":"org.matrix.custom.html","formatted_body":"`x |&gt; filter(isOnSale(...))`<br /><br />It this calling filter passing the closure to it, and then calling the result of filter with x?","msgtype":"m.text"},"ts":1754402049499,"senderName":"Nic","senderId":"@nribaudo:igalia.com","id":"$0w6adoRXZyZTu-c6NSqEjodsk2VlXO42NTEdLFbJB1s"},
{"content":{"body":"> <@rbuckton:matrix.org> Ah. My PFA proposal did have `...` in addition to `?`\n\nThey mirrored your proposal: https://wiki.php.net/rfc/partial_function_application","format":"org.matrix.custom.html","formatted_body":"<mx-reply><blockquote><a href=\"https://matrix.to/#/!mjlgwjKxWUpgSgeCQU%3Amatrix.org/%24wmjKQ5SvTowlQeh-XaPE6BBIKiqX7i1jCk-29uegDXM\">In reply to</a> <a href=\"https://matrix.to/#/@rbuckton:matrix.org\">@rbuckton:matrix.org</a><br>Ah. My PFA proposal did have <code>...</code> in addition to <code>?</code></blockquote></mx-reply>They mirrored your proposal: https://wiki.php.net/rfc/partial_function_application","m.relates_to":{"m.in_reply_to":{"event_id":"$wmjKQ5SvTowlQeh-XaPE6BBIKiqX7i1jCk-29uegDXM"}},"msgtype":"m.text"},"ts":1754402184074,"senderName":"Justin Ridgewell","senderId":"@jridgewell:matrix.org","id":"$UbOF83IB9xp8AWYBxnzmpJGKreawbtCpG_9gA0T8vkQ"},
{"content":{"body":"filter takes a closure and returns a closure","m.mentions":{},"msgtype":"m.text"},"ts":1754402188432,"senderName":"rbuckton","senderId":"@rbuckton:matrix.org","id":"$eNxY_DCRzEjHlAck7QrnhKEoI5Nn0QQPMb61H_iZBjk"},
{"content":{"body":"It looks like they didn't move forward with it though, due to engine complexity, per the pipeline article.","m.mentions":{"user_ids":["@jridgewell:matrix.org"]},"m.relates_to":{"m.in_reply_to":{"event_id":"$UbOF83IB9xp8AWYBxnzmpJGKreawbtCpG_9gA0T8vkQ"}},"msgtype":"m.text"},"ts":1754402230997,"senderName":"rbuckton","senderId":"@rbuckton:matrix.org","id":"$HmFR7JtV61M-S7HoQtf8LUkoMUbnejeuLIdB4RyFQ3s"},
{"content":{"body":"> <@nribaudo:igalia.com> `x |> filter(isOnSale(...))`\n>  \n> It this calling filter passing the closure to it, and then calling the result of filter with x?\n\nYes","format":"org.matrix.custom.html","formatted_body":"<mx-reply><blockquote><a href=\"https://matrix.to/#/!mjlgwjKxWUpgSgeCQU%3Amatrix.org/%240w6adoRXZyZTu-c6NSqEjodsk2VlXO42NTEdLFbJB1s\">In reply to</a> <a href=\"https://matrix.to/#/@nribaudo:igalia.com\">@nribaudo:igalia.com</a><br>`x |&gt; filter(isOnSale(...))`<br /><br />It this calling filter passing the closure to it, and then calling the result of filter with x?</blockquote></mx-reply>Yes","m.relates_to":{"m.in_reply_to":{"event_id":"$0w6adoRXZyZTu-c6NSqEjodsk2VlXO42NTEdLFbJB1s"}},"msgtype":"m.text"},"ts":1754402275490,"senderName":"Justin Ridgewell","senderId":"@jridgewell:matrix.org","id":"$U1Vnri2Gr31cUD0gkRI7UlZe1wi5VYyj1NUesYTgSNU"},
{"content":{"body":"> <@rbuckton:matrix.org> It looks like they didn't move forward with it though, due to engine complexity, per the pipeline article.\n\nAt the end of the article, they mention trying again for 8.5 or 8.6","format":"org.matrix.custom.html","formatted_body":"<mx-reply><blockquote><a href=\"https://matrix.to/#/!mjlgwjKxWUpgSgeCQU%3Amatrix.org/%24HmFR7JtV61M-S7HoQtf8LUkoMUbnejeuLIdB4RyFQ3s\">In reply to</a> <a href=\"https://matrix.to/#/@rbuckton:matrix.org\">@rbuckton:matrix.org</a><br>It looks like they didn't move forward with it though, due to engine complexity, per the pipeline article.</blockquote></mx-reply>At the end of the article, they mention trying again for 8.5 or 8.6","m.relates_to":{"m.in_reply_to":{"event_id":"$HmFR7JtV61M-S7HoQtf8LUkoMUbnejeuLIdB4RyFQ3s"}},"msgtype":"m.text"},"ts":1754402361103,"senderName":"Justin Ridgewell","senderId":"@jridgewell:matrix.org","id":"$1GqHDUVA4gXIIOLYAJl8z3KnshhvYk2LqCXCDzMibM4"},
{"content":{"body":"They even call our performance of closure allocations when not using literal syntax directly in the RHS","msgtype":"m.text"},"ts":1754402447964,"senderName":"Justin Ridgewell","senderId":"@jridgewell:matrix.org","id":"$SlviOMy4InhRFjLKssVlB17cpq1_bRMl_i0OgivT2Vw"},
{"content":{"body":"https://wiki.php.net/rfc/pipe-operator-v3#:~:text=Performance","msgtype":"m.text"},"ts":1754402474975,"senderName":"Justin Ridgewell","senderId":"@jridgewell:matrix.org","id":"$WpdZk3zocad7M3RywAwlKQaw_zynu3WhIyRAcrF1tio"},
{"content":{"body":"`x |> f(?)` could be statically optimized to `x |> (_) => f(_)`. ","format":"org.matrix.custom.html","formatted_body":"<code>x |&gt; f(?)</code> could be statically optimized to <code>x |&gt; (_) =&gt; f(_)</code>.","m.mentions":{},"msgtype":"m.text"},"ts":1754402770504,"senderName":"rbuckton","senderId":"@rbuckton:matrix.org","id":"$-_VJyHCzUZjDUkjYc7hUoinVW2uOlCRlLnU6ILPJv98"},
{"content":{"body":"Yup","msgtype":"m.text"},"ts":1754403079806,"senderName":"Justin Ridgewell","senderId":"@jridgewell:matrix.org","id":"$cJQwAUsphaeOde1SteJiH3fxooW2EIUVwuOHht7HqPs"},
{"content":{"body":"I'm not finding filter() or map() in the php manual. Are these meant to be assumed to be user-defined HOFs?","m.mentions":{"user_ids":["@rbuckton:matrix.org"]},"m.relates_to":{"m.in_reply_to":{"event_id":"$eNxY_DCRzEjHlAck7QrnhKEoI5Nn0QQPMb61H_iZBjk"}},"msgtype":"m.text"},"ts":1754416312125,"senderName":"TabAtkins","senderId":"@tabatkins:matrix.org","id":"$JsDVCGQPwQNc6UaFFx5tRdnLMD9mV5_yIWkH_baFURI"},
{"content":{"body":"Assumed from context.:\n> Or, consider that the right-side can also be a function call that returns a Closure. That means with a few functions that return functions: ...\n\nand the definition of `maybe` further down:\n\n```php\nfunction maybe(\\Closure $c): \\Closure\n{\n    return fn(mixed $arg) => $arg === null ? null : $c($arg);\n}\n```","format":"org.matrix.custom.html","formatted_body":"<p>Assumed from context.:</p>\n<blockquote>\n<p>Or, consider that the right-side can also be a function call that returns a Closure. That means with a few functions that return functions: ...</p>\n</blockquote>\n<p>and the definition of <code>maybe</code> further down:</p>\n<pre><code class=\"language-php\">function maybe(\\Closure $c): \\Closure\n{\n    return fn(mixed $arg) =&gt; $arg === null ? null : $c($arg);\n}\n</code></pre>\n","m.mentions":{"user_ids":["@tabatkins:matrix.org"]},"m.relates_to":{"m.in_reply_to":{"event_id":"$JsDVCGQPwQNc6UaFFx5tRdnLMD9mV5_yIWkH_baFURI"}},"msgtype":"m.text"},"ts":1754422172978,"senderName":"rbuckton","senderId":"@rbuckton:matrix.org","id":"$Y9M-je_flUKwPw91Sm44Jiq-qOch2cLUrW9hPtaaGFo"},
{"content":{"body":"This PHP first-class callable syntax is interesting because they call it out as an “alternative” to PFA syntax, insofar that “the vast majority of PFA uses” would be “to acquire a callable, without partially applying any arguments”. \n\nThe first-class callable proposal also notes, “A PFA-based optimization would entail significant overhead relative to simple function calls, unless special optimization for the pipe operator usage is introduced (which may not be possible, depending on precise semantics).” This is similar to the pushback we’ve gotten from the big JS engines. \n\nAnd then this first-class callable syntax results in a pipe syntax that is *not tacit*—it requires using `(...)` on every unary function call.\n\nAnd then they require wrapping n-ary function calls in pipes with unary closures, like `fn($x) => array_map(strtoupper(...), $x)`.\n\nThey punt this to a future PFA proposal. The pipe v3 proposal says, “Should the proposed follow-up RFC of Partial Function Application RFC (see below) be approved, it would be logical and recommended for a similar optimization to be made when a PFA appears on the right-side of pipe.” Which seems optimistic compared to the cautious statement in the first-class callable proposal?\n\nLastly, like Justin mentioned, the pipe v3 proposal says that their pipe’s requiring that n-ary function calls be wrapped in unary closures “gives a little overhead over making all calls directly, but only in some cases, and not dramatically so”. This contrasts with the JS engines’ concerns about GC thrashing due to closure creation in hot paths. ","format":"org.matrix.custom.html","formatted_body":"<p>This PHP first-class callable syntax is interesting because they call it out as an “alternative” to PFA syntax, insofar that “the vast majority of PFA uses” would be “to acquire a callable, without partially applying any arguments”.</p>\n<p>The first-class callable proposal also notes, “A PFA-based optimization would entail significant overhead relative to simple function calls, unless special optimization for the pipe operator usage is introduced (which may not be possible, depending on precise semantics).” This is similar to the pushback we’ve gotten from the big JS engines.</p>\n<p>And then this first-class callable syntax results in a pipe syntax that is <em>not tacit</em>—it requires using <code>(...)</code> on every unary function call.</p>\n<p>And then they require wrapping n-ary function calls in pipes with unary closures, like <code>fn($x) =&gt; array_map(strtoupper(...), $x)</code>.</p>\n<p>They punt this to a future PFA proposal. The pipe v3 proposal says, “Should the proposed follow-up RFC of Partial Function Application RFC (see below) be approved, it would be logical and recommended for a similar optimization to be made when a PFA appears on the right-side of pipe.” Which seems optimistic compared to the cautious statement in the first-class callable proposal?</p>\n<p>Lastly, like Justin mentioned, the pipe v3 proposal says that their pipe’s requiring that n-ary function calls be wrapped in unary closures “gives a little overhead over making all calls directly, but only in some cases, and not dramatically so”. This contrasts with the JS engines’ concerns about GC thrashing due to closure creation in hot paths.</p>","msgtype":"m.text"},"ts":1754425711033,"senderName":"jschoi","senderId":"@jschoi:matrix.org","id":"$Tms2Jy-3tgkAZHa5pjbmOOVMMBhei5pbMUwNiQhGx-s"},
{"content":{"body":"> <@rbuckton:matrix.org> `x |> f(?)` could be statically optimized to `x |> (_) => f(_)`. \n\nI vaguely remember an engine implementor saying this kind of closure substitution not being possible to stack traces and other side effects of closure creation…I’d have to double check. ","format":"org.matrix.custom.html","formatted_body":"<mx-reply><blockquote><a href=\"https://matrix.to/#/!mjlgwjKxWUpgSgeCQU%3Amatrix.org/%24-_VJyHCzUZjDUkjYc7hUoinVW2uOlCRlLnU6ILPJv98\">In reply to</a> <a href=\"https://matrix.to/#/@rbuckton:matrix.org\">@rbuckton:matrix.org</a><br><code>x |&gt; f(?)</code> could be statically optimized to <code>x |&gt; (_) =&gt; f(_)</code>.</blockquote></mx-reply>I vaguely remember an engine implementor saying this kind of closure substitution not being possible to stack traces and other side effects of closure creation…I’d have to double check.","m.relates_to":{"m.in_reply_to":{"event_id":"$-_VJyHCzUZjDUkjYc7hUoinVW2uOlCRlLnU6ILPJv98"}},"msgtype":"m.text"},"ts":1754425777068,"senderName":"jschoi","senderId":"@jschoi:matrix.org","id":"$nhSt75Q1nrnHlFXrpD4hnjWcC4GfNIMohqRXRXbQ9K0"}
]
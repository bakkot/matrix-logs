[
{"content":{"body":"howdy folks! I'm working on implementing <link> on top of fetch primitives, and I've hit a problem:","msgtype":"m.text","org.matrix.msc1767.text":"howdy folks! I'm working on implementing <link> on top of fetch primitives, and I've hit a problem:"},"ts":1670762226847,"senderName":"Andreas Kling","senderId":"@awesomekling:matrix.org","id":"$o3eUifiSSw3PlS8BCrZZVmpYLU2wuRjuNtPSl54q56I"},
{"content":{"body":"fast-forwarding through all the setup and most of fetch itself, once we get to `fully read` (https://fetch.spec.whatwg.org/#body-fully-read) step 5, we're asked to `react` (https://webidl.spec.whatwg.org/#dfn-perform-steps-once-promise-is-settled) which ends up calling `PerformPromiseThen` (https://tc39.es/ecma262/#sec-performpromisethen) which calls `HostMakeJobCallback` (https://html.spec.whatwg.org/multipage/webappapis.html#hostmakejobcallback)","format":"org.matrix.custom.html","formatted_body":"fast-forwarding through all the setup and most of fetch itself, once we get to <code>fully read</code> (https://fetch.spec.whatwg.org/#body-fully-read) step 5, we're asked to <code>react</code> (https://webidl.spec.whatwg.org/#dfn-perform-steps-once-promise-is-settled) which ends up calling <code>PerformPromiseThen</code> (https://tc39.es/ecma262/#sec-performpromisethen) which calls <code>HostMakeJobCallback</code> (https://html.spec.whatwg.org/multipage/webappapis.html#hostmakejobcallback)","msgtype":"m.text","org.matrix.msc1767.message":[{"body":"fast-forwarding through all the setup and most of fetch itself, once we get to `fully read` (https://fetch.spec.whatwg.org/#body-fully-read) step 5, we're asked to `react` (https://webidl.spec.whatwg.org/#dfn-perform-steps-once-promise-is-settled) which ends up calling `PerformPromiseThen` (https://tc39.es/ecma262/#sec-performpromisethen) which calls `HostMakeJobCallback` (https://html.spec.whatwg.org/multipage/webappapis.html#hostmakejobcallback)","mimetype":"text/plain"},{"body":"fast-forwarding through all the setup and most of fetch itself, once we get to <code>fully read</code> (https://fetch.spec.whatwg.org/#body-fully-read) step 5, we're asked to <code>react</code> (https://webidl.spec.whatwg.org/#dfn-perform-steps-once-promise-is-settled) which ends up calling <code>PerformPromiseThen</code> (https://tc39.es/ecma262/#sec-performpromisethen) which calls <code>HostMakeJobCallback</code> (https://html.spec.whatwg.org/multipage/webappapis.html#hostmakejobcallback)","mimetype":"text/html"}]},"ts":1670762249634,"senderName":"Andreas Kling","senderId":"@awesomekling:matrix.org","id":"$rIbS18lvSFbdhZ9m8ZXqMj6Nt3MhUYD8wboz5prldlM"},
{"content":{"body":"in `HostMakeJobCallback` it wants the incumbent settings object, but since I'm just reacting to the HTML tree-build, there's no script-having execution context present. this breaks the assertion in `incumbent settings object` step 2.1 (https://html.spec.whatwg.org/multipage/webappapis.html#incumbent-settings-object)","format":"org.matrix.custom.html","formatted_body":"in <code>HostMakeJobCallback</code> it wants the incumbent settings object, but since I'm just reacting to the HTML tree-build, there's no script-having execution context present. this breaks the assertion in <code>incumbent settings object</code> step 2.1 (https://html.spec.whatwg.org/multipage/webappapis.html#incumbent-settings-object)","msgtype":"m.text","org.matrix.msc1767.message":[{"body":"in `HostMakeJobCallback` it wants the incumbent settings object, but since I'm just reacting to the HTML tree-build, there's no script-having execution context present. this breaks the assertion in `incumbent settings object` step 2.1 (https://html.spec.whatwg.org/multipage/webappapis.html#incumbent-settings-object)","mimetype":"text/plain"},{"body":"in <code>HostMakeJobCallback</code> it wants the incumbent settings object, but since I'm just reacting to the HTML tree-build, there's no script-having execution context present. this breaks the assertion in <code>incumbent settings object</code> step 2.1 (https://html.spec.whatwg.org/multipage/webappapis.html#incumbent-settings-object)","mimetype":"text/html"}]},"ts":1670762257314,"senderName":"Andreas Kling","senderId":"@awesomekling:matrix.org","id":"$3Q3hZJGKJdCmWOeerxZKAgQyocIT2T7_p-RPkmL1lzY"},
{"content":{"body":"what am I missing here? was something above supposed to do a \"prepare to run callback\" (and thus populating the backup incumbent settings object stack)? or could this be a spec issue? (if the spec assumes that fetch operations always happen within some kind of JS execution context)","msgtype":"m.text","org.matrix.msc1767.text":"what am I missing here? was something above supposed to do a \"prepare to run callback\" (and thus populating the backup incumbent settings object stack)? or could this be a spec issue? (if the spec assumes that fetch operations always happen within some kind of JS execution context)"},"ts":1670762266403,"senderName":"Andreas Kling","senderId":"@awesomekling:matrix.org","id":"$lDcTlxAZTipKEasFlZjCd1bqM8CZ_CPa2bPwy1umoLw"},
{"content":{"body":"Oh hello Andreas Kling ","format":"org.matrix.custom.html","formatted_body":"Oh hello <a href=\"https://matrix.to/#/@awesomekling:matrix.org\">Andreas Kling</a>","msgtype":"m.text","org.matrix.msc1767.message":[{"body":"Oh hello Andreas Kling ","mimetype":"text/plain"},{"body":"Oh hello <a href=\"https://matrix.to/#/@awesomekling:matrix.org\">Andreas Kling</a>","mimetype":"text/html"}]},"ts":1670763489540,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$QgqT3u_0t8CNToehKmHPal2X04hW5gu9sk1prAun1Ko"},
{"content":{"body":"Fetching always assumes there's an environment settings object","msgtype":"m.text","org.matrix.msc1767.text":"Fetching always assumes there's an environment settings object"},"ts":1670763513672,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$TmPgosQhmarcHC8PdDNNYhBfjo84XLNsiTPhvEl5dN0"},
{"content":{"body":"in this case, the document. <link> always fetches with the document as the environment settings object","msgtype":"m.text","org.matrix.msc1767.text":"in this case, the document. <link> always fetches with the document as the environment settings object"},"ts":1670763535248,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$F9wauPoTeBhdzQUwOneYZdZQ4queRU9ox1WU_QC8gpo"},
{"content":{"body":"the whole thing with promises is a bit out-of-spec, `<link>` doesn't work on top of the JS `fetch()`","format":"org.matrix.custom.html","formatted_body":"the whole thing with promises is a bit out-of-spec, <code>&lt;link&gt;</code> doesn't work on top of the JS <code>fetch()</code>","msgtype":"m.text","org.matrix.msc1767.message":[{"body":"the whole thing with promises is a bit out-of-spec, `<link>` doesn't work on top of the JS `fetch()`","mimetype":"text/plain"},{"body":"the whole thing with promises is a bit out-of-spec, <code>&lt;link&gt;</code> doesn't work on top of the JS <code>fetch()</code>","mimetype":"text/html"}]},"ts":1670763551389,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$Tbfm4h6P-t-qYK_SG_6TdHt4cntSsz1PYix6jAR5prc"}
]
[
{"content":{"body":"howdy folks! I'm working on implementing <link> on top of fetch primitives, and I've hit a problem:","msgtype":"m.text","org.matrix.msc1767.text":"howdy folks! I'm working on implementing <link> on top of fetch primitives, and I've hit a problem:"},"ts":1670762226847,"senderName":"Andreas Kling","senderId":"@awesomekling:matrix.org","id":"$o3eUifiSSw3PlS8BCrZZVmpYLU2wuRjuNtPSl54q56I"},
{"content":{"body":"fast-forwarding through all the setup and most of fetch itself, once we get to `fully read` (https://fetch.spec.whatwg.org/#body-fully-read) step 5, we're asked to `react` (https://webidl.spec.whatwg.org/#dfn-perform-steps-once-promise-is-settled) which ends up calling `PerformPromiseThen` (https://tc39.es/ecma262/#sec-performpromisethen) which calls `HostMakeJobCallback` (https://html.spec.whatwg.org/multipage/webappapis.html#hostmakejobcallback)","format":"org.matrix.custom.html","formatted_body":"fast-forwarding through all the setup and most of fetch itself, once we get to <code>fully read</code> (https://fetch.spec.whatwg.org/#body-fully-read) step 5, we're asked to <code>react</code> (https://webidl.spec.whatwg.org/#dfn-perform-steps-once-promise-is-settled) which ends up calling <code>PerformPromiseThen</code> (https://tc39.es/ecma262/#sec-performpromisethen) which calls <code>HostMakeJobCallback</code> (https://html.spec.whatwg.org/multipage/webappapis.html#hostmakejobcallback)","msgtype":"m.text","org.matrix.msc1767.message":[{"body":"fast-forwarding through all the setup and most of fetch itself, once we get to `fully read` (https://fetch.spec.whatwg.org/#body-fully-read) step 5, we're asked to `react` (https://webidl.spec.whatwg.org/#dfn-perform-steps-once-promise-is-settled) which ends up calling `PerformPromiseThen` (https://tc39.es/ecma262/#sec-performpromisethen) which calls `HostMakeJobCallback` (https://html.spec.whatwg.org/multipage/webappapis.html#hostmakejobcallback)","mimetype":"text/plain"},{"body":"fast-forwarding through all the setup and most of fetch itself, once we get to <code>fully read</code> (https://fetch.spec.whatwg.org/#body-fully-read) step 5, we're asked to <code>react</code> (https://webidl.spec.whatwg.org/#dfn-perform-steps-once-promise-is-settled) which ends up calling <code>PerformPromiseThen</code> (https://tc39.es/ecma262/#sec-performpromisethen) which calls <code>HostMakeJobCallback</code> (https://html.spec.whatwg.org/multipage/webappapis.html#hostmakejobcallback)","mimetype":"text/html"}]},"ts":1670762249634,"senderName":"Andreas Kling","senderId":"@awesomekling:matrix.org","id":"$rIbS18lvSFbdhZ9m8ZXqMj6Nt3MhUYD8wboz5prldlM"},
{"content":{"body":"in `HostMakeJobCallback` it wants the incumbent settings object, but since I'm just reacting to the HTML tree-build, there's no script-having execution context present. this breaks the assertion in `incumbent settings object` step 2.1 (https://html.spec.whatwg.org/multipage/webappapis.html#incumbent-settings-object)","format":"org.matrix.custom.html","formatted_body":"in <code>HostMakeJobCallback</code> it wants the incumbent settings object, but since I'm just reacting to the HTML tree-build, there's no script-having execution context present. this breaks the assertion in <code>incumbent settings object</code> step 2.1 (https://html.spec.whatwg.org/multipage/webappapis.html#incumbent-settings-object)","msgtype":"m.text","org.matrix.msc1767.message":[{"body":"in `HostMakeJobCallback` it wants the incumbent settings object, but since I'm just reacting to the HTML tree-build, there's no script-having execution context present. this breaks the assertion in `incumbent settings object` step 2.1 (https://html.spec.whatwg.org/multipage/webappapis.html#incumbent-settings-object)","mimetype":"text/plain"},{"body":"in <code>HostMakeJobCallback</code> it wants the incumbent settings object, but since I'm just reacting to the HTML tree-build, there's no script-having execution context present. this breaks the assertion in <code>incumbent settings object</code> step 2.1 (https://html.spec.whatwg.org/multipage/webappapis.html#incumbent-settings-object)","mimetype":"text/html"}]},"ts":1670762257314,"senderName":"Andreas Kling","senderId":"@awesomekling:matrix.org","id":"$3Q3hZJGKJdCmWOeerxZKAgQyocIT2T7_p-RPkmL1lzY"},
{"content":{"body":"what am I missing here? was something above supposed to do a \"prepare to run callback\" (and thus populating the backup incumbent settings object stack)? or could this be a spec issue? (if the spec assumes that fetch operations always happen within some kind of JS execution context)","msgtype":"m.text","org.matrix.msc1767.text":"what am I missing here? was something above supposed to do a \"prepare to run callback\" (and thus populating the backup incumbent settings object stack)? or could this be a spec issue? (if the spec assumes that fetch operations always happen within some kind of JS execution context)"},"ts":1670762266403,"senderName":"Andreas Kling","senderId":"@awesomekling:matrix.org","id":"$lDcTlxAZTipKEasFlZjCd1bqM8CZ_CPa2bPwy1umoLw"},
{"content":{"body":"Oh hello Andreas Kling ","format":"org.matrix.custom.html","formatted_body":"Oh hello <a href=\"https://matrix.to/#/@awesomekling:matrix.org\">Andreas Kling</a>","msgtype":"m.text","org.matrix.msc1767.message":[{"body":"Oh hello Andreas Kling ","mimetype":"text/plain"},{"body":"Oh hello <a href=\"https://matrix.to/#/@awesomekling:matrix.org\">Andreas Kling</a>","mimetype":"text/html"}]},"ts":1670763489540,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$QgqT3u_0t8CNToehKmHPal2X04hW5gu9sk1prAun1Ko"},
{"content":{"body":"Fetching always assumes there's an environment settings object","msgtype":"m.text","org.matrix.msc1767.text":"Fetching always assumes there's an environment settings object"},"ts":1670763513672,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$TmPgosQhmarcHC8PdDNNYhBfjo84XLNsiTPhvEl5dN0"},
{"content":{"body":"in this case, the document. <link> always fetches with the document as the environment settings object","msgtype":"m.text","org.matrix.msc1767.text":"in this case, the document. <link> always fetches with the document as the environment settings object"},"ts":1670763535248,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$F9wauPoTeBhdzQUwOneYZdZQ4queRU9ox1WU_QC8gpo"},
{"content":{"body":"the whole thing with promises is a bit out-of-spec, `<link>` doesn't work on top of the JS `fetch()`","format":"org.matrix.custom.html","formatted_body":"the whole thing with promises is a bit out-of-spec, <code>&lt;link&gt;</code> doesn't work on top of the JS <code>fetch()</code>","msgtype":"m.text","org.matrix.msc1767.message":[{"body":"the whole thing with promises is a bit out-of-spec, `<link>` doesn't work on top of the JS `fetch()`","mimetype":"text/plain"},{"body":"the whole thing with promises is a bit out-of-spec, <code>&lt;link&gt;</code> doesn't work on top of the JS <code>fetch()</code>","mimetype":"text/html"}]},"ts":1670763551389,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$Tbfm4h6P-t-qYK_SG_6TdHt4cntSsz1PYix6jAR5prc"},
{"content":{"body":"specifically it's the request's client (https://fetch.spec.whatwg.org/#concept-request-client)","msgtype":"m.text","org.matrix.msc1767.text":"specifically it's the request's client (https://fetch.spec.whatwg.org/#concept-request-client)"},"ts":1670763628532,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$IDICr6nNjsZgy27B7wc5dFsDNE3lQeeE_MUFFnJ4wVw"},
{"content":{"body":"hmm okay, so am I doing something wrong and I shouldn't end up in \"fully read a body\" in the first place?","msgtype":"m.text","org.matrix.msc1767.text":"hmm okay, so am I doing something wrong and I shouldn't end up in \"fully read a body\" in the first place?"},"ts":1670763698680,"senderName":"Andreas Kling","senderId":"@awesomekling:matrix.org","id":"$DtO2hTI3JC3WxGQNbMwfrNcXwDIigoSUTV5sue8fZgo"},
{"content":{"body":"or what do you mean the thing with promises is a bit out-of-spec? :)","msgtype":"m.text","org.matrix.msc1767.text":"or what do you mean the thing with promises is a bit out-of-spec? :)"},"ts":1670763742630,"senderName":"Andreas Kling","senderId":"@awesomekling:matrix.org","id":"$jwxdabFNFIao5cC8mSWHtakZqPOkEyxF9Ji0jep1RJc"},
{"content":{"body":"oh I see what you mean, I forgot about that bit","msgtype":"m.text","org.matrix.msc1767.text":"oh I see what you mean, I forgot about that bit"},"ts":1670763760110,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$BFV5Kuiv7Dyfqqk6Ev0CgsumZir2FwFhCSWvfqFsaiU"},
{"content":{"body":"Andreas Kling: following the spec:\n`PerformPromiseThen` 10.b: Let fulfillJob be `NewPromiseReactionJob(fulfillReaction, value)`.\n`NewPromiseReactionJob` 1.e: let handlerResult be Completion(HostCallJobCallback(handler, undefined, « argument »)) (https://tc39.es/ecma262/#sec-newpromisereactionjob\n)\n`HostCallJobCallback(callback, V, argumentsList)`: 3.: Prepare to run a callback with incumbent settings. https://html.spec.whatwg.org/multipage/webappapis.html#hostcalljobcallback\n\nThe latter pushes to the backup stack","format":"org.matrix.custom.html","formatted_body":"<p><a href=\"https://matrix.to/#/@awesomekling:matrix.org\">Andreas Kling</a>: following the spec:<br><code>PerformPromiseThen</code> 10.b: Let fulfillJob be <code>NewPromiseReactionJob(fulfillReaction, value)</code>.<br><code>NewPromiseReactionJob</code> 1.e: let handlerResult be Completion(HostCallJobCallback(handler, undefined, « argument »)) (https://tc39.es/ecma262/#sec-newpromisereactionjob<br>)<br><code>HostCallJobCallback(callback, V, argumentsList)</code>: 3.: Prepare to run a callback with incumbent settings. https://html.spec.whatwg.org/multipage/webappapis.html#hostcalljobcallback</p>\n<p>The latter pushes to the backup stack</p>\n","msgtype":"m.text","org.matrix.msc1767.message":[{"body":"Andreas Kling: following the spec:\n`PerformPromiseThen` 10.b: Let fulfillJob be `NewPromiseReactionJob(fulfillReaction, value)`.\n`NewPromiseReactionJob` 1.e: let handlerResult be Completion(HostCallJobCallback(handler, undefined, « argument »)) (https://tc39.es/ecma262/#sec-newpromisereactionjob\n)\n`HostCallJobCallback(callback, V, argumentsList)`: 3.: Prepare to run a callback with incumbent settings. https://html.spec.whatwg.org/multipage/webappapis.html#hostcalljobcallback\n\nThe latter pushes to the backup stack","mimetype":"text/plain"},{"body":"<p><a href=\"https://matrix.to/#/@awesomekling:matrix.org\">Andreas Kling</a>: following the spec:<br><code>PerformPromiseThen</code> 10.b: Let fulfillJob be <code>NewPromiseReactionJob(fulfillReaction, value)</code>.<br><code>NewPromiseReactionJob</code> 1.e: let handlerResult be Completion(HostCallJobCallback(handler, undefined, « argument »)) (https://tc39.es/ecma262/#sec-newpromisereactionjob<br>)<br><code>HostCallJobCallback(callback, V, argumentsList)</code>: 3.: Prepare to run a callback with incumbent settings. https://html.spec.whatwg.org/multipage/webappapis.html#hostcalljobcallback</p>\n<p>The latter pushes to the backup stack</p>\n","mimetype":"text/html"}]},"ts":1670765134112,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$wzMNj4J81uQy4aQk4-DsTHmz_xLckbYDx4BTUAAJhHk"},
{"content":{"body":"https://html.spec.whatwg.org/multipage/webappapis.html#prepare-to-run-a-callback (1.:Push settings onto the backup incumbent settings object stack.)","msgtype":"m.text","org.matrix.msc1767.text":"https://html.spec.whatwg.org/multipage/webappapis.html#prepare-to-run-a-callback (1.:Push settings onto the backup incumbent settings object stack.)"},"ts":1670765157613,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$H1nGYNApVdQqenVWVYuSqRCfuHY9NUtMR0KCzRlCbQY"},
{"content":{"body":"seems super-complex, I've never touched this part of the spec TBH","msgtype":"m.text","org.matrix.msc1767.text":"seems super-complex, I've never touched this part of the spec TBH"},"ts":1670765238703,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$KnO5lamQ6TwmhSQbM3qnxf-7u0ty5juy9z5-naYUhTU"},
{"content":{"body":"earlier in `PerformPromiseThen` step 4.a, we call `HostMakeJobCallback`(https://html.spec.whatwg.org/multipage/webappapis.html#hostmakejobcallback), that's when the assertion fails","format":"org.matrix.custom.html","formatted_body":"earlier in <code>PerformPromiseThen</code> step 4.a, we call <code>HostMakeJobCallback</code>(https://html.spec.whatwg.org/multipage/webappapis.html#hostmakejobcallback), that's when the assertion fails","msgtype":"m.text","org.matrix.msc1767.message":[{"body":"earlier in `PerformPromiseThen` step 4.a, we call `HostMakeJobCallback`(https://html.spec.whatwg.org/multipage/webappapis.html#hostmakejobcallback), that's when the assertion fails","mimetype":"text/plain"},{"body":"earlier in <code>PerformPromiseThen</code> step 4.a, we call <code>HostMakeJobCallback</code>(https://html.spec.whatwg.org/multipage/webappapis.html#hostmakejobcallback), that's when the assertion fails","mimetype":"text/html"}]},"ts":1670765240881,"senderName":"Andreas Kling","senderId":"@awesomekling:matrix.org","id":"$2zRPeM10ff7jwhL2Mb6A-KSkO9Gf-_8_veBdX6yTRL0"},
{"content":{"body":"agree this is very complex","msgtype":"m.text","org.matrix.msc1767.text":"agree this is very complex"},"ts":1670765295865,"senderName":"Andreas Kling","senderId":"@awesomekling:matrix.org","id":"$k7vccgPP46w5q0yZqmd9n1Fqfo_w7aWg9Uq_gbP9JJg"},
{"content":{"body":" * earlier in `PerformPromiseThen` step 4.a, we call `HostMakeJobCallback`(https://html.spec.whatwg.org/multipage/webappapis.html#hostmakejobcallback), that's when the assertion fails","format":"org.matrix.custom.html","formatted_body":" * earlier in <code>PerformPromiseThen</code> step 4.a, we call <code>HostMakeJobCallback</code>(https://html.spec.whatwg.org/multipage/webappapis.html#hostmakejobcallback), that's when the assertion fails","m.new_content":{"body":"earlier in `PerformPromiseThen` step 4.a, we call `HostMakeJobCallback`(https://html.spec.whatwg.org/multipage/webappapis.html#hostmakejobcallback), that's when the assertion fails","format":"org.matrix.custom.html","formatted_body":"earlier in <code>PerformPromiseThen</code> step 4.a, we call <code>HostMakeJobCallback</code>(https://html.spec.whatwg.org/multipage/webappapis.html#hostmakejobcallback), that's when the assertion fails","msgtype":"m.text","org.matrix.msc1767.message":[{"body":"earlier in `PerformPromiseThen` step 4.a, we call `HostMakeJobCallback`(https://html.spec.whatwg.org/multipage/webappapis.html#hostmakejobcallback), that's when the assertion fails","mimetype":"text/plain"},{"body":"earlier in <code>PerformPromiseThen</code> step 4.a, we call <code>HostMakeJobCallback</code>(https://html.spec.whatwg.org/multipage/webappapis.html#hostmakejobcallback), that's when the assertion fails","mimetype":"text/html"}]},"m.relates_to":{"event_id":"$2zRPeM10ff7jwhL2Mb6A-KSkO9Gf-_8_veBdX6yTRL0","rel_type":"m.replace"},"msgtype":"m.text","org.matrix.msc1767.message":[{"body":" * earlier in `PerformPromiseThen` step 4.a, we call `HostMakeJobCallback`(https://html.spec.whatwg.org/multipage/webappapis.html#hostmakejobcallback), that's when the assertion fails","mimetype":"text/plain"},{"body":" * earlier in <code>PerformPromiseThen</code> step 4.a, we call <code>HostMakeJobCallback</code>(https://html.spec.whatwg.org/multipage/webappapis.html#hostmakejobcallback), that's when the assertion fails","mimetype":"text/html"}]},"ts":1670765313906,"senderName":"Andreas Kling","senderId":"@awesomekling:matrix.org","id":"$V2Si7m1rfo6FAqOzPnz-gMlvMNiurTTLkvt8X9hGsww"},
{"content":{"body":"Andreas Kling: some of it is a bit out of my comfort zone, but I think that if Fetch had a prepare-to/cleanup-after callback pair before/after the promise, with the task destination as the parameter, it would create the right result. I'm sure other people here can validate better though","format":"org.matrix.custom.html","formatted_body":"<a href=\"https://matrix.to/#/@awesomekling:matrix.org\">Andreas Kling</a>: some of it is a bit out of my comfort zone, but I think that if Fetch had a prepare-to/cleanup-after callback pair before/after the promise, with the task destination as the parameter, it would create the right result. I'm sure other people here can validate better though","msgtype":"m.text","org.matrix.msc1767.message":[{"body":"Andreas Kling: some of it is a bit out of my comfort zone, but I think that if Fetch had a prepare-to/cleanup-after callback pair before/after the promise, with the task destination as the parameter, it would create the right result. I'm sure other people here can validate better though","mimetype":"text/plain"},{"body":"<a href=\"https://matrix.to/#/@awesomekling:matrix.org\">Andreas Kling</a>: some of it is a bit out of my comfort zone, but I think that if Fetch had a prepare-to/cleanup-after callback pair before/after the promise, with the task destination as the parameter, it would create the right result. I'm sure other people here can validate better though","mimetype":"text/html"}]},"ts":1670766965974,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$21AirBO6B5Uquu0YD9bU1XPEWTyxK-w0u7LqDosNSt4"},
{"content":{"body":"hmm all right. curiously, we already do basically that as a workaround in our implementation of `HostEnqueuePromiseJob` since a while back: https://github.com/SerenityOS/serenity/commit/25909dcc051db82bf7ab4e554a8eb8ec8b173863","format":"org.matrix.custom.html","formatted_body":"hmm all right. curiously, we already do basically that as a workaround in our implementation of <code>HostEnqueuePromiseJob</code> since a while back: https://github.com/SerenityOS/serenity/commit/25909dcc051db82bf7ab4e554a8eb8ec8b173863","msgtype":"m.text","org.matrix.msc1767.message":[{"body":"hmm all right. curiously, we already do basically that as a workaround in our implementation of `HostEnqueuePromiseJob` since a while back: https://github.com/SerenityOS/serenity/commit/25909dcc051db82bf7ab4e554a8eb8ec8b173863","mimetype":"text/plain"},{"body":"hmm all right. curiously, we already do basically that as a workaround in our implementation of <code>HostEnqueuePromiseJob</code> since a while back: https://github.com/SerenityOS/serenity/commit/25909dcc051db82bf7ab4e554a8eb8ec8b173863","mimetype":"text/html"}]},"ts":1670767523759,"senderName":"Andreas Kling","senderId":"@awesomekling:matrix.org","id":"$4_EVG4UuCOUknEKlNofujTz903a4ir36UhKZMH98KZw"},
{"content":{"body":"would be great to have spec clarity on all relevant situations here. understood that it's outside your comfort zone, thanks for the help so far! :)","msgtype":"m.text","org.matrix.msc1767.text":"would be great to have spec clarity on all relevant situations here. understood that it's outside your comfort zone, thanks for the help so far! :)"},"ts":1670767564944,"senderName":"Andreas Kling","senderId":"@awesomekling:matrix.org","id":"$Ean7ujvHwIzSM_q0jziOPpRyJKLx4vBMHcmTGG8cL3s"},
{"content":{"body":"Yea I agree it needs clarity. If this is validated I'd be happy to help with a Fetch PR","msgtype":"m.text","org.matrix.msc1767.text":"Yea I agree it needs clarity. If this is validated I'd be happy to help with a Fetch PR"},"ts":1670767678544,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$g_r7J8oHjw52SY-vC_3cCfdwcX0NSgIlBHemskH3p9U"},
{"content":{"body":"much appreciated!","msgtype":"m.text","org.matrix.msc1767.text":"much appreciated!"},"ts":1670767699949,"senderName":"Andreas Kling","senderId":"@awesomekling:matrix.org","id":"$VYhQ1d3TXMIQaMXDF4bvjxSJYICeV_sPHxwNBG0oYyg"},
{"content":{"body":"Andreas Kling: I think actually a cleaner version would be to create a read request (https://streams.spec.whatwg.org/#read-request) in `fully read a body` (https://fetch.spec.whatwg.org/#body-fully-read) and not deal with promises at all","format":"org.matrix.custom.html","formatted_body":"<a href=\"https://matrix.to/#/@awesomekling:matrix.org\">Andreas Kling</a>: I think actually a cleaner version would be to create a read request (https://streams.spec.whatwg.org/#read-request) in <code>fully read a body</code> (https://fetch.spec.whatwg.org/#body-fully-read) and not deal with promises at all","msgtype":"m.text","org.matrix.msc1767.message":[{"body":"Andreas Kling: I think actually a cleaner version would be to create a read request (https://streams.spec.whatwg.org/#read-request) in `fully read a body` (https://fetch.spec.whatwg.org/#body-fully-read) and not deal with promises at all","mimetype":"text/plain"},{"body":"<a href=\"https://matrix.to/#/@awesomekling:matrix.org\">Andreas Kling</a>: I think actually a cleaner version would be to create a read request (https://streams.spec.whatwg.org/#read-request) in <code>fully read a body</code> (https://fetch.spec.whatwg.org/#body-fully-read) and not deal with promises at all","mimetype":"text/html"}]},"ts":1670768738685,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$YHIqDN_1IQxpbUtPSIjY2qEhg310iUUSBu7i7i4YfSM"},
{"content":{"body":"I'm not familiar enough with streams (yet) to tell if that's a good idea, but I welcome any simplification :)","msgtype":"m.text","org.matrix.msc1767.text":"I'm not familiar enough with streams (yet) to tell if that's a good idea, but I welcome any simplification :)"},"ts":1670768925778,"senderName":"Andreas Kling","senderId":"@awesomekling:matrix.org","id":"$OI5sSLrC14xdQgXCO68QeUamrVVBmYb2LhjpdJcXIZQ"},
{"content":{"body":"I believe Mattias Buelens can shed some light here","format":"org.matrix.custom.html","formatted_body":"I believe <a href=\"https://matrix.to/#/@mattiasbuelens:matrix.org\">Mattias Buelens</a> can shed some light here","msgtype":"m.text","org.matrix.msc1767.message":[{"body":"I believe Mattias Buelens can shed some light here","mimetype":"text/plain"},{"body":"I believe <a href=\"https://matrix.to/#/@mattiasbuelens:matrix.org\">Mattias Buelens</a> can shed some light here","mimetype":"text/html"}]},"ts":1670769004044,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$CeS6OWVzP20s7ubuGcNo8lKKQvjxaCpUDlepM5-6XAA"},
{"content":{"body":"Hmm, this is indeed a bit awkward. We have \"read a chunk\" which takes a read request with chunk steps and error steps, which nicely keeps promises out of your way. However, \"read all bytes\" (https://streams.spec.whatwg.org/#readablestreamdefaultreader-read-all-bytes) still returns a promise...\n\nI'd say the better solution would be to refactor that abstract op in Streams, so it takes \"success steps\" and \"error steps\" instead.","msgtype":"m.text","org.matrix.msc1767.text":"Hmm, this is indeed a bit awkward. We have \"read a chunk\" which takes a read request with chunk steps and error steps, which nicely keeps promises out of your way. However, \"read all bytes\" (https://streams.spec.whatwg.org/#readablestreamdefaultreader-read-all-bytes) still returns a promise...\n\nI'd say the better solution would be to refactor that abstract op in Streams, so it takes \"success steps\" and \"error steps\" instead."},"ts":1670778616118,"senderName":"Mattias Buelens","senderId":"@mattiasbuelens:matrix.org","id":"$QZx-N0HY2fSu7iP91yY-bVezdol8L-_MEwIOcPR1N18"}
]
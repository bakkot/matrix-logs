[
{"content":{"body":"Anyone know the details about the `unload` event fire in Gecko? Per https://software.hixie.ch/utilities/js/live-dom-viewer/saved/14453 it looks like it fires after removal somehow?","format":"org.matrix.custom.html","formatted_body":"Anyone know the details about the <code>unload</code> event fire in Gecko? Per https://software.hixie.ch/utilities/js/live-dom-viewer/saved/14453 it looks like it fires after removal somehow?","m.mentions":{},"msgtype":"m.text"},"ts":1768976450427,"senderName":"annevk","senderId":"@annevk:matrix.org","id":"$XtVqzJ_0iD2ihn_x8weMd9D_j9yTo34uruORdB086Sg"},
{"content":{"body":"ended up answering my unicode question and finished my Zig IDNA implementation https://github.com/nektro/zig-unicode-idna :)","m.mentions":{},"msgtype":"m.text"},"ts":1768981984150,"senderName":"nektro","senderId":"@nektro:matrix.org","id":"$43ttKAdevcEBocK4OXmD9KCA9h434pT4IYksyxsKfwI"},
{"content":{"body":"now to get back to url hehe","m.mentions":{},"msgtype":"m.text"},"ts":1768982012277,"senderName":"nektro","senderId":"@nektro:matrix.org","id":"$BGBCPbPdF3opJGvpCKogTu0iFaexT4wcqGP_0UdFueM"},
{"content":{"body":"So everybody else fires it after?","m.mentions":{"user_ids":["@annevk:matrix.org"]},"m.relates_to":{"m.in_reply_to":{"event_id":"$XtVqzJ_0iD2ihn_x8weMd9D_j9yTo34uruORdB086Sg"}},"msgtype":"m.text"},"ts":1768983753079,"senderName":"sideshowbarker","senderId":"@sideshowbarker:matrix.org","id":"$gSI6VHfaA45qDc2O2xS0orT3y4NP0SLtL-pmtSypMq0"},
{"content":{"body":"per spec, is the removal sync? And is the firing of the event async?","m.mentions":{},"msgtype":"m.text"},"ts":1768983810115,"senderName":"sideshowbarker","senderId":"@sideshowbarker:matrix.org","id":"$s1wXVk8E7VqcJ2nY9IxQfThA-p-jBL2FOMRTmxP7rN8"},
{"content":{"body":"I’m trying to do some code inspection, looking at the code locally — but… it’s pretty hairy","m.mentions":{},"msgtype":"m.text"},"ts":1768983852216,"senderName":"sideshowbarker","senderId":"@sideshowbarker:matrix.org","id":"$7FhT1d7EH7pWYJ_Nak2oUudaacWJCXljYnwB55nBPgg"},
{"content":{"body":"I kind of feel like nobody might know what the code is doing — except whoever wrote it or last had to touch it","m.mentions":{},"msgtype":"m.text"},"ts":1768983894844,"senderName":"sideshowbarker","senderId":"@sideshowbarker:matrix.org","id":"$glDMNDqJaddaD-pDQQn2YoUmOf9_XH5kr65ykVdNRrU"},
{"content":{"body":"and probably they don’t even remember by now","m.mentions":{},"msgtype":"m.text"},"ts":1768983904731,"senderName":"sideshowbarker","senderId":"@sideshowbarker:matrix.org","id":"$iGomj8C_XwlSyG4_kA461HeC9sjRz1mOqfwk8btj4dE"},
{"content":{"body":"but then I guess there’s a high change “they” = smaug anyway","m.mentions":{},"msgtype":"m.text"},"ts":1768983930910,"senderName":"sideshowbarker","senderId":"@sideshowbarker:matrix.org","id":"$l4bXfDXlr9NwfkcRNr1mjVhFrHDOs7Dl4recEEQ9H4o"},
{"content":{"body":"anyway, in other news, since I’m going to be the W3C staff contact for the Web Extensions WG, I figured I should actually try to write a cross-browser extension — in order to fully participate in the pain of trying to do that — and I managed to come up with an actually-pretty-useful extension:","m.mentions":{},"msgtype":"m.text"},"ts":1768984145680,"senderName":"sideshowbarker","senderId":"@sideshowbarker:matrix.org","id":"$4hSVkGzh_nMf0U8vvi56mZoznINgBFdyu6KrN0nosOM"},
{"content":{"body":"https://github.com/sideshowbarker/social-media-cleanser","m.mentions":{},"msgtype":"m.text"},"ts":1768984152915,"senderName":"sideshowbarker","senderId":"@sideshowbarker:matrix.org","id":"$ki7FFfNEIPtU0kuipixr-R3iR4D6lKI0jmaEnt7HbQ4"},
{"content":{"body":"* …\nanyway, in other news, since I’m going to be the W3C staff contact for the Web Extensions WG, I figured I should actually try to write a cross-browser extension — in order to fully participate in the pain of trying to do that — and I managed to come up with an actually-pretty-useful extension:","m.mentions":{},"m.new_content":{"body":"…\nanyway, in other news, since I’m going to be the W3C staff contact for the Web Extensions WG, I figured I should actually try to write a cross-browser extension — in order to fully participate in the pain of trying to do that — and I managed to come up with an actually-pretty-useful extension:","m.mentions":{},"msgtype":"m.text"},"m.relates_to":{"event_id":"$4hSVkGzh_nMf0U8vvi56mZoznINgBFdyu6KrN0nosOM","rel_type":"m.replace"},"msgtype":"m.text"},"ts":1768984164917,"senderName":"sideshowbarker","senderId":"@sideshowbarker:matrix.org","id":"$nSOwO80UPj_mfR3ee4xuVw_m-MjMYb7aO9zlMvJnmXA"},
{"content":{"body":"I encourage any and all try to it, and specifically lemme know if you run into any install problems. And otherwise of course, does it actually work for you.","m.mentions":{},"msgtype":"m.text"},"ts":1768984221090,"senderName":"sideshowbarker","senderId":"@sideshowbarker:matrix.org","id":"$HdJaDHwSEuOsJ-6UwaaVZaJ1RWgy-0xJGBPh2kYGkXY"},
{"content":{"body":"In https://github.com/whatwg/html/issues/4611#issuecomment-1960779830 Dominic Farolino claimed all browsers are aligned, but my trivial example from above shows that's not the case.","format":"org.matrix.custom.html","formatted_body":"In https://github.com/whatwg/html/issues/4611#issuecomment-1960779830 <a href=\"https://matrix.to/#/@domfarolino:matrix.org\">Dominic Farolino</a> claimed all browsers are aligned, but my trivial example from above shows that's not the case.","m.mentions":{"user_ids":["@domfarolino:matrix.org"]},"msgtype":"m.text"},"ts":1768984718659,"senderName":"annevk","senderId":"@annevk:matrix.org","id":"$H32sFxmXZK0lr_BgsFKcOaQIGFVx6SuHPgqdplQmeDM"},
{"content":{"body":"seems like it’s async in gecko at least","m.mentions":{},"msgtype":"m.text"},"ts":1768984948704,"senderName":"sideshowbarker","senderId":"@sideshowbarker:matrix.org","id":"$_Z-TaP30MLDNMzDxt5kOnMvpNkZGZIsdJKA2ZeabHmU"},
{"content":{"body":"* seems like it’s actually async in gecko at least","m.mentions":{},"m.new_content":{"body":"seems like it’s actually async in gecko at least","m.mentions":{},"msgtype":"m.text"},"m.relates_to":{"event_id":"$_Z-TaP30MLDNMzDxt5kOnMvpNkZGZIsdJKA2ZeabHmU","rel_type":"m.replace"},"msgtype":"m.text"},"ts":1768984972724,"senderName":"sideshowbarker","senderId":"@sideshowbarker:matrix.org","id":"$yrtzYK7yJPNzZhZ5OBazdTqvw36oyQG2yED7Whq1tk0"},
{"content":{"body":"I don't think so. At least per https://software.hixie.ch/utilities/js/live-dom-viewer/saved/14454 it seems like they might just clear `frameElement` earlier, but if you cache it in some other way you still get to make changes around the same time. But perhaps maybe it's slightly delayed?","format":"org.matrix.custom.html","formatted_body":"I don't think so. At least per https://software.hixie.ch/utilities/js/live-dom-viewer/saved/14454 it seems like they might just clear <code>frameElement</code> earlier, but if you cache it in some other way you still get to make changes around the same time. But perhaps maybe it's slightly delayed?","m.mentions":{},"msgtype":"m.text"},"ts":1768985443623,"senderName":"annevk","senderId":"@annevk:matrix.org","id":"$E_-sH3Wxjrug7pUVd9ohVfLOYoPoOax29IhqfeKTGL0"},
{"content":{"body":"I'm looking at this since rniwa is saying `selectedcontent` is unsafe as specified because of the `unload` event. I'm curious how jarhar dealt with this as I don't really see anything obvious in the Chromium code. I did notice Chromium doesn't appear to clear all non-primary `selectedcontent` elements when testing.","format":"org.matrix.custom.html","formatted_body":"I'm looking at this since rniwa is saying <code>selectedcontent</code> is unsafe as specified because of the <code>unload</code> event. I'm curious how <a href=\"https://matrix.to/#/@jarhar:matrix.org\">jarhar</a> dealt with this as I don't really see anything obvious in the Chromium code. I did notice Chromium doesn't appear to clear all non-primary <code>selectedcontent</code> elements when testing.","m.mentions":{"user_ids":["@jarhar:matrix.org"]},"msgtype":"m.text"},"ts":1768986697482,"senderName":"annevk","senderId":"@annevk:matrix.org","id":"$n6k_-tplBx9oTjCq4Tn9l1KJCJFPKzL42yNU6sz8t7s"},
{"content":{"body":"We were looking into something similar very recently on Gecko side and selectedcontent. I thought it was safe after all, but just possibly a bit weird","m.mentions":{},"msgtype":"m.text"},"ts":1768993798822,"senderName":"smaug","senderId":"@smaug:mozilla.org","id":"$1DMz1H6NsUcBWtFWo9G8c6ko3zT4h0FS3MUtwRP9ILc"},
{"content":{"body":"jjaschke might recall","format":"org.matrix.custom.html","formatted_body":"<a href=\"https://matrix.to/#/@jjaschke:mozilla.org\">jjaschke</a> might recall","m.mentions":{"user_ids":["@jjaschke:mozilla.org"]},"msgtype":"m.text"},"ts":1768993802919,"senderName":"smaug","senderId":"@smaug:mozilla.org","id":"$vlb5F3YdaaD2StCFMQAOtApu2md7-vXiMq4JWo7VGjI"},
{"content":{"body":"Something about remove all the child nodes","m.mentions":{},"msgtype":"m.text"},"ts":1768993823587,"senderName":"smaug","senderId":"@smaug:mozilla.org","id":"$OVXIF6U7a3NGIYpgp_lf8D3AEVr2v-NGCwl_Jud-wG4"},
{"content":{"body":"And yes, I couldn't immediately find the code in Chromium doing what the spec says, but didn't spend much time on that","m.mentions":{},"msgtype":"m.text"},"ts":1768993988574,"senderName":"smaug","senderId":"@smaug:mozilla.org","id":"$heImV1TDZGJoifD6Rln1VvkIAJsVCljQ34LGgdffT5k"},
{"content":{"body":"Selectedcontent calls [replace all with](https://dom.spec.whatwg.org/#concept-node-replace-all) when cloning stuff into it or removing its contents","format":"org.matrix.custom.html","formatted_body":"Selectedcontent calls <a href=\"https://dom.spec.whatwg.org/#concept-node-replace-all\">replace all with</a> when cloning stuff into it or removing its contents","m.mentions":{},"msgtype":"m.text"},"ts":1768994051060,"senderName":"jjaschke","senderId":"@jjaschke:mozilla.org","id":"$YSiXrG-tryKYCY9Qv8Hrqfp9ogTDAH2O0s_4GyvoITo"}
]
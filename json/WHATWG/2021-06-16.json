[
{"content":{"body":"> <@timothygu:matrix.org> SVG only shows up in some cases. PNG works everywhere.\n\nHuh, apparently the matrix.org homeserver is buggy when making thumbnails for SVG images, but the mozilla.org homeserver isn't","format":"org.matrix.custom.html","formatted_body":"<mx-reply><blockquote><a href=\"https://matrix.to/#/!AGetWbsMpFPdSgUrbs:matrix.org/$c8xDGvUqajBCyFGzoDCuWH4edsZqdRU0ROa4jOMQKm0?via=mozilla.org&via=matrix.org&via=igalia.com\">In reply to</a> <a href=\"https://matrix.to/#/@timothygu:matrix.org\">@timothygu:matrix.org</a><br>SVG only shows up in some cases. PNG works everywhere.</blockquote></mx-reply>Huh, apparently the matrix.org homeserver is buggy when making thumbnails for SVG images, but the mozilla.org homeserver isn't","m.relates_to":{"m.in_reply_to":{"event_id":"$c8xDGvUqajBCyFGzoDCuWH4edsZqdRU0ROa4jOMQKm0"}},"msgtype":"m.text"},"ts":1623801963496,"senderName":"Andreu Botella (he/they)","senderId":"@andreubotella:mozilla.org","id":"$4VgNfpIezLtVrQcCeRVnNESySz1_T6OMX08_IdcXhLE"},
{"content":{"body":"Domenic: you should be able to navigate a nested context to a data: URL (there's an open PR by me on forbidding it for top-level contexts with some open questions)","format":"org.matrix.custom.html","formatted_body":"<a href=\"https://matrix.to/#/@domenicdenicola:matrix.org\">Domenic</a>: you should be able to navigate a nested context to a data: URL (there's an open PR by me on forbidding it for top-level contexts with some open questions)","msgtype":"m.text"},"ts":1623825381573,"senderName":"annevk","senderId":"@annevk:mozilla.org","id":"$woBJYrvlk6mKiYgLZE8Udyn27FRckYggAvoRSupT5p4"},
{"content":{"body":"(I changed the avatar to a PNG)","msgtype":"m.text"},"ts":1623825455168,"senderName":"annevk","senderId":"@annevk:mozilla.org","id":"$OdeD3n1b1nGC8ycnAmfTFlzIsRes9jmBQe52gaPF6qw"},
{"content":{"body":"wfm","msgtype":"m.text"},"ts":1623826879919,"senderName":"DerekNonGeneric","senderId":"@dereknongeneric:mozilla.org","id":"$cWRiPpQTLI517OFAAAvnjrKZwXa1XQxucEFpNBMyIwo"},
{"content":{"body":"fwf, i know for a fact svgs work since that is what i used for my own room","msgtype":"m.text"},"ts":1623826938198,"senderName":"DerekNonGeneric","senderId":"@dereknongeneric:mozilla.org","id":"$kig9ivjN7bBR4YsXp2KYub3v0qgnTZlFhOGxjn_ijj0"},
{"content":{"body":"no clue if there are attributes missing on y'alls (perhaps a case of over-optimization)","msgtype":"m.text"},"ts":1623826996920,"senderName":"DerekNonGeneric","senderId":"@dereknongeneric:mozilla.org","id":"$phu8UPYxfvWAwecyoRmXW56nc2K3ai6SBR58BNV2OhY"},
{"content":{"body":"The issue is https://github.com/matrix-org/synapse/issues/1309","msgtype":"m.text"},"ts":1623827164917,"senderName":"Andreu Botella (he/they)","senderId":"@andreubotella:mozilla.org","id":"$R9BT2qdQcGl91S956YuXhmXY174FO6XwEITz_3f7Nd8"},
{"content":{"body":"I don't know why it works on mozilla.org though, since it also seems to use Synapse","msgtype":"m.text"},"ts":1623827203359,"senderName":"Andreu Botella (he/they)","senderId":"@andreubotella:mozilla.org","id":"$Z7odefFolcc9fyzZLTl4z0IqnPcgfe9MT9qfP50HEDY"},
{"content":{"body":"tbh, not entirely sure how important it is to have a non-lossy image format at this point","msgtype":"m.text"},"ts":1623827496019,"senderName":"DerekNonGeneric","senderId":"@dereknongeneric:mozilla.org","id":"$6HpEb_-xOXBeDDfOhxoRNi6APKkyT1MrAYx14XHxq30"},
{"content":{"body":"guess the room preview @ https://matrix.to/#/#whatwg:matrix.org will remain relatively small","msgtype":"m.text"},"ts":1623827610773,"senderName":"DerekNonGeneric","senderId":"@dereknongeneric:mozilla.org","id":"$vNwdRuaa15XCxhXGKF-ADUY__pkELCjNIFAc1dEegCo"},
{"content":{"body":"oh, but when you click on the room image in the element web app it takes up _the entire_ screen ","format":"org.matrix.custom.html","formatted_body":"oh, but when you click on the room image in the element web app it takes up <em>the entire</em> screen","msgtype":"m.text"},"ts":1623827696206,"senderName":"DerekNonGeneric","senderId":"@dereknongeneric:mozilla.org","id":"$gQ_Wh5mHZM12UTREubmdZZKoAILIx4NFlwJ_XcPAwYs"},
{"content":{"body":"oof, that is less than ideal","msgtype":"m.text"},"ts":1623827711651,"senderName":"DerekNonGeneric","senderId":"@dereknongeneric:mozilla.org","id":"$tOV1kU7ExvDA_MpA2AR1EAsqRNm0D07YUIWJGLEe_t4"},
{"content":{"body":"> <@lucacasonato:matrix.org> i was sort of expecting the icon to live on the same server as the room itself (matrix.org afaik for this room)\n\nRooms exist on all participating servers at the same time; media such as images are also duplicated. You can replace matrix-client.matrix.org by any other participating homeserver and still get the media. For instance, [here is the room logo on my server](https://mayeul.net/_matrix/media/r0/download/mozilla.org/cab85c2fc275cb19f0276f7dd2ba4af349b0223f), [KDE's](https://kde.modular.im/_matrix/media/r0/download/mozilla.org/cab85c2fc275cb19f0276f7dd2ba4af349b0223f), [Mozilla's](https://mozilla.modular.im/_matrix/media/r0/download/mozilla.org/cab85c2fc275cb19f0276f7dd2ba4af349b0223f).","format":"org.matrix.custom.html","formatted_body":"<mx-reply><blockquote><a href=\"https://matrix.to/#/!AGetWbsMpFPdSgUrbs:matrix.org/$Zfz74oGNXDlMOiVc2a4ygNulW4sHSAjW907FQH6JLSk\">In reply to</a> <a href=\"https://matrix.to/#/@lucacasonato:matrix.org\">@lucacasonato:matrix.org</a><br/>i was sort of expecting the icon to live on the same server as the room itself (matrix.org afaik for this room)</blockquote></mx-reply>Rooms exist on all participating servers at the same time; media such as images are also duplicated. You can replace matrix-client.matrix.org by any other participating homeserver and still get the media. For instance, <a href=\"https://mayeul.net/_matrix/media/r0/download/mozilla.org/cab85c2fc275cb19f0276f7dd2ba4af349b0223f\">here is the room logo on my server</a>, <a href=\"https://kde.modular.im/_matrix/media/r0/download/mozilla.org/cab85c2fc275cb19f0276f7dd2ba4af349b0223f\">KDE's</a>, <a href=\"https://mozilla.modular.im/_matrix/media/r0/download/mozilla.org/cab85c2fc275cb19f0276f7dd2ba4af349b0223f\">Mozilla's</a>.","im.nheko.relations.v1.relations":[{"event_id":"$Zfz74oGNXDlMOiVc2a4ygNulW4sHSAjW907FQH6JLSk","rel_type":"im.nheko.relations.v1.in_reply_to"}],"m.relates_to":{"m.in_reply_to":{"event_id":"$Zfz74oGNXDlMOiVc2a4ygNulW4sHSAjW907FQH6JLSk"}},"msgtype":"m.text"},"ts":1623828340283,"senderName":"MayeulC","senderId":"@mayeul:mayeul.net","id":"$INesAgPg23bSpnkJkfWqQi9Aoyvy3R2lhZ3GDH6NEww"},
{"content":{"body":"> <@lucacasonato:matrix.org> i was sort of expecting the icon to live on the same server as the room itself (matrix.org afaik for this room)\n\n * Rooms exist on all participating servers at the same time; media such as images is also duplicated. You can replace matrix-client.matrix.org by any other participating homeserver and still get the media. For instance, [here is the room logo on my server](https://mayeul.net/_matrix/media/r0/download/mozilla.org/cab85c2fc275cb19f0276f7dd2ba4af349b0223f), [KDE's](https://kde.modular.im/_matrix/media/r0/download/mozilla.org/cab85c2fc275cb19f0276f7dd2ba4af349b0223f), [Mozilla's](https://mozilla.modular.im/_matrix/media/r0/download/mozilla.org/cab85c2fc275cb19f0276f7dd2ba4af349b0223f).","format":"org.matrix.custom.html","formatted_body":"<mx-reply><blockquote><a href=\"https://matrix.to/#/!AGetWbsMpFPdSgUrbs:matrix.org/$Zfz74oGNXDlMOiVc2a4ygNulW4sHSAjW907FQH6JLSk\">In reply to</a> <a href=\"https://matrix.to/#/@lucacasonato:matrix.org\">@lucacasonato:matrix.org</a><br>i was sort of expecting the icon to live on the same server as the room itself (matrix.org afaik for this room)</blockquote></mx-reply> * Rooms exist on all participating servers at the same time; media such as images is also duplicated. You can replace matrix-client.matrix.org by any other participating homeserver and still get the media. For instance, <a href=\"https://mayeul.net/_matrix/media/r0/download/mozilla.org/cab85c2fc275cb19f0276f7dd2ba4af349b0223f\">here is the room logo on my server</a>, <a href=\"https://kde.modular.im/_matrix/media/r0/download/mozilla.org/cab85c2fc275cb19f0276f7dd2ba4af349b0223f\">KDE's</a>, <a href=\"https://mozilla.modular.im/_matrix/media/r0/download/mozilla.org/cab85c2fc275cb19f0276f7dd2ba4af349b0223f\">Mozilla's</a>.","m.new_content":{"body":"Rooms exist on all participating servers at the same time; media such as images is also duplicated. You can replace matrix-client.matrix.org by any other participating homeserver and still get the media. For instance, [here is the room logo on my server](https://mayeul.net/_matrix/media/r0/download/mozilla.org/cab85c2fc275cb19f0276f7dd2ba4af349b0223f), [KDE's](https://kde.modular.im/_matrix/media/r0/download/mozilla.org/cab85c2fc275cb19f0276f7dd2ba4af349b0223f), [Mozilla's](https://mozilla.modular.im/_matrix/media/r0/download/mozilla.org/cab85c2fc275cb19f0276f7dd2ba4af349b0223f).","format":"org.matrix.custom.html","formatted_body":"Rooms exist on all participating servers at the same time; media such as images is also duplicated. You can replace matrix-client.matrix.org by any other participating homeserver and still get the media. For instance, <a href=\"https://mayeul.net/_matrix/media/r0/download/mozilla.org/cab85c2fc275cb19f0276f7dd2ba4af349b0223f\">here is the room logo on my server</a>, <a href=\"https://kde.modular.im/_matrix/media/r0/download/mozilla.org/cab85c2fc275cb19f0276f7dd2ba4af349b0223f\">KDE's</a>, <a href=\"https://mozilla.modular.im/_matrix/media/r0/download/mozilla.org/cab85c2fc275cb19f0276f7dd2ba4af349b0223f\">Mozilla's</a>.","msgtype":"m.text"},"m.relates_to":{"event_id":"$INesAgPg23bSpnkJkfWqQi9Aoyvy3R2lhZ3GDH6NEww","rel_type":"m.replace"},"msgtype":"m.text"},"ts":1623828367380,"senderName":"MayeulC","senderId":"@mayeul:mayeul.net","id":"$VeeAYtcng_YjzfDQgQ4WcgZqxPhOF4tl8ofYpdkUoSQ"},
{"content":{"body":"And your client fetches the media from your own homeserver (which will fetch it from the federation if not available; currently synapse only asks the originating homeserver).","msgtype":"m.text"},"ts":1623828459706,"senderName":"MayeulC","senderId":"@mayeul:mayeul.net","id":"$1BNMvOZbTn0WIverkD-Ayjy0SMv7dO5fte2yiF_QGI0"},
{"content":{"body":"> <@andreubotella:mozilla.org> I don't know why it works on mozilla.org though, since it also seems to use Synapse\n\nAndreu Botella (he/they): can you give me an example of it working on mozilla.org? do you mean `chat.mozilla.org?`","format":"org.matrix.custom.html","formatted_body":"<mx-reply><blockquote><a href=\"https://matrix.to/#/!AGetWbsMpFPdSgUrbs:matrix.org/$Z7odefFolcc9fyzZLTl4z0IqnPcgfe9MT9qfP50HEDY?via=mozilla.org&via=matrix.org&via=igalia.com\">In reply to</a> <a href=\"https://matrix.to/#/@andreubotella:mozilla.org\">@andreubotella:mozilla.org</a><br>I don&#39;t know why it works on mozilla.org though, since it also seems to use Synapse</blockquote></mx-reply><a href=\"https://matrix.to/#/@andreubotella:mozilla.org\">Andreu Botella (he/they)</a>: can you give me an example of it working on mozilla.org? do you mean <code>chat.mozilla.org?</code>","m.relates_to":{"m.in_reply_to":{"event_id":"$Z7odefFolcc9fyzZLTl4z0IqnPcgfe9MT9qfP50HEDY"}},"msgtype":"m.text"},"ts":1623831415737,"senderName":"DerekNonGeneric","senderId":"@dereknongeneric:mozilla.org","id":"$79iP9zaU4t4OWZM1nCQ8tHIsj8vN6ZxhQXK3JaGoZS4"},
{"content":{"body":"Right now the logo is a PNG, but If you have your user account registered on the mozilla.org homeserver, you could see the logo before","msgtype":"m.text"},"ts":1623831681797,"senderName":"Andreu Botella (he/they)","senderId":"@andreubotella:mozilla.org","id":"$AaPMyy10sJD1B-d5w_do3iq9GYZ4uEzxAC6JjgrXHMw"},
{"content":{"body":"> <@andreubotella:mozilla.org> Right now the logo is a PNG, but If you have your user account registered on the mozilla.org homeserver, you could see the logo before\n\nmy user acc is on mozilla.org and i was not able to see the logo previously as it was an svg","format":"org.matrix.custom.html","formatted_body":"<mx-reply><blockquote><a href=\"https://matrix.to/#/!AGetWbsMpFPdSgUrbs:matrix.org/$AaPMyy10sJD1B-d5w_do3iq9GYZ4uEzxAC6JjgrXHMw?via=mozilla.org&via=matrix.org&via=fairydust.space\">In reply to</a> <a href=\"https://matrix.to/#/@andreubotella:mozilla.org\">@andreubotella:mozilla.org</a><br>Right now the logo is a PNG, but If you have your user account registered on the mozilla.org homeserver, you could see the logo before</blockquote></mx-reply>my user acc is on mozilla.org and i was not able to see the logo previously as it was an svg","m.relates_to":{"m.in_reply_to":{"event_id":"$AaPMyy10sJD1B-d5w_do3iq9GYZ4uEzxAC6JjgrXHMw"}},"msgtype":"m.text"},"ts":1623831969282,"senderName":"DerekNonGeneric","senderId":"@dereknongeneric:mozilla.org","id":"$MOJDTsMjIxqyNXbKdHKLwM1E1BeTJyuhHj_xkCFtz_4"},
{"content":{"body":"I don't know, but when I was testing this last night, downloading the logo with the `download` API worked on both my usual mozilla.org account and on a test matrix.org account, but the `thumbnail` API gave a 404 on the matrix.org account","format":"org.matrix.custom.html","formatted_body":"I don't know, but when I was testing this last night, downloading the logo with the <code>download</code> API worked on both my usual mozilla.org account and on a test matrix.org account, but the <code>thumbnail</code> API gave a 404 on the matrix.org account","msgtype":"m.text"},"ts":1623832229730,"senderName":"Andreu Botella (he/they)","senderId":"@andreubotella:mozilla.org","id":"$koX6ayiPVarNMclKSEb7BWucdWm3b07k0S7QObxdeaA"},
{"content":{"body":"https://matrix.org/docs/spec/client_server/r0.6.1#get-matrix-media-r0-download-servername-mediaid","msgtype":"m.text"},"ts":1623832246115,"senderName":"Andreu Botella (he/they)","senderId":"@andreubotella:mozilla.org","id":"$EdNsJe1OGZflWGcN5su2ZfwubB98F3qFoJ636DRknTI"},
{"content":{"body":"none of the rooms in the mozilla.org homeserver seem to be using an svg afaict","msgtype":"m.text"},"ts":1623832317830,"senderName":"DerekNonGeneric","senderId":"@dereknongeneric:mozilla.org","id":"$5_rYEgHrOLB17B93_hr1HCMeMGbNVmWBKRaHk9RCWxk"},
{"content":{"body":"> [...] but the `thumbnail` API gave a 404 on the matrix.org account","format":"org.matrix.custom.html","formatted_body":"<blockquote>\n[...] but the <code>thumbnail</code> API gave a 404 on the matrix.org account\n</blockquote>\n","msgtype":"m.text"},"ts":1623832476711,"senderName":"DerekNonGeneric","senderId":"@dereknongeneric:mozilla.org","id":"$QHWG7r22vtj8BGt2-mcyR1w5lQxbVWS3FtLTsogxeYA"},
{"content":{"body":"ditto here","msgtype":"m.text"},"ts":1623832480781,"senderName":"DerekNonGeneric","senderId":"@dereknongeneric:mozilla.org","id":"$87yScIuv4Uo0pWGFOlkP-HhizH6TynkCu4JdTTRWpYM"},
{"content":{"body":"i saw the logo before the change and still see it now. Fwiw we use #synchronicity:mozilla.org for debugging and discussing these types of issues. at least it's the \"mozilla gateway to the matrix devs\".. :) not sure if that helps","format":"org.matrix.custom.html","formatted_body":"i saw the logo before the change and still see it now. Fwiw we use <a href=\"https://matrix.to/#/#synchronicity:mozilla.org\">#synchronicity:mozilla.org</a> for debugging and discussing these types of issues. at least it's the &quot;mozilla gateway to the matrix devs&quot;.. :) not sure if that helps","msgtype":"m.text"},"ts":1623848694489,"senderName":"freddy","senderId":"@fbraun:mozilla.org","id":"$OSeP9vGMGtx8xdem-dyHQVrJI6h7By8SslQDpKAOfIQ"},
{"content":{"body":"> <@fbraun:mozilla.org> i saw the logo before the change and still see it now. Fwiw we use #synchronicity:mozilla.org for debugging and discussing these types of issues. at least it's the \"mozilla gateway to the matrix devs\".. :) not sure if that helps\n\nfreddy: thanks, good to know (guess id ask in there before making any future support request). to be clear tho, afaict the issue might not be exclusive to mozilla matrix infra (404s were at least coming from `https:matrix-client.matrix.org` when i checked (altho would not be surprised if `https://mozilla.modular.im` does the same); the docs to exact api that is senselessly failing [were linked above](https://matrix.org/docs/spec/client_server/r0.6.1#id404) by Andreu Botella (he/they) (thnx!), but seems like we needed to dig further..\n\n> The homeserver SHOULD be able to supply thumbnails for uploaded images and videos. The exact file types which can be thumbnailed are not currently specified [...]\n> — https://matrix.org/docs/spec/client_server/r0.6.1#id407\n\n> [...] with the exception of SVG which is particularly vulnerable to exploding clients thanks to billion lol attacks.\n> — https://github.com/matrix-org/matrix-doc/issues/1938#issue-424877225\n\nXXXbz? the api in question does not currently specify which media formats are supported (or perhaps, more importantly, _unsupported_), but one of the peeps in that issue seems to have safety concerns, particularly w/ _svg thumbnails_ for some reason","format":"org.matrix.custom.html","formatted_body":"<mx-reply><blockquote><a href=\"https://matrix.to/#/!AGetWbsMpFPdSgUrbs:matrix.org/$OSeP9vGMGtx8xdem-dyHQVrJI6h7By8SslQDpKAOfIQ?via=mozilla.org&via=matrix.org&via=igalia.com\">In reply to</a> <a href=\"https://matrix.to/#/@fbraun:mozilla.org\">@fbraun:mozilla.org</a><br>i saw the logo before the change and still see it now. Fwiw we use <a href=\"https://matrix.to/#/#synchronicity:mozilla.org\">#synchronicity:mozilla.org</a> for debugging and discussing these types of issues. at least it's the \"mozilla gateway to the matrix devs\".. :) not sure if that helps</blockquote></mx-reply><p><a href=\"https://matrix.to/#/@fbraun:mozilla.org\">freddy</a>: thanks, good to know (guess id ask in there before making any future support request). to be clear tho, afaict the issue might not be exclusive to mozilla matrix infra (404s were at least coming from <code>https:matrix-client.matrix.org</code> when i checked (altho would not be surprised if <code>https://mozilla.modular.im</code> does the same); the docs to exact api that is senselessly failing <a href=\"https://matrix.org/docs/spec/client_server/r0.6.1#id404\">were linked above</a> by <a href=\"https://matrix.to/#/@andreubotella:mozilla.org\">Andreu Botella (he/they)</a> (thnx!), but seems like we needed to dig further..</p>\n<blockquote>\n<p>The homeserver SHOULD be able to supply thumbnails for uploaded images and videos. The exact file types which can be thumbnailed are not currently specified [...]<br>— https://matrix.org/docs/spec/client_server/r0.6.1#id407</p>\n</blockquote>\n<blockquote>\n<p>[...] with the exception of SVG which is particularly vulnerable to exploding clients thanks to billion lol attacks.<br>— https://github.com/matrix-org/matrix-doc/issues/1938#issue-424877225</p>\n</blockquote>\n<p>XXXbz? the api in question does not currently specify which media formats are supported (or perhaps, more importantly, <em>unsupported</em>), but one of the peeps in that issue seems to have safety concerns, particularly w/ <em>svg thumbnails</em> for some reason</p>\n","m.relates_to":{"m.in_reply_to":{"event_id":"$OSeP9vGMGtx8xdem-dyHQVrJI6h7By8SslQDpKAOfIQ"}},"msgtype":"m.text"},"ts":1623868519070,"senderName":"DerekNonGeneric","senderId":"@dereknongeneric:mozilla.org","id":"$sOllj6xWXJX-s88HBTpknU1jV1y-N_E6bpQp26p7f4U"},
{"content":{"body":"DerekNonGeneric: I think the difference with thumbnails is that the homeserver doesn't have to process the full-res image, it can just store it as is. But for generating thumbnails, the homeserver has to parse the image, and the billion laughs attack is a well known denial of service attack against XML formats","format":"org.matrix.custom.html","formatted_body":"<a href=\"https://matrix.to/#/@dereknongeneric:mozilla.org\">DerekNonGeneric</a>: I think the difference with thumbnails is that the homeserver doesn't have to process the full-res image, it can just store it as is. But for generating thumbnails, the homeserver has to parse the image, and the billion laughs attack is a well known denial of service attack against XML formats","msgtype":"m.text"},"ts":1623868655811,"senderName":"Andreu Botella (he/they)","senderId":"@andreubotella:mozilla.org","id":"$TRjlwyT3D11rbiHoGQPK6qzEikNHqOtq3WZkfwHpb90"},
{"content":{"body":"https://en.wikipedia.org/wiki/Billion_laughs_attack","msgtype":"m.text"},"ts":1623868703911,"senderName":"Andreu Botella (he/they)","senderId":"@andreubotella:mozilla.org","id":"$21uKAh0pRmTQDexcxIlKyMFdfiLHFZsQ0O1GABVmyRY"},
{"content":{"body":"oh wow, til -- thanks!","msgtype":"m.text"},"ts":1623868951866,"senderName":"DerekNonGeneric","senderId":"@dereknongeneric:mozilla.org","id":"$yp9CK8olImBCpKchGtqfp8g1zYgKy5dHiKbdMSjtr2c"}
]
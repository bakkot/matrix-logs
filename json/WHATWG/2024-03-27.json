[
{"content":{"body":"zcorpan: I think I said as much in that issue?","format":"org.matrix.custom.html","formatted_body":"<a href=\"https://matrix.to/#/@zcorpan:mozilla.org\">zcorpan</a>: I think I said as much in that issue?","m.mentions":{"user_ids":["@zcorpan:mozilla.org"]},"msgtype":"m.text"},"ts":1711520442696,"senderName":"annevk","senderId":"@annevk:matrix.org","id":"$KjU5619SKrDDydTSn_Yo6VISi5_UM8Q3jH_d4DBiROw"},
{"content":{"body":"I agree it was a mistake. I also think that preconnect requiring a definition ahead of time of whether the resource would be CORS-enabled or not is bad. (this may be a Chromium-only requirement, not sure)","m.mentions":{},"msgtype":"m.text"},"ts":1711520725350,"senderName":"Yoav Weiss","senderId":"@yoavweiss:matrix.org","id":"$vuEJIdXL3_ryu09sMDVBm_qs9sx2PjzZbStE23tmqQc"},
{"content":{"body":" * I agree it was a mistake. I also think that preconnect requiring a definition ahead of time of whether the resources eventually fetched on it would be CORS-enabled or not is bad. (this may be a Chromium-only requirement, not sure)","m.mentions":{},"m.new_content":{"body":"I agree it was a mistake. I also think that preconnect requiring a definition ahead of time of whether the resources eventually fetched on it would be CORS-enabled or not is bad. (this may be a Chromium-only requirement, not sure)","m.mentions":{},"msgtype":"m.text"},"m.relates_to":{"event_id":"$vuEJIdXL3_ryu09sMDVBm_qs9sx2PjzZbStE23tmqQc","rel_type":"m.replace"},"msgtype":"m.text"},"ts":1711520751151,"senderName":"Yoav Weiss","senderId":"@yoavweiss:matrix.org","id":"$ajK5Bec4hAWeITOpFszwcXFnR_wsjqRSHNBYT36Apzc"},
{"content":{"body":"I think Firefox got it right at the time, but Chromium net code wasn't amenable to align with that.","m.mentions":{},"msgtype":"m.text"},"ts":1711520841388,"senderName":"Yoav Weiss","senderId":"@yoavweiss:matrix.org","id":"$_RYLytK26ucrAz4L-iyJXsPzGyYQ6YS86H3vf8R71f4"},
{"content":{"body":"I don't even understand how the `crossorigin` was made to apply to same-origin fetches. Was there a brief period where fonts were not fetched with credentials ever or some such?","format":"org.matrix.custom.html","formatted_body":"I don't even understand how the <code>crossorigin</code> was made to apply to same-origin fetches. Was there a brief period where fonts were not fetched with credentials ever or some such?","m.mentions":{},"msgtype":"m.text"},"ts":1711527445455,"senderName":"annevk","senderId":"@annevk:matrix.org","id":"$z7XxD5i5GfQ2NfdYfaYkj0AWxMPpORskvMT35BGB_lA"},
{"content":{"body":"But even then that would be a change to the semantics of the `crossorigin` attribute that I don't think were ever documented.","format":"org.matrix.custom.html","formatted_body":"But even then that would be a change to the semantics of the <code>crossorigin</code> attribute that I don't think were ever documented.","m.mentions":{},"msgtype":"m.text"},"ts":1711527469008,"senderName":"annevk","senderId":"@annevk:matrix.org","id":"$ymDlvYinhYGvkJj1afCIqAc1AyBXvWguX_xLh6rMUoU"},
{"content":{"body":"Yoav Weiss: that's for cross-origin fetches. Those are somewhat more tricky. I forgot what Gecko did exactly there and how sound that was. I suspect all of this might still be broken in various ways.","format":"org.matrix.custom.html","formatted_body":"<a href=\"https://matrix.to/#/@yoavweiss:matrix.org\">Yoav Weiss</a>: that's for cross-origin fetches. Those are somewhat more tricky. I forgot what Gecko did exactly there and how sound that was. I suspect all of this might still be broken in various ways.","m.mentions":{"user_ids":["@yoavweiss:matrix.org"]},"msgtype":"m.text"},"ts":1711527604339,"senderName":"annevk","senderId":"@annevk:matrix.org","id":"$CSLpmnhQeS7w-w7s3XtYC0dSH1FqFiewv028Yc9e-vU"},
{"content":{"body":"For cross-origin fetches, I agree that we should use different connections for CORS and no-CORS resources. But Chromium uses different pools even for same-origin fetches, because of something related to how the redirects work that I don't quite remember now","m.mentions":{},"msgtype":"m.text"},"ts":1711527778212,"senderName":"Yoav Weiss","senderId":"@yoavweiss:matrix.org","id":"$N46AKnZMamgI7LmZwsB4oXwqszcVuag0ESrXIiV-Vps"},
{"content":{"body":"So cors anonymous same-origin fetches do happen with credentials, but over a different connection than a no-cors same-origin fetch","m.mentions":{},"msgtype":"m.text"},"ts":1711527865927,"senderName":"Yoav Weiss","senderId":"@yoavweiss:matrix.org","id":"$A8yKEcdAcIflgeVrXEHxGnhHmz3Ty5hA_40BloNQWLE"},
{"content":{"body":"I don't think you need to use different connections for CORS and no-CORS? Connections are keyed on credentials, not CORS.","m.mentions":{},"msgtype":"m.text"},"ts":1711528074146,"senderName":"annevk","senderId":"@annevk:matrix.org","id":"$DFKRt0M11HNstPoD1E_3Hzt7Je-g9OBdMiToZ-1fXHA"},
{"content":{"body":"annevk: I don't see anyone in the issue agreeing with Yoav Weiss 's proposal in OP to make `as=font` imply `crossorigin=anonymous`","format":"org.matrix.custom.html","formatted_body":"<a href=\"https://matrix.to/#/@annevk:matrix.org\">annevk</a>: I don't see anyone in the issue agreeing with <a href=\"https://matrix.to/#/@yoavweiss:matrix.org\">Yoav Weiss</a> 's proposal in OP to make <code>as=font</code> imply <code>crossorigin=anonymous</code>","m.mentions":{"user_ids":["@annevk:matrix.org","@yoavweiss:matrix.org"]},"msgtype":"m.text"},"ts":1711528267148,"senderName":"zcorpan","senderId":"@zcorpan:mozilla.org","id":"$3pG-7ZvrwEtXeG3930CRf17CCCT8MOTvYH3x4z9Ox5Q"},
{"content":{"body":"annevk: I 100% agree. Chromium net folks at the time disagreed due to reasons that may no longer be applicable. I may try to take a stab at rectifying the situation (but that's orthogonal to Simon's suggestion)","format":"org.matrix.custom.html","formatted_body":"<a href=\"https://matrix.to/#/@annevk:matrix.org\">annevk</a>: I 100% agree. Chromium net folks at the time disagreed due to reasons that may no longer be applicable. I may try to take a stab at rectifying the situation (but that's orthogonal to Simon's suggestion)","m.mentions":{"user_ids":["@annevk:matrix.org"]},"msgtype":"m.text"},"ts":1711528374300,"senderName":"Yoav Weiss","senderId":"@yoavweiss:matrix.org","id":"$0lHCKnEn3KdaKwL3AWJ_JP-j5UNcttKCmb3z0mF4f28"},
{"content":{"body":"(nm, misread)","m.mentions":{},"msgtype":"m.text"},"ts":1711528471522,"senderName":"Yoav Weiss","senderId":"@yoavweiss:matrix.org","id":"$HQhlQLK6Xh--uv_kVtTZsIvFnm6BuRZ9n1MSuGPJIhg"},
{"content":{"body":"Ah okay. So I guess the issue is that by default `preload` sets credentials mode to include? And so for fonts that will do the wrong thing as by default they use credentials mode same-origin.","format":"org.matrix.custom.html","formatted_body":"Ah okay. So I guess the issue is that by default <code>preload</code> sets credentials mode to include? And so for fonts that will do the wrong thing as by default they use credentials mode same-origin.","m.mentions":{},"msgtype":"m.text"},"ts":1711528812972,"senderName":"annevk","senderId":"@annevk:matrix.org","id":"$cKjS8N-CBLoMkCi3doDE8TtxyOXxYE_InBfAkhjJq_M"},
{"content":{"body":"I mean, this also impacts module JavaScript in the same way, no? But perhaps nobody uses that.","m.mentions":{},"msgtype":"m.text"},"ts":1711528851680,"senderName":"annevk","senderId":"@annevk:matrix.org","id":"$Z2jPbn53VFfFHLfihaRaH9bUUnehrQENtnpu6s8k4w4"},
{"content":{"body":"it would impact modules in the same way, but `as=script` is also for classic scripts","format":"org.matrix.custom.html","formatted_body":"it would impact modules in the same way, but <code>as=script</code> is also for classic scripts","m.mentions":{},"msgtype":"m.text"},"ts":1711528887705,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$FzSc4QN3mukh3RcmTY74OqjzIbqMEziDvnfesqpLZQc"},
{"content":{"body":"Right, so maybe `preload` is just kinda broken.","format":"org.matrix.custom.html","formatted_body":"Right, so maybe <code>preload</code> is just kinda broken.","m.mentions":{},"msgtype":"m.text"},"ts":1711528910256,"senderName":"annevk","senderId":"@annevk:matrix.org","id":"$eVgDAHaBw6LfTjQshTCJTWXFOscUo0WaZnG5BBzdBN4"},
{"content":{"body":"that's a bit of a general statement, no?","m.mentions":{},"msgtype":"m.text"},"ts":1711528938226,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$DMg0lR0Qfwiyc3nZ6NtdvxTa7RzrPKEgpRLNyApvWf4"},
{"content":{"body":"It includes \"kinda\", which should offset that.","m.mentions":{},"msgtype":"m.text"},"ts":1711528964761,"senderName":"annevk","senderId":"@annevk:matrix.org","id":"$xhwgPG21gt_8m4MRsGCgG8Y7XlJLF7cx6CdZds5ykVw"},
{"content":{"body":"that's why \"a bit\" of a general statement","m.mentions":{},"msgtype":"m.text"},"ts":1711528980713,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$3F4ipZpOWN_LSB2kCS4xaEMa1EcegV9fOGFb9wPtiKc"},
{"content":{"body":"For fetches that are mode=cors by default, the ergonomics of preload is not great","m.mentions":{},"msgtype":"m.text"},"ts":1711528982134,"senderName":"zcorpan","senderId":"@zcorpan:mozilla.org","id":"$Z2T_USyrO_bXnhEKHIDji898Ci4MfWOiZNszPN8tUTE"},
{"content":{"body":"I think making `as` set the defaults to match the later request is an improvement","format":"org.matrix.custom.html","formatted_body":"I think making <code>as</code> set the defaults to match the later request is an improvement","m.mentions":{},"msgtype":"m.text"},"ts":1711529033626,"senderName":"zcorpan","senderId":"@zcorpan:mozilla.org","id":"$CuDJ2R8aC9xCCfa9UIYNqlLjr_BRlZCNEooyXwCMCV0"},
{"content":{"body":"(mode=cors and credentials mode=same-origin (which admittedly is all of them unless you fiddle with things))","m.mentions":{},"msgtype":"m.text"},"ts":1711529038824,"senderName":"annevk","senderId":"@annevk:matrix.org","id":"$VD-2JIugXxXlAV12KpzXvddn7N-MHuKoBs5zo4oVDlE"},
{"content":{"body":"I'm not sure, that only helps with `font` and thereby masks the issue from developers for even longer.","format":"org.matrix.custom.html","formatted_body":"I'm not sure, that only helps with <code>font</code> and thereby masks the issue from developers for even longer.","m.mentions":{},"msgtype":"m.text"},"ts":1711529077651,"senderName":"annevk","senderId":"@annevk:matrix.org","id":"$cf9alj5bqgrWoWMbkj1M8TKuFvbv_sveZiwNedvZ-UQ"},
{"content":{"body":"In five years you'll get \"why does it work for fonts but not module scripts?\"","m.mentions":{},"msgtype":"m.text"},"ts":1711529103145,"senderName":"annevk","senderId":"@annevk:matrix.org","id":"$-Dwl_mRt6ub_lwI0phMu3qisb1xCvtvsi9UOY7d579I"},
{"content":{"body":"`as=module` ?","format":"org.matrix.custom.html","formatted_body":"<code>as=module</code> ?","m.mentions":{},"msgtype":"m.text"},"ts":1711529117630,"senderName":"zcorpan","senderId":"@zcorpan:mozilla.org","id":"$TFFMFUZx1K09M476Ssm2LSzS2rEC3xD-RLjC9iQMrxg"},
{"content":{"body":"or `modulescript`","format":"org.matrix.custom.html","formatted_body":"or <code>modulescript</code>","m.mentions":{},"msgtype":"m.text"},"ts":1711529126601,"senderName":"zcorpan","senderId":"@zcorpan:mozilla.org","id":"$KLPJspB4BMztT4v4HBM6LzR_dDu6gSbspfhcWbogVLE"},
{"content":{"body":"Maybe, but try to specify that. It goes against the `as` attribute pretty hard.","format":"org.matrix.custom.html","formatted_body":"Maybe, but try to specify that. It goes against the <code>as</code> attribute pretty hard.","m.mentions":{},"msgtype":"m.text"},"ts":1711529155161,"senderName":"annevk","senderId":"@annevk:matrix.org","id":"$BfY8n75Jo4f4OzfHPYbnMG4USY2I4IvG9_PAOqdue3k"},
{"content":{"body":"`as=script type=module`","format":"org.matrix.custom.html","formatted_body":"<code>as=script type=module</code>","m.mentions":{},"msgtype":"m.text"},"ts":1711529172834,"senderName":"zcorpan","senderId":"@zcorpan:mozilla.org","id":"$B_iYPWCIfEcWhNno4-OGKkTpKYYZ3mhwa5YrMtKFXw0"},
{"content":{"body":"`type` is already a mime-type","format":"org.matrix.custom.html","formatted_body":"<code>type</code> is already a mime-type","m.mentions":{},"msgtype":"m.text"},"ts":1711529185349,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$9YVuOb-MNe5vQnnUgssHU9mj4PC7RIm2vhfue2O3fME"},
{"content":{"body":"I think `as=modulescript` would not be that difficult to specify TBH","format":"org.matrix.custom.html","formatted_body":"I think <code>as=modulescript</code> would not be that difficult to specify TBH","m.mentions":{},"msgtype":"m.text"},"ts":1711529210903,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$8kcC8RuTHLvg-K3Jyx9B1x7Oi-omfN7t2HVFF22B0eQ"},
{"content":{"body":"we already translate `fetch` to ``, we can translate `modulescript` to be `script` + default cors","format":"org.matrix.custom.html","formatted_body":"we already translate <code>fetch</code> to ``, we can translate <code>modulescript</code> to be <code>script</code> + default cors","m.mentions":{},"msgtype":"m.text"},"ts":1711529239420,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$gwbK_BmsaQUiOGIMKd6LJCXlATPtF7CSaYDIHDdp0GM"},
{"content":{"body":"Allowing `type=module` could maybe still work? I like that better than `as=modulescript` given how that mismatches with destination and such.","format":"org.matrix.custom.html","formatted_body":"Allowing <code>type=module</code> could maybe still work? I like that better than <code>as=modulescript</code> given how that mismatches with destination and such.","m.mentions":{},"msgtype":"m.text"},"ts":1711529245157,"senderName":"annevk","senderId":"@annevk:matrix.org","id":"$N63rqfJs7iP5pFa3oYeo3xOZLdzFi4F90UkhHrql1Uw"},
{"content":{"body":"Aside: what's Sec-Fetch-Dest for `fetch()`?","format":"org.matrix.custom.html","formatted_body":"Aside: what's Sec-Fetch-Dest for <code>fetch()</code>?","m.mentions":{},"msgtype":"m.text"},"ts":1711529276626,"senderName":"annevk","senderId":"@annevk:matrix.org","id":"$YpijHepyAPrrfnWYzR6oKsaN_SYDZX9navyFKokW5KY"},
{"content":{"body":"Isn't it something like \"empty\"? checking...","m.mentions":{},"msgtype":"m.text"},"ts":1711529297988,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$3Nxfn-0e1BCX4eu8PCt18UnuJNuG0cSAbrV9nn_K404"},
{"content":{"body":"Yeah it is. Ugh.","m.mentions":{},"msgtype":"m.text"},"ts":1711529324329,"senderName":"annevk","senderId":"@annevk:matrix.org","id":"$WAk1n6kEZcfPz38q7tWUaPas5oyKzkPiXl-0-QHmam4"},
{"content":{"body":"pecified here: https://w3c.github.io/webappsec-fetch-metadata/#abstract-opdef-set-dest","m.mentions":{},"msgtype":"m.text"},"ts":1711529473999,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$Uxl_SlKZAryk05KoS9Qf0t7olf9Ta9DMgAQxiovu06A"},
{"content":{"body":"I guess I don't mind `as` impacting these other settings as long as we have a holistic plan for all of them. And the plan should probably involve some MDN updates.","format":"org.matrix.custom.html","formatted_body":"I guess I don't mind <code>as</code> impacting these other settings as long as we have a holistic plan for all of them. And the plan should probably involve some MDN updates.","m.mentions":{},"msgtype":"m.text"},"ts":1711529659692,"senderName":"annevk","senderId":"@annevk:matrix.org","id":"$YGtAG4ZFsfAXHkxKMCqu87M_jnwFg3MZ3NPRkiA12E8"},
{"content":{"body":"modules have `modulepreload` which is defined as a different link rel","format":"org.matrix.custom.html","formatted_body":"modules have <code>modulepreload</code> which is defined as a different link rel","m.mentions":{},"msgtype":"m.text"},"ts":1711530151189,"senderName":"Yoav Weiss","senderId":"@yoavweiss:matrix.org","id":"$AbNzOcmg4l8E3hSuHGu84lhN7T526hzihke2q2qSZxk"},
{"content":{"body":"I think that having `as=font` imply crossorigin anonymous makes sense, and can be done now in a backward compatible way (as folks that don't include it are simply holding it wrong, and have unused preloads) ","format":"org.matrix.custom.html","formatted_body":"I think that having <code>as=font</code> imply crossorigin anonymous makes sense, and can be done now in a backward compatible way (as folks that don't include it are simply holding it wrong, and have unused preloads)","m.mentions":{},"msgtype":"m.text"},"ts":1711530227926,"senderName":"Yoav Weiss","senderId":"@yoavweiss:matrix.org","id":"$HXReIkOq37RvE81y4Fbqaha3hq1KZVxsB2Glw89zYxw"},
{"content":{"body":"We could do the same for `modulepreload` if it doesn't already (I'm not sure, as I wasn't involved)","format":"org.matrix.custom.html","formatted_body":"We could do the same for <code>modulepreload</code> if it doesn't already (I'm not sure, as I wasn't involved)","m.mentions":{},"msgtype":"m.text"},"ts":1711530258494,"senderName":"Yoav Weiss","senderId":"@yoavweiss:matrix.org","id":"$WH_TmXiyxAHjTZ2MMJmTDyOWYW2SrATnpi4kSJo0NHE"}
]
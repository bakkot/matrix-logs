[
{"content":{"body":"QQ - WHATWG is listed on the TPAC agenda -- is there an agenda? Is it likely to be well-attended?","msgtype":"m.text"},"ts":1692155570341,"senderName":"mnot","senderId":"@mnot:matrix.im","id":"$YZ0oZqFzkBfw6AudolUJ-_q7YMfdYhpVHVMDSfCNk74"},
{"content":{"body":" smaug: question re. https://github.com/whatwg/html/issues/9315#issuecomment-1680504091\nIn Gecko, when there is a rAF pending, would that block the first paint when coming back from bfcache?","format":"org.matrix.custom.html","formatted_body":"<a href=\"https://matrix.to/#/@smaug:mozilla.org\">smaug</a>: question re. https://github.com/whatwg/html/issues/9315#issuecomment-1680504091<br>In Gecko, when there is a rAF pending, would that block the first paint when coming back from bfcache?","msgtype":"m.text"},"ts":1692188699568,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$jsjg5wO9Hl6rRvTmCRSqeL2moIbqaNbzUuV3-WiKlBM"},
{"content":{"body":"there shouldn't be rAF pending when coming out of bfcache","msgtype":"m.text"},"ts":1692188741780,"senderName":"smaug","senderId":"@smaug:mozilla.org","id":"$Ok01cEgEMTxo-r0dQKyrLf9FC2nN-vJpZGV6QnM31Sw"},
{"content":{"body":"can't you call `requestAnimationFrame` in pagehide?","format":"org.matrix.custom.html","formatted_body":"can't you call <code>requestAnimationFrame</code> in pagehide?","msgtype":"m.text"},"ts":1692188762736,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$IQ3OYXcBTQek-acia1_5wmv03_WXJbAJB5b8rLbvW6w"},
{"content":{"body":"sure, but the current rendering might be cached","msgtype":"m.text"},"ts":1692188803905,"senderName":"smaug","senderId":"@smaug:mozilla.org","id":"$V64YEuvi4AwPGCFxzDQJKiNIu8u8l--yNcQgufoXLjg"},
{"content":{"body":"and shown to the user and then rAF called","msgtype":"m.text"},"ts":1692188823826,"senderName":"smaug","senderId":"@smaug:mozilla.org","id":"$TwVj4h1parJHoC8gYnJzpX6m79wWPbPY_YMaeDQ2V6w"},
{"content":{"body":"ok, so it's sort of the same as what we're proposing with reveal","msgtype":"m.text"},"ts":1692188843302,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$12Hj_cOmI57aqUeLILuGVCKrQXl_imiZTMXrXvVcoys"},
{"content":{"body":"expect that reveal would force waiting for handling of reveal event before showing anything to the user","msgtype":"m.text"},"ts":1692188885595,"senderName":"smaug","senderId":"@smaug:mozilla.org","id":"$ovTl5_nFBWp5AyavbMcUVAaeh_Mu_61YWffm2vh63Bg"},
{"content":{"body":"it's guaranteed to be called before the next rAF, and in the case of an actual view transition also guaranteed to be before the first paint - but that's because VT holds painting of the new document, not because of the reveal event itself","msgtype":"m.text"},"ts":1692188886633,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$zP8TRwzGAzOGXHK3_aaxxzWl9_NLRrgquaBRYTbPgbk"},
{"content":{"body":"what forces waiting is the fact that there is a view transition, not the reveal event.","msgtype":"m.text"},"ts":1692188902948,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$5pflShxNKWeenAgDjR1Ckl__2YbwLHsrU_UG3WCKUoc"},
{"content":{"body":"if there is a reveal event without a VT - show the cached image, fire the reveal event, fire the rAF callback if it exists, and continue your life","msgtype":"m.text"},"ts":1692188945943,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$3Ehk3PjE0RUNAaMK50FPKIEjoZE38ag__XsjetfTY94"},
{"content":{"body":"Isn't that quite confusing semantics?  In some case reveal would fire when the page has been already revealed to the user and in some case before","msgtype":"m.text"},"ts":1692189026849,"senderName":"smaug","senderId":"@smaug:mozilla.org","id":"$HFI8pHAzjmVKGtlBR4jODP6gAY6-8cA-wA3K2Bvu-no"},
{"content":{"body":"we could also make it wait when there is a reveal event handler, to prevent a flashing effect, if e.g. you're showing a clock","msgtype":"m.text"},"ts":1692189060023,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$Pwre_2u8XYwHrGRMLXuBNYN2nm0XBD-3pEy8OmtPTP0"},
{"content":{"body":"how does pageshow work in that regard btw? doesn't it have the same confusing aspect?","msgtype":"m.text"},"ts":1692189127961,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$W64eCAOiPZPLgKOUhNafkXktzRI0q1M9TYAG7q6-kew"},
{"content":{"body":"Right. I'm just worried about the misuse of the event. Right now bfcache can be really fast, no need to wait for anything.","msgtype":"m.text"},"ts":1692189147500,"senderName":"smaug","senderId":"@smaug:mozilla.org","id":"$noK2hW9Ap2wmv0gsJPABId9Tclu-jNEnVp99VAdqTrk"},
{"content":{"body":"pageshow doesn't have","msgtype":"m.text"},"ts":1692189153896,"senderName":"smaug","senderId":"@smaug:mozilla.org","id":"$uKLdtJbX0YSL7ylAF0S4rX7M5M8Vf1uN1Tve-w5VXC4"},
{"content":{"body":"it has nothing to do with rendering","msgtype":"m.text"},"ts":1692189172188,"senderName":"smaug","senderId":"@smaug:mozilla.org","id":"$YRV_PSbMA_TiBKknQyfHfuCeqbwuxDUlplfqsz8HMs0"},
{"content":{"body":"if reveal does not have anything to do with rendering (in case when view transitions aren't around), then it would be just a duplicate of pageshow. Which would be a bit weird. ","msgtype":"m.text"},"ts":1692189366233,"senderName":"smaug","senderId":"@smaug:mozilla.org","id":"$P-kG1k2LbSyjfPmsaLIDq2BdA1rvYZBnPRETWGVshOc"},
{"content":{"body":"Could we possible have an event specific to view transitions?","msgtype":"m.text"},"ts":1692189437594,"senderName":"smaug","senderId":"@smaug:mozilla.org","id":"$S9VURiZj3Nx5kRqU83inhuPCn03QbmIK2m6xvd9q6QI"},
{"content":{"body":"Since those anyhow slow down the process of coming out of bfcache or animate that.","msgtype":"m.text"},"ts":1692189464786,"senderName":"smaug","senderId":"@smaug:mozilla.org","id":"$rpsFWFWbwXWBPIGETWlTSBOGoYOLyIOUC1iYPuZTS0A"},
{"content":{"body":" * Could we possible have an event specific to view transitions? (just a thought)","m.new_content":{"body":"Could we possible have an event specific to view transitions? (just a thought)","msgtype":"m.text"},"m.relates_to":{"event_id":"$S9VURiZj3Nx5kRqU83inhuPCn03QbmIK2m6xvd9q6QI","rel_type":"m.replace"},"msgtype":"m.text"},"ts":1692189474770,"senderName":"smaug","senderId":"@smaug:mozilla.org","id":"$dcwP7SpJAcNeew84YPla6D3zMSu4lcBwjvZ1tioe3d4"},
{"content":{"body":"The problem with an event specific to view transitions, is that it can be error prone in the sense that you might be expect a VT, but perhaps something in the old document prevented a VT from happening","msgtype":"m.text"},"ts":1692189479915,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$y5q40YK777FvMGKiYnQjY3sF0m1IhwuSXbe8GuACyw4"},
{"content":{"body":"don't you want then some notification that VT didn't happen?","msgtype":"m.text"},"ts":1692189618547,"senderName":"smaug","senderId":"@smaug:mozilla.org","id":"$DZZBUnIiHp38gBXLZuZBcHrWjXUWBQ2GeHJdGNpn8ZU"},
{"content":{"body":"what would that look like? wouldn't that be the same as a reveal event with a null VT?","msgtype":"m.text"},"ts":1692189639590,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$8im_L6tpp5KeWdVuD5TcNZS9YO4sW84AsSCL4RfLgKg"},
{"content":{"body":"maybe, but it would fire only if the page was trying to use vt or something","msgtype":"m.text"},"ts":1692189674335,"senderName":"smaug","senderId":"@smaug:mozilla.org","id":"$J8QMlvoar-Pt2CmFO9YfeVmLm1sn0iHMz38WGZx8k4U"},
{"content":{"body":"yea perhaps we could fire it only when the page has opted-in to view transitions and find a VT-specific name. let me think this over","msgtype":"m.text"},"ts":1692189788678,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$KggmYnvK1W9v1VgeLF5f6ho8eSzJLSXDrQk38WIDYLc"},
{"content":{"body":"smaug: though I still think that `pageshow` already has this same inconsistent aspect (can be before or after first frame), and having an additional event there wouldn't make it more confusing. I don't exactly get what it means that `pageshow` has nothing to do with rendering. In the BFCache-restore case it has as much to do with rendering as `reveal`.\n\nWhat we were proposing is something that matches `pageshow` exactly, except it's not gated on `load`, and instead gated on document no longer being render-blocked.","format":"org.matrix.custom.html","formatted_body":"<p><a href=\"https://matrix.to/#/@smaug:mozilla.org\">smaug</a>: though I still think that <code>pageshow</code> already has this same inconsistent aspect (can be before or after first frame), and having an additional event there wouldn't make it more confusing. I don't exactly get what it means that <code>pageshow</code> has nothing to do with rendering. In the BFCache-restore case it has as much to do with rendering as <code>reveal</code>.</p>\n<p>What we were proposing is something that matches <code>pageshow</code> exactly, except it's not gated on <code>load</code>, and instead gated on document no longer being render-blocked.</p>\n","msgtype":"m.text"},"ts":1692191251517,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$cIHzJ0GHoxWXxk8-nqya27Cm5o2gCsHpDSBW4slFfB4"},
{"content":{"body":"pageshow has nothing to do with rendering","msgtype":"m.text"},"ts":1692191280354,"senderName":"smaug","senderId":"@smaug:mozilla.org","id":"$B5JqPmrdQzHG8hjq8ojlb6KXmGwMcCMcHQwVvOATSwE"},
{"content":{"body":"it is just to tell that page came out of bfcache, or in case of initial page load, it replicated load event","msgtype":"m.text"},"ts":1692191313544,"senderName":"smaug","senderId":"@smaug:mozilla.org","id":"$UVI3grKcoM3zpoSSScXLDkFLXv9le1QvTsnO-DmdeM4"},
{"content":{"body":" * it is just to tell that page came out of bfcache, or in case of initial page load, it replicatea load event","m.new_content":{"body":"it is just to tell that page came out of bfcache, or in case of initial page load, it replicatea load event","msgtype":"m.text"},"m.relates_to":{"event_id":"$UVI3grKcoM3zpoSSScXLDkFLXv9le1QvTsnO-DmdeM4","rel_type":"m.replace"},"msgtype":"m.text"},"ts":1692191320184,"senderName":"smaug","senderId":"@smaug:mozilla.org","id":"$PGdkWgACoBM_t7fwBKecDWVtk-aXRV01Tmf0xc2RLKM"},
{"content":{"body":" * it is just to tell that page came out of bfcache, or in case of initial page load, it replicates load event","m.new_content":{"body":"it is just to tell that page came out of bfcache, or in case of initial page load, it replicates load event","msgtype":"m.text"},"m.relates_to":{"event_id":"$UVI3grKcoM3zpoSSScXLDkFLXv9le1QvTsnO-DmdeM4","rel_type":"m.replace"},"msgtype":"m.text"},"ts":1692191325945,"senderName":"smaug","senderId":"@smaug:mozilla.org","id":"$x_Dr_VaUEOvtC98VyYrLO7JniqH1IqVbfW1j_5GaDis"},
{"content":{"body":"pageshow predates anything like rAF for quite a few years.","msgtype":"m.text"},"ts":1692191887398,"senderName":"smaug","senderId":"@smaug:mozilla.org","id":"$lGCVH-FabdfWuemA-ZCIv7C-b6s_wKwFWjDEfRovczU"},
{"content":{"body":"regardless of their purpose, in the case of VT both pageshow and rAF callback would have a different behavior based on whether there is an actual VT or not, and unlike pageshow, rAF is very related to rendering","msgtype":"m.text"},"ts":1692191963890,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$7dRcGYGkHYoyrpCI8wSavlM98uxeI7W0iYqQRdlPg-o"},
{"content":{"body":"why would the behavior of pageshow change in case there is vt around?","msgtype":"m.text"},"ts":1692192089874,"senderName":"smaug","senderId":"@smaug:mozilla.org","id":"$HfP3vv37E0jKT3FVn7fnvD4lY5NTYHyxL-tCgFQJd7U"},
{"content":{"body":"as in, if you call rAF on pagehide, and then restore from BFCache, you might or might not see the previous frame again, based on whether you have a VT","msgtype":"m.text"},"ts":1692192102098,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$dBJ-kKs_yvGBPurvTRJDtFI8O1UGOMT0h5mSS-oUti4"},
{"content":{"body":"same with pageshow. When there is a VT, the first frame always waits for the main thread, and the first task in the main thread is to fire pageshow","msgtype":"m.text"},"ts":1692192140071,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$eGCJ8QX9A6a7c0alD5vUkt13hrtMebdQMVN3vg9AZKA"},
{"content":{"body":"so VT: pageshow is before first frame, no VT: pageshow is potentially after cached first frame","msgtype":"m.text"},"ts":1692192192424,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$s_S6ibTooovgkP_cT-wGP_Zgg6cQP8jfHLQ7ERmSJi4"},
{"content":{"body":"reveal is not different","msgtype":"m.text"},"ts":1692192196578,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$4jTYxDK8JQTNvdPSUf6vnVA8aJqEPDjWgKbWYKBBX50"},
{"content":{"body":"(or it could be, but then we risk misuse as you say)","msgtype":"m.text"},"ts":1692192207828,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$l1waVYlqKC284JmuGr67smau670AFTxv_55qHnyLc3c"},
{"content":{"body":"> <@domfarolino:matrix.org> I didn't write that test, so I'll try and reach out to the Googler that did and see if he can explain.\n\nThanks. And sorry for not checking blame. I saw your name in a comment that suggested perhaps even removing the test that my patch failed.","format":"org.matrix.custom.html","formatted_body":"<mx-reply><blockquote><a href=\"https://matrix.to/#/!AGetWbsMpFPdSgUrbs:matrix.org/$oXwhL9kR-guhpQmdMFLspCywwV0s5VP1z1eX85OZ6wA?via=matrix.org&via=mozilla.org&via=igalia.com\">In reply to</a> <a href=\"https://matrix.to/#/@domfarolino:matrix.org\">@domfarolino:matrix.org</a><br>I didn&#39;t write that test, so I&#39;ll try and reach out to the Googler that did and see if he can explain.</blockquote></mx-reply>Thanks. And sorry for not checking blame. I saw your name in a comment that suggested perhaps even removing the test that my patch failed.","m.relates_to":{"m.in_reply_to":{"event_id":"$oXwhL9kR-guhpQmdMFLspCywwV0s5VP1z1eX85OZ6wA"}},"msgtype":"m.text"},"ts":1692192296130,"senderName":"hsivonen","senderId":"@hsivonen:mozilla.org","id":"$jM8Oxysw1gRFn8Y5ly4-pZqjtwiMFpinYvcchBetcC0"},
{"content":{"body":"smaug: So I get why it's confusing, but it's also consistent with the existing rendering-related callback when restoring from BFCache, which is the first rAF. btw I believe this would be also consistent with `ResizeObserver `and `IntersectionObserver` callbacks (at least per spec), and they would also currently have this confusing behavior of sometimes being called after the previous frame, and they're rendering related.","format":"org.matrix.custom.html","formatted_body":"<a href=\"https://matrix.to/#/@smaug:mozilla.org\">smaug</a>: So I get why it's confusing, but it's also consistent with the existing rendering-related callback when restoring from BFCache, which is the first rAF. btw I believe this would be also consistent with <code>ResizeObserver </code>and <code>IntersectionObserver</code> callbacks (at least per spec), and they would also currently have this confusing behavior of sometimes being called after the previous frame, and they're rendering related.","msgtype":"m.text"},"ts":1692192537219,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$ysHuhZ_kMjSYSFCRg8C_6bWJg_t_4UjayxEJ6kG_gGA"},
{"content":{"body":"Those just run when rendering updates happen.  reveal on the other hand sounds like something which is bound to the first paint, and if it sometimes fires before and sometimes after paint, that is confusing. ","msgtype":"m.text"},"ts":1692193932749,"senderName":"smaug","senderId":"@smaug:mozilla.org","id":"$xbQaJMwcp4E3o4H5kYkJbxewAAGNe6_NTD9522aezbs"}
]
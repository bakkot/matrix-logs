[
{"content":{"body":"Noam Rosenthal: why does https://html.spec.whatwg.org/#prepare-an-image-for-presentation return early in several steps, without getting to one of step 14 or 15? Also step 16 is only run if no other step returns.","format":"org.matrix.custom.html","formatted_body":"<a href=\"https://matrix.to/#/@noamr:matrix.org\">Noam Rosenthal</a>: why does https://html.spec.whatwg.org/#prepare-an-image-for-presentation return early in several steps, without getting to one of step 14 or 15? Also step 16 is only run if no other step returns.","m.mentions":{"user_ids":["@noamr:matrix.org"]},"msgtype":"m.text"},"ts":1760352762488,"senderName":"zcorpan","senderId":"@zcorpan:mozilla.org","id":"$D0dGGcLaj4t1Cnb2Xq6acDpkhFLT4cBpLAJ-BFJ41kc"},
{"content":{"body":"will take a look. Haven't touched that since 2020.","m.mentions":{"user_ids":["@zcorpan:mozilla.org"]},"m.relates_to":{"m.in_reply_to":{"event_id":"$D0dGGcLaj4t1Cnb2Xq6acDpkhFLT4cBpLAJ-BFJ41kc"}},"msgtype":"m.text"},"ts":1760352827149,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$Pzhr4AQ0JiLLuI-XsGuZLN7AI2fPKDDCXEZoJyO8UUY"},
{"content":{"body":"Regarding step 16 - it's perhaps ambiguous from reading but this step is optional... it's not like the image is not going to be presented without it. Step 16 is like saying \"adjust the image presentation, now that the preferred density-correction dimensions are set\"","m.mentions":{},"m.relates_to":{"m.in_reply_to":{"event_id":"$Pzhr4AQ0JiLLuI-XsGuZLN7AI2fPKDDCXEZoJyO8UUY"}},"msgtype":"m.text"},"ts":1760353041140,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$bb_gsfpbFECQGWntWwwpf9CrGoRsKYy94gcCOJZSTBc"},
{"content":{"body":"Steps 8, 9, 10: it was a mitigation to having the density set accidentally due to e.g. EXIF information being copied around.\nRequiring the dimensions to have positive numbers and only use inches narrows the spectrum for accidental density setting.\nWe can reason about making it more lax, it was a bit of a judgement call at the time","m.mentions":{},"msgtype":"m.text"},"ts":1760353164033,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$kQxjierM2Z2llmUhLnEuH2Vy7BLA0jHXeheTktAKH2w"},
{"content":{"body":"Noam Rosenthal: so then PixelXDimension and PixelYDimension are also ignored for the early return cases","format":"org.matrix.custom.html","formatted_body":"<a href=\"https://matrix.to/#/@noamr:matrix.org\">Noam Rosenthal</a>: so then PixelXDimension and PixelYDimension are also ignored for the early return cases","m.mentions":{"user_ids":["@noamr:matrix.org"]},"msgtype":"m.text"},"ts":1760353266950,"senderName":"zcorpan","senderId":"@zcorpan:mozilla.org","id":"$XhVEAvBXcQ-u5nHElPyNQ_9aWH4TD-XXV8Ubj4qlRzc"},
{"content":{"body":"yea they are","m.mentions":{},"msgtype":"m.text"},"ts":1760353280621,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$PK1NYymzHYhVrGuWT-T8Zw8kHVY5phBM5uKMYgOKv8U"},
{"content":{"body":"it's like \"this is accidental EXIF information\"","m.mentions":{},"msgtype":"m.text"},"ts":1760353294369,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$q0D5x5jtpR7C9YmUt1HSf7CgqaxMNqDf5LbYQBDWuwM"},
{"content":{"body":"I see, thanks. It's still not clear to me that step 16 is not important, as it was the text in place of this algorithm before. It can be read as \"don't render cross-origin images\" or \"don't render images with bogus EXIF\"","m.mentions":{},"msgtype":"m.text"},"ts":1760353397354,"senderName":"zcorpan","senderId":"@zcorpan:mozilla.org","id":"$WZv-nDTBQm6JMaflrajbtPi8oVZ8NLeXoVacNVMWwVc"},
{"content":{"body":"I'll file an issue","m.mentions":{},"msgtype":"m.text"},"ts":1760353467589,"senderName":"zcorpan","senderId":"@zcorpan:mozilla.org","id":"$lyUDVcK34p38Wsdzphe8Lize8pQY7ymTzaBzhIG5mGY"},
{"content":{"body":"Agreed, it can&should be made clearer. If you file an issue I'm happy to file a PR","m.mentions":{"user_ids":["@zcorpan:mozilla.org"]},"m.relates_to":{"m.in_reply_to":{"event_id":"$WZv-nDTBQm6JMaflrajbtPi8oVZ8NLeXoVacNVMWwVc"}},"msgtype":"m.text"},"ts":1760353539502,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$nZDHOoo-GyGDfevY38MSH8YEZpJ-Fdv9VseSVFSiMnw"},
{"content":{"body":"Noam Rosenthal: https://github.com/whatwg/html/issues/11777","format":"org.matrix.custom.html","formatted_body":"<a href=\"https://matrix.to/#/@noamr:matrix.org\">Noam Rosenthal</a>: https://github.com/whatwg/html/issues/11777","m.mentions":{"user_ids":["@noamr:matrix.org"]},"msgtype":"m.text"},"ts":1760353703812,"senderName":"zcorpan","senderId":"@zcorpan:mozilla.org","id":"$zfeMxP4uC1LNwgqa_-3pyVnbkErDiLAXk4R8mF4O-Fc"},
{"content":{"body":"Noam Rosenthal: Reviewing [#11762](https://github.com/whatwg/html/pull/11762) right now, thanks for working on this! I like the idea of passing the upcoming tracker into the event firing mechanism, but now I wonder if we need to keep the upcoming trackers in the global state at all, or if we can get away with just passing them around. That way we're less prone to accidentally breaking global state. \nThe only reason I see currently (I may be wrong though) why we need the `upcoming non-traverse API method tracker` would be to signal that navigation has aborted ([this step in `navigate()`](https://html.spec.whatwg.org/#dom-navigation-navigate:~:text=If%20this%27s%20upcoming%20non%2Dtraverse%20API%20method%20tracker%20is%20apiMethodTracker%2C%20then)), but I bet we can transport this information in another fashion (which may even be easier to understand). \nWDYT?","format":"org.matrix.custom.html","formatted_body":"<a href=\"https://matrix.to/#/@noamr:matrix.org\">Noam Rosenthal</a>: Reviewing <a href=\"https://github.com/whatwg/html/pull/11762\">#11762</a> right now, thanks for working on this! I like the idea of passing the upcoming tracker into the event firing mechanism, but now I wonder if we need to keep the upcoming trackers in the global state at all, or if we can get away with just passing them around. That way we're less prone to accidentally breaking global state.<br>The only reason I see currently (I may be wrong though) why we need the <code>upcoming non-traverse API method tracker</code> would be to signal that navigation has aborted (<a href=\"https://html.spec.whatwg.org/#dom-navigation-navigate:~:text=If%20this%27s%20upcoming%20non%2Dtraverse%20API%20method%20tracker%20is%20apiMethodTracker%2C%20then\">this step in <code>navigate()</code></a>), but I bet we can transport this information in another fashion (which may even be easier to understand).<br>WDYT?","m.mentions":{"user_ids":["@noamr:matrix.org"]},"msgtype":"m.text"},"ts":1760358401187,"senderName":"jjaschke","senderId":"@jjaschke:mozilla.org","id":"$RtFdGccZAVX7NJ-zpxDBLd6-kOOIqXko-0nSM3kJyFg"},
{"content":{"body":"Yea it would be great not to have those tidbits of global state... let me scan it a few times :)","m.mentions":{"user_ids":["@jjaschke:mozilla.org"]},"m.relates_to":{"m.in_reply_to":{"event_id":"$RtFdGccZAVX7NJ-zpxDBLd6-kOOIqXko-0nSM3kJyFg"}},"msgtype":"m.text"},"ts":1760358771111,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$-4-9K240joTsZueAExZI4WgfPGrMVOzaf1S0rjL9UZo"},
{"content":{"body":"Oh, also just noticed, the promote upcoming to ongoing algorithm that you inlined is also used in [reload()](https://html.spec.whatwg.org/#navigation-api-initiating-navigations:reload-2:~:text=Let%20apiMethodTracker%20be%20the%20result%20of%20maybe%20setting%20the%20upcoming%20non%2Dtraverse%20API%20method%20tracker%20for%20this%20given%20info%20and%20serializedState%2E,-Reload).","format":"org.matrix.custom.html","formatted_body":"Oh, also just noticed, the promote upcoming to ongoing algorithm that you inlined is also used in <a href=\"https://html.spec.whatwg.org/#navigation-api-initiating-navigations:reload-2:~:text=Let%20apiMethodTracker%20be%20the%20result%20of%20maybe%20setting%20the%20upcoming%20non%2Dtraverse%20API%20method%20tracker%20for%20this%20given%20info%20and%20serializedState%2E,-Reload\">reload()</a>.","m.mentions":{},"msgtype":"m.text"},"ts":1760358838758,"senderName":"jjaschke","senderId":"@jjaschke:mozilla.org","id":"$mLEODH7OUwTc9UW2Q5K5UlbX6cYZ8Ad01q3Ayegx0C4"},
{"content":{"body":"THat's not that algo, it's \"maybe setting\", not \"promote\". There was only one use of \"promote\"","m.mentions":{"user_ids":["@jjaschke:mozilla.org"]},"m.relates_to":{"m.in_reply_to":{"event_id":"$mLEODH7OUwTc9UW2Q5K5UlbX6cYZ8Ad01q3Ayegx0C4"}},"msgtype":"m.text"},"ts":1760359169910,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$ib5GQFRmvwA5dvgoAIn9z-97RL6k7IOvj3fkbU5138o"},
{"content":{"body":"I think `navigate` can have a return value of whether the navigation was aborted prior to the promotion step","format":"org.matrix.custom.html","formatted_body":"I think <code>navigate</code> can have a return value of whether the navigation was aborted prior to the promotion step","m.mentions":{"user_ids":["@jjaschke:mozilla.org"]},"m.relates_to":{"m.in_reply_to":{"event_id":"$RtFdGccZAVX7NJ-zpxDBLd6-kOOIqXko-0nSM3kJyFg"}},"msgtype":"m.text"},"ts":1760359206788,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$320ekRBnOd3CWmD5jSnwNJN4JSZUHomdTy9PXMb1248"}
]
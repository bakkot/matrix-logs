[
{"content":{"body":"Huh, yeah, that's confusing. I don't know enough about wattsi to debug that.","m.mentions":{"user_ids":["@zcorpan:mozilla.org"]},"m.relates_to":{"m.in_reply_to":{"event_id":"$nJ9gG7fzuUBFarbgEQe2lb1_2eS0UJYifkJO8866tME"}},"msgtype":"m.text"},"ts":1736986697629,"senderName":"TabAtkins","senderId":"@tabatkins:matrix.org","id":"$D2-6FzvsCMmJdmJy6h5gbtMyTfdqyj7PZ3gGn8rdSok"},
{"content":{"body":"I remember I did test locally when pushing that change and it did work, in fact, running *html-build* `build.sh --remote` on my machine today does generate the proper class and renders fine for me. The issue might be in the building-pipes.","format":"org.matrix.custom.html","formatted_body":"I remember I did test locally when pushing that change and it did work, in fact, running <em>html-build</em> <code>build.sh --remote</code> on my machine today does generate the proper class and renders fine for me. The issue might be in the building-pipes.","m.mentions":{"user_ids":["@tabatkins:matrix.org","@zcorpan:mozilla.org"]},"m.relates_to":{"m.in_reply_to":{"event_id":"$D2-6FzvsCMmJdmJy6h5gbtMyTfdqyj7PZ3gGn8rdSok"}},"msgtype":"m.text"},"ts":1736988505539,"senderName":"Kaiido","senderId":"@kaiido:matrix.org","id":"$-_O7jEEoMTlD_OfxShQFEBLJVzo48jayxup313w-ysk"},
{"content":{"body":"Hmmm probably it's because https://github.com/orgs/whatwg/packages?repo_name=html-build doesn't rebuild after Wattsi improvements","m.mentions":{},"msgtype":"m.text"},"ts":1736991714406,"senderName":"Domenic","senderId":"@domenicdenicola:matrix.org","id":"$v3qWJdR3yIM-xkmPZpFah5kt-dpG9QtTFEW88ZYjO7I"},
{"content":{"body":"I thought we had an open issue on that somewhere","m.mentions":{},"msgtype":"m.text"},"ts":1736991719635,"senderName":"Domenic","senderId":"@domenicdenicola:matrix.org","id":"$WUdclt2ufLnEWGf88U7XJvk3d81ef_aXHoEfJH5WrX0"},
{"content":{"body":"I wish I knew Docker well enough to know how this is supposed to work","m.mentions":{},"msgtype":"m.text"},"ts":1736991763578,"senderName":"Domenic","senderId":"@domenicdenicola:matrix.org","id":"$tMk02WCGtOgZvI9APRU1lr8PNEiPkzba77Ilo5tFMb4"},
{"content":{"body":"Like ideally html-build would have some minimum wattsi version in a file (like Node.js package.json or similar) and we could bump that file and that would force a rebuild.","m.mentions":{},"msgtype":"m.text"},"ts":1736991800150,"senderName":"Domenic","senderId":"@domenicdenicola:matrix.org","id":"$_bhMSUi7qTereUOe6lfcmm5kx2FWXA6ZelYCCrjuD60"},
{"content":{"body":"But right now the html-build -> wattsi dependency is expressed via https://github.com/whatwg/html-build/blob/main/ci-build/Dockerfile#L28 (`COPY --from=ghcr.io/whatwg/wattsi:latest`) which is good if html-build and Wattsi are both revved frequently but not good in this case.","format":"org.matrix.custom.html","formatted_body":"But right now the html-build -&gt; wattsi dependency is expressed via https://github.com/whatwg/html-build/blob/main/ci-build/Dockerfile#L28 (<code>COPY --from=ghcr.io/whatwg/wattsi:latest</code>) which is good if html-build and Wattsi are both revved frequently but not good in this case.","m.mentions":{},"msgtype":"m.text"},"ts":1736991866087,"senderName":"Domenic","senderId":"@domenicdenicola:matrix.org","id":"$7hcGYzqItWEAm5qVy8oRRwqloxF2g7lZ2tH67vSWbLE"},
{"content":{"body":"I believe docker-compose is possibly the relevant tool here but I have not learned it or how to integrate it into our GitHub actions pipeline...","m.mentions":{},"msgtype":"m.text"},"ts":1736991893641,"senderName":"Domenic","senderId":"@domenicdenicola:matrix.org","id":"$dVUdWQ3zLryO9COhs79HDyh95KsxL4wbsEz7vBNySSY"},
{"content":{"body":"Domenic: https://github.com/whatwg/html/pull/10737 strictly speaking doesn't have multi-implementer interest","format":"org.matrix.custom.html","formatted_body":"<a href=\"https://matrix.to/#/@domenicdenicola:matrix.org\">Domenic</a>: https://github.com/whatwg/html/pull/10737 strictly speaking doesn't have multi-implementer interest","m.mentions":{"user_ids":["@domenicdenicola:matrix.org"]},"msgtype":"m.text"},"ts":1737014309080,"senderName":"annevk","senderId":"@annevk:matrix.org","id":"$ens1-NtGba5DWCt-MHmfYJMqFuFI1tS5qfwV2pamtKQ"},
{"content":{"body":"Oh no :(. When someone tells me \"ping, all the boxes are checked\" on a PR that's been open for months, I'm inclined to take them at their word :(","m.mentions":{},"msgtype":"m.text"},"ts":1737014348384,"senderName":"Domenic","senderId":"@domenicdenicola:matrix.org","id":"$-Rtr2HfPNEeUYnRjcrtRqm_-WdMPvIsC-dN1VHsCig8"},
{"content":{"body":"I see now that was a mistake","m.mentions":{},"msgtype":"m.text"},"ts":1737014352765,"senderName":"Domenic","senderId":"@domenicdenicola:matrix.org","id":"$emWB5fRalfbrF64biCt20YZrZKmeN_iFYYkACwxIr3s"},
{"content":{"body":"I think this is the second time this has happened with Mason. I suggest to no longer do that with him.","m.mentions":{},"msgtype":"m.text"},"ts":1737014370498,"senderName":"annevk","senderId":"@annevk:matrix.org","id":"$pxibBs8BVWzBS8EGdt8UQ-DZ7m1SrPC7iQA5udN0Mr0"},
{"content":{"body":"Ugh wow that box is definitely checked in error, yeah","m.mentions":{},"msgtype":"m.text"},"ts":1737014378341,"senderName":"Domenic","senderId":"@domenicdenicola:matrix.org","id":"$Ly7wmT5t8Q-bpFIvIkTCJcmhrq5GlrvTxnJVc6fiJ6A"},
{"content":{"body":"Should we revert?","m.mentions":{},"msgtype":"m.text"},"ts":1737014407811,"senderName":"Domenic","senderId":"@domenicdenicola:matrix.org","id":"$9yk4BjMe9JuVCuHLDD4-x6sd4eXns1aque-CGRrVMXU"},
{"content":{"body":"I think it's probably okay, unless Mozilla has some objection to it. Need to think about it a bit more.","m.mentions":{},"msgtype":"m.text"},"ts":1737014450670,"senderName":"annevk","senderId":"@annevk:matrix.org","id":"$K_08F5gCiqnLh-_TouTuRQOmzzjI97M7GIUeP7INwjs"},
{"content":{"body":"smaug: zcorpan: ^^","format":"org.matrix.custom.html","formatted_body":"<a href=\"https://matrix.to/#/@smaug:mozilla.org\">smaug</a>: <a href=\"https://matrix.to/#/@zcorpan:mozilla.org\">zcorpan</a>: ^^","m.mentions":{"user_ids":["@smaug:mozilla.org","@zcorpan:mozilla.org"]},"msgtype":"m.text"},"ts":1737014460585,"senderName":"annevk","senderId":"@annevk:matrix.org","id":"$Zq8AqC5wSsN1Ukx76dVlmhPGDN-j_SNnma3KgMH71io"},
{"content":{"body":"One related thing to microtasks/promises... I encountered a few times the issue that if you `resolve` a promise from platform code, the promise reactions would only run at the end of the task. This is confusing if you have a task that does multiple things that might have reactions or callbacks, like the rendering task. I thought to generalize it where HTML would have its own `resolve` that resolves the promise inside a \"run/cleanup script\" scope and specs should be calling that instead of the WebIDL resolve. Wonder what smaug / Domenic think about this","format":"org.matrix.custom.html","formatted_body":"One related thing to microtasks/promises... I encountered a few times the issue that if you <code>resolve</code> a promise from platform code, the promise reactions would only run at the end of the task. This is confusing if you have a task that does multiple things that might have reactions or callbacks, like the rendering task. I thought to generalize it where HTML would have its own <code>resolve</code> that resolves the promise inside a \"run/cleanup script\" scope and specs should be calling that instead of the WebIDL resolve. Wonder what <a href=\"https://matrix.to/#/@smaug:mozilla.org\">smaug</a> / <a href=\"https://matrix.to/#/@domenicdenicola:matrix.org\">Domenic</a> think about this","m.mentions":{"user_ids":["@smaug:mozilla.org","@domenicdenicola:matrix.org"]},"msgtype":"m.text"},"ts":1737016166462,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$MrhZoTeabwR0MYadrJ5VuDgmu0fI7uG_r45QIoCslRo"},
{"content":{"body":"Kinda like what I had to do in step #5 of https://html.spec.whatwg.org/multipage/browsing-the-web.html#reveal","m.mentions":{},"msgtype":"m.text"},"ts":1737016251884,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$udasvlkI_NtdSRPVVSBcFJHGAJAsEL5da7c5abDejYA"},
{"content":{"body":"From the perspective of how they were introduced for mutation observers, it would seem bad if you don't delay them until the end of rendering, as the reactions might incur new things that require rendering.","m.mentions":{},"msgtype":"m.text"},"ts":1737016419563,"senderName":"annevk","senderId":"@annevk:matrix.org","id":"$DPjpEHg5sfLrC_8c4MqyeiEhSt5PC0rvfxljZQSJ418"},
{"content":{"body":"but we already do that when firing events","m.mentions":{},"msgtype":"m.text"},"ts":1737016461184,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$ZywcSeYjP9dCR5fzQahM5_Z16G2KFqj1M5s6kzNieHs"},
{"content":{"body":"also each rAF callback clears the microtask queue and might incur new things that require rendering etc...","m.mentions":{},"msgtype":"m.text"},"ts":1737016562501,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$pNYPUzObAug3aoBZ5snuXxsQBQ7kCLrJEXkWL-yza2c"},
{"content":{"body":"Well yes, but that's why we moved from mutation events to mutation observers. So to then suggest that promises should work like events feels a bit backwards.","m.mentions":{},"msgtype":"m.text"},"ts":1737016611901,"senderName":"annevk","senderId":"@annevk:matrix.org","id":"$wCNmt9R0_jmT8SzH2o_zEok6SBuio_t1RS_9E-CNx54"},
{"content":{"body":"If you don't want promise-timing, don't use a promise.","m.mentions":{},"msgtype":"m.text"},"ts":1737016652721,"senderName":"annevk","senderId":"@annevk:matrix.org","id":"$sK92J8HnyjM95yAehF_jFIAIOwpscOwP7qIZm0pZ0sY"}
]
[
{"content":{"body":"annevk: https://twitter.com/jub0bs/status/1432025056234835980","format":"org.matrix.custom.html","formatted_body":"<a href=\"https://matrix.to/#/@annevk:mozilla.org\">annevk</a>: https://twitter.com/jub0bs/status/1432025056234835980","msgtype":"m.text"},"ts":1630636616259,"senderName":"sideshowbarker","senderId":"@sideshowbarker:mozilla.org","id":"$6NQJ_B9Mz9wbCL9PGKvMjWqCvR8Ji7_13UvKnnLZCPY"},
{"content":{"body":"that's what we call a \"simple request\" though, isn't it? Also looking at https://twitter.com/bcrypt/status/1422243807328804882 and responses in the thread (e.g., https://twitter.com/shhnjk/status/1423013294860767237)","msgtype":"m.text"},"ts":1630648815807,"senderName":"freddy","senderId":"@fbraun:mozilla.org","id":"$vq_gfxG2kopPpYMubft_I1AA8l07QfVK4Qyh9xCAJ3M"},
{"content":{"body":"freddy: yeah I know;\n* per-spec it’s a simple request since the “essence” of the Content-Type header is `text/plain`, and\n* any server that’s treating a request body with `text/plain; application/json` as JSON has broken content-type handling that should be fixed\n…but I think in practice there are many servers that have broken content-type handling for JSON","format":"org.matrix.custom.html","formatted_body":"<p><a href=\"https://matrix.to/#/@fbraun:mozilla.org\">freddy</a>: yeah I know;</p>\n<ul>\n<li>per-spec it’s a simple request since the “essence” of the Content-Type header is <code>text/plain</code>, and</li>\n<li>any server that’s treating a request body with <code>text/plain; application/json</code> as JSON has broken content-type handling that should be fixed<br>…but I think in practice there are many servers that have broken content-type handling for JSON</li>\n</ul>\n","msgtype":"m.text"},"ts":1630650487565,"senderName":"sideshowbarker","senderId":"@sideshowbarker:mozilla.org","id":"$J2xtJdLTUbhLZuOh9IOg07eNOGnauWB4-_jWOPiySVc"},
{"content":{"body":" * freddy: yeah I know;\n- per-spec it’s a simple request since the “essence” of the Content-Type header is `text/plain`, and\n- any server that’s treating a request body with `text/plain; application/json` as JSON has broken content-type handling that should be fixed\n\n…but I think in practice there are many servers that have broken content-type handling for JSON","format":"org.matrix.custom.html","formatted_body":" * <p><a href=\"https://matrix.to/#/@fbraun:mozilla.org\">freddy</a>: yeah I know;</p>\n<ul>\n<li>per-spec it’s a simple request since the “essence” of the Content-Type header is <code>text/plain</code>, and</li>\n<li>any server that’s treating a request body with <code>text/plain; application/json</code> as JSON has broken content-type handling that should be fixed</li>\n</ul>\n<p>…but I think in practice there are many servers that have broken content-type handling for JSON</p>\n","m.new_content":{"body":"freddy: yeah I know;\n- per-spec it’s a simple request since the “essence” of the Content-Type header is `text/plain`, and\n- any server that’s treating a request body with `text/plain; application/json` as JSON has broken content-type handling that should be fixed\n\n…but I think in practice there are many servers that have broken content-type handling for JSON","format":"org.matrix.custom.html","formatted_body":"<p><a href=\"https://matrix.to/#/@fbraun:mozilla.org\">freddy</a>: yeah I know;</p>\n<ul>\n<li>per-spec it’s a simple request since the “essence” of the Content-Type header is <code>text/plain</code>, and</li>\n<li>any server that’s treating a request body with <code>text/plain; application/json</code> as JSON has broken content-type handling that should be fixed</li>\n</ul>\n<p>…but I think in practice there are many servers that have broken content-type handling for JSON</p>\n","msgtype":"m.text"},"m.relates_to":{"event_id":"$J2xtJdLTUbhLZuOh9IOg07eNOGnauWB4-_jWOPiySVc","rel_type":"m.replace"},"msgtype":"m.text"},"ts":1630650496510,"senderName":"sideshowbarker","senderId":"@sideshowbarker:mozilla.org","id":"$vBV7tHUjnyirBDNiNY3nApOgKW_b9IuKb-hKhxn6uu8"},
{"content":{"body":"sideshowbarker: that's been known for ages I think, there's an open issue against the specification about it","format":"org.matrix.custom.html","formatted_body":"<a href=\"https://matrix.to/#/@sideshowbarker:mozilla.org\">sideshowbarker</a>: that's been known for ages I think, there's an open issue against the specification about it","msgtype":"m.text"},"ts":1630650644840,"senderName":"annevk","senderId":"@annevk:mozilla.org","id":"$tnSMq72f0gkTtNH-OS8Pz3rORE_6kMAaj5Rr6fYoyXs"},
{"content":{"body":"ah OK","msgtype":"m.text"},"ts":1630650710747,"senderName":"sideshowbarker","senderId":"@sideshowbarker:mozilla.org","id":"$D8npTbuOc1Yu1WY7u5SgdgjvcvUae4iuLJ6rMOljflc"},
{"content":{"body":"well I guess a similar real-world case is maybe https://stackoverflow.com/a/45752919/441757","msgtype":"m.text"},"ts":1630650739075,"senderName":"sideshowbarker","senderId":"@sideshowbarker:mozilla.org","id":"$r0vvd0zBWfq4Yhe0wlkw85qk72Rfq6J8x2wco8_4qd4"},
{"content":{"body":"sideshowbarker: text/plain; application/json isn't actually the evil example, https://github.com/whatwg/fetch/issues/838 has the worse attacks","format":"org.matrix.custom.html","formatted_body":"<a href=\"https://matrix.to/#/@sideshowbarker:mozilla.org\">sideshowbarker</a>: text/plain; application/json isn't actually the evil example, https://github.com/whatwg/fetch/issues/838 has the worse attacks","msgtype":"m.text"},"ts":1630650781278,"senderName":"annevk","senderId":"@annevk:mozilla.org","id":"$I1kIBlz5uS6OV_c1WA0QLJeCbt0NIgsM7XEMPcIiZsw"},
{"content":{"body":"looks","msgtype":"m.emote"},"ts":1630650793238,"senderName":"sideshowbarker","senderId":"@sideshowbarker:mozilla.org","id":"$MhHPC-DbNn8EexdhDcI78ofAtXiwPPPOsj6tbx61Pns"},
{"content":{"body":"aha","msgtype":"m.text"},"ts":1630650822171,"senderName":"sideshowbarker","senderId":"@sideshowbarker:mozilla.org","id":"$HUsxHEteLtwLKsbjQVeCGBYJqae5MRbhe0hJueDNNYk"},
{"content":{"body":"The only complete solution here would be for the browser to take ownership of setting Content-Type, but I think that ends up breaking things, but it could be tried again I suppose","msgtype":"m.text"},"ts":1630650837453,"senderName":"annevk","senderId":"@annevk:mozilla.org","id":"$5dIGOedxHo9wqNO4KfimfmYFax3LiIEr-i8KBYnqcTg"},
{"content":{"body":"stephanluis: writing a polyfill or library and making it popular is often the first step toward something becoming part of the platform. This doesn't work for all features, but it would work for a duration input box.","format":"org.matrix.custom.html","formatted_body":"<a href=\"https://matrix.to/#/@stephanluis:matrix.org\">stephanluis</a>: writing a polyfill or library and making it popular is often the first step toward something becoming part of the platform. This doesn't work for all features, but it would work for a duration input box.","msgtype":"m.text"},"ts":1630650927782,"senderName":"annevk","senderId":"@annevk:mozilla.org","id":"$2MhIYMIRwuZMRaZX_TTsbHOJXdr8Jn_ils-04lsxCNE"},
{"content":{"body":"> <@annevk:mozilla.org> The only complete solution here would be for the browser to take ownership of setting Content-Type, but I think that ends up breaking things, but it could be tried again I suppose\n\nWell, short of that, would another solution be, just for the case of JSON request bodies, for the browser to refuse to allow the Content-Type request header to be set to a non-JSON media type?","format":"org.matrix.custom.html","formatted_body":"<mx-reply><blockquote><a href=\"https://matrix.to/#/!AGetWbsMpFPdSgUrbs:matrix.org/$5dIGOedxHo9wqNO4KfimfmYFax3LiIEr-i8KBYnqcTg?via=mozilla.org&via=matrix.org&via=igalia.com\">In reply to</a> <a href=\"https://matrix.to/#/@annevk:mozilla.org\">@annevk:mozilla.org</a><br>The only complete solution here would be for the browser to take ownership of setting Content-Type, but I think that ends up breaking things, but it could be tried again I suppose</blockquote></mx-reply>Well, short of that, would another solution be, just for the case of JSON request bodies, for the browser to refuse to allow the Content-Type request header to be set to a non-JSON media type?","m.relates_to":{"m.in_reply_to":{"event_id":"$5dIGOedxHo9wqNO4KfimfmYFax3LiIEr-i8KBYnqcTg"}},"msgtype":"m.text"},"ts":1630650989941,"senderName":"sideshowbarker","senderId":"@sideshowbarker:mozilla.org","id":"$vy1EMY9oV7NZrl0NqKMvg_iHXBgshv-gV6UmpGom7HU"},
{"content":{"body":"…like CORB but from the client side — for requests rather than responses","msgtype":"m.text"},"ts":1630651068324,"senderName":"sideshowbarker","senderId":"@sideshowbarker:mozilla.org","id":"$-n-GlBJ9UVhP-P4it3zzeb4MIyAcfK5wQ-TFTiWLxMg"},
{"content":{"body":"sideshowbarker: we cannot tell the type of a body","format":"org.matrix.custom.html","formatted_body":"<a href=\"https://matrix.to/#/@sideshowbarker:mozilla.org\">sideshowbarker</a>: we cannot tell the type of a body","msgtype":"m.text"},"ts":1630651088602,"senderName":"annevk","senderId":"@annevk:mozilla.org","id":"$KHcyHdDDnrRelppFvJToRHgeHel4wsdDzgClaTq2Lsk"},
{"content":{"body":"ah OK","msgtype":"m.text"},"ts":1630651095471,"senderName":"sideshowbarker","senderId":"@sideshowbarker:mozilla.org","id":"$3CCJux3qcyU8jxvg1MzYEEPOs04ouI8s3qBvU6IIii4"},
{"content":{"body":"I guess we could try to parse all bodies to see if they are JSON, but I'm pretty sure rejecting those would break the web at this point","msgtype":"m.text"},"ts":1630651150996,"senderName":"annevk","senderId":"@annevk:mozilla.org","id":"$AbZDAiby2KzW17shbyBxHHr5txCp0g3wT8AoNMwivzE"},
{"content":{"body":"yeah, parsing the bodies is what I had in mind, and yeah I think it would definitely break a lot people’s stuff","msgtype":"m.text"},"ts":1630651189979,"senderName":"sideshowbarker","senderId":"@sideshowbarker:mozilla.org","id":"$c8mpULpV_W_KuwZkHZGPikeAabqLZNSU3eqKtLrPJLM"},
{"content":{"body":"e.g., it would break requests to the Slack API from frontend code, as in that https://stackoverflow.com/a/45752919/441757 case","msgtype":"m.text"},"ts":1630651241510,"senderName":"sideshowbarker","senderId":"@sideshowbarker:mozilla.org","id":"$8Q4j0Dd75q5wK0ijoT9LUaJ6k6Hz7ucCopoONhCersA"},
{"content":{"body":"anyway, I’m not on Twitter so I can’t reply myself to that https://twitter.com/jub0bs/status/1432025056234835980 tweet. But if somebody cares to take the time, might be worthwhile to reply to that tweet with a link to https://github.com/whatwg/fetch/issues/838","msgtype":"m.text"},"ts":1630651420368,"senderName":"sideshowbarker","senderId":"@sideshowbarker:mozilla.org","id":"$HGuJDGrpP0nCbvfnYQh2fIpTpEKXFgc7Pubt-Iu_k84"}
]
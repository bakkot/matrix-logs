[
{"content":{"body":"> <@gogo2464:matrix.org> Hello. I want to document the latest version of the w3c parser for finding client side vulnerabilities.\n> \n> I started with a DOM XSS using the RFC of the parser with element.innerHTML = \"XSS\";. My goal is to have the syntax possible for each XSS possible. \n> \n> I started with:\n> \n> https://html.spec.whatwg.org/multipage/parsing.html#overview-of-the-parsing-model\n> \n> according to the schema, the loop starts at the HTML tree builder at https://github.com/WebKit/WebKit/blob/main/Source/WebCore/html/parser/HTMLTreeBuilder.cpp#L816 and then \n> \n> \n> I am wondering if according to the code at https://github.com/WebKit/WebKit/blob/2246a2aa28d527e129ebec66183569db035fdc8a/Source/WebCore/dom/Element.cpp#L4347 , the policy of innerHTML could deny to execute a script even if not sanitized. I need to find the parser location to see the grammar syntax for potential XSS as mentrionned there: https://html.spec.whatwg.org/multipage/dynamic-markup-insertion.html#dom-element-innerhtml .\n> \n> Is Elements::replaceChildrenWithMarkup the parser please?\n\nCould I ask again for the setinnerhtml parser please?","format":"org.matrix.custom.html","formatted_body":"<mx-reply><blockquote><a href=\"https://matrix.to/#/!AGetWbsMpFPdSgUrbs:matrix.org/$oPBdTh6c4gHz4iu6yJgGG43EQorE3uNWwXUbCaV8NOY\">In reply to</a> <a href=\"https://matrix.to/#/@gogo2464:matrix.org\">@gogo2464:matrix.org</a><br>Hello. I want to document the latest version of the w3c parser for finding client side vulnerabilities.<br><br>I started with a DOM XSS using the RFC of the parser with element.innerHTML = &quot;XSS&quot;;. My goal is to have the syntax possible for each XSS possible. <br><br>I started with:<br><br>https://html.spec.whatwg.org/multipage/parsing.html#overview-of-the-parsing-model<br><br>according to the schema, the loop starts at the HTML tree builder at https://github.com/WebKit/WebKit/blob/main/Source/WebCore/html/parser/HTMLTreeBuilder.cpp#L816 and then <br><br><br>I am wondering if according to the code at https://github.com/WebKit/WebKit/blob/2246a2aa28d527e129ebec66183569db035fdc8a/Source/WebCore/dom/Element.cpp#L4347 , the policy of innerHTML could deny to execute a script even if not sanitized. I need to find the parser location to see the grammar syntax for potential XSS as mentrionned there: https://html.spec.whatwg.org/multipage/dynamic-markup-insertion.html#dom-element-innerhtml .<br><br>Is Elements::replaceChildrenWithMarkup the parser please?</blockquote></mx-reply>Could I ask again for the setinnerhtml parser please?","m.mentions":{},"m.relates_to":{"m.in_reply_to":{"event_id":"$oPBdTh6c4gHz4iu6yJgGG43EQorE3uNWwXUbCaV8NOY"}},"msgtype":"m.text"},"ts":1749626187253,"senderName":"gogo","senderId":"@gogo2464:matrix.org","id":"$_0X3jdgu_yEfq5ECgQgS1IQhzXXysGIWU0giAw3dcpI"},
{"content":{"body":"> <@gogo2464:matrix.org> Could I ask again for the setinnerhtml parser please?\n\nI need the policy parser","format":"org.matrix.custom.html","formatted_body":"<mx-reply><blockquote><a href=\"https://matrix.to/#/!AGetWbsMpFPdSgUrbs:matrix.org/$_0X3jdgu_yEfq5ECgQgS1IQhzXXysGIWU0giAw3dcpI\">In reply to</a> <a href=\"https://matrix.to/#/@gogo2464:matrix.org\">@gogo2464:matrix.org</a><br>Could I ask again for the setinnerhtml parser please?</blockquote></mx-reply>I need the policy parser","m.mentions":{},"m.relates_to":{"m.in_reply_to":{"event_id":"$_0X3jdgu_yEfq5ECgQgS1IQhzXXysGIWU0giAw3dcpI"}},"msgtype":"m.text"},"ts":1749626222473,"senderName":"gogo","senderId":"@gogo2464:matrix.org","id":"$I5-e6V0FYcaxuf8pEO9dnpJBhgyegKxzEePvxXarsIk"},
{"content":{"body":"If anyone wanted to review https://github.com/whatwg/html/pull/10548 before it lands, now would be a very good time.","m.mentions":{},"msgtype":"m.text"},"ts":1749649348205,"senderName":"annevk","senderId":"@annevk:matrix.org","id":"$z08kz16yM7iQHAs_PYSlO_-IOrU9x5o6zeDoCU9QIOQ"},
{"content":{"body":"gogo: Re \"the setinnerhtml parser\": You linked to  https://html.spec.whatwg.org/multipage/dynamic-markup-insertion.html#dom-element-innerhtml . So 2 lines down from that is \"Element's innerHTML setter steps\" (which refer to \"the fragment parsing algorithm steps\", which refer to \"the HTML fragment parsing algorithm\", etc). Does that answer your question? If not, could you be more specific?","format":"org.matrix.custom.html","formatted_body":"<a href=\"https://matrix.to/#/@gogo2464:matrix.org\">gogo</a>: Re \"the setinnerhtml parser\": You linked to  https://html.spec.whatwg.org/multipage/dynamic-markup-insertion.html#dom-element-innerhtml . So 2 lines down from that is \"Element's innerHTML setter steps\" (which refer to \"the fragment parsing algorithm steps\", which refer to \"the HTML fragment parsing algorithm\", etc). Does that answer your question? If not, could you be more specific?","m.mentions":{"user_ids":["@gogo2464:matrix.org"]},"msgtype":"m.text"},"ts":1749650376635,"senderName":"jmdyck","senderId":"@jmdyck:matrix.org","id":"$Qx_4AmAfe6DHirxmWQE2nbaYJHUdiZu9EtbsDB_iTxA"},
{"content":{"body":"Luca Casonato: https://github.com/whatwg/webidl/pull/1489","format":"org.matrix.custom.html","formatted_body":"<a href=\"https://matrix.to/#/@lucacasonato:matrix.org\">Luca Casonato</a>: https://github.com/whatwg/webidl/pull/1489","m.mentions":{"user_ids":["@lucacasonato:matrix.org"]},"msgtype":"m.text"},"ts":1749650412369,"senderName":"annevk","senderId":"@annevk:matrix.org","id":"$DnsEaxDXMdhVbLO_rC_LqD0FRTH_y87aWgyGhe3CbLQ"},
{"content":{"body":"yes. I showed you a link of my previous work. In 1000 pages, I showed you the link I finally found. I need:\n- to know if the policy parser could ignore not sanitized scripts\n- if responsible, I need the policy parser","format":"org.matrix.custom.html","formatted_body":"<p>yes. I showed you a link of my previous work. In 1000 pages, I showed you the link I finally found. I need:</p>\n<ul>\n<li>to know if the policy parser could ignore not sanitized scripts</li>\n<li>if responsible, I need the policy parser</li>\n</ul>\n","m.mentions":{"user_ids":["@jmdyck:matrix.org"]},"m.relates_to":{"m.in_reply_to":{"event_id":"$Qx_4AmAfe6DHirxmWQE2nbaYJHUdiZu9EtbsDB_iTxA"}},"msgtype":"m.text"},"ts":1749651053670,"senderName":"gogo","senderId":"@gogo2464:matrix.org","id":"$hCNlXXozOyYHF1qmnAk2pVc5i7pAeRA6cc1OAuLd8f8"},
{"content":{"body":"Luke Warlow keithamus smaug: based on the discussion we had last week, are https://github.com/whatwg/html/pull/11255 and https://github.com/whatwg/html/pull/11345 still accurate or will they need changes? Per my recollection I think they match what we wanted in the end. Which was not composed, retargeted, and no further changes to event dispatch for referencetarget. (Olli was not in the room, but I'd like to make sure he agrees so maybe Keith can chat with Olli or some such.)","format":"org.matrix.custom.html","formatted_body":"<a href=\"https://matrix.to/#/@lwarlow:igalia.com\">Luke Warlow</a> <a href=\"https://matrix.to/#/@keithamus:matrix.org\">keithamus</a> <a href=\"https://matrix.to/#/@smaug:mozilla.org\">smaug</a>: based on the discussion we had last week, are https://github.com/whatwg/html/pull/11255 and https://github.com/whatwg/html/pull/11345 still accurate or will they need changes? Per my recollection I think they match what we wanted in the end. Which was not composed, retargeted, and no further changes to event dispatch for referencetarget. (Olli was not in the room, but I'd like to make sure he agrees so maybe Keith can chat with Olli or some such.)","m.mentions":{"user_ids":["@lwarlow:igalia.com","@keithamus:matrix.org","@smaug:mozilla.org"]},"msgtype":"m.text"},"ts":1749653492428,"senderName":"annevk","senderId":"@annevk:matrix.org","id":"$T_-kU_vwurBdQZJppmuQwQa_SibZsBamTmKNJovnqh0"},
{"content":{"body":"> <@annevk:matrix.org> Luke Warlow keithamus smaug: based on the discussion we had last week, are https://github.com/whatwg/html/pull/11255 and https://github.com/whatwg/html/pull/11345 still accurate or will they need changes? Per my recollection I think they match what we wanted in the end. Which was not composed, retargeted, and no further changes to event dispatch for referencetarget. (Olli was not in the room, but I'd like to make sure he agrees so maybe Keith can chat with Olli or some such.)\n\nI think that's correct those two things should be enough.","format":"org.matrix.custom.html","formatted_body":"<mx-reply><blockquote><a href=\"https://matrix.to/#/!AGetWbsMpFPdSgUrbs:matrix.org/$T_-kU_vwurBdQZJppmuQwQa_SibZsBamTmKNJovnqh0?via=igalia.com&via=matrix.org&via=mozilla.org\">In reply to</a> <a href=\"https://matrix.to/#/@annevk:matrix.org\">@annevk:matrix.org</a><br /><a href=\"https://matrix.to/#/@lwarlow:igalia.com\">Luke Warlow</a> <a href=\"https://matrix.to/#/@keithamus:matrix.org\">keithamus</a> <a href=\"https://matrix.to/#/@smaug:mozilla.org\">smaug</a>: based on the discussion we had last week, are https://github.com/whatwg/html/pull/11255 and https://github.com/whatwg/html/pull/11345 still accurate or will they need changes? Per my recollection I think they match what we wanted in the end. Which was not composed, retargeted, and no further changes to event dispatch for referencetarget. (Olli was not in the room, but I'd like to make sure he agrees so maybe Keith can chat with Olli or some such.)</blockquote></mx-reply>I think that's correct those two things should be enough.","m.relates_to":{"m.in_reply_to":{"event_id":"$T_-kU_vwurBdQZJppmuQwQa_SibZsBamTmKNJovnqh0"}},"msgtype":"m.text"},"ts":1749653552154,"senderName":"Luke Warlow","senderId":"@lwarlow:igalia.com","id":"$jdD43yryvTOQ9rkU9Zg8vAdcx0fr67YI5TwPA1SWgDw"},
{"content":{"body":"I need to understand why are not executed the <script> tag after innerHTML while not sanitized and while <img onerror=\"alert(1)\">*","m.mentions":{"user_ids":["@jmdyck:matrix.org"]},"m.relates_to":{"m.in_reply_to":{"event_id":"$Qx_4AmAfe6DHirxmWQE2nbaYJHUdiZu9EtbsDB_iTxA"}},"msgtype":"m.text"},"ts":1749653590331,"senderName":"gogo","senderId":"@gogo2464:matrix.org","id":"$eEqX722GLYS6RXjbLwLlJHtY6ycOLTqrbrd7ngwkkNw"},
{"content":{"body":"> These properties' setters perform no sanitization to remove potentially-dangerous elements and attributes like script or event handler content attributes.\n\nsetting an element's innerHTML to untrusted input is a horrible idea in any case. it's almost guaranteed to lead to the problems like the ones outlined in your lab. There are better ways to dynamically add elements to the page than blindly treating a string from the network as html markup.","format":"org.matrix.custom.html","formatted_body":"<blockquote>\n<p>These properties' setters perform no sanitization to remove potentially-dangerous elements and attributes like script or event handler content attributes.</p>\n</blockquote>\n<p>setting an element's innerHTML to untrusted input is a horrible idea in any case. it's almost guaranteed to lead to the problems like the ones outlined in your lab. There are better ways to dynamically add elements to the page than blindly treating a string from the network as html markup.</p>\n","m.mentions":{"user_ids":["@gogo2464:matrix.org"]},"m.relates_to":{"m.in_reply_to":{"event_id":"$eEqX722GLYS6RXjbLwLlJHtY6ycOLTqrbrd7ngwkkNw"}},"msgtype":"m.text"},"ts":1749654256653,"senderName":"akaster","senderId":"@akaster:serenityos.org","id":"$1UzG7u_Dv4JEl_gEggN_eHJNmlZ7BnHFVXH0fsZ2fr8"},
{"content":{"body":"Yes. I stated it.\n\nWhat is the other way to secure with no sanitization please? ","m.mentions":{"user_ids":["@akaster:serenityos.org"]},"m.relates_to":{"m.in_reply_to":{"event_id":"$1UzG7u_Dv4JEl_gEggN_eHJNmlZ7BnHFVXH0fsZ2fr8"}},"msgtype":"m.text"},"ts":1749654389923,"senderName":"gogo","senderId":"@gogo2464:matrix.org","id":"$6wSktGCBbezpcXH6NZwtlOnvHouF1NvTXDvGXaY1WNQ"},
{"content":{"body":"* Yes. I agree with it.\n\nWhat is the other way to secure with no sanitization please? ","m.mentions":{},"m.new_content":{"body":"Yes. I agree with it.\n\nWhat is the other way to secure with no sanitization please? ","m.mentions":{"user_ids":["@akaster:serenityos.org"]},"msgtype":"m.text"},"m.relates_to":{"event_id":"$6wSktGCBbezpcXH6NZwtlOnvHouF1NvTXDvGXaY1WNQ","rel_type":"m.replace"},"msgtype":"m.text"},"ts":1749654397723,"senderName":"gogo","senderId":"@gogo2464:matrix.org","id":"$AYdl7dxhkuTw8M4pviDk3CtN8KerEkOAaI4vMNMPjCw"},
{"content":{"body":"for that simple example of a search form? you could do something trivial like `document.createTextNode` and then `appendChild` that to the responsible div. or call the textContent setter on something but usage questions like this are out of scope for this forum","format":"org.matrix.custom.html","formatted_body":"for that simple example of a search form? you could do something trivial like <code>document.createTextNode</code> and then <code>appendChild</code> that to the responsible div. or call the textContent setter on something but usage questions like this are out of scope for this forum","m.mentions":{},"msgtype":"m.text"},"ts":1749654517956,"senderName":"akaster","senderId":"@akaster:serenityos.org","id":"$TLNOiGPCaSXs62JGrMvKIxcA_z67gOHzBnmFjr1v32Y"},
{"content":{"body":"* for that simple example of a search form? you could do something trivial like `document.createTextNode` and then `appendChild` that to the responsible div. or call the textContent setter on something. But in general usage questions like this are out of scope for this forum","format":"org.matrix.custom.html","formatted_body":"* for that simple example of a search form? you could do something trivial like <code>document.createTextNode</code> and then <code>appendChild</code> that to the responsible div. or call the textContent setter on something. But in general usage questions like this are out of scope for this forum","m.mentions":{},"m.new_content":{"body":"for that simple example of a search form? you could do something trivial like `document.createTextNode` and then `appendChild` that to the responsible div. or call the textContent setter on something. But in general usage questions like this are out of scope for this forum","format":"org.matrix.custom.html","formatted_body":"for that simple example of a search form? you could do something trivial like <code>document.createTextNode</code> and then <code>appendChild</code> that to the responsible div. or call the textContent setter on something. But in general usage questions like this are out of scope for this forum","m.mentions":{},"msgtype":"m.text"},"m.relates_to":{"event_id":"$TLNOiGPCaSXs62JGrMvKIxcA_z67gOHzBnmFjr1v32Y","rel_type":"m.replace"},"msgtype":"m.text"},"ts":1749654558417,"senderName":"akaster","senderId":"@akaster:serenityos.org","id":"$mmoKIDVrmK2ubNpLSWh3IV9UHRd6nbcYM0QIfjdRXmk"},
{"content":{"body":"Not sure why source needs to retarget if the event isn't composed","m.mentions":{"user_ids":["@lwarlow:igalia.com"]},"m.relates_to":{"m.in_reply_to":{"event_id":"$jdD43yryvTOQ9rkU9Zg8vAdcx0fr67YI5TwPA1SWgDw"}},"msgtype":"m.text"},"ts":1749654914568,"senderName":"smaug","senderId":"@smaug:mozilla.org","id":"$SKNrsbiDx6jKz-6ZwuKgyryTdEvFDIiwwv8cQwtAljo"},
{"content":{"body":"Feels useless ","m.mentions":{},"msgtype":"m.text"},"ts":1749654929354,"senderName":"smaug","senderId":"@smaug:mozilla.org","id":"$XNLqbxHKKoM4FJDrzvqg63rzD9dKzChBW0Ya6wDOL0w"},
{"content":{"body":"smaug: the rationale is that people might accidentally expose their shadow tree if they fire a synthetic event as composed. (Though this really argues for generically retargeting event fields that hold nodes.)","format":"org.matrix.custom.html","formatted_body":"<a href=\"https://matrix.to/#/@smaug:mozilla.org\">smaug</a>: the rationale is that people might accidentally expose their shadow tree if they fire a synthetic event as composed. (Though this really argues for generically retargeting event fields that hold nodes.)","m.mentions":{"user_ids":["@smaug:mozilla.org"]},"msgtype":"m.text"},"ts":1749655244860,"senderName":"annevk","senderId":"@annevk:matrix.org","id":"$-76Udks22-hS8ypn0kvzMa5XGSSymju47e6W3M6YRYk"},
{"content":{"body":"I'd expect similar behavior to events which have .relatedTarget","m.mentions":{},"msgtype":"m.text"},"ts":1749655323908,"senderName":"smaug","senderId":"@smaug:mozilla.org","id":"$31cpFVa7jxqhj8NXlQsUJ-QUmFXIommRJ6nL_pua4RU"},
{"content":{"body":"(though, 'command' really should be composed always, somehow, or perhaps composed with some opt-in mechanism. Otherwise it becomes too useless.)","m.mentions":{},"msgtype":"m.text"},"ts":1749655459601,"senderName":"smaug","senderId":"@smaug:mozilla.org","id":"$Jbh22B8D79DREbXPAkTyVL3IiwHdkiPRfnB5JSWHJx0"}
]
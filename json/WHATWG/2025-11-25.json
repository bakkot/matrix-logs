[
{"content":{"body":"There's still some discussion over how it should behave with script & preloading https://github.com/whatwg/html/issues/11669#issuecomment-3550088089. Do you think this blocks moving to stage 2? If not I'm fine with it and we can continue to discuss. zcorpan does this make sense with the stages model?","format":"org.matrix.custom.html","formatted_body":"There's still some discussion over how it should behave with script &amp; preloading https://github.com/whatwg/html/issues/11669#issuecomment-3550088089. Do you think this blocks moving to stage 2? If not I'm fine with it and we can continue to discuss. <a href=\"https://matrix.to/#/@zcorpan:mozilla.org\">zcorpan</a> does this make sense with the stages model?","m.mentions":{"user_ids":["@foolip:matrix.org","@zcorpan:mozilla.org"]},"m.relates_to":{"m.in_reply_to":{"event_id":"$UN8rnetasxjyEQrAPQUTiYNT9ZMh5t5ODXnWgBXdmhE"}},"msgtype":"m.text"},"ts":1764067465171,"senderName":"Jake Archibald","senderId":"@jakea:matrix.org","id":"$3UcdATD9fexcW8EEjdG3ohQk-CXv0EdPHfDKob51Bf0"},
{"content":{"body":"foolip: why doesn't it add runScripts to setHTMLUnsafe?","format":"org.matrix.custom.html","formatted_body":"<a href=\"https://matrix.to/#/@foolip:matrix.org\">foolip</a>: why doesn't it add runScripts to setHTMLUnsafe?","m.mentions":{"user_ids":["@foolip:matrix.org"]},"msgtype":"m.text"},"ts":1764069032439,"senderName":"annevk","senderId":"@annevk:matrix.org","id":"$CPEeritcMVhxL7x-Fu3aclH-Jb2eW0ta6_5jBg2QxQU"},
{"content":{"body":"annevk: That's just an oversight. Do you think we should add `runScripts` to setHTMLUnsafe() independently (before) streamHTMLUnsafe(), or do it all in one PR?","format":"org.matrix.custom.html","formatted_body":"<a href=\"https://matrix.to/#/@annevk:matrix.org\">annevk</a>: That's just an oversight. Do you think we should add <code>runScripts</code> to setHTMLUnsafe() independently (before) streamHTMLUnsafe(), or do it all in one PR?","m.mentions":{"user_ids":["@annevk:matrix.org"]},"msgtype":"m.text"},"ts":1764069215879,"senderName":"foolip","senderId":"@foolip:matrix.org","id":"$iL7uPGC9VandCIo4mNgmSUj8cC53_yKNf7dlkgcPnTo"},
{"content":{"body":"I don't have a preference, except that `setHTMLUnsafe()` getting it later doesn't seem good.","format":"org.matrix.custom.html","formatted_body":"I don't have a preference, except that <code>setHTMLUnsafe()</code> getting it later doesn't seem good.","m.mentions":{},"msgtype":"m.text"},"ts":1764069279844,"senderName":"annevk","senderId":"@annevk:matrix.org","id":"$4knmir387NU50NZkzLLmj9fPgppUryoG3uLFe3ujdyg"},
{"content":{"body":"Yeah, that wouldn't make sense","m.mentions":{},"msgtype":"m.text"},"ts":1764069694687,"senderName":"foolip","senderId":"@foolip:matrix.org","id":"$ZIVjllIe5za3SQp3zSyc0BRiI7lSkzBGSYCmPP5Lslg"},
{"content":{"body":"I left some other comments on the PR. Forgot to comment on `runScripts`. ðŸ˜…","format":"org.matrix.custom.html","formatted_body":"I left some other comments on the PR. Forgot to comment on <code>runScripts</code>. ðŸ˜…","m.mentions":{},"msgtype":"m.text"},"ts":1764069704905,"senderName":"annevk","senderId":"@annevk:matrix.org","id":"$pyLzSiLVGpGWLHcx8HCMFabnIkroSs1OgfBdmhwXyxs"},
{"content":{"body":"I'll add it to the PR so that it's somewhere for now.","m.mentions":{},"msgtype":"m.text"},"ts":1764069705742,"senderName":"foolip","senderId":"@foolip:matrix.org","id":"$ZVcNfZgFe8FxHt6CDEuRbFKVW8ThgxhzzQ2umBx_fzo"},
{"content":{"body":"I'm not sure there is actually much of an issue there; we can tee those streams to use the speculative parser the same way it's done in the main parser. The mechanism of that is kind of loosely spec'ed to begin with though","m.mentions":{"user_ids":["@jakea:matrix.org"]},"m.relates_to":{"m.in_reply_to":{"event_id":"$3UcdATD9fexcW8EEjdG3ohQk-CXv0EdPHfDKob51Bf0"}},"msgtype":"m.text"},"ts":1764070024871,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$OLGdWRrE8AdeqoHUpL0b1CXBJIxkiHkJBJ0peGDaSKc"},
{"content":{"body":"Noam Rosenthal: ohh, I didn't realise that the buffering to allow scripts to run before adding the next element stuff had made it into the spec","format":"org.matrix.custom.html","formatted_body":"<a href=\"https://matrix.to/#/@noamr:matrix.org\">Noam Rosenthal</a>: ohh, I didn't realise that the buffering to allow scripts to run before adding the next element stuff had made it into the spec","m.mentions":{"user_ids":["@noamr:matrix.org"]},"msgtype":"m.text"},"ts":1764070138680,"senderName":"Jake Archibald","senderId":"@jakea:matrix.org","id":"$LGaPSPBqFQopfo7EUckckRN8BiyMZEzAbswi_rgqfS4"},
{"content":{"body":"It *sort of* did. The stream that goes into the parser is teed to the main parser and speculative parser, but a lot of details there are left to implementations. In either case, I checked it in the spec and streaming to an element doesn't have an effective change on this (though of course this needs to be properly tested).","format":"org.matrix.custom.html","formatted_body":"It <em>sort of</em> did. The stream that goes into the parser is teed to the main parser and speculative parser, but a lot of details there are left to implementations. In either case, I checked it in the spec and streaming to an element doesn't have an effective change on this (though of course this needs to be properly tested).","m.mentions":{"user_ids":["@jakea:matrix.org"]},"m.relates_to":{"m.in_reply_to":{"event_id":"$LGaPSPBqFQopfo7EUckckRN8BiyMZEzAbswi_rgqfS4"}},"msgtype":"m.text"},"ts":1764070227187,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$dzY0vKnEq_S84QkKqVTVC6ePbU5y5cXKSRcAzbQF4OU"},
{"content":{"body":"> but a lot of details there are left to implementations\nThat soundsâ€¦ bad :D","format":"org.matrix.custom.html","formatted_body":"<blockquote>\n<p>but a lot of details there are left to implementations<br>That soundsâ€¦ bad :D</p>\n</blockquote>\n","m.mentions":{},"msgtype":"m.text"},"ts":1764070897705,"senderName":"Jake Archibald","senderId":"@jakea:matrix.org","id":"$VfmIpiQ-9-DRS7_IdEap71nE-hQ8UTuuHF1QoMM4mCw"},
{"content":{"body":"* > but a lot of details there are left to implementations\n\nThat soundsâ€¦ bad :D","format":"org.matrix.custom.html","formatted_body":"* <blockquote>\n<p>but a lot of details there are left to implementations</p>\n</blockquote>\n<p>That soundsâ€¦ bad :D</p>\n","m.mentions":{},"m.new_content":{"body":"> but a lot of details there are left to implementations\n\nThat soundsâ€¦ bad :D","format":"org.matrix.custom.html","formatted_body":"<blockquote>\n<p>but a lot of details there are left to implementations</p>\n</blockquote>\n<p>That soundsâ€¦ bad :D</p>\n","m.mentions":{},"msgtype":"m.text"},"m.relates_to":{"event_id":"$VfmIpiQ-9-DRS7_IdEap71nE-hQ8UTuuHF1QoMM4mCw","rel_type":"m.replace"},"msgtype":"m.text"},"ts":1764070903764,"senderName":"Jake Archibald","senderId":"@jakea:matrix.org","id":"$mSgONEZiP-Lu_ufZKbkBL9HIZ8YoNTMhJe3_yPzF8uk"},
{"content":{"body":"Noam Rosenthal: I really think the stuff in https://github.com/whatwg/html/issues/11669#issuecomment-3537477657 should be interoperable","format":"org.matrix.custom.html","formatted_body":"<a href=\"https://matrix.to/#/@noamr:matrix.org\">Noam Rosenthal</a>: I really think the stuff in https://github.com/whatwg/html/issues/11669#issuecomment-3537477657 should be interoperable","m.mentions":{"user_ids":["@noamr:matrix.org"]},"msgtype":"m.text"},"ts":1764070956836,"senderName":"Jake Archibald","senderId":"@jakea:matrix.org","id":"$sZMeZXTtH33QE8eW6lLlkBn-D5vxUo-wHHQz9P61_Co"},
{"content":{"body":"*That* stuff is interoperable. I meant that the speculative parsing behaviour might not be entirely interoperable.","format":"org.matrix.custom.html","formatted_body":"<em>That</em> stuff is interoperable. I meant that the speculative parsing behaviour might not be entirely interoperable.","m.mentions":{"user_ids":["@jakea:matrix.org"]},"m.relates_to":{"m.in_reply_to":{"event_id":"$sZMeZXTtH33QE8eW6lLlkBn-D5vxUo-wHHQz9P61_Co"}},"msgtype":"m.text"},"ts":1764071235656,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$1bMCTxEB-aib0440Y1uHHAWD_br5bKe02CYhN0795W0"},
{"content":{"body":"oh yeah that's fine","m.mentions":{},"msgtype":"m.text"},"ts":1764071713724,"senderName":"Jake Archibald","senderId":"@jakea:matrix.org","id":"$TBT7g8_ZVEcDAL6BWk6hk4sIRP6UgsjfQzh3xtRTQok"},
{"content":{"body":"Noam Rosenthal: someone's asking \"why contentname and not id\", and I couldn't find the relevant discussion","format":"org.matrix.custom.html","formatted_body":"<a href=\"https://matrix.to/#/@noamr:matrix.org\">Noam Rosenthal</a>: someone's asking \"why contentname and not id\", and I couldn't find the relevant discussion","m.mentions":{"user_ids":["@noamr:matrix.org"]},"msgtype":"m.text"},"ts":1764072226857,"senderName":"Jake Archibald","senderId":"@jakea:matrix.org","id":"$ed4_fHFaaZMzkb3CRJ0L55ZQDvWcCBar-7teAvCMOwo"},
{"content":{"body":"https://x.com/royalicing/status/1991714869012582584","m.mentions":{},"msgtype":"m.text"},"ts":1764072232674,"senderName":"Jake Archibald","senderId":"@jakea:matrix.org","id":"$1i1VCDQVeptoI5KfQCd7RIAv5DXjF0Hb5pMNtIRkRDA"},
{"content":{"body":"Thanks for the feedback! I've addressed the simple stuff now. For the HTML fragment parsing algorithm refactor I'm concerned that the diff will be unreadable if I just do it. In the end there should be one algorithm, so maybe as a middle ground I could add \"(streaming case)\" markers to some steps to show exactly where the changes are instead of waving at them from the outside?","m.mentions":{"user_ids":["@annevk:matrix.org"]},"m.relates_to":{"m.in_reply_to":{"event_id":"$pyLzSiLVGpGWLHcx8HCMFabnIkroSs1OgfBdmhwXyxs"}},"msgtype":"m.text"},"ts":1764072390423,"senderName":"foolip","senderId":"@foolip:matrix.org","id":"$lhxXpow7cgLDzGU_6rSrOkMRcjJQGyWenI91ghrHQOk"},
{"content":{"body":"I think you need to modify the core HTML parser as well, at least for some of the things we discussed. And ideally some of that is tidied up as it's all rather hand-wavy currently and adding this on top will make it even more fragile. So yeah, maybe do some refactoring first.","m.mentions":{},"msgtype":"m.text"},"ts":1764072487505,"senderName":"annevk","senderId":"@annevk:matrix.org","id":"$tjX4ShoVFDVeBGkUI5B3Kd_TIytT-r2aDq3tutKxLWk"}
]
[
{"content":{"body":"Luke Warlow: in the setAttribute algorithm, isn't it a bit odd that step 5 may create a new attribute, which isn't necessarily used at all","format":"org.matrix.custom.html","formatted_body":"<a href=\"https://matrix.to/#/@lwarlow:igalia.com\">Luke Warlow</a>: in the setAttribute algorithm, isn't it a bit odd that step 5 may create a new attribute, which isn't necessarily used at all","m.mentions":{"user_ids":["@lwarlow:igalia.com"]},"msgtype":"m.text"},"ts":1742463102126,"senderName":"smaug","senderId":"@smaug:mozilla.org","id":"$lzMSxXzO7rzDe6_RMFEKq-4TFFVEHI9s6NyfIensnqY"},
{"content":{"body":"Why would it not be used?","m.mentions":{},"msgtype":"m.text"},"ts":1742463201941,"senderName":"Luke Warlow","senderId":"@lwarlow:igalia.com","id":"$1dbLMevXG_uGqq1Wdt5AO1jgyYc-5Uc_fbskbYg6gVA"},
{"content":{"body":"I guess if veriying an attribute value throws?","m.mentions":{},"msgtype":"m.text"},"ts":1742463210598,"senderName":"Luke Warlow","senderId":"@lwarlow:igalia.com","id":"$SZBbje7acV2InMcupITYu5SrGvgwFtRhhBa4PBuJQ5o"},
{"content":{"body":"oh wait, I'm missing something","m.mentions":{},"msgtype":"m.text"},"ts":1742463220277,"senderName":"smaug","senderId":"@smaug:mozilla.org","id":"$peC4e090XEp8ZY-WF7GRZzHqCePEoqRVUzYb7TPYhP8"},
{"content":{"body":"step 7 does explicit attribute check ","m.mentions":{},"msgtype":"m.text"},"ts":1742463240058,"senderName":"smaug","senderId":"@smaug:mozilla.org","id":"$5fKRrwCAH4IRSJVPTW3TkCZMpYYwxng5JBi0BAjDuF8"},
{"content":{"body":"hmm, how would I implement that efficiently ...","m.mentions":{},"msgtype":"m.text"},"ts":1742463287479,"senderName":"smaug","senderId":"@smaug:mozilla.org","id":"$YrZ_s9HkiaCHxjyz-ea-CevyfzqWI5ea42WIcmRulUY"},
{"content":{"body":"you can skip steps 6 and 7 if the CSP isn't enabled. And 7 if the attribute is a safe attribute","m.mentions":{},"msgtype":"m.text"},"ts":1742463379732,"senderName":"Luke Warlow","senderId":"@lwarlow:igalia.com","id":"$xT6zGLO5hZDNsnKPn8xk-bvsv7LNco2lww520oGnxzk"},
{"content":{"body":"* you can skip steps 6 and 7 if the CSP isn't enabled (in at least report only). And 7 if the attribute is a safe attribute","m.mentions":{},"m.new_content":{"body":"you can skip steps 6 and 7 if the CSP isn't enabled (in at least report only). And 7 if the attribute is a safe attribute","m.mentions":{},"msgtype":"m.text"},"m.relates_to":{"event_id":"$xT6zGLO5hZDNsnKPn8xk-bvsv7LNco2lww520oGnxzk","rel_type":"m.replace"},"msgtype":"m.text"},"ts":1742463411011,"senderName":"Luke Warlow","senderId":"@lwarlow:igalia.com","id":"$_V2m7AIsSFOTuxivNIXVItZu3lqYCfPY08ZVivM9rG4"},
{"content":{"body":"It is just the identity of the attribute I'm pondering","m.mentions":{},"msgtype":"m.text"},"ts":1742463547992,"senderName":"smaug","senderId":"@smaug:mozilla.org","id":"$rQLis6COVFi--cPqEzCS5nHDO8JBe9ieLecK_83UVz0"},
{"content":{"body":"Luke Warlow: how does that work in webkit if the TT callback removes the relevant attribute and adds back an attribute with same qname?","format":"org.matrix.custom.html","formatted_body":"<a href=\"https://matrix.to/#/@lwarlow:igalia.com\">Luke Warlow</a>: how does that work in webkit if the TT callback removes the relevant attribute and adds back an attribute with same qname?","m.mentions":{"user_ids":["@lwarlow:igalia.com"]},"msgtype":"m.text"},"ts":1742463710096,"senderName":"smaug","senderId":"@smaug:mozilla.org","id":"$Vnet6JrlVhLoxpcRR1MuWHtqpS8rGRfA20JoWYP2mqA"},
{"content":{"body":"it resyncs the attribute index before setting the value","m.mentions":{},"msgtype":"m.text"},"ts":1742463759732,"senderName":"Luke Warlow","senderId":"@lwarlow:igalia.com","id":"$aI70NCNup6vpriMcMj3litL5xUpuf8Ckodn-UjT-BSM"},
{"content":{"body":"but what does step 7 do?","m.mentions":{},"msgtype":"m.text"},"ts":1742463794480,"senderName":"smaug","senderId":"@smaug:mozilla.org","id":"$KjM_g6tEpoQZYf8G_R8PsfJyR-mA3leBYccmdED8sKg"},
{"content":{"body":"* it resyncs the attribute index before setting the value (but it only needs to do this when CSP is present AND when the attribute is one that requires a TrustedType)","m.mentions":{},"m.new_content":{"body":"it resyncs the attribute index before setting the value (but it only needs to do this when CSP is present AND when the attribute is one that requires a TrustedType)","m.mentions":{},"msgtype":"m.text"},"m.relates_to":{"event_id":"$aI70NCNup6vpriMcMj3litL5xUpuf8Ckodn-UjT-BSM","rel_type":"m.replace"},"msgtype":"m.text"},"ts":1742463797820,"senderName":"Luke Warlow","senderId":"@lwarlow:igalia.com","id":"$eJCxMn4ViYv1DpsZSfJ8naV6623JfEVDST60Np0ZeG4"},
{"content":{"body":"It is not anymore the same attribute","m.mentions":{},"msgtype":"m.text"},"ts":1742463801828,"senderName":"smaug","senderId":"@smaug:mozilla.org","id":"$HYFIfpMhL28Cg0Y4SJJXBAsyb1jEn7XKyVRbe36OWPU"},
{"content":{"body":"That is true. ","m.mentions":{},"msgtype":"m.text"},"ts":1742463984343,"senderName":"Luke Warlow","senderId":"@lwarlow:igalia.com","id":"$hUfkwumABuLJBQQK5Axfbyx04qXwbahB0Gei5buNJiA"},
{"content":{"body":"and I wish we wouldn't need to do identity checks for attributes here","m.mentions":{},"msgtype":"m.text"},"ts":1742464013086,"senderName":"smaug","senderId":"@smaug:mozilla.org","id":"$UsHg-bw58pZdNnYiUVPAj-LFMQqrJ1pOGKg2tTp_cTo"},
{"content":{"body":"I can probably move step 6 higher up","m.mentions":{},"msgtype":"m.text"},"ts":1742464032122,"senderName":"Luke Warlow","senderId":"@lwarlow:igalia.com","id":"$Y-bVx_U38YgX6asOUflZMMFDrHst05EXABCaJOVHW6I"},
{"content":{"body":"Maybe even to step 3?","m.mentions":{},"msgtype":"m.text"},"ts":1742464054730,"senderName":"Luke Warlow","senderId":"@lwarlow:igalia.com","id":"$Hh4WXZyS7y4OTGCCjoUHlwXPRLWZhsUcTIDPaPaeZrY"},
{"content":{"body":"It takes an attribute algorithmically but all it needs is an attributes local name and namespace","m.mentions":{},"msgtype":"m.text"},"ts":1742464081016,"senderName":"Luke Warlow","senderId":"@lwarlow:igalia.com","id":"$6nc644i2kq2XMkHk9Nlzj2x_IwudCZZd0RaPb4xcrKM"},
{"content":{"body":"so you need step 3 first","m.mentions":{},"msgtype":"m.text"},"ts":1742464098836,"senderName":"smaug","senderId":"@smaug:mozilla.org","id":"$_G-Is5u1U7B85ZAXtIL8wLOeKAH6mzxECfm64t22maI"},
{"content":{"body":"We have qualifiedName already though right?","m.mentions":{},"msgtype":"m.text"},"ts":1742464123576,"senderName":"Luke Warlow","senderId":"@lwarlow:igalia.com","id":"$4MTZneeXDi1iVd9-KJUF-ABTEfPxdRwi0_m64649k50"},
{"content":{"body":"And namespace is null ","m.mentions":{},"msgtype":"m.text"},"ts":1742464146051,"senderName":"Luke Warlow","senderId":"@lwarlow:igalia.com","id":"$6dMbbotA8E7XZZpJ1IyDS-1SK0YJui5JTYVpBun6Ehw"},
{"content":{"body":"That way all the actual lookups on the element etc happen after the default policy is called? And hopefully the flow looks nicer?","m.mentions":{},"msgtype":"m.text"},"ts":1742464182895,"senderName":"Luke Warlow","senderId":"@lwarlow:igalia.com","id":"$XURvmFU4MEK1vSaDDXVg5xdbEuedTAaUysylgoG1LDo"},
{"content":{"body":"the attribute may have non-null namespace","m.mentions":{},"msgtype":"m.text"},"ts":1742464218678,"senderName":"smaug","senderId":"@smaug:mozilla.org","id":"$PUSSB8ikkxq4JiibHBfzlUQWQn7Do68OHLPr7cSHGto"},
{"content":{"body":"if there is existing attribute","m.mentions":{},"msgtype":"m.text"},"ts":1742464224936,"senderName":"smaug","senderId":"@smaug:mozilla.org","id":"$4ui3903G9FIEAU_dTyVXAui46CRxVLvdTBplRps30j4"},
{"content":{"body":"Ahhh okay. Hmm in which case maybe we can't move it any earlier?","m.mentions":{},"msgtype":"m.text"},"ts":1742464283657,"senderName":"Luke Warlow","senderId":"@lwarlow:igalia.com","id":"$7m5hl_gIBwvYs7PLBt6il-wV_EfKJfMtI0CmISn33kk"},
{"content":{"body":"* Ahhh okay. Hmm in which case maybe we can't move it any earlier? (Side note the default policy was a mistake ðŸ˜…)","m.mentions":{},"m.new_content":{"body":"Ahhh okay. Hmm in which case maybe we can't move it any earlier? (Side note the default policy was a mistake ðŸ˜…)","m.mentions":{},"msgtype":"m.text"},"m.relates_to":{"event_id":"$7m5hl_gIBwvYs7PLBt6il-wV_EfKJfMtI0CmISn33kk","rel_type":"m.replace"},"msgtype":"m.text"},"ts":1742464303673,"senderName":"Luke Warlow","senderId":"@lwarlow:igalia.com","id":"$FJQKLRVWnppgnP5dipOMeMFHyVdg4sJUiBhZrQspAac"},
{"content":{"body":"There is _some_reason for the code Gecko has now ðŸ™‚ ","m.mentions":{},"msgtype":"m.text"},"ts":1742464304072,"senderName":"smaug","senderId":"@smaug:mozilla.org","id":"$Xd1-9a9R8I4yv7nqqYYKj1p6AIekRoZbNtePFWD5Hcs"},
{"content":{"body":"* There is \\_some\\_ reason for the code Gecko has now ðŸ™‚ ","format":"org.matrix.custom.html","formatted_body":"* There is _some_ reason for the code Gecko has now ðŸ™‚","m.mentions":{},"m.new_content":{"body":"There is \\_some\\_ reason for the code Gecko has now ðŸ™‚ ","format":"org.matrix.custom.html","formatted_body":"There is _some_ reason for the code Gecko has now ðŸ™‚","m.mentions":{},"msgtype":"m.text"},"m.relates_to":{"event_id":"$Xd1-9a9R8I4yv7nqqYYKj1p6AIekRoZbNtePFWD5Hcs","rel_type":"m.replace"},"msgtype":"m.text"},"ts":1742464313454,"senderName":"smaug","senderId":"@smaug:mozilla.org","id":"$xTT6pRiRYyD3vt6FX00Xz6nSfUiulKMmgvoUhf11XD4"},
{"content":{"body":"Could you point me to the Gecko code?\n\nI guess to match WebKit (and I believe Chromium in this case), We need to redo step 3 after step 6","m.mentions":{},"msgtype":"m.text"},"ts":1742464494815,"senderName":"Luke Warlow","senderId":"@lwarlow:igalia.com","id":"$vByaEIF9BPYtSm0RePJHU67oXH_k9atuUMlCRFPxhwA"},
{"content":{"body":"This is the [setAttribute](https://searchfox.org/mozilla-central/rev/4ce36232b265b53de4fb7eb754430f94e262bbbe/dom/base/Element.cpp#1679-1726).","format":"org.matrix.custom.html","formatted_body":"This is the <a href=\"https://searchfox.org/mozilla-central/rev/4ce36232b265b53de4fb7eb754430f94e262bbbe/dom/base/Element.cpp#1679-1726\">setAttribute</a>.","m.mentions":{},"msgtype":"m.text"},"ts":1742464544753,"senderName":"smaug","senderId":"@smaug:mozilla.org","id":"$bjN0-Sr8bpP-tFK9PYlBs8VxEDtfoDXTxcF2Pi-I3Vs"},
{"content":{"body":"Yeah so I think duplicating step 3 copies Firefox too?","m.mentions":{},"msgtype":"m.text"},"ts":1742464598271,"senderName":"Luke Warlow","senderId":"@lwarlow:igalia.com","id":"$b_HLHy0hD7qZYBVLAHq4xNsgEut4LgKuD2z6kztpUwM"},
{"content":{"body":"Maybe it is quite similar to what webkit does","m.mentions":{},"msgtype":"m.text"},"ts":1742464612692,"senderName":"smaug","senderId":"@smaug:mozilla.org","id":"$Ch41OeD0MUOVg5zXX1ZGTK5XfBNC7mWZcDUMuMZHf34"},
{"content":{"body":"but the spec pr does something else, because of the identity check","m.mentions":{},"msgtype":"m.text"},"ts":1742464626809,"senderName":"smaug","senderId":"@smaug:mozilla.org","id":"$tgVJdpEpFHHpQKXrVQb7GbODkyWw2wOlgR7g2lxBPVk"}
]
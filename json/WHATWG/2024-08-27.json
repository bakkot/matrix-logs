[
{"content":{"body":"I’m looking again at the `input type=number` WPT tests at https://github.com/web-platform-tests/wpt/blob/f5e542a731d61e302bc8048308963b6806620fb1/html/semantics/forms/the-input-element/number.html#L33C63-L33C72 and now wondering what part of the spec requires that the _string value_ of `HTMLInputElement.value` must represent a number less than or equal to Number.MAX_VALUE.","format":"org.matrix.custom.html","formatted_body":"I’m looking again at the <code>input type=number</code> WPT tests at https://github.com/web-platform-tests/wpt/blob/f5e542a731d61e302bc8048308963b6806620fb1/html/semantics/forms/the-input-element/number.html#L33C63-L33C72 and now wondering what part of the spec requires that the <em>string value</em> of <code>HTMLInputElement.value</code> must represent a number less than or equal to Number.MAX_VALUE.","m.mentions":{},"msgtype":"m.text"},"ts":1724726438163,"senderName":"sideshowbarker","senderId":"@sideshowbarker:matrix.org","id":"$h8UVWk9VBrIdjUB96p9mimSfeyKIUWrXtDW6xLOua-c"},
{"content":{"body":"`{value: \"2e308\", expected: \"\", testname: \"value >= Number.MAX_VALUE\"}` is the particular case I mean","format":"org.matrix.custom.html","formatted_body":"<code>{value: \"2e308\", expected: \"\", testname: \"value &gt;= Number.MAX_VALUE\"}</code> is the particular case I mean","m.mentions":{},"msgtype":"m.text"},"ts":1724726461839,"senderName":"sideshowbarker","senderId":"@sideshowbarker:matrix.org","id":"$OKF5AcG-Vb2_Qoj6YLXYK73KTLIOYRUyuIwm-sTbtw8"},
{"content":{"body":"The spec requirement at https://html.spec.whatwg.org/multipage/input.html#number-state-(type=number):valid-floating-point-number-4 just says:\n> If the value of the element is not a valid floating-point number, then set it to the empty string instead.\nBut it doesn’t seem like a strict implementation of the [“valid floating-point number”](https://html.spec.whatwg.org/multipage/common-microsyntaxes.html#valid-floating-point-number) checking algorithm is on its own can determine whether the value represents a number less than or equal to Number.MAX_VALUE.","format":"org.matrix.custom.html","formatted_body":"<p>The spec requirement at https://html.spec.whatwg.org/multipage/input.html#number-state-(type=number):valid-floating-point-number-4 just says:</p>\n<blockquote>\n<p>If the value of the element is not a valid floating-point number, then set it to the empty string instead.<br>But it doesn’t seem like a strict implementation of the <a href=\"https://html.spec.whatwg.org/multipage/common-microsyntaxes.html#valid-floating-point-number\">“valid floating-point number”</a> checking algorithm is on its own can determine whether the value represents a number less than or equal to Number.MAX_VALUE.</p>\n</blockquote>\n","m.mentions":{},"msgtype":"m.text"},"ts":1724726714566,"senderName":"sideshowbarker","senderId":"@sideshowbarker:matrix.org","id":"$PKWSnr4nVg8q4j5pQ9Y-uBCV3dog6rcLP-91fIrDxJI"},
{"content":{"body":" * The spec requirement at https://html.spec.whatwg.org/multipage/input.html#number-state-(type=number):valid-floating-point-number-4 just says:\n\n> If the value of the element is not a valid floating-point number, then set it to the empty string instead.\n\nBut it doesn’t seem like a strict implementation of the [“valid floating-point number”](https://html.spec.whatwg.org/multipage/common-microsyntaxes.html#valid-floating-point-number) checking algorithm is on its own can determine whether the value represents a number less than or equal to Number.MAX\\_VALUE.","format":"org.matrix.custom.html","formatted_body":" * <p>The spec requirement at https://html.spec.whatwg.org/multipage/input.html#number-state-(type=number):valid-floating-point-number-4 just says:</p>\n<blockquote>\n<p>If the value of the element is not a valid floating-point number, then set it to the empty string instead.</p>\n</blockquote>\n<p>But it doesn’t seem like a strict implementation of the <a href=\"https://html.spec.whatwg.org/multipage/common-microsyntaxes.html#valid-floating-point-number\">“valid floating-point number”</a> checking algorithm is on its own can determine whether the value represents a number less than or equal to Number.MAX_VALUE.</p>\n","m.mentions":{},"m.new_content":{"body":"The spec requirement at https://html.spec.whatwg.org/multipage/input.html#number-state-(type=number):valid-floating-point-number-4 just says:\n\n> If the value of the element is not a valid floating-point number, then set it to the empty string instead.\n\nBut it doesn’t seem like a strict implementation of the [“valid floating-point number”](https://html.spec.whatwg.org/multipage/common-microsyntaxes.html#valid-floating-point-number) checking algorithm is on its own can determine whether the value represents a number less than or equal to Number.MAX\\_VALUE.","format":"org.matrix.custom.html","formatted_body":"<p>The spec requirement at https://html.spec.whatwg.org/multipage/input.html#number-state-(type=number):valid-floating-point-number-4 just says:</p>\n<blockquote>\n<p>If the value of the element is not a valid floating-point number, then set it to the empty string instead.</p>\n</blockquote>\n<p>But it doesn’t seem like a strict implementation of the <a href=\"https://html.spec.whatwg.org/multipage/common-microsyntaxes.html#valid-floating-point-number\">“valid floating-point number”</a> checking algorithm is on its own can determine whether the value represents a number less than or equal to Number.MAX_VALUE.</p>\n","m.mentions":{},"msgtype":"m.text"},"m.relates_to":{"event_id":"$PKWSnr4nVg8q4j5pQ9Y-uBCV3dog6rcLP-91fIrDxJI","rel_type":"m.replace"},"msgtype":"m.text"},"ts":1724726728293,"senderName":"sideshowbarker","senderId":"@sideshowbarker:matrix.org","id":"$hY8C3Dg4LEJVfapmFYrlltLmu3ho9nOCtFy0rhY5zi0"},
{"content":{"body":" * The spec requirement at https://html.spec.whatwg.org/multipage/input.html#number-state-(type=number):valid-floating-point-number-4 just says:\n\n> If the value of the element is not a valid floating-point number, then set it to the empty string instead.\n\nBut it doesn’t seem like a strict implementation of the [“valid floating-point number”](https://html.spec.whatwg.org/multipage/common-microsyntaxes.html#valid-floating-point-number) checking algorithm can on its own determine whether the value represents a number less than or equal to Number.MAX\\_VALUE.","format":"org.matrix.custom.html","formatted_body":" * <p>The spec requirement at https://html.spec.whatwg.org/multipage/input.html#number-state-(type=number):valid-floating-point-number-4 just says:</p>\n<blockquote>\n<p>If the value of the element is not a valid floating-point number, then set it to the empty string instead.</p>\n</blockquote>\n<p>But it doesn’t seem like a strict implementation of the <a href=\"https://html.spec.whatwg.org/multipage/common-microsyntaxes.html#valid-floating-point-number\">“valid floating-point number”</a> checking algorithm can on its own determine whether the value represents a number less than or equal to Number.MAX_VALUE.</p>\n","m.mentions":{},"m.new_content":{"body":"The spec requirement at https://html.spec.whatwg.org/multipage/input.html#number-state-(type=number):valid-floating-point-number-4 just says:\n\n> If the value of the element is not a valid floating-point number, then set it to the empty string instead.\n\nBut it doesn’t seem like a strict implementation of the [“valid floating-point number”](https://html.spec.whatwg.org/multipage/common-microsyntaxes.html#valid-floating-point-number) checking algorithm can on its own determine whether the value represents a number less than or equal to Number.MAX\\_VALUE.","format":"org.matrix.custom.html","formatted_body":"<p>The spec requirement at https://html.spec.whatwg.org/multipage/input.html#number-state-(type=number):valid-floating-point-number-4 just says:</p>\n<blockquote>\n<p>If the value of the element is not a valid floating-point number, then set it to the empty string instead.</p>\n</blockquote>\n<p>But it doesn’t seem like a strict implementation of the <a href=\"https://html.spec.whatwg.org/multipage/common-microsyntaxes.html#valid-floating-point-number\">“valid floating-point number”</a> checking algorithm can on its own determine whether the value represents a number less than or equal to Number.MAX_VALUE.</p>\n","m.mentions":{},"msgtype":"m.text"},"m.relates_to":{"event_id":"$PKWSnr4nVg8q4j5pQ9Y-uBCV3dog6rcLP-91fIrDxJI","rel_type":"m.replace"},"msgtype":"m.text"},"ts":1724726762076,"senderName":"sideshowbarker","senderId":"@sideshowbarker:matrix.org","id":"$Ir0FqnZ5_EhHeYXsGYCc4R-7u3oO2amlTfo5malmZHI"},
{"content":{"body":" * The spec requirement at https://html.spec.whatwg.org/multipage/input.html#number-state-(type=number):valid-floating-point-number-4 just says:\n\n> *If the value of the element is not a valid floating-point number, then set it to the empty string instead.*\n\nBut it doesn’t seem like a strict implementation of the [“valid floating-point number”](https://html.spec.whatwg.org/multipage/common-microsyntaxes.html#valid-floating-point-number) checking algorithm can on its own determine whether the value represents a number less than or equal to Number.MAX\\_VALUE.","format":"org.matrix.custom.html","formatted_body":" * <p>The spec requirement at https://html.spec.whatwg.org/multipage/input.html#number-state-(type=number):valid-floating-point-number-4 just says:</p>\n<blockquote>\n<p><em>If the value of the element is not a valid floating-point number, then set it to the empty string instead.</em></p>\n</blockquote>\n<p>But it doesn’t seem like a strict implementation of the <a href=\"https://html.spec.whatwg.org/multipage/common-microsyntaxes.html#valid-floating-point-number\">“valid floating-point number”</a> checking algorithm can on its own determine whether the value represents a number less than or equal to Number.MAX_VALUE.</p>\n","m.mentions":{},"m.new_content":{"body":"The spec requirement at https://html.spec.whatwg.org/multipage/input.html#number-state-(type=number):valid-floating-point-number-4 just says:\n\n> *If the value of the element is not a valid floating-point number, then set it to the empty string instead.*\n\nBut it doesn’t seem like a strict implementation of the [“valid floating-point number”](https://html.spec.whatwg.org/multipage/common-microsyntaxes.html#valid-floating-point-number) checking algorithm can on its own determine whether the value represents a number less than or equal to Number.MAX\\_VALUE.","format":"org.matrix.custom.html","formatted_body":"<p>The spec requirement at https://html.spec.whatwg.org/multipage/input.html#number-state-(type=number):valid-floating-point-number-4 just says:</p>\n<blockquote>\n<p><em>If the value of the element is not a valid floating-point number, then set it to the empty string instead.</em></p>\n</blockquote>\n<p>But it doesn’t seem like a strict implementation of the <a href=\"https://html.spec.whatwg.org/multipage/common-microsyntaxes.html#valid-floating-point-number\">“valid floating-point number”</a> checking algorithm can on its own determine whether the value represents a number less than or equal to Number.MAX_VALUE.</p>\n","m.mentions":{},"msgtype":"m.text"},"m.relates_to":{"event_id":"$PKWSnr4nVg8q4j5pQ9Y-uBCV3dog6rcLP-91fIrDxJI","rel_type":"m.replace"},"msgtype":"m.text"},"ts":1724726786169,"senderName":"sideshowbarker","senderId":"@sideshowbarker:matrix.org","id":"$RkK1KAp4sjQYhGASd2SD03M9qa62W0-Oy_eYZY1xdU4"},
{"content":{"body":"Instead, to pass that WPT test, an implementation needs to actually try to parse the value into a number","m.mentions":{},"msgtype":"m.text"},"ts":1724726885732,"senderName":"sideshowbarker","senderId":"@sideshowbarker:matrix.org","id":"$KhjpStFVkAcNF7CyvXP8MYYl1mxATX9Ip0NryHytCuU"},
{"content":{"body":"So I‘m wondering what spec requirement that WPT test is checking conformance for","m.mentions":{},"msgtype":"m.text"},"ts":1724726944575,"senderName":"sideshowbarker","senderId":"@sideshowbarker:matrix.org","id":"$hhcwgy84SnOwqJhMsIUQvUiaElQRUefgppsGYavRAy8"},
{"content":{"body":"Anyone remember why IDL integers go beyond the max safe integer values?","m.mentions":{},"msgtype":"m.text"},"ts":1724740096373,"senderName":"annevk","senderId":"@annevk:matrix.org","id":"$5asSOVJHWKhsrxHURWf46qYQIEZlkxeod88BSiKwTeM"},
{"content":{"body":"sideshowbarker: hmm, so what happens if parse and serialize gives a different value from the input, does that end up being invalid? Curious how this is implemented. As a matter of principle I'm not a big fan of grammar checks. They're almost never implemented that way and if they are would largely duplicate an existing parser of sorts.","format":"org.matrix.custom.html","formatted_body":"<a href=\"https://matrix.to/#/@sideshowbarker:matrix.org\">sideshowbarker</a>: hmm, so what happens if parse and serialize gives a different value from the input, does that end up being invalid? Curious how this is implemented. As a matter of principle I'm not a big fan of grammar checks. They're almost never implemented that way and if they are would largely duplicate an existing parser of sorts.","m.mentions":{"user_ids":["@sideshowbarker:matrix.org"]},"msgtype":"m.text"},"ts":1724741267828,"senderName":"annevk","senderId":"@annevk:matrix.org","id":"$0fh5tGjrdPm8AScIoLfH8adcDxQMgki6jW4cw9m1-6Y"},
{"content":{"body":"Given https://software.hixie.ch/utilities/js/live-dom-viewer/?%3C!DOCTYPE%20html%3E%0A...%3Cinput%20type%3Dnumber%20value%3D0.1234567890123456789012345678901234567890123456789012345678901234567890%3E%0A%3Cscript%3E%0Aw(document.querySelector(%27input%27).validity.valid)%0A%3C%2Fscript%3E I guess I don't know how this works exactly without more exploration and reading the code.","m.mentions":{},"msgtype":"m.text"},"ts":1724741719087,"senderName":"annevk","senderId":"@annevk:matrix.org","id":"$ObHh8lyxJMX4b9p_qeWdfA-d0T0UShqWzuxD7Q-_hSk"},
{"content":{"body":"> <@annevk:matrix.org> sideshowbarker: hmm, so what happens if parse and serialize gives a different value from the input, does that end up being invalid? Curious how this is implemented. As a matter of principle I'm not a big fan of grammar checks. They're almost never implemented that way and if they are would largely duplicate an existing parser of sorts.\n\nI’m also not a fan of grammar checks, and it’s not clear to me why this particular one is even in the spec to begin with","format":"org.matrix.custom.html","formatted_body":"<mx-reply><blockquote><a href=\"https://matrix.to/#/!AGetWbsMpFPdSgUrbs:matrix.org/$0fh5tGjrdPm8AScIoLfH8adcDxQMgki6jW4cw9m1-6Y?via=matrix.org&via=mozilla.org&via=igalia.com\">In reply to</a> <a href=\"https://matrix.to/#/@annevk:matrix.org\">@annevk:matrix.org</a><br><a href=\"https://matrix.to/#/@sideshowbarker:matrix.org\">sideshowbarker</a>: hmm, so what happens if parse and serialize gives a different value from the input, does that end up being invalid? Curious how this is implemented. As a matter of principle I'm not a big fan of grammar checks. They're almost never implemented that way and if they are would largely duplicate an existing parser of sorts.</blockquote></mx-reply>I’m also not a fan of grammar checks, and it’s not clear to me why this particular one is even in the spec to begin with","m.mentions":{"user_ids":["@annevk:matrix.org"]},"m.relates_to":{"m.in_reply_to":{"event_id":"$0fh5tGjrdPm8AScIoLfH8adcDxQMgki6jW4cw9m1-6Y"}},"msgtype":"m.text"},"ts":1724742551811,"senderName":"sideshowbarker","senderId":"@sideshowbarker:matrix.org","id":"$fd-Lsoo1yMzEI2K2Zp_DcfOHgeJvUfg1iOEGtnClpSU"},
{"content":{"body":"And as far as them never getting implemented as spec’d — yeah, I think that’s the case here","m.mentions":{},"msgtype":"m.text"},"ts":1724742607644,"senderName":"sideshowbarker","senderId":"@sideshowbarker:matrix.org","id":"$q8Vj2oi3h46i8YbUYF3nEc5IXZuokkwhGXiMJFta_Lc"},
{"content":{"body":"However, Ladybird has a default policy of implementing spec algorithms as spec’d — so I’m attempting to implement it that way","m.mentions":{},"msgtype":"m.text"},"ts":1724742679527,"senderName":"sideshowbarker","senderId":"@sideshowbarker:matrix.org","id":"$oTv0kRxMEkBf1BHvpN_aKxqMOzZjWshzvkwinN_g5WE"},
{"content":{"body":"For the sake of comparison, the WebKit implementation looks nothing like the spec","m.mentions":{},"msgtype":"m.text"},"ts":1724742710626,"senderName":"sideshowbarker","senderId":"@sideshowbarker:matrix.org","id":"$UgTU1K-K3iDUMPO4q7vSJrhmofXnvk8-RWnOoKYxP70"},
{"content":{"body":"lemme get a link","m.mentions":{},"msgtype":"m.text"},"ts":1724742717343,"senderName":"sideshowbarker","senderId":"@sideshowbarker:matrix.org","id":"$ft8CWeGbhOPglEtciFVBc29Zhyft7LgLhVKQ8cVvY18"},
{"content":{"body":"https://github.com/WebKit/WebKit/blob/f6fd2039015c4cbd575768f822ac036102dbc79c/Source/WebCore/html/parser/HTMLParserIdioms.cpp#L220-L232","m.mentions":{},"msgtype":"m.text"},"ts":1724742811810,"senderName":"sideshowbarker","senderId":"@sideshowbarker:matrix.org","id":"$InlLgIRD-JG5LI8sXUXRyoiVPQve3gdsKWBj4eNQ_iY"},
{"content":{"body":"```c++\n    // parseDouble() allows the string to start with a '+' or to end with a '.' but those\n    // are not valid floating point numbers as per HTML.\n    if (characters.front() == '+' || characters.back() == '.')\n        return std::nullopt;\n    size_t parsedLength = 0;\n    double number = parseDouble(characters, parsedLength);\n    return parsedLength == characters.size() && std::isfinite(number) ? number : std::optional<double>();\n```\n","format":"org.matrix.custom.html","formatted_body":"<pre><code class=\"language-c++\">    // parseDouble() allows the string to start with a '+' or to end with a '.' but those\n    // are not valid floating point numbers as per HTML.\n    if (characters.front() == '+' || characters.back() == '.')\n        return std::nullopt;\n    size_t parsedLength = 0;\n    double number = parseDouble(characters, parsedLength);\n    return parsedLength == characters.size() &amp;&amp; std::isfinite(number) ? number : std::optional&lt;double&gt;();\n</code></pre>\n","m.mentions":{},"msgtype":"m.text"},"ts":1724742841508,"senderName":"sideshowbarker","senderId":"@sideshowbarker:matrix.org","id":"$qKkiThQQC-864xq_PJGZT6WYJAiXXT1rv6FHwfz_-XE"}
]
[
{"content":{"body":"Domenic: I was looking at https://github.com/web-platform-tests/wpt/pull/21041 again and I think they match implementations, but not the spec. The spec grabs the document when calling parseFromString(). But implementations (and the tests) assume it's grabbed as part of the DOMParser invocation.","format":"org.matrix.custom.html","formatted_body":"<a href=\"https://matrix.to/#/@domenicdenicola:matrix.org\">Domenic</a>: I was looking at https://github.com/web-platform-tests/wpt/pull/21041 again and I think they match implementations, but not the spec. The spec grabs the document when calling parseFromString(). But implementations (and the tests) assume it's grabbed as part of the DOMParser invocation.","m.mentions":{"user_ids":["@domenicdenicola:matrix.org"]},"msgtype":"m.text"},"ts":1705908655059,"senderName":"annevk","senderId":"@annevk:matrix.org","id":"$KP0JQYdMJnc-fKVD6Oobl7rXWbH8vdH5MQsgJsln2OM"},
{"content":{"body":"Domenic: I prototype'd the spec in https://github.com/WebKit/WebKit/pull/22971 and got a number of test failures.","format":"org.matrix.custom.html","formatted_body":"<a href=\"https://matrix.to/#/@domenicdenicola:matrix.org\">Domenic</a>: I prototype'd the spec in https://github.com/WebKit/WebKit/pull/22971 and got a number of test failures.","m.mentions":{"user_ids":["@domenicdenicola:matrix.org"]},"msgtype":"m.text"},"ts":1705908699680,"senderName":"annevk","senderId":"@annevk:matrix.org","id":"$I4oa3T_gignZo6LT7LYevNlVxIOyMq0aqwBKGGIJOog"},
{"content":{"body":"There's also some differences across implementations from code inspection. Only Gecko seems to carry over the base URL. And Gecko caches the URL when DOMParser is constructed. So pushState() doesn't impact it. (This fails some tests, though a design like that might be simpler in certain ways.)","m.mentions":{},"msgtype":"m.text"},"ts":1705908797835,"senderName":"annevk","senderId":"@annevk:matrix.org","id":"$2lUY9wtt_Nw4cD6jtlxDzBO3xTgfBOESeSml8m0rMFo"},
{"content":{"body":"Hmm, good catch. Strange that I added tests specifically for this sort of multi-global madness but didn't match the spec when doing so.","m.mentions":{},"msgtype":"m.text"},"ts":1705908844292,"senderName":"Domenic","senderId":"@domenicdenicola:matrix.org","id":"$3Cnb6WW2qjmod-9TDKhyBOdD_Wvr3pghnmCK9CUGL2o"},
{"content":{"body":"> <@annevk:matrix.org> Domenic: I was looking at https://github.com/web-platform-tests/wpt/pull/21041 again and I think they match implementations, but not the spec. The spec grabs the document when calling parseFromString(). But implementations (and the tests) assume it's grabbed as part of the DOMParser invocation.\n\nWait, no, I think the tests match the spec. \"this's relevant global object's associated Document\" is equivalent to the global at the time `new DOMParser()` was called; `new DOMParser()` creates `this`.","format":"org.matrix.custom.html","formatted_body":"<mx-reply><blockquote><a href=\"https://matrix.to/#/!AGetWbsMpFPdSgUrbs:matrix.org/$KP0JQYdMJnc-fKVD6Oobl7rXWbH8vdH5MQsgJsln2OM?via=matrix.org&via=mozilla.org&via=igalia.com\">In reply to</a> <a href=\"https://matrix.to/#/@annevk:matrix.org\">@annevk:matrix.org</a><br><a href=\"https://matrix.to/#/@domenicdenicola:matrix.org\">Domenic</a>: I was looking at https://github.com/web-platform-tests/wpt/pull/21041 again and I think they match implementations, but not the spec. The spec grabs the document when calling parseFromString(). But implementations (and the tests) assume it's grabbed as part of the DOMParser invocation.</blockquote></mx-reply>Wait, no, I think the tests match the spec. \"this's relevant global object's associated Document\" is equivalent to the global at the time <code>new DOMParser()</code> was called; <code>new DOMParser()</code> creates <code>this</code>.","m.mentions":{"user_ids":["@annevk:matrix.org"]},"m.relates_to":{"m.in_reply_to":{"event_id":"$KP0JQYdMJnc-fKVD6Oobl7rXWbH8vdH5MQsgJsln2OM"}},"msgtype":"m.text"},"ts":1705909468933,"senderName":"Domenic","senderId":"@domenicdenicola:matrix.org","id":"$vkVnxsaJqKp-oGdnRAJ2ziHkhLVVH-bofLndK7dArJY"},
{"content":{"body":"Your patch prototypes using the current global object's associated Document, which is not what the spec says.","m.mentions":{},"msgtype":"m.text"},"ts":1705909486084,"senderName":"Domenic","senderId":"@domenicdenicola:matrix.org","id":"$Wfsy5PZZ9FHziHhMgwFc_95wxVjWp6PKFgbUbfRDeH4"},
{"content":{"body":"Domenic: interesting, thanks! So whenever we use relevant I guess we implicitly require the implementation to store a reference in the constructor. I guess that makes sense.","format":"org.matrix.custom.html","formatted_body":"<a href=\"https://matrix.to/#/@domenicdenicola:matrix.org\">Domenic</a>: interesting, thanks! So whenever we use relevant I guess we implicitly require the implementation to store a reference in the constructor. I guess that makes sense.","m.mentions":{"user_ids":["@domenicdenicola:matrix.org"]},"msgtype":"m.text"},"ts":1705909764454,"senderName":"annevk","senderId":"@annevk:matrix.org","id":"$1_T-miXWBemk5IPy1VScs67_SwIklHtMhd2b4vqKAY0"},
{"content":{"body":"Yeah, I kind of thought all implementations already did that? Web IDL certainly assumes it.","m.mentions":{},"msgtype":"m.text"},"ts":1705909972271,"senderName":"Domenic","senderId":"@domenicdenicola:matrix.org","id":"$JSRz60T9fcHqc0OqbDnY_jGUQuqOJ121auz0IL1ghXA"},
{"content":{"body":"At least a reference to the global, from which you can get the document","m.mentions":{},"msgtype":"m.text"},"ts":1705909982741,"senderName":"Domenic","senderId":"@domenicdenicola:matrix.org","id":"$V0TFrZmZKLneDxZzdRk-tB05477aZXJf_y6ZfPmWQek"},
{"content":{"body":"Domenic: It looks to be manual in all three implementations. Chromium and WebKit even use a WeakPtr which worries me a little bit, but it's hard to force GC in tests so not sure if my concerns are well-founded.","format":"org.matrix.custom.html","formatted_body":"<a href=\"https://matrix.to/#/@domenicdenicola:matrix.org\">Domenic</a>: It looks to be manual in all three implementations. Chromium and WebKit even use a WeakPtr which worries me a little bit, but it's hard to force GC in tests so not sure if my concerns are well-founded.","m.mentions":{"user_ids":["@domenicdenicola:matrix.org"]},"msgtype":"m.text"},"ts":1705910054732,"senderName":"annevk","senderId":"@annevk:matrix.org","id":"$ci1BAwgucprZQXTrZ-wEQ3OTTVRPp3rDEw_Q6jgc5CQ"},
{"content":{"body":"Hmm yeah, in Chromium there's a variety of easy utility classes and templates you can inherit from I guess, but that makes sense.","m.mentions":{},"msgtype":"m.text"},"ts":1705910132053,"senderName":"Domenic","senderId":"@domenicdenicola:matrix.org","id":"$AnQm9rAnfiUYcn3HeVMeOHOQEv6DXn5_uInl5c-O4J4"},
{"content":{"body":"Or maybe there's just some leftover code in DOMParser that's redundant with more recent IDL developments?","m.mentions":{},"msgtype":"m.text"},"ts":1705910148806,"senderName":"annevk","senderId":"@annevk:matrix.org","id":"$rvO12pbLs80gdOqo3dAmXSoYdc1XmQPZLbZbie237qM"}
]
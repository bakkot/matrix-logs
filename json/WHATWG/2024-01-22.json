[
{"content":{"body":"Domenic: I was looking at https://github.com/web-platform-tests/wpt/pull/21041 again and I think they match implementations, but not the spec. The spec grabs the document when calling parseFromString(). But implementations (and the tests) assume it's grabbed as part of the DOMParser invocation.","format":"org.matrix.custom.html","formatted_body":"<a href=\"https://matrix.to/#/@domenicdenicola:matrix.org\">Domenic</a>: I was looking at https://github.com/web-platform-tests/wpt/pull/21041 again and I think they match implementations, but not the spec. The spec grabs the document when calling parseFromString(). But implementations (and the tests) assume it's grabbed as part of the DOMParser invocation.","m.mentions":{"user_ids":["@domenicdenicola:matrix.org"]},"msgtype":"m.text"},"ts":1705908655059,"senderName":"annevk","senderId":"@annevk:matrix.org","id":"$KP0JQYdMJnc-fKVD6Oobl7rXWbH8vdH5MQsgJsln2OM"},
{"content":{"body":"Domenic: I prototype'd the spec in https://github.com/WebKit/WebKit/pull/22971 and got a number of test failures.","format":"org.matrix.custom.html","formatted_body":"<a href=\"https://matrix.to/#/@domenicdenicola:matrix.org\">Domenic</a>: I prototype'd the spec in https://github.com/WebKit/WebKit/pull/22971 and got a number of test failures.","m.mentions":{"user_ids":["@domenicdenicola:matrix.org"]},"msgtype":"m.text"},"ts":1705908699680,"senderName":"annevk","senderId":"@annevk:matrix.org","id":"$I4oa3T_gignZo6LT7LYevNlVxIOyMq0aqwBKGGIJOog"},
{"content":{"body":"There's also some differences across implementations from code inspection. Only Gecko seems to carry over the base URL. And Gecko caches the URL when DOMParser is constructed. So pushState() doesn't impact it. (This fails some tests, though a design like that might be simpler in certain ways.)","m.mentions":{},"msgtype":"m.text"},"ts":1705908797835,"senderName":"annevk","senderId":"@annevk:matrix.org","id":"$2lUY9wtt_Nw4cD6jtlxDzBO3xTgfBOESeSml8m0rMFo"},
{"content":{"body":"Hmm, good catch. Strange that I added tests specifically for this sort of multi-global madness but didn't match the spec when doing so.","m.mentions":{},"msgtype":"m.text"},"ts":1705908844292,"senderName":"Domenic","senderId":"@domenicdenicola:matrix.org","id":"$3Cnb6WW2qjmod-9TDKhyBOdD_Wvr3pghnmCK9CUGL2o"},
{"content":{"body":"> <@annevk:matrix.org> Domenic: I was looking at https://github.com/web-platform-tests/wpt/pull/21041 again and I think they match implementations, but not the spec. The spec grabs the document when calling parseFromString(). But implementations (and the tests) assume it's grabbed as part of the DOMParser invocation.\n\nWait, no, I think the tests match the spec. \"this's relevant global object's associated Document\" is equivalent to the global at the time `new DOMParser()` was called; `new DOMParser()` creates `this`.","format":"org.matrix.custom.html","formatted_body":"<mx-reply><blockquote><a href=\"https://matrix.to/#/!AGetWbsMpFPdSgUrbs:matrix.org/$KP0JQYdMJnc-fKVD6Oobl7rXWbH8vdH5MQsgJsln2OM?via=matrix.org&via=mozilla.org&via=igalia.com\">In reply to</a> <a href=\"https://matrix.to/#/@annevk:matrix.org\">@annevk:matrix.org</a><br><a href=\"https://matrix.to/#/@domenicdenicola:matrix.org\">Domenic</a>: I was looking at https://github.com/web-platform-tests/wpt/pull/21041 again and I think they match implementations, but not the spec. The spec grabs the document when calling parseFromString(). But implementations (and the tests) assume it's grabbed as part of the DOMParser invocation.</blockquote></mx-reply>Wait, no, I think the tests match the spec. \"this's relevant global object's associated Document\" is equivalent to the global at the time <code>new DOMParser()</code> was called; <code>new DOMParser()</code> creates <code>this</code>.","m.mentions":{"user_ids":["@annevk:matrix.org"]},"m.relates_to":{"m.in_reply_to":{"event_id":"$KP0JQYdMJnc-fKVD6Oobl7rXWbH8vdH5MQsgJsln2OM"}},"msgtype":"m.text"},"ts":1705909468933,"senderName":"Domenic","senderId":"@domenicdenicola:matrix.org","id":"$vkVnxsaJqKp-oGdnRAJ2ziHkhLVVH-bofLndK7dArJY"},
{"content":{"body":"Your patch prototypes using the current global object's associated Document, which is not what the spec says.","m.mentions":{},"msgtype":"m.text"},"ts":1705909486084,"senderName":"Domenic","senderId":"@domenicdenicola:matrix.org","id":"$Wfsy5PZZ9FHziHhMgwFc_95wxVjWp6PKFgbUbfRDeH4"}
]
[
{"content":{"body":"https://x.com/filpizlo/status/2017074082249048347","m.mentions":{},"msgtype":"m.text"},"ts":1769750401698,"senderName":"sideshowbarker","senderId":"@sideshowbarker:matrix.org","id":"$oAOpJSzSE7waUz98X3eJrI8nuU8duBYah00znv_powA"},
{"content":{"body":"Commented. Thanks","m.mentions":{},"m.relates_to":{"event_id":"$n87fNeNL_5aey_5CZcAhBZLdeBUwlNhZZH-7g6523U0","is_falling_back":true,"m.in_reply_to":{"event_id":"$lR8C7xnHwKTBW77PMCBTCqCPs8IJD6JPw--oMd4qzVA"},"rel_type":"m.thread"},"msgtype":"m.text"},"ts":1769757261715,"senderName":"zcorpan","senderId":"@zcorpan:mozilla.org","id":"$qW4bypDftNpTn-lLnS7qnjNMRvTy4zYjir7LEiMd3aA"},
{"content":{"body":"zcorpan: We were talking on the whattnot call about the *‚ÄúWhy not just use PIs instead of minting a new exclamation point syntax?‚Äù* question for the marker thing, and Noam mentioned you had expressed some rationale for why. What was that? Or could you give a link(s) to your comment(s) on that?","format":"org.matrix.custom.html","formatted_body":"<a href=\"https://matrix.to/#/@zcorpan:mozilla.org\">zcorpan</a>: We were talking on the whattnot call about the <em>‚ÄúWhy not just use PIs instead of minting a new exclamation point syntax?‚Äù</em> question for the marker thing, and Noam mentioned you had expressed some rationale for why. What was that? Or could you give a link(s) to your comment(s) on that?","m.mentions":{"user_ids":["@zcorpan:mozilla.org"]},"msgtype":"m.text"},"ts":1769757555348,"senderName":"sideshowbarker","senderId":"@sideshowbarker:matrix.org","id":"$KHrvF7AztEGmSVkRsgp30GipvMUqbJinVl958UvVVe0"},
{"content":{"body":"IMHO Henri makes a pretty strong case for why we should just use PIs¬†‚Äî¬†unless there‚Äôs some really compelling reason not to.","m.mentions":{},"msgtype":"m.text"},"ts":1769757642326,"senderName":"sideshowbarker","senderId":"@sideshowbarker:matrix.org","id":"$dtjc14XwORTD3F4gAOoND2haVFwUxA_qLoGQb1lxJR0"},
{"content":{"body":"> <@sideshowbarker:matrix.org> IMHO Henri makes a pretty strong case for why we should just use PIs¬†‚Äî¬†unless there‚Äôs some really compelling reason not to.\n\nFWIW I was convinced especially by the arguments that extensions might be incompat; I think we can have something like ProcessingInstruction.prototype.marker that points to the actual clean marker data, not even a subclass, and can respond to mutations of the PI's data. This allows zero modifications to DOM and makes marker inspection and manipulation agnostic of whether its xml or HTML ","format":"org.matrix.custom.html","formatted_body":"<mx-reply><blockquote><a href=\"https://matrix.to/#/!AGetWbsMpFPdSgUrbs:matrix.org/$dtjc14XwORTD3F4gAOoND2haVFwUxA_qLoGQb1lxJR0?via=matrix.org&via=mozilla.org&via=igalia.com\">In reply to</a> <a href=\"https://matrix.to/#/@sideshowbarker:matrix.org\">@sideshowbarker:matrix.org</a><br />IMHO Henri makes a pretty strong case for why we should just use PIs¬†‚Äî¬†unless there‚Äôs some really compelling reason not to.</blockquote></mx-reply>FWIW I was convinced especially by the arguments that extensions might be incompat; I think we can have something like ProcessingInstruction.prototype.marker that points to the actual clean marker data, not even a subclass, and can respond to mutations of the PI's data. This allows zero modifications to DOM and makes marker inspection and manipulation agnostic of whether its xml or HTML","m.relates_to":{"m.in_reply_to":{"event_id":"$dtjc14XwORTD3F4gAOoND2haVFwUxA_qLoGQb1lxJR0"}},"msgtype":"m.text"},"ts":1769758404380,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$nM5TxpGfbFmRbaBgaWy3E2u-2u8JIRHpGKn_PHWk-0A"},
{"content":{"body":"sideshowbarker: I proposed it in https://github.com/whatwg/html/issues/11542#issuecomment-3759955087\n\nThe main benefit I think is less confusion about the end of the \"tag\" in the syntax. In XML PIs end with ?> but in the HTML parser it ends with >. But the compat with XML tooling and DOM traversal scripts is more important, so I think now we should use PIs and live with mutability. We can trim a trailing \"?\" in the parser so polyglot is still possible.","format":"org.matrix.custom.html","formatted_body":"<p><a href=\"https://matrix.to/#/@sideshowbarker:matrix.org\">sideshowbarker</a>: I proposed it in https://github.com/whatwg/html/issues/11542#issuecomment-3759955087</p>\n<p>The main benefit I think is less confusion about the end of the \"tag\" in the syntax. In XML PIs end with ?&gt; but in the HTML parser it ends with &gt;. But the compat with XML tooling and DOM traversal scripts is more important, so I think now we should use PIs and live with mutability. We can trim a trailing \"?\" in the parser so polyglot is still possible.</p>\n","m.mentions":{"user_ids":["@sideshowbarker:matrix.org"]},"msgtype":"m.text"},"ts":1769759134110,"senderName":"zcorpan","senderId":"@zcorpan:mozilla.org","id":"$YEEzT-VnmVs04BT8hdGAiQs7Wj7vRGaK473jVJVK5-Q"},
{"content":{"body":"Ah I see:\n\n> _If we're going to use a new node type instead of ProcessingInstruction, there's no need to use the syntax for processing instructions._\n\nSo yeah, objectively it‚Äôd make sense _if_ we did have a very good reason to use a new node type. Which takes it back more to just being about the question of whether we need to use a new node type. And yeah the _‚Äúthe compat with XML tooling and DOM traversal scripts‚Äù_ argument seems to weigh things more heavily toward not doing that.","format":"org.matrix.custom.html","formatted_body":"<p>Ah I see:</p>\n<blockquote>\n<p><em>If we're going to use a new node type instead of ProcessingInstruction, there's no need to use the syntax for processing instructions.</em></p>\n</blockquote>\n<p>So yeah, objectively it‚Äôd make sense <em>if</em> we did have a very good reason to use a new node type. Which takes it back more to just being about the question of whether we need to use a new node type. And yeah the <em>‚Äúthe compat with XML tooling and DOM traversal scripts‚Äù</em> argument seems to weigh things more heavily toward not doing that.</p>\n","m.mentions":{},"msgtype":"m.text"},"ts":1769759513829,"senderName":"sideshowbarker","senderId":"@sideshowbarker:matrix.org","id":"$00Worvo6HYPAO9viohKWkbhz6swDSHmQSTFcVWbhFkE"},
{"content":{"body":"Note that `ProcessingInstruction`'s \"target\" is immutable, so at least the marker type can remain immutable and mutating the data only affects the name and whatever attributes future usages of this process","format":"org.matrix.custom.html","formatted_body":"Note that <code>ProcessingInstruction</code>'s \"target\" is immutable, so at least the marker type can remain immutable and mutating the data only affects the name and whatever attributes future usages of this process","m.mentions":{"user_ids":["@zcorpan:mozilla.org"]},"m.relates_to":{"m.in_reply_to":{"event_id":"$YEEzT-VnmVs04BT8hdGAiQs7Wj7vRGaK473jVJVK5-Q"}},"msgtype":"m.text"},"ts":1769759671145,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$CbiCIDzzUFp53-Ph0PCvPHMLjB-NOPVsxyW_xdxYgTY"},
{"content":{"body":"Noam Rosenthal: ah yes. Simplest would be to not have pseudo-attributes but just take the data and treat as the name. If we want fail-open future compat: no have pseudo-attributes for now, but let the name be the part in the data before any whitespace.","format":"org.matrix.custom.html","formatted_body":"<a href=\"https://matrix.to/#/@noamr:matrix.org\">Noam Rosenthal</a>: ah yes. Simplest would be to not have pseudo-attributes but just take the data and treat as the name. If we want fail-open future compat: no have pseudo-attributes for now, but let the name be the part in the data before any whitespace.","m.mentions":{"user_ids":["@noamr:matrix.org"]},"msgtype":"m.text"},"ts":1769760202756,"senderName":"zcorpan","senderId":"@zcorpan:mozilla.org","id":"$YQc6m5r9B3G7WI3z58enZoErT5Qt3RZJLVCvAePT8j4"},
{"content":{"body":"> <@zcorpan:mozilla.org> Noam Rosenthal: ah yes. Simplest would be to not have pseudo-attributes but just take the data and treat as the name. If we want fail-open future compat: no have pseudo-attributes for now, but let the name be the part in the data before any whitespace.\n\nYes I think the latter. There are already emerging cases for pseudo attributes, eg for using this for css custom highlights ","format":"org.matrix.custom.html","formatted_body":"<mx-reply><blockquote><a href=\"https://matrix.to/#/!AGetWbsMpFPdSgUrbs:matrix.org/$YQc6m5r9B3G7WI3z58enZoErT5Qt3RZJLVCvAePT8j4?via=matrix.org&via=mozilla.org&via=igalia.com\">In reply to</a> <a href=\"https://matrix.to/#/@zcorpan:mozilla.org\">@zcorpan:mozilla.org</a><br /><a href=\"https://matrix.to/#/@noamr:matrix.org\">Noam Rosenthal</a>: ah yes. Simplest would be to not have pseudo-attributes but just take the data and treat as the name. If we want fail-open future compat: no have pseudo-attributes for now, but let the name be the part in the data before any whitespace.</blockquote></mx-reply>Yes I think the latter. There are already emerging cases for pseudo attributes, eg for using this for css custom highlights","m.relates_to":{"m.in_reply_to":{"event_id":"$YQc6m5r9B3G7WI3z58enZoErT5Qt3RZJLVCvAePT8j4"}},"msgtype":"m.text"},"ts":1769760258087,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$exTlQNWBjVipZplshfhpnvCI4TMo8UysmuGwpAoysGI"},
{"content":{"body":"I wonder if it's important to have it as a property of a PI rather than a subclass. HTML elements are subclasses despite not being known to XML","msgtype":"m.text"},"ts":1769760311846,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$v-BINTwLvzjhdNyjiz7pIPbe1tFOAjGSpRf79AvvMUI"},
{"content":{"body":"Hmm yeah, subclass seems like it should be compatible enough. I think it would only break checks like `node.constructor.name` but probably scripts usually use `nodeType`","format":"org.matrix.custom.html","formatted_body":"Hmm yeah, subclass seems like it should be compatible enough. I think it would only break checks like <code>node.constructor.name</code> but probably scripts usually use <code>nodeType</code>","m.mentions":{},"msgtype":"m.text"},"ts":1769761199238,"senderName":"zcorpan","senderId":"@zcorpan:mozilla.org","id":"$3Gt42ZmPp7GCgODU67e2EGXmmZHjHMg-d_PfRDKKEFk"},
{"content":{"body":"Do we need a subclass? If we actually define how the pseudo-attributes are parsed in a way that exactly matches what we do for style sheets we could just repurpose all of it.","m.mentions":{},"msgtype":"m.text"},"ts":1769763508482,"senderName":"annevk","senderId":"@annevk:matrix.org","id":"$pMoDVg5mD1fVlpjIp5WM2pcOdRftKdC6FXrvgwyTjGQ"},
{"content":{"body":"We might have some flexibility to start allowing unquoted values in there or names without values. Not sure.","m.mentions":{},"msgtype":"m.text"},"ts":1769763608743,"senderName":"annevk","senderId":"@annevk:matrix.org","id":"$uUKlET9Uo-tcRwL8jknqI7Di_87ruIyQVpNs2DAFuFE"},
{"content":{"body":"> <@annevk:matrix.org> Do we need a subclass? If we actually define how the pseudo-attributes are parsed in a way that exactly matches what we do for style sheets we could just repurpose all of it.\n\nProbably for the case where a plain xml PI is adopted in an HTML doc ","format":"org.matrix.custom.html","formatted_body":"<mx-reply><blockquote><a href=\"https://matrix.to/#/!AGetWbsMpFPdSgUrbs:matrix.org/$pMoDVg5mD1fVlpjIp5WM2pcOdRftKdC6FXrvgwyTjGQ?via=matrix.org&via=mozilla.org&via=igalia.com\">In reply to</a> <a href=\"https://matrix.to/#/@annevk:matrix.org\">@annevk:matrix.org</a><br />Do we need a subclass? If we actually define how the pseudo-attributes are parsed in a way that exactly matches what we do for style sheets we could just repurpose all of it.</blockquote></mx-reply>Probably for the case where a plain xml PI is adopted in an HTML doc","m.relates_to":{"m.in_reply_to":{"event_id":"$pMoDVg5mD1fVlpjIp5WM2pcOdRftKdC6FXrvgwyTjGQ"}},"msgtype":"m.text"},"ts":1769763699166,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$bnbq2Mspl2x1ZsZkAp-C9xNGT3QDSwYyVAppq0gpUt0"},
{"content":{"body":"But not 100% certain ","msgtype":"m.text"},"ts":1769763722378,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$x6nULLQ-yKxsrgcwHdTD1i_tqOh67Oruw9uXLhtYsj4"},
{"content":{"body":"I'm not sure I understand. I think Henri's idea is that we essentially have PIs with as much structure as they have today and then the structured data is created lazily on top, perhaps exposed through an API. And the syntax for the structured data follows what we already implement for the xml-stylesheet PI.","m.mentions":{},"msgtype":"m.text"},"ts":1769763838056,"senderName":"annevk","senderId":"@annevk:matrix.org","id":"$ZHWpsUDpxvXbcFFTNCybV0wMjrRGne4pS-xqqK26NRI"},
{"content":{"body":"> <@annevk:matrix.org> I'm not sure I understand. I think Henri's idea is that we essentially have PIs with as much structure as they have today and then the structured data is created lazily on top, perhaps exposed through an API. And the syntax for the structured data follows what we already implement for the xml-stylesheet PI.\n\nYes, the question is if the marker specific API is exposed for things that are not a marker target. Currently though it's just a name","format":"org.matrix.custom.html","formatted_body":"<mx-reply><blockquote><a href=\"https://matrix.to/#/!AGetWbsMpFPdSgUrbs:matrix.org/$ZHWpsUDpxvXbcFFTNCybV0wMjrRGne4pS-xqqK26NRI?via=matrix.org&via=mozilla.org&via=igalia.com\">In reply to</a> <a href=\"https://matrix.to/#/@annevk:matrix.org\">@annevk:matrix.org</a><br />I'm not sure I understand. I think Henri's idea is that we essentially have PIs with as much structure as they have today and then the structured data is created lazily on top, perhaps exposed through an API. And the syntax for the structured data follows what we already implement for the xml-stylesheet PI.</blockquote></mx-reply>Yes, the question is if the marker specific API is exposed for things that are not a marker target. Currently though it's just a name","m.relates_to":{"m.in_reply_to":{"event_id":"$ZHWpsUDpxvXbcFFTNCybV0wMjrRGne4pS-xqqK26NRI"}},"msgtype":"m.text"},"ts":1769763901653,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$URBTywQuPS0b0djYqlxA_6HDZUMXxQP4ITfqIxSYzgw"},
{"content":{"body":"I think we just make all PIs possible markers and all of them support some kind of attribute API. So you can do <?highlight> and such.","m.mentions":{},"msgtype":"m.text"},"ts":1769763960545,"senderName":"annevk","senderId":"@annevk:matrix.org","id":"$ZemvmwvI05EcJcdCm-nRMOi5uzYy5qFh95_ELUN-35Q"},
{"content":{"body":"and then highlightPI.setAttribute('type', 'syntax-error') or some such.","m.mentions":{},"msgtype":"m.text"},"ts":1769763999391,"senderName":"annevk","senderId":"@annevk:matrix.org","id":"$fSGg8hQk2J_nFJQxa-prc8qyv6VdrEHubuLilvXBHDM"},
{"content":{"body":"* And then highlightPI.setAttribute('type', 'syntax-error') or some such.","m.mentions":{},"m.new_content":{"body":"And then highlightPI.setAttribute('type', 'syntax-error') or some such.","m.mentions":{},"msgtype":"m.text"},"m.relates_to":{"event_id":"$fSGg8hQk2J_nFJQxa-prc8qyv6VdrEHubuLilvXBHDM","rel_type":"m.replace"},"msgtype":"m.text"},"ts":1769764006830,"senderName":"annevk","senderId":"@annevk:matrix.org","id":"$JGvS0aXnCjN6O0DMd_e-dDiVFhRishAvo5jRLpPwNN8"},
{"content":{"body":"> <@annevk:matrix.org> I think we just make all PIs possible markers and all of them support some kind of attribute API. So you can do <?highlight> and such.\n\nThat's also ok though the parser needs to know which ones to parse, to avoid web compat issues","format":"org.matrix.custom.html","formatted_body":"<mx-reply><blockquote><a href=\"https://matrix.to/#/!AGetWbsMpFPdSgUrbs:matrix.org/$ZemvmwvI05EcJcdCm-nRMOi5uzYy5qFh95_ELUN-35Q?via=matrix.org&via=mozilla.org&via=igalia.com\">In reply to</a> <a href=\"https://matrix.to/#/@annevk:matrix.org\">@annevk:matrix.org</a><br />I think we just make all PIs possible markers and all of them support some kind of attribute API. So you can do &lt;?highlight&gt; and such.</blockquote></mx-reply>That's also ok though the parser needs to know which ones to parse, to avoid web compat issues","m.relates_to":{"m.in_reply_to":{"event_id":"$ZemvmwvI05EcJcdCm-nRMOi5uzYy5qFh95_ELUN-35Q"}},"msgtype":"m.text"},"ts":1769764015719,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$TVIjqggMbBFdZ_9ttAPHyAN4v4em76v2GwJZw0THhdQ"},
{"content":{"body":"Ie parse unknown ones as bogus comments ","msgtype":"m.text"},"ts":1769764045739,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$U96DYqOXQxVJ_dSjI3ifxphibBAoOLlN1mMfgXMBi1g"},
{"content":{"body":"Have we already identified we can't parse <? as PIs universally?","m.mentions":{},"msgtype":"m.text"},"ts":1769764058909,"senderName":"annevk","senderId":"@annevk:matrix.org","id":"$ozsVZPpOoAnC4QgAwf0csqywtlmtmDX2bIBB1vohP6Q"},
{"content":{"body":"We identified that there is use of them in the wild as bogus comments ","msgtype":"m.text"},"ts":1769764078651,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$NP5az5HQuTYTFKK2wIDQgp-8ctVdc8hL-VgSx2PIw6g"},
{"content":{"body":"Not a whole lot but some target names are in use","msgtype":"m.text"},"ts":1769764106918,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$XEdkPGY_N0Pcnxg_kDau6haBe1ZdzewPpC8pRkgQRvc"},
{"content":{"body":"Do you think we can blocklist?","m.mentions":{},"msgtype":"m.text"},"ts":1769764123865,"senderName":"annevk","senderId":"@annevk:matrix.org","id":"$xh3vi_x8u6GOEY6RTX40d70f59ffGyj6ckjtbDyb_Vo"},
{"content":{"body":"At the very least extending it to the full range of names is something we can do gradually ","msgtype":"m.text"},"ts":1769764130101,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$TW7Hru6PtP5HakJxA-ykayo3oNNnOuOl_2ARN5e-LuU"},
{"content":{"body":"As in first just parse an allowlist and continue from there with a separate compat rollout ","msgtype":"m.text"},"ts":1769764166980,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$Y8wtEorN4YgKE_xZ6rP4rlMW0rk-8VF_WVNGeX0J9rM"},
{"content":{"body":"If we just ban xml/xml-stylesheet/php/?","m.mentions":{},"msgtype":"m.text"},"ts":1769764177245,"senderName":"annevk","senderId":"@annevk:matrix.org","id":"$vyms7LjjFjI2SedyasIQd1xB2XFd7vod9SUv89E_7WY"},
{"content":{"body":"Probably a few more common ones in the HA IIRC","msgtype":"m.text"},"ts":1769764203692,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$ubnXwJt6fFsASHPJYJz3EewCYgHtgnQfEFqFajea4mE"},
{"content":{"body":"It seems like we should be able to get some data on that and then just forever let those names be bogus comments.","m.mentions":{},"msgtype":"m.text"},"ts":1769764235815,"senderName":"annevk","senderId":"@annevk:matrix.org","id":"$tG5MsIk_TFwEKYQCz5rZWRm3_CKkAWEqrUv5xU1rPco"},
{"content":{"body":"I am not opposed to that. In the end it's the same feature with different compat strategies.","msgtype":"m.text"},"ts":1769764287991,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$QSjqEOtR8fWTBZBSYln8m1JqnhO5q9t_le7vKSVrbFs"},
{"content":{"body":"I think figuring that out first will give us a bit more room when we get to concrete features that will use these PIs. So doing the parser changes to enable PIs in HTML and figuring out the syntax xml-stylesheet PIs use in a bit more detail.","m.mentions":{},"msgtype":"m.text"},"ts":1769764446623,"senderName":"annevk","senderId":"@annevk:matrix.org","id":"$DcZ_-LoGkgJZgZhSTuNnDywHjBGxIRf9MYPYBKU6LyY"},
{"content":{"body":"Btw another feature I can envision for these markers/PIs is a directive for the parser to buffer instead of stream, to help authors avoid rendering at intermediate points... But that needs some incubation ","msgtype":"m.text"},"ts":1769765473899,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$7uyu_5CEK5T5x14xWfxs7kHA4Xky3MQmOEPStb1Pkvc"},
{"content":{"body":"https://docs.google.com/spreadsheets/d/1VZDB3BA-G5VZpHdpYAEczVB1u2iEkN2YC-6dZdNuyBU/edit?gid=0#gid=0\n\nxml, php, ra-page, xpacket, if, echo, import appear in more than 0.001% of main document responses in January 2026.\nOnly <?xml and <?php appear in more than 0.1% of pages, Up to us where we want to draw the line","m.mentions":{},"msgtype":"m.text"},"ts":1769769237934,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$-A-B-GkZsBzCzd6_FIShMU_VCZpgKTMqnRG8WfKifU4"},
{"content":{"body":"<?xpacket?> is usually inside svg for embedding XMP info about the SVG. I don't think anyone relies on these becoming comments in particular","m.mentions":{},"msgtype":"m.text"},"ts":1769770156707,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$dVIskXGCKmgJ3wyxmvyBC7dIw4UQOw-QNGsH9eWW6Zo"},
{"content":{"body":"<?ra-page?> is in Japanese government websites but I don't think it's queried client-side. <?if and <?echo are leaks from PHP","m.mentions":{},"msgtype":"m.text"},"ts":1769770219168,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$0ElNoMxEczh47RIA8vyl7E9m-EWVEdJfzQLdK6Lxh8Y"},
{"content":{"body":"When implementation uses separate processes per site, what is the current global supposed to be in [focus()](https://html.spec.whatwg.org/#dom-window-focus) when site A calls siteBWindow.focus().  I assume it is null, given that current realm is \"running execution context, or am I missing something.  (This is related to the focus-without-user-activation)","format":"org.matrix.custom.html","formatted_body":"When implementation uses separate processes per site, what is the current global supposed to be in <a href=\"https://html.spec.whatwg.org/#dom-window-focus\">focus()</a> when site A calls siteBWindow.focus().  I assume it is null, given that current realm is \"running execution context, or am I missing something.  (This is related to the focus-without-user-activation)","m.mentions":{},"msgtype":"m.text"},"ts":1769770309155,"senderName":"smaug","senderId":"@smaug:mozilla.org","id":"$TB12LxL7oVRjFPliy932lH7QukA8A4wr7F-AK3sWtQk"},
{"content":{"body":"Though, even currently, similar question applies to window.close() and its use of incumbent global.","m.mentions":{},"msgtype":"m.text"},"ts":1769770370478,"senderName":"smaug","senderId":"@smaug:mozilla.org","id":"$5gg9r4FCzxy3UqlqbqgdY6WVKrqNNa2WR_40jXNbmVY"},
{"content":{"body":"* When implementation uses separate processes per site, what is the current global supposed to be in [focus()](https://html.spec.whatwg.org/#dom-window-focus) when site A calls siteBWindow.focus().  I assume it is null, given that current realm is \"running execution context\", or am I missing something.  (This is related to the focus-without-user-activation)","format":"org.matrix.custom.html","formatted_body":"* When implementation uses separate processes per site, what is the current global supposed to be in <a href=\"https://html.spec.whatwg.org/#dom-window-focus\">focus()</a> when site A calls siteBWindow.focus().  I assume it is null, given that current realm is \"running execution context\", or am I missing something.  (This is related to the focus-without-user-activation)","m.mentions":{},"m.new_content":{"body":"When implementation uses separate processes per site, what is the current global supposed to be in [focus()](https://html.spec.whatwg.org/#dom-window-focus) when site A calls siteBWindow.focus().  I assume it is null, given that current realm is \"running execution context\", or am I missing something.  (This is related to the focus-without-user-activation)","format":"org.matrix.custom.html","formatted_body":"When implementation uses separate processes per site, what is the current global supposed to be in <a href=\"https://html.spec.whatwg.org/#dom-window-focus\">focus()</a> when site A calls siteBWindow.focus().  I assume it is null, given that current realm is \"running execution context\", or am I missing something.  (This is related to the focus-without-user-activation)","m.mentions":{},"msgtype":"m.text"},"m.relates_to":{"event_id":"$TB12LxL7oVRjFPliy932lH7QukA8A4wr7F-AK3sWtQk","rel_type":"m.replace"},"msgtype":"m.text"},"ts":1769770737460,"senderName":"smaug","senderId":"@smaug:mozilla.org","id":"$lo9lvmvr9PHVxPaTcAUwj-cc0OEfeIk-Z0ZHKZvYBNk"},
{"content":{"body":"Isn't it a `SecurityError`?","format":"org.matrix.custom.html","formatted_body":"Isn't it a <code>SecurityError</code>?","m.mentions":{"user_ids":["@smaug:mozilla.org"]},"m.relates_to":{"m.in_reply_to":{"event_id":"$TB12LxL7oVRjFPliy932lH7QukA8A4wr7F-AK3sWtQk"}},"msgtype":"m.text"},"ts":1769771009151,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$1XrRhxpbBawKWCgJZqcNvs-erBEtD6LodGfeeCNZfAU"},
{"content":{"body":"It's defined as a cross-origin property on WindowProxy","m.mentions":{},"msgtype":"m.text"},"ts":1769771031055,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$tq7StTEuoM51yUduJS2iU1rU20Rg8A5iO1DXqG1tZeA"},
{"content":{"body":"I mean, you can call siteBWindow.focus()","m.mentions":{},"msgtype":"m.text"},"ts":1769771034107,"senderName":"smaug","senderId":"@smaug:mozilla.org","id":"$OnFQ7w3oseU46N8ad_iPhG6pGvuPxY6sqNfpuchG8o4"},
{"content":{"body":"right","m.mentions":{},"msgtype":"m.text"},"ts":1769771042900,"senderName":"smaug","senderId":"@smaug:mozilla.org","id":"$CHSfN5NAqhczLderwfGoJvo5dE9X3hU3EW-JM3FIgA4"},
{"content":{"body":"But does something actually define how this is supposed to work? I mean other than things like [this](https://html.spec.whatwg.org/#cross-origin-objects:~:text=If%20IsCallable%28value%29%20is%20true%2C%20then%20set%20value%20to%20an%20anonymous%20built%2Din%20function%2C%20created%20in%20the%20current%20realm%2C%20that%20performs%20the%20same%20steps%20as%20the%20IDL%20operation%20P%20on%20object%20O%2E). I could very well miss something here.","format":"org.matrix.custom.html","formatted_body":"But does something actually define how this is supposed to work? I mean other than things like <a href=\"https://html.spec.whatwg.org/#cross-origin-objects:~:text=If%20IsCallable%28value%29%20is%20true%2C%20then%20set%20value%20to%20an%20anonymous%20built%2Din%20function%2C%20created%20in%20the%20current%20realm%2C%20that%20performs%20the%20same%20steps%20as%20the%20IDL%20operation%20P%20on%20object%20O%2E\">this</a>. I could very well miss something here.","m.mentions":{},"msgtype":"m.text"},"ts":1769771192041,"senderName":"smaug","senderId":"@smaug:mozilla.org","id":"$DkTPnlD1zkqIYwxwVfWVpzGKm_Hc6NpvM7Bs35cjkn8"},
{"content":{"body":"https://html.spec.whatwg.org/multipage/nav-history-apis.html#integration-with-idl:crossoriginproperties-(-o-) ?","m.mentions":{"user_ids":["@smaug:mozilla.org"]},"m.relates_to":{"m.in_reply_to":{"event_id":"$DkTPnlD1zkqIYwxwVfWVpzGKm_Hc6NpvM7Bs35cjkn8"}},"msgtype":"m.text"},"ts":1769771259110,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$zpOUiQf9bGRdIo5ydWbiB1DgUTVBQH_DtalSryL-Nqk"},
{"content":{"body":"oh this means that it *is* callable I guess","format":"org.matrix.custom.html","formatted_body":"oh this means that it <em>is</em> callable I guess","m.mentions":{},"msgtype":"m.text"},"ts":1769771298346,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$hJECQI3KEbXiSD7gqW4WhEb-gfjUFUtiUTR6BKnuH28"},
{"content":{"body":"window.close() works fine for cross site","m.mentions":{},"msgtype":"m.text"},"ts":1769771361960,"senderName":"smaug","senderId":"@smaug:mozilla.org","id":"$ToLviD5-Fsal3II8NmVFSdG5jLQz5-EXA-c3laXbq4w"},
{"content":{"body":"right, my mistake. seems like in blink it queries the incumbent \nhttps://source.chromium.org/chromium/chromium/src/+/main:third_party/blink/renderer/core/frame/dom_window.cc;l=704?q=dom_window.c&ss=chromium%2Fchromium%2Fsrc","m.mentions":{},"msgtype":"m.text"},"ts":1769771652645,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$xXNe0TQ6V_gd_kz30nqvRJv8tNswX5HEoSff1bEHLuA"},
{"content":{"body":"what what might incumbent be if cross-site case? And why ? üôÇ ","m.mentions":{},"msgtype":"m.text"},"ts":1769771706785,"senderName":"smaug","senderId":"@smaug:mozilla.org","id":"$FcH78PYEiJP5kgHgczERcQZ22YDEnvT3WbyUvC_rEoU"},
{"content":{"body":"* what what might incumbent be in cross-site case? And why ? üôÇ ","m.mentions":{},"m.new_content":{"body":"what what might incumbent be in cross-site case? And why ? üôÇ ","m.mentions":{},"msgtype":"m.text"},"m.relates_to":{"event_id":"$FcH78PYEiJP5kgHgczERcQZ22YDEnvT3WbyUvC_rEoU","rel_type":"m.replace"},"msgtype":"m.text"},"ts":1769771713466,"senderName":"smaug","senderId":"@smaug:mozilla.org","id":"$vMSZ1AmfLiwT2lRt8O3ndwoxgksaiFlRM-UbHQDbkOg"},
{"content":{"body":"(but incumbent global thingie has the backup stack, so current global might be even different from it)","m.mentions":{},"msgtype":"m.text"},"ts":1769771783161,"senderName":"smaug","senderId":"@smaug:mozilla.org","id":"$O6fU-OWmDMuw9cgn2uUO2k-kbIkHm9zPQE_Vg6iglDM"},
{"content":{"body":"* What might incumbent be in cross-site case? And why ? üôÇ ","m.mentions":{},"m.new_content":{"body":"What might incumbent be in cross-site case? And why ? üôÇ ","m.mentions":{},"msgtype":"m.text"},"m.relates_to":{"event_id":"$FcH78PYEiJP5kgHgczERcQZ22YDEnvT3WbyUvC_rEoU","rel_type":"m.replace"},"msgtype":"m.text"},"ts":1769771886818,"senderName":"smaug","senderId":"@smaug:mozilla.org","id":"$UOE3NS7UN0dJ9BBx7kq3XVN_YNEQq1m-GYccpjamvWY"},
{"content":{"body":"Noam Rosenthal: I would draw a very conservative line as none of those names seem particularly important. And I think I would include xml-stylesheet because it currently doesn't work and would enable injection attacks if it started working.","format":"org.matrix.custom.html","formatted_body":"<a href=\"https://matrix.to/#/@noamr:matrix.org\">Noam Rosenthal</a>: I would draw a very conservative line as none of those names seem particularly important. And I think I would include xml-stylesheet because it currently doesn't work and would enable injection attacks if it started working.","m.mentions":{"user_ids":["@noamr:matrix.org"]},"msgtype":"m.text"},"ts":1769777720001,"senderName":"annevk","senderId":"@annevk:matrix.org","id":"$jqMnskGt7PdMNO_wbSynDx9-Q3Ubjbdd8Vd4mlfYHZg"},
{"content":{"body":"> <@annevk:matrix.org> Noam Rosenthal: I would draw a very conservative line as none of those names seem particularly important. And I think I would include xml-stylesheet because it currently doesn't work and would enable injection attacks if it started working.\n\nYea xml, xml-stylesheet and maybe php seem sufficient ","format":"org.matrix.custom.html","formatted_body":"<mx-reply><blockquote><a href=\"https://matrix.to/#/!AGetWbsMpFPdSgUrbs:matrix.org/$jqMnskGt7PdMNO_wbSynDx9-Q3Ubjbdd8Vd4mlfYHZg?via=matrix.org&via=mozilla.org&via=igalia.com\">In reply to</a> <a href=\"https://matrix.to/#/@annevk:matrix.org\">@annevk:matrix.org</a><br /><a href=\"https://matrix.to/#/@noamr:matrix.org\">Noam Rosenthal</a>: I would draw a very conservative line as none of those names seem particularly important. And I think I would include xml-stylesheet because it currently doesn't work and would enable injection attacks if it started working.</blockquote></mx-reply>Yea xml, xml-stylesheet and maybe php seem sufficient","m.relates_to":{"m.in_reply_to":{"event_id":"$jqMnskGt7PdMNO_wbSynDx9-Q3Ubjbdd8Vd4mlfYHZg"}},"msgtype":"m.text"},"ts":1769779334953,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$jnY6c2T4dMLXibcpyuratLiEatHlOu68NcI0BjK-AZE"},
{"content":{"body":"Noam Rosenthal: with conservative I meant including all the things you spot, but I think we're willing to try it either way. üòä","format":"org.matrix.custom.html","formatted_body":"<a href=\"https://matrix.to/#/@noamr:matrix.org\">Noam Rosenthal</a>: with conservative I meant including all the things you spot, but I think we're willing to try it either way. üòä","m.mentions":{"user_ids":["@noamr:matrix.org"]},"msgtype":"m.text"},"ts":1769779680679,"senderName":"annevk","senderId":"@annevk:matrix.org","id":"$Q_g9pMv5DB_csEzmOQ47W0bsw-kF1XA0dmXbrAwoYK4"},
{"content":{"body":"annevk: good point about `<?xml-stylesheet?>`. I definitely don't think we should make those work in HTML, and maybe keeping them as bogus comments is the way. If parsed into PIs, then we'd have to think about what they do if moved into XML documents...","format":"org.matrix.custom.html","formatted_body":"<a href=\"https://matrix.to/#/@annevk:matrix.org\">annevk</a>: good point about <code>&lt;?xml-stylesheet?&gt;</code>. I definitely don't think we should make those work in HTML, and maybe keeping them as bogus comments is the way. If parsed into PIs, then we'd have to think about what they do if moved into XML documents...","m.mentions":{"user_ids":["@annevk:matrix.org"]},"msgtype":"m.text"},"ts":1769781491752,"senderName":"foolip","senderId":"@foolip:matrix.org","id":"$_EhjQxwDhUDQm9xp2zkmQce_-yzo4TxSLpVepbh0yEM"},
{"content":{"body":"On pseudo-attributes, I think this is a decision we actually need to make up front, because if we want to use the syntax `<?start mything?>`, `mything` looks an awful lot like a boolean attribute, and I think it would be super weird to later have the mix `<?start mything more=\"stuff\"?>` where you can't reverse the order.","format":"org.matrix.custom.html","formatted_body":"On pseudo-attributes, I think this is a decision we actually need to make up front, because if we want to use the syntax <code>&lt;?start mything?&gt;</code>, <code>mything</code> looks an awful lot like a boolean attribute, and I think it would be super weird to later have the mix <code>&lt;?start mything more=\"stuff\"?&gt;</code> where you can't reverse the order.","m.mentions":{},"msgtype":"m.text"},"ts":1769781620760,"senderName":"foolip","senderId":"@foolip:matrix.org","id":"$T-AXkuHT6MYWVRJeuiIof-5JNNObOAuLGmAnl5Ur_Co"},
{"content":{"body":"I see the `<?ra-page?>` thing is apparently from http://developer.symmetric.jp/roundabout/faq/000877.html ‚Äî¬†some product named Roundabout that seems to have stopped being marketed more than 10 years ago. So all that  `<?ra-page?>`  is legacy stuff; there‚Äôs never going to ever end up being more of it.","format":"org.matrix.custom.html","formatted_body":"I see the <code>&lt;?ra-page?&gt;</code> thing is apparently from http://developer.symmetric.jp/roundabout/faq/000877.html ‚Äî&nbsp;some product named Roundabout that seems to have stopped being marketed more than 10 years ago. So all that  <code>&lt;?ra-page?&gt;</code>  is legacy stuff; there‚Äôs never going to ever end up being more of it.","m.mentions":{},"msgtype":"m.text"},"ts":1769781642457,"senderName":"sideshowbarker","senderId":"@sideshowbarker:matrix.org","id":"$Hspq4slhQwGLVI1zW8dJMbKzIjaKfJvY7c-IChwvsqA"},
{"content":{"body":"foolip: agreed, as I said above that would be a good first step here: \"So doing the parser changes to enable PIs in HTML and figuring out the syntax xml-stylesheet PIs use in a bit more detail.\"","format":"org.matrix.custom.html","formatted_body":"<a href=\"https://matrix.to/#/@foolip:matrix.org\">foolip</a>: agreed, as I said above that would be a good first step here: \"So doing the parser changes to enable PIs in HTML and figuring out the syntax xml-stylesheet PIs use in a bit more detail.\"","m.mentions":{"user_ids":["@foolip:matrix.org"]},"msgtype":"m.text"},"ts":1769781853770,"senderName":"annevk","senderId":"@annevk:matrix.org","id":"$iWSOWzYT7Z3T2yvOuS39Z1V32CvKNOmB03LblQwMvHM"},
{"content":{"body":"Yes, that's what I want to try now.","m.mentions":{},"msgtype":"m.text"},"ts":1769781878476,"senderName":"foolip","senderId":"@foolip:matrix.org","id":"$dVc7BJeYc_VSoTGuveUmEhaq2AU-Wqd2rBn9oEqi5BU"},
{"content":{"body":"Unfortunately, if we want follow existing <? syntax, I think the more verbose `<?start name=\"mything\"?>` is necessary.","m.mentions":{},"msgtype":"m.text"},"ts":1769781904456,"senderName":"foolip","senderId":"@foolip:matrix.org","id":"$Nw4JruAPJ6TWJfMhW9geoUm_QL1hvbPADqTCtgPkB3I"},
{"content":{"body":"foolip: as a baseline, yes. But I think we're still XML-compatible if we extend it.","format":"org.matrix.custom.html","formatted_body":"<a href=\"https://matrix.to/#/@foolip:matrix.org\">foolip</a>: as a baseline, yes. But I think we're still XML-compatible if we extend it.","m.mentions":{"user_ids":["@foolip:matrix.org"]},"msgtype":"m.text"},"ts":1769781942058,"senderName":"annevk","senderId":"@annevk:matrix.org","id":"$swv4Z9A7jDjNSm5Jc_PpHhwJFKMLOBkx7d6FBjWeb-o"},
{"content":{"body":"One wrinkle might be whether we want to support `<?xml-stylesheet href=foo.css?>` in XML, but I think that would be okay.","format":"org.matrix.custom.html","formatted_body":"One wrinkle might be whether we want to support <code>&lt;?xml-stylesheet href=foo.css?&gt;</code> in XML, but I think that would be okay.","m.mentions":{},"msgtype":"m.text"},"ts":1769782074784,"senderName":"annevk","senderId":"@annevk:matrix.org","id":"$i8UZyPGiBhlg4-vigcTGeVBYz7wi7-ScAXIa9TkUZPc"},
{"content":{"body":"If we go with an attributes model, then we'd obviously serialize it into something that works in XML even if HTML doesn't require quotes and whatnot.","m.mentions":{},"msgtype":"m.text"},"ts":1769782080858,"senderName":"foolip","senderId":"@foolip:matrix.org","id":"$xeGzs6_y1ktCGrbNjJgRW8VeYGmnxo1JMpwWRSdzU5k"},
{"content":{"body":"That makes sense, but there's also the question at which layer this micro parser lives. If xml-stylesheet parsing is part of the XML parser it doesn't matter, but I suspect it's higher level?","m.mentions":{},"msgtype":"m.text"},"ts":1769782163214,"senderName":"annevk","senderId":"@annevk:matrix.org","id":"$rifPJfbhmS_P-5uARBguOeyG6czTA7Qw56cMC2DnFCs"},
{"content":{"body":"Good question, I wonder if XML parser API's expose it or if it's built on top...","m.mentions":{},"msgtype":"m.text"},"ts":1769782204458,"senderName":"foolip","senderId":"@foolip:matrix.org","id":"$Y5V3UuvrrMHYeFM-ZxcQ2ortKH6DOY-ixPEexkvybGU"},
{"content":{"body":"I suspect it's on top and if so, we'd want to make that shared code somehow.","m.mentions":{},"msgtype":"m.text"},"ts":1769782235860,"senderName":"annevk","senderId":"@annevk:matrix.org","id":"$wvWEGx6fzCbPLIa6P6g7EXpoab1EH-V5jyioEvhYMTs"},
{"content":{"body":"(The reason I suspect it's on top is because PIs don't have any knowledge about this currently.)","m.mentions":{},"msgtype":"m.text"},"ts":1769782260337,"senderName":"annevk","senderId":"@annevk:matrix.org","id":"$yGKpmzQY_QAxiC7knszOEOqiIUJSiyP69AnclelDZAk"},
{"content":{"body":"Which spec defined <?xml-stylesheet?>?","m.mentions":{},"msgtype":"m.text"},"ts":1769782350178,"senderName":"foolip","senderId":"@foolip:matrix.org","id":"$Lj-pCqOSGwOa4Pc6vBPxvZ4-IbVT0W4qwu9si4Gh_54"},
{"content":{"body":"https://www.w3.org/TR/xml-stylesheet/","m.mentions":{},"msgtype":"m.text"},"ts":1769782399787,"senderName":"foolip","senderId":"@foolip:matrix.org","id":"$JMaoOkNgJ3GVhr_yBng9GAYlXjQtjwlUwB2__nK2C8U"},
{"content":{"body":"Yeah, in combination with https://drafts.csswg.org/cssom/#requirements-on-user-agents-implementing-the-xml-stylesheet-processing-instruction which I think I wrote (at least part of) at some point.","m.mentions":{},"msgtype":"m.text"},"ts":1769782539186,"senderName":"annevk","senderId":"@annevk:matrix.org","id":"$oqnBTDwjrTmrJMrofEL1c1aQvSGgus6SUr0bbJfpwxg"},
{"content":{"body":"So in spec it's layered on top, and in Chromium as well, it parses the data string: https://source.chromium.org/chromium/chromium/src/+/main:third_party/blink/renderer/core/dom/processing_instruction.cc;l=114-189;drc=089ae32bf2adeb77bd0afd067c006ce02707f548","m.mentions":{},"msgtype":"m.text"},"ts":1769782594841,"senderName":"foolip","senderId":"@foolip:matrix.org","id":"$jrYcx3y0YVAnlxG03cmPcyf7L1Qap3DYe7Wr6hYTNa8"},
{"content":{"body":"I was initially fairly skeptical, but I kinda like reusing PIs now. Glad hsivonen ","format":"org.matrix.custom.html","formatted_body":"I was initially fairly skeptical, but I kinda like reusing PIs now. Glad <a href=\"https://matrix.to/#/@hsivonen:mozilla.org\">hsivonen</a>","m.mentions":{"user_ids":["@hsivonen:mozilla.org"]},"msgtype":"m.text"},"ts":1769782603535,"senderName":"annevk","senderId":"@annevk:matrix.org","id":"$HuD54J8HrcbdquPHz7mqOH8Dvg2VENM82Tt57KARlMU"},
{"content":{"body":"* I was initially fairly skeptical, but I kinda like reusing PIs now. Glad hsivonen chimed in.","format":"org.matrix.custom.html","formatted_body":"* I was initially fairly skeptical, but I kinda like reusing PIs now. Glad <a href=\"https://matrix.to/#/@hsivonen:mozilla.org\">hsivonen</a> chimed in.","m.mentions":{},"m.new_content":{"body":"I was initially fairly skeptical, but I kinda like reusing PIs now. Glad hsivonen chimed in.","format":"org.matrix.custom.html","formatted_body":"I was initially fairly skeptical, but I kinda like reusing PIs now. Glad <a href=\"https://matrix.to/#/@hsivonen:mozilla.org\">hsivonen</a> chimed in.","m.mentions":{"user_ids":["@hsivonen:mozilla.org"]},"msgtype":"m.text"},"m.relates_to":{"event_id":"$HuD54J8HrcbdquPHz7mqOH8Dvg2VENM82Tt57KARlMU","rel_type":"m.replace"},"msgtype":"m.text"},"ts":1769782613623,"senderName":"annevk","senderId":"@annevk:matrix.org","id":"$lBKNFp9WXoz-D9cEzj35qWxbfztTSDsUygO4lL1EmOY"},
{"content":{"body":"I think what we could change is that we do the \"data parse\" as part of allocating the PI node so we can be sure everyone gets the same thing. And then we have to decide if \"data parse\" is identical across HTML and XML and if we want to support syntax beyond what xml-stylesheet allows. \"data serialize\" should be identical across HTML and XML in any event and be compatible with xml-stylesheet.","m.mentions":{},"msgtype":"m.text"},"ts":1769782887004,"senderName":"annevk","senderId":"@annevk:matrix.org","id":"$zq15csacoNoHmzVct5fZO7NGwbO3cFggeVjFKQSjTi4"},
{"content":{"body":"Though it might be a bit more involved still as currently PIs pretty much roundtrip as-is so maybe \"data serialize\" is just \"return input\".","m.mentions":{},"msgtype":"m.text"},"ts":1769782963455,"senderName":"annevk","senderId":"@annevk:matrix.org","id":"$pydi0OZACgZa9DN_5mvJGhlgpAzrD4L4O2aaYS7fVww"},
{"content":{"body":"Anyway, fun project.","m.mentions":{},"msgtype":"m.text"},"ts":1769782981877,"senderName":"annevk","senderId":"@annevk:matrix.org","id":"$SNXiOr0s7APrfFdN2ssH20rpTqQnRh66EScaSTWXa74"},
{"content":{"body":"üëã","m.mentions":{},"msgtype":"m.text"},"ts":1769783413038,"senderName":"Tim van der Lippe","senderId":"@timvdlippe:matrix.org","id":"$aJLn2QZ6uNCr91VNDNNYIEN2RVSEsvkpmfFDiiT5czY"},
{"content":{"body":"\nHey folks! Could someone help verify our WPT URL test implementation, or point me to the right person to talk to about it?\n\nFor context, we‚Äôre developing an industry-grade, pure-Python, open-source implementation of the WHATWG URL specification, and we‚Äôd like to confirm that our tests align with the official ones.\n\nAny help would be greatly appreciated!\n","m.mentions":{},"msgtype":"m.text"},"ts":1769789415377,"senderName":"opavliuk","senderId":"@opavliuk:matrix.org","id":"$ej9lA_0B4YdCoDMhOkvEY9yOtl0Hc5mKp4RIkEHlgVE"},
{"content":{"body":"opavliuk: what's the question?","format":"org.matrix.custom.html","formatted_body":"<a href=\"https://matrix.to/#/@opavliuk:matrix.org\">opavliuk</a>: what's the question?","m.mentions":{"user_ids":["@opavliuk:matrix.org"]},"msgtype":"m.text"},"ts":1769792770365,"senderName":"annevk","senderId":"@annevk:matrix.org","id":"$QwEd1-e-0GefgQkyorpdU0q7UtgcIVtAA0ualM4ft0U"},
{"content":{"body":"\n\nannevk thank you for getting back to me.\n\n   We selected the following test data files from https://github.com/web-platform-tests/wpt/tree/master/url/resources:\n* IdnaTestV2.json\n* IdnaTestV2-removed.json\n* percent-encoding.json\n* setters_tests.json\n* toascii.json\n* urltestdata.json\n\nSo my first question is: are these test data sets sufficient to verify conformance of a standalone Python (i.e., non-JavaScript, non-browser) implementation of the WHATWG URL specification?\n","format":"org.matrix.custom.html","formatted_body":"<p><a href=\"https://matrix.to/#/@annevk:matrix.org\">annevk</a> thank you for getting back to me.</p>\n<p>We selected the following test data files from https://github.com/web-platform-tests/wpt/tree/master/url/resources:</p>\n<ul>\n<li>IdnaTestV2.json</li>\n<li>IdnaTestV2-removed.json</li>\n<li>percent-encoding.json</li>\n<li>setters_tests.json</li>\n<li>toascii.json</li>\n<li>urltestdata.json</li>\n</ul>\n<p>So my first question is: are these test data sets sufficient to verify conformance of a standalone Python (i.e., non-JavaScript, non-browser) implementation of the WHATWG URL specification?</p>\n","m.mentions":{"user_ids":["@annevk:matrix.org"]},"m.relates_to":{"event_id":"$QwEd1-e-0GefgQkyorpdU0q7UtgcIVtAA0ualM4ft0U","is_falling_back":true,"m.in_reply_to":{"event_id":"$QwEd1-e-0GefgQkyorpdU0q7UtgcIVtAA0ualM4ft0U"},"rel_type":"m.thread"},"msgtype":"m.text"},"ts":1769796887828,"senderName":"opavliuk","senderId":"@opavliuk:matrix.org","id":"$SovLCGyQru9D4d_Or4Ho7cVvNiUkjfmv2XsZpeSn2LM"},
{"content":{"body":"I think they should be. setters_tests are somewhat specific to the JS API for URLs. Not sure if you want to imitate that, but you're welcome to of course.","m.mentions":{},"m.relates_to":{"event_id":"$QwEd1-e-0GefgQkyorpdU0q7UtgcIVtAA0ualM4ft0U","is_falling_back":true,"m.in_reply_to":{"event_id":"$SovLCGyQru9D4d_Or4Ho7cVvNiUkjfmv2XsZpeSn2LM"},"rel_type":"m.thread"},"msgtype":"m.text"},"ts":1769797205152,"senderName":"annevk","senderId":"@annevk:matrix.org","id":"$-ujDTqHebO7xGSWYeZQD-4D6c6qtspBq-lL3Ogj1j9c"},
{"content":{"body":"If you're doing percent-encoding as an API, note https://github.com/whatwg/url/pull/896 as well which reduces the surface area bit.","m.mentions":{},"m.relates_to":{"event_id":"$QwEd1-e-0GefgQkyorpdU0q7UtgcIVtAA0ualM4ft0U","is_falling_back":true,"m.in_reply_to":{"event_id":"$-ujDTqHebO7xGSWYeZQD-4D6c6qtspBq-lL3Ogj1j9c"},"rel_type":"m.thread"},"msgtype":"m.text"},"ts":1769797292918,"senderName":"annevk","senderId":"@annevk:matrix.org","id":"$riBPCNxcW2v71sOgVQT7NRF4nxz2eQ4yUQq0NAOqMa0"},
{"content":{"body":"* If you're doing percent-encoding as an API, note https://github.com/whatwg/url/pull/896 as well which reduces the surface area a bit.","m.mentions":{},"m.new_content":{"body":"If you're doing percent-encoding as an API, note https://github.com/whatwg/url/pull/896 as well which reduces the surface area a bit.","m.mentions":{},"msgtype":"m.text"},"m.relates_to":{"event_id":"$riBPCNxcW2v71sOgVQT7NRF4nxz2eQ4yUQq0NAOqMa0","rel_type":"m.replace"},"msgtype":"m.text"},"ts":1769797303092,"senderName":"annevk","senderId":"@annevk:matrix.org","id":"$4RKf-XX1XfqmTaisbkIMiqbRZ9G5MTzsEem8gxZAbrU"},
{"content":{"body":"To add, these tests have also been used to prove an independent C++ implementation that's now used in Node.js. And there's implementations in several other languages as well, though I haven't kept track.","m.mentions":{},"m.relates_to":{"event_id":"$QwEd1-e-0GefgQkyorpdU0q7UtgcIVtAA0ualM4ft0U","is_falling_back":true,"m.in_reply_to":{"event_id":"$riBPCNxcW2v71sOgVQT7NRF4nxz2eQ4yUQq0NAOqMa0"},"rel_type":"m.thread"},"msgtype":"m.text"},"ts":1769797400799,"senderName":"annevk","senderId":"@annevk:matrix.org","id":"$2CoIQyLoHQ31qRyKFFQKbqbwv0a1c-h9NuO1p4twqaI"},
{"content":{"body":"> I think they should be\n\nGreat, thank you!\n\n> setters_tests are somewhat specific to the JS API for URLs. Not sure if you want to imitate that, but you're welcome to of course.\n\nif I understand you correctly, you‚Äôre saying that using them is optional unless we intend to closely imitate the JS API.\nour intention is to satisfy the specification at the API level, while also providing a pythonic interface alongside it","format":"org.matrix.custom.html","formatted_body":"<blockquote>\n<p>I think they should be</p>\n</blockquote>\n<p>Great, thank you!</p>\n<blockquote>\n<p>setters_tests are somewhat specific to the JS API for URLs. Not sure if you want to imitate that, but you're welcome to of course.</p>\n</blockquote>\n<p>if I understand you correctly, you‚Äôre saying that using them is optional unless we intend to closely imitate the JS API.<br>our intention is to satisfy the specification at the API level, while also providing a pythonic interface alongside it</p>\n","m.mentions":{},"m.relates_to":{"event_id":"$QwEd1-e-0GefgQkyorpdU0q7UtgcIVtAA0ualM4ft0U","is_falling_back":true,"m.in_reply_to":{"event_id":"$2CoIQyLoHQ31qRyKFFQKbqbwv0a1c-h9NuO1p4twqaI"},"rel_type":"m.thread"},"msgtype":"m.text"},"ts":1769797539687,"senderName":"opavliuk","senderId":"@opavliuk:matrix.org","id":"$_WXDla8EsyqSx5UtbdffO9yPc396BtGSA8hgsgB62Sg"},
{"content":{"body":"> these tests have also been used to prove an independent C++ implementation that's now used in Node.js\n\nI assume you‚Äôre referring to https://github.com/ada-url/ada\nIf so, yes ‚Äî we use it as a reference implementation üëç\nThe library also provides Python bindings, however, when running our test suite against them, I noticed several failures. That was one of the reasons we decided to start our own project, btw","format":"org.matrix.custom.html","formatted_body":"<blockquote>\n<p>these tests have also been used to prove an independent C++ implementation that's now used in Node.js</p>\n</blockquote>\n<p>I assume you‚Äôre referring to https://github.com/ada-url/ada<br>If so, yes ‚Äî we use it as a reference implementation üëç<br>The library also provides Python bindings, however, when running our test suite against them, I noticed several failures. That was one of the reasons we decided to start our own project, btw</p>\n","m.mentions":{},"m.relates_to":{"event_id":"$QwEd1-e-0GefgQkyorpdU0q7UtgcIVtAA0ualM4ft0U","is_falling_back":true,"m.in_reply_to":{"event_id":"$_WXDla8EsyqSx5UtbdffO9yPc396BtGSA8hgsgB62Sg"},"rel_type":"m.thread"},"msgtype":"m.text"},"ts":1769797771664,"senderName":"opavliuk","senderId":"@opavliuk:matrix.org","id":"$xvp72B5LJOuV-47lPf8Tt1UMXR4gsh3yI8o6iAQ7aco"},
{"content":{"body":"* > these tests have also been used to prove an independent C++ implementation that's now used in Node.js\n\nI assume you‚Äôre referring to https://github.com/ada-url/ada\nIf so, yes ‚Äî we use it as a reference implementation üëç\nThe library also provides Python bindings, however, when running our test suite against them, I noticed several failures related to IDNA. That was one of the reasons we decided to start our own project, btw","format":"org.matrix.custom.html","formatted_body":"* <blockquote>\n<p>these tests have also been used to prove an independent C++ implementation that's now used in Node.js</p>\n</blockquote>\n<p>I assume you‚Äôre referring to https://github.com/ada-url/ada<br>If so, yes ‚Äî we use it as a reference implementation üëç<br>The library also provides Python bindings, however, when running our test suite against them, I noticed several failures related to IDNA. That was one of the reasons we decided to start our own project, btw</p>\n","m.mentions":{},"m.new_content":{"body":"> these tests have also been used to prove an independent C++ implementation that's now used in Node.js\n\nI assume you‚Äôre referring to https://github.com/ada-url/ada\nIf so, yes ‚Äî we use it as a reference implementation üëç\nThe library also provides Python bindings, however, when running our test suite against them, I noticed several failures related to IDNA. That was one of the reasons we decided to start our own project, btw","format":"org.matrix.custom.html","formatted_body":"<blockquote>\n<p>these tests have also been used to prove an independent C++ implementation that's now used in Node.js</p>\n</blockquote>\n<p>I assume you‚Äôre referring to https://github.com/ada-url/ada<br>If so, yes ‚Äî we use it as a reference implementation üëç<br>The library also provides Python bindings, however, when running our test suite against them, I noticed several failures related to IDNA. That was one of the reasons we decided to start our own project, btw</p>\n","m.mentions":{},"msgtype":"m.text"},"m.relates_to":{"event_id":"$xvp72B5LJOuV-47lPf8Tt1UMXR4gsh3yI8o6iAQ7aco","rel_type":"m.replace"},"msgtype":"m.text"},"ts":1769797812227,"senderName":"opavliuk","senderId":"@opavliuk:matrix.org","id":"$l7JtjlbuBPmfjs5D8QJjdIWRL4KWXbOFwP9HBdOvSd0"},
{"content":{"body":"One more question, if you don‚Äôt mind.\n\nSince we‚Äôre getting close to release, I wanted to double-check that our test coverage is complete. For that reason, I looked at the browser test results at https://wpt.fyi/results/url?label=experimental&label=master&aligned\n\nunfortunately, I‚Äôm not able to reliably map the tests listed in the dashboard to the test cases we generate from the JSON files. In some cases the numbers are higher, in others lower, which suggests I‚Äôm approaching this incorrectly.\n\nI‚Äôd appreciate your advice on whether it makes sense to try mapping these at all, and if so, what the correct approach would be?","m.mentions":{},"m.relates_to":{"event_id":"$QwEd1-e-0GefgQkyorpdU0q7UtgcIVtAA0ualM4ft0U","is_falling_back":true,"m.in_reply_to":{"event_id":"$xvp72B5LJOuV-47lPf8Tt1UMXR4gsh3yI8o6iAQ7aco"},"rel_type":"m.thread"},"msgtype":"m.text"},"ts":1769798079294,"senderName":"opavliuk","senderId":"@opavliuk:matrix.org","id":"$tfQDT77FMSG_pqyh_i1vYgk_KDVN2BRcyBq-_CYL1gw"},
{"content":{"body":"my goal is simply to verify that our overall number of tests is at least in the right range, since it differs significantly across implementations.\n\nI‚Äôm essentially looking for a reliable source of truth.","m.mentions":{},"m.relates_to":{"event_id":"$QwEd1-e-0GefgQkyorpdU0q7UtgcIVtAA0ualM4ft0U","is_falling_back":true,"m.in_reply_to":{"event_id":"$tfQDT77FMSG_pqyh_i1vYgk_KDVN2BRcyBq-_CYL1gw"},"rel_type":"m.thread"},"msgtype":"m.text"},"ts":1769798686852,"senderName":"opavliuk","senderId":"@opavliuk:matrix.org","id":"$vToSfl9HFbyWsQ_bF3fN0layzBGSYhBBeWBPkIcYWsc"}
]
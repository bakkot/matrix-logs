[
{"content":{"body":"Noam Rosenthal: thanks for doing that","format":"org.matrix.custom.html","formatted_body":"<a href=\"https://matrix.to/#/@noamr:matrix.org\">Noam Rosenthal</a>: thanks for doing that","msgtype":"m.text","org.matrix.msc1767.message":[{"body":"Noam Rosenthal: thanks for doing that","mimetype":"text/plain"},{"body":"<a href=\"https://matrix.to/#/@noamr:matrix.org\">Noam Rosenthal</a>: thanks for doing that","mimetype":"text/html"}]},"ts":1662517616607,"senderName":"sideshowbarker","senderId":"@sideshowbarker:matrix.org","id":"$cb7fF2jqd7Sn9D4U8Ye2N_P9ST1ZKzHCcZfn-ptAGVQ"},
{"content":{"body":"AFAICT, https://github.com/web-platform-tests/wpt/blob/master/upgrade-insecure-requests/gen/iframe-blank-inherit.meta/upgrade/fetch.https.html tests that calling `document.open()` on the initial `about:blank` inherits `upgrade-insecure-requests` from the caller to the `open()`ed doc. I don't see this specified in either https://w3c.github.io/webappsec-upgrade-insecure-requests/ or https://html.spec.whatwg.org/#document-open-steps . What am I missing? (Also, Gecko tries to inherit CSP between steps 6 and 7, but evidently, it's not inheriting enough.)","format":"org.matrix.custom.html","formatted_body":"AFAICT, https://github.com/web-platform-tests/wpt/blob/master/upgrade-insecure-requests/gen/iframe-blank-inherit.meta/upgrade/fetch.https.html tests that calling <code>document.open()</code> on the initial <code>about:blank</code> inherits <code>upgrade-insecure-requests</code> from the caller to the <code>open()</code>ed doc. I don't see this specified in either https://w3c.github.io/webappsec-upgrade-insecure-requests/ or https://html.spec.whatwg.org/#document-open-steps . What am I missing? (Also, Gecko tries to inherit CSP between steps 6 and 7, but evidently, it's not inheriting enough.)","msgtype":"m.text","org.matrix.msc1767.message":[{"body":"AFAICT, https://github.com/web-platform-tests/wpt/blob/master/upgrade-insecure-requests/gen/iframe-blank-inherit.meta/upgrade/fetch.https.html tests that calling `document.open()` on the initial `about:blank` inherits `upgrade-insecure-requests` from the caller to the `open()`ed doc. I don't see this specified in either https://w3c.github.io/webappsec-upgrade-insecure-requests/ or https://html.spec.whatwg.org/#document-open-steps . What am I missing? (Also, Gecko tries to inherit CSP between steps 6 and 7, but evidently, it's not inheriting enough.)","mimetype":"text/plain"},{"body":"AFAICT, https://github.com/web-platform-tests/wpt/blob/master/upgrade-insecure-requests/gen/iframe-blank-inherit.meta/upgrade/fetch.https.html tests that calling <code>document.open()</code> on the initial <code>about:blank</code> inherits <code>upgrade-insecure-requests</code> from the caller to the <code>open()</code>ed doc. I don't see this specified in either https://w3c.github.io/webappsec-upgrade-insecure-requests/ or https://html.spec.whatwg.org/#document-open-steps . What am I missing? (Also, Gecko tries to inherit CSP between steps 6 and 7, but evidently, it's not inheriting enough.)","mimetype":"text/html"}]},"ts":1662540022338,"senderName":"hsivonen","senderId":"@hsivonen:mozilla.org","id":"$eMSxm6fm9cYp8GBpQEDqASm9292O6L7xfXmGEMNRzXE"},
{"content":{"body":"hsivonen: seems like a bad test. I can't immediately tell given how many layers of generation seem to be going on but I would doubt that was intentionally tested...","format":"org.matrix.custom.html","formatted_body":"<a href=\"https://matrix.to/#/@hsivonen:mozilla.org\">hsivonen</a>: seems like a bad test. I can't immediately tell given how many layers of generation seem to be going on but I would doubt that was intentionally tested...","msgtype":"m.text","org.matrix.msc1767.message":[{"body":"hsivonen: seems like a bad test. I can't immediately tell given how many layers of generation seem to be going on but I would doubt that was intentionally tested...","mimetype":"text/plain"},{"body":"<a href=\"https://matrix.to/#/@hsivonen:mozilla.org\">hsivonen</a>: seems like a bad test. I can't immediately tell given how many layers of generation seem to be going on but I would doubt that was intentionally tested...","mimetype":"text/html"}]},"ts":1662547748526,"senderName":"Domenic","senderId":"@domenicdenicola:matrix.org","id":"$OgD7g_K2bWdNfDXSlX7kO6SNMJPcL8dqLtaevTlHUMk"},
{"content":{"body":"This code looks totally bogus in Chromium to me... https://source.chromium.org/chromium/chromium/src/+/main:third_party/blink/renderer/core/dom/document.cc;l=3257-3285;drc=6bf619d06ef290056d3e134756c1c4eaa17a2d70","msgtype":"m.text","org.matrix.msc1767.text":"This code looks totally bogus in Chromium to me... https://source.chromium.org/chromium/chromium/src/+/main:third_party/blink/renderer/core/dom/document.cc;l=3257-3285;drc=6bf619d06ef290056d3e134756c1c4eaa17a2d70"},"ts":1662547804482,"senderName":"Domenic","senderId":"@domenicdenicola:matrix.org","id":"$Jgti2nZL0hD8_QYPsRcAuhLfcVoI6r6ZQ4Cyw2NTVAE"},
{"content":{"body":"The test was OK after all. I tracked it down to Gecko's failure to recompute upgrade-insecure-requests upon `document.open`","format":"org.matrix.custom.html","formatted_body":"The test was OK after all. I tracked it down to Gecko's failure to recompute upgrade-insecure-requests upon <code>document.open</code>","msgtype":"m.text","org.matrix.msc1767.message":[{"body":"The test was OK after all. I tracked it down to Gecko's failure to recompute upgrade-insecure-requests upon `document.open`","mimetype":"text/plain"},{"body":"The test was OK after all. I tracked it down to Gecko's failure to recompute upgrade-insecure-requests upon <code>document.open</code>","mimetype":"text/html"}]},"ts":1662547843880,"senderName":"hsivonen","senderId":"@hsivonen:mozilla.org","id":"$iZzi3jvxC5D2LXZOu8E_xzuo8cdleatUhUSAuHKu2sw"},
{"content":{"body":"(Gecko copied the CSP OK, but failed to actually run the function to compute upgrade-insecure-requests out of the CSP)","msgtype":"m.text","org.matrix.msc1767.text":"(Gecko copied the CSP OK, but failed to actually run the function to compute upgrade-insecure-requests out of the CSP)"},"ts":1662547882582,"senderName":"hsivonen","senderId":"@hsivonen:mozilla.org","id":"$ZC5MjSohfYe0yzcEr6fYXtaQKkJ3N22InAy4LTN1bUg"},
{"content":{"body":"Fascinating","msgtype":"m.text","org.matrix.msc1767.text":"Fascinating"},"ts":1662547915523,"senderName":"Domenic","senderId":"@domenicdenicola:matrix.org","id":"$YckCSaol2IhwPaJ9HNXTyP_5CO70aY1pEypDJ9a4naY"},
{"content":{"body":"I am hoping we can avoid inheriting anything, whether it's Gecko's CSP or Blink's renderer-process-only sandbox flags / security origin","msgtype":"m.text","org.matrix.msc1767.text":"I am hoping we can avoid inheriting anything, whether it's Gecko's CSP or Blink's renderer-process-only sandbox flags / security origin"},"ts":1662547938295,"senderName":"Domenic","senderId":"@domenicdenicola:matrix.org","id":"$jwwOxYcWdUg6WekZBegpMVj9Kd1eOaMfNo902-H7Tts"},
{"content":{"body":"(Aside: The way `fetch()` spec-wise inherits CSP from the doc in the `window` that `fetch()` is called on, is specified so abstractly that I wasn't confident how upgrade-insecure-requests should propagate, but it turns out that it should propagate from doc to `fetch()`.)","format":"org.matrix.custom.html","formatted_body":"(Aside: The way <code>fetch()</code> spec-wise inherits CSP from the doc in the <code>window</code> that <code>fetch()</code> is called on, is specified so abstractly that I wasn't confident how upgrade-insecure-requests should propagate, but it turns out that it should propagate from doc to <code>fetch()</code>.)","msgtype":"m.text","org.matrix.msc1767.message":[{"body":"(Aside: The way `fetch()` spec-wise inherits CSP from the doc in the `window` that `fetch()` is called on, is specified so abstractly that I wasn't confident how upgrade-insecure-requests should propagate, but it turns out that it should propagate from doc to `fetch()`.)","mimetype":"text/plain"},{"body":"(Aside: The way <code>fetch()</code> spec-wise inherits CSP from the doc in the <code>window</code> that <code>fetch()</code> is called on, is specified so abstractly that I wasn't confident how upgrade-insecure-requests should propagate, but it turns out that it should propagate from doc to <code>fetch()</code>.)","mimetype":"text/html"}]},"ts":1662548039419,"senderName":"hsivonen","senderId":"@hsivonen:mozilla.org","id":"$mKjw6Ewe70Hg3lC5lcnzKNiTZJ-8BD-Le2gyxh_81l4"},
{"content":{"body":"Fuked https://bugs.chromium.org/p/chromium/issues/detail?id=1360795","msgtype":"m.text","org.matrix.msc1767.text":"Fuked https://bugs.chromium.org/p/chromium/issues/detail?id=1360795"},"ts":1662548096501,"senderName":"Domenic","senderId":"@domenicdenicola:matrix.org","id":"$0VCJI7SHHNd8Au6kkFadg0UYkjuglIURoRq4f7qeMjg"},
{"content":{"body":" * Filed https://bugs.chromium.org/p/chromium/issues/detail?id=1360795","m.new_content":{"body":"Filed https://bugs.chromium.org/p/chromium/issues/detail?id=1360795","msgtype":"m.text","org.matrix.msc1767.text":"Filed https://bugs.chromium.org/p/chromium/issues/detail?id=1360795"},"m.relates_to":{"event_id":"$0VCJI7SHHNd8Au6kkFadg0UYkjuglIURoRq4f7qeMjg","rel_type":"m.replace"},"msgtype":"m.text","org.matrix.msc1767.text":" * Filed https://bugs.chromium.org/p/chromium/issues/detail?id=1360795"},"ts":1662548105945,"senderName":"Domenic","senderId":"@domenicdenicola:matrix.org","id":"$SDjTm5x3KboeR1e3lUyYWih3Pt5jCN4o5TQrX707E30"},
{"content":{"body":"Note that the spec's \"URL and history update steps\" usage is probably not web-compatible... we should probably add a warning... see https://github.com/whatwg/html/issues/6556","msgtype":"m.text","org.matrix.msc1767.text":"Note that the spec's \"URL and history update steps\" usage is probably not web-compatible... we should probably add a warning... see https://github.com/whatwg/html/issues/6556"},"ts":1662548161263,"senderName":"Domenic","senderId":"@domenicdenicola:matrix.org","id":"$ABACsuR2HlJ4gMOwQxbLhW9Fbvd4zSVrX6_FZgDs-cM"},
{"content":{"body":"> <@domenicdenicola:matrix.org> Filed https://bugs.chromium.org/p/chromium/issues/detail?id=1360795\n\nIs \"322\" a typo with a digit missing?","format":"org.matrix.custom.html","formatted_body":"<mx-reply><blockquote><a href=\"https://matrix.to/#/!AGetWbsMpFPdSgUrbs:matrix.org/$0VCJI7SHHNd8Au6kkFadg0UYkjuglIURoRq4f7qeMjg?via=matrix.org&via=mozilla.org&via=igalia.com\">In reply to</a> <a href=\"https://matrix.to/#/@domenicdenicola:matrix.org\">@domenicdenicola:matrix.org</a><br>Filed https://bugs.chromium.org/p/chromium/issues/detail?id=1360795</blockquote></mx-reply>Is &quot;322&quot; a typo with a digit missing?","m.relates_to":{"m.in_reply_to":{"event_id":"$0VCJI7SHHNd8Au6kkFadg0UYkjuglIURoRq4f7qeMjg"}},"msgtype":"m.text","org.matrix.msc1767.message":[{"body":"> <@domenicdenicola:matrix.org> Filed https://bugs.chromium.org/p/chromium/issues/detail?id=1360795\n\nIs \"322\" a typo with a digit missing?","mimetype":"text/plain"},{"body":"<mx-reply><blockquote><a href=\"https://matrix.to/#/!AGetWbsMpFPdSgUrbs:matrix.org/$0VCJI7SHHNd8Au6kkFadg0UYkjuglIURoRq4f7qeMjg?via=matrix.org&via=mozilla.org&via=igalia.com\">In reply to</a> <a href=\"https://matrix.to/#/@domenicdenicola:matrix.org\">@domenicdenicola:matrix.org</a><br>Filed https://bugs.chromium.org/p/chromium/issues/detail?id=1360795</blockquote></mx-reply>Is &quot;322&quot; a typo with a digit missing?","mimetype":"text/html"}]},"ts":1662548327990,"senderName":"hsivonen","senderId":"@hsivonen:mozilla.org","id":"$gmXb6aKIpSQfDug5j5JU63HRXkp4y-FeUsTlFKji6Ro"},
{"content":{"body":"> <@domenicdenicola:matrix.org> Note that the spec's \"URL and history update steps\" usage is probably not web-compatible... we should probably add a warning... see https://github.com/whatwg/html/issues/6556\n\nCurrently, I'm finding that tests that test history length start failing with my patch but they already fail in Chrome and pretty consistently if I remove expectations for history length to grow by one more than Chrome grows it, the tests pass both in Chrome and in Firefox+my patch.","format":"org.matrix.custom.html","formatted_body":"<mx-reply><blockquote><a href=\"https://matrix.to/#/!AGetWbsMpFPdSgUrbs:matrix.org/$ABACsuR2HlJ4gMOwQxbLhW9Fbvd4zSVrX6_FZgDs-cM?via=matrix.org&via=mozilla.org&via=igalia.com\">In reply to</a> <a href=\"https://matrix.to/#/@domenicdenicola:matrix.org\">@domenicdenicola:matrix.org</a><br>Note that the spec&#39;s &quot;URL and history update steps&quot; usage is probably not web-compatible... we should probably add a warning... see https://github.com/whatwg/html/issues/6556</blockquote></mx-reply>Currently, I'm finding that tests that test history length start failing with my patch but they already fail in Chrome and pretty consistently if I remove expectations for history length to grow by one more than Chrome grows it, the tests pass both in Chrome and in Firefox+my patch.","m.relates_to":{"m.in_reply_to":{"event_id":"$ABACsuR2HlJ4gMOwQxbLhW9Fbvd4zSVrX6_FZgDs-cM"}},"msgtype":"m.text","org.matrix.msc1767.message":[{"body":"> <@domenicdenicola:matrix.org> Note that the spec's \"URL and history update steps\" usage is probably not web-compatible... we should probably add a warning... see https://github.com/whatwg/html/issues/6556\n\nCurrently, I'm finding that tests that test history length start failing with my patch but they already fail in Chrome and pretty consistently if I remove expectations for history length to grow by one more than Chrome grows it, the tests pass both in Chrome and in Firefox+my patch.","mimetype":"text/plain"},{"body":"<mx-reply><blockquote><a href=\"https://matrix.to/#/!AGetWbsMpFPdSgUrbs:matrix.org/$ABACsuR2HlJ4gMOwQxbLhW9Fbvd4zSVrX6_FZgDs-cM?via=matrix.org&via=mozilla.org&via=igalia.com\">In reply to</a> <a href=\"https://matrix.to/#/@domenicdenicola:matrix.org\">@domenicdenicola:matrix.org</a><br>Note that the spec&#39;s &quot;URL and history update steps&quot; usage is probably not web-compatible... we should probably add a warning... see https://github.com/whatwg/html/issues/6556</blockquote></mx-reply>Currently, I'm finding that tests that test history length start failing with my patch but they already fail in Chrome and pretty consistently if I remove expectations for history length to grow by one more than Chrome grows it, the tests pass both in Chrome and in Firefox+my patch.","mimetype":"text/html"}]},"ts":1662548630372,"senderName":"hsivonen","senderId":"@hsivonen:mozilla.org","id":"$1DvUH7Lwkgma1Oa7QYg0oRVOFs2-Sg-NeMUra8Mf31o"},
{"content":{"body":"Yes, thanks, fixed","msgtype":"m.text","org.matrix.msc1767.text":"Yes, thanks, fixed"},"ts":1662548635235,"senderName":"Domenic","senderId":"@domenicdenicola:matrix.org","id":"$oF4khkG3fPZOffRjngs6-bz_mTRXFSJHaBd0B8ezLZg"},
{"content":{"body":"> <@hsivonen:mozilla.org> Currently, I'm finding that tests that test history length start failing with my patch but they already fail in Chrome and pretty consistently if I remove expectations for history length to grow by one more than Chrome grows it, the tests pass both in Chrome and in Firefox+my patch.\n\nFor document.open() specifically, or other places?","format":"org.matrix.custom.html","formatted_body":"<mx-reply><blockquote><a href=\"https://matrix.to/#/!AGetWbsMpFPdSgUrbs:matrix.org/$1DvUH7Lwkgma1Oa7QYg0oRVOFs2-Sg-NeMUra8Mf31o?via=matrix.org&via=mozilla.org&via=igalia.com\">In reply to</a> <a href=\"https://matrix.to/#/@hsivonen:mozilla.org\">@hsivonen:mozilla.org</a><br>Currently, I'm finding that tests that test history length start failing with my patch but they already fail in Chrome and pretty consistently if I remove expectations for history length to grow by one more than Chrome grows it, the tests pass both in Chrome and in Firefox+my patch.</blockquote></mx-reply>For document.open() specifically, or other places?","m.relates_to":{"m.in_reply_to":{"event_id":"$1DvUH7Lwkgma1Oa7QYg0oRVOFs2-Sg-NeMUra8Mf31o"}},"msgtype":"m.text","org.matrix.msc1767.message":[{"body":"> <@hsivonen:mozilla.org> Currently, I'm finding that tests that test history length start failing with my patch but they already fail in Chrome and pretty consistently if I remove expectations for history length to grow by one more than Chrome grows it, the tests pass both in Chrome and in Firefox+my patch.\n\nFor document.open() specifically, or other places?","mimetype":"text/plain"},{"body":"<mx-reply><blockquote><a href=\"https://matrix.to/#/!AGetWbsMpFPdSgUrbs:matrix.org/$1DvUH7Lwkgma1Oa7QYg0oRVOFs2-Sg-NeMUra8Mf31o?via=matrix.org&via=mozilla.org&via=igalia.com\">In reply to</a> <a href=\"https://matrix.to/#/@hsivonen:mozilla.org\">@hsivonen:mozilla.org</a><br>Currently, I'm finding that tests that test history length start failing with my patch but they already fail in Chrome and pretty consistently if I remove expectations for history length to grow by one more than Chrome grows it, the tests pass both in Chrome and in Firefox+my patch.</blockquote></mx-reply>For document.open() specifically, or other places?","mimetype":"text/html"}]},"ts":1662548662351,"senderName":"Domenic","senderId":"@domenicdenicola:matrix.org","id":"$ebFaYglAZN3xxL2Q5bINnYAXNaE8eRPJbGMPuUodK6I"}
]
[
{"content":{"body":"hey, I ran into issue but not sure if it is fetch spec, navigables spec or me missing something:\n\nStep 19.6 in https://html.spec.whatwg.org/multipage/browsing-the-web.html#create-navigation-params-by-fetching\n\"6. Otherwise, process the next manual redirect for fetchController.\"\nhas a note:\n\"This will result in calling the processResponse we supplied above, during our first iteration through the loop, and thus setting response.\"\n\nbut when I look into fetch spec it seems like processing of the next manual redirect cannot result in calling processResponse callback because, according to the fetch spec:\n1. process manual redirect is set to https://fetch.spec.whatwg.org/#concept-http-redirect-fetch.\n2. Last step 20 of \"HTTP-redirect fetch\" calls \"main fetch\" with fetchParams and true (true is for \"redirect\" param, correct?)\n3. https://fetch.spec.whatwg.org/#concept-main-fetch does early return of response on step 13 (\"If recursive is true, then return response.\") because \"HTTP-redirect fetch\" passed redirect=true earlier.\n\nhttps://fetch.spec.whatwg.org/#fetch-finale which is the only place that calls processResponse callback is never reached while processing manual redirect because main fetch did early return because redirect=true param is passed by \"HTTP-redirect fetch\".\n\nam I missing something?\n","format":"org.matrix.custom.html","formatted_body":"<p>hey, I ran into issue but not sure if it is fetch spec, navigables spec or me missing something:</p>\n<p>Step 19.6 in https://html.spec.whatwg.org/multipage/browsing-the-web.html#create-navigation-params-by-fetching<br>&quot;6. Otherwise, process the next manual redirect for fetchController.&quot;<br>has a note:<br>&quot;This will result in calling the processResponse we supplied above, during our first iteration through the loop, and thus setting response.&quot;</p>\n<p>but when I look into fetch spec it seems like processing of the next manual redirect cannot result in calling processResponse callback because, according to the fetch spec:</p>\n<ol>\n<li>process manual redirect is set to https://fetch.spec.whatwg.org/#concept-http-redirect-fetch.</li>\n<li>Last step 20 of &quot;HTTP-redirect fetch&quot; calls &quot;main fetch&quot; with fetchParams and true (true is for &quot;redirect&quot; param, correct?)</li>\n<li>https://fetch.spec.whatwg.org/#concept-main-fetch does early return of response on step 13 (&quot;If recursive is true, then return response.&quot;) because &quot;HTTP-redirect fetch&quot; passed redirect=true earlier.</li>\n</ol>\n<p>https://fetch.spec.whatwg.org/#fetch-finale which is the only place that calls processResponse callback is never reached while processing manual redirect because main fetch did early return because redirect=true param is passed by &quot;HTTP-redirect fetch&quot;.</p>\n<p>am I missing something?</p>\n","msgtype":"m.text"},"ts":1681008744366,"senderName":"Alexander Kalenik","senderId":"@aliaksandr.kalenik:matrix.org","id":"$gHhANURcFEFCoLexmXof9b-etcG6xivMRZCd1YMjoTA"},
{"content":{"body":" * hey, I ran into issue but not sure if it is fetch spec, navigables spec or me missing something:\n\nStep 19.6 in https://html.spec.whatwg.org/multipage/browsing-the-web.html#create-navigation-params-by-fetching\n\"6. Otherwise, process the next manual redirect for fetchController.\"\nhas a note:\n\"This will result in calling the processResponse we supplied above, during our first iteration through the loop, and thus setting response.\"\n\nbut when I look into fetch spec it seems like processing of the next manual redirect cannot result in calling processResponse callback because, according to the fetch spec:\n\n1. process manual redirect is set to https://fetch.spec.whatwg.org/#concept-http-redirect-fetch.\n2. Last step 20 of \"HTTP-redirect fetch\" calls main fetch with fetchParams and true\" (true is for \"redirect\" param, correct?)\n3. https://fetch.spec.whatwg.org/#concept-main-fetch does early return of response on step 13 (\"If recursive is true, then return response.\") because \"HTTP-redirect fetch\" passed redirect=true earlier.\n\nhttps://fetch.spec.whatwg.org/#fetch-finale which is the only place that calls processResponse callback is never reached while processing manual redirect because main fetch did early return because redirect=true param is passed by \"HTTP-redirect fetch\".\n\nam I missing something?","format":"org.matrix.custom.html","formatted_body":" * <p>hey, I ran into issue but not sure if it is fetch spec, navigables spec or me missing something:</p>\n<p>Step 19.6 in https://html.spec.whatwg.org/multipage/browsing-the-web.html#create-navigation-params-by-fetching<br>&quot;6. Otherwise, process the next manual redirect for fetchController.&quot;<br>has a note:<br>&quot;This will result in calling the processResponse we supplied above, during our first iteration through the loop, and thus setting response.&quot;</p>\n<p>but when I look into fetch spec it seems like processing of the next manual redirect cannot result in calling processResponse callback because, according to the fetch spec:</p>\n<ol>\n<li>process manual redirect is set to https://fetch.spec.whatwg.org/#concept-http-redirect-fetch.</li>\n<li>Last step 20 of &quot;HTTP-redirect fetch&quot; calls main fetch with fetchParams and true&quot; (true is for &quot;redirect&quot; param, correct?)</li>\n<li>https://fetch.spec.whatwg.org/#concept-main-fetch does early return of response on step 13 (&quot;If recursive is true, then return response.&quot;) because &quot;HTTP-redirect fetch&quot; passed redirect=true earlier.</li>\n</ol>\n<p>https://fetch.spec.whatwg.org/#fetch-finale which is the only place that calls processResponse callback is never reached while processing manual redirect because main fetch did early return because redirect=true param is passed by &quot;HTTP-redirect fetch&quot;.</p>\n<p>am I missing something?</p>\n","m.new_content":{"body":"hey, I ran into issue but not sure if it is fetch spec, navigables spec or me missing something:\n\nStep 19.6 in https://html.spec.whatwg.org/multipage/browsing-the-web.html#create-navigation-params-by-fetching\n\"6. Otherwise, process the next manual redirect for fetchController.\"\nhas a note:\n\"This will result in calling the processResponse we supplied above, during our first iteration through the loop, and thus setting response.\"\n\nbut when I look into fetch spec it seems like processing of the next manual redirect cannot result in calling processResponse callback because, according to the fetch spec:\n\n1. process manual redirect is set to https://fetch.spec.whatwg.org/#concept-http-redirect-fetch.\n2. Last step 20 of \"HTTP-redirect fetch\" calls main fetch with fetchParams and true\" (true is for \"redirect\" param, correct?)\n3. https://fetch.spec.whatwg.org/#concept-main-fetch does early return of response on step 13 (\"If recursive is true, then return response.\") because \"HTTP-redirect fetch\" passed redirect=true earlier.\n\nhttps://fetch.spec.whatwg.org/#fetch-finale which is the only place that calls processResponse callback is never reached while processing manual redirect because main fetch did early return because redirect=true param is passed by \"HTTP-redirect fetch\".\n\nam I missing something?","format":"org.matrix.custom.html","formatted_body":"<p>hey, I ran into issue but not sure if it is fetch spec, navigables spec or me missing something:</p>\n<p>Step 19.6 in https://html.spec.whatwg.org/multipage/browsing-the-web.html#create-navigation-params-by-fetching<br>&quot;6. Otherwise, process the next manual redirect for fetchController.&quot;<br>has a note:<br>&quot;This will result in calling the processResponse we supplied above, during our first iteration through the loop, and thus setting response.&quot;</p>\n<p>but when I look into fetch spec it seems like processing of the next manual redirect cannot result in calling processResponse callback because, according to the fetch spec:</p>\n<ol>\n<li>process manual redirect is set to https://fetch.spec.whatwg.org/#concept-http-redirect-fetch.</li>\n<li>Last step 20 of &quot;HTTP-redirect fetch&quot; calls main fetch with fetchParams and true&quot; (true is for &quot;redirect&quot; param, correct?)</li>\n<li>https://fetch.spec.whatwg.org/#concept-main-fetch does early return of response on step 13 (&quot;If recursive is true, then return response.&quot;) because &quot;HTTP-redirect fetch&quot; passed redirect=true earlier.</li>\n</ol>\n<p>https://fetch.spec.whatwg.org/#fetch-finale which is the only place that calls processResponse callback is never reached while processing manual redirect because main fetch did early return because redirect=true param is passed by &quot;HTTP-redirect fetch&quot;.</p>\n<p>am I missing something?</p>\n","msgtype":"m.text"},"m.relates_to":{"event_id":"$gHhANURcFEFCoLexmXof9b-etcG6xivMRZCd1YMjoTA","rel_type":"m.replace"},"msgtype":"m.text"},"ts":1681013496770,"senderName":"Alexander Kalenik","senderId":"@aliaksandr.kalenik:matrix.org","id":"$V4l3zD2acg1Hy8OskxrGhDag9N2UilbEspQjMCyT9MY"},
{"content":{"body":" * hey, I ran into issue but not sure if it is fetch spec, navigables spec or me missing something:\n\nStep 19.6 in https://html.spec.whatwg.org/multipage/browsing-the-web.html#create-navigation-params-by-fetching\n\"6. Otherwise, process the next manual redirect for fetchController.\"\nhas a note:\n\"This will result in calling the processResponse we supplied above, during our first iteration through the loop, and thus setting response.\"\n\nbut when I look into fetch spec it seems like processing of the next manual redirect cannot result in calling processResponse callback because, according to the fetch spec:\n\n1. process manual redirect is set to https://fetch.spec.whatwg.org/#concept-http-redirect-fetch.\n2. Last step 20 of \"HTTP-redirect fetch\" calls main fetch with fetchParams and true (true is for \"redirect\" param, correct?)\n3. https://fetch.spec.whatwg.org/#concept-main-fetch does early return of response on step 13 (\"If recursive is true, then return response.\") because \"HTTP-redirect fetch\" passed redirect=true earlier.\n\nhttps://fetch.spec.whatwg.org/#fetch-finale which is the only place that calls processResponse callback is never reached while processing manual redirect because main fetch did early return because redirect=true param is passed by \"HTTP-redirect fetch\".\n\nam I missing something?","format":"org.matrix.custom.html","formatted_body":" * <p>hey, I ran into issue but not sure if it is fetch spec, navigables spec or me missing something:</p>\n<p>Step 19.6 in https://html.spec.whatwg.org/multipage/browsing-the-web.html#create-navigation-params-by-fetching<br>&quot;6. Otherwise, process the next manual redirect for fetchController.&quot;<br>has a note:<br>&quot;This will result in calling the processResponse we supplied above, during our first iteration through the loop, and thus setting response.&quot;</p>\n<p>but when I look into fetch spec it seems like processing of the next manual redirect cannot result in calling processResponse callback because, according to the fetch spec:</p>\n<ol>\n<li>process manual redirect is set to https://fetch.spec.whatwg.org/#concept-http-redirect-fetch.</li>\n<li>Last step 20 of &quot;HTTP-redirect fetch&quot; calls main fetch with fetchParams and true (true is for &quot;redirect&quot; param, correct?)</li>\n<li>https://fetch.spec.whatwg.org/#concept-main-fetch does early return of response on step 13 (&quot;If recursive is true, then return response.&quot;) because &quot;HTTP-redirect fetch&quot; passed redirect=true earlier.</li>\n</ol>\n<p>https://fetch.spec.whatwg.org/#fetch-finale which is the only place that calls processResponse callback is never reached while processing manual redirect because main fetch did early return because redirect=true param is passed by &quot;HTTP-redirect fetch&quot;.</p>\n<p>am I missing something?</p>\n","m.new_content":{"body":"hey, I ran into issue but not sure if it is fetch spec, navigables spec or me missing something:\n\nStep 19.6 in https://html.spec.whatwg.org/multipage/browsing-the-web.html#create-navigation-params-by-fetching\n\"6. Otherwise, process the next manual redirect for fetchController.\"\nhas a note:\n\"This will result in calling the processResponse we supplied above, during our first iteration through the loop, and thus setting response.\"\n\nbut when I look into fetch spec it seems like processing of the next manual redirect cannot result in calling processResponse callback because, according to the fetch spec:\n\n1. process manual redirect is set to https://fetch.spec.whatwg.org/#concept-http-redirect-fetch.\n2. Last step 20 of \"HTTP-redirect fetch\" calls main fetch with fetchParams and true (true is for \"redirect\" param, correct?)\n3. https://fetch.spec.whatwg.org/#concept-main-fetch does early return of response on step 13 (\"If recursive is true, then return response.\") because \"HTTP-redirect fetch\" passed redirect=true earlier.\n\nhttps://fetch.spec.whatwg.org/#fetch-finale which is the only place that calls processResponse callback is never reached while processing manual redirect because main fetch did early return because redirect=true param is passed by \"HTTP-redirect fetch\".\n\nam I missing something?","format":"org.matrix.custom.html","formatted_body":"<p>hey, I ran into issue but not sure if it is fetch spec, navigables spec or me missing something:</p>\n<p>Step 19.6 in https://html.spec.whatwg.org/multipage/browsing-the-web.html#create-navigation-params-by-fetching<br>&quot;6. Otherwise, process the next manual redirect for fetchController.&quot;<br>has a note:<br>&quot;This will result in calling the processResponse we supplied above, during our first iteration through the loop, and thus setting response.&quot;</p>\n<p>but when I look into fetch spec it seems like processing of the next manual redirect cannot result in calling processResponse callback because, according to the fetch spec:</p>\n<ol>\n<li>process manual redirect is set to https://fetch.spec.whatwg.org/#concept-http-redirect-fetch.</li>\n<li>Last step 20 of &quot;HTTP-redirect fetch&quot; calls main fetch with fetchParams and true (true is for &quot;redirect&quot; param, correct?)</li>\n<li>https://fetch.spec.whatwg.org/#concept-main-fetch does early return of response on step 13 (&quot;If recursive is true, then return response.&quot;) because &quot;HTTP-redirect fetch&quot; passed redirect=true earlier.</li>\n</ol>\n<p>https://fetch.spec.whatwg.org/#fetch-finale which is the only place that calls processResponse callback is never reached while processing manual redirect because main fetch did early return because redirect=true param is passed by &quot;HTTP-redirect fetch&quot;.</p>\n<p>am I missing something?</p>\n","msgtype":"m.text"},"m.relates_to":{"event_id":"$gHhANURcFEFCoLexmXof9b-etcG6xivMRZCd1YMjoTA","rel_type":"m.replace"},"msgtype":"m.text"},"ts":1681013523103,"senderName":"Alexander Kalenik","senderId":"@aliaksandr.kalenik:matrix.org","id":"$-4WL9a8mQAHw8MKRDyy6xhu56grSNdaQYlgT41eUzdM"},
{"content":{"body":"I checked fetch spec commit history and in the past instead of \"Return the result of running main fetch given fetchParams and true.\" there was \"Return the result of performing a main fetch using request with recursive flag set if request's redirect mode is not manual\". Specifying recursive=false if redirect mode is not manual solves the problem that I described above. Not sure why this addition has been removed from spec. Commit that changed the line https://github.com/whatwg/fetch/commit/12dd6fa8ca76bd3bdff0c65a0c5a84b3ca870c3d","msgtype":"m.text"},"ts":1681013777382,"senderName":"Alexander Kalenik","senderId":"@aliaksandr.kalenik:matrix.org","id":"$1KnVTsGCuLcwL14lS6zZeIZMEAqZfTvAFA5p0QFAo3I"},
{"content":{"body":"Hmm, I think you're right. It seems like HTTP-redirect fetch should not unconditionally call main fetch with \"true\", and if that's right, then I think this sentence is also wrong: https://fetch.spec.whatwg.org/#ref-for-process-response%E2%91%A2.","msgtype":"m.text"},"ts":1681058855070,"senderName":"Dominic Farolino","senderId":"@domfarolino:matrix.org","id":"$2RmpgxgRDSOT4J5U8ipmdhSBQ6XFT0eijdwEw9gWsDg"},
{"content":{"body":" * hey, I ran into issue but not sure if it is fetch spec, navigables spec or me missing something:\n\nStep 19.6 in https://html.spec.whatwg.org/multipage/browsing-the-web.html#create-navigation-params-by-fetching\n\"6. Otherwise, process the next manual redirect for fetchController.\"\nhas a note:\n\"This will result in calling the processResponse we supplied above, during our first iteration through the loop, and thus setting response.\"\n\nbut when I look into fetch spec it seems like processing of the next manual redirect cannot result in calling processResponse callback because, according to the fetch spec:\n\n1. process manual redirect is set to https://fetch.spec.whatwg.org/#concept-http-redirect-fetch.\n2. Last step 20 of \"HTTP-redirect fetch\" calls main fetch with fetchParams and true (true is for \"redirect\" param, correct?)\n3. https://fetch.spec.whatwg.org/#concept-main-fetch does early return of response on step 13 (\"If recursive is true, then return response.\") because \"HTTP-redirect fetch\" passed recursive=true earlier.\n\nhttps://fetch.spec.whatwg.org/#fetch-finale which is the only place that calls processResponse callback is never reached while processing manual redirect because main fetch did early return because redirect=true param is passed by \"HTTP-redirect fetch\".\n\nam I missing something?","format":"org.matrix.custom.html","formatted_body":" * <p>hey, I ran into issue but not sure if it is fetch spec, navigables spec or me missing something:</p>\n<p>Step 19.6 in https://html.spec.whatwg.org/multipage/browsing-the-web.html#create-navigation-params-by-fetching<br>&quot;6. Otherwise, process the next manual redirect for fetchController.&quot;<br>has a note:<br>&quot;This will result in calling the processResponse we supplied above, during our first iteration through the loop, and thus setting response.&quot;</p>\n<p>but when I look into fetch spec it seems like processing of the next manual redirect cannot result in calling processResponse callback because, according to the fetch spec:</p>\n<ol>\n<li>process manual redirect is set to https://fetch.spec.whatwg.org/#concept-http-redirect-fetch.</li>\n<li>Last step 20 of &quot;HTTP-redirect fetch&quot; calls main fetch with fetchParams and true (true is for &quot;redirect&quot; param, correct?)</li>\n<li>https://fetch.spec.whatwg.org/#concept-main-fetch does early return of response on step 13 (&quot;If recursive is true, then return response.&quot;) because &quot;HTTP-redirect fetch&quot; passed recursive=true earlier.</li>\n</ol>\n<p>https://fetch.spec.whatwg.org/#fetch-finale which is the only place that calls processResponse callback is never reached while processing manual redirect because main fetch did early return because redirect=true param is passed by &quot;HTTP-redirect fetch&quot;.</p>\n<p>am I missing something?</p>\n","m.new_content":{"body":"hey, I ran into issue but not sure if it is fetch spec, navigables spec or me missing something:\n\nStep 19.6 in https://html.spec.whatwg.org/multipage/browsing-the-web.html#create-navigation-params-by-fetching\n\"6. Otherwise, process the next manual redirect for fetchController.\"\nhas a note:\n\"This will result in calling the processResponse we supplied above, during our first iteration through the loop, and thus setting response.\"\n\nbut when I look into fetch spec it seems like processing of the next manual redirect cannot result in calling processResponse callback because, according to the fetch spec:\n\n1. process manual redirect is set to https://fetch.spec.whatwg.org/#concept-http-redirect-fetch.\n2. Last step 20 of \"HTTP-redirect fetch\" calls main fetch with fetchParams and true (true is for \"redirect\" param, correct?)\n3. https://fetch.spec.whatwg.org/#concept-main-fetch does early return of response on step 13 (\"If recursive is true, then return response.\") because \"HTTP-redirect fetch\" passed recursive=true earlier.\n\nhttps://fetch.spec.whatwg.org/#fetch-finale which is the only place that calls processResponse callback is never reached while processing manual redirect because main fetch did early return because redirect=true param is passed by \"HTTP-redirect fetch\".\n\nam I missing something?","format":"org.matrix.custom.html","formatted_body":"<p>hey, I ran into issue but not sure if it is fetch spec, navigables spec or me missing something:</p>\n<p>Step 19.6 in https://html.spec.whatwg.org/multipage/browsing-the-web.html#create-navigation-params-by-fetching<br>&quot;6. Otherwise, process the next manual redirect for fetchController.&quot;<br>has a note:<br>&quot;This will result in calling the processResponse we supplied above, during our first iteration through the loop, and thus setting response.&quot;</p>\n<p>but when I look into fetch spec it seems like processing of the next manual redirect cannot result in calling processResponse callback because, according to the fetch spec:</p>\n<ol>\n<li>process manual redirect is set to https://fetch.spec.whatwg.org/#concept-http-redirect-fetch.</li>\n<li>Last step 20 of &quot;HTTP-redirect fetch&quot; calls main fetch with fetchParams and true (true is for &quot;redirect&quot; param, correct?)</li>\n<li>https://fetch.spec.whatwg.org/#concept-main-fetch does early return of response on step 13 (&quot;If recursive is true, then return response.&quot;) because &quot;HTTP-redirect fetch&quot; passed recursive=true earlier.</li>\n</ol>\n<p>https://fetch.spec.whatwg.org/#fetch-finale which is the only place that calls processResponse callback is never reached while processing manual redirect because main fetch did early return because redirect=true param is passed by &quot;HTTP-redirect fetch&quot;.</p>\n<p>am I missing something?</p>\n","msgtype":"m.text"},"m.relates_to":{"event_id":"$gHhANURcFEFCoLexmXof9b-etcG6xivMRZCd1YMjoTA","rel_type":"m.replace"},"msgtype":"m.text"},"ts":1681064055605,"senderName":"Alexander Kalenik","senderId":"@aliaksandr.kalenik:matrix.org","id":"$myNyziDGGo0dUIk163ffJ9svO4c5TmU1h0GT8E7Znv0"},
{"content":{"body":"> <@domfarolino:matrix.org> Hmm, I think you're right. It seems like HTTP-redirect fetch should not unconditionally call main fetch with \"true\", and if that's right, then I think this sentence is also wrong: https://fetch.spec.whatwg.org/#ref-for-process-response%E2%91%A2.\n\nthank you for looking. I created an issue https://github.com/whatwg/fetch/issues/1629. Actually I tried changing HTTP-redirect to set recursive to false for manual redirect mode like it was in the spec before and then processResponse is called like navigation expects. could you share you thoughts on what is wrong with the sentence? for me it looks correct that processReponse should be called again after every next manual redirect.","format":"org.matrix.custom.html","formatted_body":"<mx-reply><blockquote><a href=\"https://matrix.to/#/!AGetWbsMpFPdSgUrbs:matrix.org/$2RmpgxgRDSOT4J5U8ipmdhSBQ6XFT0eijdwEw9gWsDg?via=matrix.org&via=mozilla.org&via=serenityos.org\">In reply to</a> <a href=\"https://matrix.to/#/@domfarolino:matrix.org\">@domfarolino:matrix.org</a><br>Hmm, I think you&#39;re right. It seems like HTTP-redirect fetch should not unconditionally call main fetch with &quot;true&quot;, and if that&#39;s right, then I think this sentence is also wrong: https://fetch.spec.whatwg.org/#ref-for-process-response%E2%91%A2.</blockquote></mx-reply>thank you for looking. I created an issue https://github.com/whatwg/fetch/issues/1629. Actually I tried changing HTTP-redirect to set recursive to false for manual redirect mode like it was in the spec before and then processResponse is called like navigation expects. could you share you thoughts on what is wrong with the sentence? for me it looks correct that processReponse should be called again after every next manual redirect.","m.relates_to":{"m.in_reply_to":{"event_id":"$2RmpgxgRDSOT4J5U8ipmdhSBQ6XFT0eijdwEw9gWsDg"}},"msgtype":"m.text"},"ts":1681064815136,"senderName":"Alexander Kalenik","senderId":"@aliaksandr.kalenik:matrix.org","id":"$HJ3JxKpWYkgqdXQOz7g51GnLTKyCl7MzaJD33n9JX04"}
]
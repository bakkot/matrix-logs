[
{"content":{"body":"I don't see an entry in the WHATNOT meeting notes for today, the meeting is happening right?","m.mentions":{},"msgtype":"m.text"},"ts":1764231586347,"senderName":"foolip","senderId":"@foolip:matrix.org","id":"$tVGIKUIqOnp7brZffutq5Hxnqf2cxEQ_JajwAWgl4os"},
{"content":{"body":"Yes I think so!","m.mentions":{},"m.relates_to":{"event_id":"$tVGIKUIqOnp7brZffutq5Hxnqf2cxEQ_JajwAWgl4os","is_falling_back":true,"m.in_reply_to":{"event_id":"$tVGIKUIqOnp7brZffutq5Hxnqf2cxEQ_JajwAWgl4os"},"rel_type":"m.thread"},"msgtype":"m.text"},"ts":1764234031872,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$P0trd_K1HeFZgzPSFoaKLPSyh3DLTgVgoHJ3_rxymDs"},
{"content":{"body":"Deferred scripts inserted with createContextualFragment() are considered \"not parser inserted\"\nhttps://html.spec.whatwg.org/multipage/dynamic-markup-insertion.html#dom-range-createcontextualfragment 8.2\nSo `createContextualFragment` basically ignores the `defer` attribute","format":"org.matrix.custom.html","formatted_body":"Deferred scripts inserted with createContextualFragment() are considered \"not parser inserted\"<br>https://html.spec.whatwg.org/multipage/dynamic-markup-insertion.html#dom-range-createcontextualfragment 8.2<br>So <code>createContextualFragment</code> basically ignores the <code>defer</code> attribute","m.mentions":{},"msgtype":"m.text"},"ts":1764241081710,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$MeVcuoeF9tEG6s-VYfPd51bKFdZQ6E0sj_QVp6PCrU0"},
{"content":{"body":"Noam Rosenthal: OK. Maybe that's good enough for `setHTMLUnsafe`. I wonder though if it would be good to set `async=false` for inline scripts (both for setHTMLUnsafe and createContextualFragment). cc hsivonen ","format":"org.matrix.custom.html","formatted_body":"<a href=\"https://matrix.to/#/@noamr:matrix.org\">Noam Rosenthal</a>: OK. Maybe that's good enough for <code>setHTMLUnsafe</code>. I wonder though if it would be good to set <code>async=false</code> for inline scripts (both for setHTMLUnsafe and createContextualFragment). cc <a href=\"https://matrix.to/#/@hsivonen:mozilla.org\">hsivonen</a>","m.mentions":{"user_ids":["@noamr:matrix.org","@hsivonen:mozilla.org"]},"msgtype":"m.text"},"ts":1764242925934,"senderName":"zcorpan","senderId":"@zcorpan:mozilla.org","id":"$5y8qDbWS43otk5suWwtmI0Vqk6T9YogoJldyvPX4uW4"},
{"content":{"body":"annevk: for creation/insertion difference, I think the sanitizer currently is not set to prevent early image loading, regardless of the inert document in the fragment parsing algorithm.\n\nhttps://wicg.github.io/sanitizer-api/#set-and-filter-html stage 4 adds all the nodes into a fragment in this document, which would trigger image loading before sanitation starts.\n\nNot sure if this is an important use case for the sanitizer\n","format":"org.matrix.custom.html","formatted_body":"<p><a href=\"https://matrix.to/#/@annevk:matrix.org\">annevk</a>: for creation/insertion difference, I think the sanitizer currently is not set to prevent early image loading, regardless of the inert document in the fragment parsing algorithm.</p>\n<p>https://wicg.github.io/sanitizer-api/#set-and-filter-html stage 4 adds all the nodes into a fragment in this document, which would trigger image loading before sanitation starts.</p>\n<p>Not sure if this is an important use case for the sanitizer</p>\n","m.mentions":{"user_ids":["@annevk:matrix.org"]},"msgtype":"m.text"},"ts":1764243642237,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$AW6gBNqMjtt3XkxMIfDbN10gn3u444YTPxAmtxMOyFY"},
{"content":{"body":"... in the same manner that this loads an image:\n  new Range().createContextualFragment('<img src=\"/bla.png\">')","m.mentions":{},"msgtype":"m.text"},"ts":1764243685721,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$cA-S_pIHiNgCMVaWK4UMG3ORFGFRQ2KdW4rvfd3JsDM"},
{"content":{"body":"Noam Rosenthal: I suppose the `setHTML` step should say that a temporary inert document is created and that the DocumentFragment is created for that temporary inert document? Can you file a bug?","format":"org.matrix.custom.html","formatted_body":"<a href=\"https://matrix.to/#/@noamr:matrix.org\">Noam Rosenthal</a>: I suppose the <code>setHTML</code> step should say that a temporary inert document is created and that the DocumentFragment is created for that temporary inert document? Can you file a bug?","m.mentions":{"user_ids":["@noamr:matrix.org"]},"msgtype":"m.text"},"ts":1764244672129,"senderName":"freddy","senderId":"@fbraun:mozilla.org","id":"$I_mHdsp-VfH54wwocxT-YpIPKI3K7fJ7xjhckHXFRsY"},
{"content":{"body":"We totally should prevent image loading and [our implementation in Firefox appears to do the right thing](https://searchfox.org/firefox-main/rev/f81fae7890605739dd8dde14755f159fe6beb8aa/dom/base/nsContentUtils.cpp#6159-6184)","format":"org.matrix.custom.html","formatted_body":"We totally should prevent image loading and <a href=\"https://searchfox.org/firefox-main/rev/f81fae7890605739dd8dde14755f159fe6beb8aa/dom/base/nsContentUtils.cpp#6159-6184\">our implementation in Firefox appears to do the right thing</a>","m.mentions":{},"msgtype":"m.text"},"ts":1764244758226,"senderName":"freddy","senderId":"@fbraun:mozilla.org","id":"$-avZLlheseASLtPH1ECk9N6w_h5-7iVnDNzrdvEeIF4"},
{"content":{"body":"Sure, done. https://github.com/WICG/sanitizer-api/issues/363","m.mentions":{"user_ids":["@fbraun:mozilla.org"]},"m.relates_to":{"m.in_reply_to":{"event_id":"$I_mHdsp-VfH54wwocxT-YpIPKI3K7fJ7xjhckHXFRsY"}},"msgtype":"m.text"},"ts":1764244916912,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$WAl18NlbBZ5adjtDI_yeUDLEXGzSPd2vBMKk04Dk56U"},
{"content":{"body":"Noam Rosenthal: I guess we might have to refactor the HTML parser in some way so you can parse into a DocumentFragment. I doubt anyone is up for changing their `createContextualFragment()` implementation at this point.","format":"org.matrix.custom.html","formatted_body":"<a href=\"https://matrix.to/#/@noamr:matrix.org\">Noam Rosenthal</a>: I guess we might have to refactor the HTML parser in some way so you can parse into a DocumentFragment. I doubt anyone is up for changing their <code>createContextualFragment()</code> implementation at this point.","m.mentions":{"user_ids":["@noamr:matrix.org"]},"msgtype":"m.text"},"ts":1764252852626,"senderName":"annevk","senderId":"@annevk:matrix.org","id":"$93lhHMvbQQ97xLtJO301KFF0UebFK6a43_PeSfkjRUM"},
{"content":{"body":"sounds right. I can't think off the top of my head of other elements that have creation-time side effects, but if there are we should probably have tests for them in the sanitizer","m.mentions":{"user_ids":["@annevk:matrix.org"]},"m.relates_to":{"m.in_reply_to":{"event_id":"$93lhHMvbQQ97xLtJO301KFF0UebFK6a43_PeSfkjRUM"}},"msgtype":"m.text"},"ts":1764254277023,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$Vh_dEZBrh8v3NYl00zz8OrgQQXpUHN5JH9EAyvab9Fo"},
{"content":{"body":"... maybe custom element constructors","m.mentions":{},"msgtype":"m.text"},"ts":1764254330004,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$6SzZu8o9l9thUKDCLE7TD1vn9-1o2-OmSYB4z1wx0Ug"},
{"content":{"body":"but that's a script thing","m.mentions":{},"msgtype":"m.text"},"ts":1764254343636,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$Y001XH6FX8d-0AsXz6_Zn08W2RZnGzNks4KGUYrm2l4"},
{"content":{"body":"Media elements do something similar.","m.mentions":{},"msgtype":"m.text"},"ts":1764255088278,"senderName":"annevk","senderId":"@annevk:matrix.org","id":"$5JrApVLeWXip4jfLjETeiqWev_FZ9UL-URfXiF0VOVw"},
{"content":{"body":"sideshowbarker: I'm hitting the validator banning role=directory. It seems that Bikeshed generates it on `<ol>` elements. See https://github.com/whatwg/dom/pull/1430 cc TabAtkins ","format":"org.matrix.custom.html","formatted_body":"<a href=\"https://matrix.to/#/@sideshowbarker:matrix.org\">sideshowbarker</a>: I'm hitting the validator banning role=directory. It seems that Bikeshed generates it on <code>&lt;ol&gt;</code> elements. See https://github.com/whatwg/dom/pull/1430 cc <a href=\"https://matrix.to/#/@tabatkins:matrix.org\">TabAtkins</a>","m.mentions":{"user_ids":["@sideshowbarker:matrix.org","@tabatkins:matrix.org"]},"msgtype":"m.text"},"ts":1764262342241,"senderName":"annevk","senderId":"@annevk:matrix.org","id":"$CNTync0RkVQnNrX62xIW9sEM2Py4-oktEgpoUsaqtEc"},
{"content":{"body":"> <@annevk:matrix.org> sideshowbarker: I'm hitting the validator banning role=directory. It seems that Bikeshed generates it on `<ol>` elements. See https://github.com/whatwg/dom/pull/1430 cc TabAtkins \n\nYup just got that reported by someone else","format":"org.matrix.custom.html","formatted_body":"<mx-reply><blockquote><a href=\"https://matrix.to/#/!AGetWbsMpFPdSgUrbs:matrix.org/$CNTync0RkVQnNrX62xIW9sEM2Py4-oktEgpoUsaqtEc?via=matrix.org&via=mozilla.org&via=igalia.com\">In reply to</a> <a href=\"https://matrix.to/#/@annevk:matrix.org\">@annevk:matrix.org</a><br /><a href=\"https://matrix.to/#/@sideshowbarker:matrix.org\">sideshowbarker</a>: I'm hitting the validator banning role=directory. It seems that Bikeshed generates it on <code>&lt;ol&gt;</code> elements. See https://github.com/whatwg/dom/pull/1430 cc <a href=\"https://matrix.to/#/@tabatkins:matrix.org\">TabAtkins</a></blockquote></mx-reply>Yup just got that reported by someone else","m.relates_to":{"m.in_reply_to":{"event_id":"$CNTync0RkVQnNrX62xIW9sEM2Py4-oktEgpoUsaqtEc"}},"msgtype":"m.text"},"ts":1764262377132,"senderName":"TabAtkins","senderId":"@tabatkins:matrix.org","id":"$tabWDfXu23qhtXcBB4-HqxxnIy2IJyBGE9hCo2VwVa8"},
{"content":{"body":"Lemme do a quick fix and release","msgtype":"m.text"},"ts":1764262400791,"senderName":"TabAtkins","senderId":"@tabatkins:matrix.org","id":"$Bz5p_SnbAelRAH1jFG6lDOmRSytg80lrzIsi6oOHthw"},
{"content":{"body":"(I assume my use of this role came from existing W3C specs)","msgtype":"m.text"},"ts":1764262454274,"senderName":"TabAtkins","senderId":"@tabatkins:matrix.org","id":"$LiCXV4tUoUmsO8nRUsKzCluKlRhy7B-7EU3X6yGf1GU"},
{"content":{"body":"Thanks! sideshowbarker: might be a good idea for the validator CI to also validate some WHATWG standards so these fixes can be coordinated a bit better.","format":"org.matrix.custom.html","formatted_body":"Thanks! <a href=\"https://matrix.to/#/@sideshowbarker:matrix.org\">sideshowbarker</a>: might be a good idea for the validator CI to also validate some WHATWG standards so these fixes can be coordinated a bit better.","m.mentions":{"user_ids":["@sideshowbarker:matrix.org"]},"msgtype":"m.text"},"ts":1764262570201,"senderName":"annevk","senderId":"@annevk:matrix.org","id":"$OyjG2dVKIWPWAfSYiq7BdEWSpcmv05KOKLf44mutMAM"},
{"content":{"body":"A jillion W3C specs have this makeup currently too, so I presume the CI isn't running over existing specs","msgtype":"m.text"},"ts":1764262641890,"senderName":"TabAtkins","senderId":"@tabatkins:matrix.org","id":"$uyxE5FdaYj5iRMdvZYdmjIeZ_EhXCfDplXyGbwjb4OE"},
{"content":{"body":"All right, new Bikeshed version published minus the role","m.mentions":{},"msgtype":"m.text"},"ts":1764263186923,"senderName":"TabAtkins","senderId":"@tabatkins:matrix.org","id":"$YyFFLfd3r8NY3MqTasWn4XFD5w2t6OdWZNmRa3FFmJE"},
{"content":{"body":"does anyone know offhand if a requests `destination` is supposed to participate as a component of the key in the HTTP cache? (Actually what I care about is the `type: \"json\"` attribute on module requests, but as I understand it the way that gets reflected in the fetch machinery is as a destination.)","format":"org.matrix.custom.html","formatted_body":"does anyone know offhand if a requests <code>destination</code> is supposed to participate as a component of the key in the HTTP cache? (Actually what I care about is the <code>type: \"json\"</code> attribute on module requests, but as I understand it the way that gets reflected in the fetch machinery is as a destination.)","m.mentions":{},"msgtype":"m.text"},"ts":1764268754383,"senderName":"bakkot","senderId":"@bakkot:matrix.org","id":"$P2B2ErSxQoci-O00JkbDA7slD3cCgcbh92csNMJAXO4"},
{"content":{"body":"I'm seeing different behaviors across browsers - in Chrome and Safari, doing `import data1 from './data.js'; import data2 from './data.js' with { type: \"json\" }` only triggers a single network request, whereas in FF it triggers two","format":"org.matrix.custom.html","formatted_body":"I'm seeing different behaviors across browsers - in Chrome and Safari, doing <code>import data1 from './data.js'; import data2 from './data.js' with { type: \"json\" }</code> only triggers a single network request, whereas in FF it triggers two","m.mentions":{},"msgtype":"m.text"},"ts":1764268791936,"senderName":"bakkot","senderId":"@bakkot:matrix.org","id":"$D6bPU65UgHSOvUROBFhpfdGRPfkFj-yLxbZc7AMniSI"},
{"content":{"body":"this becomes more relevant with `type: \"text\"` because then you can reasonably request the same resource in multiple ways. a server might not want to make a script available for importing with `type: \"text\"`, but it can only do that if it actually gets to see the second neetwork request ","format":"org.matrix.custom.html","formatted_body":"this becomes more relevant with <code>type: \"text\"</code> because then you can reasonably request the same resource in multiple ways. a server might not want to make a script available for importing with <code>type: \"text\"</code>, but it can only do that if it actually gets to see the second neetwork request","m.mentions":{},"msgtype":"m.text"},"ts":1764268864683,"senderName":"bakkot","senderId":"@bakkot:matrix.org","id":"$kBywWMfI6bapkbAa1WvI6TeoAcu9wvaXIWxEzYePliM"},
{"content":{"body":"* this becomes more relevant with `type: \"text\"` because then you can reasonably request the same resource in multiple ways. a server might not want to make a script available for importing with `type: \"text\"`, but it can only do that if it actually gets to see the second network request","format":"org.matrix.custom.html","formatted_body":"* this becomes more relevant with <code>type: \"text\"</code> because then you can reasonably request the same resource in multiple ways. a server might not want to make a script available for importing with <code>type: \"text\"</code>, but it can only do that if it actually gets to see the second network request","m.mentions":{},"m.new_content":{"body":"this becomes more relevant with `type: \"text\"` because then you can reasonably request the same resource in multiple ways. a server might not want to make a script available for importing with `type: \"text\"`, but it can only do that if it actually gets to see the second network request","format":"org.matrix.custom.html","formatted_body":"this becomes more relevant with <code>type: \"text\"</code> because then you can reasonably request the same resource in multiple ways. a server might not want to make a script available for importing with <code>type: \"text\"</code>, but it can only do that if it actually gets to see the second network request","m.mentions":{},"msgtype":"m.text"},"m.relates_to":{"event_id":"$kBywWMfI6bapkbAa1WvI6TeoAcu9wvaXIWxEzYePliM","rel_type":"m.replace"},"msgtype":"m.text"},"ts":1764268867694,"senderName":"bakkot","senderId":"@bakkot:matrix.org","id":"$xpZ5gWS5GqNflWN7t_MKQqycCtnX9vhqBJDyJj5ln9k"},
{"content":{"body":"* does anyone know offhand if a request's `destination` is supposed to participate as a component of the key in the HTTP cache? (Actually what I care about is the `type: \"json\"` attribute on module requests, but as I understand it the way that gets reflected in the fetch machinery is as a destination.)","format":"org.matrix.custom.html","formatted_body":"* does anyone know offhand if a request's <code>destination</code> is supposed to participate as a component of the key in the HTTP cache? (Actually what I care about is the <code>type: \"json\"</code> attribute on module requests, but as I understand it the way that gets reflected in the fetch machinery is as a destination.)","m.mentions":{},"m.new_content":{"body":"does anyone know offhand if a request's `destination` is supposed to participate as a component of the key in the HTTP cache? (Actually what I care about is the `type: \"json\"` attribute on module requests, but as I understand it the way that gets reflected in the fetch machinery is as a destination.)","format":"org.matrix.custom.html","formatted_body":"does anyone know offhand if a request's <code>destination</code> is supposed to participate as a component of the key in the HTTP cache? (Actually what I care about is the <code>type: \"json\"</code> attribute on module requests, but as I understand it the way that gets reflected in the fetch machinery is as a destination.)","m.mentions":{},"msgtype":"m.text"},"m.relates_to":{"event_id":"$P2B2ErSxQoci-O00JkbDA7slD3cCgcbh92csNMJAXO4","rel_type":"m.replace"},"msgtype":"m.text"},"ts":1764268876426,"senderName":"bakkot","senderId":"@bakkot:matrix.org","id":"$8L9kdmJfXtP8ocxhIqVYL9aM9Zx8C1_NLtaiq3EOyaE"},
{"content":{"body":"the `Sec-Fetch-Dest` header seems a lot less useful if `destination` isn't a part of the cache key","format":"org.matrix.custom.html","formatted_body":"the <code>Sec-Fetch-Dest</code> header seems a lot less useful if <code>destination</code> isn't a part of the cache key","m.mentions":{},"msgtype":"m.text"},"ts":1764268920434,"senderName":"bakkot","senderId":"@bakkot:matrix.org","id":"$ehknle0xOTWz-BM2xa_b-EFHinEz13JpOLRJ96fqYlU"},
{"content":{"body":"I remember writing a wpt test asserting two separate requests for a JSON and CSS import","m.mentions":{},"msgtype":"m.text"},"ts":1764269379993,"senderName":"nicolo-ribaudo","senderId":"@nicolo-ribaudo:matrix.org","id":"$DhsinhkEeBsTgdSatj7LPIS66QyUjsQwXHP1FuMPHBE"},
{"content":{"body":"I found https://github.com/web-platform-tests/wpt/pull/41665 but it doesn't look like it contains such a test, at a quick glance","m.mentions":{},"msgtype":"m.text"},"ts":1764270844029,"senderName":"bakkot","senderId":"@bakkot:matrix.org","id":"$tif-w6RuAIobtRzyh9yYT6ollXc7c7wno6T3nr1cYAc"},
{"content":{"body":"(specifically, `import-declaration-type-json.js` and `import-declaration-type-css.js` pass different query parameters, and everything else just uses different URLs afaict)","format":"org.matrix.custom.html","formatted_body":"(specifically, <code>import-declaration-type-json.js</code> and <code>import-declaration-type-css.js</code> pass different query parameters, and everything else just uses different URLs afaict)","m.mentions":{},"msgtype":"m.text"},"ts":1764271319062,"senderName":"bakkot","senderId":"@bakkot:matrix.org","id":"$SaVoQ5et12nBiWMnvb0Ivtj4G30nokRbvh-BqJQ0gCE"}
]
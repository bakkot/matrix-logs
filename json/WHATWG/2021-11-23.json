[
{"content":{"body":"Domenic: should https://github.com/web-platform-tests/wpt/blob/628af0fd55db95d785a63484882998343e3a069e/html/semantics/interactive-elements/the-dialog-element/dialog-focus-shadow.html#L40-L47 focus an element inside the shadow dom?","format":"org.matrix.custom.html","formatted_body":"<a href=\"https://matrix.to/#/@domenicdenicola:matrix.org\">Domenic</a>: should https://github.com/web-platform-tests/wpt/blob/628af0fd55db95d785a63484882998343e3a069e/html/semantics/interactive-elements/the-dialog-element/dialog-focus-shadow.html#L40-L47 focus an element inside the shadow dom?","msgtype":"m.text"},"ts":1637633861584,"senderName":"sefeng","senderId":"@sefeng:mozilla.org","id":"$k8D-frig1S9NHzrrtxgM4rcrCEb0YVPkeRxghv9plEY"},
{"content":{"body":"because the shadow dom is before the `focus-me`?","format":"org.matrix.custom.html","formatted_body":"because the shadow dom is before the <code>focus-me</code>?","msgtype":"m.text"},"ts":1637633937980,"senderName":"sefeng","senderId":"@sefeng:mozilla.org","id":"$DMbKJ8g7PPx_K8a7sqTNKEVQxV8Yxf74lliSKonW6sw"},
{"content":{"body":"sefeng: Yes I think you are right","format":"org.matrix.custom.html","formatted_body":"<a href=\"https://matrix.to/#/@sefeng:mozilla.org\">sefeng</a>: Yes I think you are right","msgtype":"m.text"},"ts":1637633980808,"senderName":"Domenic","senderId":"@domenicdenicola:matrix.org","id":"$Ff_sdTk-yZrl61RRgfQU9K3vbffbJtB1liFdl3kxUzY"},
{"content":{"body":"focus-me should be moved to the very first button","msgtype":"m.text"},"ts":1637634002853,"senderName":"Domenic","senderId":"@domenicdenicola:matrix.org","id":"$N0TeNJJfcXlWQGGgBme0eI3UoZtyDXXNXtEse1pEMAc"},
{"content":{"body":"Domenic: we don't need to move this one, because the one before this template does that already, I think?","format":"org.matrix.custom.html","formatted_body":"<a href=\"https://matrix.to/#/@domenicdenicola:matrix.org\">Domenic</a>: we don't need to move this one, because the one before this template does that already, I think?","msgtype":"m.text"},"ts":1637634063230,"senderName":"sefeng","senderId":"@sefeng:mozilla.org","id":"$hMzOj9mg6HfCMxgVtuEd1DyDv2WBW97Jqpmy_mQ84d0"},
{"content":{"body":"Not sure what you mean? I think the test would still be valuable since it shows that autofocus=\"\" is ignored","msgtype":"m.text"},"ts":1637634132154,"senderName":"Domenic","senderId":"@domenicdenicola:matrix.org","id":"$-4qfeu_9oCl1axD1ewkdDIR-DMsFyMX9mIwVKuRcZPM"},
{"content":{"body":"yeah, sorry, I misunderstood ","msgtype":"m.text"},"ts":1637634147095,"senderName":"sefeng","senderId":"@sefeng:mozilla.org","id":"$b45i1J5D4-cnr2f2Nc0Erpa_Hv2ghUkZ2N8bwoMMfHU"},
{"content":{"body":"I'll fix it and ping you for review ","msgtype":"m.text"},"ts":1637634170384,"senderName":"sefeng","senderId":"@sefeng:mozilla.org","id":"$huEN6YFda0yhrwpXKj0fxo2JV55q72mZtbyCRynbUFo"},
{"content":{"body":"Great, thank you for spotting!","msgtype":"m.text"},"ts":1637634198977,"senderName":"Domenic","senderId":"@domenicdenicola:matrix.org","id":"$6t1wJe6jihhdURyPGhYisUwd9nulcgUKVVZN9VuB7uE"},
{"content":{"body":"Domenic: so before all these generic focus delegates algorithm, when there's a nested shadow dom host with no delegates focus, we don't delegate the focus to this shadow dom. ","format":"org.matrix.custom.html","formatted_body":"<a href=\"https://matrix.to/#/@domenicdenicola:matrix.org\">Domenic</a>: so before all these generic focus delegates algorithm, when there's a nested shadow dom host with no delegates focus, we don't delegate the focus to this shadow dom.","msgtype":"m.text"},"ts":1637635076846,"senderName":"sefeng","senderId":"@sefeng:mozilla.org","id":"$wNCVG9GZGw-n0oemp2XwwYuUt3cqjWEfSj9-jVg_-Rg"},
{"content":{"body":"but now it seems that we can delegate the focus to this shadow dom ","msgtype":"m.text"},"ts":1637635115472,"senderName":"sefeng","senderId":"@sefeng:mozilla.org","id":"$DQuFsdP-6I0-y8kjQ_qPkyJtosjs-nx3ukBoqsr9vXI"},
{"content":{"body":"I am looking at these two tests https://github.com/web-platform-tests/wpt/blob/628af0fd55db95d785a63484882998343e3a069e/shadow-dom/focus/focus-method-delegatesFocus.html#L271-L284 and wondering which step makes the behaviour different ","msgtype":"m.text"},"ts":1637635735919,"senderName":"sefeng","senderId":"@sefeng:mozilla.org","id":"$uFDq3GMbGiQQWxF0cnwBzzlbob-wLfhMZDBRe5tGkJs"},
{"content":{"body":"Hi. I have a couple questions on how to integrate the URL standard in a specification (ping annevk I guess ðŸ˜Š)","format":"org.matrix.custom.html","formatted_body":"Hi. I have a couple questions on how to integrate the URL standard in a specification (ping <a href=\"https://matrix.to/#/@annevk:mozilla.org\">annevk</a> I guess ðŸ˜Š)","msgtype":"m.text"},"ts":1637659738325,"senderName":"rdeltour","senderId":"@rdeltour:matrix.org","id":"$WCnHU2PsOpwCo3a-WfnOLce9O_UxssVp8qxezHowzww"},
{"content":{"body":"In EPUB, we're now refer to the URL standard. \nEPUB is basically a collection of web resources in an container (called \"Abstract OCF Container\"); practically, it's a ZIP.\nIn this container, files refer to each other using relative URL strings (with optional fragments)","msgtype":"m.text"},"ts":1637659975107,"senderName":"rdeltour","senderId":"@rdeltour:matrix.org","id":"$6QWxH9pEJIGsKlpg_xMJdxNPuDPypszog0RYLDRVzjs"},
{"content":{"body":"What we'd like to do, is normatively disallow relative URL strings that \"leak\" outside the container. For instance \"../../../../secret\"","msgtype":"m.text"},"ts":1637660048903,"senderName":"rdeltour","senderId":"@rdeltour:matrix.org","id":"$ddyaKVxaNKSU6MzoI4cp4k92RBOAOS1aNzDFm3eKqSE"},
{"content":{"body":"So we're trying to define what is a valid relative URL string in the contexts of EPUB.","msgtype":"m.text"},"ts":1637660181161,"senderName":"rdeltour","senderId":"@rdeltour:matrix.org","id":"$sKI0vRlYKpJW404JvVyt4Zwg9k8WCLoRK016I1A951A"},
{"content":{"body":"My question is: is it OK to say something along the lines of \"in an EPUB container, a **relative-URL string** MUST be a **container-relative URL string**\", and then define what we mean by **container-relative URL string**.\n\nIn other words, we're trying to override the definition of \"relative-URL string\" of the URL standard by:\n- disallowing path-absolute URL strings\n- disallowing scheme-relative URL strings\n- further constraining path-relative-scheme-less-URL strings to ensure dot-dot path segments are balanced by other segments","format":"org.matrix.custom.html","formatted_body":"<p>My question is: is it OK to say something along the lines of &quot;in an EPUB container, a <strong>relative-URL string</strong> MUST be a <strong>container-relative URL string</strong>&quot;, and then define what we mean by <strong>container-relative URL string</strong>.</p>\n<p>In other words, we're trying to override the definition of &quot;relative-URL string&quot; of the URL standard by:</p>\n<ul>\n<li>disallowing path-absolute URL strings</li>\n<li>disallowing scheme-relative URL strings</li>\n<li>further constraining path-relative-scheme-less-URL strings to ensure dot-dot path segments are balanced by other segments</li>\n</ul>\n","msgtype":"m.text"},"ts":1637660451819,"senderName":"rdeltour","senderId":"@rdeltour:matrix.org","id":"$wZHsdqqripJvVXiLBl3sH-QII8BdpMr9p7C5SmohZhw"},
{"content":{"body":"In some way it has a smell of monkey patching, but I can't see how to do otherwise. That's why I'm asking for advice to y'all ðŸ˜Š","msgtype":"m.text"},"ts":1637660528741,"senderName":"rdeltour","senderId":"@rdeltour:matrix.org","id":"$__XyqaHcHpT9b5Rm2e6slhKfHu63vAhmQl8vtu8wbkw"},
{"content":{"body":" * In EPUB, we now refer to the URL standard. \nEPUB is basically a collection of web resources in an container (called \"Abstract OCF Container\"); practically, it's a ZIP.\nIn this container, files refer to each other using relative URL strings (with optional fragments)","m.new_content":{"body":"In EPUB, we now refer to the URL standard. \nEPUB is basically a collection of web resources in an container (called \"Abstract OCF Container\"); practically, it's a ZIP.\nIn this container, files refer to each other using relative URL strings (with optional fragments)","msgtype":"m.text"},"m.relates_to":{"event_id":"$6QWxH9pEJIGsKlpg_xMJdxNPuDPypszog0RYLDRVzjs","rel_type":"m.replace"},"msgtype":"m.text"},"ts":1637660582311,"senderName":"rdeltour","senderId":"@rdeltour:matrix.org","id":"$jQEs7g-103hmCmMvIVsln4rmkmmAHXrUAWzgwHJE-Fc"},
{"content":{"body":" * So we're trying to define what is a valid relative URL string in the context of EPUB.","m.new_content":{"body":"So we're trying to define what is a valid relative URL string in the context of EPUB.","msgtype":"m.text"},"m.relates_to":{"event_id":"$sKI0vRlYKpJW404JvVyt4Zwg9k8WCLoRK016I1A951A","rel_type":"m.replace"},"msgtype":"m.text"},"ts":1637660619581,"senderName":"rdeltour","senderId":"@rdeltour:matrix.org","id":"$lpwibo_1LkEU2zQyVUQxzxFNe9X4LMnyC7msT14mrcQ"},
{"content":{"body":"see also https://github.com/w3c/epub-specs/issues/1912","msgtype":"m.text"},"ts":1637660645519,"senderName":"rdeltour","senderId":"@rdeltour:matrix.org","id":"$qBWzInG8LLrwIEhsM5iuZkeV0IjBaa3bQ1DdX-quzbE"},
{"content":{"body":"rdeltour: have you checked what implementations do? If there is some kind of base URL in play I'd expect it to work similarly to `https://example.com/../`","format":"org.matrix.custom.html","formatted_body":"<a href=\"https://matrix.to/#/@rdeltour:matrix.org\">rdeltour</a>: have you checked what implementations do? If there is some kind of base URL in play I'd expect it to work similarly to <code>https://example.com/../</code>","msgtype":"m.text"},"ts":1637661024535,"senderName":"annevk","senderId":"@annevk:mozilla.org","id":"$eY222Pbq3xcqv78DStIpClHKlTXWrgdc_aQi_SWtebU"},
{"content":{"body":"I suppose you could still have a desire to say that's invalid, but it isn't invalid for similar URLs in other contexts (if I remember correctly)","msgtype":"m.text"},"ts":1637661078030,"senderName":"annevk","senderId":"@annevk:mozilla.org","id":"$7mSxeyS8ALyBd0SXbBhtTR4VRDnCLFsxBH4VKA9v2Sw"},
{"content":{"body":"so, implementations vary (EPUB is old and this was largely unspecified so far). We added a UA conformance criteria to specify how the implementation-specific base URL must be. But here we're trying to define authoring requirements (what string is conforming or not, before parsing)","msgtype":"m.text"},"ts":1637661155144,"senderName":"rdeltour","senderId":"@rdeltour:matrix.org","id":"$nBCNEEoMOKGU32yjAsYgCLBX_3eykQ1VzZTrdxfLBIU"},
{"content":{"body":"a conforming UA will parse '../../secret'  to the same URL record as 'secret', but we'd still like to disallow the former, for better interop with legacy or non-conforming UAs.","msgtype":"m.text"},"ts":1637661249260,"senderName":"rdeltour","senderId":"@rdeltour:matrix.org","id":"$2iBNPkfRJIaEVo-1VeIXOvhbLk82S1v1U_gHJuRS2Gk"},
{"content":{"body":"It seems somewhat reasonable to write such a requirement the way you proposed above. The one quibble is that URL validity is also part of the URL parser and you wouldn't really be able to change that. (It's written in two different ways for different audiences.)","msgtype":"m.text"},"ts":1637661376297,"senderName":"annevk","senderId":"@annevk:mozilla.org","id":"$RBJ-A8a0pxkn5Ga13MtPNsSBVo1QJ4uc9Rnhb3hRVec"},
{"content":{"body":"It also seems that long term the requirement would be moot, so maybe it's easier to just explain the situation in a note and strongly encourage folks not to create such URL strings.","msgtype":"m.text"},"ts":1637661438506,"senderName":"annevk","senderId":"@annevk:mozilla.org","id":"$54uJrbGoYoaI5uxTcMY43_ZnwT4DbxvCT6xIlTlhOuQ"},
{"content":{"body":"OK good. Yeah, we're only talking of subsetting valid URL strings, so the URL parser would still return an expected result. That it doesn't produce a validation error on some of EPUB-non-conforming strings is acceptable.\n\nAs for explaining all that in a note: that's what we do in the current WD; but that requirement was normative before, and EPUB is a slow world so I believe we a normative definition makes more sense.","msgtype":"m.text"},"ts":1637661816646,"senderName":"rdeltour","senderId":"@rdeltour:matrix.org","id":"$0tZVmot_SH5FjUvPhAlX277nXQcRiikFTeMafjSFg4k"},
{"content":{"body":"I have another question if I may.\nEssentially for testing if a URL string is conforming I'm proposing the following (simplified) algo:\n1. if not a path-relative-scheme-less-URL string, return false\n2. if the result of parsing _url_ with \"http://example.org/A/\" does not start with \"http://example.org/A/\", return false\n3. 2. if the result of parsing _url_ with \"http://example.org/B/\" does not start with \"http://example.org/B/\", return false\n4. return true","format":"org.matrix.custom.html","formatted_body":"<p>I have another question if I may.<br>Essentially for testing if a URL string is conforming I'm proposing the following (simplified) algo:</p>\n<ol>\n<li>if not a path-relative-scheme-less-URL string, return false</li>\n<li>if the result of parsing <em>url</em> with &quot;http://example.org/A/&quot; does not start with &quot;http://example.org/A/&quot;, return false</li>\n<li>\n<ol start=\"2\">\n<li>if the result of parsing <em>url</em> with &quot;http://example.org/B/&quot; does not start with &quot;http://example.org/B/&quot;, return false</li>\n</ol>\n</li>\n<li>return true</li>\n</ol>\n","msgtype":"m.text"},"ts":1637662050166,"senderName":"rdeltour","senderId":"@rdeltour:matrix.org","id":"$Ow0Fu8iy-kw4w8jnHO-FB4QM71Z88cpYXCULQLzUr-E"},
{"content":{"body":"the use of test URLs is somewhat inelegant, but is simpler than redefining a custom parsing algo for counting that dot-dot path segments are balanced by other segments.","msgtype":"m.text"},"ts":1637662124661,"senderName":"rdeltour","senderId":"@rdeltour:matrix.org","id":"$SgYiRGda8ooDYEEcjflTfggzb4I2JyZ8XwXG4Pq8aYI"},
{"content":{"body":"any advice or comment ?","msgtype":"m.text"},"ts":1637662173924,"senderName":"rdeltour","senderId":"@rdeltour:matrix.org","id":"$sPZzgfYavvCa2eCbASRF5Xu4EpEgpp9G4CH4H5zllQg"},
{"content":{"body":" * I have another question if I may.\nEssentially for testing if a URL string is conforming I'm proposing the following (simplified) algo:\n1. if not a path-relative-scheme-less-URL string, return false\n2. if the result of parsing _url_ with \"http://example.org/A/\" does not start with \"http://example.org/A/\", return false\n3.  if the result of parsing _url_ with \"http://example.org/B/\" does not start with \"http://example.org/B/\", return false\n4. return true","format":"org.matrix.custom.html","formatted_body":" * <p>I have another question if I may.<br>Essentially for testing if a URL string is conforming I'm proposing the following (simplified) algo:</p>\n<ol>\n<li>if not a path-relative-scheme-less-URL string, return false</li>\n<li>if the result of parsing <em>url</em> with &quot;http://example.org/A/&quot; does not start with &quot;http://example.org/A/&quot;, return false</li>\n<li>if the result of parsing <em>url</em> with &quot;http://example.org/B/&quot; does not start with &quot;http://example.org/B/&quot;, return false</li>\n<li>return true</li>\n</ol>\n","m.new_content":{"body":"I have another question if I may.\nEssentially for testing if a URL string is conforming I'm proposing the following (simplified) algo:\n1. if not a path-relative-scheme-less-URL string, return false\n2. if the result of parsing _url_ with \"http://example.org/A/\" does not start with \"http://example.org/A/\", return false\n3.  if the result of parsing _url_ with \"http://example.org/B/\" does not start with \"http://example.org/B/\", return false\n4. return true","format":"org.matrix.custom.html","formatted_body":"<p>I have another question if I may.<br>Essentially for testing if a URL string is conforming I'm proposing the following (simplified) algo:</p>\n<ol>\n<li>if not a path-relative-scheme-less-URL string, return false</li>\n<li>if the result of parsing <em>url</em> with &quot;http://example.org/A/&quot; does not start with &quot;http://example.org/A/&quot;, return false</li>\n<li>if the result of parsing <em>url</em> with &quot;http://example.org/B/&quot; does not start with &quot;http://example.org/B/&quot;, return false</li>\n<li>return true</li>\n</ol>\n","msgtype":"m.text"},"m.relates_to":{"event_id":"$Ow0Fu8iy-kw4w8jnHO-FB4QM71Z88cpYXCULQLzUr-E","rel_type":"m.replace"},"msgtype":"m.text"},"ts":1637662326544,"senderName":"rdeltour","senderId":"@rdeltour:matrix.org","id":"$4Me3Og1eB6GkNRe-FyrcLN8Hyt6JX8FnnNHZjftdBkc"},
{"content":{"body":" * OK good. Yeah, we're only talking of subsetting valid URL strings, so the URL parser would still return an expected result. That it doesn't produce a validation error on some of EPUB-non-conforming strings is acceptable.\n\nAs for explaining all that in a note: that's what we do in the current WD; but that requirement was normative before, and EPUB is a slow world so I believe a normative definition makes more sense.","m.new_content":{"body":"OK good. Yeah, we're only talking of subsetting valid URL strings, so the URL parser would still return an expected result. That it doesn't produce a validation error on some of EPUB-non-conforming strings is acceptable.\n\nAs for explaining all that in a note: that's what we do in the current WD; but that requirement was normative before, and EPUB is a slow world so I believe a normative definition makes more sense.","msgtype":"m.text"},"m.relates_to":{"event_id":"$0tZVmot_SH5FjUvPhAlX277nXQcRiikFTeMafjSFg4k","rel_type":"m.replace"},"msgtype":"m.text"},"ts":1637662541488,"senderName":"rdeltour","senderId":"@rdeltour:matrix.org","id":"$SUltFOACOQkYu0CwTMVEBhtX_MMwKzkq-0vdFLVNbqc"},
{"content":{"body":"That seems okay, perhaps with a comment explaining the setup. You'll need to do more serializing if you want to compare strings, but you did say it was simplified.","msgtype":"m.text"},"ts":1637662720419,"senderName":"annevk","senderId":"@annevk:mozilla.org","id":"$jB-qxOuRhA8oLJMeCMzIa-wYyFTY6S4lq7vaZaKyk7s"},
{"content":{"body":"OK thanks!\n(and yes the non-simplified version does serialization)","msgtype":"m.text"},"ts":1637662771066,"senderName":"rdeltour","senderId":"@rdeltour:matrix.org","id":"$ymojSJ24aKBqScEd96CiuOrZISKkXBlIQ956vqKRQx0"},
{"content":{"body":"Well, thank you annevk for the help. Much appreciated!","format":"org.matrix.custom.html","formatted_body":"Well, thank you <a href=\"https://matrix.to/#/@annevk:mozilla.org\">annevk</a> for the help. Much appreciated!","msgtype":"m.text"},"ts":1637662825367,"senderName":"rdeltour","senderId":"@rdeltour:matrix.org","id":"$6sVYaQE9qUFmiHnqplLyGBALlUlPFqeezMJUbPQDE2c"},
{"content":{"body":"Domenic: apologies for becoming a grumpy old man yesterday, I'll blame lack of sleep and the fact that this has been grinding for a long time lol","format":"org.matrix.custom.html","formatted_body":"<a href=\"https://matrix.to/#/@domenicdenicola:matrix.org\">Domenic</a>: apologies for becoming a grumpy old man yesterday, I'll blame lack of sleep and the fact that this has been grinding for a long time lol","msgtype":"m.text"},"ts":1637679587041,"senderName":"zcorpan","senderId":"@zcorpan_:matrix.org","id":"$CugU4Ao5zuPXY05aMEVs0Wa9VpRIIRY6wBf9YaTDF1w"},
{"content":{"body":"> <@sefeng:mozilla.org> I am looking at these two tests https://github.com/web-platform-tests/wpt/blob/628af0fd55db95d785a63484882998343e3a069e/shadow-dom/focus/focus-method-delegatesFocus.html#L271-L284 and wondering which step makes the behaviour different\n\nYes, these seem suspicious. It seems to me in both cases we should be focusing innerShadowChild?","format":"org.matrix.custom.html","formatted_body":"<mx-reply><blockquote><a href=\"https://matrix.to/#/!AGetWbsMpFPdSgUrbs:matrix.org/$uFDq3GMbGiQQWxF0cnwBzzlbob-wLfhMZDBRe5tGkJs?via=mozilla.org&via=matrix.org&via=igalia.com\">In reply to</a> <a href=\"https://matrix.to/#/@sefeng:mozilla.org\">@sefeng:mozilla.org</a><br>I am looking at these two tests https://github.com/web-platform-tests/wpt/blob/628af0fd55db95d785a63484882998343e3a069e/shadow-dom/focus/focus-method-delegatesFocus.html#L271-L284 and wondering which step makes the behaviour different </blockquote></mx-reply>Yes, these seem suspicious. It seems to me in both cases we should be focusing innerShadowChild?","m.relates_to":{"m.in_reply_to":{"event_id":"$uFDq3GMbGiQQWxF0cnwBzzlbob-wLfhMZDBRe5tGkJs"}},"msgtype":"m.text"},"ts":1637684427725,"senderName":"Domenic","senderId":"@domenicdenicola:matrix.org","id":"$vu0gEKZPr4wwh3tO1Uq5zbLwshAEhFnmA85aRc5VshI"},
{"content":{"body":"yeah I see the same thing ","msgtype":"m.text"},"ts":1637684458233,"senderName":"sefeng","senderId":"@sefeng:mozilla.org","id":"$9dT8XZ5S1hKYOvflKbzeTfRZ8t85PXdugMRekLMRMBo"},
{"content":{"body":"ping emilio ^ ","format":"org.matrix.custom.html","formatted_body":"ping <a href=\"https://matrix.to/#/@emilio:mozilla.org\">emilio</a> ^","msgtype":"m.text"},"ts":1637684523698,"senderName":"sefeng","senderId":"@sefeng:mozilla.org","id":"$qgp22uJnrDcIDxi1z9J7yAKuPu0qZS66xpWS-oNhHqY"},
{"content":{"body":"sefeng: Domenic: Hmm, so per spec I believe you're right (https://html.spec.whatwg.org/#focus-delegate is the relevant section, and it is determining the target area without looking at nested shadow tree's delegateFocus). However I believe we should probably behave like the test? It feels weird that `delegatesFocus` allows to cross arbitrary shadow boundaries","format":"org.matrix.custom.html","formatted_body":"<a href=\"https://matrix.to/#/@sefeng:mozilla.org\">sefeng</a>: <a href=\"https://matrix.to/#/@domenicdenicola:matrix.org\">Domenic</a>: Hmm, so per spec I believe you're right (https://html.spec.whatwg.org/#focus-delegate is the relevant section, and it is determining the target area without looking at nested shadow tree's delegateFocus). However I believe we should probably behave like the test? It feels weird that <code>delegatesFocus</code> allows to cross arbitrary shadow boundaries","msgtype":"m.text"},"ts":1637684874761,"senderName":"emilio","senderId":"@emilio:mozilla.org","id":"$zwKHmtefNx_fM4p7ZFUzbzllpwsdunwagxM8x-vZt_E"},
{"content":{"body":"In Gecko what makes it behave differently is [this check](https://searchfox.org/mozilla-central/rev/f574930f8d5f65fc856783ff27674ada781f4570/dom/base/ShadowRoot.cpp#778)","format":"org.matrix.custom.html","formatted_body":"In Gecko what makes it behave differently is <a href=\"https://searchfox.org/mozilla-central/rev/f574930f8d5f65fc856783ff27674ada781f4570/dom/base/ShadowRoot.cpp#778\">this check</a>","msgtype":"m.text"},"ts":1637684914477,"senderName":"emilio","senderId":"@emilio:mozilla.org","id":"$axJRP8eKO3tTERK5xz2t4GMoRhvKELsqwDT5GE1k5Jo"},
{"content":{"body":"I am not sure... can we find an analogy with <input type=date> to help guide the intuition?","msgtype":"m.text"},"ts":1637684935963,"senderName":"Domenic","senderId":"@domenicdenicola:matrix.org","id":"$K3TS2sgjB6ReMOuFn4Ut-kh-KV8dVT0J3sbbm-HFf0Y"},
{"content":{"body":"well we can't because conceptually `<input type=date>` delegates focus","format":"org.matrix.custom.html","formatted_body":"well we can't because conceptually <code>&lt;input type=date&gt;</code> delegates focus","msgtype":"m.text"},"ts":1637684952462,"senderName":"emilio","senderId":"@emilio:mozilla.org","id":"$oCoyhGrtlaUE71X4sOpz71ImMyyNUAFimq1E5wN8qCc"},
{"content":{"body":"Or just any semi-realistic example, would help me figure out which direction feels more right.","msgtype":"m.text"},"ts":1637684954547,"senderName":"Domenic","senderId":"@domenicdenicola:matrix.org","id":"$MS7KG0eOa7lUC6cogDD5QxIEz8d6UIWI5kHRogKeRZo"},
{"content":{"body":"But imagine we have a component that doesn't delegate focus. calling `myComponent.focus()` won't focus any descendant in the component","format":"org.matrix.custom.html","formatted_body":"But imagine we have a component that doesn't delegate focus. calling <code>myComponent.focus()</code> won't focus any descendant in the component","msgtype":"m.text"},"ts":1637684985667,"senderName":"emilio","senderId":"@emilio:mozilla.org","id":"$Kxyg7HW2pqjwN5prWagjnMFrTAJPRvbeBy_fxr8nrqQ"},
{"content":{"body":"Right, that's why it's helpful as an intuition pump... something like <div><#shadowroot delegatesfocus=true><input type=date\"></input></div>.focus(), should focus the inner date textbox, right?","format":"org.matrix.custom.html","formatted_body":"Right, that's why it's helpful as an intuition pump... something like &lt;div&gt;&lt;#shadowroot delegatesfocus=true&gt;&lt;input type=date&quot;&gt;&lt;/input&gt;.focus(), should focus the inner date textbox, right?","msgtype":"m.text"},"ts":1637685008610,"senderName":"Domenic","senderId":"@domenicdenicola:matrix.org","id":"$MvSI9ZXVInnt27fEG6H4KgEwmk2c6DPi0k9C0IzADSg"},
{"content":{"body":"Hmm yeah I think my example is wrong and yours is the relevant one...","msgtype":"m.text"},"ts":1637685035398,"senderName":"Domenic","senderId":"@domenicdenicola:matrix.org","id":"$JcknA__G1UCYQ6EwJRRHopxzaWopxQJaXGlVqUUrmYc"},
{"content":{"body":"Yeah, but that's not the difference in those two tests","msgtype":"m.text"},"ts":1637685037110,"senderName":"emilio","senderId":"@emilio:mozilla.org","id":"$a6JDsNAUCAf4oK5VlVeeoDP_aLOoISJps5clxV2G_xc"},
{"content":{"body":"right","msgtype":"m.text"},"ts":1637685040370,"senderName":"emilio","senderId":"@emilio:mozilla.org","id":"$NjFNr6SAaUpOnmrJlRKFocmFcleYXslabullhfaZPv4"},
{"content":{"body":"The test-case would be `<div id=outer><#shadowroot delegatesfocus=true><div id=inner><#shadowroot><input></#shadowroot></div></#shadowroot></div>`","format":"org.matrix.custom.html","formatted_body":"The test-case would be <code>&lt;div id=outer&gt;&lt;#shadowroot delegatesfocus=true&gt;&lt;div id=inner&gt;&lt;#shadowroot&gt;&lt;input&gt;&lt;/#shadowroot&gt;&lt;/div&gt;&lt;/#shadowroot&gt;&lt;/div&gt;</code>","msgtype":"m.text"},"ts":1637685099655,"senderName":"emilio","senderId":"@emilio:mozilla.org","id":"$lfMGKuDIw0W6hZywWlzxo1GCMiqlWY4tR-fDpAILiGA"},
{"content":{"body":"It feels weird that `inner.focus()` wouldn't focus the `<input>`, but `outer.focus()` would","format":"org.matrix.custom.html","formatted_body":"It feels weird that <code>inner.focus()</code> wouldn't focus the <code>&lt;input&gt;</code>, but <code>outer.focus()</code> would","msgtype":"m.text"},"ts":1637685112249,"senderName":"emilio","senderId":"@emilio:mozilla.org","id":"$QCAQ49FHlDrxQz1TLqaXPYhNFK3G2k-OdOkrJMThFp4"},
{"content":{"body":"Yeah, that is weird.","msgtype":"m.text"},"ts":1637685127129,"senderName":"Domenic","senderId":"@domenicdenicola:matrix.org","id":"$hBRbrUeD01plx2h8Sb3Y3op9qJXZZwmQ3oZkifaBMzw"},
{"content":{"body":"OK so we don't want flat tree... we don't want shadow-including descendants... do we want something like shadow-including direct children?","msgtype":"m.text"},"ts":1637685130574,"senderName":"Domenic","senderId":"@domenicdenicola:matrix.org","id":"$8Wh_bf4qgym5wQYOIHEMmLiC6QL-4Jbb1mYGk2EMwnk"},
{"content":{"body":"We want shadow-including descendants as long as the path to the ancestor delegates focus","msgtype":"m.text"},"ts":1637685159930,"senderName":"emilio","senderId":"@emilio:mozilla.org","id":"$X-xfKrb1X3VS9R_6tTQsJQT6FI1BCgelVoMZf5eRnUk"},
{"content":{"body":"As in, shadow-including descendants, but without recursing into shadow trees without `delegatesFocus`","format":"org.matrix.custom.html","formatted_body":"As in, shadow-including descendants, but without recursing into shadow trees without <code>delegatesFocus</code>","msgtype":"m.text"},"ts":1637685175677,"senderName":"emilio","senderId":"@emilio:mozilla.org","id":"$JUX6vCZ_cFsdiwvvVg6L9RVQRUeqTpXepOQW91xczWw"},
{"content":{"body":"So inelegantly bespoke :P","msgtype":"m.text"},"ts":1637685187143,"senderName":"Domenic","senderId":"@domenicdenicola:matrix.org","id":"$e2LfHsJdbE8MVlfBQqA93SY9JgHDr5-TNAJwYYp9WF0"},
{"content":{"body":"The spec text will basically need to do a custom tree-walk I guess?","msgtype":"m.text"},"ts":1637685211966,"senderName":"Domenic","senderId":"@domenicdenicola:matrix.org","id":"$VwTLaiBIHeIE3BENTfkXQ1v1buzIZrbhBRuNEpmi8nI"},
{"content":{"body":"Perhaps? You can also do a filter instead looking at containing shadow trees","msgtype":"m.text"},"ts":1637685255191,"senderName":"emilio","senderId":"@emilio:mozilla.org","id":"$7u7jOOJ1cd0QVgJ36beJV-Hkk4mGScywXn6yWgEAAfA"},
{"content":{"body":"Hmm yeah I'll play around","msgtype":"m.text"},"ts":1637685317925,"senderName":"Domenic","senderId":"@domenicdenicola:matrix.org","id":"$sKg7PFoMdV4u9wMCnhvP009KoElNSVpiD79mrzSBZ9A"},
{"content":{"body":"Domenic: re https://github.com/whatwg/html/pull/7260/files#r755314056, I actually thought as an alternative to do a completely custom fetch, but take out \"prepare request from link element\" to a separate function... this way we won't have ephemeral state associated with the element. WDYT?","format":"org.matrix.custom.html","formatted_body":"<a href=\"https://matrix.to/#/@domenicdenicola:matrix.org\">Domenic</a>: re https://github.com/whatwg/html/pull/7260/files#r755314056, I actually thought as an alternative to do a completely custom fetch, but take out &quot;prepare request from link element&quot; to a separate function... this way we won't have ephemeral state associated with the element. WDYT?","msgtype":"m.text"},"ts":1637685593326,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$CBSTElVvOplCJG77z-IIRbGI726sjlu6BbOIlHjNUjU"},
{"content":{"body":"Noam Rosenthal: yeah I thought of that too. I kinda like the ephemeral state bit slightly more, since it makes it more clear this is a special case. But I could go either way.","format":"org.matrix.custom.html","formatted_body":"<a href=\"https://matrix.to/#/@noamr:matrix.org\">Noam Rosenthal</a>: yeah I thought of that too. I kinda like the ephemeral state bit slightly more, since it makes it more clear this is a special case. But I could go either way.","msgtype":"m.text"},"ts":1637685674102,"senderName":"Domenic","senderId":"@domenicdenicola:matrix.org","id":"$Pop14s7q23O_W2OeXsWmPZEXqUxWFYuehyfqbeou0VE"},
{"content":{"body":"Domenic: OK, yea, I was going backwards and forwards with this but I think it's better to have it in a closure (completely custom fetch, with reusing of prepare-request) as it eliminates weird edge cases of what happens if the element changes and re-fetches before the response returns. ","format":"org.matrix.custom.html","formatted_body":"<a href=\"https://matrix.to/#/@domenicdenicola:matrix.org\">Domenic</a>: OK, yea, I was going backwards and forwards with this but I think it's better to have it in a closure (completely custom fetch, with reusing of prepare-request) as it eliminates weird edge cases of what happens if the element changes and re-fetches before the response returns.","msgtype":"m.text"},"ts":1637685775653,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$R-EuY1aC_IYlM7e0rIEr0R2F9Qo4MBLzglmpLEQFqd8"},
{"content":{"body":"Fair point!","msgtype":"m.text"},"ts":1637685813822,"senderName":"Domenic","senderId":"@domenicdenicola:matrix.org","id":"$35Z-L0-RhIOVcNpicmMBDau58PdPWVkej1Gg_qnaWx4"},
{"content":{"body":"Domenic: revised in that spirit (+ fixed/responded to other comments). ","format":"org.matrix.custom.html","formatted_body":"<a href=\"https://matrix.to/#/@domenicdenicola:matrix.org\">Domenic</a>: revised in that spirit (+ fixed/responded to other comments).","msgtype":"m.text"},"ts":1637687499906,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$F6jgz790cwFj6ErP4N84KGrRsXgWvfZPR1qleHXxEq0"},
{"content":{"body":"emilio: sefeng: so if we stick with our plan of <dialog> using the same focus-delegation logic as delegatesFocus, that means most of the tests in https://github.com/web-platform-tests/wpt/blob/master/html/semantics/interactive-elements/the-dialog-element/dialog-focus-shadow.html change result, since we won't traverse into non-delegatesFocus shadow trees. That seem OK?","format":"org.matrix.custom.html","formatted_body":"<a href=\"https://matrix.to/#/@emilio:mozilla.org\">emilio</a>: <a href=\"https://matrix.to/#/@sefeng:mozilla.org\">sefeng</a>: so if we stick with our plan of &lt;dialog&gt; using the same focus-delegation logic as delegatesFocus, that means most of the tests in https://github.com/web-platform-tests/wpt/blob/master/html/semantics/interactive-elements/the-dialog-element/dialog-focus-shadow.html change result, since we won't traverse into non-delegatesFocus shadow trees. That seem OK?","msgtype":"m.text"},"ts":1637696030217,"senderName":"Domenic","senderId":"@domenicdenicola:matrix.org","id":"$X5jB3TLuwjtpvCxLfO6YOYGbXCSgmCP-wc9KWJXAARU"},
{"content":{"body":"Unclear if they should use exactly the same steps... But probably?","msgtype":"m.text"},"ts":1637696608179,"senderName":"emilio","senderId":"@emilio:mozilla.org","id":"$4ZctfLv9lSsHd9QwQDydvO9yaDt7GJoRLhu-cdQUVzc"}
]
[
{"content":{"body":"> <@akaster:serenityos.org> Maybe I'm supposed to run `processCustomFetchResponse` with response and a network error failure ðŸ¤”\n\nI'm reading this as you're supposed to run `processCustomFetchResponse` with a network error and null","format":"org.matrix.custom.html","formatted_body":"<mx-reply><blockquote><a href=\"https://matrix.to/#/!AGetWbsMpFPdSgUrbs:matrix.org/$bELTxkVxOiWsT69Jt-J15Ay6cnPGqHCiTbdtP7reiJQ?via=matrix.org&via=mozilla.org&via=igalia.com\">In reply to</a> <a href=\"https://matrix.to/#/@akaster:serenityos.org\">@akaster:serenityos.org</a><br>Maybe I'm supposed to run <code>processCustomFetchResponse</code> with response and a network error failure ðŸ¤”</blockquote></mx-reply>I'm reading this as you're supposed to run <code>processCustomFetchResponse</code> with a network error and null","m.mentions":{"user_ids":["@akaster:serenityos.org"]},"m.relates_to":{"m.in_reply_to":{"event_id":"$bELTxkVxOiWsT69Jt-J15Ay6cnPGqHCiTbdtP7reiJQ"}},"msgtype":"m.text"},"ts":1729453605052,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$glCub82sXyBsaUwN3-n28FmZoM4Rrx3CaUMZVKjAm4M"},
{"content":{"body":"Ah actually not. It's supposed to return a network error instead of the actual response","m.mentions":{},"msgtype":"m.text"},"ts":1729453701092,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$Zh5HL6iIC9SHoTkVZLoqFliYCXYyTUd9OZwRn2EMQjs"},
{"content":{"body":"those \"fetch hooks\" are like a post-processor to whatever fetch gave you","m.mentions":{},"msgtype":"m.text"},"ts":1729453743360,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$_zW_b6zSnAZYv7ZPuqjRnwwpm5tVzpch2iEUS36TpdY"},
{"content":{"body":"you fetch the script like you do for a normal worker, and then run the \"perform a fetch hook\" as defined in the service worker spec on the response","m.mentions":{},"msgtype":"m.text"},"ts":1729453792222,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$38EF2eUNbP3DczvLFzuAkr8I0Hor0FCEoSpWKU02HcM"},
{"content":{"body":"(Sorry, I mean it's a processor that replaces what fetch gives you)","m.mentions":{},"msgtype":"m.text"},"ts":1729453907892,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$1H5LGuU4NT7Ma8FtTySmGYPkWDxaqS_MCwG0ioWEtfA"},
{"content":{"body":"Yeah I think I have it correct here <https://github.com/LadybirdBrowser/ladybird/pull/1866/files#diff-ae24ad31836c730f2992e34539836a76a794aa52041ac31ac00d4c96dd1bf53dR213> or at least , correct-ish. The thing I don't like is waiting in perform the fetch hook for the processResponse for the fetch to trigger. I feel like I should be back-propogating the fetch controller so it can be aborted or something ","msgtype":"m.text"},"ts":1729453929441,"senderName":"akaster","senderId":"@akaster:serenityos.org","id":"$Vb-32fCA2wBtU0thUUx5jys71G5q022reacymTw2QSU"},
{"content":{"body":"I'm grabbing the perform custom fetch response in my fetch hook and using it as the process response consume body hook in the fetch algorithm input, same as what the worker impl does. Just, causing my fetch hook to return a network error to influence how the algorithm from \"fetch a worker script\" behaves","msgtype":"m.text"},"ts":1729454037944,"senderName":"akaster","senderId":"@akaster:serenityos.org","id":"$efWt0Lfrbn7D46AmrQY--32rwJG7kP-OnbF2Iwx8M3k"},
{"content":{"body":"... Definitely in need of a spec update here once I actually create a service worker process and prove that the script runs as an MVP","msgtype":"m.text"},"ts":1729454066258,"senderName":"akaster","senderId":"@akaster:serenityos.org","id":"$rMm5UY8wRJ1y7WkOcMPEaqz_Wl1H0RBJazDbIdlN60M"},
{"content":{"body":"> <@akaster:serenityos.org> Yeah I think I have it correct here <https://github.com/LadybirdBrowser/ladybird/pull/1866/files#diff-ae24ad31836c730f2992e34539836a76a794aa52041ac31ac00d4c96dd1bf53dR213> or at least , correct-ish. The thing I don't like is waiting in perform the fetch hook for the processResponse for the fetch to trigger. I feel like I should be back-propogating the fetch controller so it can be aborted or something\n\nIn most script fetches we don't abort, but rather get all the data in advance (`processResponseConsumeBody`). I'm not sure if aborting in this case is web-observable","format":"org.matrix.custom.html","formatted_body":"<mx-reply><blockquote><a href=\"https://matrix.to/#/!AGetWbsMpFPdSgUrbs:matrix.org/$Vb-32fCA2wBtU0thUUx5jys71G5q022reacymTw2QSU?via=matrix.org&via=mozilla.org&via=igalia.com\">In reply to</a> <a href=\"https://matrix.to/#/@akaster:serenityos.org\">@akaster:serenityos.org</a><br>Yeah I think I have it correct here &lt;https://github.com/LadybirdBrowser/ladybird/pull/1866/files#diff-ae24ad31836c730f2992e34539836a76a794aa52041ac31ac00d4c96dd1bf53dR213&gt; or at least , correct-ish. The thing I don&#39;t like is waiting in perform the fetch hook for the processResponse for the fetch to trigger. I feel like I should be back-propogating the fetch controller so it can be aborted or something </blockquote></mx-reply>In most script fetches we don't abort, but rather get all the data in advance (<code>processResponseConsumeBody</code>). I'm not sure if aborting in this case is web-observable","m.mentions":{"user_ids":["@akaster:serenityos.org"]},"m.relates_to":{"m.in_reply_to":{"event_id":"$Vb-32fCA2wBtU0thUUx5jys71G5q022reacymTw2QSU"}},"msgtype":"m.text"},"ts":1729454192552,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$sFsYyNc4ryz0DMfqnRZ2th1kI9PHDwvFscnMkTHFhAs"},
{"content":{"body":"Makes sense. I think if it was to be consistent with \"run a worker\" the steps should say that we do all these checks in process response consume body, and then run the process custom fetch response passed in by \"fetch a classic worker script\" afterwards (still in process response consume body)","msgtype":"m.text"},"ts":1729454306485,"senderName":"akaster","senderId":"@akaster:serenityos.org","id":"$3yqqQj16SYE9GE3xWoP4_SF5LLV330CgyJKCh9Mmq7Q"},
{"content":{"body":"Yea I have a faint memory of refactoring scripts to use `processResponseConsumeBody` myself a few years ago, and I probably neglected service-worker fetching","format":"org.matrix.custom.html","formatted_body":"Yea I have a faint memory of refactoring scripts to use <code>processResponseConsumeBody</code> myself a few years ago, and I probably neglected service-worker fetching","m.mentions":{},"msgtype":"m.text"},"ts":1729454393397,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$g4qt3e9QojyFuinaDWaOCirS7Q5zExI2yzDuMrNV4Nw"},
{"content":{"body":"I'm still a bit confused about the time traveling environment settings object I'm supposed to invent. I guess I'll have to create some faked-out ESO once I implement setting up the service worker global and environment settings and understand what priorities are relevant","msgtype":"m.text"},"ts":1729454504201,"senderName":"akaster","senderId":"@akaster:serenityos.org","id":"$fjfFSW-iCpnvzshP4E6IfQsHjWDbFGfK8IsOiFsQ1kw"},
{"content":{"body":"* I'm still a bit confused about the time traveling environment settings object I'm supposed to invent. I guess I'll have to create some faked-out ESO once I implement setting up the service worker global and environment settings and understand what properties are relevant","m.new_content":{"body":"I'm still a bit confused about the time traveling environment settings object I'm supposed to invent. I guess I'll have to create some faked-out ESO once I implement setting up the service worker global and environment settings and understand what properties are relevant","msgtype":"m.text"},"m.relates_to":{"event_id":"$fjfFSW-iCpnvzshP4E6IfQsHjWDbFGfK8IsOiFsQ1kw","rel_type":"m.replace"},"msgtype":"m.text"},"ts":1729454528598,"senderName":"akaster","senderId":"@akaster:serenityos.org","id":"$P80SNHf-UK9mhscqIrRLcVtVsNe8zIkmqpPehW8uAfA"},
{"content":{"body":"Ah you mean https://w3c.github.io/ServiceWorker/#issue-02e2fe82 I think","m.mentions":{},"msgtype":"m.text"},"ts":1729454675900,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$W4zADbbWnhxTP1QOR3Zu2MGvHjapIvg2bLhcL-yAEII"}
]
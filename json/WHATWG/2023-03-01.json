[
{"content":{"body":"this might be a dumb question, but at step 4 of https://url.spec.whatwg.org/#host-parsing , what exactly is meant by \"UTF-8 decode\"?","msgtype":"m.text"},"ts":1677637122118,"senderName":"zero-one","senderId":"@zero-one:matrix.zer0-one.net","id":"$UIsWNBaw3yPr3lDA17RhGVdKvhPlRc8QV6phNUim_Vg"},
{"content":{"body":"decoded into... UTF32? i.e, the codepoint value?","msgtype":"m.text"},"ts":1677637139817,"senderName":"zero-one","senderId":"@zero-one:matrix.zer0-one.net","id":"$3WuuuOAGS8Zheynpr4F_xOZEyMmca9D-E27IRdIn8Zc"},
{"content":{"body":"the link to the encoding spec doesn't really clear it up for me","msgtype":"m.text"},"ts":1677637184728,"senderName":"zero-one","senderId":"@zero-one:matrix.zer0-one.net","id":"$fZtLCHCSCmPuVL-MAqteg0ganjmT9_-1qRX6yWh9HBo"},
{"content":{"body":"It means \"run the algorithm given at that link\"","msgtype":"m.text"},"ts":1677638199003,"senderName":"Domenic","senderId":"@domenicdenicola:matrix.org","id":"$JmOZKq4np7amxBbEOQ1BG6TABnJI5M8X42YgA0meNrc"},
{"content":{"body":"It's not super explicit; the algorithm at that link yields an I/O queue of scalar values","msgtype":"m.text"},"ts":1677638218432,"senderName":"Jeremy Roman","senderId":"@jbroman:matrix.org","id":"$0i7q4AktAJMOncDPOKdN6KXDmVA2s1ETEEhRca6ZbpI"},
{"content":{"body":"yeah, but the algorithm just says that UTF-8 has a decoder, it doesn't explain what that means","msgtype":"m.text"},"ts":1677638249631,"senderName":"zero-one","senderId":"@zero-one:matrix.zer0-one.net","id":"$SfbmOAY2a-6v-X7GtBr8ZNDAdH3QqTn05VPwApN2_QQ"},
{"content":{"body":"and to run it","msgtype":"m.text"},"ts":1677638253678,"senderName":"zero-one","senderId":"@zero-one:matrix.zer0-one.net","id":"$jxnB4xoXOxH5wc4tOHl93jUJe3kNxgj6tqlCUoQ1cPU"},
{"content":{"body":"Well, if you try to implement it, I wonder where you get stuck","msgtype":"m.text"},"ts":1677638259995,"senderName":"Domenic","senderId":"@domenicdenicola:matrix.org","id":"$eorN_8RQOiiHLYGRcGDyqhQLzOxY-jKL0KZXv9EsarA"},
{"content":{"body":"You need to keep following the links","msgtype":"m.text"},"ts":1677638264804,"senderName":"Domenic","senderId":"@domenicdenicola:matrix.org","id":"$145D-a-jB2DfIaS1j3o2Gu9MIS3amen1MIsBWXtnXf4"},
{"content":{"body":"https://encoding.spec.whatwg.org/#concept-encoding-run , https://encoding.spec.whatwg.org/#concept-encoding-process , etc.","msgtype":"m.text"},"ts":1677638281157,"senderName":"Domenic","senderId":"@domenicdenicola:matrix.org","id":"$ZRTyq0QwhhW94aWhyL1q36PBAU63bI9UVB77zM51i6c"},
{"content":{"body":"at no point does it ever actually construct a string though","msgtype":"m.text"},"ts":1677638296646,"senderName":"Jeremy Roman","senderId":"@jbroman:matrix.org","id":"$ar9St0M6lRBOU9Fu05ozqz6mlg4vR6tphNMwwCF1afI"},
{"content":{"body":"(that I could find)","msgtype":"m.text"},"ts":1677638323384,"senderName":"Jeremy Roman","senderId":"@jbroman:matrix.org","id":"$QN_VbC8uApeVXeWu6TqH78VbeMbuz1yDPwXrYzE4yW0"},
{"content":{"body":"Eventually you end up running the UTF-8 decoder's [handler](https://encoding.spec.whatwg.org/#handler). That is defined at https://encoding.spec.whatwg.org/#ref-for-handler%E2%91%A3 .","format":"org.matrix.custom.html","formatted_body":"Eventually you end up running the UTF-8 decoder's <a href=\"https://encoding.spec.whatwg.org/#handler\">handler</a>. That is defined at https://encoding.spec.whatwg.org/#ref-for-handler%E2%91%A3 .","msgtype":"m.text"},"ts":1677638333453,"senderName":"Domenic","senderId":"@domenicdenicola:matrix.org","id":"$3PyXm0n5IbiMT08ahZ23pzQk7McNwBofH0v3Q5QxuGQ"},
{"content":{"body":"process an item pushes said code points into the I/O queue output, and process a queue does so until it fails or reaches the end of the input queue","msgtype":"m.text"},"ts":1677638434616,"senderName":"Jeremy Roman","senderId":"@jbroman:matrix.org","id":"$AEGruIcwO1bPKalOCRrZx0fyPgpyZQyuxazQF9iF7zg"},
{"content":{"body":"but UTF-8 decode simply returns that I/O queue of scalar values (code points)","msgtype":"m.text"},"ts":1677638470265,"senderName":"Jeremy Roman","senderId":"@jbroman:matrix.org","id":"$heACTZQSWQ3aglQvNGsBmAs5pg8-mrMLX4tfYt9WzUc"},
{"content":{"body":"whereas infra describes a string as consisting of code units and then handwaves at ECMA-262 to say that if you have code units you can think of them as code points","msgtype":"m.text"},"ts":1677638504014,"senderName":"Jeremy Roman","senderId":"@jbroman:matrix.org","id":"$ZFT-CJ-STiNEXX5MxzMxG66LldZM4c5yCibKPLMN07Q"},
{"content":{"body":"even though afaict the linked section of ECMA-262 only actually describes how to interpret code units as code points (and not the reverse), the intent seems to be that a conversion takes place and the URL spec is operating on infra strings","msgtype":"m.text"},"ts":1677638580047,"senderName":"Jeremy Roman","senderId":"@jbroman:matrix.org","id":"$Ut_PSEaH2ySfskcGDMNQjxZlG7cBJvm-6HsuKfQ0YAc"},
{"content":{"body":"(because nothing else would be sensible)","msgtype":"m.text"},"ts":1677638623157,"senderName":"Jeremy Roman","senderId":"@jbroman:matrix.org","id":"$tnjwn_rohAgUmfZ47S9G_q7mo0c5qBbaqu5ESaDj0gY"},
{"content":{"body":"The conversion is defined here: https://encoding.spec.whatwg.org/#from-i-o-queue-convert . I think it is intended to be explicit, but it used to be implicit, and maybe not all cases were updated...","msgtype":"m.text"},"ts":1677638633828,"senderName":"Domenic","senderId":"@domenicdenicola:matrix.org","id":"$ZnYp3-cqteS3tgS-aqynQADtwJuf3hVfKFxBZ20NrlE"},
{"content":{"body":"Or maybe https://github.com/whatwg/infra/issues/319 is saying that it's meant to be implicit, but not defined yet","msgtype":"m.text"},"ts":1677638688171,"senderName":"Domenic","senderId":"@domenicdenicola:matrix.org","id":"$4WI36hndYqSoa1WhfExY_Lv88dma6I2vEvfB931UVjo"},
{"content":{"body":"Yeah, the idea was to have implicit conversions between I/O streams and strings/lists, but looking back at it I'm not sure that's a great idea anymore","msgtype":"m.text"},"ts":1677638735270,"senderName":"Andreu Botella","senderId":"@abotella:igalia.com","id":"$U8gnyo7rFIQBJwBfhNoOPq4QzgieyjjMRGM6Lcqz5bo"},
{"content":{"body":"That was my first relatively large spec contribution ðŸ˜¬","msgtype":"m.text"},"ts":1677638755761,"senderName":"Andreu Botella","senderId":"@abotella:igalia.com","id":"$IoFj9Kiw_KcbW1y1R_yq-46JBDr4eUwp4ubIW2sSots"},
{"content":{"body":"I think there probably should be an explicit algorithm that does the UTF-16 encode on the scalar values; just kinda saying that somehow you end up with a string that UTF-16 decodes into the same scalar values feels magical to me","msgtype":"m.text"},"ts":1677638883085,"senderName":"Jeremy Roman","senderId":"@jbroman:matrix.org","id":"$WMZ2xsLdNORY5BVN2A45ULtwi6vKlqswhuUg3vb_o0M"},
{"content":{"body":"though dunno if it's a big deal","msgtype":"m.text"},"ts":1677638888881,"senderName":"Jeremy Roman","senderId":"@jbroman:matrix.org","id":"$l1NB47AXeun4EQdQht55EsKYDfRHz3fVtljtRZWEMCk"},
{"content":{"body":"as an amateur trying to implement all these specs, i wonder why we don't just assume UTF-8-encoded input for the URL parser","msgtype":"m.text"},"ts":1677638907204,"senderName":"zero-one","senderId":"@zero-one:matrix.zer0-one.net","id":"$fxa5CoIG86RJPHZYX7KV1oUUXWnfFi_BePGCGoVpAhc"},
{"content":{"body":"given that you have to do the conversion several times anyway","msgtype":"m.text"},"ts":1677638914480,"senderName":"zero-one","senderId":"@zero-one:matrix.zer0-one.net","id":"$KGKqUS9q4jHMPKTEcOo-fu5zyFYRNb5xFcxAWmwCTII"},
{"content":{"body":"and in 2023, i have to imagine that implementations not using UTF-8 anyway are few and far between","msgtype":"m.text"},"ts":1677638946893,"senderName":"zero-one","senderId":"@zero-one:matrix.zer0-one.net","id":"$ipI1PZsT8vcH3L09s3tHqaegXM9zUlxbfMd_45qUzI0"},
{"content":{"body":"afaik most implementations actually pass UTF-16 to the URL parser quite frequently","msgtype":"m.text"},"ts":1677638983480,"senderName":"Jeremy Roman","senderId":"@jbroman:matrix.org","id":"$Xwa7J_jcV1XBX1CJ7-vqj56-DA7BZ7OPkPwBRJNHEak"},
{"content":{"body":"because ECMAScript defines strings as having 16-bit code units","msgtype":"m.text"},"ts":1677638993172,"senderName":"Jeremy Roman","senderId":"@jbroman:matrix.org","id":"$tXYigZt-NIYFC54aDA8pxsVaQrVZskzDyvA9-gDLrfY"},
{"content":{"body":"even though that's now what's spoken on the wire","msgtype":"m.text"},"ts":1677639000226,"senderName":"Jeremy Roman","senderId":"@jbroman:matrix.org","id":"$fPaB1PYzdqKU185M6jFcZs8Ba0dRhpS5xNCPkkNePmc"},
{"content":{"body":" * afaik implementations actually pass UTF-16 to the URL parser quite frequently","m.new_content":{"body":"afaik implementations actually pass UTF-16 to the URL parser quite frequently","msgtype":"m.text"},"m.relates_to":{"event_id":"$Xwa7J_jcV1XBX1CJ7-vqj56-DA7BZ7OPkPwBRJNHEak","rel_type":"m.replace"},"msgtype":"m.text"},"ts":1677639026093,"senderName":"Jeremy Roman","senderId":"@jbroman:matrix.org","id":"$OdIYDxdjIdSI59YYMcHtgOebMs9-D0p4oPah3Var5RA"},
{"content":{"body":"https://infra.spec.whatwg.org/#strings","msgtype":"m.text"},"ts":1677639076360,"senderName":"Jeremy Roman","senderId":"@jbroman:matrix.org","id":"$ngSUJmtcaGt__S7Ss_9pyOuCJxhxV_s7TqE4ABSde10"},
{"content":{"body":"i guess if the URL parser is tightly coupled to a js engine, it makes more sense","msgtype":"m.text"},"ts":1677639143694,"senderName":"zero-one","senderId":"@zero-one:matrix.zer0-one.net","id":"$kmQKLUitmxZ82B6cMY7uIqt2v1Fcc3WPH5P1dvxuViY"},
{"content":{"body":"but if there's an IO boundary there, then idk","msgtype":"m.text"},"ts":1677639149516,"senderName":"zero-one","senderId":"@zero-one:matrix.zer0-one.net","id":"$hRMSIlMPQ3KQlIuGC0eYNNVah-fxa6GNkfe4pfnLxvU"}
]
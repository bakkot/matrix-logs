[
{"content":{"body":"To anyone who knows about DSD:\n\n Should `data:text/html,<div id=\"foo\"></div><script>foo.setHTMLUnsafe('<template shadowrootmode=\"open\"><h1>Foo</h1></template>')</script>` create a shadow root for the div, or simply insert a document fragment? It feels like this should work for DSD to me, but currently in Chromium, Gecko and WebKit it inserts a document fragment. Ladybird however creates a shadow root.\n\nSo now I'm wondering who's correct?","format":"org.matrix.custom.html","formatted_body":"<p>To anyone who knows about DSD:</p>\n<p>Should <code>data:text/html,&lt;div id=\"foo\"&gt;&lt;/div&gt;&lt;script&gt;foo.setHTMLUnsafe('&lt;template shadowrootmode=\"open\"&gt;&lt;h1&gt;Foo&lt;/h1&gt;&lt;/template&gt;')&lt;/script&gt;</code> create a shadow root for the div, or simply insert a document fragment? It feels like this should work for DSD to me, but currently in Chromium, Gecko and WebKit it inserts a document fragment. Ladybird however creates a shadow root.</p>\n<p>So now I'm wondering who's correct?</p>\n","m.mentions":{},"msgtype":"m.text"},"ts":1740474172843,"senderName":"Luke Warlow","senderId":"@lwarlow:igalia.com","id":"$DPqn2Ew5SGIVbM-DYWp3jGWza0tFr86JpOlA2i7jdpc"},
{"content":{"body":"I wonder if the difference may be due to Ladybird strictly implemented what’s actually spec’ed\n","m.mentions":{},"msgtype":"m.text"},"ts":1740474502897,"senderName":"sideshowbarker","senderId":"@sideshowbarker:matrix.org","id":"$iK6wfwmVy3bKDtGvUywtSe_vrTeorHWc30V-vmbY2mI"},
{"content":{"body":"Or maybe in different words that’s the same thing you’re asking","m.mentions":{},"msgtype":"m.text"},"ts":1740474530457,"senderName":"sideshowbarker","senderId":"@sideshowbarker:matrix.org","id":"$frP4eE6UsZJo6kigL5GmSH0OcBTTeHNSmJCIb27Q9fY"},
{"content":{"body":"Yeah essentially I'm trying to work out if I should raise a bug with ladybird or with the other 3","m.mentions":{},"msgtype":"m.text"},"ts":1740474585255,"senderName":"Luke Warlow","senderId":"@lwarlow:igalia.com","id":"$yfyqET5PvuLe7Yl_ogoVujUJ0GgGh7za-bXtsY0uAGQ"},
{"content":{"body":"* Yeah essentially I'm trying to work out if I should raise a bug with ladybird or with the other 3. It feels to me and to the person who found the current behaviour like Ladybird is correct with what is expected","m.mentions":{},"m.new_content":{"body":"Yeah essentially I'm trying to work out if I should raise a bug with ladybird or with the other 3. It feels to me and to the person who found the current behaviour like Ladybird is correct with what is expected","m.mentions":{},"msgtype":"m.text"},"m.relates_to":{"event_id":"$yfyqET5PvuLe7Yl_ogoVujUJ0GgGh7za-bXtsY0uAGQ","rel_type":"m.replace"},"msgtype":"m.text"},"ts":1740474628413,"senderName":"Luke Warlow","senderId":"@lwarlow:igalia.com","id":"$1IXsy8grLr05t3X7QjSZgdQ7pbLCHT4gkhXNywAveU8"},
{"content":{"body":"* Yeah essentially I'm trying to work out if I should raise a bug with ladybird or with the other 3. It feels to me and to the person who found the current behaviour like Ladybird is correct with what is expected. From a quick glance at the spec ladybird seems right too but I'm only familiar with the surface level of the API.","m.mentions":{},"m.new_content":{"body":"Yeah essentially I'm trying to work out if I should raise a bug with ladybird or with the other 3. It feels to me and to the person who found the current behaviour like Ladybird is correct with what is expected. From a quick glance at the spec ladybird seems right too but I'm only familiar with the surface level of the API.","m.mentions":{},"msgtype":"m.text"},"m.relates_to":{"event_id":"$yfyqET5PvuLe7Yl_ogoVujUJ0GgGh7za-bXtsY0uAGQ","rel_type":"m.replace"},"msgtype":"m.text"},"ts":1740474653375,"senderName":"Luke Warlow","senderId":"@lwarlow:igalia.com","id":"$5DwiBKaaDbHsGU6VJp26LodCRoymvx8nwZhvV40JZQA"},
{"content":{"body":"yes it is","m.mentions":{},"m.relates_to":{"event_id":"$HCl0TsUXXx1jynGj5ABbgKNW_qLlNsH2veJJhtHP0yQ","is_falling_back":true,"m.in_reply_to":{"event_id":"$Tj4wqH2a83rL5QL_D3LDKkteBz4kxp-ZiypufTifyb4"},"rel_type":"m.thread"},"msgtype":"m.text"},"ts":1740474678552,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$XzOny4FJGXVlCkUXIW5jXM6yNxYU_ocfxmJzsM15D3I"},
{"content":{"body":"Luke Warlow: doesn't that create a Document with an html root node and parses template into that? Why would that create a shadow tree for the div?","format":"org.matrix.custom.html","formatted_body":"<a href=\"https://matrix.to/#/@lwarlow:igalia.com\">Luke Warlow</a>: doesn't that create a Document with an html root node and parses template into that? Why would that create a shadow tree for the div?","m.mentions":{"user_ids":["@lwarlow:igalia.com"]},"msgtype":"m.text"},"ts":1740481526258,"senderName":"annevk","senderId":"@annevk:matrix.org","id":"$c0BF5noil8_csOhuPlg0FL4b7Ed44Iu3npXnInlzVxc"},
{"content":{"body":"parseHTMLUnsafe creates a new document. I don't think setHTMLUnsafe does?","msgtype":"m.text"},"ts":1740481667775,"senderName":"Luke Warlow","senderId":"@lwarlow:igalia.com","id":"$Yq6EQjmT9Wfjk54Or5EO3M-lz5r21uteueFryXfMGpE"},
{"content":{"body":"Luke Warlow: that's step 1 of fragment parsing, afaict","format":"org.matrix.custom.html","formatted_body":"<a href=\"https://matrix.to/#/@lwarlow:igalia.com\">Luke Warlow</a>: that's step 1 of fragment parsing, afaict","m.mentions":{"user_ids":["@lwarlow:igalia.com"]},"msgtype":"m.text"},"ts":1740481716781,"senderName":"annevk","senderId":"@annevk:matrix.org","id":"$z41_W1Qly5EhgUlVwoxZ8GDYBWidH0wRkV_qKrz9hr8"},
{"content":{"body":"Ah wait yeah just spotted that.  Must have skipped over that. I assumed the context element was used more exhaustively than it is. But it looks like it maybe just sets the initial parser state?","msgtype":"m.text"},"ts":1740481782247,"senderName":"Luke Warlow","senderId":"@lwarlow:igalia.com","id":"$G_pRYHbiN6D6fxVkZrPDlfcEsyaqHn8PXZy8BSa-FRg"},
{"content":{"body":"Ah but wait then it does append a copy of the context element into the stack. I assume when it later does the replacement that the DSD gets swapped out for a doc fragment because the parent elements don't match?","msgtype":"m.text"},"ts":1740481867017,"senderName":"Luke Warlow","senderId":"@lwarlow:igalia.com","id":"$aYH5EVLcKIgr9NArNWQ3dthvgPiTjnnIqJpWaU-FVGU"},
{"content":{"body":"I don't think the context element gets onto the stack. \"the adjusted current node is not the topmost element in the stack of open elements,\" is why we just insert the template element.","m.mentions":{},"msgtype":"m.text"},"ts":1740481982464,"senderName":"annevk","senderId":"@annevk:matrix.org","id":"$qamurWYAhWignGa21ohWI2uuN0A68vk4oDVcE4y-Bm4"},
{"content":{"body":"Step 11 here sounds like it does something, but you're right it doesn't seem to actually end up in the stack? https://html.spec.whatwg.org/multipage/parsing.html#html-fragment-parsing-algorithm","m.mentions":{},"msgtype":"m.text"},"ts":1740482115599,"senderName":"Luke Warlow","senderId":"@lwarlow:igalia.com","id":"$A4ZAqqIIikAhxhvo2RmUFg6Bb2GJMszSc6RiYawQ7sc"},
{"content":{"body":"Either way thanks! I'll raise an issue with Ladybird and just keep in mind that it needs the container element for context in the source string to parse","m.mentions":{},"msgtype":"m.text"},"ts":1740482143892,"senderName":"Luke Warlow","senderId":"@lwarlow:igalia.com","id":"$t_65zVMH9Ycmu6A0dYRTRGeCivGYQ4kdd7bUMTPDYfE"},
{"content":{"body":"Yeah, modernizing the HTML parser would be nice. Lots of implicit nonsense.","m.mentions":{},"msgtype":"m.text"},"ts":1740482151549,"senderName":"annevk","senderId":"@annevk:matrix.org","id":"$A6wIBVPgRXxbnATEdEeCX1dRU85RzPEzxPth7mh9Cqs"},
{"content":{"body":"* Either way thanks! I'll raise an issue with Ladybird (and WPT) and just keep in mind that it needs the container element for context in the source string to parse","m.mentions":{},"m.new_content":{"body":"Either way thanks! I'll raise an issue with Ladybird (and WPT) and just keep in mind that it needs the container element for context in the source string to parse","m.mentions":{},"msgtype":"m.text"},"m.relates_to":{"event_id":"$t_65zVMH9Ycmu6A0dYRTRGeCivGYQ4kdd7bUMTPDYfE","rel_type":"m.replace"},"msgtype":"m.text"},"ts":1740482234100,"senderName":"Luke Warlow","senderId":"@lwarlow:igalia.com","id":"$CNL7yyTmepxWPNpNEWPNRargThBoUEfcgM-F7kpiHRY"},
{"content":{"body":"Luke Warlow: attachHTMLShadow() or some such could be interesting, maybe. Would be quite a bit of work though.","format":"org.matrix.custom.html","formatted_body":"<a href=\"https://matrix.to/#/@lwarlow:igalia.com\">Luke Warlow</a>: attachHTMLShadow() or some such could be interesting, maybe. Would be quite a bit of work though.","m.mentions":{"user_ids":["@lwarlow:igalia.com"]},"msgtype":"m.text"},"ts":1740482292562,"senderName":"annevk","senderId":"@annevk:matrix.org","id":"$HTDVvPs02ckhsot5crb5G4cj9zpjMSImRzgw1tyBRnY"},
{"content":{"body":"keithamus: can you review https://github.com/whatwg/html/pull/11053 please?","format":"org.matrix.custom.html","formatted_body":"<a href=\"https://matrix.to/#/@keithamus:matrix.org\">keithamus</a>: can you review https://github.com/whatwg/html/pull/11053 please?","m.mentions":{"user_ids":["@keithamus:matrix.org"]},"msgtype":"m.text"},"ts":1740502758705,"senderName":"annevk","senderId":"@annevk:matrix.org","id":"$DQV5lxOR2q85ttJHmdqS6-p_44WY3Kj34SeyIlG1GHw"}
]
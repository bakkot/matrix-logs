[
{"content":{"body":"Definitely not. The simplest way to see this is to consider the iframe case. An iframe will contain a single browsing context for all time. That browsing context can transition between different agents, living in different agent clusters, if you navigate the iframe cross-site.","m.mentions":{},"msgtype":"m.text"},"ts":1700707870257,"senderName":"Domenic","senderId":"@domenicdenicola:matrix.org","id":"$aZcrzMj10tVql4uPiUpoAY3JDHzm_Esd4B8-2scfAUg"},
{"content":{"body":"https://github.com/whatwg/html/pulls/keithamus there's a handful of open editorial PRs for the enumerated attributes. It'd be great to get https://github.com/whatwg/html/pull/9947 reviewed and merged as I get the sense it'll cause merge conflicts down the line.","m.mentions":{},"msgtype":"m.text"},"ts":1700733173061,"senderName":"keithamus","senderId":"@keithamus:matrix.org","id":"$_rD5iM3seKf12SqO06helFe54FFaXa5nJrgmfM0cwqw"},
{"content":{"body":"As an action item from the last WHATNOT, I created https://github.com/whatwg/html/issues/9941 (defining what navigation type to give a tab-restore) \nI convinced myself that a tab-restore is actually closer to restoring from history than to a reload, but would love feedback as convincing myself has proven insufficient in the past.","m.mentions":{},"msgtype":"m.text"},"ts":1700735557012,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$y4aY-ZbtXQZO9isqExUlMqFAbelbMzSS_VGZ6Hf-dLw"},
{"content":{"body":"keithamus: I merged that one and another small one; can take another look after lunch","format":"org.matrix.custom.html","formatted_body":"<a href=\"https://matrix.to/#/@keithamus:matrix.org\">keithamus</a>: I merged that one and another small one; can take another look after lunch","m.mentions":{"user_ids":["@keithamus:matrix.org"]},"msgtype":"m.text"},"ts":1700738318534,"senderName":"annevk","senderId":"@annevk:matrix.org","id":"$esAWQCG2r6SIjNQCKA3KBDPWbjORSYNDWB3erqw1vYs"},
{"content":{"body":"keithamus: thanks for all the cleanup!","format":"org.matrix.custom.html","formatted_body":"<a href=\"https://matrix.to/#/@keithamus:matrix.org\">keithamus</a>: thanks for all the cleanup!","m.mentions":{"user_ids":["@keithamus:matrix.org"]},"msgtype":"m.text"},"ts":1700738327549,"senderName":"annevk","senderId":"@annevk:matrix.org","id":"$UlmUvIez54gVuNpyj0M_lGMXlQHachJfPtpluHSb9Hw"},
{"content":{"body":"Amazing thank you!","m.mentions":{},"msgtype":"m.text"},"ts":1700738330837,"senderName":"keithamus","senderId":"@keithamus:matrix.org","id":"$-hv3bLYkpPk9e1R2Gvbt2Ns-7K6_sQURhOR5CSGeg-k"},
{"content":{"body":"keithamus: one thing that helps with reviews is to do fixup commits (which we squash when landing); bit different from how WebKit does things and not possible when you need to rebase, but that generally makes it easier to see if anything besides your review comments got addressed, etc.","format":"org.matrix.custom.html","formatted_body":"<a href=\"https://matrix.to/#/@keithamus:matrix.org\">keithamus</a>: one thing that helps with reviews is to do fixup commits (which we squash when landing); bit different from how WebKit does things and not possible when you need to rebase, but that generally makes it easier to see if anything besides your review comments got addressed, etc.","m.mentions":{"user_ids":["@keithamus:matrix.org"]},"msgtype":"m.text"},"ts":1700741023689,"senderName":"annevk","senderId":"@annevk:matrix.org","id":"$P_jXHrBTSqSRhsps_Mp9X-MeRNQ20RzmmYtICS2k57U"},
{"content":{"body":"Oh right, will do, thanks for calling that out.","m.mentions":{},"msgtype":"m.text"},"ts":1700741046755,"senderName":"keithamus","senderId":"@keithamus:matrix.org","id":"$4t-aWmwIitIm3TXzPNcjm60fNTFOdUFpkMYs_OHUrjs"},
{"content":{"body":"In the case of my recent rebase it was only your review comment ;) ","m.mentions":{},"msgtype":"m.text"},"ts":1700741084476,"senderName":"keithamus","senderId":"@keithamus:matrix.org","id":"$GXUESEoNPeUxMipP7meSLqQ30ks3C20HUbGdVd-hrHE"},
{"content":{"body":"Ms2ger ðŸ‡©ðŸ‡ª: if you make it to Berlin don't forget to say hi","format":"org.matrix.custom.html","formatted_body":"<a href=\"https://matrix.to/#/@ms2ger:igalia.com\">Ms2ger ðŸ‡©ðŸ‡ª</a>: if you make it to Berlin don't forget to say hi","m.mentions":{"user_ids":["@ms2ger:igalia.com"]},"msgtype":"m.text"},"ts":1700749828305,"senderName":"annevk","senderId":"@annevk:matrix.org","id":"$FHKRnMXJ3DyogIqDDfAZ36ih5QAr6RzqyXFSnsaTXww"},
{"content":{"body":"Going in the other direction, sorry :)","msgtype":"m.text"},"ts":1700749845672,"senderName":"Ms2ger ðŸ‡©ðŸ‡ª","senderId":"@ms2ger:igalia.com","id":"$5zocrEIfJ1pCYFsuogCT54IwHrMF5tOsrd4nIhZAbvQ"},
{"content":{"body":"Deutsche Bahn permitting","msgtype":"m.text"},"ts":1700749855956,"senderName":"Ms2ger ðŸ‡©ðŸ‡ª","senderId":"@ms2ger:igalia.com","id":"$JnMmj2k5OuKyoB87eDM8Fcunma4UpOJMiW6Khht370U"},
{"content":{"body":"Hah, good luck!","m.mentions":{},"msgtype":"m.text"},"ts":1700749876727,"senderName":"annevk","senderId":"@annevk:matrix.org","id":"$F0Df7v7BbzPcgPgLwlRSqt-v7NcZWAOi-EZUPL78wK0"},
{"content":{"body":"(My next train has already been cancelled and uncancelled)","msgtype":"m.text"},"ts":1700749895307,"senderName":"Ms2ger ðŸ‡©ðŸ‡ª","senderId":"@ms2ger:igalia.com","id":"$jTAzRyt1967Cjgzdg2r5S3Xav0ZmDig9_uLJv3awodo"},
{"content":{"body":"> <@domenicdenicola:matrix.org> Definitely not. The simplest way to see this is to consider the iframe case. An iframe will contain a single browsing context for all time. That browsing context can transition between different agents, living in different agent clusters, if you navigate the iframe cross-site.\n\nThat doesn't align with my current understanding at all ðŸ˜…. Browsing contexts are expected to move between agents as they navigate? We'll need to refactor them a lot in LibWeb to make that a possibility...","format":"org.matrix.custom.html","formatted_body":"<mx-reply><blockquote><a href=\"https://matrix.to/#/!AGetWbsMpFPdSgUrbs:matrix.org/$aZcrzMj10tVql4uPiUpoAY3JDHzm_Esd4B8-2scfAUg?via=serenityos.org&via=matrix.org&via=mozilla.org\">In reply to</a> <a href=\"https://matrix.to/#/@domenicdenicola:matrix.org\">@domenicdenicola:matrix.org</a><br />Definitely not. The simplest way to see this is to consider the iframe case. An iframe will contain a single browsing context for all time. That browsing context can transition between different agents, living in different agent clusters, if you navigate the iframe cross-site.</blockquote></mx-reply>That doesn't align with my current understanding at all ðŸ˜…. Browsing contexts are expected to move between agents as they navigate? We'll need to refactor them a lot in LibWeb to make that a possibility...","m.relates_to":{"m.in_reply_to":{"event_id":"$aZcrzMj10tVql4uPiUpoAY3JDHzm_Esd4B8-2scfAUg"}},"msgtype":"m.text"},"ts":1700751393661,"senderName":"akaster","senderId":"@akaster:serenityos.org","id":"$I5w8zknGdigWIwbtJHakeZmH1ONgQSkX8sXVO6QKFDI"},
{"content":{"body":"Is there some mechanism in the spec that I missed that talks about when we're supposed to move a browsing context to a new agent?","msgtype":"m.text"},"ts":1700751869853,"senderName":"akaster","senderId":"@akaster:serenityos.org","id":"$eFbudcetsyAfAMWMCEORal5U8v-R2ECnv0y_nAh8nFU"},
{"content":{"body":"akaster: I assume you've seen how a browsing context group holds an agent cluster map?","format":"org.matrix.custom.html","formatted_body":"<a href=\"https://matrix.to/#/@akaster:serenityos.org\">akaster</a>: I assume you've seen how a browsing context group holds an agent cluster map?","m.mentions":{"user_ids":["@akaster:serenityos.org"]},"msgtype":"m.text"},"ts":1700757009470,"senderName":"annevk","senderId":"@annevk:matrix.org","id":"$PvrPFL7qaQ2fahhOLr0bfEBtfFVL02jAiAlF4mKwIxs"},
{"content":{"body":"akaster: but basically if you trace the callers of \"create an agent\" you should be able to find it","format":"org.matrix.custom.html","formatted_body":"<a href=\"https://matrix.to/#/@akaster:serenityos.org\">akaster</a>: but basically if you trace the callers of \"create an agent\" you should be able to find it","m.mentions":{"user_ids":["@akaster:serenityos.org"]},"msgtype":"m.text"},"ts":1700757091397,"senderName":"annevk","senderId":"@annevk:matrix.org","id":"$iSrabJjCgsuyJjgrEs1NmxIBMpLGuUsuj3N8usag-tE"},
{"content":{"body":"akaster: (clicking on the definition reveals the callers)","format":"org.matrix.custom.html","formatted_body":"<a href=\"https://matrix.to/#/@akaster:serenityos.org\">akaster</a>: (clicking on the definition reveals the callers)","m.mentions":{"user_ids":["@akaster:serenityos.org"]},"msgtype":"m.text"},"ts":1700757103878,"senderName":"annevk","senderId":"@annevk:matrix.org","id":"$-10t865dO9633XtqrhwHzHTwSKx6xVPXd8tXataCk5U"},
{"content":{"body":"Oh, that links back to \"obtain a similar origin window agent\"","msgtype":"m.text"},"ts":1700757106752,"senderName":"akaster","senderId":"@akaster:serenityos.org","id":"$nlqXJdk5Fcz8b5ZbA7z2_9pyfr_AsNC6yx4-Uf39Tdg"},
{"content":{"body":"akaster: right so an agent can be reused, but if you navigate a document to a new document of a different not-yet-seen origin, you need a new agent","format":"org.matrix.custom.html","formatted_body":"<a href=\"https://matrix.to/#/@akaster:serenityos.org\">akaster</a>: right so an agent can be reused, but if you navigate a document to a new document of a different not-yet-seen origin, you need a new agent","m.mentions":{"user_ids":["@akaster:serenityos.org"]},"msgtype":"m.text"},"ts":1700757171434,"senderName":"annevk","senderId":"@annevk:matrix.org","id":"$UaZo958NzsZYNI4pIW1EpJB2bJzqH3TJoh6GEs0WtFs"},
{"content":{"body":"akaster: and due to bfcache a single browsing context can end up being responsible for several cross-site documents (and thus agents)","format":"org.matrix.custom.html","formatted_body":"<a href=\"https://matrix.to/#/@akaster:serenityos.org\">akaster</a>: and due to bfcache a single browsing context can end up being responsible for several cross-site documents (and thus agents)","m.mentions":{"user_ids":["@akaster:serenityos.org"]},"msgtype":"m.text"},"ts":1700757222125,"senderName":"annevk","senderId":"@annevk:matrix.org","id":"$0HoN8miEsLJ8BX_LdBlIx32XPjQSOCUxXHMWK4KQBdE"},
{"content":{"body":"Is it expected that when you create a new agent that execution of the current algorithm will jump into the context of that agent? Or rather, onto the execution context stack of that new agent","msgtype":"m.text"},"ts":1700757267566,"senderName":"akaster","senderId":"@akaster:serenityos.org","id":"$1zRKxnnxYMHhDHWGWlem1zvaPIaZrTWzk3l2tmT9HDM"},
{"content":{"body":"akaster: the new document/worker will have to execute in the new agent, but the spec algorithm might also do some other bookkeeping things not related to JS code","format":"org.matrix.custom.html","formatted_body":"<a href=\"https://matrix.to/#/@akaster:serenityos.org\">akaster</a>: the new document/worker will have to execute in the new agent, but the spec algorithm might also do some other bookkeeping things not related to JS code","m.mentions":{"user_ids":["@akaster:serenityos.org"]},"msgtype":"m.text"},"ts":1700757379370,"senderName":"annevk","senderId":"@annevk:matrix.org","id":"$C8Pj_tHoF3MKEDfAcZB-uAEfMQXTYQQkeye6cgM08Uk"},
{"content":{"body":"Or am I still not thinking about this right. The way that all these concepts relate to threads and processes is still quite confusing.","msgtype":"m.text"},"ts":1700757397749,"senderName":"akaster","senderId":"@akaster:serenityos.org","id":"$6t-YJtBkqYT7BDZPCTcZFi0o7FRufjO7c7D9SJDnzAU"},
{"content":{"body":"akaster: an agent cluster is a conceptual process","format":"org.matrix.custom.html","formatted_body":"<a href=\"https://matrix.to/#/@akaster:serenityos.org\">akaster</a>: an agent cluster is a conceptual process","m.mentions":{"user_ids":["@akaster:serenityos.org"]},"msgtype":"m.text"},"ts":1700757416494,"senderName":"annevk","senderId":"@annevk:matrix.org","id":"$rtxfv9NP73cOC6WzS_VgP79w2_w12g3gbBgFsIp83Bs"},
{"content":{"body":"akaster: an agent is a conceptual thread","format":"org.matrix.custom.html","formatted_body":"<a href=\"https://matrix.to/#/@akaster:serenityos.org\">akaster</a>: an agent is a conceptual thread","m.mentions":{"user_ids":["@akaster:serenityos.org"]},"msgtype":"m.text"},"ts":1700757423945,"senderName":"annevk","senderId":"@annevk:matrix.org","id":"$Kf0aYikq9wz8poNjWXhsuocoW00iUhzcwbvt0FDCn8g"},
{"content":{"body":"In practice user agents coalesce multiple \"conceptuals\" into a single \"physical\" to limit resource usage, but the specification allows for more parallelism","m.mentions":{},"msgtype":"m.text"},"ts":1700757484212,"senderName":"annevk","senderId":"@annevk:matrix.org","id":"$51mdzELYrT6C5GyCOEQQhNCCmLJAlanjWvx7sB2YStE"},
{"content":{"body":"Gotcha... Just need to wrap my head around what things are supposed to happen \"to the user agent\" (aka some abstract state that someone handles (?)) vs what are useful to model as an actual C++ object in memory of a particular process, whether it be the renderer, UI, or other helper ","msgtype":"m.text"},"ts":1700757506947,"senderName":"akaster","senderId":"@akaster:serenityos.org","id":"$mnpddVlu_nFj14M6uLFZ8Daw-Ueo3nBUtB5HBHLM488"},
{"content":{"body":"akaster: I see, most browsers have a \"browser\" process that would allocate these \"agent cluster\" processes","format":"org.matrix.custom.html","formatted_body":"<a href=\"https://matrix.to/#/@akaster:serenityos.org\">akaster</a>: I see, most browsers have a \"browser\" process that would allocate these \"agent cluster\" processes","m.mentions":{"user_ids":["@akaster:serenityos.org"]},"msgtype":"m.text"},"ts":1700757551456,"senderName":"annevk","senderId":"@annevk:matrix.org","id":"$sPBbPCII0chdTGVm4Ti6lcAAnN2aB1uR3PAC1sO7aec"},
{"content":{"body":"akaster: and then depending on needs there might be a GPU, network, etc. process","format":"org.matrix.custom.html","formatted_body":"<a href=\"https://matrix.to/#/@akaster:serenityos.org\">akaster</a>: and then depending on needs there might be a GPU, network, etc. process","m.mentions":{"user_ids":["@akaster:serenityos.org"]},"msgtype":"m.text"},"ts":1700757571040,"senderName":"annevk","senderId":"@annevk:matrix.org","id":"$DWJw1wDmv3nSMxYDQmTY_CIl-SlrFGbdBh7yuBw90UU"},
{"content":{"body":"Right, in Ladybird at the moment we have a more or less standard architecture, I think. We have a browser process, and we have a WebContent process for each Tab, and a set of Network, ImageDecoding processes etc that could easily be shared but aren't at the moment for the WebContent process to use","msgtype":"m.text"},"ts":1700757646685,"senderName":"akaster","senderId":"@akaster:serenityos.org","id":"$khEn5tx8LTlI1YJ8UMTng1IC0NzbKM8KPJz6ajTM_yM"},
{"content":{"body":"But the way that we handle navigation is still very ad hoc","msgtype":"m.text"},"ts":1700757663517,"senderName":"akaster","senderId":"@akaster:serenityos.org","id":"$xZqryr1_8tlMsd_XSaILZqh3uz3tEUixlpGAgtnTGNs"},
{"content":{"body":"So aligning what the spec expects us to do as far as agents and agent clusters vs the current \"just change the URL we load lmao\" approach is ... Not straightforward.","msgtype":"m.text"},"ts":1700757707844,"senderName":"akaster","senderId":"@akaster:serenityos.org","id":"$xXAYO6O7XE_A5-FYnfaZp_IznwOvbULI6MIAU3BS4R0"},
{"content":{"body":"So it sounds like, WebContent (aka the renderer) is supposed to be our agent cluster process. And every time we navigate to a url that needs a new agent cluster, we \"should\" create a new process. And most browsers at the moment ask the main Browser process (UI?) to create one for them","msgtype":"m.text"},"ts":1700757830930,"senderName":"akaster","senderId":"@akaster:serenityos.org","id":"$fH3ZgejWqKj7sB3WxnBLMtwXLvaoLhn0Azk0KETWWzc"},
{"content":{"body":"akaster: yeah, sounds like you have the same state WebKit is in, which is a problem for Spectre. You need different processes for nested documents. That requires quite a number of changes.","format":"org.matrix.custom.html","formatted_body":"<a href=\"https://matrix.to/#/@akaster:serenityos.org\">akaster</a>: yeah, sounds like you have the same state WebKit is in, which is a problem for Spectre. You need different processes for nested documents. That requires quite a number of changes.","m.mentions":{"user_ids":["@akaster:serenityos.org"]},"msgtype":"m.text"},"ts":1700757918809,"senderName":"annevk","senderId":"@annevk:matrix.org","id":"$_2FWgt0UCKvEyyZBhJXavM9rTbh0Eh51dPdQsfKaFwM"},
{"content":{"body":"akaster: and yeah having the UI/browser process take some responsibility for navigations is needed I think.","format":"org.matrix.custom.html","formatted_body":"<a href=\"https://matrix.to/#/@akaster:serenityos.org\">akaster</a>: and yeah having the UI/browser process take some responsibility for navigations is needed I think.","m.mentions":{"user_ids":["@akaster:serenityos.org"]},"msgtype":"m.text"},"ts":1700757945482,"senderName":"annevk","senderId":"@annevk:matrix.org","id":"$jawrM5BNcZO05L77soJUOV9IJkw707aiQT-khwSmlbM"},
{"content":{"body":"Okay, thanks! I think I'll need to draw a lot of diagrams to wrap my head around how all this is supposed to work. Especially for the set of IPC interactions we need to have, and which spec records need to be shared between the processes, or at least transferred around. When talking to Domenic about my worker prototypes it was clear that we weren't modelling EnvironmentSettingsObjects in the way the spec authors intended","msgtype":"m.text"},"ts":1700758085889,"senderName":"akaster","senderId":"@akaster:serenityos.org","id":"$DkKkfP_H3N5k3Dy1aau3Ouh1vRZEDV9qTNsBJbaWEj0"},
{"content":{"body":"akaster: https://docs.google.com/presentation/d/1hi4gH7pJPHsg_hnIj77XN_ce54HIaNUnBLenVwohFVo/edit#slide=id.g5641ecbac9_0_131 might help for the high-level idea.","format":"org.matrix.custom.html","formatted_body":"<a href=\"https://matrix.to/#/@akaster:serenityos.org\">akaster</a>: https://docs.google.com/presentation/d/1hi4gH7pJPHsg_hnIj77XN_ce54HIaNUnBLenVwohFVo/edit#slide=id.g5641ecbac9_0_131 might help for the high-level idea.","m.mentions":{"user_ids":["@akaster:serenityos.org"]},"msgtype":"m.text"},"ts":1700758091062,"senderName":"annevk","senderId":"@annevk:matrix.org","id":"$XS49_3DxsUlmV8xVgV1hXA_hZBjdxVIVNU8FFWsP_tA"}
]
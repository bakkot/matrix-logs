[
{"content":{"body":"jmdyck: I believe it is correct albeit not clear, the Text nodes are being excluded, they are the descendants of <script> or <svg:script> that are descendants of the <legend>. So they're indeed \"descendants of descendants\".","format":"org.matrix.custom.html","formatted_body":"<a href=\"https://matrix.to/#/@jmdyck:matrix.org\">jmdyck</a>: I believe it is correct albeit not clear, the Text nodes are being excluded, they are the descendants of &lt;script&gt; or <a href=\"svg:script\">svg:script</a> that are descendants of the &lt;legend&gt;. So they're indeed \"descendants of descendants\".","m.mentions":{"user_ids":["@jmdyck:matrix.org"]},"msgtype":"m.text"},"ts":1770351169029,"senderName":"Kaiido","senderId":"@kaiido:matrix.org","id":"$OnO4XpljzgwKzXL4WWrwVPqF2uIt44n9cNG1UYMovog"},
{"content":{"body":"Phil Pizlo finally putting his Fil-C work to good use: https://yoshell.ai ðŸ˜€","m.mentions":{},"msgtype":"m.text"},"ts":1770365199951,"senderName":"sideshowbarker","senderId":"@sideshowbarker:matrix.org","id":"$ZG2gwL21Wn1G6YtROOlQv6eEWdHqb3fGa2pm6s4btUo"},
{"content":{"body":"zcorpan: I'm trying to understand how `<script>console.log(\"</script>\")</script>` manages to \"back up\" when it sees the \">\" inside the console.log string so that the script element text is just 'console.log(\"'. Do you know what tokenizer state this is? It looks to me like \"Script data double escape start state\" or \"Script data double escape end state\", but it looks like 'console.log(\"</script' has already been emitted as character tokens at that point. How does the tokenizer \"take back\" what's already been emitted?","format":"org.matrix.custom.html","formatted_body":"<a href=\"https://matrix.to/#/@zcorpan:mozilla.org\">zcorpan</a>: I'm trying to understand how <code>&lt;script&gt;console.log(\"&lt;/script&gt;\")&lt;/script&gt;</code> manages to \"back up\" when it sees the \"&gt;\" inside the console.log string so that the script element text is just 'console.log(\"'. Do you know what tokenizer state this is? It looks to me like \"Script data double escape start state\" or \"Script data double escape end state\", but it looks like 'console.log(\"&lt;/script' has already been emitted as character tokens at that point. How does the tokenizer \"take back\" what's already been emitted?","m.mentions":{"user_ids":["@zcorpan:mozilla.org"]},"msgtype":"m.text"},"ts":1770376926843,"senderName":"foolip","senderId":"@foolip:matrix.org","id":"$8kOkfKA0v0JOGK-VAXB9vGD6YNpruEBLLtplehZG2P8"},
{"content":{"body":"foolip: it doesn't back up it just closes the script element there. \nhttps://html.spec.whatwg.org/#script-data-state\nhttps://html.spec.whatwg.org/#script-data-less-than-sign-state\nhttps://html.spec.whatwg.org/#script-data-end-tag-open-state\nhttps://html.spec.whatwg.org/#script-data-end-tag-name-state\n","format":"org.matrix.custom.html","formatted_body":"<a href=\"https://matrix.to/#/@foolip:matrix.org\">foolip</a>: it doesn't back up it just closes the script element there.<br>https://html.spec.whatwg.org/#script-data-state<br>https://html.spec.whatwg.org/#script-data-less-than-sign-state<br>https://html.spec.whatwg.org/#script-data-end-tag-open-state<br>https://html.spec.whatwg.org/#script-data-end-tag-name-state","m.mentions":{"user_ids":["@foolip:matrix.org"]},"msgtype":"m.text"},"ts":1770377527219,"senderName":"zcorpan","senderId":"@zcorpan:mozilla.org","id":"$RiXx5nbGtvojU5TiDCjawiUrbZoqailjV0s0RSgzge4"},
{"content":{"body":"foolip: you need <script><!-- to enter https://html.spec.whatwg.org/#script-data-escaped-state","format":"org.matrix.custom.html","formatted_body":"<a href=\"https://matrix.to/#/@foolip:matrix.org\">foolip</a>: you need &lt;script&gt;&lt;!-- to enter https://html.spec.whatwg.org/#script-data-escaped-state","m.mentions":{"user_ids":["@foolip:matrix.org"]},"msgtype":"m.text"},"ts":1770377609335,"senderName":"zcorpan","senderId":"@zcorpan:mozilla.org","id":"$Vmk3z-irTWkM8WRZmNchRzx_d17yINcVQOZ71qHQX0Y"},
{"content":{"body":"foolip: and <script><!--<script> to enter https://html.spec.whatwg.org/#script-data-escaped-state (which causes a single </script> to not close the element)","format":"org.matrix.custom.html","formatted_body":"<a href=\"https://matrix.to/#/@foolip:matrix.org\">foolip</a>: and &lt;script&gt;&lt;!--&lt;script&gt; to enter https://html.spec.whatwg.org/#script-data-escaped-state (which causes a single &lt;/script&gt; to not close the element)","m.mentions":{"user_ids":["@foolip:matrix.org"]},"msgtype":"m.text"},"ts":1770377704194,"senderName":"zcorpan","senderId":"@zcorpan:mozilla.org","id":"$R2_xKxBwJ9YIhunHIDgv_ERQ8QnjqRHzDQjbgrWd-LE"},
{"content":{"body":"* foolip: and \\<script>\\<!--\\<script> to enter https://html.spec.whatwg.org/#script-data-double-escaped-state (which causes a single \\</script> to not close the element)","format":"org.matrix.custom.html","formatted_body":"* <a href=\"https://matrix.to/#/@foolip:matrix.org\">foolip</a>: and &lt;script&gt;&lt;!--&lt;script&gt; to enter https://html.spec.whatwg.org/#script-data-double-escaped-state (which causes a single &lt;/script&gt; to not close the element)","m.mentions":{},"m.new_content":{"body":"foolip: and \\<script>\\<!--\\<script> to enter https://html.spec.whatwg.org/#script-data-double-escaped-state (which causes a single \\</script> to not close the element)","format":"org.matrix.custom.html","formatted_body":"<a href=\"https://matrix.to/#/@foolip:matrix.org\">foolip</a>: and &lt;script&gt;&lt;!--&lt;script&gt; to enter https://html.spec.whatwg.org/#script-data-double-escaped-state (which causes a single &lt;/script&gt; to not close the element)","m.mentions":{"user_ids":["@foolip:matrix.org"]},"msgtype":"m.text"},"m.relates_to":{"event_id":"$R2_xKxBwJ9YIhunHIDgv_ERQ8QnjqRHzDQjbgrWd-LE","rel_type":"m.replace"},"msgtype":"m.text"},"ts":1770377802224,"senderName":"zcorpan","senderId":"@zcorpan:mozilla.org","id":"$sRy05H-WJFvFAF-OqQrFoA3VyD95c0jzSfZ3lZE7V60"},
{"content":{"body":"https://html.spec.whatwg.org/#script-data-double-escape-end-state handling > is where </script> is sometimes \"ignored\"","m.mentions":{},"msgtype":"m.text"},"ts":1770377893389,"senderName":"zcorpan","senderId":"@zcorpan:mozilla.org","id":"$UxK8YoyE1wXGx4iBVOY6rF24ybcaW5LMA8KNowQd5OI"},
{"content":{"body":"Thanks, the `<script>console.log(\"</script>\")</script>` case is clear now. It does use the temp buffer and if that > inside the string isn't there, it emits a character token for each char in the temp buffer.","format":"org.matrix.custom.html","formatted_body":"Thanks, the <code>&lt;script&gt;console.log(\"&lt;/script&gt;\")&lt;/script&gt;</code> case is clear now. It does use the temp buffer and if that &gt; inside the string isn't there, it emits a character token for each char in the temp buffer.","m.mentions":{},"msgtype":"m.text"},"ts":1770377899887,"senderName":"foolip","senderId":"@foolip:matrix.org","id":"$X35jL03LuXqcdNypd8pqYAZZdtZkZNO1WCfXIK7lK0o"},
{"content":{"body":"That explains how the parallel lowercase + original case is handled in that case.","m.mentions":{},"msgtype":"m.text"},"ts":1770377943677,"senderName":"foolip","senderId":"@foolip:matrix.org","id":"$IwLZHMPst9JQ2NSwYhzHM9T-wD1nXXNxv-2aCx32Dyo"},
{"content":{"body":"The context is I did https://whatpr.org/html/12118/parsing.html#processing-instruction-target-state yesterday and although it's readable, I think it's an unusual use of the temp buffer that maybe I should undo.","m.mentions":{},"msgtype":"m.text"},"ts":1770378006628,"senderName":"foolip","senderId":"@foolip:matrix.org","id":"$r4iZuwJc0yT8ttw0FYxjecbWXPV07XFhjdLrW4Bs4V0"},
{"content":{"body":"is there a way to have a \"back\" button/link without js?","m.mentions":{},"msgtype":"m.text"},"ts":1770378030167,"senderName":"snek","senderId":"@devsnek:matrix.org","id":"$KziH23tx32t0TjgWAbi7UqLJoBsh0s-dHJuJ3_fMePw"},
{"content":{"body":"The motivation was to avoid saying \"discard the current token\" which the tokenizer never does elsewhere (including in Blink's implementation).","m.mentions":{},"msgtype":"m.text"},"ts":1770378043550,"senderName":"foolip","senderId":"@foolip:matrix.org","id":"$Y-Nupg1a_ytsALpBJU8Vvp6VisBP7T_rh1lpwqilJHM"},
{"content":{"body":"i was hoping there would be some obsecure href target or button command or something, but i couldn't find anything","m.mentions":{},"msgtype":"m.text"},"ts":1770378060587,"senderName":"snek","senderId":"@devsnek:matrix.org","id":"$lgYOzxrFqzHg8qHUT_S706gH5BnnoTZooDCce5lrslA"},
{"content":{"body":"The problem is there might be unbounded buffering before we know whether we're going to create a PI or a bogus comment, and that we need the data lowercase for the first but the original for the latter...","m.mentions":{},"msgtype":"m.text"},"ts":1770378093822,"senderName":"foolip","senderId":"@foolip:matrix.org","id":"$GWCoo0eVpNmJzHc5yEZ5pvVkS0hNcvhq7WNz4XQWNlA"},
{"content":{"body":"Hmm right. Maybe the target should preserve case?","m.mentions":{},"msgtype":"m.text"},"ts":1770378260798,"senderName":"zcorpan","senderId":"@zcorpan:mozilla.org","id":"$74h9qSdijWgpf9hxPcWcZouTcO8xizg1xXhzMaBtf4M"},
{"content":{"body":"Huh, I didn't even think about that.","m.mentions":{},"msgtype":"m.text"},"ts":1770378284308,"senderName":"foolip","senderId":"@foolip:matrix.org","id":"$L6W-p44JA5BU5hUUxdUZbZPb30gV6xAq9FXvwHUlnhM"},
{"content":{"body":"What I did consider was letting tree construction lowercase the target.","m.mentions":{},"msgtype":"m.text"},"ts":1770378336509,"senderName":"foolip","senderId":"@foolip:matrix.org","id":"$lc2rXjWqmWaoEo_8vTNCaiZNkQEqjOM53JpfVUjuyrg"},
{"content":{"body":"But preserving case is very un-HTML-y isn't it?","m.mentions":{},"msgtype":"m.text"},"ts":1770378375385,"senderName":"foolip","senderId":"@foolip:matrix.org","id":"$Czf63yvIjMwSCBLognr1EOi8eE-nSsViaU-VFyKAB6A"},
{"content":{"body":"foolip: though https://html.spec.whatwg.org/#script-data-escaped-end-tag-name-state creates an end tag with arbitrary length and then throws it away","format":"org.matrix.custom.html","formatted_body":"<a href=\"https://matrix.to/#/@foolip:matrix.org\">foolip</a>: though https://html.spec.whatwg.org/#script-data-escaped-end-tag-name-state creates an end tag with arbitrary length and then throws it away","m.mentions":{"user_ids":["@foolip:matrix.org"]},"msgtype":"m.text"},"ts":1770378519614,"senderName":"zcorpan","senderId":"@zcorpan:mozilla.org","id":"$VJKuKp8xhGfbYYZVS0y8yAAxq_56mOrDTb0tlyEx0xQ"},
{"content":{"body":"Except implementations could have a state to check what's up after temporary buffer > \"script\".length","m.mentions":{},"msgtype":"m.text"},"ts":1770378591222,"senderName":"zcorpan","senderId":"@zcorpan:mozilla.org","id":"$bMQIjRJF-zEvfnwbZxE8p9NJwbqifVUzQQxIXx2Z93U"},
{"content":{"body":"Hmm, but it never says \"discard the token\" or something like, it just emit another token.","m.mentions":{},"msgtype":"m.text"},"ts":1770378608752,"senderName":"foolip","senderId":"@foolip:matrix.org","id":"$v_OBbWTb_qLCLBEn_V0ccHfqTNaEweRpMWAgEvQSGQg"},
{"content":{"body":"foolip: anything else","format":"org.matrix.custom.html","formatted_body":"<a href=\"https://matrix.to/#/@foolip:matrix.org\">foolip</a>: anything else","m.mentions":{"user_ids":["@foolip:matrix.org"]},"msgtype":"m.text"},"ts":1770378645167,"senderName":"zcorpan","senderId":"@zcorpan:mozilla.org","id":"$nXk1rg4WTUVojestfwlheIVMAyJZb8K66VTm9WVwTHA"},
{"content":{"body":"or > when temporary buffer != \"script\"","m.mentions":{},"msgtype":"m.text"},"ts":1770378669302,"senderName":"zcorpan","senderId":"@zcorpan:mozilla.org","id":"$sAgGuNlo57hV5ugls57CVHKM8mfevz9v6ecPEUjdtzk"},
{"content":{"body":"Right, but seemingly not explicitly saying that the current tag token is no longer current, right?","m.mentions":{},"msgtype":"m.text"},"ts":1770378738993,"senderName":"foolip","senderId":"@foolip:matrix.org","id":"$mpDyonaWazXmA3UBOXLYAaerVD7HTMjWhTiCnTy-RSE"},
{"content":{"body":"Maybe something else is guaranteed to say \"create a bla token\" before anything can get confused.","m.mentions":{},"msgtype":"m.text"},"ts":1770378765244,"senderName":"foolip","senderId":"@foolip:matrix.org","id":"$dK2xoohTX-aAbGW52c6RC14vhSDG071EE8fGmRNQ30g"},
{"content":{"body":"Right the end tag token is created but then nothing happens with it","m.mentions":{},"msgtype":"m.text"},"ts":1770378809100,"senderName":"zcorpan","senderId":"@zcorpan:mozilla.org","id":"$SJ878TQupwNvAyvMiiFAIN3SWJWzSj6oD0TXGJBM_bY"},
{"content":{"body":"I see that in Blink, for this case, there's a special `buffered_end_tag_name_`, so the token is only created once we know what it's going to be.","format":"org.matrix.custom.html","formatted_body":"I see that in Blink, for this case, there's a special <code>buffered_end_tag_name_</code>, so the token is only created once we know what it's going to be.","m.mentions":{},"msgtype":"m.text"},"ts":1770378863660,"senderName":"foolip","senderId":"@foolip:matrix.org","id":"$9VzPMZ9W5FhBqkmfMWx9D0j6fLanJUgeVIgE9wFpjSo"},
{"content":{"body":"How much is ok to buffer? For compat with <?lit$ it's just 4 chars","m.mentions":{},"msgtype":"m.text"},"ts":1770379065726,"senderName":"zcorpan","senderId":"@zcorpan:mozilla.org","id":"$woXJw33mABPN4pIeHHpTdWlsSLtRsNjjSimT5jE-T8Q"},
{"content":{"body":"I checked and it looks like Blink's buffer can grow unbounded. (I expected to find a hardcoded max size that is impossible to exceed because of how it's used, but no.)","m.mentions":{},"msgtype":"m.text"},"ts":1770379123553,"senderName":"foolip","senderId":"@foolip:matrix.org","id":"$20oImy4wwHCjinSWo52UXCVGR8vOQ_G639CkVngBw0E"},
{"content":{"body":"Do you think there are important rules to follow here? Possible principles I've inferred include (1) only put things in the temp buffer to compare them, not to read them back (2) don't create a token unless it will be emitted (3) normalize casing in tokenization, not tree construction and (4) no unbounded buffering.","m.mentions":{},"msgtype":"m.text"},"ts":1770379139657,"senderName":"foolip","senderId":"@foolip:matrix.org","id":"$VJBMz1tHNKFzcr0MTVnxYpxEnWoW2JiAdVPt5g5SnKI"},
{"content":{"body":"I don't think all of these can be hard rules at the same time.","m.mentions":{},"msgtype":"m.text"},"ts":1770379181702,"senderName":"foolip","senderId":"@foolip:matrix.org","id":"$GELvCdcU-OvYAifnduXa1EWJ2vFrX_aaKiwh55J54RU"},
{"content":{"body":"The temporary buffer is sometimes emitted as characters","m.mentions":{},"msgtype":"m.text"},"ts":1770379194119,"senderName":"zcorpan","senderId":"@zcorpan:mozilla.org","id":"$WzX_ZmzFd7TLO586MSSiVNU9tE08J7oi2apEcWJ0BuU"},
{"content":{"body":"Yes, you're right, so taking it and sticking it into comment data feels OK, and what I did.","m.mentions":{},"msgtype":"m.text"},"ts":1770379269900,"senderName":"foolip","senderId":"@foolip:matrix.org","id":"$n8dfz6srXuASWxUdTyrynRh_fn0I1OhfY49M_zGIKyg"},
{"content":{"body":"Just that the wording is slightly different because for character tokens they are emitted one by one.","m.mentions":{},"msgtype":"m.text"},"ts":1770379297624,"senderName":"foolip","senderId":"@foolip:matrix.org","id":"$lRvB4veeaR3-rOEqcunBV61-dD8lNGaB5IRLzapcQi4"},
{"content":{"body":"We don't actually need unbounded buffering and lookahead, at most  `\"xml-stylesheet\".length + 1` is strictly required.","format":"org.matrix.custom.html","formatted_body":"We don't actually need unbounded buffering and lookahead, at most  <code>\"xml-stylesheet\".length + 1</code> is strictly required.","m.mentions":{},"msgtype":"m.text"},"ts":1770379360125,"senderName":"foolip","senderId":"@foolip:matrix.org","id":"$9V5hwE0uzvlESYXJ3adwbB2tMAIDnf6r2FAnOcJNlpE"},
{"content":{"body":"No wait, that's wrong. After the recent change there's also `<?superduperlong$not-a-pi?>`.","format":"org.matrix.custom.html","formatted_body":"No wait, that's wrong. After the recent change there's also <code>&lt;?superduperlong$not-a-pi?&gt;</code>.","m.mentions":{},"msgtype":"m.text"},"ts":1770379397138,"senderName":"foolip","senderId":"@foolip:matrix.org","id":"$TfAxwOhhcEyBsFMLR1_arSrdoKAr_79JtaT-DVo3ho0"},
{"content":{"body":"Right. But we could place some limit on how many characters to check","m.mentions":{},"msgtype":"m.text"},"ts":1770379492926,"senderName":"zcorpan","senderId":"@zcorpan:mozilla.org","id":"$J-dZdQ6waQXJRQnXseDBXJDsu59Ts60Qrbn32d6_epc"},
{"content":{"body":"And after that if you see a $ we make it part of the target instead?","m.mentions":{},"msgtype":"m.text"},"ts":1770379519400,"senderName":"foolip","senderId":"@foolip:matrix.org","id":"$Ri8Fs6iKNKcPnwl-Syvb31e4lUFu0aK7W661G2gBM48"},
{"content":{"body":"Yeah","m.mentions":{},"msgtype":"m.text"},"ts":1770379525060,"senderName":"zcorpan","senderId":"@zcorpan:mozilla.org","id":"$rwCi-_meg1fSXmYGXY7L54FAJze0xkEMY8MypXk3bNg"},
{"content":{"body":"The test cases are going to be fun at least :)","m.mentions":{},"msgtype":"m.text"},"ts":1770379547393,"senderName":"foolip","senderId":"@foolip:matrix.org","id":"$TdUfnAJF8li5bdiASWyIqA5dDDphOGu2fUPhOR7JpoA"},
{"content":{"body":"zcorpan: lit$ doesn't show up in httparchive, any idea how we can find out if there are more cases like it?","format":"org.matrix.custom.html","formatted_body":"<a href=\"https://matrix.to/#/@zcorpan:mozilla.org\">zcorpan</a>: lit$ doesn't show up in httparchive, any idea how we can find out if there are more cases like it?","m.mentions":{"user_ids":["@zcorpan:mozilla.org"]},"msgtype":"m.text"},"ts":1770379701402,"senderName":"foolip","senderId":"@foolip:matrix.org","id":"$gKX_2mK-3NU04Hd8W4BAsXuxD1PPHu_XaGia7lb3z38"},
{"content":{"body":"use counters?","m.mentions":{},"msgtype":"m.text"},"ts":1770379716861,"senderName":"foolip","senderId":"@foolip:matrix.org","id":"$23KKTrB9nDc8a7PZTg-K8C25r_WhIrzMFVgHa5Ms9xs"},
{"content":{"body":"foolip: My query didn't include PIs with $","format":"org.matrix.custom.html","formatted_body":"<a href=\"https://matrix.to/#/@foolip:matrix.org\">foolip</a>: My query didn't include PIs with $","m.mentions":{"user_ids":["@foolip:matrix.org"]},"msgtype":"m.text"},"ts":1770379749898,"senderName":"zcorpan","senderId":"@zcorpan:mozilla.org","id":"$4yocAWbKZ2Du8V3i0QL0FFSa20_FMFf5EO4p-NqiuJs"},
{"content":{"body":"Oh right, these are just the ones that would be valid PIs per our new stricter target names.","m.mentions":{},"msgtype":"m.text"},"ts":1770379782368,"senderName":"foolip","senderId":"@foolip:matrix.org","id":"$Cc1rFkgpA8JlhBA6GmXXzlDStmaQd6XwnaNRAoaqXuk"},
{"content":{"body":"Yes. Or https://docs.google.com/spreadsheets/d/1o04eP_BwH1u7X8CyyLUvxOsntZNmfrDalfhU7ldVqlU/edit?usp=sharing did (just required the first char to be a-z), but was only 1% of the data","m.mentions":{},"msgtype":"m.text"},"ts":1770379812126,"senderName":"zcorpan","senderId":"@zcorpan:mozilla.org","id":"$LaDA0JUgoir7QRyzBzgrJXBaL0YasfLs5CLBG0Mke6I"},
{"content":{"body":"Noam Rosenthal: you also have a spreadsheet right?","format":"org.matrix.custom.html","formatted_body":"<a href=\"https://matrix.to/#/@noamr:matrix.org\">Noam Rosenthal</a>: you also have a spreadsheet right?","m.mentions":{"user_ids":["@noamr:matrix.org"]},"msgtype":"m.text"},"ts":1770379859436,"senderName":"foolip","senderId":"@foolip:matrix.org","id":"$YIfuWpXkvKNYwYD2VogOF5Uz_TcL4jXfVDN-wAxWlYg"},
{"content":{"body":"> <@foolip:matrix.org> Noam Rosenthal: you also have a spreadsheet right?\n\nThis one looks more comprehensive but similar ","format":"org.matrix.custom.html","formatted_body":"<mx-reply><blockquote><a href=\"https://matrix.to/#/!AGetWbsMpFPdSgUrbs:matrix.org/$YIfuWpXkvKNYwYD2VogOF5Uz_TcL4jXfVDN-wAxWlYg?via=matrix.org&via=mozilla.org&via=igalia.com\">In reply to</a> <a href=\"https://matrix.to/#/@foolip:matrix.org\">@foolip:matrix.org</a><br /><a href=\"https://matrix.to/#/@noamr:matrix.org\">Noam Rosenthal</a>: you also have a spreadsheet right?</blockquote></mx-reply>This one looks more comprehensive but similar","m.relates_to":{"m.in_reply_to":{"event_id":"$YIfuWpXkvKNYwYD2VogOF5Uz_TcL4jXfVDN-wAxWlYg"}},"msgtype":"m.text"},"ts":1770379941164,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$GkbgQ4n4QepnwGhVmL3S1bdHB_bFeL9w6LAw_p-vrRY"},
{"content":{"body":"foolip: checking https://github.com/search?q=%2F%3C%5C%3F%5Ba-zA-Z%5D%2F+language%3Ahtml+NOT+%22%3C%3Fphp%22+NOT+%22%3C%3Fxml%22&type=code it looks like sometimes end tags are typoed as e.g. `<?a>`","format":"org.matrix.custom.html","formatted_body":"<a href=\"https://matrix.to/#/@foolip:matrix.org\">foolip</a>: checking https://github.com/search?q=%2F%3C%5C%3F%5Ba-zA-Z%5D%2F+language%3Ahtml+NOT+%22%3C%3Fphp%22+NOT+%22%3C%3Fxml%22&amp;type=code it looks like sometimes end tags are typoed as e.g. <code>&lt;?a&gt;</code>","m.mentions":{"user_ids":["@foolip:matrix.org"]},"msgtype":"m.text"},"ts":1770380185753,"senderName":"zcorpan","senderId":"@zcorpan:mozilla.org","id":"$7hy0hmpRIYEnV-oNKoXlREOl7jZdzJrU2XGCRDXwVrY"},
{"content":{"body":"So the concrete options I see are (1) preserve case in PI target (2) buffer both original + lowercased data until we know if it will be a PI or comment (3) buffer only original and then lowercase it when creating the PI token  (4) initially create a comment token and replace it with a PI token when we have a valid target.","m.mentions":{},"msgtype":"m.text"},"ts":1770380344214,"senderName":"foolip","senderId":"@foolip:matrix.org","id":"$Mjr2bhx1m38tGV0rC4I3WsrxzsFZNgrZMgJO4_JAu2g"},
{"content":{"body":"I think 2-4 are equivalent, mostly a matter of what fits best with existing patterns.","m.mentions":{},"msgtype":"m.text"},"ts":1770380392012,"senderName":"foolip","senderId":"@foolip:matrix.org","id":"$vOGzRBI6ZlQm5Y8QK_qZ9l6QiAQ3a3VZ9QbNdJWN8y4"},
{"content":{"body":"hsivonen: do you have an opinion? ^","format":"org.matrix.custom.html","formatted_body":"<a href=\"https://matrix.to/#/@hsivonen:mozilla.org\">hsivonen</a>: do you have an opinion? ^","m.mentions":{"user_ids":["@hsivonen:mozilla.org"]},"msgtype":"m.text"},"ts":1770380484195,"senderName":"zcorpan","senderId":"@zcorpan:mozilla.org","id":"$mLv068XAdQLV3T4SOrfo_itQvbGOfhIQ78kPEi0yq0Q"},
{"content":{"body":"Oh, and (5) fixed length buffering or lookahead, so that the rules change after N characters are consumed as target.","m.mentions":{},"msgtype":"m.text"},"ts":1770380499787,"senderName":"foolip","senderId":"@foolip:matrix.org","id":"$2xwJNMdT5p2U-i7dU71Q2S92LYkrIdw_5iY9bp0iTwg"},
{"content":{"body":"Is the only downside of preserving case inconsistency with the rest of HTML?","m.mentions":{},"msgtype":"m.text"},"ts":1770382602503,"senderName":"hsivonen","senderId":"@hsivonen:mozilla.org","id":"$2ZpurkwNmaXCK2qDFGpkC3oLeMy12LgRFF1AAc0HLIw"}
]
[
{"content":{"body":"cries a little bit. Yet [another](https://html.spec.whatwg.org/#:~:text=Prepare%20to%20run%20script%20given%20document%27s%20relevant%20settings%20object%2E) \"let's break how microtasks work\" special case.","format":"org.matrix.custom.html","formatted_body":"cries a little bit. Yet <a href=\"https://html.spec.whatwg.org/#:~:text=Prepare%20to%20run%20script%20given%20document%27s%20relevant%20settings%20object%2E\">another</a> \"let's break how microtasks work\" special case.","m.mentions":{},"msgtype":"m.emote"},"ts":1768220780232,"senderName":"smaug","senderId":"@smaug:mozilla.org","id":"$0EEuF0d1u8LxXTeC668iT_WwGTDL_gU4UaWqY0NNQq4"},
{"content":{"body":"* cries a little bit. Yet [another](https://html.spec.whatwg.org/#:~:text=Prepare%20to%20run%20script%20given%20document%27s%20relevant%20settings%20object%2E) \"let's break how microtasks work\" special case. (but maybe he did review that change? Hard to get back to the spec issue from the commit message)","format":"org.matrix.custom.html","formatted_body":"* cries a little bit. Yet <a href=\"https://html.spec.whatwg.org/#:~:text=Prepare%20to%20run%20script%20given%20document%27s%20relevant%20settings%20object%2E\">another</a> \"let's break how microtasks work\" special case. (but maybe he did review that change? Hard to get back to the spec issue from the commit message)","m.mentions":{},"m.new_content":{"body":"cries a little bit. Yet [another](https://html.spec.whatwg.org/#:~:text=Prepare%20to%20run%20script%20given%20document%27s%20relevant%20settings%20object%2E) \"let's break how microtasks work\" special case. (but maybe he did review that change? Hard to get back to the spec issue from the commit message)","format":"org.matrix.custom.html","formatted_body":"cries a little bit. Yet <a href=\"https://html.spec.whatwg.org/#:~:text=Prepare%20to%20run%20script%20given%20document%27s%20relevant%20settings%20object%2E\">another</a> \"let's break how microtasks work\" special case. (but maybe he did review that change? Hard to get back to the spec issue from the commit message)","m.mentions":{},"msgtype":"m.emote"},"m.relates_to":{"event_id":"$0EEuF0d1u8LxXTeC668iT_WwGTDL_gU4UaWqY0NNQq4","rel_type":"m.replace"},"msgtype":"m.emote"},"ts":1768220815106,"senderName":"smaug","senderId":"@smaug:mozilla.org","id":"$BeMuNU8qJgm7kmYgIxgmvezaApPIgMsABRaFRL5Opxs"},
{"content":{"body":"This was me and it was thoroughly reviewed.","m.mentions":{"user_ids":["@smaug:mozilla.org"]},"m.relates_to":{"m.in_reply_to":{"event_id":"$0EEuF0d1u8LxXTeC668iT_WwGTDL_gU4UaWqY0NNQq4"}},"msgtype":"m.text"},"ts":1768221008989,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$GtMtx6B3YBIdbYZm1Fi9_eK30AfG0gJ6MV7Cyet8HyI"},
{"content":{"body":"https://github.com/whatwg/html/pull/10284","m.mentions":{},"msgtype":"m.text"},"ts":1768221062908,"senderName":"Ms2ger","senderId":"@ms2ger:igalia.com","id":"$mXJ3JI0zo8Mt3ClJmuJInGkeeE3xECjxI2bUsSxYvNs"},
{"content":{"body":"Yea I think we had the discussion about this with Domenic elsewhere... ","m.mentions":{},"msgtype":"m.text"},"ts":1768221160271,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$hnKkt8IewVc6N-5671m85Ux5c963jg-bgSs93-0ck04"},
{"content":{"body":"Looks like google only patch and review","m.mentions":{},"msgtype":"m.text"},"ts":1768221193781,"senderName":"smaug","senderId":"@smaug:mozilla.org","id":"$N1sWFi_vnvwoAW0XklDmcfoQRkrpBH5Pddka0xzAGqE"},
{"content":{"body":"the problem with microtasks in the rendering loop is that they might be postponed until the end of the rendering task and that's a no-man's land","m.mentions":{},"msgtype":"m.text"},"ts":1768221201567,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$zKmrgAoUIaAHoZfgl8My3Qd0NpDf_WwQugBSA604WQA"},
{"content":{"body":"Oh, I do understand how microtasks work and what their limitations are ðŸ˜› ","m.mentions":{},"msgtype":"m.text"},"ts":1768221234786,"senderName":"smaug","senderId":"@smaug:mozilla.org","id":"$mhUwqCEmCBCt_mESaiaJfvbirKLZ7TgDzNCmOm1vFqs"},
{"content":{"body":"but it is getting really hard to explain how microtasks work given the special cases. Navigation API has similar weird special case","m.mentions":{},"msgtype":"m.text"},"ts":1768221278442,"senderName":"smaug","senderId":"@smaug:mozilla.org","id":"$YJR2uxAzkH_aiJ8aDDJHw6fRqLdJC5wKxWTgw0bOOcI"},
{"content":{"body":"yea agreed, there are a few of those","m.mentions":{},"msgtype":"m.text"},"ts":1768221294270,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$vOLncPPS7qVzJk4kc9eN_V8LivAnQgL-rXGYUWbiuzQ"},
{"content":{"body":"but really I think those special cases can be counted on one hand","m.mentions":{},"msgtype":"m.text"},"ts":1768221303730,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$SCrV1pwNnMEXTi0IJaiUJEV_BcWgnwkJysMNU6G12hY"},
{"content":{"body":"so we have enough to start a Quirks spec for microtasks","m.mentions":{"user_ids":["@noamr:matrix.org"]},"m.relates_to":{"m.in_reply_to":{"event_id":"$SCrV1pwNnMEXTi0IJaiUJEV_BcWgnwkJysMNU6G12hY"}},"msgtype":"m.text"},"ts":1768221386901,"senderName":"sideshowbarker","senderId":"@sideshowbarker:matrix.org","id":"$OKDi_xZSXCwmqKM6vKOOxytd4Qi8NexNxGGPlV0TxAk"},
{"content":{"body":"I suggested before to have something like an isolated promise resolver algorithm that does this... it's probably easier to explain then wrapping each of these separately","m.mentions":{},"msgtype":"m.text"},"ts":1768221389678,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$N3ESMZ9Swzdzt7i2D5Y_TFA4lTAKUiMC79_NSFdgRPo"},
{"content":{"body":"Does it need to be an AI-generated hand? ðŸ˜‡","m.mentions":{},"msgtype":"m.text"},"ts":1768221397408,"senderName":"Ms2ger","senderId":"@ms2ger:igalia.com","id":"$Pu4A_SfJXG05IhsgU_WSZXB75tB0vra4Xv4hyeyaBwA"},
{"content":{"body":"The quirky things about microtasks is when they need to fire before of other things in the same task... then you need to wrap them with this prepare/cleanup thingy. I think the right way to explain it is to have some sort of isolated wrapper for this but it wouldn't look much different from those prepare/cleanup pairs\n\nThe latter one is really confusing \n","m.mentions":{},"msgtype":"m.text"},"ts":1768221610273,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$BsUIVDNipOAHu3CduLOn1sJ-_fAprTf2kY9x4AtFrgE"},
{"content":{"body":"* The quirky things about microtasks is when they need to fire before of other things in the same task... then you need to wrap them with this prepare/cleanup thingy. I think the right way to explain it is to have some sort of isolated wrapper for this but it wouldn't look much different from those prepare/cleanup pairs\n","m.mentions":{},"m.new_content":{"body":"The quirky things about microtasks is when they need to fire before of other things in the same task... then you need to wrap them with this prepare/cleanup thingy. I think the right way to explain it is to have some sort of isolated wrapper for this but it wouldn't look much different from those prepare/cleanup pairs\n","m.mentions":{},"msgtype":"m.text"},"m.relates_to":{"event_id":"$BsUIVDNipOAHu3CduLOn1sJ-_fAprTf2kY9x4AtFrgE","rel_type":"m.replace"},"msgtype":"m.text"},"ts":1768221617104,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$CBMEtLsdj6MTVAx0VKR1xW_v33y8SAmBXuEbCN93CDQ"},
{"content":{"body":"* The quirky things about microtasks is when they need to fire before other things in the same task... then you need to wrap them with this prepare/cleanup thingy. I think the right way to explain it is to have some sort of isolated wrapper for this but it wouldn't look much different from those prepare/cleanup pairs\n","m.mentions":{},"m.new_content":{"body":"The quirky things about microtasks is when they need to fire before other things in the same task... then you need to wrap them with this prepare/cleanup thingy. I think the right way to explain it is to have some sort of isolated wrapper for this but it wouldn't look much different from those prepare/cleanup pairs\n","m.mentions":{},"msgtype":"m.text"},"m.relates_to":{"event_id":"$BsUIVDNipOAHu3CduLOn1sJ-_fAprTf2kY9x4AtFrgE","rel_type":"m.replace"},"msgtype":"m.text"},"ts":1768221655264,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$MPfOXR0LnmZ61YZ8SilnjGLJR8caGUklWWFrsQeFXSA"},
{"content":{"body":"(though so far this sounds like more like a group rant than an attempt to fix things, so perhaps I'd leave it to that)","m.mentions":{},"msgtype":"m.text"},"ts":1768221709181,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$gXTLyoxVX5J3dpNvmGzGV9xXFd8To4dIpr-c13BZmZ8"}
]
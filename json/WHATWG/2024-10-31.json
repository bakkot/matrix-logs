[
{"content":{"body":"Good evening. Can anyone give some examples of opaque path? The URL spec is stingy on this.","m.mentions":{},"msgtype":"m.text"},"ts":1730363855709,"senderName":"Maxim Vaarwel","senderId":"@dmaxim:matrix.org","id":"$ZnVRr6O5scwMbId61lj3AooAiSU4KXHDom3JsxnhsRs"},
{"content":{"body":" * Good evening. Can anyone give some examples of [opaque path](https://url.spec.whatwg.org/#url-opaque-path)? The URL spec is stingy on this.","format":"org.matrix.custom.html","formatted_body":" * Good evening. Can anyone give some examples of <a href=\"https://url.spec.whatwg.org/#url-opaque-path\">opaque path</a>? The URL spec is stingy on this.","m.mentions":{},"m.new_content":{"body":"Good evening. Can anyone give some examples of [opaque path](https://url.spec.whatwg.org/#url-opaque-path)? The URL spec is stingy on this.","format":"org.matrix.custom.html","formatted_body":"Good evening. Can anyone give some examples of <a href=\"https://url.spec.whatwg.org/#url-opaque-path\">opaque path</a>? The URL spec is stingy on this.","m.mentions":{},"msgtype":"m.text"},"m.relates_to":{"event_id":"$ZnVRr6O5scwMbId61lj3AooAiSU4KXHDom3JsxnhsRs","rel_type":"m.replace"},"msgtype":"m.text"},"ts":1730363919950,"senderName":"Maxim Vaarwel","senderId":"@dmaxim:matrix.org","id":"$KnjXK7RgoF-fOfzLCyERxbCufX21ran2ApZ4mOyMf8E"},
{"content":{"body":"> <@dmaxim:matrix.org> Good evening. Can anyone give some examples of [opaque path](https://url.spec.whatwg.org/#url-opaque-path)? The URL spec is stingy on this.\n\nhttps://url.spec.whatwg.org/#example-url-components 3rd example","format":"org.matrix.custom.html","formatted_body":"<mx-reply><blockquote><a href=\"https://matrix.to/#/!AGetWbsMpFPdSgUrbs:matrix.org/$ZnVRr6O5scwMbId61lj3AooAiSU4KXHDom3JsxnhsRs?via=matrix.org&via=mozilla.org&via=igalia.com\">In reply to</a> <a href=\"https://matrix.to/#/@dmaxim:matrix.org\">@dmaxim:matrix.org</a><br>Good evening. Can anyone give some examples of <a href=\"https://url.spec.whatwg.org/#url-opaque-path\">opaque path</a>? The URL spec is stingy on this.</blockquote></mx-reply>https://url.spec.whatwg.org/#example-url-components 3rd example","m.mentions":{"user_ids":["@dmaxim:matrix.org"]},"m.relates_to":{"m.in_reply_to":{"event_id":"$ZnVRr6O5scwMbId61lj3AooAiSU4KXHDom3JsxnhsRs"}},"msgtype":"m.text"},"ts":1730363994889,"senderName":"Domenic","senderId":"@domenicdenicola:matrix.org","id":"$HTe_-goVao176aEHGWTEPxoQ_ETRJGkWJ3m43bFt3vM"},
{"content":{"body":"Thanks but, I have extra question.\n\nIs it possible to use the `new URL` constructor to create a url that will have opaque path in the first argument and base URL in the second?","format":"org.matrix.custom.html","formatted_body":"<p>Thanks but, I have extra question.</p>\n<p>Is it possible to use the <code>new URL</code> constructor to create a url that will have opaque path in the first argument and base URL in the second?</p>\n","m.mentions":{},"m.relates_to":{"event_id":"$HTe_-goVao176aEHGWTEPxoQ_ETRJGkWJ3m43bFt3vM","is_falling_back":true,"m.in_reply_to":{"event_id":"$HTe_-goVao176aEHGWTEPxoQ_ETRJGkWJ3m43bFt3vM"},"rel_type":"m.thread"},"msgtype":"m.text"},"ts":1730364237600,"senderName":"Maxim Vaarwel","senderId":"@dmaxim:matrix.org","id":"$cPR2L-4x0R92ffywZs6FGk9WEAXpLLAIhbZ9qnrYAt8"},
{"content":{"body":" * Thanks, but I have extra question.\n\nIs it possible to use the `new URL` constructor to create a url that will have opaque path in the first argument and base URL in the second?","format":"org.matrix.custom.html","formatted_body":" * <p>Thanks, but I have extra question.</p>\n<p>Is it possible to use the <code>new URL</code> constructor to create a url that will have opaque path in the first argument and base URL in the second?</p>\n","m.mentions":{"user_ids":["@domenicdenicola:matrix.org"]},"m.new_content":{"body":"Thanks, but I have extra question.\n\nIs it possible to use the `new URL` constructor to create a url that will have opaque path in the first argument and base URL in the second?","format":"org.matrix.custom.html","formatted_body":"<p>Thanks, but I have extra question.</p>\n<p>Is it possible to use the <code>new URL</code> constructor to create a url that will have opaque path in the first argument and base URL in the second?</p>\n","m.mentions":{"user_ids":["@domenicdenicola:matrix.org"]},"msgtype":"m.text"},"m.relates_to":{"event_id":"$cPR2L-4x0R92ffywZs6FGk9WEAXpLLAIhbZ9qnrYAt8","rel_type":"m.replace"},"msgtype":"m.text"},"ts":1730364252801,"senderName":"Maxim Vaarwel","senderId":"@dmaxim:matrix.org","id":"$ImRFSUisX4--RszjHEv4DtM_QkVf4lC4x-RpJehv1jY"},
{"content":{"body":"Sure. `new URL(\"urn:isbn:9780307476463\", \"https://example.com/\")`.","format":"org.matrix.custom.html","formatted_body":"Sure. <code>new URL(\"urn:isbn:9780307476463\", \"https://example.com/\")</code>.","m.mentions":{},"m.relates_to":{"event_id":"$HTe_-goVao176aEHGWTEPxoQ_ETRJGkWJ3m43bFt3vM","is_falling_back":true,"m.in_reply_to":{"event_id":"$cPR2L-4x0R92ffywZs6FGk9WEAXpLLAIhbZ9qnrYAt8"},"rel_type":"m.thread"},"msgtype":"m.text"},"ts":1730364352141,"senderName":"Domenic","senderId":"@domenicdenicola:matrix.org","id":"$TMOE1l2p8ILjOn9Vs9dHmQhJeFIvU7jsVDMhkaU8UHY"},
{"content":{"body":"> <@domenicdenicola:matrix.org> Sure. `new URL(\"urn:isbn:9780307476463\", \"https://example.com/\")`.\n\nThe result of the URL structure is funny, there is nothing left from the base URL.\n\nIn any case, thank you very much for such a quick response.","format":"org.matrix.custom.html","formatted_body":"<mx-reply><blockquote><a href=\"https://matrix.to/#/!AGetWbsMpFPdSgUrbs:matrix.org/$TMOE1l2p8ILjOn9Vs9dHmQhJeFIvU7jsVDMhkaU8UHY?via=matrix.org&via=mozilla.org&via=igalia.com\">In reply to</a> <a href=\"https://matrix.to/#/@domenicdenicola:matrix.org\">@domenicdenicola:matrix.org</a><br>Sure. <code>new URL(\"urn:isbn:9780307476463\", \"https://example.com/\")</code>.</blockquote></mx-reply><p>The result of the URL structure is funny, there is nothing left from the base URL.</p>\n<p>In any case, thank you very much for such a quick response.</p>\n","m.mentions":{"user_ids":["@domenicdenicola:matrix.org"]},"m.relates_to":{"event_id":"$HTe_-goVao176aEHGWTEPxoQ_ETRJGkWJ3m43bFt3vM","is_falling_back":false,"m.in_reply_to":{"event_id":"$TMOE1l2p8ILjOn9Vs9dHmQhJeFIvU7jsVDMhkaU8UHY"},"rel_type":"m.thread"},"msgtype":"m.text"},"ts":1730364580037,"senderName":"Maxim Vaarwel","senderId":"@dmaxim:matrix.org","id":"$hbiNMsIwbVIKYgVRX1uSgPZvvYd7wBfaIBX2yhg9sx0"},
{"content":{"body":"> <@smaug:mozilla.org> (and just having consistency is good in general)\n\nPerhaps a cleaner take on this would be to wait to fire this event till the next focusing steps, which would be at the next frame (latest). That way we don't bombard with events during DOM ops","format":"org.matrix.custom.html","formatted_body":"<mx-reply><blockquote><a href=\"https://matrix.to/#/!AGetWbsMpFPdSgUrbs%3Amatrix.org/%24MY7xipEBVzAjFUgMZ15zLjr3Xcy9AusIxDSFV6-7u-w\">In reply to</a> <a href=\"https://matrix.to/#/@smaug:mozilla.org\">@smaug:mozilla.org</a><br>(and just having consistency is good in general)</blockquote></mx-reply>Perhaps a cleaner take on this would be to wait to fire this event till the next focusing steps, which would be at the next frame (latest). That way we don't bombard with events during DOM ops","m.relates_to":{"m.in_reply_to":{"event_id":"$MY7xipEBVzAjFUgMZ15zLjr3Xcy9AusIxDSFV6-7u-w"}},"msgtype":"m.text"},"ts":1730379634783,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$5CYU-OTk4ADK-Efbtr0AN5fHAR7IXgweNnH9qmbmwaU"},
{"content":{"body":"Basically we mark the element as \"moved while focused\" and in the next focusing steps we use this flag to determine whether the event needs to be fired.","format":"org.matrix.custom.html","formatted_body":"Basically we mark the element as &quot;moved while focused&quot; and in the next focusing steps we use this flag to determine whether the event needs to be fired.","msgtype":"m.text"},"ts":1730379721691,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$gYFul_2vWVJJdrHYEEnZS3P0xQxOcIpk405yTXbkV2s"},
{"content":{"body":"we don't even have to mark the element, just mark a boolean on the document and read it in the focus fixup","m.mentions":{},"msgtype":"m.text"},"ts":1730385095407,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$haILsnelFXnITcg4QxoNe4__W4VkIdPhOegpTB1CN3E"},
{"content":{"body":"Not sure which one is easier to understand. Firing asap would be easier to implement, I think (and would be closer to the model focus() has). keithamus might have an opinion. (I don't have a strong opinion)","format":"org.matrix.custom.html","formatted_body":"Not sure which one is easier to understand. Firing asap would be easier to implement, I think (and would be closer to the model focus() has). <a href=\"https://matrix.to/#/@keithamus:matrix.org\">keithamus</a> might have an opinion. (I don't have a strong opinion)","m.mentions":{"user_ids":["@keithamus:matrix.org"]},"msgtype":"m.text"},"ts":1730385110137,"senderName":"smaug","senderId":"@smaug:mozilla.org","id":"$CRQ9qRvPbd5DydRm4bBfsqZXVTM6jhDz4GOyFOX-quo"},
{"content":{"body":"I think both would be easy to implement, or at least spec... my worry was having a batch of DOM operations with `moveBefore` inside that end up firing lots of events","format":"org.matrix.custom.html","formatted_body":"I think both would be easy to implement, or at least spec... my worry was having a batch of DOM operations with <code>moveBefore</code> inside that end up firing lots of events","m.mentions":{},"msgtype":"m.text"},"ts":1730385155012,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$ccvt3zqZN6gB_dEhG2GyI6dXzO80x8bRpfQH5l4Abu0"},
{"content":{"body":"oh, you'd clear the boolean if some other focusing is happening?","m.mentions":{},"msgtype":"m.text"},"ts":1730385162032,"senderName":"smaug","senderId":"@smaug:mozilla.org","id":"$84XInTFcwe8ityz62L9mauzbRSx-0Xgt9ZxYthGiDy8"},
{"content":{"body":"yea","m.mentions":{},"msgtype":"m.text"},"ts":1730385166962,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$l28hrN1pF7FwTmwiM8esrVXNPXPH83hokw5TbzeCjAE"},
{"content":{"body":"well, if some other focusing is happening, the new element would get the focus and you'll get a blur","m.mentions":{},"msgtype":"m.text"},"ts":1730385185819,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$fKXKnUv1js3Ln-iA-JogGGrwKGxtHWour2gjZQJLtYQ"},
{"content":{"body":"Are there cases when you do want to know asap if activeElement has changed?","m.mentions":{},"msgtype":"m.text"},"ts":1730385213126,"senderName":"smaug","senderId":"@smaug:mozilla.org","id":"$uZklqhoCsXH4Ba-Z-IGPh9ySWzae_704xZPT3zBrT-o"},
{"content":{"body":"you can check `activeElement`","format":"org.matrix.custom.html","formatted_body":"you can check <code>activeElement</code>","m.mentions":{},"msgtype":"m.text"},"ts":1730385226997,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$AGuUclcLgZYFzGhLzDPUDO8DEROkoLo-94CUD2UeORk"},
{"content":{"body":"but you don't get any notification it being changed","m.mentions":{},"msgtype":"m.text"},"ts":1730385250452,"senderName":"smaug","senderId":"@smaug:mozilla.org","id":"$D9szsFdoh2ta6sGTgdmrvR-yD-6rJon7esFqTJoy2TI"},
{"content":{"body":"I think you can't really rely on this ASAP thing because focus fixup might change things","m.mentions":{},"msgtype":"m.text"},"ts":1730385251445,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$Ki01c8WHGRdd22LLwatz8znP34Kc2W0C9DQw7MVn-K8"},
{"content":{"body":"and one thing we reallly don't want to do is add forced style calculations","m.mentions":{},"msgtype":"m.text"},"ts":1730385286837,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$2VH43ZK6MiwkaFMsH843NJA0IBqKDrTVGsAkdWEruyk"},
{"content":{"body":"if you're in frameworks etc, you most likely are doing a batch of DOM operations and then the rendering step would come, you don't need multiple events during the batch","m.mentions":{},"msgtype":"m.text"},"ts":1730385353485,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$og3hTdZuh9G1fVS2lMfgo6XZMqNpu-z4eA-5F6jzWxM"},
{"content":{"body":"so I am pretty confident that \"eventually\" (as in, by the next frame or earlier) having your focus events catch up with your active element is good enough for people relying on these events. But happy to hear keithamus and others of course!","format":"org.matrix.custom.html","formatted_body":"so I am pretty confident that \"eventually\" (as in, by the next frame or earlier) having your focus events catch up with your active element is good enough for people relying on these events. But happy to hear <a href=\"https://matrix.to/#/@keithamus:matrix.org\">keithamus</a> and others of course!","m.mentions":{"user_ids":["@keithamus:matrix.org"]},"msgtype":"m.text"},"ts":1730385436388,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$ovNQArwb7uhEI0MqbWi_WqIXidreE1HlbuuhTNZnmQY"},
{"content":{"body":"So document.querySelectorAll(\":focus-within\") would temporarily be broken?","m.mentions":{},"msgtype":"m.text"},"ts":1730385546203,"senderName":"smaug","senderId":"@smaug:mozilla.org","id":"$bPFeoKbMvWgZMrNyJwOsGmx2c1qdnHvsgSFW9zMjsCw"},
{"content":{"body":"yea, but it's temporarily broken today in many cases","m.mentions":{},"msgtype":"m.text"},"ts":1730385566766,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$vi51SBx0Bq805mimUvoJiXRZo6fwe3_Nl-gENI7QQB8"},
{"content":{"body":"though we can move the `:focus-within` flag synchronously, it's kind of a separate question","format":"org.matrix.custom.html","formatted_body":"though we can move the <code>:focus-within</code> flag synchronously, it's kind of a separate question","m.mentions":{},"msgtype":"m.text"},"ts":1730385592920,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$8vXWAz5_ZiqGr4WOmAq4uh0fpYqRcKB4GE7sZEmd1GU"},
{"content":{"body":"true","m.mentions":{},"msgtype":"m.text"},"ts":1730385620135,"senderName":"smaug","senderId":"@smaug:mozilla.org","id":"$0sydm1EDJViu1nExYFzJmZgrfF39wPLxpS_N5lWQfO0"},
{"content":{"body":"would it be weird to get key events for subtree which hasn't ever gotten focus event? (That might be an issue already in the spec, I need to check in which case the focus stuff run around rendering update)","m.mentions":{},"msgtype":"m.text"},"ts":1730385974720,"senderName":"smaug","senderId":"@smaug:mozilla.org","id":"$XUi5eOog6b7PMiUaGHoZVYMtK0mGJ_x827iZumMtQUQ"},
{"content":{"body":" * would it be weird to get key events for subtree which hasn't ever gotten focus event? (That might be an issue already in the spec, I need to check in which case the focus stuff runs around rendering update)","m.mentions":{},"m.new_content":{"body":"would it be weird to get key events for subtree which hasn't ever gotten focus event? (That might be an issue already in the spec, I need to check in which case the focus stuff runs around rendering update)","m.mentions":{},"msgtype":"m.text"},"m.relates_to":{"event_id":"$XUi5eOog6b7PMiUaGHoZVYMtK0mGJ_x827iZumMtQUQ","rel_type":"m.replace"},"msgtype":"m.text"},"ts":1730385992899,"senderName":"smaug","senderId":"@smaug:mozilla.org","id":"$TtXOlwrjwgjZsSRHZaWV6E1QUfdqlyls1TfRRGVDe9Y"},
{"content":{"body":"I think you'd need a focus fixup before you can determine who gets the keys anyway","m.mentions":{},"msgtype":"m.text"},"ts":1730386337513,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$BnZs9LgbLw9M_HqBFH8M9d0S7zkqyvTDn0upTtYTEck"},
{"content":{"body":"it would be weird if an element got `display: none` due to a DOM change but you received key events before calculating its style","format":"org.matrix.custom.html","formatted_body":"it would be weird if an element got <code>display: none</code> due to a DOM change but you received key events before calculating its style","m.mentions":{},"msgtype":"m.text"},"ts":1730386373676,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$4-qizsaheHHOOTt-alsJ7-Wng4orhz6fc5rggkzvGrI"},
{"content":{"body":"the intermediate unfixed focus state is really only for javascript introspection","m.mentions":{},"msgtype":"m.text"},"ts":1730386451971,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$I4gJaEdBJ8p8G30_2vSiI_FWJH0nxZuk_7W6mGoH6Nk"},
{"content":{"body":"But that update doesn't need to happen during rendering update steps ","m.mentions":{},"msgtype":"m.text"},"ts":1730386467082,"senderName":"smaug","senderId":"@smaug:mozilla.org","id":"$KBL2ZzZAmD383HV4Nnj_jUyd9UMIOmeWKQ_4_-YCphs"},
{"content":{"body":"it can also happen due to calling `focus()`","format":"org.matrix.custom.html","formatted_body":"it can also happen due to calling <code>focus()</code>","m.mentions":{},"msgtype":"m.text"},"ts":1730386487187,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$T4bo_NbthyC8fyrMcCEmwsZF8ZsGNcANkV3Z_QR_VcY"},
{"content":{"body":"but that forces a style calculation and would trigger the focusing steps","m.mentions":{},"msgtype":"m.text"},"ts":1730386517619,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$favJNRAigUE3m_-grovVp3m-EL43-0tKlmktrAIUoJE"},
{"content":{"body":"browsers try to dispatch key events before rendering update (or I'm not sure about webkit's scheduling)","m.mentions":{},"msgtype":"m.text"},"ts":1730386518354,"senderName":"smaug","senderId":"@smaug:mozilla.org","id":"$vFzModQAJGKE5wgEHIZ49b3JWMGpJ14olGsYwGuLrFc"},
{"content":{"body":"so that would probably need a forced style calc and focus fixup like the one done inside update the rendering","m.mentions":{},"msgtype":"m.text"},"ts":1730386552911,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$7OepFKPeYb0qLmCFDLIjpsGPEuIHQGDunAtpH0P1xhE"},
{"content":{"body":"(we're not adding anything new to that)","m.mentions":{},"msgtype":"m.text"},"ts":1730386576809,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$ymOWD6jPWbeEJ07r09IsHm6jgEUkE4_Tln-LIdSZGoA"},
{"content":{"body":"and we'd dispatch focus at that point?","m.mentions":{},"msgtype":"m.text"},"ts":1730386581080,"senderName":"smaug","senderId":"@smaug:mozilla.org","id":"$sQ03l2x8pwNpoGRWX7C7PW5OmEpsnwmNP9BSQeVjCck"},
{"content":{"body":"yea","m.mentions":{},"msgtype":"m.text"},"ts":1730386586472,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$lvfyiF_6-5TtNpSOZPcjTX0-AjjBWCZ_1XZ6RVqyXSg"},
{"content":{"body":"that might work","m.mentions":{},"msgtype":"m.text"},"ts":1730386590555,"senderName":"smaug","senderId":"@smaug:mozilla.org","id":"$L2n3ixvggIMais1KaHrG8akTxaTqx0uUsWARwXg3hpI"},
{"content":{"body":"In HTML spec land, the change would be that when we run the focusing steps, if the target focus element is the current one and we haven't focused since moving the focused element, we first reset the current focused element to the viewport (as if that element was removed). This is simple enough and should cover all the weird cases I think","m.mentions":{},"msgtype":"m.text"},"ts":1730386808542,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$yPRh4_AcVC2PVqV2VnagxbUf9vHLW9LFGyGr6RoIy0w"},
{"content":{"body":"Firing the event some time later seems okay to me. I think practical cases might be for eg wanting to hide UI if focus moves out. That kind of UI change isn’t really impacted by even microtask timing IMO. But not firing at all might break it. ","format":"org.matrix.custom.html","formatted_body":"Firing the event some time later seems okay to me. I think practical cases might be for eg wanting to hide UI if focus moves out. That kind of UI change isn’t really impacted by even microtask timing IMO. But not firing at all might break it.","msgtype":"m.text"},"ts":1730388537726,"senderName":"keithamus","senderId":"@keithamus:matrix.org","id":"$5wNb_ZzWp7Zy-4iRSBg0L3weE726ourT-N9Zqv-xWJg"}
]
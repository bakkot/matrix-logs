[
{"content":{"body":"Thanks krosylight!","format":"org.matrix.custom.html","formatted_body":"Thanks <a href=\"https://matrix.to/#/@krosylight:mozilla.org\">krosylight</a>!","msgtype":"m.text"},"ts":1635920228422,"senderName":"annevk","senderId":"@annevk:mozilla.org","id":"$t3aKxy0YB13m2QdyCt92I9w81f7DG7ytTPTjxgKofKc"},
{"content":{"body":"denies everything","msgtype":"m.emote"},"ts":1635927043300,"senderName":"Ms2ger ðŸ’‰ðŸ’‰","senderId":"@ms2ger:igalia.com","id":"$wQO_8LRprpBAHw8AlfazPx8bX6AXn2F3z8t67dddsrM"},
{"content":{"body":"Jake Archibald: so one thing that strikes me is that there's no forwarding of cancelation to a fetch initiated by the service worker","format":"org.matrix.custom.html","formatted_body":"<a href=\"https://matrix.to/#/@jakea:matrix.org\">Jake Archibald</a>: so one thing that strikes me is that there's no forwarding of cancelation to a fetch initiated by the service worker","msgtype":"m.text"},"ts":1635932301859,"senderName":"annevk","senderId":"@annevk:mozilla.org","id":"$XQqDVdravzigUE7N-QOqC7vxSZV8ULIL7EOGxoHExTg"},
{"content":{"body":"annevk: in which direction? As in, which side is listening for the cancelation, and which side is cancelling?","format":"org.matrix.custom.html","formatted_body":"<a href=\"https://matrix.to/#/@annevk:mozilla.org\">annevk</a>: in which direction? As in, which side is listening for the cancelation, and which side is cancelling?","msgtype":"m.text"},"ts":1635932353135,"senderName":"Jake Archibald","senderId":"@jakea:matrix.org","id":"$NzmwADv5Fofm4wof-5zqI3bzP5EbR6_9cM-mMfWMnV8"},
{"content":{"body":"Jake Archibald: so if a document fetches A and the service worker fetches B and returns that, when exactly will it listen to aborting of A?","format":"org.matrix.custom.html","formatted_body":"<a href=\"https://matrix.to/#/@jakea:matrix.org\">Jake Archibald</a>: so if a document fetches A and the service worker fetches B and returns that, when exactly will it listen to aborting of A?","msgtype":"m.text"},"ts":1635932358664,"senderName":"annevk","senderId":"@annevk:mozilla.org","id":"$eo0mI0M-vrKmfxdb7TXwAGhYLoBrsPQqzC5NcOeTnKE"},
{"content":{"body":"annevk: if the stream is cancelled, that part works right? For stuff that happens before that, I thought `fetchEvent.request.signal` could be used as an indicator","format":"org.matrix.custom.html","formatted_body":"<a href=\"https://matrix.to/#/@annevk:mozilla.org\">annevk</a>: if the stream is cancelled, that part works right? For stuff that happens before that, I thought <code>fetchEvent.request.signal</code> could be used as an indicator","msgtype":"m.text"},"ts":1635932431063,"senderName":"Jake Archibald","senderId":"@jakea:matrix.org","id":"$ebP2mk6qZxjRqo7hcgoTAUmzFApccEn2tSDCVy4GMFo"},
{"content":{"body":"I guess only if it reuses the Request object in some manner, although I'm not sure how well that is defined","msgtype":"m.text"},"ts":1635932439155,"senderName":"annevk","senderId":"@annevk:mozilla.org","id":"$-5Ja7_BFpzW7rttcjLJTbRMTJjRGmny_FutviH8D40I"},
{"content":{"body":"I think it there might be some race issues, but canceling the stream probably works, yeah","msgtype":"m.text"},"ts":1635932480635,"senderName":"annevk","senderId":"@annevk:mozilla.org","id":"$2Q1UHYkAt9H4sGOK2se7P8TdY4twy9l9HYfhQ87tBP4"},
{"content":{"body":"Noam Rosenthal: I think one thing that might influence the design of the interaction with service workers is what we want to do with timing","format":"org.matrix.custom.html","formatted_body":"<a href=\"https://matrix.to/#/@noamr:matrix.org\">Noam Rosenthal</a>: I think one thing that might influence the design of the interaction with service workers is what we want to do with timing","msgtype":"m.text"},"ts":1635932580692,"senderName":"annevk","senderId":"@annevk:mozilla.org","id":"$iJS9tbw9O3ke_pQVkKQStc1XIuK7FN0g4rL1gPWgNUY"},
{"content":{"body":"Noam Rosenthal: I'm not entirely sure what information needs to be exchanged","format":"org.matrix.custom.html","formatted_body":"<a href=\"https://matrix.to/#/@noamr:matrix.org\">Noam Rosenthal</a>: I'm not entirely sure what information needs to be exchanged","msgtype":"m.text"},"ts":1635932595579,"senderName":"annevk","senderId":"@annevk:mozilla.org","id":"$af5k9Y8OQFEFRoLvG8ICBuEmVdiR2xFHu5m-Ib0SX-8"},
{"content":{"body":"Noam Rosenthal: if that information would ideally be on a \"service worker fetch event controller\", I guess that's what we should add","format":"org.matrix.custom.html","formatted_body":"<a href=\"https://matrix.to/#/@noamr:matrix.org\">Noam Rosenthal</a>: if that information would ideally be on a &quot;service worker fetch event controller&quot;, I guess that's what we should add","msgtype":"m.text"},"ts":1635932622879,"senderName":"annevk","senderId":"@annevk:mozilla.org","id":"$MyboZwqhxmFPjO1-5hepZFB6tH4su2aL6LYmbV_R5hM"},
{"content":{"body":"Noam Rosenthal: as per your suggestion, and fetch would forward an abort to that controller","format":"org.matrix.custom.html","formatted_body":"<a href=\"https://matrix.to/#/@noamr:matrix.org\">Noam Rosenthal</a>: as per your suggestion, and fetch would forward an abort to that controller","msgtype":"m.text"},"ts":1635932655284,"senderName":"annevk","senderId":"@annevk:mozilla.org","id":"$0gxp2QUu21X5eOKWVk5smjMrndmB-ina6Lgrlp4oXIo"},
{"content":{"body":"(It's a little weird that in JavaScript the cancelation is managed by AbortSignal on the Request, but that doesn't encompass all types of aborting that might happen, so maybe this is okay.)","msgtype":"m.text"},"ts":1635932735322,"senderName":"annevk","senderId":"@annevk:mozilla.org","id":"$NA4OzEDFL_RcRqDviko46BbS99OYrs6SReo3SL9l-as"},
{"content":{"body":"annevk: regarding timing, going forward there shouldn't be interaction. It's part of why I want to make things more explicit there","format":"org.matrix.custom.html","formatted_body":"<a href=\"https://matrix.to/#/@annevk:mozilla.org\">annevk</a>: regarding timing, going forward there shouldn't be interaction. It's part of why I want to make things more explicit there","msgtype":"m.text"},"ts":1635933283751,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$tZay-qrpYA08G9e5muU2amREIy8TJNqmfks-Fr803rE"},
{"content":{"body":"*only* a fetch would keep its timing info and report it. later of course we can add more things to the controller.","format":"org.matrix.custom.html","formatted_body":"<em>only</em> a fetch would keep its timing info and report it. later of course we can add more things to the controller.","msgtype":"m.text"},"ts":1635933331035,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$I9xFyLvUQRMzkwuZweCR5Gt_AlRxn3k1WkkvlOSEJKc"},
{"content":{"body":"(the service worker timing is only relevant to navigation timing, and in that case the timing is not part of a fetch but is queried directly from the service worker)","msgtype":"m.text"},"ts":1635933365175,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$ROLzwVPkxoOzm724xji00HzlY6DF0yDmKpDCymxSOTI"},
{"content":{"body":"Noam Rosenthal: oh, I thought we also needed to expose Cache API timing and things like that","format":"org.matrix.custom.html","formatted_body":"<a href=\"https://matrix.to/#/@noamr:matrix.org\">Noam Rosenthal</a>: oh, I thought we also needed to expose Cache API timing and things like that","msgtype":"m.text"},"ts":1635933413769,"senderName":"annevk","senderId":"@annevk:mozilla.org","id":"$eKSSC6oXfArNrDKagXM1d_xJJZuxh0vjoYJX-pUAT8Y"},
{"content":{"body":"for the fetch, we need to expose \"finalize and report timing info\"","msgtype":"m.text"},"ts":1635933444295,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$TA07XOjoUFjtw6zc2g-GwxD6Dnv4fSsboKTCy5Z90ug"},
{"content":{"body":"cache state can be read from the response","msgtype":"m.text"},"ts":1635933461914,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$dm6PuwvGDDLQVrC6RnGEpLWNv4YlgMe-YSy_sZ5YyBw"},
{"content":{"body":"there's nothing new we need to expose from service worker","msgtype":"m.text"},"ts":1635933470498,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$V8fm3M650PrGn2chDBokHHHE2D7d7mev9yGo_VTCfgk"},
{"content":{"body":"Noam Rosenthal: so that means that if there is service worker the timing information ends up being mostly opaque, right?","format":"org.matrix.custom.html","formatted_body":"<a href=\"https://matrix.to/#/@noamr:matrix.org\">Noam Rosenthal</a>: so that means that if there is service worker the timing information ends up being mostly opaque, right?","msgtype":"m.text"},"ts":1635933505469,"senderName":"annevk","senderId":"@annevk:mozilla.org","id":"$Jiz7qsrDIIsMfe_BNEwb3GQuelkSu3JnmE4-wGuY53M"},
{"content":{"body":"it's reported inside the service worker","msgtype":"m.text"},"ts":1635933516158,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$k8BY-A-prELwFh6ysEr-le8cZJprNDsoOwdipCdo02A"},
{"content":{"body":"so you can do `performance.getEntries` from within service worker code etc","format":"org.matrix.custom.html","formatted_body":"so you can do <code>performance.getEntries</code> from within service worker code etc","msgtype":"m.text"},"ts":1635933527799,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$2U8ucxaclmO2VXlaKoF94v2GFYgQsbHBrGWSYPG063Q"},
{"content":{"body":"but it's opaque to the caller fetch","msgtype":"m.text"},"ts":1635933539441,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$nfxsJp1JdvYoJRDnatdzH82jKhv_q2Wty08e21aTARM"},
{"content":{"body":"it felt like exposing that information twice mainly creates ambiguities","msgtype":"m.text"},"ts":1635933582087,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$-kNjUQR_QJYCPo20O8DPdjKMRmrT4VlpXkGO-x4xKag"},
{"content":{"body":"... that's why I didn't want that information on `response` which is a strange object that gets passed around and stored","format":"org.matrix.custom.html","formatted_body":"... that's why I didn't want that information on <code>response</code> which is a strange object that gets passed around and stored","msgtype":"m.text"},"ts":1635933627043,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$Vtu_VXKvDqIFmpiK3V1FD--6La7jUnSpeiN5KlQJhqQ"},
{"content":{"body":"thanks, sgtm","msgtype":"m.text"},"ts":1635933643195,"senderName":"annevk","senderId":"@annevk:mozilla.org","id":"$muLwyKGQSP5oFKiTVh7zpu0wElwKwCzObZYU_l5vCPI"},
{"content":{"body":"I added a very brief summary of our options for service workers to your PR","msgtype":"m.text"},"ts":1635933670671,"senderName":"annevk","senderId":"@annevk:mozilla.org","id":"$EDkAynfq5_ycBm4wp0uJI6YgH29akJbMwDCkB1ElT2M"},
{"content":{"body":"what's \"UB territory\"? :)","msgtype":"m.text"},"ts":1635933985627,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$CKNIk3SkyldjHua-9ivs7yYIr2WYXdH_YEwuTqL_cac"},
{"content":{"body":"UB being undefined behavior","msgtype":"m.text"},"ts":1635934401062,"senderName":"annevk","senderId":"@annevk:mozilla.org","id":"$KZ7LoH0POtbSmHDWsj7IQosCq7e8wQmOE3JsFK32NgM"},
{"content":{"body":"AH, TIL","msgtype":"m.text"},"ts":1635934424023,"senderName":"Noam Rosenthal","senderId":"@noamr:matrix.org","id":"$8Kd_Al0BbNGyw2PGwT46Oos3t1pHR62Pi_F01cKq8x0"},
{"content":{"body":"Luca Casonato: fwiw, the cookie thing is blocked on getting someone from Chrome or Safari to chime in; hopefully it's clear from the prose and tests that it's not a whole lot of additional work","format":"org.matrix.custom.html","formatted_body":"<a href=\"https://matrix.to/#/@lucacasonato:matrix.org\">Luca Casonato</a>: fwiw, the cookie thing is blocked on getting someone from Chrome or Safari to chime in; hopefully it's clear from the prose and tests that it's not a whole lot of additional work","msgtype":"m.text"},"ts":1635948292330,"senderName":"annevk","senderId":"@annevk:mozilla.org","id":"$5_KOJmr_KOl5wZFpArSKMiCV49C8uyX-MDbbSmaClQg"},
{"content":{"body":"Luca Casonato: I have a couple more nits on the PR, but might as well wait until we have the higher-level checkboxes done","format":"org.matrix.custom.html","formatted_body":"<a href=\"https://matrix.to/#/@lucacasonato:matrix.org\">Luca Casonato</a>: I have a couple more nits on the PR, but might as well wait until we have the higher-level checkboxes done","msgtype":"m.text"},"ts":1635948345776,"senderName":"annevk","senderId":"@annevk:mozilla.org","id":"$bU83_PWwDgMwNV5Iikt9RjhZMRUDLhC3Pnjvtou0uJQ"},
{"content":{"body":"(And I'm also willing to push a fixup for that myself in due course)","msgtype":"m.text"},"ts":1635948374269,"senderName":"annevk","senderId":"@annevk:mozilla.org","id":"$r863FR4st1q10wH9bBlgLbVTPKqzFqQNtlPMgk7wCvg"}
]
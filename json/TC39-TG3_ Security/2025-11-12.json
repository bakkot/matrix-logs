[
{"content":{"body":"i would not ever want the original data to be cleared","m.mentions":{},"msgtype":"m.text"},"ts":1762913526454,"senderName":"ljharb","senderId":"@ljharb:matrix.org","id":"$Mca2q2ZfYWyUi7h1T1Fzv2J3dh-ot3qJ1E6nczHqvhY"},
{"content":{"body":"the original accessor must always be able to expose the immutable internal slot","m.mentions":{},"msgtype":"m.text"},"ts":1762913537096,"senderName":"ljharb","senderId":"@ljharb:matrix.org","id":"$kGoXM9X5SOfTUmJUL1ov_EnhkcJoLubzZa0u31yT1f4"},
{"content":{"body":"I see the stack being a getter mostly as an explicit optimization for lazily processing stack info when needed. As such I'm not super concerned with the fact that overriding the stack would explicitly disable that lazy mechanism, but I honestly don't have a strong opinion either way at this point. ","msgtype":"m.text"},"ts":1762913842520,"senderName":"Mathieu Hofman","senderId":"@mhofman:matrix.org","id":"$kHSU_w3Q7QCnvU75z5iN9QVNB5UtZ0UsquxFjAYPiHI"},
{"content":{"body":"Jacob Smith lmk if you’d like to cover deep difference of object graphs, by whatever name, at tomorrow’s meeting.","format":"org.matrix.custom.html","formatted_body":"<a href=\"https://matrix.to/#/@jakobjingleheimer:matrix.org\">Jacob Smith</a> lmk if you’d like to cover deep difference of object graphs, by whatever name, at tomorrow’s meeting.","m.mentions":{"user_ids":["@jakobjingleheimer:matrix.org"]},"msgtype":"m.text"},"ts":1762914761946,"senderName":"kriskowal","senderId":"@kriskowal:aelf.land","id":"$lGTlypZGQkzcO-cZeqbh_CyQPdPCgTtfndGIrPEH2tg"},
{"content":{"body":"I think we’ll otherwise open the floor to discuss proposals for next week’s plenary.","m.mentions":{},"msgtype":"m.text"},"ts":1762914774178,"senderName":"kriskowal","senderId":"@kriskowal:aelf.land","id":"$9S2AHL2EVw6r9pf4tHsWJVSpNquc7bQ6lpPHJIth-Vo"},
{"content":{"body":"Why though?","m.mentions":{"user_ids":["@ljharb:matrix.org"]},"m.relates_to":{"m.in_reply_to":{"event_id":"$kGoXM9X5SOfTUmJUL1ov_EnhkcJoLubzZa0u31yT1f4"}},"msgtype":"m.text"},"ts":1762936537601,"senderName":"Justin Ridgewell","senderId":"@jridgewell:matrix.org","id":"$h-GXpm62RzifPQUg_vqjtM4SbLsUWdKzAG7Ut6hVEvk"},
{"content":{"body":"Also, that is not what V8 is doing right now. Once you set the stack property we will collect that memory. I don't really know how important that is, but I did hear nightmare stories of big websites leaking their whole application state through error objects :) That is where my worries come from...","m.mentions":{},"msgtype":"m.text"},"ts":1762936722924,"senderName":"Olivier Flückiger","senderId":"@olivf.o1o.ch:immer.chat","id":"$pp7zBI4CmWSZjM4ukeI77ucnMQZtx_ZZ7qyvNAzBbTE"},
{"content":{"body":"So I guess my question is, what would be the argument against the setter also writing undefined into the internal slot should there be such a slot on the receiver...","m.mentions":{},"msgtype":"m.text"},"ts":1762937360140,"senderName":"Olivier Flückiger","senderId":"@olivf.o1o.ch:immer.chat","id":"$ScodTmn4iNjW0apikQwroohvQQgn7kDZx9AycQSrOuQ"},
{"content":{"body":"* So I guess my question is, what would be the argument against the setter also writing undefined (or whatever constant) into the internal slot should there be such a slot on the receiver...","m.mentions":{},"m.new_content":{"body":"So I guess my question is, what would be the argument against the setter also writing undefined (or whatever constant) into the internal slot should there be such a slot on the receiver...","m.mentions":{},"msgtype":"m.text"},"m.relates_to":{"event_id":"$ScodTmn4iNjW0apikQwroohvQQgn7kDZx9AycQSrOuQ","rel_type":"m.replace"},"msgtype":"m.text"},"ts":1762937502821,"senderName":"Olivier Flückiger","senderId":"@olivf.o1o.ch:immer.chat","id":"$e_f83bbAjyoGGtdRNmGWz8stT0mI5c45-KWwxcAaOKg"},
{"content":{"body":"I personally don't have any, as long as that happens only after successfully defining the own stack property. ","msgtype":"m.text"},"ts":1762937869295,"senderName":"Mathieu Hofman","senderId":"@mhofman:matrix.org","id":"$TOcnJU3skEPnamk_efT6na7WyLNUyFHaZUkUdXtmmUU"},
{"content":{"body":"* I personally don't have any, as long as that happens only after successfully defining the own stack property on the receiver . ","m.new_content":{"body":"I personally don't have any, as long as that happens only after successfully defining the own stack property on the receiver . ","msgtype":"m.text"},"m.relates_to":{"event_id":"$TOcnJU3skEPnamk_efT6na7WyLNUyFHaZUkUdXtmmUU","rel_type":"m.replace"},"msgtype":"m.text"},"ts":1762937887774,"senderName":"Mathieu Hofman","senderId":"@mhofman:matrix.org","id":"$tEVcQYtFXHkZzXWLKnf3YcqKmWxy6FDhe5sgVGxtsYA"},
{"content":{"body":"I think that would be fine.","msgtype":"m.text"},"ts":1762938229432,"senderName":"Justin Ridgewell","senderId":"@jridgewell:matrix.org","id":"$_kzs8OIumixGiZeRbYjr2EatO1bM0bXSFvymxIB8ZBM"},
{"content":{"body":"That makes sense to me.","m.mentions":{},"msgtype":"m.text"},"ts":1762953862022,"senderName":"dminor","senderId":"@dminor:mozilla.org","id":"$iliF2VFC3lYWlmcApP-m7eTGWSQWG23aTK9L81Xz4lY"},
{"content":{"body":"because that's how every internal slot works, for one. but also because the stack trace is the thing that makes it an error","m.mentions":{"user_ids":["@jridgewell:matrix.org"]},"m.relates_to":{"m.in_reply_to":{"event_id":"$h-GXpm62RzifPQUg_vqjtM4SbLsUWdKzAG7Ut6hVEvk"}},"msgtype":"m.text"},"ts":1762955099708,"senderName":"ljharb","senderId":"@ljharb:matrix.org","id":"$7xPa_fFGUoF43n7ei7yf5HQiZjr9L25ucDLh6c0t37E"},
{"content":{"body":"v8 is doing a bunch of stuff around error stacks right now that need fixing.","m.mentions":{"user_ids":["@olivf.o1o.ch:immer.chat"]},"m.relates_to":{"m.in_reply_to":{"event_id":"$pp7zBI4CmWSZjM4ukeI77ucnMQZtx_ZZ7qyvNAzBbTE"}},"msgtype":"m.text"},"ts":1762955110272,"senderName":"ljharb","senderId":"@ljharb:matrix.org","id":"$3t047YhMZRUTfIuCLE0mrtsp4zPWjy_QEOl0pXzp_LY"},
{"content":{"body":"\"The only specified use of [[ErrorData]] is [...] to identify Error\" https://tc39.es/ecma262/#sec-properties-of-error-instances","m.mentions":{"user_ids":["@ljharb:matrix.org"]},"m.relates_to":{"m.in_reply_to":{"event_id":"$7xPa_fFGUoF43n7ei7yf5HQiZjr9L25ucDLh6c0t37E"}},"msgtype":"m.text"},"ts":1762955181857,"senderName":"Olivier Flückiger","senderId":"@olivf.o1o.ch:immer.chat","id":"$jkIacFKhgnX1Zl2Fv4dhu_KXetXTo5mwCDLR5G_B9B8"},
{"content":{"body":"* v8 is doing a bunch of stuff around error stacks right now that need fixing. for example, the hidden intrinsic own accessor property on every error instance","m.mentions":{},"m.new_content":{"body":"v8 is doing a bunch of stuff around error stacks right now that need fixing. for example, the hidden intrinsic own accessor property on every error instance","m.mentions":{"user_ids":["@olivf.o1o.ch:immer.chat"]},"msgtype":"m.text"},"m.relates_to":{"event_id":"$3t047YhMZRUTfIuCLE0mrtsp4zPWjy_QEOl0pXzp_LY","rel_type":"m.replace"},"msgtype":"m.text"},"ts":1762955184429,"senderName":"ljharb","senderId":"@ljharb:matrix.org","id":"$PzIl4SUcBIrhxxq_lF1igTxD_shBzA-JZIK8SoZaycs"},
{"content":{"body":"i'm not talking about the spec, which doesn't discuss stacks at all right now - but about actual semantics in practice","m.mentions":{},"msgtype":"m.text"},"ts":1762955207616,"senderName":"ljharb","senderId":"@ljharb:matrix.org","id":"$_m1EuxHa1ulD-86XdcRj1hJhJR3prDIruE1QlsUw6aA"},
{"content":{"body":"`new Error()` is the only way to get a stack trace","format":"org.matrix.custom.html","formatted_body":"<code>new Error()</code> is the only way to get a stack trace","m.mentions":{},"msgtype":"m.text"},"ts":1762955212800,"senderName":"ljharb","senderId":"@ljharb:matrix.org","id":"$F1-1pOPzY1JgWcNygSn50GERnYZznb6UfE5rHrcDtfc"},
{"content":{"body":"So currently in Ecma262 errors do not have a stack trace. Many engines will give you one. And at least two engines will allow you to remove it again...","m.mentions":{},"msgtype":"m.text"},"ts":1762955218764,"senderName":"Olivier Flückiger","senderId":"@olivf.o1o.ch:immer.chat","id":"$m5RlYvuvQMJaPCJtV1Hw1XKITsd-3-3GAZtGgJmN-os"},
{"content":{"body":"sure","m.mentions":{},"msgtype":"m.text"},"ts":1762955229687,"senderName":"ljharb","senderId":"@ljharb:matrix.org","id":"$h3LTmRuDEGiawGdceWKH7cj3jDT-Z5BzyoNBO7sD4J8"},
{"content":{"body":"which means there's no web compat angle forcing a direction, which means we should do the normal thing for the language.","m.mentions":{},"msgtype":"m.text"},"ts":1762955246680,"senderName":"ljharb","senderId":"@ljharb:matrix.org","id":"$JEyX0NdH6az92sLgv7E3Q7Wh-YIvPEzEa40Zpi361Vo"},
{"content":{"body":"and that's an immutable slot determined at instantiation time, with a prototype accessor to read it","m.mentions":{},"msgtype":"m.text"},"ts":1762955275083,"senderName":"ljharb","senderId":"@ljharb:matrix.org","id":"$d8g1kjjGtZUG0xen2BjBldjGUOI35wmcvmhXjaBUOXo"},
{"content":{"body":"the setter only exists in the proposal for web compatibility, otherwise there wouldn't be one","m.mentions":{},"msgtype":"m.text"},"ts":1762955285552,"senderName":"ljharb","senderId":"@ljharb:matrix.org","id":"$dFTsAs4mRRiReIRkonKH7tp_bQHjfZaYLpXVNNZbR0c"},
{"content":{"body":"Only this might turn out to be half-webcompatible. As in it behaves semantically like before, but pragmatically it might use up all your applications memory...","m.mentions":{},"msgtype":"m.text"},"ts":1762955412576,"senderName":"Olivier Flückiger","senderId":"@olivf.o1o.ch:immer.chat","id":"$Ga5h196hPWiSUEXWsYZpWns8DzSfCjz_SfDyNN-NY4o"},
{"content":{"body":"i would be very surprised if a string attached to an error object used up lots of memory - what long-running application is going to keep error instances around, but the *string* is the thing that uses too much memory?","format":"org.matrix.custom.html","formatted_body":"i would be very surprised if a string attached to an error object used up lots of memory - what long-running application is going to keep error instances around, but the <em>string</em> is the thing that uses too much memory?","m.mentions":{},"msgtype":"m.text"},"ts":1762955687956,"senderName":"ljharb","senderId":"@ljharb:matrix.org","id":"$5eBK9alTUZr4xU-F2wt7NOUIalhkT3-Rp3qp7-xMVxg"},
{"content":{"body":"* i would be very surprised if a string attached to an error object used up lots of memory - what long-running application is going to keep error instances around, but a _string_ is the thing that uses too much memory?","format":"org.matrix.custom.html","formatted_body":"* i would be very surprised if a string attached to an error object used up lots of memory - what long-running application is going to keep error instances around, but a <em>string</em> is the thing that uses too much memory?","m.mentions":{},"m.new_content":{"body":"i would be very surprised if a string attached to an error object used up lots of memory - what long-running application is going to keep error instances around, but a _string_ is the thing that uses too much memory?","format":"org.matrix.custom.html","formatted_body":"i would be very surprised if a string attached to an error object used up lots of memory - what long-running application is going to keep error instances around, but a <em>string</em> is the thing that uses too much memory?","m.mentions":{},"msgtype":"m.text"},"m.relates_to":{"event_id":"$5eBK9alTUZr4xU-F2wt7NOUIalhkT3-Rp3qp7-xMVxg","rel_type":"m.replace"},"msgtype":"m.text"},"ts":1762955697136,"senderName":"ljharb","senderId":"@ljharb:matrix.org","id":"$vtnneMUQBBXnnh01_ElsaI9kNSrrRzRsIhsmfv2vhUc"},
{"content":{"body":"tbh i just don't see how that's a remotely meaningful concern","m.mentions":{},"msgtype":"m.text"},"ts":1762955708696,"senderName":"ljharb","senderId":"@ljharb:matrix.org","id":"$K7qBjyUkgUKAR1lidJnuFcxXI7EqaVm4-3F-hpTjY3c"},
{"content":{"body":"ah, that's the thing. we don't have a string there. but some internal representation of the stack","m.mentions":{},"msgtype":"m.text"},"ts":1762955738075,"senderName":"Olivier Flückiger","senderId":"@olivf.o1o.ch:immer.chat","id":"$ri1KlPmoIOSiwIrYyCUYd_YsFMvHVIwuMPjpBz6XCKI"},
{"content":{"body":"that is for example accessible to formatStackTrace","m.mentions":{},"msgtype":"m.text"},"ts":1762955749668,"senderName":"Olivier Flückiger","senderId":"@olivf.o1o.ch:immer.chat","id":"$HdfeE5QEZrclop7KYvrBjq4eyiurgPo8cS2Nl4inLxE"},
{"content":{"body":"you don't need to keep that once the stack is fetched tho - just the string","m.mentions":{},"msgtype":"m.text"},"ts":1762955756447,"senderName":"ljharb","senderId":"@ljharb:matrix.org","id":"$kMOyI7kUWParJGmuFVe5v8JGQlAw_kn_8yMbV7cWljo"},
{"content":{"body":"or at least, the JS spec isn't forcing that","m.mentions":{},"msgtype":"m.text"},"ts":1762955772628,"senderName":"ljharb","senderId":"@ljharb:matrix.org","id":"$zs7UCBc8kH0S2BEaqMytU_w8Q7Cmu7sVI5DwiUBi33k"},
{"content":{"body":"(i don't know what formatStackTrace is)","m.mentions":{},"msgtype":"m.text"},"ts":1762955784006,"senderName":"ljharb","senderId":"@ljharb:matrix.org","id":"$gdEvNvkfqrJ51s5vD6ddhYE-e1cza-26AoN7c1L6-Cs"},
{"content":{"body":"(ironically v8 is the one that blocked the structured stack trace proposal back in like 2018 for reasons unrelated to this convo, so i'm surprised they now have a stack structure with important use cases)","m.mentions":{},"msgtype":"m.text"},"ts":1762955861385,"senderName":"ljharb","senderId":"@ljharb:matrix.org","id":"$q_ReOrnENPOD9h_Pguktb6eQXvqczP2QjFbYnA3FpFI"},
{"content":{"body":"ookay. I mean we can write spec text all day. I am just pointing out what might cause difficulties shipping it...","m.mentions":{},"msgtype":"m.text"},"ts":1762956028323,"senderName":"Olivier Flückiger","senderId":"@olivf.o1o.ch:immer.chat","id":"$ctN8OgKKTSoeckm7prmcLMPELlCjuBfJ7HlgNOzM7yA"},
{"content":{"body":"(prepareStackTrace I meant)","m.mentions":{},"msgtype":"m.text"},"ts":1762956040906,"senderName":"Olivier Flückiger","senderId":"@olivf.o1o.ch:immer.chat","id":"$1TzE2N11NX9kDVNd7oQ9r4UhqPkTO0AU0GKGHCeqOjo"},
{"content":{"body":"totally, i appreciate you bringing it up","m.mentions":{},"msgtype":"m.text"},"ts":1762956202751,"senderName":"ljharb","senderId":"@ljharb:matrix.org","id":"$Ifd2maHRc3yWvO0IpqcIyQCEShzfjAqaVI642Wnhf-Q"},
{"content":{"body":"i'm just trying to understand why it would make a difference","m.mentions":{},"msgtype":"m.text"},"ts":1762956209739,"senderName":"ljharb","senderId":"@ljharb:matrix.org","id":"$7ZNyk7TsOwSKUMgDCMkb2il_8e62LIVyOFn7YGutWyQ"},
{"content":{"body":"like, can you describe the long-running web app where it keeps around error instances, nulls out the stack trace, and where the weight of the underlying stack structure sticking around would be punitive?","m.mentions":{},"msgtype":"m.text"},"ts":1762956246175,"senderName":"ljharb","senderId":"@ljharb:matrix.org","id":"$aJb5ukzE5bnFLqbfT0wXFBgC9N6RHmEfQ1tTyMrA64A"},
{"content":{"body":"i've been doing web dev for a long long time and while indeed devs do all sorts of wacky stuff, i can't even conceive of how such an application could come into existence or what it'd do","m.mentions":{},"msgtype":"m.text"},"ts":1762956275662,"senderName":"ljharb","senderId":"@ljharb:matrix.org","id":"$fmdbc52kZeWymqjd2W8hK7BDkQ-nGym5ATrZDyartQc"},
{"content":{"body":"* like, can you describe the long-running web app where it keeps around error instances, nulls out the stack trace, and where the weight of the underlying stack structure sticking around would be punitive? (but the weight of the error instances would not be)","m.mentions":{},"m.new_content":{"body":"like, can you describe the long-running web app where it keeps around error instances, nulls out the stack trace, and where the weight of the underlying stack structure sticking around would be punitive? (but the weight of the error instances would not be)","m.mentions":{},"msgtype":"m.text"},"m.relates_to":{"event_id":"$aJb5ukzE5bnFLqbfT0wXFBgC9N6RHmEfQ1tTyMrA64A","rel_type":"m.replace"},"msgtype":"m.text"},"ts":1762956325757,"senderName":"ljharb","senderId":"@ljharb:matrix.org","id":"$D1WtlW0pLvq3R1hOA9zGiSNDkZ0x8OKSNTsfnn6C1pM"},
{"content":{"body":"Just an idea but I don't actually want to be involved in this discussion so I won't defend it: maybe V8 could stringify the stack trace (calling .prepareStackTrace) when the setter runs (similarly to how it does it when the getter runs), and then store the string?","m.mentions":{},"msgtype":"m.text"},"ts":1762956444450,"senderName":"nicolo-ribaudo","senderId":"@nicolo-ribaudo:matrix.org","id":"$bBF2QJZ1LdZId1mWbrTe-gT3lMYIx3TtsGo3RK7ELWw"},
{"content":{"body":"yeah, that would be the obvious solution, if we didn't have https://v8.dev/docs/stack-trace-api#customizing-stack-traces","m.mentions":{},"msgtype":"m.text"},"ts":1762956590222,"senderName":"Olivier Flückiger","senderId":"@olivf.o1o.ch:immer.chat","id":"$oovB7iu4HMhiQb0UbRUIYQVGFdhueyu0WQ0HVEymKjQ"},
{"content":{"body":"but we do and that is another web reality unfortunately","m.mentions":{},"msgtype":"m.text"},"ts":1762956605517,"senderName":"Olivier Flückiger","senderId":"@olivf.o1o.ch:immer.chat","id":"$Y7O61-UEsBKCyDPZYxGE97ScVzwWuDAFeMwFrFlC3dY"},
{"content":{"body":"well, a chrome reality at least","m.mentions":{},"msgtype":"m.text"},"ts":1762956670250,"senderName":"ljharb","senderId":"@ljharb:matrix.org","id":"$fU6zwRzR4f7DyLwgBICDcCuBnIy0Ib-41vzHYC606do"},
{"content":{"body":"that API seems like it *accepts* a structure tho - the original error doesn't _provide_ it such that it matches the stack trace?","format":"org.matrix.custom.html","formatted_body":"that API seems like it <em>accepts</em> a structure tho - the original error doesn't <em>provide</em> it such that it matches the stack trace?","m.mentions":{},"msgtype":"m.text"},"ts":1762956733319,"senderName":"ljharb","senderId":"@ljharb:matrix.org","id":"$j3Ix-Z35njMr989z2oBlWbw_enYC5f7EwtQ4IVZg-38"},
{"content":{"body":"eg in `Error.prepareStackTrace(error, structuredStackTrace)` - it's not retrieving the structure, it's forcing the user to pass one of their own","format":"org.matrix.custom.html","formatted_body":"eg in <code>Error.prepareStackTrace(error, structuredStackTrace)</code> - it's not retrieving the structure, it's forcing the user to pass one of their own","m.mentions":{},"msgtype":"m.text"},"ts":1762956785733,"senderName":"ljharb","senderId":"@ljharb:matrix.org","id":"$pzhliAkm2fPAhcTsoHYXUax1JHC_AHqKMXwAA_Wp52k"},
{"content":{"body":"* eg in `Error.prepareStackTrace(error, structuredStackTrace)` - it's not retrieving the structure, it's forcing the user to pass one of their own. the implication ofc is that there's one of these internally for each error, and i guess that's the memory you're concerned about?","format":"org.matrix.custom.html","formatted_body":"* eg in <code>Error.prepareStackTrace(error, structuredStackTrace)</code> - it's not retrieving the structure, it's forcing the user to pass one of their own. the implication ofc is that there's one of these internally for each error, and i guess that's the memory you're concerned about?","m.mentions":{},"m.new_content":{"body":"eg in `Error.prepareStackTrace(error, structuredStackTrace)` - it's not retrieving the structure, it's forcing the user to pass one of their own. the implication ofc is that there's one of these internally for each error, and i guess that's the memory you're concerned about?","format":"org.matrix.custom.html","formatted_body":"eg in <code>Error.prepareStackTrace(error, structuredStackTrace)</code> - it's not retrieving the structure, it's forcing the user to pass one of their own. the implication ofc is that there's one of these internally for each error, and i guess that's the memory you're concerned about?","m.mentions":{},"msgtype":"m.text"},"m.relates_to":{"event_id":"$pzhliAkm2fPAhcTsoHYXUax1JHC_AHqKMXwAA_Wp52k","rel_type":"m.replace"},"msgtype":"m.text"},"ts":1762956810615,"senderName":"ljharb","senderId":"@ljharb:matrix.org","id":"$VhCA1z8nUF1jdcai1nsZgYRJbSBsF85vMtIjGHxjZsQ"},
{"content":{"body":"Yes, the problem is that the error internally has all this stuff that you see listed on that doc attached. And turning it into a string can be observable via hooking into this prepareStackTrace function. So we can't do it transparently...","m.mentions":{},"msgtype":"m.text"},"ts":1762956894604,"senderName":"Olivier Flückiger","senderId":"@olivf.o1o.ch:immer.chat","id":"$SvUyMNcECsRpckzTcKO0cdswJN1xjP74K6IVAEHgDhg"}
]
[
{"content":{"body":"With shu out, depending on who is in attendance today I'd like to spend some time discussing correlation. I have a rough sketch of a very simple correlation mechanism I've put together here: https://gist.github.com/rbuckton/b00ca9660fb888486da07b22e38dd1e9, though I'd like to hear more about other approaches.","m.mentions":{},"msgtype":"m.text"},"ts":1721321633035,"senderName":"rbuckton","senderId":"@rbuckton:matrix.org","id":"$Iru-qBHo9ANPuEd0hhVROeKfebipy4y2gZ8nWbAdrtU"},
{"content":{"body":"I'd also like to present my idea for re-using modules for correlation -- I have some drawings/images but unfortunately not something in written form","m.mentions":{},"msgtype":"m.text"},"ts":1721321850603,"senderName":"nicolo-ribaudo","senderId":"@nicolo-ribaudo:matrix.org","id":"$sZ8CehahKZXyEZsyK21t78Vpp-T216NL8iPwe2C2WEU"},
{"content":{"body":"Meeting starting now, https://meet.google.com/kth-mssd-uqw","m.mentions":{},"msgtype":"m.text"},"ts":1721322133635,"senderName":"littledan","senderId":"@littledan:matrix.org","id":"$1TzM6oglW8Q5lwoMxlAdL0m1Lf_rKNZK-V_Qc8k9w8M"},
{"content":{"body":"Since Shu is the host and is not present, I've created a new meet for this instance of the meeting: https://meet.google.com/iwo-weak-rfn","m.mentions":{},"msgtype":"m.text"},"ts":1721322335916,"senderName":"rbuckton","senderId":"@rbuckton:matrix.org","id":"$brPbyC72wxPWYPhQSSiN-IAQ03PnCPH2amO82fpSTl4"},
{"content":{"body":"Gist about booststrapping a Worker: https://gist.github.com/rbuckton/08d020fc80da308ad3a1991384d4ff62","m.mentions":{},"msgtype":"m.text"},"ts":1721325815241,"senderName":"rbuckton","senderId":"@rbuckton:matrix.org","id":"$ryZh7bZvokRr25w19DtomPO57Sn3YMXHPOS1873_7x0"},
{"content":{"body":"The point of the `shared struct S \"identity-key\"` syntax is that the key is statically known, which makes it unforgeable dynamically (outside of an evaluator). I mentioned CSP as it offers a way to set limits on dynamic evaluation, but we could also impose such limits without CSP by introducing opt-in mechanisms to enable correlation, just as I demonstrated with `new Worker(..., { correlate: true })`. We could, for example, forbid user-defined identities in `eval`/`new Function`/etc. by default and require some type of opt-in mechanism to enable it. While this is not as granular as, say, passing a capability token to each individual declaration, it does establish a trust boundary by requiring an explicit grant when running an evaluator.","format":"org.matrix.custom.html","formatted_body":"The point of the <code>shared struct S \"identity-key\"</code> syntax is that the key is statically known, which makes it unforgeable dynamically (outside of an evaluator). I mentioned CSP as it offers a way to set limits on dynamic evaluation, but we could also impose such limits without CSP by introducing opt-in mechanisms to enable correlation, just as I demonstrated with <code>new Worker(..., { correlate: true })</code>. We could, for example, forbid user-defined identities in <code>eval</code>/<code>new Function</code>/etc. by default and require some type of opt-in mechanism to enable it. While this is not as granular as, say, passing a capability token to each individual declaration, it does establish a trust boundary by requiring an explicit grant when running an evaluator.","m.mentions":{},"msgtype":"m.text"},"ts":1721326553750,"senderName":"rbuckton","senderId":"@rbuckton:matrix.org","id":"$Ndw6kbc6KJAegJk2jxVdOhe0Ckeredg6cyXeNQXdzfI"},
{"content":{"body":"> We could, for example, forbid user-defined identities\nOr rather than forbid, we just don't correlate between the outside world and the evaluator.","format":"org.matrix.custom.html","formatted_body":"<blockquote>\n<p>We could, for example, forbid user-defined identities<br>Or rather than forbid, we just don't correlate between the outside world and the evaluator.</p>\n</blockquote>\n","m.mentions":{},"msgtype":"m.text"},"ts":1721326608536,"senderName":"rbuckton","senderId":"@rbuckton:matrix.org","id":"$AgTzTkWNe5O4lkiHyCwGP-hsyGa4xMQTUpbYhS62rYw"},
{"content":{"body":" * > We could, for example, forbid user-defined identities\n\nOr rather than forbid, we just don't correlate between the outside world and the evaluator.","format":"org.matrix.custom.html","formatted_body":" * <blockquote>\n<p>We could, for example, forbid user-defined identities</p>\n</blockquote>\n<p>Or rather than forbid, we just don't correlate between the outside world and the evaluator.</p>\n","m.mentions":{},"m.new_content":{"body":"> We could, for example, forbid user-defined identities\n\nOr rather than forbid, we just don't correlate between the outside world and the evaluator.","format":"org.matrix.custom.html","formatted_body":"<blockquote>\n<p>We could, for example, forbid user-defined identities</p>\n</blockquote>\n<p>Or rather than forbid, we just don't correlate between the outside world and the evaluator.</p>\n","m.mentions":{},"msgtype":"m.text"},"m.relates_to":{"event_id":"$AgTzTkWNe5O4lkiHyCwGP-hsyGa4xMQTUpbYhS62rYw","rel_type":"m.replace"},"msgtype":"m.text"},"ts":1721326613386,"senderName":"rbuckton","senderId":"@rbuckton:matrix.org","id":"$IoV6AFrNNJrCX_FdniWGQRZW1sCU8tQ7vAgM8IQ4pGc"},
{"content":{"body":"In this model, rather than handing the capability to the `shared struct` declaration, you're handing the capability to the evaluator. If you need to execute or communicate with untrusted code, then you need to establish a trust boundary around it, and only grant the correlation capability to trusted code.","format":"org.matrix.custom.html","formatted_body":"In this model, rather than handing the capability to the <code>shared struct</code> declaration, you're handing the capability to the evaluator. If you need to execute or communicate with untrusted code, then you need to establish a trust boundary around it, and only grant the correlation capability to trusted code.","m.mentions":{},"msgtype":"m.text"},"ts":1721326756969,"senderName":"rbuckton","senderId":"@rbuckton:matrix.org","id":"$dl5u2pJp6phtLDE_M4zEdaHYpNCaF8YyohESFt8bQVo"},
{"content":{"body":"> <@rbuckton:matrix.org> Gist about booststrapping a Worker: https://gist.github.com/rbuckton/08d020fc80da308ad3a1991384d4ff62\n\nApps could also maybe do something similar to how React components can all add something to the `<head>` tag, collecting them all up as they are evaluated. And also Custom html elements.\nA library could provide a decorator which users can add to their structs, which collects them. And then the place that starts the worker can ask the library for the list of all decorated structs.\nI wonder if it should also be possible to register structs lazily to avoid having to import everything eagerly just in case they are used ","format":"org.matrix.custom.html","formatted_body":"<mx-reply><blockquote><a href=\"https://matrix.to/#/!fmLqwwrfASaCrzNjAk%3Amatrix.org/%24ryZh7bZvokRr25w19DtomPO57Sn3YMXHPOS1873_7x0\">In reply to</a> <a href=\"https://matrix.to/#/@rbuckton:matrix.org\">@rbuckton:matrix.org</a><br>Gist about booststrapping a Worker: https://gist.github.com/rbuckton/08d020fc80da308ad3a1991384d4ff62</blockquote></mx-reply>Apps could also maybe do something similar to how React components can all add something to the `&lt;head&gt;` tag, collecting them all up as they are evaluated. And also Custom html elements.<br />A library could provide a decorator which users can add to their structs, which collects them. And then the place that starts the worker can ask the library for the list of all decorated structs.<br />I wonder if it should also be possible to register structs lazily to avoid having to import everything eagerly just in case they are usedÂ ","m.relates_to":{"m.in_reply_to":{"event_id":"$ryZh7bZvokRr25w19DtomPO57Sn3YMXHPOS1873_7x0"}},"msgtype":"m.text"},"ts":1721327010561,"senderName":"Ashley Claymore","senderId":"@aclaymore:matrix.org","id":"$rIUe8RYInF8JxzK8ej5dxazh4jpAP9aGht9ke9GV42A"},
{"content":{"body":"So I was mistaken when I said it was fine to have a use once unforgeable token. At the end of the day if it's used as a key in a global/per realm registry, and the user code can sense whether that key has been used before or not, it becomes a global communication channel, which simply holding an immutable key value shouldn't enable (regardless of the forgeability of said value). Because the prototype registration is per realm, we cannot use a simple immutable value as correlation key where the user is in a position to provide a conflicting definition.","m.mentions":{},"msgtype":"m.text"},"ts":1721328904828,"senderName":"Mathieu Hofman","senderId":"@mhofman:matrix.org","id":"$p_YcJl1KzcfMBEiVSM6HJOtBEDwSPfsSj55VVrPZv_o"},
{"content":{"body":"I think this observation may apply to the module source proposal as well, as technically a module source is considered an immutable \"safe to share\" value, but because it could be linked to different modules or in different evaluators/compartments, different evaluations of the module source in the same realm would result in different prototype behaviors for the same shared struct type.","m.mentions":{},"msgtype":"m.text"},"ts":1721328925056,"senderName":"Mathieu Hofman","senderId":"@mhofman:matrix.org","id":"$ZH1wDetZBsIVFp8klak9hMTMeiY7WpMhhrLkfx5ceb4"},
{"content":{"body":"Finally, a similar problem occurs with bundlers and string correlation tokens. Lets assume library \"shared-awesomeness\" is used by library \"cool-helpers\" and \"nice-tools\", and my app uses both. Even if both these libraries use the same version of \"shared-awesomeness\", the package manager could have installed separate copies, which would be evaluated separately. The correlation token would attempt to collapse the independent declarations, which would cause issues. Even if we don't fail the multiple definition, you would end up with one of the 2 definitions being ignored, which is a problem if there is any kind of shared state surrounding the definition.","m.mentions":{},"msgtype":"m.text"},"ts":1721328933165,"senderName":"Mathieu Hofman","senderId":"@mhofman:matrix.org","id":"$fY1qxwAdAsAsxidRUI5o4ND1Rp-yvw3D33AE9MRM6Vw"},
{"content":{"body":"> <@mhofman:matrix.org> Finally, a similar problem occurs with bundlers and string correlation tokens. Lets assume library \"shared-awesomeness\" is used by library \"cool-helpers\" and \"nice-tools\", and my app uses both. Even if both these libraries use the same version of \"shared-awesomeness\", the package manager could have installed separate copies, which would be evaluated separately. The correlation token would attempt to collapse the independent declarations, which would cause issues. Even if we don't fail the multiple definition, you would end up with one of the 2 definitions being ignored, which is a problem if there is any kind of shared state surrounding the definition.\n\nIn this case I would say this means neither are valid, not one or the other. If the concern is detecting 1 vs 2+, that would require you to grant the permission to an evaluator for malicious code to use it, which is why you would want to isolate untrusted code behind a separate trust boundary (i.e., a shadow realm, `iframe`, etc.)","format":"org.matrix.custom.html","formatted_body":"<mx-reply><blockquote><a href=\"https://matrix.to/#/!fmLqwwrfASaCrzNjAk:matrix.org/$fY1qxwAdAsAsxidRUI5o4ND1Rp-yvw3D33AE9MRM6Vw?via=matrix.org&via=mozilla.org&via=igalia.com\">In reply to</a> <a href=\"https://matrix.to/#/@mhofman:matrix.org\">@mhofman:matrix.org</a><br>Finally, a similar problem occurs with bundlers and string correlation tokens. Lets assume library &quot;shared-awesomeness&quot; is used by library &quot;cool-helpers&quot; and &quot;nice-tools&quot;, and my app uses both. Even if both these libraries use the same version of &quot;shared-awesomeness&quot;, the package manager could have installed separate copies, which would be evaluated separately. The correlation token would attempt to collapse the independent declarations, which would cause issues. Even if we don&#39;t fail the multiple definition, you would end up with one of the 2 definitions being ignored, which is a problem if there is any kind of shared state surrounding the definition.</blockquote></mx-reply>In this case I would say this means neither are valid, not one or the other. If the concern is detecting 1 vs 2+, that would require you to grant the permission to an evaluator for malicious code to use it, which is why you would want to isolate untrusted code behind a separate trust boundary (i.e., a shadow realm, <code>iframe</code>, etc.)","m.mentions":{"user_ids":["@mhofman:matrix.org"]},"m.relates_to":{"m.in_reply_to":{"event_id":"$fY1qxwAdAsAsxidRUI5o4ND1Rp-yvw3D33AE9MRM6Vw"}},"msgtype":"m.text"},"ts":1721329087973,"senderName":"rbuckton","senderId":"@rbuckton:matrix.org","id":"$Zqrn6IaoOEMvXxxmRHGSlm03iAMuJGv8p9Gx8aSkhao"},
{"content":{"body":"In the unforgeable token case, a way around this may be to reify the mutable aspect onto the object itself. E.g. having an exotic data property that exposes the currently registered prototype in the realm. It would make it clear the object is a direct \"proxy\" for the realm's registration of that type","m.mentions":{},"msgtype":"m.text"},"ts":1721329175754,"senderName":"Mathieu Hofman","senderId":"@mhofman:matrix.org","id":"$xB_LW28_cks0ITvHDNRxFMW6aoCD8oCz3SnN100Monc"},
{"content":{"body":"> <@rbuckton:matrix.org> In this case I would say this means neither are valid, not one or the other. If the concern is detecting 1 vs 2+, that would require you to grant the permission to an evaluator for malicious code to use it, which is why you would want to isolate untrusted code behind a separate trust boundary (i.e., a shadow realm, `iframe`, etc.)\n\nwhat do you mean \"neither\" are valid. one declaration is evaluated before the other. When evaluating the first one, the engine is not in a position a second one is coming with the same token ","format":"org.matrix.custom.html","formatted_body":"<mx-reply><blockquote><a href=\"https://matrix.to/#/!fmLqwwrfASaCrzNjAk:matrix.org/$Zqrn6IaoOEMvXxxmRHGSlm03iAMuJGv8p9Gx8aSkhao?via=matrix.org&via=igalia.com&via=mozilla.org\">In reply to</a> <a href=\"https://matrix.to/#/@rbuckton:matrix.org\">@rbuckton:matrix.org</a><br>In this case I would say this means neither are valid, not one or the other. If the concern is detecting 1 vs 2+, that would require you to grant the permission to an evaluator for malicious code to use it, which is why you would want to isolate untrusted code behind a separate trust boundary (i.e., a shadow realm, <code>iframe</code>, etc.)</blockquote></mx-reply>what do you mean \"neither\" are valid. one declaration is evaluated before the other. When evaluating the first one, the engine is not in a position a second one is coming with the same token","m.mentions":{"user_ids":["@rbuckton:matrix.org"]},"m.relates_to":{"m.in_reply_to":{"event_id":"$Zqrn6IaoOEMvXxxmRHGSlm03iAMuJGv8p9Gx8aSkhao"}},"msgtype":"m.text"},"ts":1721329241153,"senderName":"Mathieu Hofman","senderId":"@mhofman:matrix.org","id":"$mFupWLLMoSjVdzukAvnxggVs2akbgNu_JgHUDpIiGfk"},
{"content":{"body":"> <@rbuckton:matrix.org> In this case I would say this means neither are valid, not one or the other. If the concern is detecting 1 vs 2+, that would require you to grant the permission to an evaluator for malicious code to use it, which is why you would want to isolate untrusted code behind a separate trust boundary (i.e., a shadow realm, `iframe`, etc.)\n\n * what do you mean \"neither\" are valid. one declaration is evaluated before the other. When evaluating the first one, the engine is not in a position to know a second one is coming with the same token","format":"org.matrix.custom.html","formatted_body":"<mx-reply><blockquote><a href=\"https://matrix.to/#/!fmLqwwrfASaCrzNjAk:matrix.org/$Zqrn6IaoOEMvXxxmRHGSlm03iAMuJGv8p9Gx8aSkhao?via=matrix.org&amp;via=igalia.com&amp;via=mozilla.org\">In reply to</a> <a href=\"https://matrix.to/#/@rbuckton:matrix.org\">@rbuckton:matrix.org</a><br>In this case I would say this means neither are valid, not one or the other. If the concern is detecting 1 vs 2+, that would require you to grant the permission to an evaluator for malicious code to use it, which is why you would want to isolate untrusted code behind a separate trust boundary (i.e., a shadow realm, <code>iframe</code>, etc.)</blockquote></mx-reply> * what do you mean \"neither\" are valid. one declaration is evaluated before the other. When evaluating the first one, the engine is not in a position to know a second one is coming with the same token","m.mentions":{},"m.new_content":{"body":"what do you mean \"neither\" are valid. one declaration is evaluated before the other. When evaluating the first one, the engine is not in a position to know a second one is coming with the same token","format":"org.matrix.custom.html","formatted_body":"what do you mean \"neither\" are valid. one declaration is evaluated before the other. When evaluating the first one, the engine is not in a position to know a second one is coming with the same token","m.mentions":{"user_ids":["@rbuckton:matrix.org"]},"msgtype":"m.text"},"m.relates_to":{"event_id":"$mFupWLLMoSjVdzukAvnxggVs2akbgNu_JgHUDpIiGfk","rel_type":"m.replace"},"msgtype":"m.text"},"ts":1721329262580,"senderName":"Mathieu Hofman","senderId":"@mhofman:matrix.org","id":"$dkeOl4iyBbmr6xzcWtHRP_TTdevS45uNvuvaD0cNvpU"},
{"content":{"body":"Fair, but my point about detection remains. If you are evaluating untrusted code, you should put something between you and the untrusted code. If we require that a static identity must be laid down in an actual file, then untrusted code can't just produce new files on demand (if it can, you have far greater problems). If you want to allow an evaluator to correlate on a static identity, you must explicitly grant it the permission to do so. \nHow I'd imagined this working is that whatever \"registry\" a Realm uses for this correlation is only passed down to child Realms (or evaluators) by an explicit grant. If not that is not provided, the child Realm/evaluator only gets its own \"registry\" (and we could theoretically also deny the ability for a child Realm/evaluator to have a registry at all). However, if you run your untrusted code in the same Realm, it would share your registry. Thus, you really want to be able to isolate untrusted code into a different Realm.","m.mentions":{},"msgtype":"m.text"},"ts":1721329894096,"senderName":"rbuckton","senderId":"@rbuckton:matrix.org","id":"$DwcNHoZoff29YOpCGz1PdEBGMbKu32kpLiUe1lZnABY"},
{"content":{"body":"hopefully there are notes?","m.mentions":{},"msgtype":"m.text"},"ts":1721330222859,"senderName":"global_lover","senderId":"@shuyuguo:matrix.org","id":"$TTo6PADcmiUgLDCgIX_CJy-rrqcpjZv07M3PE38lv14"},
{"content":{"body":"> <@rbuckton:matrix.org> Fair, but my point about detection remains. If you are evaluating untrusted code, you should put something between you and the untrusted code. If we require that a static identity must be laid down in an actual file, then untrusted code can't just produce new files on demand (if it can, you have far greater problems). If you want to allow an evaluator to correlate on a static identity, you must explicitly grant it the permission to do so. \n> How I'd imagined this working is that whatever \"registry\" a Realm uses for this correlation is only passed down to child Realms (or evaluators) by an explicit grant. If not that is not provided, the child Realm/evaluator only gets its own \"registry\" (and we could theoretically also deny the ability for a child Realm/evaluator to have a registry at all). However, if you run your untrusted code in the same Realm, it would share your registry. Thus, you really want to be able to isolate untrusted code into a different Realm.\n\nI am really confused as to how the example I provided with \"twin\" libraries relates to untrusted eval. Are you suggesting that a bundler doesn't simply bundle but also modifies the shared struct declaration of each library installation to generate the token?","format":"org.matrix.custom.html","formatted_body":"<mx-reply><blockquote><a href=\"https://matrix.to/#/!fmLqwwrfASaCrzNjAk:matrix.org/$DwcNHoZoff29YOpCGz1PdEBGMbKu32kpLiUe1lZnABY?via=matrix.org&via=igalia.com&via=mozilla.org\">In reply to</a> <a href=\"https://matrix.to/#/@rbuckton:matrix.org\">@rbuckton:matrix.org</a><br>Fair, but my point about detection remains. If you are evaluating untrusted code, you should put something between you and the untrusted code. If we require that a static identity must be laid down in an actual file, then untrusted code can&#39;t just produce new files on demand (if it can, you have far greater problems). If you want to allow an evaluator to correlate on a static identity, you must explicitly grant it the permission to do so. <br/>How I&#39;d imagined this working is that whatever &quot;registry&quot; a Realm uses for this correlation is only passed down to child Realms (or evaluators) by an explicit grant. If not that is not provided, the child Realm/evaluator only gets its own &quot;registry&quot; (and we could theoretically also deny the ability for a child Realm/evaluator to have a registry at all). However, if you run your untrusted code in the same Realm, it would share your registry. Thus, you really want to be able to isolate untrusted code into a different Realm.</blockquote></mx-reply>I am really confused as to how the example I provided with \"twin\" libraries relates to untrusted eval. Are you suggesting that a bundler doesn't simply bundle but also modifies the shared struct declaration of each library installation to generate the token?","m.mentions":{"user_ids":["@rbuckton:matrix.org"]},"m.relates_to":{"m.in_reply_to":{"event_id":"$DwcNHoZoff29YOpCGz1PdEBGMbKu32kpLiUe1lZnABY"}},"msgtype":"m.text"},"ts":1721331122650,"senderName":"Mathieu Hofman","senderId":"@mhofman:matrix.org","id":"$qEq6wqWlcAQ51lTOox3rLuS9drGIs9sA4J9jgGjcMec"},
{"content":{"body":"why... would two different versions have the same correlation token?","m.mentions":{},"msgtype":"m.text"},"ts":1721331314639,"senderName":"shu","senderId":"@shuyuguo:matrix.org","id":"$B0yWVs6r4aTb-ZShMefVJLaEW-k3t9mzK2CfYf2xfD0"},
{"content":{"body":"2 different installs. Doesn't have to be different versions. Package managers do weird and complicated things.","m.mentions":{},"msgtype":"m.text"},"ts":1721331370584,"senderName":"Mathieu Hofman","senderId":"@mhofman:matrix.org","id":"$EiZ39hBlTxzxunu7fyqzkMtZdX0B52gshDFGDbkAnv4"},
{"content":{"body":"To be clear, this \"eval twin\" problem is a major issue in the community today with class private fields, where separate installs don't recognize each other instances","m.mentions":{},"msgtype":"m.text"},"ts":1721331449604,"senderName":"Mathieu Hofman","senderId":"@mhofman:matrix.org","id":"$OhWbTgUCpYTK76ma1HM45qzmlzzFt68CL_TB6C_cncw"},
{"content":{"body":"(it's a common occurrence; it's what peerDependencies are for)","m.mentions":{},"msgtype":"m.text"},"ts":1721331454599,"senderName":"ljharb","senderId":"@ljharb:matrix.org","id":"$alRQsWeACId0EMy_SnyVl_shNiOl2l7YvVJHVfejlxc"},
{"content":{"body":"how is it solved for private fields?","m.mentions":{},"msgtype":"m.text"},"ts":1721331475583,"senderName":"shu","senderId":"@shuyuguo:matrix.org","id":"$UmL5jF0YpHJl3L5zs1TiqvDnjb7GX51rpJwvpAkKocY"},
{"content":{"body":"The thing is that because we're tacking on a collapse mechanism on top of that, no we need to define what happens","m.mentions":{},"msgtype":"m.text"},"ts":1721331480998,"senderName":"Mathieu Hofman","senderId":"@mhofman:matrix.org","id":"$a6hvzV5yVpM_GPmaOLPL4V8daqs-pqYQIt4l19f39fg"},
{"content":{"body":"> <@shuyuguo:matrix.org> how is it solved for private fields?\n\nIt's not","format":"org.matrix.custom.html","formatted_body":"<mx-reply><blockquote><a href=\"https://matrix.to/#/!fmLqwwrfASaCrzNjAk:matrix.org/$UmL5jF0YpHJl3L5zs1TiqvDnjb7GX51rpJwvpAkKocY?via=matrix.org&via=igalia.com&via=mozilla.org\">In reply to</a> <a href=\"https://matrix.to/#/@shuyuguo:matrix.org\">@shuyuguo:matrix.org</a><br>how is it solved for private fields?</blockquote></mx-reply>It's not","m.mentions":{"user_ids":["@shuyuguo:matrix.org"]},"m.relates_to":{"m.in_reply_to":{"event_id":"$UmL5jF0YpHJl3L5zs1TiqvDnjb7GX51rpJwvpAkKocY"}},"msgtype":"m.text"},"ts":1721331485820,"senderName":"Mathieu Hofman","senderId":"@mhofman:matrix.org","id":"$PoP37fhLRUPDS_BVgMnLANfLe5oWYtexwral-vIRlVY"},
{"content":{"body":"the \"solution\" is to use peer deps to force only one copy of the thing to be installed","m.mentions":{},"msgtype":"m.text"},"ts":1721331497296,"senderName":"ljharb","senderId":"@ljharb:matrix.org","id":"$JFAmAxNnkloMr_O1kqsz6gug3NqwXoEvGG2SMyCtBVU"},
{"content":{"body":"in the beginning one of my assumptions has been that this kind of correlation mechanism needs explicit handling by the tools","m.mentions":{},"msgtype":"m.text"},"ts":1721331497943,"senderName":"shu","senderId":"@shuyuguo:matrix.org","id":"$qTIfXmMmgTl6KEXJ0lKu7gBo0qKZNATZcIXkhr1y4Es"},
{"content":{"body":"it's a major pain point today, and one reason some people consider private fields unacceptable","m.mentions":{},"msgtype":"m.text"},"ts":1721331555690,"senderName":"Mathieu Hofman","senderId":"@mhofman:matrix.org","id":"$MgK_hnWLnuXd38IPJHfnpAAbhHD_2dxCyp0FiaI8l74"},
{"content":{"body":"it's somewhat heartening that it's an existing problem in that at least we won't be introducing a new one, and adding motivation to solve the existing problem as well","m.mentions":{},"msgtype":"m.text"},"ts":1721331575416,"senderName":"shu","senderId":"@shuyuguo:matrix.org","id":"$eI-JkLKkaKP1jnxwbgUbRsCGUIfOf10XmCr9QCC-N50"},
{"content":{"body":"for private fields is the challenge it's unclear if it's _supposed_ to be collapsed?","format":"org.matrix.custom.html","formatted_body":"for private fields is the challenge it's unclear if it's <em>supposed</em> to be collapsed?","m.mentions":{},"msgtype":"m.text"},"ts":1721331651174,"senderName":"shu","senderId":"@shuyuguo:matrix.org","id":"$oGBewzfnQ02U2vhriUZWfhgUkBcFj1EFqcr76574WR4"},
{"content":{"body":"like, can bundlers do a byte-by-byte comparison of the two copies and collapse them? if not, why not?","m.mentions":{},"msgtype":"m.text"},"ts":1721331692035,"senderName":"shu","senderId":"@shuyuguo:matrix.org","id":"$XRSm2TrGU2xwu_Yk-W2FEmen_kWVWIN365A3z9Hzp5A"},
{"content":{"body":"if you collapse for private fields, you introduce other potential issues: If there is any used state in the surrounding scope of the declaration, you risk conflicts between \"I recognize the private fields\" vs \"my surrounding scope doesn't know about this instance\"","m.mentions":{},"msgtype":"m.text"},"ts":1721331791691,"senderName":"Mathieu Hofman","senderId":"@mhofman:matrix.org","id":"$54VyaP09_uDfvEg9_h3hgSRFqd3sPkFL8ogXPIH9EO8"},
{"content":{"body":"i don't understand that, may need to see something concrete","m.mentions":{},"msgtype":"m.text"},"ts":1721331823700,"senderName":"shu","senderId":"@shuyuguo:matrix.org","id":"$fjuORdyu949c0xkwRKB5jDEdsrfECsjo5O1lqaNoIzY"},
{"content":{"body":"because a byte for byte comparison of a definition is only safe if the definition is pure, aka doesn't close over any surrounding state","m.mentions":{},"msgtype":"m.text"},"ts":1721331844787,"senderName":"Mathieu Hofman","senderId":"@mhofman:matrix.org","id":"$pQb6s1AhC02wc_e6GHxd5TCDd0DGrYoOsLXlu3o7itI"},
{"content":{"body":"how can a package close over different state?","m.mentions":{},"msgtype":"m.text"},"ts":1721331866843,"senderName":"shu","senderId":"@shuyuguo:matrix.org","id":"$UhNXdvF-tJyjzp4zsckgTfynx4L0pKAim-yQd9GN4NA"},
{"content":{"body":"like, you can only close over stuff lexically enclosing you. this is two different copies of the same package, wouldn't they have the same enclosing lexical scope?","m.mentions":{},"msgtype":"m.text"},"ts":1721331933735,"senderName":"shu","senderId":"@shuyuguo:matrix.org","id":"$OV0u8WNz9zJn9Gm2DToy7rmOHak4DoEbt0vH-Ug5FHc"},
{"content":{"body":"I was talking about the class / struct declaration, but you can extend that to the whole module if you want.","m.mentions":{},"msgtype":"m.text"},"ts":1721331937824,"senderName":"Mathieu Hofman","senderId":"@mhofman:matrix.org","id":"$wrkebC5x4Jj3R3VqmX3HHTHQ_P_HWnfsnsMe7v3UZ98"},
{"content":{"body":"right, i think you have to collapse at package granularity","m.mentions":{},"msgtype":"m.text"},"ts":1721331975218,"senderName":"shu","senderId":"@shuyuguo:matrix.org","id":"$LUNBrdmXW3ts9iGqBFplRBzXVlMXbF9DAkrwELJIY3I"},
{"content":{"body":"i don't see how a bundler can collapse at like... expression or statement granularity","m.mentions":{},"msgtype":"m.text"},"ts":1721331987229,"senderName":"shu","senderId":"@shuyuguo:matrix.org","id":"$j0DTGhXbjylPLAESezvWelM3lfYsyYkIFICSy43yxHU"},
{"content":{"body":"the bindings of the module might resolve to different imports","m.mentions":{},"msgtype":"m.text"},"ts":1721331997613,"senderName":"Mathieu Hofman","senderId":"@mhofman:matrix.org","id":"$gicS1DIe_GvDoM-LTVVpvdO7Wd9MjBKUiNh6kt0SNI0"},
{"content":{"body":"so how is it two copies of the same package? it's two different packages at that point","m.mentions":{},"msgtype":"m.text"},"ts":1721332017297,"senderName":"shu","senderId":"@shuyuguo:matrix.org","id":"$pShiLstWnaFHyTm5H3PWQn9CtwDquQSluOx6fgEiyxE"},
{"content":{"body":"in which case not recognizing private fields seems working as intended","m.mentions":{},"msgtype":"m.text"},"ts":1721332033048,"senderName":"shu","senderId":"@shuyuguo:matrix.org","id":"$jK8guwRlDdJbPNbPu5zgjBUhuAOHCc-C0-ZMmLhO9LQ"},
{"content":{"body":" * in which case not recognizing each others' private fields seems working as intended","m.mentions":{},"m.new_content":{"body":"in which case not recognizing each others' private fields seems working as intended","m.mentions":{},"msgtype":"m.text"},"m.relates_to":{"event_id":"$jK8guwRlDdJbPNbPu5zgjBUhuAOHCc-C0-ZMmLhO9LQ","rel_type":"m.replace"},"msgtype":"m.text"},"ts":1721332040215,"senderName":"shu","senderId":"@shuyuguo:matrix.org","id":"$6BpvXJ4G3lARlUV6NyVfwrUE1yv5Si6mA_0DRKWbMNI"},
{"content":{"body":"in any case what's the issue to what ljharb was saying with peerDependencies? it's too unergonomic?","format":"org.matrix.custom.html","formatted_body":"in any case what's the issue to what <a href=\"https://matrix.to/#/@ljharb:matrix.org\">ljharb</a> was saying with peerDependencies? it's too unergonomic?","m.mentions":{"user_ids":["@ljharb:matrix.org"]},"msgtype":"m.text"},"ts":1721332065301,"senderName":"shu","senderId":"@shuyuguo:matrix.org","id":"$0lmUyBTul8RA89mkPl80tUZXevI3bwAFwhylFtwHpa0"},
{"content":{"body":"Correct, not recognizing private fields is what the spec intends, because it'd different declaration, but it's not what the users intent, or understand. For them it's the \"same\" package","m.mentions":{},"msgtype":"m.text"},"ts":1721332089949,"senderName":"Mathieu Hofman","senderId":"@mhofman:matrix.org","id":"$VJdJBnrzgbop5XJrUKs904KCQ83IkpP7vT8A8ErOA8s"},
{"content":{"body":"i can't reconcile the user intent that it's the same module with \"bindings of the module might resolve to different imports\"","m.mentions":{},"msgtype":"m.text"},"ts":1721332110162,"senderName":"shu","senderId":"@shuyuguo:matrix.org","id":"$wWsAHxrceFH7ydxqJzug7aHqSS-Vw5_AKllmS6qCUrY"},
{"content":{"body":" * Correct, not recognizing private fields is what the spec intends, because it's different declarations, but it's not what the users intent, or understand. For them it's the \"same\" package","m.mentions":{},"m.new_content":{"body":"Correct, not recognizing private fields is what the spec intends, because it's different declarations, but it's not what the users intent, or understand. For them it's the \"same\" package","m.mentions":{},"msgtype":"m.text"},"m.relates_to":{"event_id":"$VJdJBnrzgbop5XJrUKs904KCQ83IkpP7vT8A8ErOA8s","rel_type":"m.replace"},"msgtype":"m.text"},"ts":1721332112093,"senderName":"Mathieu Hofman","senderId":"@mhofman:matrix.org","id":"$am4ypTjjzjtoXElWMXBxELrsJbdid8DJYc3pUWlQcME"},
{"content":{"body":" * Correct, not recognizing private fields is what the spec intends, because it's different declarations, but it's not what the users intend, or understand. For them it's the \"same\" package","m.mentions":{},"m.new_content":{"body":"Correct, not recognizing private fields is what the spec intends, because it's different declarations, but it's not what the users intend, or understand. For them it's the \"same\" package","m.mentions":{},"msgtype":"m.text"},"m.relates_to":{"event_id":"$VJdJBnrzgbop5XJrUKs904KCQ83IkpP7vT8A8ErOA8s","rel_type":"m.replace"},"msgtype":"m.text"},"ts":1721332119545,"senderName":"Mathieu Hofman","senderId":"@mhofman:matrix.org","id":"$N4pagQeA48oxgdEDFcArNlrwVvdpDkrhXg5rcjKLun4"},
{"content":{"body":"i was understanding user tent of the same package to mean everything is the same, down to the environment chain and its contents, except it's evaluated twice","m.mentions":{},"msgtype":"m.text"},"ts":1721332140335,"senderName":"shu","senderId":"@shuyuguo:matrix.org","id":"$uNpNbpcP6U5UBbplwWSqwGFdvquF5v3ASXZEJjV17kI"},
{"content":{"body":" * i was understanding user intent of the same package to mean everything is the same, down to the environment chain and its contents, except it's evaluated twice","m.mentions":{},"m.new_content":{"body":"i was understanding user intent of the same package to mean everything is the same, down to the environment chain and its contents, except it's evaluated twice","m.mentions":{},"msgtype":"m.text"},"m.relates_to":{"event_id":"$uNpNbpcP6U5UBbplwWSqwGFdvquF5v3ASXZEJjV17kI","rel_type":"m.replace"},"msgtype":"m.text"},"ts":1721332147786,"senderName":"shu","senderId":"@shuyuguo:matrix.org","id":"$gt7nvVbvPML2YigOtCdU0QR32vRk8YblLCaGURjtOXc"},
{"content":{"body":"peer dependencies while the correct answer to be explicit about deduplication are fairly unergonomic, and not widely adopted","m.mentions":{},"msgtype":"m.text"},"ts":1721332270379,"senderName":"Mathieu Hofman","senderId":"@mhofman:matrix.org","id":"$neh8Lit8yTOj2klONoS7-qxhFidr7KGtiH-37eRFOio"},
{"content":{"body":"is that an outreach issue or a fundamental one, do you think?","m.mentions":{},"msgtype":"m.text"},"ts":1721332297808,"senderName":"shu","senderId":"@shuyuguo:matrix.org","id":"$3qv5s8AdtjtFgCmlT2Ey1n3D8D5STD9fUaHEBSUJRV8"},
{"content":{"body":"anyway we can table this for a little bit later. were there notes / what's the upshot of the discussion today?","m.mentions":{},"msgtype":"m.text"},"ts":1721332316113,"senderName":"shu","senderId":"@shuyuguo:matrix.org","id":"$uFH-nwog1NIW2xcmq1Qp7eRIGlDvp4_272sP9rg76VA"},
{"content":{"body":"I'm not sure if anyone took notes.","m.mentions":{},"msgtype":"m.text"},"ts":1721332372271,"senderName":"Mathieu Hofman","senderId":"@mhofman:matrix.org","id":"$rTzuURy58ho0wMC7FPgM3nTZfWnW3WiZYbHKLI2yAL8"},
{"content":{"body":"were there any conclusions or action items?","m.mentions":{},"msgtype":"m.text"},"ts":1721332386956,"senderName":"shu","senderId":"@shuyuguo:matrix.org","id":"$uRDa4IMSkUhpoRUfvLdJcJR2kw5enUbodXt7IFGi_QY"}
]
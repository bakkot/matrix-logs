[
{"content":{"body":"> <@aclaymore:matrix.org> I presume the idea is that it could skip that? But then I think that means this is possible:\n> \n> ```\n> ref.is(obj); // true\n> obj = null;\n> ref.deref(); // undefined, we observed sync GC\n> ```\n\nit could add `obj` to kept objects i guess. ","format":"org.matrix.custom.html","formatted_body":"<mx-reply><blockquote><a href=\"https://matrix.to/#/!wbACpffbfxANskIFZq:matrix.org/$7qlqxi8iEoE5MslcKUhjaDk_S6TUqNPaxGC8FsKP2Ew?via=matrix.org&via=mozilla.org&via=igalia.com\">In reply to</a> <a href=\"https://matrix.to/#/@aclaymore:matrix.org\">@aclaymore:matrix.org</a><br>I presume the idea is that it could skip that? But then I think that means this is possible:<br /><br />```<br />ref.is(obj); // true<br />obj = null;<br />ref.deref(); // undefined, we observed sync GC<br />```</blockquote></mx-reply>it could add <code>obj</code> to kept objects i guess.","m.mentions":{"user_ids":["@aclaymore:matrix.org"]},"m.relates_to":{"m.in_reply_to":{"event_id":"$7qlqxi8iEoE5MslcKUhjaDk_S6TUqNPaxGC8FsKP2Ew"}},"msgtype":"m.text"},"ts":1720055260320,"senderName":"snek","senderId":"@devsnek:matrix.org","id":"$30j14kaDrTGiNuz-nZkMvYIVeJ-m5NgYeAt2vthbvR8"},
{"content":{"body":"the goal is to avoid adding the other thing it holds","m.mentions":{},"msgtype":"m.text"},"ts":1720055275479,"senderName":"snek","senderId":"@devsnek:matrix.org","id":"$jimV9RD2Df3avpvvM0bHu8zpVN80ulPeoHlxCRO8OBE"},
{"content":{"body":" * the goal is to avoid adding whatever it contains if its not `obj`","format":"org.matrix.custom.html","formatted_body":" * the goal is to avoid adding whatever it contains if its not <code>obj</code>","m.mentions":{},"m.new_content":{"body":"the goal is to avoid adding whatever it contains if its not `obj`","format":"org.matrix.custom.html","formatted_body":"the goal is to avoid adding whatever it contains if its not <code>obj</code>","m.mentions":{},"msgtype":"m.text"},"m.relates_to":{"event_id":"$jimV9RD2Df3avpvvM0bHu8zpVN80ulPeoHlxCRO8OBE","rel_type":"m.replace"},"msgtype":"m.text"},"ts":1720055291434,"senderName":"snek","senderId":"@devsnek:matrix.org","id":"$G4s-1FgNvRnd7d7hYnn9nRCMVH-W_gXATEJPAyMNMlg"},
{"content":{"body":"That makes sense. Only add to kept objects if it returns true should solve the observable GC issue.","format":"org.matrix.custom.html","formatted_body":"That makes sense. Only add to kept objects if it returns true should solve the observable GC issue.","msgtype":"m.text"},"ts":1720061283198,"senderName":"Ashley Claymore","senderId":"@aclaymore:matrix.org","id":"$bBsg7CgFJoyFZfvUyv2cpEDzhU4hxub1TL6clRR2rK0"},
{"content":{"body":"I'm curious about the use case tho. When does one need to test if a weakref contains a certain object. In my experience  if I have a weakref, it's because I don't hold the target. ","msgtype":"m.text"},"ts":1720073466626,"senderName":"Mathieu Hofman","senderId":"@mhofman:matrix.org","id":"$ApUtDc3s113PmanqJiauzaTQk2ET0KHw13I9yyEDwl8"},
{"content":{"body":"It sounds like one is trying to iterate a set or map of weakref, which is most likely the wrong thing to do in the first place, and sounds like weakmap and weakset should have been used","msgtype":"m.text"},"ts":1720073602537,"senderName":"Mathieu Hofman","senderId":"@mhofman:matrix.org","id":"$CoNhKQvAr1Oq8cFB3o8FKaKRMeeoRQ3S5sJtMIF64l8"}
]
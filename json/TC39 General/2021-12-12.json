[
{"content":{"body":"Hey. I was trying to understand the ShadowRealm proposal, and I noticed that the requirements for `HostResolveImportedModules` don't say anything about realms","format":"org.matrix.custom.html","formatted_body":"Hey. I was trying to understand the ShadowRealm proposal, and I noticed that the requirements for <code>HostResolveImportedModules</code> don't say anything about realms","msgtype":"m.text"},"ts":1639329185616,"senderName":"Andreu Botella (he/they)","senderId":"@andreubotella:mozilla.org","id":"$dVv4CiOjuILaHjBJHvo_rTfmETj3DmYPdvEJm8db5eo"},
{"content":{"body":"and IIUC the security properties of ShadowRealms need the realm to not share a module map with any other realms","msgtype":"m.text"},"ts":1639329216119,"senderName":"Andreu Botella (he/they)","senderId":"@andreubotella:mozilla.org","id":"$GF3eOVrlEKjARnw3sx6SLqU21U_JpDhAaCl7_vp5sfg"},
{"content":{"body":" * and IIUC the security properties of ShadowRealms need the realm to not share a module map with any other realms","m.new_content":{"body":"and IIUC the security properties of ShadowRealms need the realm to not share a module map with any other realms","msgtype":"m.text"},"m.relates_to":{"event_id":"$GF3eOVrlEKjARnw3sx6SLqU21U_JpDhAaCl7_vp5sfg","rel_type":"m.replace"},"msgtype":"m.text"},"ts":1639329237865,"senderName":"Andreu Botella (he/they)","senderId":"@andreubotella:mozilla.org","id":"$dmIUuCH8yEwOYChkd7hH1KMdiPp6RVHEwUbs46Py2lA"},
{"content":{"body":"Also, the HTML spec's implementation of `HostResolveImportedModules` doesn't follow the requirements, since it always uses the current realm's module map, and if `referencingScriptOrModule` is `null`, that might result in different calls to that operation returning different module records","format":"org.matrix.custom.html","formatted_body":"Also, the HTML spec's implementation of <code>HostResolveImportedModules</code> doesn't follow the requirements, since it always uses the current realm's module map, and if <code>referencingScriptOrModule</code> is <code>null</code>, that might result in different calls to that operation returning different module records","msgtype":"m.text"},"ts":1639330031442,"senderName":"Andreu Botella (he/they)","senderId":"@andreubotella:mozilla.org","id":"$BEjgXaE61Y2HXBDItVJETFOSuWFFZba9a16UHggg9YU"},
{"content":{"body":"I'd argue that's a bug with the TC39 spec","msgtype":"m.text"},"ts":1639330050027,"senderName":"Andreu Botella (he/they)","senderId":"@andreubotella:mozilla.org","id":"$AMdEnMOu_BoUMSyYCB4vXu8qZyFcXliWSFEILWYMbV4"},
{"content":{"body":"> <@andreubotella:mozilla.org> and IIUC the security properties of ShadowRealms need the realm to not share a module map with any other realms\n\nThat is not my understanding. What made you think this? My recollection is that the shadow realms would share a module map, but would be keyed by realm. Cc leobalter ","format":"org.matrix.custom.html","formatted_body":"<mx-reply><blockquote><a href=\"https://matrix.to/#/!wbACpffbfxANskIFZq:matrix.org/$GF3eOVrlEKjARnw3sx6SLqU21U_JpDhAaCl7_vp5sfg?via=matrix.org&via=mozilla.org&via=igalia.com\">In reply to</a> <a href=\"https://matrix.to/#/@andreubotella:mozilla.org\">@andreubotella:mozilla.org</a><br />and IIUC the security properties of ShadowRealms need the realm to not share a module map with any other realms</blockquote></mx-reply>That is not my understanding. What made you think this? My recollection is that the shadow realms would share a module map, but would be keyed by realm. Cc leobalter ","m.relates_to":{"m.in_reply_to":{"event_id":"$GF3eOVrlEKjARnw3sx6SLqU21U_JpDhAaCl7_vp5sfg"}},"msgtype":"m.text"},"ts":1639340458632,"senderName":"Mathieu Hofman","senderId":"@mhofman:matrix.org","id":"$uwx-ZYrmIncZN05LLcVeLk8ciWQYLhbV3RuB6r8utjg"},
{"content":{"body":"I believe this is the issue where it was discussed: https://github.com/tc39/proposal-shadowrealm/issues/261","msgtype":"m.text"},"ts":1639340667686,"senderName":"Mathieu Hofman","senderId":"@mhofman:matrix.org","id":"$-oWIskbrhZ1_EWHhlRMQzDAqLEsIR3d-kI-Av1UHIMk"},
{"content":{"body":"I think there is a related whatwg issue","msgtype":"m.text"},"ts":1639340678722,"senderName":"Mathieu Hofman","senderId":"@mhofman:matrix.org","id":"$F5lzhtwwF9M9nFcbeMytNZ3XGa8iR6EkbzynNcTo8Z0"},
{"content":{"body":"I believe this comment on the integration PR: https://github.com/whatwg/html/pull/5339#issuecomment-874588585","msgtype":"m.text"},"ts":1639340834932,"senderName":"Mathieu Hofman","senderId":"@mhofman:matrix.org","id":"$cjYqe1OsOnn-vMleYiSl2dK8pF_kuQ0u9XjcYcbyHZA"},
{"content":{"body":"Thanks for those links, I hadn't been following the conversations and was trying to figure out how things worked purely from the spec proposal and how it interacts with the HTML spec as it is currently","msgtype":"m.text"},"ts":1639340898639,"senderName":"Andreu Botella (he/they)","senderId":"@andreubotella:mozilla.org","id":"$uNGmDJ5crwZrLf_sUi8SaqwMaVCmYxPQ8mPlHCCaSNM"},
{"content":{"body":"But my understanding was that, if a module is first instantiated in the parent realm, and then imported from a ShadowRealm, you could access the parent realm's intrinsic objects that way","msgtype":"m.text"},"ts":1639340937271,"senderName":"Andreu Botella (he/they)","senderId":"@andreubotella:mozilla.org","id":"$pEJB8kPxVHeYxiioa68rLyMnMx4HMZQdfe8ltdr_twI"},
{"content":{"body":"I don't think there's anything to stop that currently","msgtype":"m.text"},"ts":1639340944890,"senderName":"Andreu Botella (he/they)","senderId":"@andreubotella:mozilla.org","id":"$ZvTrAX2lltvArCWWNF_Yt6HfJ-n9BVLfbbfRIUGHm-o"},
{"content":{"body":"Ah no, you don't get the same module instance. It's keyed on the realm. But the resolution is shared per document","msgtype":"m.text"},"ts":1639341394840,"senderName":"Mathieu Hofman","senderId":"@mhofman:matrix.org","id":"$-NjXLhIbqPFezrQvKn6_NlDykmk-bNhsoecpNSD0o2U"},
{"content":{"body":"oh, so the actual fetch for a module script only happens once per document, but you have different module records per realm?","msgtype":"m.text"},"ts":1639341445173,"senderName":"Andreu Botella (he/they)","senderId":"@andreubotella:mozilla.org","id":"$oeu7FIPNVJtL5xtK7kBwwn2MtEMs-tuNshTyHkC9mS4"},
{"content":{"body":"So you can observe with timing if the parent has the module in it's map, but you never directly share any objects","msgtype":"m.text"},"ts":1639341453145,"senderName":"Mathieu Hofman","senderId":"@mhofman:matrix.org","id":"$skeg4AyNiwJ5Q_YPbH55nvyezzNPwr0m9KSySn-SwaE"},
{"content":{"body":"But in that case, `HostResolveImportedModules` would still need to say something about realms","format":"org.matrix.custom.html","formatted_body":"But in that case, <code>HostResolveImportedModules</code> would still need to say something about realms","msgtype":"m.text"},"ts":1639341634704,"senderName":"Andreu Botella (he/they)","senderId":"@andreubotella:mozilla.org","id":"$Nmt1IzEZL4i7lFJg2L89Gmf3k_YHt89xm2OIClEItyI"},
{"content":{"body":"I filed https://github.com/tc39/proposal-shadowrealm/issues/342","msgtype":"m.text"},"ts":1639346786017,"senderName":"Andreu Botella (he/they)","senderId":"@andreubotella:mozilla.org","id":"$nfARgBMxmYyXtCwKD0eXo65qJLGesWiH8xCuQRuSUIg"}
]
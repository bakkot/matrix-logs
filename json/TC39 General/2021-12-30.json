[
{"content":{"body":"they're working on a new config system, and it supports ESM, and thus it has to be async","msgtype":"m.text"},"ts":1640849979133,"senderName":"ljharb","senderId":"@ljharb:matrix.org","id":"$8H9IA3CBtobPGq5-KCreMbNh07GnjnyA5RlHJHR6oTQ"},
{"content":{"body":"so i don't see why they'd be opposed to rules working that way","msgtype":"m.text"},"ts":1640849991348,"senderName":"ljharb","senderId":"@ljharb:matrix.org","id":"$EAV6qtOTVQOg_p-pVlxhg_jqY9L7RUqW2eGHCfhM_fo"},
{"content":{"body":"https://github.com/eslint/eslint/issues/15394#issuecomment-989410995","msgtype":"m.text"},"ts":1640850236741,"senderName":"bakkot","senderId":"@bakkot:matrix.org","id":"$wdqnk8_46IVnyAfsWuwe93IVo2Z0nQrlqtfNomoF_Eg"},
{"content":{"body":"¯\\_(ツ)_/¯","msgtype":"m.text"},"ts":1640850238566,"senderName":"bakkot","senderId":"@bakkot:matrix.org","id":"$ugAOOyLvt1aSKGz7QtlNWZRwhYRTD9xdQsOl1ympn5o"},
{"content":{"body":"i read your gensync thing and i still really don't understand the point. if you already have both a sync and async version, then sure, and if you only have a sync version, then it's pretty trivial to wrap that in an async function, but if you only have an async version then how can you make it sync?","msgtype":"m.text"},"ts":1640850269915,"senderName":"ljharb","senderId":"@ljharb:matrix.org","id":"$PZORRjRbGCTQh3KuU3mWLenpMcAOL3GdrRbSKqYakbc"},
{"content":{"body":"the idea is that sometimes your thing is async only because it needs to call a user-provided function, which may or may not be async","msgtype":"m.text"},"ts":1640850317446,"senderName":"bakkot","senderId":"@bakkot:matrix.org","id":"$RokMctU7sn0Trzs9E_ZLOrVdSfXx3jKqc2p7T-BrtcQ"},
{"content":{"body":"if the user-provided function is async, you of course need to be async","msgtype":"m.text"},"ts":1640850326445,"senderName":"bakkot","senderId":"@bakkot:matrix.org","id":"$NfLQKPauGDdiEg9HrEVdPH_YrKCaUKUHx_q1gk42dOQ"},
{"content":{"body":"if it is not, it is nice not to be","msgtype":"m.text"},"ts":1640850330606,"senderName":"bakkot","senderId":"@bakkot:matrix.org","id":"$zfyV-mdngMchPiT8UiF4KIVccHa9K-JF2WJs-pDdn8c"},
{"content":{"body":"(the post has a concrete example of when that might come up)","msgtype":"m.text"},"ts":1640850419964,"senderName":"bakkot","senderId":"@bakkot:matrix.org","id":"$YTijTZCTLKbbtb0iwjCr347OCsEDo7EakUOZLJoRlBw"},
{"content":{"body":"but like, if the user's providing a \"read file\" method, why wouldn't you just return whatever it returns?","msgtype":"m.text"},"ts":1640850516377,"senderName":"ljharb","senderId":"@ljharb:matrix.org","id":"$KhK1tK8oMek27bNNEVd84BQaRSdfmUXNn9C0xeTuAEQ"},
{"content":{"body":"like if it returns a promise, you return one, if not, not","msgtype":"m.text"},"ts":1640850524884,"senderName":"ljharb","senderId":"@ljharb:matrix.org","id":"$o7Ix1EpvXBmyQn_oqcjVrAyw71BN3nI_h9q5vYpzjAw"},
{"content":{"body":"because you need to do stuff with the thing inside the promise","msgtype":"m.text"},"ts":1640850600011,"senderName":"bakkot","senderId":"@bakkot:matrix.org","id":"$xDJ9pu2keQqOMKMhNk7zFygDrx_Fem2toaiFj4wU4fU"},
{"content":{"body":"i guess i'm just really not getting why this is an issue outside of what seems like a very rare use case - where a user is providing a maybe-sync maybe-async method, but you need to do processing on each result, and you can't call the function for the next result until you do that processing","msgtype":"m.text"},"ts":1640850619634,"senderName":"ljharb","senderId":"@ljharb:matrix.org","id":"$_1Bjy4kv7zoNyooOp6NLV8czm7poaLC1lO-EpUFyowk"},
{"content":{"body":"or why you couldn't have two interfaces - a sync one and an async one - that both share an internal processing function","msgtype":"m.text"},"ts":1640850654402,"senderName":"ljharb","senderId":"@ljharb:matrix.org","id":"$qQxDRE0vYm4IOYp9Ii6U_Ts84Gf1iz7thMf0L6Ows5c"},
{"content":{"body":"yes, you could split up all your code so that it is in continuation-passing style, and then invoke the callbacks synchronously when the result of the user-provided function is available synchronously, but the point of async-await is that writing CPS by hand sucks","msgtype":"m.text"},"ts":1640850687245,"senderName":"bakkot","senderId":"@bakkot:matrix.org","id":"$-2M1CEZE4yaPlzyDSl1oIXuw_n5__AiccIoQ6HxRZ1s"},
{"content":{"body":"I invite you to go through the exercise of refactoring the `getTransitiveDependencies` function so that it works that way; it is not a trivial refactor","format":"org.matrix.custom.html","formatted_body":"I invite you to go through the exercise of refactoring the <code>getTransitiveDependencies</code> function so that it works that way; it is not a trivial refactor","msgtype":"m.text"},"ts":1640850777396,"senderName":"bakkot","senderId":"@bakkot:matrix.org","id":"$qfOKrLv7wEpg2eY_9w2ZASevZeJABWR0kObj-wuz_-I"},
{"content":{"body":"this problem comes up basically any time you're writing a utility which takes a function as an argument and does something with the return value of that function; this is not rare, in my experience, though it may be in yours","msgtype":"m.text"},"ts":1640850881580,"senderName":"bakkot","senderId":"@bakkot:matrix.org","id":"$RJTppJV9y7wSb_LE5V9vx6jZEfEKLF_wn-nmmaEgHRQ"},
{"content":{"body":"certainly that's not rare in my experience, i do that all the time, but i've never had this problem come up before that i can recall","msgtype":"m.text"},"ts":1640850904704,"senderName":"ljharb","senderId":"@ljharb:matrix.org","id":"$4SIdkgRx6VJSsDWxy4sl66iipkjHWo6zevcKvLny2Qc"},
{"content":{"body":" but to be fair i almost never use async/await (altho i often work with promises)","msgtype":"m.text"},"ts":1640850935182,"senderName":"ljharb","senderId":"@ljharb:matrix.org","id":"$GshZrjzck5geHo8LEeJetPO695ScYHBck_tftn3yudY"},
{"content":{"body":"i also often write eslint code that works sync with dependencies - like the ExportsMap in eslint-plugin-import - but it doesn't accept a user-provided file reading mechanism, it just hardcodes it","msgtype":"m.text"},"ts":1640851002765,"senderName":"ljharb","senderId":"@ljharb:matrix.org","id":"$sTujIPXu7geDRs7DDbhgaSXQamSutoJifQX4Wly4c8I"},
{"content":{"body":"yeah, if you hardcode all your IO the issue comes up less; I generally try pretty hard to keep the IO at the boundaries, so that the core logic doesn't do any IO itself","msgtype":"m.text"},"ts":1640851086918,"senderName":"bakkot","senderId":"@bakkot:matrix.org","id":"$p91q8kdILMGifNyqZ3cP6LZngzllzUZbBk4PJE3mlh4"},
{"content":{"body":"except by invoking user-provided stuff","msgtype":"m.text"},"ts":1640851097677,"senderName":"bakkot","senderId":"@bakkot:matrix.org","id":"$P1N5KhUw1xT8aK9LHbfUFD2FpJFX_4dxWnowhfMQ3so"},
{"content":{"body":"it does still come up, though; the last time I ran into this problem was when I wanted to offload some expensive computation to a worker, which meant the result of the computation was suddenly async, and I had to go rewrite everything to add `async` in a bunch of places and the library was no longer usable in sync contexts","format":"org.matrix.custom.html","formatted_body":"it does still come up, though; the last time I ran into this problem was when I wanted to offload some expensive computation to a worker, which meant the result of the computation was suddenly async, and I had to go rewrite everything to add <code>async</code> in a bunch of places and the library was no longer usable in sync contexts","msgtype":"m.text"},"ts":1640851204153,"senderName":"bakkot","senderId":"@bakkot:matrix.org","id":"$hdefdyS3r2Z-7GJYHUaq6x9fn5yEngC46LPm-vtWJe0"},
{"content":{"body":" * it does still come up, though; the last time I ran into this problem was when I wanted to offload some expensive computation to a worker, which meant the result of the computation was suddenly async, and I had to go rewrite everything to add `async` in a bunch of places and the library was no longer usable in sync contexts","format":"org.matrix.custom.html","formatted_body":" * it does still come up, though; the last time I ran into this problem was when I wanted to offload some expensive computation to a worker, which meant the result of the computation was suddenly async, and I had to go rewrite everything to add <code>async</code> in a bunch of places and the library was no longer usable in sync contexts","m.new_content":{"body":"it does still come up, though; the last time I ran into this problem was when I wanted to offload some expensive computation to a worker, which meant the result of the computation was suddenly async, and I had to go rewrite everything to add `async` in a bunch of places and the library was no longer usable in sync contexts","format":"org.matrix.custom.html","formatted_body":"it does still come up, though; the last time I ran into this problem was when I wanted to offload some expensive computation to a worker, which meant the result of the computation was suddenly async, and I had to go rewrite everything to add <code>async</code> in a bunch of places and the library was no longer usable in sync contexts","msgtype":"m.text"},"m.relates_to":{"event_id":"$hdefdyS3r2Z-7GJYHUaq6x9fn5yEngC46LPm-vtWJe0","rel_type":"m.replace"},"msgtype":"m.text"},"ts":1640851222112,"senderName":"bakkot","senderId":"@bakkot:matrix.org","id":"$MtPHzwj5MFhQgrQcC9bwP-vh-1EXuigLjYznqje97Dg"},
{"content":{"body":"why do you need `async` everywhere versus `return isPromise(p) ? p.then(f) : f(p)` or something?","format":"org.matrix.custom.html","formatted_body":"why do you need <code>async</code> everywhere versus <code>return isPromise(p) ? p.then(f) : f(p)</code> or something?","msgtype":"m.text"},"ts":1640851287448,"senderName":"ljharb","senderId":"@ljharb:matrix.org","id":"$HhYOBRsuepVIdOk5nYGWtRkr2pNJIHhMlavscMOo8tg"},
{"content":{"body":"because the function call is in the middle of a bunch of other logic","msgtype":"m.text"},"ts":1640851305762,"senderName":"bakkot","senderId":"@bakkot:matrix.org","id":"$b-iviQIJAZMFHh1ZFjNvRVBwuEryKYMm_ywl8JPiPvw"},
{"content":{"body":"```\nfor (let item of items) {\n  try {\n    let init = foo(item);\n    // 10 more lines here\n    result = await expensiveCompute(result, init);\n  } catch (e) {\n    // 10 more lines here\n  }\n}\n```","format":"org.matrix.custom.html","formatted_body":"<pre><code>for (let item of items) {\n  try {\n    let init = foo(item);\n    // 10 more lines here\n    result = await expensiveCompute(result, init);\n  } catch (e) {\n    // 10 more lines here\n  }\n}\n</code></pre>\n","msgtype":"m.text"},"ts":1640851387289,"senderName":"bakkot","senderId":"@bakkot:matrix.org","id":"$jnIvkR5GOxiSVOj8MLYf0p6FR7MhD-OGqfadhS_Zjqs"},
{"content":{"body":"it is definitely _possible_ to refactor this so that it just uses `.then` instead of `await`, but it's extremely annoying","format":"org.matrix.custom.html","formatted_body":"it is definitely <em>possible</em> to refactor this so that it just uses <code>.then</code> instead of <code>await</code>, but it's extremely annoying","msgtype":"m.text"},"ts":1640851423405,"senderName":"bakkot","senderId":"@bakkot:matrix.org","id":"$khFqUj4bETPWoxawdqpLc-OGHRnsKkDsCLK3mR5s_S4"},
{"content":{"body":" * ```\nfor (let item of items) {\n  try {\n    let init = foo(item);\n    // 10 more lines here\n    result = await expensiveCompute(result, init);\n  } catch (e) {\n    // 10 more lines here\n  }\n}\n```","format":"org.matrix.custom.html","formatted_body":" * <pre><code>for (let item of items) {\n  try {\n    let init = foo(item);\n    // 10 more lines here\n    result = await expensiveCompute(result, init);\n  } catch (e) {\n    // 10 more lines here\n  }\n}\n</code></pre>\n","m.new_content":{"body":"```\nfor (let item of items) {\n  try {\n    let init = foo(item);\n    // 10 more lines here\n    result = await expensiveCompute(result, init);\n  } catch (e) {\n    // 10 more lines here\n  }\n}\n```","format":"org.matrix.custom.html","formatted_body":"<pre><code>for (let item of items) {\n  try {\n    let init = foo(item);\n    // 10 more lines here\n    result = await expensiveCompute(result, init);\n  } catch (e) {\n    // 10 more lines here\n  }\n}\n</code></pre>\n","msgtype":"m.text"},"m.relates_to":{"event_id":"$jnIvkR5GOxiSVOj8MLYf0p6FR7MhD-OGqfadhS_Zjqs","rel_type":"m.replace"},"msgtype":"m.text"},"ts":1640851458198,"senderName":"bakkot","senderId":"@bakkot:matrix.org","id":"$1ik7aw-WIQ0xjxW7I7US3b7rzDn0Tc6uJ9N9U2WLxnc"}
]
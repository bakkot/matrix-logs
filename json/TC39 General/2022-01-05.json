[
{"content":{"body":"now I’m confused by the statement *“you can think of a `WeakSet` as a special case of `WeakMap` where all the values are booleans”* in https://v8.dev/features/weak-references","format":"org.matrix.custom.html","formatted_body":"now I’m confused by the statement <em>“you can think of a <code>WeakSet</code> as a special case of <code>WeakMap</code> where all the values are booleans”</em> in https://v8.dev/features/weak-references","msgtype":"m.text"},"ts":1641350954640,"senderName":"sideshowbarker","senderId":"@sideshowbarker:mozilla.org","id":"$cA27_oz3JsIKC2z74fRVssF0gVrEP9pJyjyE1OeBYLc"},
{"content":{"body":"Mathieu Hofman: ⬆️","format":"org.matrix.custom.html","formatted_body":"<a href=\"https://matrix.to/#/@mhofman:matrix.org\">Mathieu Hofman</a>: ⬆️","msgtype":"m.text"},"ts":1641350974442,"senderName":"sideshowbarker","senderId":"@sideshowbarker:mozilla.org","id":"$toxisY7EK8raZirAHFFt_y3jhLaxvbnGOQMUIQxBjd4"},
{"content":{"body":"I see nothing in the spec for `WeakSet` at https://tc39.es/ecma262/multipage/keyed-collections.html#sec-weakset-objects about the values being restricted to being booleans","format":"org.matrix.custom.html","formatted_body":"I see nothing in the spec for <code>WeakSet</code> at https://tc39.es/ecma262/multipage/keyed-collections.html#sec-weakset-objects about the values being restricted to being booleans","msgtype":"m.text"},"ts":1641351085108,"senderName":"sideshowbarker","senderId":"@sideshowbarker:mozilla.org","id":"$B6b1YOvNXCKemjcesZqkw8dD9aT62mPxj9c_Hp9nQvk"},
{"content":{"body":"or is that _“you can think of a WeakSet as a special case of WeakMap where all the values are booleans”_ statement just an odd way of saying you can think of a set as a map that only has keys without values?","format":"org.matrix.custom.html","formatted_body":"or is that <em>“you can think of a WeakSet as a special case of WeakMap where all the values are booleans”</em> statement just an odd way of saying you can think of a set as a map that only has keys without values?","msgtype":"m.text"},"ts":1641351504893,"senderName":"sideshowbarker","senderId":"@sideshowbarker:mozilla.org","id":"$_01oiTn221VClDM3gRR0TpgwtsRVl9aEE4kfv_9wd5M"},
{"content":{"body":" * or is that _“you can think of a WeakSet as a special case of WeakMap where all the values are booleans”_ statement just an odd way of saying you can think of a set as a map that only has keys without values?","format":"org.matrix.custom.html","formatted_body":" * or is that <em>“you can think of a WeakSet as a special case of WeakMap where all the values are booleans”</em> statement just an odd way of saying you can think of a set as a map that only has keys without values?","m.new_content":{"body":"or is that _“you can think of a WeakSet as a special case of WeakMap where all the values are booleans”_ statement just an odd way of saying you can think of a set as a map that only has keys without values?","format":"org.matrix.custom.html","formatted_body":"or is that <em>“you can think of a WeakSet as a special case of WeakMap where all the values are booleans”</em> statement just an odd way of saying you can think of a set as a map that only has keys without values?","msgtype":"m.text"},"m.relates_to":{"event_id":"$_01oiTn221VClDM3gRR0TpgwtsRVl9aEE4kfv_9wd5M","rel_type":"m.replace"},"msgtype":"m.text"},"ts":1641351518797,"senderName":"sideshowbarker","senderId":"@sideshowbarker:mozilla.org","id":"$kAFQBctRarOxjH5ddP_D4_kGuA1SmODzoMoN33QFeeA"},
{"content":{"body":"…and so, further in https://v8.dev/features/weak-references, I’m confused by the statement *“adding an object as a key to a `WeakMap` or `WeakSet` doesn’t prevent it from being garbage-collected”* — which makes sense for a `WeakMap` but does not seem to make sense for a `WeakSet`, since a `WeakSet` doesn’t have keys","format":"org.matrix.custom.html","formatted_body":"…and so, further in https://v8.dev/features/weak-references, I’m confused by the statement _“adding an object as a key to a _ — which makes sense for a <code>WeakMap</code> but does not seem to make sense for a <code>WeakSet</code>, since a <code>WeakSet</code> doesn’t have keys","msgtype":"m.text"},"ts":1641351891478,"senderName":"sideshowbarker","senderId":"@sideshowbarker:mozilla.org","id":"$jJ1HARyPPMTTWiWUEdqXuzsPlkMvJ4xLocgYsrvBbOU"},
{"content":{"body":"And then there’s *A JavaScript `WeakMap` is not really weak: it actually refers strongly to its contents as long as the key is alive* — which also makes sense just fine but would not seem to make sense for a `WeakSet`","format":"org.matrix.custom.html","formatted_body":"And then there’s <em>A JavaScript <code>WeakMap</code> is not really weak: it actually refers strongly to its contents as long as the key is alive</em> — which also makes sense just fine but would not seem to make sense for a <code>WeakSet</code>","msgtype":"m.text"},"ts":1641352069656,"senderName":"sideshowbarker","senderId":"@sideshowbarker:mozilla.org","id":"$80r8D2GE2eAkptWEAf6N17b2fzVD-ymV6GgWs5_Qkos"},
{"content":{"body":"It's like if WeakSet only had keys, no values","msgtype":"m.text"},"ts":1641352114637,"senderName":"Mathieu Hofman","senderId":"@mhofman:matrix.org","id":"$dvqcLn3rh5PBGyjr3IJE9THXlzJHPs1KDVR803SO57U"},
{"content":{"body":"ok","msgtype":"m.text"},"ts":1641352151361,"senderName":"sideshowbarker","senderId":"@sideshowbarker:mozilla.org","id":"$xXkc-HLR19KPaBOkrp7ma6bh-m2-5F_NvehB0yv5vHM"},
{"content":{"body":"I guess I’ll try writing up a concrete patch myself for the MDN `WeakMap` and `WeakSet` docs to make them accurate — and then to add the clarification about why they are not enumerated","format":"org.matrix.custom.html","formatted_body":"I guess I’ll try writing up a concrete patch myself for the MDN <code>WeakMap</code> and <code>WeakSet</code> docs to make them accurate — and then to add the clarification about why they are not enumerated","msgtype":"m.text"},"ts":1641352278553,"senderName":"sideshowbarker","senderId":"@sideshowbarker:mozilla.org","id":"$28Pdo47e-KArwUL8No2pGWUHMGKsew2ChcLtF8G9_qw"},
{"content":{"body":"I think the important part is that `WeakMap` and `WeakRef` provide orthogonal features.\n\nWeakMap allows associating data to objects in a way that doesn't prevent the object keys from being collected, even if the values in the weak map reference the keys. However, WeakMap doesn't allow observing the liveness of the keys, which is why it doesn't allow enumeration.\n\nWeakRef, being a real weak reference, allows to directly observe the liveness of an object. However you cannot build a `WeakMap` from `WeakRef` and `Map`, as that would prevent collection of cycles.\n\nYou could combine WeakRef and WeakMap to build an IterableWeakMap which allows enumeration. See https://github.com/tc39/proposal-weakrefs/#iterable-weakmaps","format":"org.matrix.custom.html","formatted_body":"<p>I think the important part is that <code>WeakMap</code> and <code>WeakRef</code> provide orthogonal features.</p>\n<p>WeakMap allows associating data to objects in a way that doesn't prevent the object keys from being collected, even if the values in the weak map reference the keys. However, WeakMap doesn't allow observing the liveness of the keys, which is why it doesn't allow enumeration.</p>\n<p>WeakRef, being a real weak reference, allows to directly observe the liveness of an object. However you cannot build a <code>WeakMap</code> from <code>WeakRef</code> and <code>Map</code>, as that would prevent collection of cycles.</p>\n<p>You could combine WeakRef and WeakMap to build an IterableWeakMap which allows enumeration. See https://github.com/tc39/proposal-weakrefs/#iterable-weakmaps</p>\n","msgtype":"m.text"},"ts":1641352976962,"senderName":"Mathieu Hofman","senderId":"@mhofman:matrix.org","id":"$NNm62JxNGRYUnCZ-UWRUoxSmXuHyWOKsw5fC8hg83Fo"}
]
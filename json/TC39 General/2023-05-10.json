[
{"content":{"body":"```\nfunction f(){}\nlet sym = Symbol();\nf[Symbol.toPrimitive] = () => sym;\nlet o = { [sym]: 0 };\nconsole.log(o[f]) // 0\n```\n... hm","format":"org.matrix.custom.html","formatted_body":"<pre><code>function f(){}\nlet sym = Symbol();\nf[Symbol.toPrimitive] = () =&gt; sym;\nlet o = { [sym]: 0 };\nconsole.log(o[f]) // 0\n</code></pre>\n<p>... hm</p>\n","msgtype":"m.text"},"ts":1683742359194,"senderName":"bakkot","senderId":"@bakkot:matrix.org","id":"$MZ9zngpEti8k5n-sGPRvA6829B0eqE-BReqBSSmt3Kg"},
{"content":{"body":"keying objects by functions","msgtype":"m.text"},"ts":1683742388679,"senderName":"bakkot","senderId":"@bakkot:matrix.org","id":"$VIEW5IFPW4-XOMdJtp8xniVtiqISkBZIyYC-mJ9W4qE"},
{"content":{"body":"kinda fun","msgtype":"m.text"},"ts":1683742389878,"senderName":"bakkot","senderId":"@bakkot:matrix.org","id":"$uSTtlOkXiHbf01aQ8gf_8J4PLKStUOkP-V32NLcE4Ho"},
{"content":{"body":"cursed","msgtype":"m.text"},"ts":1683742400443,"senderName":"shu","senderId":"@shuyuguo:matrix.org","id":"$DL7SxNgVKkB0ZpXa8Ew217bRLSwNLhPb05bzw0RS2nk"},
{"content":{"body":"```\nlet functorMapSymbol = Symbol('Functor.map');\nlet Functor = {};\nFunctor.map = function(rec, ...args){ return rec[functorMapSymbol](...args); };\nFunctor.map[Symbol.toPrimitive] = () => functorMapSymbol;\n\nlet o = {\n  [Functor.map](arg) {\n    console.log(arg);\n  },\n};\n\n// usage:\no[Functor.map]('hi');\n\n// alternative usage:\nFunctor.map(o, 'hi');\n```","format":"org.matrix.custom.html","formatted_body":"<pre><code>let functorMapSymbol = Symbol('Functor.map');\nlet Functor = {};\nFunctor.map = function(rec, ...args){ return rec[functorMapSymbol](...args); };\nFunctor.map[Symbol.toPrimitive] = () =&gt; functorMapSymbol;\n\nlet o = {\n  [Functor.map](arg) {\n    console.log(arg);\n  },\n};\n\n// usage:\no[Functor.map]('hi');\n\n// alternative usage:\nFunctor.map(o, 'hi');\n</code></pre>\n","msgtype":"m.text"},"ts":1683743240748,"senderName":"bakkot","senderId":"@bakkot:matrix.org","id":"$Nu-XC2M9fVukMQhSqWZ9Wgbfk2wSssuMJoicWs80OgI"},
{"content":{"body":"I actually do something similar to that all the time. Also use it to \"carry\" information in properties, something like { [property `my-prop` ({ enumerable: false })]: 10 }","format":"org.matrix.custom.html","formatted_body":"I actually do something similar to that all the time. Also use it to &quot;carry&quot; information in properties, something like { [property <code>my-prop</code> ({ enumerable: false })]: 10 }","msgtype":"m.text"},"ts":1683743350130,"senderName":"Francisco Tolmasky","senderId":"@tolmasky:matrix.org","id":"$KPZ4hLntH31NpwpFpIddZzkA05F1YblRaUHEqhkvAN0"},
{"content":{"body":" * I actually do something similar to that all the time. Also use it to \"carry\" information in properties, something like `{ [property \\`my-prop\\` ({ enumerable: false })]: 10 }`","format":"org.matrix.custom.html","formatted_body":" * I actually do something similar to that all the time. Also use it to &quot;carry&quot; information in properties, something like <code>{ [property \\</code>my-prop` ({ enumerable: false })]: 10 }`","m.new_content":{"body":"I actually do something similar to that all the time. Also use it to \"carry\" information in properties, something like `{ [property \\`my-prop\\` ({ enumerable: false })]: 10 }`","format":"org.matrix.custom.html","formatted_body":"I actually do something similar to that all the time. Also use it to &quot;carry&quot; information in properties, something like <code>{ [property \\</code>my-prop` ({ enumerable: false })]: 10 }`","msgtype":"m.text"},"m.relates_to":{"event_id":"$KPZ4hLntH31NpwpFpIddZzkA05F1YblRaUHEqhkvAN0","rel_type":"m.replace"},"msgtype":"m.text"},"ts":1683743378463,"senderName":"Francisco Tolmasky","senderId":"@tolmasky:matrix.org","id":"$BD3XAys42VtvPbLSgdNB563TIeo71rUDsKrTxNtOMFA"},
{"content":{"body":" * I actually do something similar to that all the time. Also use it to \"carry\" information in properties, something like `{ [property 'my-prop' ({ enumerable: false })\\]: 10 }\\`","format":"org.matrix.custom.html","formatted_body":" * I actually do something similar to that all the time. Also use it to &quot;carry&quot; information in properties, something like <code>{ [property 'my-prop' ({ enumerable: false })\\]: 10 }\\</code>","m.new_content":{"body":"I actually do something similar to that all the time. Also use it to \"carry\" information in properties, something like `{ [property 'my-prop' ({ enumerable: false })\\]: 10 }\\`","format":"org.matrix.custom.html","formatted_body":"I actually do something similar to that all the time. Also use it to &quot;carry&quot; information in properties, something like <code>{ [property 'my-prop' ({ enumerable: false })\\]: 10 }\\</code>","msgtype":"m.text"},"m.relates_to":{"event_id":"$KPZ4hLntH31NpwpFpIddZzkA05F1YblRaUHEqhkvAN0","rel_type":"m.replace"},"msgtype":"m.text"},"ts":1683743391241,"senderName":"Francisco Tolmasky","senderId":"@tolmasky:matrix.org","id":"$SCebvY9nAvAzKeQfpEgJ7XKNuf7IUWZvcEXKL3IJUgs"},
{"content":{"body":"dont know how to nest backticks, but you get the idea, you can have a function that creates metadata, then creates a custom symbol on the fly, associates the metadata to the custom symbol in a weakmap, then returns the custom symbol, then on the other end you can use it to retrieve the metadata","msgtype":"m.text"},"ts":1683743444792,"senderName":"Francisco Tolmasky","senderId":"@tolmasky:matrix.org","id":"$G59rAdlsPk1KDbYCutQkS1BUvU0zRoUQWq5ogzNkW3c"},
{"content":{"body":"for example like `Schema({ [property 'whatever'.readonly]: 10 })` (Schema then knows how to retrieve the metadata and construct the property descriptor from it to create the property on itself","format":"org.matrix.custom.html","formatted_body":"for example like <code>Schema({ [property 'whatever'.readonly]: 10 })</code> (Schema then knows how to retrieve the metadata and construct the property descriptor from it to create the property on itself","msgtype":"m.text"},"ts":1683743535246,"senderName":"Francisco Tolmasky","senderId":"@tolmasky:matrix.org","id":"$rea3cmZEw0VDQ95EMgmxGF4tZsAZ9L6OwSd3A42gncU"}
]
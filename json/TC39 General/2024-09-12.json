[
{"content":{"body":"A colleague wants to know if we've seen requests from developers, especially non-web JS developers like Node/Deno devs, for \"isolated module graphs\". That is, same-realm, but you can load a module multiple times in different graphs, executing its side effects each time.\n\nI suspect not much but I wanted to ask.","m.mentions":{},"msgtype":"m.text"},"ts":1726111184325,"senderName":"Domenic","senderId":"@domenicdenicola:matrix.org","id":"$47vixShW_x24YcUy1jTrdfcXh7C_qI4xCFCJwmfwWvE"},
{"content":{"body":"> <@domenicdenicola:matrix.org> A colleague wants to know if we've seen requests from developers, especially non-web JS developers like Node/Deno devs, for \"isolated module graphs\". That is, same-realm, but you can load a module multiple times in different graphs, executing its side effects each time.\n> \n> I suspect not much but I wanted to ask.\n\nNow that you mention it, if provided, I believe that this could be ergonomic for some use cases. I can't comment in detail","format":"org.matrix.custom.html","formatted_body":"<mx-reply><blockquote><a href=\"https://matrix.to/#/!wbACpffbfxANskIFZq:matrix.org/$47vixShW_x24YcUy1jTrdfcXh7C_qI4xCFCJwmfwWvE?via=matrix.org&via=mozilla.org&via=igalia.com\">In reply to</a> <a href=\"https://matrix.to/#/@domenicdenicola:matrix.org\">@domenicdenicola:matrix.org</a><br /><p>A colleague wants to know if we've seen requests from developers, especially non-web JS developers like Node/Deno devs, for &quot;isolated module graphs&quot;. That is, same-realm, but you can load a module multiple times in different graphs, executing its side effects each time.</p>\n<p>I suspect not much but I wanted to ask.</p></blockquote></mx-reply>Now that you mention it, if provided, I believe that this could be ergonomic for some use cases. I can't comment in detail","m.relates_to":{"m.in_reply_to":{"event_id":"$47vixShW_x24YcUy1jTrdfcXh7C_qI4xCFCJwmfwWvE"}},"msgtype":"m.text"},"ts":1726111775895,"senderName":"Eli Grey","senderId":"@eli-grey:matrix.org","id":"$2ligJVgetNGDJmLQ7rqQL3TwP9jor-VycC1Z-s86t0U"},
{"content":{"body":"* Now that you mention it, if provided, I believe that this could be ergonomic for some of my envisioned use cases. I can't comment in detail","m.new_content":{"body":"> <@domenicdenicola:matrix.org> A colleague wants to know if we've seen requests from developers, especially non-web JS developers like Node/Deno devs, for \"isolated module graphs\". That is, same-realm, but you can load a module multiple times in different graphs, executing its side effects each time.\n> \n> I suspect not much but I wanted to ask.\n\nNow that you mention it, if provided, I believe that this could be ergonomic for some of my envisioned use cases. I can't comment in detail","format":"org.matrix.custom.html","formatted_body":"<mx-reply><blockquote><a href=\"https://matrix.to/#/!wbACpffbfxANskIFZq:matrix.org/$47vixShW_x24YcUy1jTrdfcXh7C_qI4xCFCJwmfwWvE?via=matrix.org&via=mozilla.org&via=igalia.com\">In reply to</a> <a href=\"https://matrix.to/#/@domenicdenicola:matrix.org\">Domenic</a><br /><p>A colleague wants to know if we've seen requests from developers, especially non-web JS developers like Node/Deno devs, for &quot;isolated module graphs&quot;. That is, same-realm, but you can load a module multiple times in different graphs, executing its side effects each time.</p>\n<p>I suspect not much but I wanted to ask.</p></blockquote></mx-reply>Now that you mention it, if provided, I believe that this could be ergonomic for some of my envisioned use cases. I can't comment in detail","msgtype":"m.text"},"m.relates_to":{"event_id":"$2ligJVgetNGDJmLQ7rqQL3TwP9jor-VycC1Z-s86t0U","rel_type":"m.replace"},"msgtype":"m.text"},"ts":1726111839260,"senderName":"Eli Grey","senderId":"@eli-grey:matrix.org","id":"$_xVDb29G62vakaDWFfUnFHliRd9SoqciHxtwlZNE2GI"},
{"content":{"body":"> <@domenicdenicola:matrix.org> A colleague wants to know if we've seen requests from developers, especially non-web JS developers like Node/Deno devs, for \"isolated module graphs\". That is, same-realm, but you can load a module multiple times in different graphs, executing its side effects each time.\n> \n> I suspect not much but I wanted to ask.\n\nThat's one of the goals we have for [evaluators](https://github.com/tc39/proposal-compartments/blob/master/3-evaluator.md), a part of the module harmony effort. It's particularly useful when used with a different global object, and forms the basis of compartments. A shim for compartments has been used in different production environments for light weight isolation of independent parties (in our case combined with frozen intrinsics).","format":"org.matrix.custom.html","formatted_body":"<mx-reply><blockquote><a href=\"https://matrix.to/#/!wbACpffbfxANskIFZq:matrix.org/$47vixShW_x24YcUy1jTrdfcXh7C_qI4xCFCJwmfwWvE?via=matrix.org&via=mozilla.org&via=igalia.com\">In reply to</a> <a href=\"https://matrix.to/#/@domenicdenicola:matrix.org\">@domenicdenicola:matrix.org</a><br /><p>A colleague wants to know if we've seen requests from developers, especially non-web JS developers like Node/Deno devs, for &quot;isolated module graphs&quot;. That is, same-realm, but you can load a module multiple times in different graphs, executing its side effects each time.</p>\n<p>I suspect not much but I wanted to ask.</p></blockquote></mx-reply>That's one of the goals we have for <a href=\"https://github.com/tc39/proposal-compartments/blob/master/3-evaluator.md\">evaluators</a>, a part of the module harmony effort. It's particularly useful when used with a different global object, and forms the basis of compartments. A shim for compartments has been used in different production environments for light weight isolation of independent parties (in our case combined with frozen intrinsics).","m.relates_to":{"m.in_reply_to":{"event_id":"$47vixShW_x24YcUy1jTrdfcXh7C_qI4xCFCJwmfwWvE"}},"msgtype":"m.text"},"ts":1726116484234,"senderName":"Mathieu Hofman","senderId":"@mhofman:matrix.org","id":"$JCdZBKCHU0vifmnQuSIv4Yu5EwrKWdbmSBTN3-ChVsA"},
{"content":{"body":"This is specifically about within a single realm.","m.mentions":{},"msgtype":"m.text"},"ts":1726116675264,"senderName":"Domenic","senderId":"@domenicdenicola:matrix.org","id":"$NIJgsYcOb8CS11BXVmexPJfXNJoXqc0c8RbekllDAyQ"},
{"content":{"body":"Perhaps it would be useful for hot-reloading.","msgtype":"m.text"},"ts":1726116808780,"senderName":"Rob Palmer","senderId":"@robpalme:matrix.org","id":"$lNRzfJZPfDFr184hedSdLMi9Koowee-inPS4MO-ihq8"},
{"content":{"body":"> <@domenicdenicola:matrix.org> A colleague wants to know if we've seen requests from developers, especially non-web JS developers like Node/Deno devs, for \"isolated module graphs\". That is, same-realm, but you can load a module multiple times in different graphs, executing its side effects each time.\n> \n> I suspect not much but I wanted to ask.\n\nThis idea has come up a few times, and it certainly does work in Node.js and Deno (and I think bun maybe?) when a query string or fragment is used in the import specifier:\n\n```\n// b.mjs\nexport default import.meta.url\n\n// a.mjs\nimport * as a from './b.mjs?1';\nimport * as b from './b.mjs?2';\nconsole.log(a, b);\n```\n\nWe end up with multiple instances of the same module loaded and evaluated as entirely different instances.\n\nThat said, I've not seen much practical use of this outside of some A/B testing and experimentation.","format":"org.matrix.custom.html","formatted_body":"<mx-reply><blockquote><a href=\"https://matrix.to/#/!wbACpffbfxANskIFZq:matrix.org/$47vixShW_x24YcUy1jTrdfcXh7C_qI4xCFCJwmfwWvE?via=matrix.org&via=mozilla.org&via=igalia.com\">In reply to</a> <a href=\"https://matrix.to/#/@domenicdenicola:matrix.org\">@domenicdenicola:matrix.org</a><br>A colleague wants to know if we&#39;ve seen requests from developers, especially non-web JS developers like Node/Deno devs, for &quot;isolated module graphs&quot;. That is, same-realm, but you can load a module multiple times in different graphs, executing its side effects each time.<br/><br/>I suspect not much but I wanted to ask.</blockquote></mx-reply><p>This idea has come up a few times, and it certainly does work in Node.js and Deno (and I think bun maybe?) when a query string or fragment is used in the import specifier:</p>\n<pre><code>// b.mjs\nexport default import.meta.url\n\n// a.mjs\nimport * as a from './b.mjs?1';\nimport * as b from './b.mjs?2';\nconsole.log(a, b);\n</code></pre>\n<p>We end up with multiple instances of the same module loaded and evaluated as entirely different instances.</p>\n<p>That said, I've not seen much practical use of this outside of some A/B testing and experimentation.</p>\n","m.mentions":{"user_ids":["@domenicdenicola:matrix.org"]},"m.relates_to":{"m.in_reply_to":{"event_id":"$47vixShW_x24YcUy1jTrdfcXh7C_qI4xCFCJwmfwWvE"}},"msgtype":"m.text"},"ts":1726119498574,"senderName":"James M Snell","senderId":"@jasnell:matrix.org","id":"$qCiGcOnNfsmmecX0W73sBzXCEvUg8oKVBBa8a9mh_D4"},
{"content":{"body":"> <@domenicdenicola:matrix.org> This is specifically about within a single realm.\n\nYes, what I'm describing is within a single realm.","format":"org.matrix.custom.html","formatted_body":"<mx-reply><blockquote><a href=\"https://matrix.to/#/!wbACpffbfxANskIFZq:matrix.org/$NIJgsYcOb8CS11BXVmexPJfXNJoXqc0c8RbekllDAyQ?via=matrix.org&via=mozilla.org&via=igalia.com\">In reply to</a> <a href=\"https://matrix.to/#/@domenicdenicola:matrix.org\">@domenicdenicola:matrix.org</a><br />This is specifically about within a single realm.</blockquote></mx-reply>Yes, what I'm describing is within a single realm.","m.relates_to":{"m.in_reply_to":{"event_id":"$NIJgsYcOb8CS11BXVmexPJfXNJoXqc0c8RbekllDAyQ"}},"msgtype":"m.text"},"ts":1726121759065,"senderName":"Mathieu Hofman","senderId":"@mhofman:matrix.org","id":"$cCcblGFG4fllataz7BIXDY6n9s0r9ddqsSSuA4iS0vQ"},
{"content":{"body":"You're... planning to break the realm <-> global object correspondence??!","m.mentions":{},"msgtype":"m.text"},"ts":1726121778258,"senderName":"Domenic","senderId":"@domenicdenicola:matrix.org","id":"$Iylg8unLRS7e76fBmPeLHoGDJ90vAFNJQ4fT_Mz9Oiw"},
{"content":{"body":"Correct. A compartment can have a different global object. It's basically a set of evaluators which execute with that object as the global","msgtype":"m.text"},"ts":1726121947983,"senderName":"Mathieu Hofman","senderId":"@mhofman:matrix.org","id":"$YlHEqd9s0DcHZ83nQZ3FrXnmF9H9QXZVeVRR6H3udy0"}
]
[
{"content":{"body":"@snek Do you mean 3600WsÂ¯Â¹s?","m.mentions":{},"msgtype":"m.text"},"ts":1763605088875,"senderName":"whosy","senderId":"@whosy:matrix.org","id":"$SY-TK86XErGC_RyjKZugDzDkagiorKPqMY8rcqtIDbI"},
{"content":{"body":"* snek:  Do you mean 3600WsÂ¯Â¹s?","format":"org.matrix.custom.html","formatted_body":"* <a href=\"https://matrix.to/#/@devsnek:matrix.org\">snek</a>:  Do you mean 3600WsÂ¯Â¹s?","m.mentions":{"user_ids":["@devsnek:matrix.org"]},"m.new_content":{"body":"snek:  Do you mean 3600WsÂ¯Â¹s?","format":"org.matrix.custom.html","formatted_body":"<a href=\"https://matrix.to/#/@devsnek:matrix.org\">snek</a>:  Do you mean 3600WsÂ¯Â¹s?","m.mentions":{"user_ids":["@devsnek:matrix.org"]},"msgtype":"m.text"},"m.relates_to":{"event_id":"$SY-TK86XErGC_RyjKZugDzDkagiorKPqMY8rcqtIDbI","rel_type":"m.replace"},"msgtype":"m.text"},"ts":1763605096270,"senderName":"whosy","senderId":"@whosy:matrix.org","id":"$9_2aTnFc4PjliDSvWjtSYtWs7bPMagbXXf2ks3FoKaE"},
{"content":{"body":"* snek:  Do you mean 3600JsÂ¯Â¹s?","format":"org.matrix.custom.html","formatted_body":"* <a href=\"https://matrix.to/#/@devsnek:matrix.org\">snek</a>:  Do you mean 3600JsÂ¯Â¹s?","m.mentions":{},"m.new_content":{"body":"snek:  Do you mean 3600JsÂ¯Â¹s?","format":"org.matrix.custom.html","formatted_body":"<a href=\"https://matrix.to/#/@devsnek:matrix.org\">snek</a>:  Do you mean 3600JsÂ¯Â¹s?","m.mentions":{"user_ids":["@devsnek:matrix.org"]},"msgtype":"m.text"},"m.relates_to":{"event_id":"$SY-TK86XErGC_RyjKZugDzDkagiorKPqMY8rcqtIDbI","rel_type":"m.replace"},"msgtype":"m.text"},"ts":1763605117081,"senderName":"whosy","senderId":"@whosy:matrix.org","id":"$COtKGPGXaAns_ieqwZEMEus8wAzhCraIGWcC7rL3hyQ"},
{"content":{"body":":>","m.mentions":{},"msgtype":"m.text"},"ts":1763605123772,"senderName":"snek","senderId":"@devsnek:matrix.org","id":"$qQq65DM4gLuRXYaklBDLFZ4EhKqb77MXAUujyztCjho"},
{"content":{"body":"Mmyup, I indeed just had a bug in my code and got quite confused about the incorrect description comment.","m.mentions":{"user_ids":["@iain:mozilla.org"]},"m.relates_to":{"m.in_reply_to":{"event_id":"$_LDPxi4XfK9W02SxCd_tibbBW4KPynKNr4aadrxEBTs"}},"msgtype":"m.text"},"ts":1763622122684,"senderName":"Aapo Alasuutari","senderId":"@aapo.alasuutari:matrix.org","id":"$bB82UNiq_v_yfks7BrvO0N1MjFdVhvvGYHGyCwebd2c"},
{"content":{"body":"On a related note, the `INTERPRETING.md` is a little out of date, eg. broadcast doesn't take or pass two parameters but instead just takes and passes a single SharedArrayBuffer between agents.\n\nAlso the document is seemingly missing a note about `setTimeout` which seems to be a requirement for a whopping three `waitAsync` tests. `atomicsHelper.js` does set up a custom `setTimeout` function if none exist in the global but that function is based on just `Promise.resolve().then(cb)`'ing recursively. That exercises the microtask queue until timeout, which means that the `Atomics.waitAsync` timeouts that the test is exercising do not get a chance to run (best as I can tell anyway). eg. Running the test in Node with the custom `setTimeout` function used unconditionally fails from a timeout.","format":"org.matrix.custom.html","formatted_body":"<p>On a related note, the <code>INTERPRETING.md</code> is a little out of date, eg. broadcast doesn't take or pass two parameters but instead just takes and passes a single SharedArrayBuffer between agents.</p>\n<p>Also the document is seemingly missing a note about <code>setTimeout</code> which seems to be a requirement for a whopping three <code>waitAsync</code> tests. <code>atomicsHelper.js</code> does set up a custom <code>setTimeout</code> function if none exist in the global but that function is based on just <code>Promise.resolve().then(cb)</code>'ing recursively. That exercises the microtask queue until timeout, which means that the <code>Atomics.waitAsync</code> timeouts that the test is exercising do not get a chance to run (best as I can tell anyway). eg. Running the test in Node with the custom <code>setTimeout</code> function used unconditionally fails from a timeout.</p>\n","m.mentions":{},"msgtype":"m.text"},"ts":1763622778689,"senderName":"Aapo Alasuutari","senderId":"@aapo.alasuutari:matrix.org","id":"$yE5qbDu0PGq1cQthxG0gp_cYyf4hh0wnvWb_dHeHTXc"},
{"content":{"body":"https://github.com/tc39/test262/pull/4692\nhttps://github.com/tc39/test262/pull/4693","m.mentions":{},"msgtype":"m.text"},"ts":1763624588530,"senderName":"Aapo Alasuutari","senderId":"@aapo.alasuutari:matrix.org","id":"$Pwm7o5nTBShsm0oxOE6bZkLfxuRiZXsp0iTMbKhtNH8"},
{"content":{"body":"> <@aapo.alasuutari:matrix.org> On a related note, the `INTERPRETING.md` is a little out of date, eg. broadcast doesn't take or pass two parameters but instead just takes and passes a single SharedArrayBuffer between agents.\n> \n> Also the document is seemingly missing a note about `setTimeout` which seems to be a requirement for a whopping three `waitAsync` tests. `atomicsHelper.js` does set up a custom `setTimeout` function if none exist in the global but that function is based on just `Promise.resolve().then(cb)`'ing recursively. That exercises the microtask queue until timeout, which means that the `Atomics.waitAsync` timeouts that the test is exercising do not get a chance to run (best as I can tell anyway). eg. Running the test in Node with the custom `setTimeout` function used unconditionally fails from a timeout.\n\n> That exercises the microtask queue until timeout, which means that the Atomics.waitAsync timeouts that the test is exercising do not get a chance to run (best as I can tell anyway).\n\nIs that the correct behaviour? I would expect the event loop to interweave promise jobs with timeout jobs instead of trying to execute all pending promise jobs first","format":"org.matrix.custom.html","formatted_body":"<mx-reply><blockquote><a href=\"https://matrix.to/#/!wbACpffbfxANskIFZq:matrix.org/$yE5qbDu0PGq1cQthxG0gp_cYyf4hh0wnvWb_dHeHTXc?via=matrix.org&via=mozilla.org&via=igalia.com\">In reply to</a> <a href=\"https://matrix.to/#/@aapo.alasuutari:matrix.org\">@aapo.alasuutari:matrix.org</a><br><p>On a related note, the <code>INTERPRETING.md</code> is a little out of date, eg. broadcast doesn't take or pass two parameters but instead just takes and passes a single SharedArrayBuffer between agents.</p>\n<p>Also the document is seemingly missing a note about <code>setTimeout</code> which seems to be a requirement for a whopping three <code>waitAsync</code> tests. <code>atomicsHelper.js</code> does set up a custom <code>setTimeout</code> function if none exist in the global but that function is based on just <code>Promise.resolve().then(cb)</code>'ing recursively. That exercises the microtask queue until timeout, which means that the <code>Atomics.waitAsync</code> timeouts that the test is exercising do not get a chance to run (best as I can tell anyway). eg. Running the test in Node with the custom <code>setTimeout</code> function used unconditionally fails from a timeout.</p>\n</blockquote></mx-reply><blockquote>\n<p>That exercises the microtask queue until timeout, which means that the Atomics.waitAsync timeouts that the test is exercising do not get a chance to run (best as I can tell anyway).</p>\n</blockquote>\n<p>Is that the correct behaviour? I would expect the event loop to interweave promise jobs with timeout jobs instead of trying to execute all pending promise jobs first</p>\n","m.mentions":{"user_ids":["@aapo.alasuutari:matrix.org"]},"m.relates_to":{"m.in_reply_to":{"event_id":"$yE5qbDu0PGq1cQthxG0gp_cYyf4hh0wnvWb_dHeHTXc"}},"msgtype":"m.text"},"ts":1763651713942,"senderName":"Jedel","senderId":"@jedel:matrix.org","id":"$rhrj1wjka2BEtRJv1-lerPbcEZI2p556Dy6jiwc-wXo"},
{"content":{"body":"That does sound like yes, those 3 tests do seem to rely on the host providing a event loop with a timeout event ","format":"org.matrix.custom.html","formatted_body":"That does sound like yes, those 3 tests do seem to rely on the host providing a event loop with a timeout eventÂ ","msgtype":"m.text"},"ts":1763660539985,"senderName":"Ashley Claymore","senderId":"@aclaymore:matrix.org","id":"$VIdqYrjQ4Bi58lqx5mXUj4uL6_CWm_qV1anhNoC53p0"},
{"content":{"body":"trying to emulate such an environment purely within 262 is naturally quite a challenge as the language does not have an event loop ","format":"org.matrix.custom.html","formatted_body":"trying to emulate such an environment purely within 262 is naturally quite a challenge as the language does not have an event loopÂ ","msgtype":"m.text"},"ts":1763661026689,"senderName":"Ashley Claymore","senderId":"@aclaymore:matrix.org","id":"$CLqS4y91IXjfzNLV_86U9tvKD5GTPi6ZPCb-Xi7Ogm4"},
{"content":{"body":"Maybe there is a way to avoid the setTimeout dependency, or mock it using a subagent + broadcast - but that might mean the test uses the API under test to test that API ðŸŒ€","format":"org.matrix.custom.html","formatted_body":"Maybe there is a way to avoid the setTimeout dependency, or mock it using a subagent + broadcast - but that might mean the test uses the API under test to test that API ðŸŒ€","msgtype":"m.text"},"ts":1763661555533,"senderName":"Ashley Claymore","senderId":"@aclaymore:matrix.org","id":"$kAj8x_sS_76JSf_DYZU_xzB1VpWXglBTJuZfyK6YNs4"},
{"content":{"body":"* Maybe there is a way to avoid the setTimeout dependency, or mock it more faithfully using a subagent + broadcast - but that might mean the test uses the API under test to test that API ðŸŒ€","format":"org.matrix.custom.html","formatted_body":"* Maybe there is a way to avoid the setTimeout dependency, or mock it more faithfully using a subagent + broadcast - but that might mean the test uses the API under test to test that API ðŸŒ€","m.new_content":{"body":"Maybe there is a way to avoid the setTimeout dependency, or mock it more faithfully using a subagent + broadcast - but that might mean the test uses the API under test to test that API ðŸŒ€","format":"org.matrix.custom.html","formatted_body":"Maybe there is a way to avoid the setTimeout dependency, or mock it more faithfully using a subagent + broadcast - but that might mean the test uses the API under test to test that API ðŸŒ€","msgtype":"m.text"},"m.relates_to":{"event_id":"$kAj8x_sS_76JSf_DYZU_xzB1VpWXglBTJuZfyK6YNs4","rel_type":"m.replace"},"msgtype":"m.text"},"ts":1763661587180,"senderName":"Ashley Claymore","senderId":"@aclaymore:matrix.org","id":"$64MKz5zJJHAqlqc7jEiiH473403gAiFumGHZWid1PJ8"},
{"content":{"body":"it's true that the JS spec doesn't specify anything about the ordering of promise jobs vs other kinds of jobs, but HTML does run all of the \"microtasks\" (which do include promise jobs) before any other kind of task","m.mentions":{"user_ids":["@jedel:matrix.org"]},"m.relates_to":{"m.in_reply_to":{"event_id":"$rhrj1wjka2BEtRJv1-lerPbcEZI2p556Dy6jiwc-wXo"}},"msgtype":"m.text"},"ts":1763674331159,"senderName":"Andreu Botella (ðŸ•‘ JST, at TC39)","senderId":"@abotella:igalia.com","id":"$taGlU2uQFZcXORixBiWWbY28lfUZmcz0D6TxGdCxMWA"},
{"content":{"body":"* it's true that the JS spec doesn't specify anything about the ordering of promise jobs vs other kinds of jobs, but the HTML spec does say to run all of the \"microtasks\" (which include promise jobs) before any other kind of task","m.mentions":{},"m.new_content":{"body":"it's true that the JS spec doesn't specify anything about the ordering of promise jobs vs other kinds of jobs, but the HTML spec does say to run all of the \"microtasks\" (which include promise jobs) before any other kind of task","m.mentions":{"user_ids":["@jedel:matrix.org"]},"msgtype":"m.text"},"m.relates_to":{"event_id":"$taGlU2uQFZcXORixBiWWbY28lfUZmcz0D6TxGdCxMWA","rel_type":"m.replace"},"msgtype":"m.text"},"ts":1763674350511,"senderName":"Andreu Botella (ðŸ•‘ JST, at TC39)","senderId":"@abotella:igalia.com","id":"$AmgBYvWEsmFlbjVzQ8juJYY5qq6jbM4a4hIsYPYDwVU"},
{"content":{"body":"Which is of itself rather difficult for anything outside of browsers to follow. It's going to be nearly impossible to get consistency with that for stuff that needs to run across multiple runtimes :-/","m.mentions":{},"msgtype":"m.text"},"ts":1763675641433,"senderName":"James M Snell","senderId":"@jasnell:matrix.org","id":"$Ot19-no7cPiuFy48d15brQ-Gf1jFeuS6voBBpxDd2W8"},
{"content":{"body":"node.js, for instance, of course drains next ticks before microtasks and runs immediates and timers on an entirely separate mechanism","m.mentions":{},"msgtype":"m.text"},"ts":1763675670011,"senderName":"James M Snell","senderId":"@jasnell:matrix.org","id":"$HefELrJ__cCLQzyKrCZgmIMN_3kau0fYBvmWuspixqA"},
{"content":{"body":"leaving next ticks aside, I don't think node.js is inconsistent with the HTML spec here, because in HTML tasks are not a single queue, they're multiple task queues and it's up to the browser to decide which queue the next task comes from","m.mentions":{"user_ids":["@jasnell:matrix.org"]},"m.relates_to":{"m.in_reply_to":{"event_id":"$HefELrJ__cCLQzyKrCZgmIMN_3kau0fYBvmWuspixqA"}},"msgtype":"m.text"},"ts":1763675850579,"senderName":"Andreu Botella (ðŸ•‘ JST)","senderId":"@abotella:igalia.com","id":"$d06Em75QySOEPVtElgXrsx7rTgcOd6__jiHrNoo_dxQ"},
{"content":{"body":"Yeah, not inconsistent, just difficult at time to ensure the timing lines up","m.mentions":{},"msgtype":"m.text"},"ts":1763675938974,"senderName":"James M Snell","senderId":"@jasnell:matrix.org","id":"$y53XuXbr1L6QziXEeBWwqTaQoWlH86ioy2sYf-XvXYU"},
{"content":{"body":"it's an unfortunte sad reality that there's so much code out there... particularly in tests... that rely on assuming  strict ordering of timers and other tasks","m.mentions":{},"msgtype":"m.text"},"ts":1763675999429,"senderName":"James M Snell","senderId":"@jasnell:matrix.org","id":"$yka0B1RS0ZjSH0EZ69oWGhJY14cqrVw8zDIxoWakjic"},
{"content":{"body":"am i still needed for atomics or no, seems like confusion was resolved","m.mentions":{},"msgtype":"m.text"},"ts":1763679453572,"senderName":"shu","senderId":"@shuyuguo:matrix.org","id":"$dDslVfFAzc1UKn-h1UjxZRwHpKIbtBI_WuZeJ2UF4VM"}
]
[
{"content":{"body":"I'm observing that for-await...of loops don't call an async iterator's `return` method upon exhaustion, but do run async generator finally blocks. But don't these loops always call AsyncIteratorClose() (https://tc39.es/ecma262/#_ref_6951), which I think would indeed run the `return` method on any async iterator? What am I missing?","format":"org.matrix.custom.html","formatted_body":"I'm observing that for-await...of loops don't call an async iterator's <code>return</code> method upon exhaustion, but do run async generator finally blocks. But don't these loops always call AsyncIteratorClose() (https://tc39.es/ecma262/#_ref_6951), which I think would indeed run the <code>return</code> method on any async iterator? What am I missing?","m.mentions":{},"msgtype":"m.text"},"ts":1725980381786,"senderName":"Dominic Farolino","senderId":"@domfarolino:matrix.org","id":"$NMmLzdYlkq6GcH7fZl7v4H9p5F2ipjGaq4UQuslSo-Q"},
{"content":{"body":"They only call AsyncIteratorClose if you exit early (either due to an error in the head, or an error/return/break in the body)","m.mentions":{},"msgtype":"m.text"},"ts":1725981212662,"senderName":"nicolo-ribaudo","senderId":"@nicolo-ribaudo:matrix.org","id":"$g8T540_DZDShCs4KqoJH3K3AtKlrGll_BK_0EelK7Ag"},
{"content":{"body":"They still run finally blocks because they run as part of the evaluation of the async generator body before yielding control back to the for-await loop. The for-await loop doesn't \"see\" that the finally block exists","m.mentions":{},"msgtype":"m.text"},"ts":1725981263100,"senderName":"nicolo-ribaudo","senderId":"@nicolo-ribaudo:matrix.org","id":"$8NHa56g-mYI4NoMS7QZ18iz7wptZBikL_3-aMtH9XuU"},
{"content":{"body":"specifically the normal exit is step 6.e of ForIn/OfBodyEvaluation","m.mentions":{},"msgtype":"m.text"},"ts":1725981857022,"senderName":"bakkot","senderId":"@bakkot:matrix.org","id":"$gQ4aY09nCJcEnyLisgWHOi8TkQy3HuT2kOPAfWFJryI"},
{"content":{"body":"6.l is the `break` case","format":"org.matrix.custom.html","formatted_body":"6.l is the <code>break</code> case","m.mentions":{},"msgtype":"m.text"},"ts":1725981881452,"senderName":"bakkot","senderId":"@bakkot:matrix.org","id":"$2pyDbHwouBwU3K7F0MOeg53X_VVBGClKtTGXDqvfW2o"},
{"content":{"body":" * 6.l is the `break/throw/return` case","format":"org.matrix.custom.html","formatted_body":" * 6.l is the <code>break/throw/return</code> case","m.mentions":{},"m.new_content":{"body":"6.l is the `break/throw/return` case","format":"org.matrix.custom.html","formatted_body":"6.l is the <code>break/throw/return</code> case","m.mentions":{},"msgtype":"m.text"},"m.relates_to":{"event_id":"$2pyDbHwouBwU3K7F0MOeg53X_VVBGClKtTGXDqvfW2o","rel_type":"m.replace"},"msgtype":"m.text"},"ts":1725981924144,"senderName":"bakkot","senderId":"@bakkot:matrix.org","id":"$4C93rcngrxVtp1hh8sk3O2Po3RoZiBJys9WrDsYTDm0"}
]
[
{"content":{"body":"i wish there was a promise method like finally except it didn't propagate the exception and didn't mark the promise as \"handled\"","m.mentions":{},"msgtype":"m.text"},"ts":1741613444121,"senderName":"snek","senderId":"@devsnek:matrix.org","id":"$vrisv_8PLIfvHtHpqKrtKMekW6q2djSqzTkC7-zt1_g"},
{"content":{"body":"does anyone else wish this","m.mentions":{},"msgtype":"m.text"},"ts":1741613446952,"senderName":"snek","senderId":"@devsnek:matrix.org","id":"$I9Ufj6S4oxBXPJJa0Nf1L-qacH0gGdWuzUGPNm1XtyM"},
{"content":{"body":"what would it return?","format":"org.matrix.custom.html","formatted_body":"what would it return?","msgtype":"m.text"},"ts":1741625866398,"senderName":"Ashley Claymore","senderId":"@aclaymore:matrix.org","id":"$iuy70xuDA0YjKutkyEg_fMLYKBp_q-J2nqzskcMMu3c"},
{"content":{"body":"(when the promise was rejected)","m.mentions":{},"msgtype":"m.text"},"ts":1741626098638,"senderName":"Ashley Claymore","senderId":"@aclaymore:matrix.org","id":"$V9vz3I403H13fB4qc7AGfzRUYrHR-3aJj01nN0Oghk8"},
{"content":{"body":"> <@aclaymore:matrix.org> what would it return?\n\nundefined","format":"org.matrix.custom.html","formatted_body":"<mx-reply><blockquote><a href=\"https://matrix.to/#/!wbACpffbfxANskIFZq:matrix.org/$iuy70xuDA0YjKutkyEg_fMLYKBp_q-J2nqzskcMMu3c?via=matrix.org&via=mozilla.org&via=igalia.com\">In reply to</a> <a href=\"https://matrix.to/#/@aclaymore:matrix.org\">@aclaymore:matrix.org</a><br />what would it return?</blockquote></mx-reply>undefined","m.relates_to":{"m.in_reply_to":{"event_id":"$iuy70xuDA0YjKutkyEg_fMLYKBp_q-J2nqzskcMMu3c"}},"msgtype":"m.text"},"ts":1741645459330,"senderName":"snek","senderId":"@devsnek:matrix.org","id":"$EZkcnjM6OR43VqcomR7JU57SePADIFupZfHY3NKhYl8"},
{"content":{"body":"basically add the argument as a fulfill and reject handler, but don't create a new promise or update [[PromiseIsHandled]]","msgtype":"m.text"},"ts":1741645534501,"senderName":"snek","senderId":"@devsnek:matrix.org","id":"$boKhxlUANAmCK7WdtKkJSLRCpWBOMRXnY_dl9BSyfwo"},
{"content":{"body":"why?","m.mentions":{},"msgtype":"m.text"},"ts":1741646231883,"senderName":"ljharb","senderId":"@ljharb:matrix.org","id":"$iVnrcl2IZBmn8jLZDpb-gECRbwLJa1Fs3YknRHG_Z3I"},
{"content":{"body":"idk this is a thing i find myself wanting to do a lot when writing apis","m.mentions":{},"msgtype":"m.text"},"ts":1741646686073,"senderName":"snek","senderId":"@devsnek:matrix.org","id":"$QYCuJ2_jL__-Tnz7MAAiyiQ8J1emrKE6y6qVD-w9hhc"},
{"content":{"body":"When it comes to unhandled rejections, there are two reasonable design families and everything has somehow chosen the third. Every unhandled rejection is potentially eventually handled until post mortem finalization. From a debugging point of view, you either want silence (so real errors are not lost in noise errors) or interactivity. An interactive promise debugger shows you both “currently unhandled rejections” and “currently pending promises”, because both of these are ephemeral but at a moment in time might suggest a defect, either a forever-pending promise or never-handled-rejection.","m.mentions":{},"msgtype":"m.text"},"ts":1741647078249,"senderName":"kriskowal","senderId":"@kriskowal:aelf.land","id":"$xb183BGhVcf_AuzUDzMNsKiq0cjpqSOTsRT_4EodfTQ"},
{"content":{"body":"But lint rules for no-dangling-promises are good.","m.mentions":{},"msgtype":"m.text"},"ts":1741647104153,"senderName":"kriskowal","senderId":"@kriskowal:aelf.land","id":"$UveccGyhuIbKvi2V8EKiCXU7AaOMOimI6tKcnH9x-fo"},
{"content":{"body":"Returning promises in callbacks that dangle the promise is bad.","m.mentions":{},"msgtype":"m.text"},"ts":1741647126509,"senderName":"kriskowal","senderId":"@kriskowal:aelf.land","id":"$q83U_Xae0pBryD4DnNyPgT4cJBQQbURp8orYJj7OH_Q"},
{"content":{"body":"Like, the convenience of `addEventListener('click', async() => {})` is undeniable, but still wrong. The promise should get sunk, or verified to be unrejectable statically.","format":"org.matrix.custom.html","formatted_body":"Like, the convenience of <code>addEventListener('click', async() =&gt; {})</code> is undeniable, but still wrong. The promise should get sunk, or verified to be unrejectable statically.","m.mentions":{},"msgtype":"m.text"},"ts":1741647178323,"senderName":"kriskowal","senderId":"@kriskowal:aelf.land","id":"$JSLQYejhqDlCWvbjAbUSVC1juTQKG9FSmAmNKLrIhXw"},
{"content":{"body":"I did have a version of Q instrumented for a prototype Chrome extension that could give you the traces for all still-pending and still-unhandled promises. I do hope that idea makes its way to a nearby devtools.","m.mentions":{},"msgtype":"m.text"},"ts":1741647248864,"senderName":"kriskowal","senderId":"@kriskowal:aelf.land","id":"$1CU3e0L26BoXzncFnLOrvoXLMyvy7CcCta6ffARg1mE"},
{"content":{"body":"In the case of a CLI with no devtools attached, it’s very reasonable to defer reporting unhandled rejections until collection.","m.mentions":{},"msgtype":"m.text"},"ts":1741647341313,"senderName":"kriskowal","senderId":"@kriskowal:aelf.land","id":"$9ZnKI-jsNYyIRBqaEXqiyaphaUuM-0zToCFbGJvdFyY"},
{"content":{"body":"On the other hand, I’m torn regarding “send-only” promise handlers. In Q, `then` was not the bottom of the protocol, it was implemented in terms of `done`, which would register optional callback and optional errback, but didn’t create and return a composite promise. The expectation was that the callback and errback returned void. And the thenable protocol doesn’t actually expect more than the behavior of `done`, so you can write less wasteful promise handling.","format":"org.matrix.custom.html","formatted_body":"On the other hand, I’m torn regarding “send-only” promise handlers. In Q, <code>then</code> was not the bottom of the protocol, it was implemented in terms of <code>done</code>, which would register optional callback and optional errback, but didn’t create and return a composite promise. The expectation was that the callback and errback returned void. And the thenable protocol doesn’t actually expect more than the behavior of <code>done</code>, so you can write less wasteful promise handling.","m.mentions":{},"msgtype":"m.text"},"ts":1741647540479,"senderName":"kriskowal","senderId":"@kriskowal:aelf.land","id":"$6ZjU7Aj8U71fwSdrvavyW_WxTQWkBkp8XaD2ZKF2SXY"},
{"content":{"body":"*But* having both the `then` tower and the `done` or “then-only” towers implies a lot more combinators.","format":"org.matrix.custom.html","formatted_body":"<em>But</em> having both the <code>then</code> tower and the <code>done</code> or “then-only” towers implies a lot more combinators.","m.mentions":{},"msgtype":"m.text"},"ts":1741647632189,"senderName":"kriskowal","senderId":"@kriskowal:aelf.land","id":"$mM9vYaBX8jUFzE0TBsz36zp4SFag9bYffISHGugLSXM"},
{"content":{"body":"* _But_ having both the `then` tower and the `done` or “then-only” tower implies a lot more combinators.","format":"org.matrix.custom.html","formatted_body":"* <em>But</em> having both the <code>then</code> tower and the <code>done</code> or “then-only” tower implies a lot more combinators.","m.mentions":{},"m.new_content":{"body":"_But_ having both the `then` tower and the `done` or “then-only” tower implies a lot more combinators.","format":"org.matrix.custom.html","formatted_body":"<em>But</em> having both the <code>then</code> tower and the <code>done</code> or “then-only” tower implies a lot more combinators.","m.mentions":{},"msgtype":"m.text"},"m.relates_to":{"event_id":"$mM9vYaBX8jUFzE0TBsz36zp4SFag9bYffISHGugLSXM","rel_type":"m.replace"},"msgtype":"m.text"},"ts":1741647646175,"senderName":"kriskowal","senderId":"@kriskowal:aelf.land","id":"$d-taSvsr5jbo9wqC_me7n53Vl3HgF1Hgzj1ZVRo2Jfc"},
{"content":{"body":"In a more static language, you could have your cake and eat it, generating runtime variants of the promise-returning function that do and do not actually bother creating or returning the promise, ad nauseam.","m.mentions":{},"msgtype":"m.text"},"ts":1741647937466,"senderName":"kriskowal","senderId":"@kriskowal:aelf.land","id":"$EzPu_6-u24r98WbnESBoy3qzUCswtlA_lIDTvrWlPhY"},
{"content":{"body":"can't you return the promise with `.then()` on it, and *that* promise will be unhandled?","format":"org.matrix.custom.html","formatted_body":"can't you return the promise with <code>.then()</code> on it, and <em>that</em> promise will be unhandled?","m.mentions":{"user_ids":["@devsnek:matrix.org"]},"m.relates_to":{"m.in_reply_to":{"event_id":"$QYCuJ2_jL__-Tnz7MAAiyiQ8J1emrKE6y6qVD-w9hhc"}},"msgtype":"m.text"},"ts":1741648145530,"senderName":"ljharb","senderId":"@ljharb:matrix.org","id":"$1m9oHfZQK0CXN_dCdLNxDAkVZPVGNZTKTCHWT_fsWq4"}
]
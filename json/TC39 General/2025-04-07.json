[
{"content":{"body":"yes, this would definitely be good to do, IMO","m.mentions":{"user_ids":["@akaster:serenityos.org"]},"m.relates_to":{"m.in_reply_to":{"event_id":"$FUe1HS7ivsa_XUXcC4p35yIJ3pfL2N7DVJI9n4AOUPg"}},"msgtype":"m.text"},"ts":1743992939065,"senderName":"littledan","senderId":"@littledan:matrix.org","id":"$UkXaG-2uFLNLJIN8w8hxpHTBqObvpRsVXIOxB6HJAsE"},
{"content":{"body":"I noticed a probably-known implementation inconsistency with Float64Array sorting regarding NaNs: According to spec, any call to Float64Array should canonicalise all NaNs in the TA's viewed buffer since it copies data from the buffer into a list of Values (canonicalising all NaNs here), performs sorting on that list and then writes the sorted items back into the buffer.\n\nOn FF, a sort without a comparator seems to sort NaNs according to \"absolute value\" (uint64) while on Chrome they are left where they were. With a comparator (returning -1 or 1 randomly), on FF they NaNs become canonicalised while on Chrome they get sorted according to the comparator's wishes without canonicalisation.\n\nThe spec seems fairly clear to me on this whole issue; canonicalisation happens on every sort call, but the lived reality is different. Should this be accepted, or is this something to file a bug to implementors about (if not already existent)? Or should this be a case where the spec is loosened to allow for implementation defined behaviour?","m.mentions":{},"msgtype":"m.text"},"ts":1744006100533,"senderName":"Aapo Alasuutari","senderId":"@aapo.alasuutari:matrix.org","id":"$KMCjRFbbaaKv4k2WARMkhWFvJg9d2gDJ-2Si5PG9bTE"},
{"content":{"body":"Aapo Alasuutari: Seems like you should file issues against the implementations. Have you checked the JSC behaviour?","format":"org.matrix.custom.html","formatted_body":"<a href=\"https://matrix.to/#/@aapo.alasuutari:matrix.org\">@aapo.alasuutari:matrix.org</a>: Seems like you should file issues against the implementations. Have you checked the JSC behaviour?","msgtype":"m.text"},"ts":1744024408937,"senderName":"Michael Ficarra","senderId":"@michaelficarra:matrix.org","id":"$J6GzvMG3ROGX5Sl65qz3Ta3q5vjUVXOm7JP3EIDyr9Q"},
{"content":{"body":"Nope, I don't happen to have JSC at my fingertips quite the same as I have FF and Chrome.","m.mentions":{},"msgtype":"m.text"},"ts":1744024443830,"senderName":"Aapo Alasuutari","senderId":"@aapo.alasuutari:matrix.org","id":"$vuoG8uUOs8yx9Xh9plRa5gSWenTrZKDW5SkGwG4ZuGY"},
{"content":{"body":"Okay, non-buggy test code:\n```js\nb = BigUint64Array.of(9221120237041091055n, 9221120237041090774n);\nconsole.log(b[0], b[1]);\na = new Float64Array(b.buffer);\na.sort();\nconsole.log(b[0], b[1]);\na.sort(() => Math.random() ? -1 : 1);\nconsole.log(b[0], b[1]);\n```","format":"org.matrix.custom.html","formatted_body":"<p>Okay, non-buggy test code:</p>\n<pre><code class=\"language-js\">b = BigUint64Array.of(9221120237041091055n, 9221120237041090774n);\nconsole.log(b[0], b[1]);\na = new Float64Array(b.buffer);\na.sort();\nconsole.log(b[0], b[1]);\na.sort(() =&gt; Math.random() ? -1 : 1);\nconsole.log(b[0], b[1]);\n</code></pre>\n","m.mentions":{},"msgtype":"m.text"},"ts":1744024825694,"senderName":"Aapo Alasuutari","senderId":"@aapo.alasuutari:matrix.org","id":"$xSKc6ZvOvSTuzendB8h4ubmgpKFKdBArc8pSqQZHkdg"}
]
[
{"content":{"body":"fun use case for ShadowRealms: running code generated by an LLM https://simonwillison.net/2024/Oct/24/claude-analysis-tool/","m.mentions":{},"msgtype":"m.text"},"ts":1729882815467,"senderName":"bakkot","senderId":"@bakkot:matrix.org","id":"$wGSBxBGQy1pywEPFjMGVzBuKSpPj9cz0-7UayrKE4-w"},
{"content":{"body":"this didn't actually use ShadowRealms, presumably because they don't exist yet","m.mentions":{},"msgtype":"m.text"},"ts":1729882829113,"senderName":"bakkot","senderId":"@bakkot:matrix.org","id":"$AvQi9n6fqaFy3VyBNsziN02bOuXM_5nMAtCC1nNzn6o"},
{"content":{"body":"but same use case:\n\n> it executes that JavaScript directly in your browser—in a locked down Web Worker that communicates back to the main page by intercepting messages sent to console.log()","format":"org.matrix.custom.html","formatted_body":"<p>but same use case:</p>\n<blockquote>\n<p>it executes that JavaScript directly in your browser—in a locked down Web Worker that communicates back to the main page by intercepting messages sent to console.log()</p>\n</blockquote>\n","m.mentions":{},"msgtype":"m.text"},"ts":1729882845031,"senderName":"bakkot","senderId":"@bakkot:matrix.org","id":"$JEpWiXvHFuDV-XbbkLjWI9pBh6DwWCRECxOLBK0GbKQ"},
{"content":{"body":"though I guess you'd really also need the ability to kill long-running code, which means you'd need to use a realm in a worker, or something like that","m.mentions":{},"msgtype":"m.text"},"ts":1729882872705,"senderName":"bakkot","senderId":"@bakkot:matrix.org","id":"$WtIAmUQTu_RNuV2GQuSWs0mK9PIKOeohlBnvP6Kreqc"},
{"content":{"body":"yeah the early termination use case is surprisingly common i think","m.mentions":{},"msgtype":"m.text"},"ts":1729883248060,"senderName":"shu","senderId":"@shuyuguo:matrix.org","id":"$5CIII8_IOJe2QTqs2o-w7fBDi9ElyTWLGN8OgoHDWP8"},
{"content":{"body":"shadowrealms make that impossible because of the sync-ness","m.mentions":{},"msgtype":"m.text"},"ts":1729883255609,"senderName":"shu","senderId":"@shuyuguo:matrix.org","id":"$TFQwgZCRK_a0hfbPjXGsPY0Pko-09pudr0MGlpjQ_PE"},
{"content":{"body":"wonder if we could have something in the language for that... like, it is already the case that you might OOM at any point, so it probably isn't that destructive to the semantics of the language if we had a function that was like \"if, after this call, execution has not yet yielded, throw an exception wherever we currently are\"","m.mentions":{},"msgtype":"m.text"},"ts":1729883445823,"senderName":"bakkot","senderId":"@bakkot:matrix.org","id":"$qGrZmehI8M_sms-896sH-sA_OMUtIh_5epYHdi69ksY"},
{"content":{"body":"I guess that would be bad for engines though, since they do keep track of which things might oom more carefully","m.mentions":{},"msgtype":"m.text"},"ts":1729883578149,"senderName":"bakkot","senderId":"@bakkot:matrix.org","id":"$DE1AosflSUigGWACUHtJWORl8XfZSIiJm44CHqppy-4"},
{"content":{"body":"don't think i understand how that API works for something synchronous","m.mentions":{},"msgtype":"m.text"},"ts":1729883969911,"senderName":"shu","senderId":"@shuyuguo:matrix.org","id":"$JHJ-J7zMsjtKYRVigwUuwVomCqT76sYXBtf2EnDDGLw"},
{"content":{"body":"are you envisioning a timeout?","m.mentions":{},"msgtype":"m.text"},"ts":1729883976486,"senderName":"shu","senderId":"@shuyuguo:matrix.org","id":"$PXSSp3KAsxJdKgK5pr9FWel8TS1OeXqDG4VwzrVoEJU"},
{"content":{"body":"yes, a timeout","m.mentions":{},"msgtype":"m.text"},"ts":1729886364887,"senderName":"bakkot","senderId":"@bakkot:matrix.org","id":"$yzusseTaqDz7VhIxYDkoyOGvzsesvw3smKzlvh9xpY0"},
{"content":{"body":"which when reached interrupts the currently executing thing","m.mentions":{},"msgtype":"m.text"},"ts":1729886384092,"senderName":"bakkot","senderId":"@bakkot:matrix.org","id":"$76Ug57mVCGHfMwwpEWzBioVEHO9jsS4StBYHBWcxjN8"},
{"content":{"body":"and which gets automatically cleared whenever control is yielded to the event loop","m.mentions":{},"msgtype":"m.text"},"ts":1729886399023,"senderName":"bakkot","senderId":"@bakkot:matrix.org","id":"$UsnOYUJFDIc0TREjNM6uI8ibuEgKPLFlJQrfyKe5KL0"},
{"content":{"body":"ah okay, yeah, i would not be against","m.mentions":{},"msgtype":"m.text"},"ts":1729886402268,"senderName":"shu","senderId":"@shuyuguo:matrix.org","id":"$qTyNgvZ1clS7E51cbtZBzoFvPnW-oIya2uzoPUEBb5U"},
{"content":{"body":"in practice engines already have to bake in interrupt checks for GC if nothing else","m.mentions":{},"msgtype":"m.text"},"ts":1729886417646,"senderName":"shu","senderId":"@shuyuguo:matrix.org","id":"$Gd4zlE_1rYUQUvtQV1EDKLMftFtz7waNVhy8TpcxVYE"},
{"content":{"body":"the more intrusive change is to actually ensure there's such a thing a way to propagate termination","m.mentions":{},"msgtype":"m.text"},"ts":1729886446066,"senderName":"shu","senderId":"@shuyuguo:matrix.org","id":"$3Yhurig047FHwo0R-41EAesD-Lghqrt4CooszImvQR8"},
{"content":{"body":"every engine needs to propagate exceptions for throwing, but the default assumption is that such exceptions are catchable","m.mentions":{},"msgtype":"m.text"},"ts":1729886493470,"senderName":"shu","senderId":"@shuyuguo:matrix.org","id":"$o3tFjdDSpz0aKNXEePiBQTkV4h48XD71yhsJs5EqzAM"},
{"content":{"body":" * the more intrusive change is to actually ensure there's a way to propagate termination","m.mentions":{},"m.new_content":{"body":"the more intrusive change is to actually ensure there's a way to propagate termination","m.mentions":{},"msgtype":"m.text"},"m.relates_to":{"event_id":"$3Yhurig047FHwo0R-41EAesD-Lghqrt4CooszImvQR8","rel_type":"m.replace"},"msgtype":"m.text"},"ts":1729886515263,"senderName":"shu","senderId":"@shuyuguo:matrix.org","id":"$Ve6y65XuXMfrxLFvq1saDTs6f6esIS-XGjqzSlAwaxs"},
{"content":{"body":"Yeah I agree that this termination/timeout part is a common requirement; it came up when I was discussing ShadowRealm with Jason Miller of Shopify (I think they were working on a QuickJS-based thing because of ShadowRealms not existing + this termination requirement + a requirement to be synchronous)","msgtype":"m.text"},"ts":1729886762748,"senderName":"littledan","senderId":"@littledan:matrix.org","id":"$sYUZ712lKEyOd-81Pb4it9_i5dpeyxmNtwFUWSxHifY"},
{"content":{"body":"* Yeah I agree that this termination/timeout part is a common requirement","m.new_content":{"body":"Yeah I agree that this termination/timeout part is a common requirement","msgtype":"m.text"},"m.relates_to":{"event_id":"$sYUZ712lKEyOd-81Pb4it9_i5dpeyxmNtwFUWSxHifY","rel_type":"m.replace"},"msgtype":"m.text"},"ts":1729886905192,"senderName":"littledan","senderId":"@littledan:matrix.org","id":"$K-abhfgq2zrKfN65za73S0MjtxeMVBpUi4QYfww4FLQ"}
]
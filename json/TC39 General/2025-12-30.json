[
{"content":{"body":"Does anyone know what's the intended way to pass the test `staging/sm/lexical-environment/block-scoped-functions-deprecated-redecl.js`?\n\nIn it we have a block that contains two function declarations with the same name, tested in noStrict to not cause a syntax error. https://tc39.es/ecma262/#sec-blockdeclarationinstantiation just says to go through lexically scoped declarations of the block and CreateMutableBinding or CreateImmutableBinding for each. That goes into https://tc39.es/ecma262/#sec-declarative-environment-records-createmutablebinding-n-d which asserts that the envRec doesn't already have a binding for the given name; this assertion is triggered by the two functions of the same name, best as I can tell anyway.\n\nAm I holding the spec wrong, or is this something of a spec bug? The Annex B Block-Level Function Declarations Web Legacy Compatibility Semantics of course changes this (though I haven't grokked how exactly), but assuming that extension is not applied, how should an implementation handle duplicate functions without asserting and crashing?","format":"org.matrix.custom.html","formatted_body":"<p>Does anyone know what's the intended way to pass the test <code>staging/sm/lexical-environment/block-scoped-functions-deprecated-redecl.js</code>?</p>\n<p>In it we have a block that contains two function declarations with the same name, tested in noStrict to not cause a syntax error. https://tc39.es/ecma262/#sec-blockdeclarationinstantiation just says to go through lexically scoped declarations of the block and CreateMutableBinding or CreateImmutableBinding for each. That goes into https://tc39.es/ecma262/#sec-declarative-environment-records-createmutablebinding-n-d which asserts that the envRec doesn't already have a binding for the given name; this assertion is triggered by the two functions of the same name, best as I can tell anyway.</p>\n<p>Am I holding the spec wrong, or is this something of a spec bug? The Annex B Block-Level Function Declarations Web Legacy Compatibility Semantics of course changes this (though I haven't grokked how exactly), but assuming that extension is not applied, how should an implementation handle duplicate functions without asserting and crashing?</p>\n","m.mentions":{},"msgtype":"m.text"},"ts":1767118292352,"senderName":"Aapo Alasuutari","senderId":"@aapo.alasuutari:matrix.org","id":"$ablOYgntWYPXrX32fLnA0pcVSrY8blbql7NCKUfSL5Q"},
{"content":{"body":"I'm not sure we've actually reasoned through the non-Annex B semantics carefully, Annex B is the one ~all implementations actually use","m.mentions":{},"msgtype":"m.text"},"ts":1767118373481,"senderName":"bakkot","senderId":"@bakkot:matrix.org","id":"$KY21oDh735puzFgVEeJyisygRP-3_K5PFq9b-jKjncA"},
{"content":{"body":"I assume that test is intended to run under an implementation which follows Annex B, given that it comes from SpiderMonkey, which is such an implementation","m.mentions":{},"msgtype":"m.text"},"ts":1767118405920,"senderName":"bakkot","senderId":"@bakkot:matrix.org","id":"$kgqtpWiOWRQEUKwYP-7sLx5-IZAbajMh-Zz77LvIcf8"},
{"content":{"body":"Yeah, I phrased myself poorly: the test shouldn't pass without Annex B, but currently without Annex B it triggers a spec assertion.","m.mentions":{},"msgtype":"m.text"},"ts":1767119089884,"senderName":"Aapo Alasuutari","senderId":"@aapo.alasuutari:matrix.org","id":"$RM7o78jxd12HlJ9CuVHzD2TUtMm_UdVKoBxAwNkVw2M"},
{"content":{"body":"Or at least it does so in my implementation, and reading the spec that does _seem_ to be the correct thing to do.","format":"org.matrix.custom.html","formatted_body":"Or at least it does so in my implementation, and reading the spec that does <em>seem</em> to be the correct thing to do.","m.mentions":{},"msgtype":"m.text"},"ts":1767119136767,"senderName":"Aapo Alasuutari","senderId":"@aapo.alasuutari:matrix.org","id":"$Ov6w3qmF6NA4e_5Jicyaul4Zd6XCMJMADkmjCjo8lCM"},
{"content":{"body":"ah, it's because https://tc39.es/ecma262/multipage/ecmascript-language-statements-and-declarations.html#sec-block-static-semantics-early-errors","m.mentions":{},"msgtype":"m.text"},"ts":1767119397706,"senderName":"bakkot","senderId":"@bakkot:matrix.org","id":"$RtdnMMiwh03UurQC0semZPqChWilO-F6iVZDkGvGC54"},
{"content":{"body":"makes it a SyntaxError","m.mentions":{},"msgtype":"m.text"},"ts":1767119402433,"senderName":"bakkot","senderId":"@bakkot:matrix.org","id":"$rviBbmYokFLwYpUhTNUgI0YoQbmWZ0dPaulJ_5mGc_4"},
{"content":{"body":"so the assertion is valid: you're not supposed to get to the runtime semantics at all","m.mentions":{},"msgtype":"m.text"},"ts":1767119439458,"senderName":"bakkot","senderId":"@bakkot:matrix.org","id":"$Ky-SKfnvyvvyykITO_2EHU4LpHK7A_Tis4A4iRKaMzs"},
{"content":{"body":"also, oops, rendering's a bit weird there","m.mentions":{},"msgtype":"m.text"},"ts":1767119443835,"senderName":"bakkot","senderId":"@bakkot:matrix.org","id":"$YVFrxdmjHRAPEcGvk6AFDzUentg-QFIo94fS2rBUL0c"},
{"content":{"body":"Yup, surprisingly hard to read.\n\nRight okay, so it seems my syntax checking (3rd party :) ) is assuming Annex B here.","m.mentions":{},"msgtype":"m.text"},"ts":1767119491212,"senderName":"Aapo Alasuutari","senderId":"@aapo.alasuutari:matrix.org","id":"$tGRX_wdnGB9VvN4gF9znFewFPuMpNDeu4B3e30_16Sk"},
{"content":{"body":"Thank you <3","m.mentions":{},"msgtype":"m.text"},"ts":1767119493544,"senderName":"Aapo Alasuutari","senderId":"@aapo.alasuutari:matrix.org","id":"$wv7Nnny1ZMRZOqBLrswtYFWkVnd0tcbaY6Xn26WscNA"}
]
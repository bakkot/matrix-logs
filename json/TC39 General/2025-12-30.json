[
{"content":{"body":"Does anyone know what's the intended way to pass the test `staging/sm/lexical-environment/block-scoped-functions-deprecated-redecl.js`?\n\nIn it we have a block that contains two function declarations with the same name, tested in noStrict to not cause a syntax error. https://tc39.es/ecma262/#sec-blockdeclarationinstantiation just says to go through lexically scoped declarations of the block and CreateMutableBinding or CreateImmutableBinding for each. That goes into https://tc39.es/ecma262/#sec-declarative-environment-records-createmutablebinding-n-d which asserts that the envRec doesn't already have a binding for the given name; this assertion is triggered by the two functions of the same name, best as I can tell anyway.\n\nAm I holding the spec wrong, or is this something of a spec bug? The Annex B Block-Level Function Declarations Web Legacy Compatibility Semantics of course changes this (though I haven't grokked how exactly), but assuming that extension is not applied, how should an implementation handle duplicate functions without asserting and crashing?","format":"org.matrix.custom.html","formatted_body":"<p>Does anyone know what's the intended way to pass the test <code>staging/sm/lexical-environment/block-scoped-functions-deprecated-redecl.js</code>?</p>\n<p>In it we have a block that contains two function declarations with the same name, tested in noStrict to not cause a syntax error. https://tc39.es/ecma262/#sec-blockdeclarationinstantiation just says to go through lexically scoped declarations of the block and CreateMutableBinding or CreateImmutableBinding for each. That goes into https://tc39.es/ecma262/#sec-declarative-environment-records-createmutablebinding-n-d which asserts that the envRec doesn't already have a binding for the given name; this assertion is triggered by the two functions of the same name, best as I can tell anyway.</p>\n<p>Am I holding the spec wrong, or is this something of a spec bug? The Annex B Block-Level Function Declarations Web Legacy Compatibility Semantics of course changes this (though I haven't grokked how exactly), but assuming that extension is not applied, how should an implementation handle duplicate functions without asserting and crashing?</p>\n","m.mentions":{},"msgtype":"m.text"},"ts":1767118292352,"senderName":"Aapo Alasuutari","senderId":"@aapo.alasuutari:matrix.org","id":"$ablOYgntWYPXrX32fLnA0pcVSrY8blbql7NCKUfSL5Q"},
{"content":{"body":"I'm not sure we've actually reasoned through the non-Annex B semantics carefully, Annex B is the one ~all implementations actually use","m.mentions":{},"msgtype":"m.text"},"ts":1767118373481,"senderName":"bakkot","senderId":"@bakkot:matrix.org","id":"$KY21oDh735puzFgVEeJyisygRP-3_K5PFq9b-jKjncA"},
{"content":{"body":"I assume that test is intended to run under an implementation which follows Annex B, given that it comes from SpiderMonkey, which is such an implementation","m.mentions":{},"msgtype":"m.text"},"ts":1767118405920,"senderName":"bakkot","senderId":"@bakkot:matrix.org","id":"$kgqtpWiOWRQEUKwYP-7sLx5-IZAbajMh-Zz77LvIcf8"}
]
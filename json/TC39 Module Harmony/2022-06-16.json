[
{"content":{"body":"I presented the latest updates of compartment proposal and having some question from the JSCIG","msgtype":"m.text","org.matrix.msc1767.text":"I presented the latest updates of compartment proposal and having some question from the JSCIG"},"ts":1655381375906,"senderName":"Jack Works","senderId":"@jackworks:matrix.org","id":"$G8ycA_Hqn3XbWzWD7pTyrSfZKtitx59qvoHH7H2D708"},
{"content":{"body":"Why \"loader\" will provides the virtualization of the global object? They looks overlap with ShadowRealm","msgtype":"m.text","org.matrix.msc1767.text":"Why \"loader\" will provides the virtualization of the global object? They looks overlap with ShadowRealm"},"ts":1655381460342,"senderName":"Jack Works","senderId":"@jackworks:matrix.org","id":"$E0D1HlOQLGJDLoEZD4oAE3TcuHPI2SDPOahYjgl_LqA"},
{"content":{"body":"Actually I'm also curious about this problem. If I have Compartment proposal, ShadowRealm is useless to me. It is hard to use and not provide more abilities than compartment (when the intrinsic are froze).","msgtype":"m.text","org.matrix.msc1767.text":"Actually I'm also curious about this problem. If I have Compartment proposal, ShadowRealm is useless to me. It is hard to use and not provide more abilities than compartment (when the intrinsic are froze)."},"ts":1655381593344,"senderName":"Jack Works","senderId":"@jackworks:matrix.org","id":"$4G4hxlg0dHOZW6yWCHmlcITci2kOy_x6PVa7-WuDS7M"},
{"content":{"body":"There is indeed some overlap, and some of that falls out naturally from the nesting of the dolls: Every realm is among other things a loader. And there will be some subtlety to whether a Realm or a Compartment is a good fit for a particular use case.","msgtype":"m.text","org.matrix.msc1767.text":"There is indeed some overlap, and some of that falls out naturally from the nesting of the dolls: Every realm is among other things a loader. And there will be some subtlety to whether a Realm or a Compartment is a good fit for a particular use case."},"ts":1655400852435,"senderName":"Kris Kowal","senderId":"@kriskowal:matrix.org","id":"$0f-l2CMzBsefa2cpIcfl9Sp8No-F5s0-IWpfViz0cq8"},
{"content":{"body":"One big difference is that a Loader-with-a-new-global comes with only three fresh intrinsics: new evaluators bound to the compartment.","msgtype":"m.text","org.matrix.msc1767.text":"One big difference is that a Loader-with-a-new-global comes with only three fresh intrinsics: new evaluators bound to the compartment."},"ts":1655400956151,"senderName":"Kris Kowal","senderId":"@kriskowal:matrix.org","id":"$KGwvbnUyOCiPZjJPA9YZoD4IjWwDWzWz09sTMnYBmHs"},
{"content":{"body":"Consequently, module instances can be shared between loaders, whereas module instances cannot be shared between realms.","msgtype":"m.text","org.matrix.msc1767.text":"Consequently, module instances can be shared between loaders, whereas module instances cannot be shared between realms."},"ts":1655401017181,"senderName":"Kris Kowal","senderId":"@kriskowal:matrix.org","id":"$7iIKIiJ1w68kxFbl2ndl7ZcUY-g_0Tqkw1vEncbSBPg"},
{"content":{"body":"Static module records can of course be shared in both cases.","msgtype":"m.text","org.matrix.msc1767.text":"Static module records can of course be shared in both cases."},"ts":1655401033343,"senderName":"Kris Kowal","senderId":"@kriskowal:matrix.org","id":"$JqW8XrUibqcEA8sH0ENUAxzQWdpal2TWI9_ccv_2el0"},
{"content":{"body":"HMR and test watchers can be done with either, but for these cases I think Compartment-with-shared-global is much lighter and can hand off state more easily.","msgtype":"m.text","org.matrix.msc1767.text":"HMR and test watchers can be done with either, but for these cases I think Compartment-with-shared-global is much lighter and can hand off state more easily."},"ts":1655401211357,"senderName":"Kris Kowal","senderId":"@kriskowal:matrix.org","id":"$g_lo5qMX5TIki0nl25-aWtSDN3_Y5F1iEilfJtABuT4"},
{"content":{"body":"Deferred execution can not be done by a Realm. That’s the case Guy and Luca brought to our last plenary.","msgtype":"m.text","org.matrix.msc1767.text":"Deferred execution can not be done by a Realm. That’s the case Guy and Luca brought to our last plenary."},"ts":1655401252082,"senderName":"Kris Kowal","senderId":"@kriskowal:matrix.org","id":"$r-0mFrgl-9g0EabV6TXnCtBXUL_r6s9VarQydNby0rY"},
{"content":{"body":"This is a good question, though, and we need to document an answer in the Compartment design rationale.","msgtype":"m.text","org.matrix.msc1767.text":"This is a good question, though, and we need to document an answer in the Compartment design rationale."},"ts":1655401309114,"senderName":"Kris Kowal","senderId":"@kriskowal:matrix.org","id":"$IDmUCGIcfPBpQNzrHFwvClpWiIpA0GQ28Ct8BGgUw4Q"},
{"content":{"body":"Is deferred execution related to a distinct global object?","m.relates_to":{"event_id":"$r-0mFrgl-9g0EabV6TXnCtBXUL_r6s9VarQydNby0rY","is_falling_back":true,"m.in_reply_to":{"event_id":"$r-0mFrgl-9g0EabV6TXnCtBXUL_r6s9VarQydNby0rY"},"rel_type":"m.thread"},"msgtype":"m.text","org.matrix.msc1767.text":"Is deferred execution related to a distinct global object?"},"ts":1655401312385,"senderName":"legendecas","senderId":"@legendecas:matrix.org","id":"$CTltcZNnHnYYYUp8Lh9ah03bzOvKQlHOaGaA2HEBCFY"},
{"content":{"body":"And that is in fact issue #1 https://github.com/tc39/proposal-compartments/issues/1","msgtype":"m.text","org.matrix.msc1767.text":"And that is in fact issue #1 https://github.com/tc39/proposal-compartments/issues/1"},"ts":1655401373661,"senderName":"Kris Kowal","senderId":"@kriskowal:matrix.org","id":"$zzeMssLGfN8w0O6K0vaXPKBAo7ELcn21qR-geMiQnAM"},
{"content":{"body":"No, you can defer execution with a shared global. That’s orthogonal.","m.relates_to":{"event_id":"$r-0mFrgl-9g0EabV6TXnCtBXUL_r6s9VarQydNby0rY","is_falling_back":true,"m.in_reply_to":{"event_id":"$r-0mFrgl-9g0EabV6TXnCtBXUL_r6s9VarQydNby0rY"},"rel_type":"m.thread"},"msgtype":"m.text","org.matrix.msc1767.text":"No, you can defer execution with a shared global. That’s orthogonal."},"ts":1655401400559,"senderName":"Kris Kowal","senderId":"@kriskowal:matrix.org","id":"$tyBUzbDdNsZWXwV7gMnS-JZS7b8yx1-jZ7pOONf_6tM"},
{"content":{"body":"One motivating case for detached global is our Hardened JavaScript isolation mechanism. That’s at least my primary motivation as a champion.","m.relates_to":{"event_id":"$r-0mFrgl-9g0EabV6TXnCtBXUL_r6s9VarQydNby0rY","is_falling_back":true,"m.in_reply_to":{"event_id":"$r-0mFrgl-9g0EabV6TXnCtBXUL_r6s9VarQydNby0rY"},"rel_type":"m.thread"},"msgtype":"m.text","org.matrix.msc1767.text":"One motivating case for detached global is our Hardened JavaScript isolation mechanism. That’s at least my primary motivation as a champion."},"ts":1655401479776,"senderName":"Kris Kowal","senderId":"@kriskowal:matrix.org","id":"$OKzle98sA2Lx0z-BY6TiYTQwjRMEschg8wXhJHWe2Fg"},
{"content":{"body":"We can shim most of what we need with a very minimal carve-out for a detached global. Without that carve-out, the hardened JavaScript shim (`ses`) would continue to need to fully emulate the loader aspect.","format":"org.matrix.custom.html","formatted_body":"We can shim most of what we need with a very minimal carve-out for a detached global. Without that carve-out, the hardened JavaScript shim (<code>ses</code>) would continue to need to fully emulate the loader aspect.","m.relates_to":{"event_id":"$r-0mFrgl-9g0EabV6TXnCtBXUL_r6s9VarQydNby0rY","is_falling_back":true,"m.in_reply_to":{"event_id":"$r-0mFrgl-9g0EabV6TXnCtBXUL_r6s9VarQydNby0rY"},"rel_type":"m.thread"},"msgtype":"m.text","org.matrix.msc1767.message":[{"body":"We can shim most of what we need with a very minimal carve-out for a detached global. Without that carve-out, the hardened JavaScript shim (`ses`) would continue to need to fully emulate the loader aspect.","mimetype":"text/plain"},{"body":"We can shim most of what we need with a very minimal carve-out for a detached global. Without that carve-out, the hardened JavaScript shim (<code>ses</code>) would continue to need to fully emulate the loader aspect.","mimetype":"text/html"}]},"ts":1655401562082,"senderName":"Kris Kowal","senderId":"@kriskowal:matrix.org","id":"$9C61_x3n7VTYY0hJj22M6iGTo2Aued4depVTnik0Xu4"},
{"content":{"body":"Thanks for the reply. I'm interested in the details about how ShadowRealm could work with Compartment/Loaders","m.relates_to":{"event_id":"$r-0mFrgl-9g0EabV6TXnCtBXUL_r6s9VarQydNby0rY","is_falling_back":true,"m.in_reply_to":{"event_id":"$r-0mFrgl-9g0EabV6TXnCtBXUL_r6s9VarQydNby0rY"},"rel_type":"m.thread"},"msgtype":"m.text","org.matrix.msc1767.text":"Thanks for the reply. I'm interested in the details about how ShadowRealm could work with Compartment/Loaders"},"ts":1655401614534,"senderName":"legendecas","senderId":"@legendecas:matrix.org","id":"$GI-N8epEg6cYFTYoA4g1NKZIQj55ICszvHQJ1ubtSL0"},
{"content":{"body":"Wondering if that could be done with composing ShadowRealm with Compartments?","m.relates_to":{"event_id":"$r-0mFrgl-9g0EabV6TXnCtBXUL_r6s9VarQydNby0rY","is_falling_back":true,"m.in_reply_to":{"event_id":"$r-0mFrgl-9g0EabV6TXnCtBXUL_r6s9VarQydNby0rY"},"rel_type":"m.thread"},"msgtype":"m.text","org.matrix.msc1767.text":"Wondering if that could be done with composing ShadowRealm with Compartments?"},"ts":1655401634475,"senderName":"legendecas","senderId":"@legendecas:matrix.org","id":"$kWhECyKpF5SALYbiJt7zQTi1NAltx9mxxNui0bQ3dUo"},
{"content":{"body":"So, the way the spec text is likely to go for compartments/loaders begins with a refactoring to decouple the existing Loader from the existing Realm in the spec, such that the Realm is a Loader, but not necessarily the only loader in that realm.","m.relates_to":{"event_id":"$r-0mFrgl-9g0EabV6TXnCtBXUL_r6s9VarQydNby0rY","is_falling_back":true,"m.in_reply_to":{"event_id":"$r-0mFrgl-9g0EabV6TXnCtBXUL_r6s9VarQydNby0rY"},"rel_type":"m.thread"},"msgtype":"m.text","org.matrix.msc1767.text":"So, the way the spec text is likely to go for compartments/loaders begins with a refactoring to decouple the existing Loader from the existing Realm in the spec, such that the Realm is a Loader, but not necessarily the only loader in that realm."},"ts":1655401727696,"senderName":"Kris Kowal","senderId":"@kriskowal:matrix.org","id":"$hT-Samk_V6xAwN8pM2cZUAbrdZH7hg7BV_MMLs5Jxtk"},
{"content":{"body":"So, as a consequence of the factoring, ShadowRealm and Compartment can be used in tandem. But, I suspect you have something else in mind.","m.relates_to":{"event_id":"$r-0mFrgl-9g0EabV6TXnCtBXUL_r6s9VarQydNby0rY","is_falling_back":true,"m.in_reply_to":{"event_id":"$r-0mFrgl-9g0EabV6TXnCtBXUL_r6s9VarQydNby0rY"},"rel_type":"m.thread"},"msgtype":"m.text","org.matrix.msc1767.text":"So, as a consequence of the factoring, ShadowRealm and Compartment can be used in tandem. But, I suspect you have something else in mind."},"ts":1655401809486,"senderName":"Kris Kowal","senderId":"@kriskowal:matrix.org","id":"$06IRq_FmGqw6lTy__tPnZun08rWOlAxQc9TgT2KPIrI"},
{"content":{"body":"Well, the question about why we need a \"detached global\" just come up to my mind when I find that the proposal is going to be renamed as Loader, which sounds to me has nothing to do with globals at the first place","m.relates_to":{"event_id":"$r-0mFrgl-9g0EabV6TXnCtBXUL_r6s9VarQydNby0rY","is_falling_back":true,"m.in_reply_to":{"event_id":"$kWhECyKpF5SALYbiJt7zQTi1NAltx9mxxNui0bQ3dUo"},"rel_type":"m.thread"},"msgtype":"m.text","org.matrix.msc1767.text":"Well, the question about why we need a \"detached global\" just come up to my mind when I find that the proposal is going to be renamed as Loader, which sounds to me has nothing to do with globals at the first place"},"ts":1655401894809,"senderName":"legendecas","senderId":"@legendecas:matrix.org","id":"$30ZbXq2_JwsbAl5JepMX6AwzOcVe8CdKNEtXcwfMJrY"},
{"content":{"body":"One *interesting* motivating use case that would rely on both ShadowRealm and Compartment would be creating a Compartment inside a ShadowRealm with different hooks. That is to say, constructing a ShadowRealm and then bootstrapping a non-host module-loader.","format":"org.matrix.custom.html","formatted_body":"One <em>interesting</em> motivating use case that would rely on both ShadowRealm and Compartment would be creating a Compartment inside a ShadowRealm with different hooks. That is to say, constructing a ShadowRealm and then bootstrapping a non-host module-loader.","m.relates_to":{"event_id":"$r-0mFrgl-9g0EabV6TXnCtBXUL_r6s9VarQydNby0rY","is_falling_back":true,"m.in_reply_to":{"event_id":"$r-0mFrgl-9g0EabV6TXnCtBXUL_r6s9VarQydNby0rY"},"rel_type":"m.thread"},"msgtype":"m.text","org.matrix.msc1767.message":[{"body":"One *interesting* motivating use case that would rely on both ShadowRealm and Compartment would be creating a Compartment inside a ShadowRealm with different hooks. That is to say, constructing a ShadowRealm and then bootstrapping a non-host module-loader.","mimetype":"text/plain"},{"body":"One <em>interesting</em> motivating use case that would rely on both ShadowRealm and Compartment would be creating a Compartment inside a ShadowRealm with different hooks. That is to say, constructing a ShadowRealm and then bootstrapping a non-host module-loader.","mimetype":"text/html"}]},"ts":1655401935316,"senderName":"Kris Kowal","senderId":"@kriskowal:matrix.org","id":"$ttYJMbzTOy3puLiqqJicwDLBVO-txe5ZXpGMjcn-OZo"},
{"content":{"body":"That’s a good argument to continue calling it Compartment, but the substance of the proposal would be identical regardless.","m.relates_to":{"event_id":"$r-0mFrgl-9g0EabV6TXnCtBXUL_r6s9VarQydNby0rY","is_falling_back":true,"m.in_reply_to":{"event_id":"$r-0mFrgl-9g0EabV6TXnCtBXUL_r6s9VarQydNby0rY"},"rel_type":"m.thread"},"msgtype":"m.text","org.matrix.msc1767.text":"That’s a good argument to continue calling it Compartment, but the substance of the proposal would be identical regardless."},"ts":1655401970336,"senderName":"Kris Kowal","senderId":"@kriskowal:matrix.org","id":"$NMbyf9Mu_8L3ERpNwBvtqdO4BNCo5jiJDdUbHMfQ0-A"},
{"content":{"body":"> <@kriskowal:matrix.org> One *interesting* motivating use case that would rely on both ShadowRealm and Compartment would be creating a Compartment inside a ShadowRealm with different hooks. That is to say, constructing a ShadowRealm and then bootstrapping a non-host module-loader.\n\nYeah, this is what I have in my mind too","format":"org.matrix.custom.html","formatted_body":"<mx-reply><blockquote><a href=\"https://matrix.to/#/!RkpmGMjJtqLKXzByOT:matrix.org/$ttYJMbzTOy3puLiqqJicwDLBVO-txe5ZXpGMjcn-OZo?via=matrix.org&via=igalia.com\">In reply to</a> <a href=\"https://matrix.to/#/@kriskowal:matrix.org\">@kriskowal:matrix.org</a><br>One <em>interesting</em> motivating use case that would rely on both ShadowRealm and Compartment would be creating a Compartment inside a ShadowRealm with different hooks. That is to say, constructing a ShadowRealm and then bootstrapping a non-host module-loader.</blockquote></mx-reply>Yeah, this is what I have in my mind too","m.relates_to":{"event_id":"$r-0mFrgl-9g0EabV6TXnCtBXUL_r6s9VarQydNby0rY","is_falling_back":false,"m.in_reply_to":{"event_id":"$ttYJMbzTOy3puLiqqJicwDLBVO-txe5ZXpGMjcn-OZo"},"rel_type":"m.thread"},"msgtype":"m.text","org.matrix.msc1767.message":[{"body":"> <@kriskowal:matrix.org> One *interesting* motivating use case that would rely on both ShadowRealm and Compartment would be creating a Compartment inside a ShadowRealm with different hooks. That is to say, constructing a ShadowRealm and then bootstrapping a non-host module-loader.\n\nYeah, this is what I have in my mind too","mimetype":"text/plain"},{"body":"<mx-reply><blockquote><a href=\"https://matrix.to/#/!RkpmGMjJtqLKXzByOT:matrix.org/$ttYJMbzTOy3puLiqqJicwDLBVO-txe5ZXpGMjcn-OZo?via=matrix.org&via=igalia.com\">In reply to</a> <a href=\"https://matrix.to/#/@kriskowal:matrix.org\">@kriskowal:matrix.org</a><br>One <em>interesting</em> motivating use case that would rely on both ShadowRealm and Compartment would be creating a Compartment inside a ShadowRealm with different hooks. That is to say, constructing a ShadowRealm and then bootstrapping a non-host module-loader.</blockquote></mx-reply>Yeah, this is what I have in my mind too","mimetype":"text/html"}]},"ts":1655401972616,"senderName":"legendecas","senderId":"@legendecas:matrix.org","id":"$23cTrDX86SDEv2gCMgMJP2V2F7mjY2-t2vbvg8sT-p4"},
{"content":{"body":"As a champion, I’m eager to deëmphasize the detached global feature, but not remove it.","m.relates_to":{"event_id":"$r-0mFrgl-9g0EabV6TXnCtBXUL_r6s9VarQydNby0rY","is_falling_back":true,"m.in_reply_to":{"event_id":"$r-0mFrgl-9g0EabV6TXnCtBXUL_r6s9VarQydNby0rY"},"rel_type":"m.thread"},"msgtype":"m.text","org.matrix.msc1767.text":"As a champion, I’m eager to deëmphasize the detached global feature, but not remove it."},"ts":1655402027426,"senderName":"Kris Kowal","senderId":"@kriskowal:matrix.org","id":"$Wp4X4KzeHIMXqRyyNEFYFidB1QsfWDyNPR6zOxRYCU4"},
{"content":{"body":"Because there are so many cases where a Compartment with a shared global is useful, I imagine that will be the primary usage.","m.relates_to":{"event_id":"$r-0mFrgl-9g0EabV6TXnCtBXUL_r6s9VarQydNby0rY","is_falling_back":true,"m.in_reply_to":{"event_id":"$r-0mFrgl-9g0EabV6TXnCtBXUL_r6s9VarQydNby0rY"},"rel_type":"m.thread"},"msgtype":"m.text","org.matrix.msc1767.text":"Because there are so many cases where a Compartment with a shared global is useful, I imagine that will be the primary usage."},"ts":1655402060142,"senderName":"Kris Kowal","senderId":"@kriskowal:matrix.org","id":"$rNr5JU6YnxpmYmU4KU9kw9JgomixE6UlhHpm6TsybLA"},
{"content":{"body":"I would be happy to see the works going on to elaborate the design rationale in the repo on this :D","m.relates_to":{"event_id":"$r-0mFrgl-9g0EabV6TXnCtBXUL_r6s9VarQydNby0rY","is_falling_back":true,"m.in_reply_to":{"event_id":"$NMbyf9Mu_8L3ERpNwBvtqdO4BNCo5jiJDdUbHMfQ0-A"},"rel_type":"m.thread"},"msgtype":"m.text","org.matrix.msc1767.text":"I would be happy to see the works going on to elaborate the design rationale in the repo on this :D"},"ts":1655402158819,"senderName":"legendecas","senderId":"@legendecas:matrix.org","id":"$z37ot5mUoG3xBuw3skhDfYBWjSKX1Urz4n2ybPKvjQc"},
{"content":{"body":"A Compartment with a detached global is necessary for other single-realm isolation motivating cases.","m.relates_to":{"event_id":"$r-0mFrgl-9g0EabV6TXnCtBXUL_r6s9VarQydNby0rY","is_falling_back":true,"m.in_reply_to":{"event_id":"$r-0mFrgl-9g0EabV6TXnCtBXUL_r6s9VarQydNby0rY"},"rel_type":"m.thread"},"msgtype":"m.text","org.matrix.msc1767.text":"A Compartment with a detached global is necessary for other single-realm isolation motivating cases."},"ts":1655402164244,"senderName":"Kris Kowal","senderId":"@kriskowal:matrix.org","id":"$uDBu4BG9tmhi8w7HKIWH3ivpAK1wPqrAPJeXOf7uKDY"},
{"content":{"body":"Yes, for sure.","m.relates_to":{"event_id":"$r-0mFrgl-9g0EabV6TXnCtBXUL_r6s9VarQydNby0rY","is_falling_back":true,"m.in_reply_to":{"event_id":"$r-0mFrgl-9g0EabV6TXnCtBXUL_r6s9VarQydNby0rY"},"rel_type":"m.thread"},"msgtype":"m.text","org.matrix.msc1767.text":"Yes, for sure."},"ts":1655402189957,"senderName":"Kris Kowal","senderId":"@kriskowal:matrix.org","id":"$cB7vXWUvUzSgQ0zfnW4sZYix3ZLm-7QuIw0V226kQTc"}
]
[
{"content":{"body":"Further to the discussion last meeting about source phase architecture in v8 being tough to integrate","m.mentions":{},"msgtype":"m.text"},"ts":1762800087121,"senderName":"guybedford","senderId":"@guybedford:matrix.org","id":"$ACTJ-HR1F0YPpSCQAu_Ip6f5vJ1er6DcJ1lU-JNByNs"},
{"content":{"body":"both Deno and Cloudflare now resolve dependencies of source phase moudles, effectively in violation of the spec, just because that's the natural implementation path .... :(","m.mentions":{},"msgtype":"m.text"},"ts":1762800111687,"senderName":"guybedford","senderId":"@guybedford:matrix.org","id":"$RvEkL35U6ADes25RgpUe3p2DyhMfYYj0TcsGpppFOFY"},
{"content":{"body":"https://github.com/denoland/deno/issues/31240","m.mentions":{},"msgtype":"m.text"},"ts":1762800113041,"senderName":"guybedford","senderId":"@guybedford:matrix.org","id":"$-YnWRPaek2ahifqg6hvkqDw7RLO1I5P0TEMxs216Nlo"},
{"content":{"body":"Deno didn't implement V8's source phase callbacks. Would you mind elaborating why this is a V8 issue?","m.mentions":{},"msgtype":"m.text"},"ts":1762802620608,"senderName":"Chengzhong Wu","senderId":"@legendecas:matrix.org","id":"$g2pYp3snhZr8G_OLnLYiRPm3P0lpFEZH6Ne3i18_o9Y"},
{"content":{"body":"In other words, Deno didn't implement V8's source phase support at all.","m.mentions":{},"msgtype":"m.text"},"ts":1762802671264,"senderName":"Chengzhong Wu","senderId":"@legendecas:matrix.org","id":"$6pRomUvWDwj9IfKproyEI_spX93jubHy4T9yb-2deko"},
{"content":{"body":"Yeah I see that's the root cause here. Would be nice if implementers didn't have to do anything to get source phase though...","m.mentions":{},"msgtype":"m.text"},"ts":1762802918139,"senderName":"guybedford","senderId":"@guybedford:matrix.org","id":"$6P7b7niloWymkoC-rQmxIj4l29KNqs84ZvvmtEBktP0"},
{"content":{"body":"I'm not sure it will help in Deno's case","m.mentions":{},"msgtype":"m.text"},"ts":1762802944579,"senderName":"Chengzhong Wu","senderId":"@legendecas:matrix.org","id":"$TxgYb7gASlgGVuDcejqn7aEYTMW2187HxkTqPoL953I"},
{"content":{"body":"Deno is literally resolving before even reaching to V8","m.mentions":{},"msgtype":"m.text"},"ts":1762802959149,"senderName":"Chengzhong Wu","senderId":"@legendecas:matrix.org","id":"$3G7GLg-nXC4i04O8lgekQWDZEywF53jpdwmO87ZWnWw"},
{"content":{"body":"yeah, I see that, and that makes sense I suppose. Ideally implementations would _just_ need to opt-out of their prefetching for source phase, and then all phases and imports work out after that.","format":"org.matrix.custom.html","formatted_body":"yeah, I see that, and that makes sense I suppose. Ideally implementations would <em>just</em> need to opt-out of their prefetching for source phase, and then all phases and imports work out after that.","m.mentions":{},"msgtype":"m.text"},"ts":1762803093591,"senderName":"guybedford","senderId":"@guybedford:matrix.org","id":"$aV7_D90Jkpun2koXE6f9svbon8fgKbczHB79WdVRGtk"},
{"content":{"body":"If an embedder did not implement the source phase support, V8 does not enable the feature by default (at the moment, this is still hidden behind the flag `--js-source-phase-imports`)","format":"org.matrix.custom.html","formatted_body":"If an embedder did not implement the source phase support, V8 does not enable the feature by default (at the moment, this is still hidden behind the flag <code>--js-source-phase-imports</code>)","m.mentions":{},"msgtype":"m.text"},"ts":1762803175623,"senderName":"Chengzhong Wu","senderId":"@legendecas:matrix.org","id":"$2F9U9L7xQOa0-lDJAAjgtjDSEzzGXuIceaMATfQN6pk"},
{"content":{"body":"I can see that this could be improved by asking V8 taking over the resolution step, so that V8 can stop resolving source import dependencies","m.mentions":{},"msgtype":"m.text"},"ts":1762803216403,"senderName":"Chengzhong Wu","senderId":"@legendecas:matrix.org","id":"$p_yH1_dqr8n3cyW5ukOwhdqtbYJzkz_UcYK3VMhILo8"},
{"content":{"body":"* I can see that this could be potentially improved by asking V8 taking over the resolution step, so that V8 can stop resolving source import dependencies","m.mentions":{},"m.new_content":{"body":"I can see that this could be potentially improved by asking V8 taking over the resolution step, so that V8 can stop resolving source import dependencies","m.mentions":{},"msgtype":"m.text"},"m.relates_to":{"event_id":"$p_yH1_dqr8n3cyW5ukOwhdqtbYJzkz_UcYK3VMhILo8","rel_type":"m.replace"},"msgtype":"m.text"},"ts":1762803223990,"senderName":"Chengzhong Wu","senderId":"@legendecas:matrix.org","id":"$FhhC3tcjB6J31WiTN34tAZIeti6ioyFrH3a3VZfgIWw"},
{"content":{"body":"However, I'd doubt the complexity of it because resolution can be either sync (node.js) or async (web).","m.mentions":{},"msgtype":"m.text"},"ts":1762803291955,"senderName":"Chengzhong Wu","senderId":"@legendecas:matrix.org","id":"$-ZZj9xw8fMA2qrdzHF3MTUqnejJwJqiWgZHkjxrBL_I"},
{"content":{"body":"* However, I'd doubt the complexity of it because resolution can be either sync (node.js) or async (web & node.js).","m.mentions":{},"m.new_content":{"body":"However, I'd doubt the complexity of it because resolution can be either sync (node.js) or async (web & node.js).","m.mentions":{},"msgtype":"m.text"},"m.relates_to":{"event_id":"$-ZZj9xw8fMA2qrdzHF3MTUqnejJwJqiWgZHkjxrBL_I","rel_type":"m.replace"},"msgtype":"m.text"},"ts":1762803306850,"senderName":"Chengzhong Wu","senderId":"@legendecas:matrix.org","id":"$3tm3sKbkRvsvQEPWJX6YNh0QLD_pTNx4LfkF9AiP394"},
{"content":{"body":"resolution is always now synchronous on both the web and node","m.mentions":{},"msgtype":"m.text"},"ts":1762803313126,"senderName":"guybedford","senderId":"@guybedford:matrix.org","id":"$Caje7-vtc6UTm3C13AXuCFe2HcWLVd39_pHG73KtW4Q"},
{"content":{"body":"node still allows async resolution","m.mentions":{},"msgtype":"m.text"},"ts":1762803328293,"senderName":"Chengzhong Wu","senderId":"@legendecas:matrix.org","id":"$CMalu64q591j6sIG4Z6cGGs8s6T-kYuO3RUxeoCFWsg"},
{"content":{"body":"is it not fully deprecated yet?","m.mentions":{},"msgtype":"m.text"},"ts":1762803363642,"senderName":"guybedford","senderId":"@guybedford:matrix.org","id":"$5hZi6fAzID6sdHUfR3FyYfSG0Hm5Cnmarp1ibWwnh6M"},
{"content":{"body":"it's.. not even under the discussion of deprecation","m.mentions":{},"msgtype":"m.text"},"ts":1762803379133,"senderName":"Chengzhong Wu","senderId":"@legendecas:matrix.org","id":"$Ixz8qzDBkKaIGQgFccV0JAKFF0ou2HxddlFEjkfXIbs"},
{"content":{"body":"* it's.. not even under the discussion of deprecation AFAICT","m.mentions":{},"m.new_content":{"body":"it's.. not even under the discussion of deprecation AFAICT","m.mentions":{},"msgtype":"m.text"},"m.relates_to":{"event_id":"$Ixz8qzDBkKaIGQgFccV0JAKFF0ou2HxddlFEjkfXIbs","rel_type":"m.replace"},"msgtype":"m.text"},"ts":1762803400904,"senderName":"Chengzhong Wu","senderId":"@legendecas:matrix.org","id":"$_2V1lugtWCLnEm1rWWrGTy93O8o0X6S00LGU6XfUBrs"},
{"content":{"body":"I guess there's two main architectures that might work for V8 - `HostResolveImportedModuleSource` as the new primitive that obtains sources first as a separate object (that can have compile cache etc)","format":"org.matrix.custom.html","formatted_body":"I guess there's two main architectures that might work for V8 - <code>HostResolveImportedModuleSource</code> as the new primitive that obtains sources first as a separate object (that can have compile cache etc)","m.mentions":{},"msgtype":"m.text"},"ts":1762803489048,"senderName":"guybedford","senderId":"@guybedford:matrix.org","id":"$lQi3ZdVvBKT3OmiuqIGQ4u7vjK8rUSgAaspnfI08fv0"},
{"content":{"body":"or we stick with `HostResolveImportedModuleV2` or `HostResolveImportedModuleWithPhase` that takes a phase argument as a hint, then returns a module without resolving dependencies","format":"org.matrix.custom.html","formatted_body":"or we stick with <code>HostResolveImportedModuleV2</code> or <code>HostResolveImportedModuleWithPhase</code> that takes a phase argument as a hint, then returns a module without resolving dependencies","m.mentions":{},"msgtype":"m.text"},"ts":1762803517394,"senderName":"guybedford","senderId":"@guybedford:matrix.org","id":"$TXGVqKsl61NBe65Rd5d7xJ3gockGX0GEydCVkf0U8HA"},
{"content":{"body":"Yeah, so a new v2 / or we extend it to apply to all modules","m.mentions":{},"msgtype":"m.text"},"ts":1762803566755,"senderName":"guybedford","senderId":"@guybedford:matrix.org","id":"$TFm6a9ylk7whVH2mojMd_kNcP06fhNJnQ38O5FDloR0"},
{"content":{"body":"not sure if we are referring to the same thing. Are you referring to `HostImportModuleWithPhaseDynamicallyCallback`?","format":"org.matrix.custom.html","formatted_body":"not sure if we are referring to the same thing. Are you referring to <code>HostImportModuleWithPhaseDynamicallyCallback</code>?","m.mentions":{},"msgtype":"m.text"},"ts":1762803605382,"senderName":"Chengzhong Wu","senderId":"@legendecas:matrix.org","id":"$nuhpNa9EfiGeFXMP-L6-6QEoSnp_Fx3C7ougWjaEG_Y"}
]
[
{"content":{"body":"> <@kriskowal:matrix.org> In any case, I sketched this, borrowing as much as possible from the Compartments proposal https://gist.github.com/kriskowal/288d38e62e55e09685bf62c3a3c25565\n\n> The compartment will leave that promise to dangle, so an eventual rejection will necessarily go unhandled.\n\nI don't agree with this part. If the module throws sync, it will become a sync error that can be caught, but if the promise dangles, I cannot handle it. This creates inconsistency in if module uses TLA or not","format":"org.matrix.custom.html","formatted_body":"<mx-reply><blockquote><a href=\"https://matrix.to/#/!RkpmGMjJtqLKXzByOT:matrix.org/$R6vzCXVsXoaF1NO3bWx6aMHCsNf6uT-quOxlnXMEn2U?via=matrix.org&via=igalia.com&via=mozilla.org\">In reply to</a> <a href=\"https://matrix.to/#/@kriskowal:matrix.org\">@kriskowal:matrix.org</a><br>In any case, I sketched this, borrowing as much as possible from the Compartments proposal https://gist.github.com/kriskowal/288d38e62e55e09685bf62c3a3c25565</blockquote></mx-reply><blockquote>\n<p>The compartment will leave that promise to dangle, so an eventual rejection will necessarily go unhandled.</p>\n</blockquote>\n<p>I don't agree with this part. If the module throws sync, it will become a sync error that can be caught, but if the promise dangles, I cannot handle it. This creates inconsistency in if module uses TLA or not</p>\n","m.relates_to":{"m.in_reply_to":{"event_id":"$R6vzCXVsXoaF1NO3bWx6aMHCsNf6uT-quOxlnXMEn2U"}},"msgtype":"m.text","org.matrix.msc1767.message":[{"body":"> <@kriskowal:matrix.org> In any case, I sketched this, borrowing as much as possible from the Compartments proposal https://gist.github.com/kriskowal/288d38e62e55e09685bf62c3a3c25565\n\n> The compartment will leave that promise to dangle, so an eventual rejection will necessarily go unhandled.\n\nI don't agree with this part. If the module throws sync, it will become a sync error that can be caught, but if the promise dangles, I cannot handle it. This creates inconsistency in if module uses TLA or not","mimetype":"text/plain"},{"body":"<mx-reply><blockquote><a href=\"https://matrix.to/#/!RkpmGMjJtqLKXzByOT:matrix.org/$R6vzCXVsXoaF1NO3bWx6aMHCsNf6uT-quOxlnXMEn2U?via=matrix.org&via=igalia.com&via=mozilla.org\">In reply to</a> <a href=\"https://matrix.to/#/@kriskowal:matrix.org\">@kriskowal:matrix.org</a><br>In any case, I sketched this, borrowing as much as possible from the Compartments proposal https://gist.github.com/kriskowal/288d38e62e55e09685bf62c3a3c25565</blockquote></mx-reply><blockquote>\n<p>The compartment will leave that promise to dangle, so an eventual rejection will necessarily go unhandled.</p>\n</blockquote>\n<p>I don't agree with this part. If the module throws sync, it will become a sync error that can be caught, but if the promise dangles, I cannot handle it. This creates inconsistency in if module uses TLA or not</p>\n","mimetype":"text/html"}]},"ts":1656865793611,"senderName":"Jack Works","senderId":"@jackworks:matrix.org","id":"$tI2ynIL4eU4-0KcGBYkjfJ1HyTm-GWCH4YVe8qX7K_g"},
{"content":{"body":"I also don’t like it, but couldn’t think of an alternative behavior. Answering that point consistently with the current host behavior would be ideal.","msgtype":"m.text","org.matrix.msc1767.text":"I also don’t like it, but couldn’t think of an alternative behavior. Answering that point consistently with the current host behavior would be ideal."},"ts":1656866126826,"senderName":"Kris Kowal","senderId":"@kriskowal:matrix.org","id":"$4uI9hCKbAAd4VW52s-MUi2hPuHm5BoWPdI7tMd74H7k"},
{"content":{"body":"But also, if we reduce the scope to `Module` and `ModuleSource` constructors, I don’t believe we have to answer the question in our proposal.","format":"org.matrix.custom.html","formatted_body":"But also, if we reduce the scope to <code>Module</code> and <code>ModuleSource</code> constructors, I don’t believe we have to answer the question in our proposal.","msgtype":"m.text","org.matrix.msc1767.message":[{"body":"But also, if we reduce the scope to `Module` and `ModuleSource` constructors, I don’t believe we have to answer the question in our proposal.","mimetype":"text/plain"},{"body":"But also, if we reduce the scope to <code>Module</code> and <code>ModuleSource</code> constructors, I don’t believe we have to answer the question in our proposal.","mimetype":"text/html"}]},"ts":1656866165725,"senderName":"Kris Kowal","senderId":"@kriskowal:matrix.org","id":"$xZkqTW-ePg6-gdvWWTH1VtDOyFx4yylq0xns-IUaEuE"},
{"content":{"body":"Can't it spread to where the import happens? ","msgtype":"m.text"},"ts":1656866173433,"senderName":"Jack Works","senderId":"@jackworks:matrix.org","id":"$4Zu5C6cJGgjsJuCzsxpzIc_PVUIhr_VeG4EvVBxc9oY"},
{"content":{"body":"Is that the behavior of dynamic import for a module and its transitive dependencies when any of them contains top-level-await?","msgtype":"m.text","org.matrix.msc1767.text":"Is that the behavior of dynamic import for a module and its transitive dependencies when any of them contains top-level-await?"},"ts":1656866212936,"senderName":"Kris Kowal","senderId":"@kriskowal:matrix.org","id":"$lTBNAionCkGcu88h4B27E7eXLmfKugUyAok3VO3FcYQ"},
{"content":{"body":"Genuinely, not an expert on TLA.","msgtype":"m.text","org.matrix.msc1767.text":"Genuinely, not an expert on TLA."},"ts":1656866225742,"senderName":"Kris Kowal","senderId":"@kriskowal:matrix.org","id":"$QRjP0YaLKewFNlDxhbHZaGZuiogBTo4wf5P5e_4Rc3M"},
{"content":{"body":"That is, does the promise returned by dynamic import settle only when all of the transitive dependencies settle for TLA?","msgtype":"m.text","org.matrix.msc1767.text":"That is, does the promise returned by dynamic import settle only when all of the transitive dependencies settle for TLA?"},"ts":1656866283609,"senderName":"Kris Kowal","senderId":"@kriskowal:matrix.org","id":"$RkUyT040mvF8NvdA_s0nolI1GR8KBH6-sSvIZPtY21c"},
{"content":{"body":"And I wonder how much code I need to write in the user land for the housekeeping work (e.g. module caching stuff), so I can emulate a normal ES module environment (with some built-in modules and a relative path module resolution)? I would like to see an example. ","msgtype":"m.text"},"ts":1656866328534,"senderName":"Jack Works","senderId":"@jackworks:matrix.org","id":"$OEb2Z5eQNnQA6FvXSG3V1M6ILlURHdmLV28KPU4lM4Q"},
{"content":{"body":"> <@kriskowal:matrix.org> Is that the behavior of dynamic import for a module and its transitive dependencies when any of them contains top-level-await?\n\nI believe so, otherwise what should be the result of that dynamic import? ","format":"org.matrix.custom.html","formatted_body":"<mx-reply><blockquote><a href=\"https://matrix.to/#/!RkpmGMjJtqLKXzByOT:matrix.org/$lTBNAionCkGcu88h4B27E7eXLmfKugUyAok3VO3FcYQ?via=matrix.org&via=igalia.com&via=mozilla.org\">In reply to</a> <a href=\"https://matrix.to/#/@kriskowal:matrix.org\">@kriskowal:matrix.org</a><br />Is that the behavior of dynamic import for a module and its transitive dependencies when any of them contains top-level-await?</blockquote></mx-reply>I believe so, otherwise what should be the result of that dynamic import?","m.relates_to":{"m.in_reply_to":{"event_id":"$lTBNAionCkGcu88h4B27E7eXLmfKugUyAok3VO3FcYQ"}},"msgtype":"m.text"},"ts":1656866375561,"senderName":"Jack Works","senderId":"@jackworks:matrix.org","id":"$M1hb_8gaAtvqRMNR7VVIxPB-ioUhMNjSpH-GXnv6e4o"},
{"content":{"body":"The promise returned by dynamic import could settle after all first turns are completed.","msgtype":"m.text","org.matrix.msc1767.text":"The promise returned by dynamic import could settle after all first turns are completed."},"ts":1656866415764,"senderName":"Kris Kowal","senderId":"@kriskowal:matrix.org","id":"$FIm-Z2VV6hmhReiUc5OfgH_a_7KfV1qIhfoA3E7uBHQ"},
{"content":{"body":"Not that I think that’s sensible, but I don’t assume.","msgtype":"m.text","org.matrix.msc1767.text":"Not that I think that’s sensible, but I don’t assume."},"ts":1656866431928,"senderName":"Kris Kowal","senderId":"@kriskowal:matrix.org","id":"$AixpAaSbrqy7DGHuJh2zfTI0T2G_VxAEJIRcIhDt19I"},
{"content":{"body":"And I haven’t yet read :-)","msgtype":"m.text","org.matrix.msc1767.text":"And I haven’t yet read :-)"},"ts":1656866443435,"senderName":"Kris Kowal","senderId":"@kriskowal:matrix.org","id":"$saLkwmX1jOhyo43bdlcxLSG1L7h7GY9XRdLXMBYQPCE"},
{"content":{"body":"In any case, I think it will be sufficient to fix that text to match whatever already exists, or delete it if we don’t have to specify the behavior in the module loader / compartments proposal.","msgtype":"m.text","org.matrix.msc1767.text":"In any case, I think it will be sufficient to fix that text to match whatever already exists, or delete it if we don’t have to specify the behavior in the module loader / compartments proposal."},"ts":1656866503331,"senderName":"Kris Kowal","senderId":"@kriskowal:matrix.org","id":"$pvrzN54wEi6ulLkBwHhNeVv3f-hLOYZaT59CC5sgUXc"},
{"content":{"body":"As for how much needs to be done in user code, I need to write a sketch of implementing Compartment in user code, in terms of Module, ModuleSource, and ExecutionContext constructors.","msgtype":"m.text","org.matrix.msc1767.text":"As for how much needs to be done in user code, I need to write a sketch of implementing Compartment in user code, in terms of Module, ModuleSource, and ExecutionContext constructors."},"ts":1656866535129,"senderName":"Kris Kowal","senderId":"@kriskowal:matrix.org","id":"$55-_coiMXQ94lq5SzWx0nEZV_0p6GiP45TFPzZcN-Ko"},
{"content":{"body":"I’m expecting to write a couple hundred lines.","msgtype":"m.text","org.matrix.msc1767.text":"I’m expecting to write a couple hundred lines."},"ts":1656866545313,"senderName":"Kris Kowal","senderId":"@kriskowal:matrix.org","id":"$iTxjFw36gs6_HeKSLWrwzSzIfI1ZTZO4Z3kTQCVWC2k"},
{"content":{"body":"Again, I know almost nothing about top-level-await, having not used it nor watched the proposal develop. Very much dependent on an expert to call out the right answer for sinking promises.","msgtype":"m.text","org.matrix.msc1767.text":"Again, I know almost nothing about top-level-await, having not used it nor watched the proposal develop. Very much dependent on an expert to call out the right answer for sinking promises."},"ts":1656866782302,"senderName":"Kris Kowal","senderId":"@kriskowal:matrix.org","id":"$Wjp70cv2WPW8ZELV0uZaystuj6BVkhNKYBZyKc3bJyk"}
]
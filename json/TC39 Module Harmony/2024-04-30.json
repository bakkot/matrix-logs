[
{"content":{"body":"I believe import.now is still at Stage i, as in imaginary","msgtype":"m.text"},"ts":1714438916936,"senderName":"kriskowal","senderId":"@kriskowal:aelf.land","id":"$kbqPf1yQNBrHijxIa6UzTOl1CCPgmAqFuI4nHBTlRCA"},
{"content":{"body":"But it would be coherent with XS compartment.importNow, which does at least have an explainer","msgtype":"m.text"},"ts":1714438980013,"senderName":"kriskowal","senderId":"@kriskowal:aelf.land","id":"$5qio95vxbVcRM-3NYPjz9X5KsfPJonK7i4ml3TjvVLs"},
{"content":{"body":"MetaMask and Agoric are implementing a Compartment importNowHook presently, which would be hooked by import.now if the specified module hasnâ€™t previously loaded (importHook returns a Promise so is ineligible in that case)","msgtype":"m.text"},"ts":1714439107409,"senderName":"kriskowal","senderId":"@kriskowal:aelf.land","id":"$5ct7QY1ql2XviJOR3HY_tXh_BMDqE3EPMEfKmBeavRE"},
{"content":{"body":"I patched `createRequire` into `process` on Node and then converted TS to ESM; it looks like a TLA-free ESM TypeScript public API is quite possible: https://github.com/nodejs/node/issues/52599#issuecomment-2084323892","format":"org.matrix.custom.html","formatted_body":"I patched <code>createRequire</code> into <code>process</code> on Node and then converted TS to ESM; it looks like a TLA-free ESM TypeScript public API is quite possible: https://github.com/nodejs/node/issues/52599#issuecomment-2084323892","m.mentions":{},"msgtype":"m.text"},"ts":1714449015503,"senderName":"jakebailey","senderId":"@jakebailey:matrix.org","id":"$rWSWHXXTl_xA_mlNcnSp8wRWf8PGuXlc-QHSyWwJXZM"},
{"content":{"body":"why does it need to be assigned to process?","m.mentions":{},"m.relates_to":{"event_id":"$rWSWHXXTl_xA_mlNcnSp8wRWf8PGuXlc-QHSyWwJXZM","is_falling_back":true,"m.in_reply_to":{"event_id":"$rWSWHXXTl_xA_mlNcnSp8wRWf8PGuXlc-QHSyWwJXZM"},"rel_type":"m.thread"},"msgtype":"m.text"},"ts":1714451715449,"senderName":"ljharb","senderId":"@ljharb:matrix.org","id":"$cqpl4h-sMcI_jPjoxKk4v-axSxUKAv5ehIUSrWlJ5-4"},
{"content":{"body":" * why does it need to be assigned to process? (you can require, or import, `module`, as needed)","format":"org.matrix.custom.html","formatted_body":" * why does it need to be assigned to process? (you can require, or import, <code>module</code>, as needed)","m.mentions":{"user_ids":["@jakebailey:matrix.org"]},"m.new_content":{"body":"why does it need to be assigned to process? (you can require, or import, `module`, as needed)","format":"org.matrix.custom.html","formatted_body":"why does it need to be assigned to process? (you can require, or import, <code>module</code>, as needed)","m.mentions":{"user_ids":["@jakebailey:matrix.org"]},"msgtype":"m.text"},"m.relates_to":{"event_id":"$cqpl4h-sMcI_jPjoxKk4v-axSxUKAv5ehIUSrWlJ5-4","rel_type":"m.replace"},"msgtype":"m.text"},"ts":1714451729315,"senderName":"ljharb","senderId":"@ljharb:matrix.org","id":"$YRwCNSdntbG7BTQ8PVixayLNkvEnjexoQL6OeQDNFz0"},
{"content":{"body":"That was one of the options we talked about in the meeting; a goal is that the ESM can be loaded into the browser and not fail due to not being able to resolve node's builtin modules","m.mentions":{},"m.relates_to":{"event_id":"$rWSWHXXTl_xA_mlNcnSp8wRWf8PGuXlc-QHSyWwJXZM","is_falling_back":true,"m.in_reply_to":{"event_id":"$cqpl4h-sMcI_jPjoxKk4v-axSxUKAv5ehIUSrWlJ5-4"},"rel_type":"m.thread"},"msgtype":"m.text"},"ts":1714451759096,"senderName":"jakebailey","senderId":"@jakebailey:matrix.org","id":"$V9Fyapv15IsQn-X03WlNH20HPoBgG9OxY1yptNxwFCU"},
{"content":{"body":"or, other non-node runtimes","m.mentions":{},"m.relates_to":{"event_id":"$rWSWHXXTl_xA_mlNcnSp8wRWf8PGuXlc-QHSyWwJXZM","is_falling_back":true,"m.in_reply_to":{"event_id":"$V9Fyapv15IsQn-X03WlNH20HPoBgG9OxY1yptNxwFCU"},"rel_type":"m.thread"},"msgtype":"m.text"},"ts":1714451770028,"senderName":"jakebailey","senderId":"@jakebailey:matrix.org","id":"$mVAldElyGxvomJ39swmBrjBE87Qiilp1s5VLcwTfTTA"},
{"content":{"body":"(you can technically shim out the node modules with import maps, but that is a huge pain for several reasons)","m.mentions":{},"m.relates_to":{"event_id":"$rWSWHXXTl_xA_mlNcnSp8wRWf8PGuXlc-QHSyWwJXZM","is_falling_back":true,"m.in_reply_to":{"event_id":"$mVAldElyGxvomJ39swmBrjBE87Qiilp1s5VLcwTfTTA"},"rel_type":"m.thread"},"msgtype":"m.text"},"ts":1714452064486,"senderName":"bakkot","senderId":"@bakkot:matrix.org","id":"$ltMyqJeltZsjvk7-rBMPP9Y5jCIApN_HgXev-l4PzZ4"},
{"content":{"body":"Yep; that was one of the alternatives, use import maps and a node condition, but I was not sure how at all that would interplay with bundlers, runtimes like Bun, or how you import that from a browser without it breaking (I am not familiar with import maps in a browser at all...)","m.mentions":{},"m.relates_to":{"event_id":"$rWSWHXXTl_xA_mlNcnSp8wRWf8PGuXlc-QHSyWwJXZM","is_falling_back":true,"m.in_reply_to":{"event_id":"$ltMyqJeltZsjvk7-rBMPP9Y5jCIApN_HgXev-l4PzZ4"},"rel_type":"m.thread"},"msgtype":"m.text"},"ts":1714452119256,"senderName":"jakebailey","senderId":"@jakebailey:matrix.org","id":"$m3sYYFMlpHJzLP3qfdUJotvPS_zP76jaLzXHASomKrs"},
{"content":{"body":"Bun has `improt.meta.require` which is effectively already what I want but I can understand why that's not very desirable ðŸ˜„","format":"org.matrix.custom.html","formatted_body":"Bun has <code>improt.meta.require</code> which is effectively already what I want but I can understand why that's not very desirable ðŸ˜„","m.mentions":{},"m.relates_to":{"event_id":"$rWSWHXXTl_xA_mlNcnSp8wRWf8PGuXlc-QHSyWwJXZM","is_falling_back":true,"m.in_reply_to":{"event_id":"$m3sYYFMlpHJzLP3qfdUJotvPS_zP76jaLzXHASomKrs"},"rel_type":"m.thread"},"msgtype":"m.text"},"ts":1714452152258,"senderName":"jakebailey","senderId":"@jakebailey:matrix.org","id":"$2XDQGXadbmW81wruZLAMvE93ygNWiJJO8zfUsAyZQI0"},
{"content":{"body":" * Bun has `import.meta.require` which is effectively already what I want but I can understand why that's not very desirable ðŸ˜„","format":"org.matrix.custom.html","formatted_body":" * Bun has <code>import.meta.require</code> which is effectively already what I want but I can understand why that's not very desirable ðŸ˜„","m.mentions":{},"m.new_content":{"body":"Bun has `import.meta.require` which is effectively already what I want but I can understand why that's not very desirable ðŸ˜„","format":"org.matrix.custom.html","formatted_body":"Bun has <code>import.meta.require</code> which is effectively already what I want but I can understand why that's not very desirable ðŸ˜„","m.mentions":{},"msgtype":"m.text"},"m.relates_to":{"event_id":"$2XDQGXadbmW81wruZLAMvE93ygNWiJJO8zfUsAyZQI0","rel_type":"m.replace"},"msgtype":"m.text"},"ts":1714452157090,"senderName":"jakebailey","senderId":"@jakebailey:matrix.org","id":"$pLPOCfjh4WUKVKH3rlDPcaRIa4VtkRbUzOjk2B0QNJY"},
{"content":{"body":"adding it to process would make it fail in the browser too tho, no?","m.mentions":{},"m.relates_to":{"event_id":"$rWSWHXXTl_xA_mlNcnSp8wRWf8PGuXlc-QHSyWwJXZM","is_falling_back":true,"m.in_reply_to":{"event_id":"$2XDQGXadbmW81wruZLAMvE93ygNWiJJO8zfUsAyZQI0"},"rel_type":"m.thread"},"msgtype":"m.text"},"ts":1714452416252,"senderName":"ljharb","senderId":"@ljharb:matrix.org","id":"$ABdb6pgxV9Ll8iOUbMMKAg1xha0Nzl9UyHFU4F_zYAM"},
{"content":{"body":"like, if you have to do a browser-specific transform or shim, why put it on `process` which doesn't exist in the browser?","format":"org.matrix.custom.html","formatted_body":"like, if you have to do a browser-specific transform or shim, why put it on <code>process</code> which doesn't exist in the browser?","m.mentions":{},"m.relates_to":{"event_id":"$rWSWHXXTl_xA_mlNcnSp8wRWf8PGuXlc-QHSyWwJXZM","is_falling_back":true,"m.in_reply_to":{"event_id":"$ABdb6pgxV9Ll8iOUbMMKAg1xha0Nzl9UyHFU4F_zYAM"},"rel_type":"m.thread"},"msgtype":"m.text"},"ts":1714452445595,"senderName":"ljharb","senderId":"@ljharb:matrix.org","id":"$pnjSLdK7L0wx7KjHY77oNPDqyFwKaS0Ra1oEsSxFN3U"},
{"content":{"body":"Oh, this is me simulating the linked issue  proposal, i.e. node provides this","m.relates_to":{"event_id":"$rWSWHXXTl_xA_mlNcnSp8wRWf8PGuXlc-QHSyWwJXZM","is_falling_back":true,"m.in_reply_to":{"event_id":"$pnjSLdK7L0wx7KjHY77oNPDqyFwKaS0Ra1oEsSxFN3U"},"rel_type":"m.thread"},"msgtype":"m.text"},"ts":1714452453181,"senderName":"jakebailey","senderId":"@jakebailey:matrix.org","id":"$bM4GN-F3UMk_VmPlc34lYtQpoGO5rsd2i1Q8CraCrP4"},
{"content":{"body":"sure, but node provides the node core module `module` too","format":"org.matrix.custom.html","formatted_body":"sure, but node provides the node core module <code>module</code> too","m.mentions":{},"m.relates_to":{"event_id":"$rWSWHXXTl_xA_mlNcnSp8wRWf8PGuXlc-QHSyWwJXZM","is_falling_back":true,"m.in_reply_to":{"event_id":"$bM4GN-F3UMk_VmPlc34lYtQpoGO5rsd2i1Q8CraCrP4"},"rel_type":"m.thread"},"msgtype":"m.text"},"ts":1714452465866,"senderName":"ljharb","senderId":"@ljharb:matrix.org","id":"$R9isCM184WFDboqwIVsWdMxi_yo58JunXMvtwpQXqKI"},
{"content":{"body":"Or similar method to get sync conditional import ","m.relates_to":{"event_id":"$rWSWHXXTl_xA_mlNcnSp8wRWf8PGuXlc-QHSyWwJXZM","is_falling_back":true,"m.in_reply_to":{"event_id":"$R9isCM184WFDboqwIVsWdMxi_yo58JunXMvtwpQXqKI"},"rel_type":"m.thread"},"msgtype":"m.text"},"ts":1714452467589,"senderName":"jakebailey","senderId":"@jakebailey:matrix.org","id":"$1jZBMRyHnStuQJyehODC3SFTUCEVTm1AVqzYGN9k0sU"},
{"content":{"body":"Yeah but I can't import that without import...","m.relates_to":{"event_id":"$rWSWHXXTl_xA_mlNcnSp8wRWf8PGuXlc-QHSyWwJXZM","is_falling_back":true,"m.in_reply_to":{"event_id":"$1jZBMRyHnStuQJyehODC3SFTUCEVTm1AVqzYGN9k0sU"},"rel_type":"m.thread"},"msgtype":"m.text"},"ts":1714452477338,"senderName":"jakebailey","senderId":"@jakebailey:matrix.org","id":"$0kWOuhfrcf80s5CE6RbUH1yZtO3ZVXecCjRuvwnS4HI"},
{"content":{"body":"ah ok, you want to provide `require` in ESM, but in browsers, there's no sync way to load things","format":"org.matrix.custom.html","formatted_body":"ah ok, you want to provide <code>require</code> in ESM, but in browsers, there's no sync way to load things","m.mentions":{},"m.relates_to":{"event_id":"$rWSWHXXTl_xA_mlNcnSp8wRWf8PGuXlc-QHSyWwJXZM","is_falling_back":true,"m.in_reply_to":{"event_id":"$0kWOuhfrcf80s5CE6RbUH1yZtO3ZVXecCjRuvwnS4HI"},"rel_type":"m.thread"},"msgtype":"m.text"},"ts":1714452500037,"senderName":"ljharb","senderId":"@ljharb:matrix.org","id":"$jT1CmqxSMLhyLcUlSawdRCLwSQ8W5IcRiOLuCDKbRkQ"},
{"content":{"body":"i mean, you could provide, in browsers, a `require` global, and that'd probably be \"fine\"","format":"org.matrix.custom.html","formatted_body":"i mean, you could provide, in browsers, a <code>require</code> global, and that'd probably be \"fine\"","m.mentions":{},"m.relates_to":{"event_id":"$rWSWHXXTl_xA_mlNcnSp8wRWf8PGuXlc-QHSyWwJXZM","is_falling_back":true,"m.in_reply_to":{"event_id":"$jT1CmqxSMLhyLcUlSawdRCLwSQ8W5IcRiOLuCDKbRkQ"},"rel_type":"m.thread"},"msgtype":"m.text"},"ts":1714452521744,"senderName":"ljharb","senderId":"@ljharb:matrix.org","id":"$ZplKVDPMdmIKENjwdCKmBzhidsj-m8RaH9boAh-C9O0"},
{"content":{"body":"Right, but that's fine for us as that's only needed for node. That or import.now would do it too","m.relates_to":{"event_id":"$rWSWHXXTl_xA_mlNcnSp8wRWf8PGuXlc-QHSyWwJXZM","is_falling_back":true,"m.in_reply_to":{"event_id":"$ZplKVDPMdmIKENjwdCKmBzhidsj-m8RaH9boAh-C9O0"},"rel_type":"m.thread"},"msgtype":"m.text"},"ts":1714452528337,"senderName":"jakebailey","senderId":"@jakebailey:matrix.org","id":"$NSCQLjFgaNfPz7jOkVOfeAYTcTMSEGYWYEWAj-MEjGE"},
{"content":{"body":"but the presence of a `process` global in browsers could break things if they're using it for env detection","format":"org.matrix.custom.html","formatted_body":"but the presence of a <code>process</code> global in browsers could break things if they're using it for env detection","m.mentions":{},"m.relates_to":{"event_id":"$rWSWHXXTl_xA_mlNcnSp8wRWf8PGuXlc-QHSyWwJXZM","is_falling_back":true,"m.in_reply_to":{"event_id":"$NSCQLjFgaNfPz7jOkVOfeAYTcTMSEGYWYEWAj-MEjGE"},"rel_type":"m.thread"},"msgtype":"m.text"},"ts":1714452544555,"senderName":"ljharb","senderId":"@ljharb:matrix.org","id":"$kaM5qmZbtTSG5gUisHk3Vn3vSiZvaPBp47Go5ueTMtY"},
{"content":{"body":"The hack is just a hack to simulate having \"any API\" that does what we're looking for","m.relates_to":{"event_id":"$rWSWHXXTl_xA_mlNcnSp8wRWf8PGuXlc-QHSyWwJXZM","is_falling_back":true,"m.in_reply_to":{"event_id":"$kaM5qmZbtTSG5gUisHk3Vn3vSiZvaPBp47Go5ueTMtY"},"rel_type":"m.thread"},"msgtype":"m.text"},"ts":1714452591385,"senderName":"jakebailey","senderId":"@jakebailey:matrix.org","id":"$k6zeqfsd0G9VuaksXqIqGO8DLWHzYxIFPBFVULVBaq4"}
]
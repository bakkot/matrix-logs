[
{"content":{"body":"Hello ~","msgtype":"m.text"},"ts":1654576141191,"senderName":"Jack Works","senderId":"@jackworks:matrix.org","id":"$4SrF2-JMf9bOgUdU1AELJu8lGENhHyb00p2cKVZ6alY"},
{"content":{"body":"In the [current](https://github.com/tc39/proposal-compartments/blob/6a180313515f6faec2818dad229e6921109b50f5/README.md) `ThirdPartyStaticModuleRecord` API, the initialize function only receives a `ModuleEnvironmentRecord` (which looks like only containing `import` and `export` bindings). There is no way to access the `globalThis` of the current executing compartment.\n\nLacking this ability make it impossible to compile a ES Module into a `ThirdPartyStaticModuleRecord`.","format":"org.matrix.custom.html","formatted_body":"<p>In the <a href=\"https://github.com/tc39/proposal-compartments/blob/6a180313515f6faec2818dad229e6921109b50f5/README.md\">current</a> <code>ThirdPartyStaticModuleRecord</code> API, the initialize function only receives a <code>ModuleEnvironmentRecord</code> (which looks like only containing <code>import</code> and <code>export</code> bindings). There is no way to access the <code>globalThis</code> of the current executing compartment.</p>\n<p>Lacking this ability make it impossible to compile a ES Module into a <code>ThirdPartyStaticModuleRecord</code>.</p>\n","msgtype":"m.text","org.matrix.msc1767.message":[{"body":"In the [current](https://github.com/tc39/proposal-compartments/blob/6a180313515f6faec2818dad229e6921109b50f5/README.md) `ThirdPartyStaticModuleRecord` API, the initialize function only receives a `ModuleEnvironmentRecord` (which looks like only containing `import` and `export` bindings). There is no way to access the `globalThis` of the current executing compartment.\n\nLacking this ability make it impossible to compile a ES Module into a `ThirdPartyStaticModuleRecord`.","mimetype":"text/plain"},{"body":"<p>In the <a href=\"https://github.com/tc39/proposal-compartments/blob/6a180313515f6faec2818dad229e6921109b50f5/README.md\">current</a> <code>ThirdPartyStaticModuleRecord</code> API, the initialize function only receives a <code>ModuleEnvironmentRecord</code> (which looks like only containing <code>import</code> and <code>export</code> bindings). There is no way to access the <code>globalThis</code> of the current executing compartment.</p>\n<p>Lacking this ability make it impossible to compile a ES Module into a <code>ThirdPartyStaticModuleRecord</code>.</p>\n","mimetype":"text/html"}]},"ts":1654577630131,"senderName":"Jack Works","senderId":"@jackworks:matrix.org","id":"$vlMBzRHGO6gxEQBtmnUHK-gq6AU6wCvJxYacXAIbd0U"},
{"content":{"body":"For folks tuning in, Jack is trying to build a no-eval shim for Compartments that precompiles ESM into a bundle.","msgtype":"m.text","org.matrix.msc1767.text":"For folks tuning in, Jack is trying to build a no-eval shim for Compartments that precompiles ESM into a bundle."},"ts":1654579074323,"senderName":"Kris Kowal","senderId":"@kriskowal:matrix.org","id":"$01x2wIYwUodFe5edznKK9AwLUnetPvdXoQr7rmoK2cg"},
{"content":{"body":"I assume you’re aware that third-party static-module-records can’t emulate live bindings.","msgtype":"m.text","org.matrix.msc1767.text":"I assume you’re aware that third-party static-module-records can’t emulate live bindings."},"ts":1654579105948,"senderName":"Kris Kowal","senderId":"@kriskowal:matrix.org","id":"$saN-4TvCl66jHUD38CFvWNYBI3jFt-auWdvdi6c5wQc"},
{"content":{"body":"Jack Works: Have you looked at https://github.com/endojs/endo/blob/master/packages/compartment-mapper/src/bundle.js","format":"org.matrix.custom.html","formatted_body":"<a href=\"https://matrix.to/#/@jackworks:matrix.org\">Jack Works</a>: Have you looked at https://github.com/endojs/endo/blob/master/packages/compartment-mapper/src/bundle.js","msgtype":"m.text","org.matrix.msc1767.message":[{"body":"Jack Works: Have you looked at https://github.com/endojs/endo/blob/master/packages/compartment-mapper/src/bundle.js","mimetype":"text/plain"},{"body":"<a href=\"https://matrix.to/#/@jackworks:matrix.org\">Jack Works</a>: Have you looked at https://github.com/endojs/endo/blob/master/packages/compartment-mapper/src/bundle.js","mimetype":"text/html"}]},"ts":1654579170107,"senderName":"Kris Kowal","senderId":"@kriskowal:matrix.org","id":"$tL4LlIGHhNetKLnHxAJ-wLZepNcTd3dMlz0D6nLWMyI"},
{"content":{"body":"That uses the SES shim’s static module record to create a bundle. It’s not a complete implementation, but it might be similar to your approach.","msgtype":"m.text","org.matrix.msc1767.text":"That uses the SES shim’s static module record to create a bundle. It’s not a complete implementation, but it might be similar to your approach."},"ts":1654579206187,"senderName":"Kris Kowal","senderId":"@kriskowal:matrix.org","id":"$FFUTWj1JGVVtScgHnx1tCK8cmp_1idZYFTtM_CO2hSk"},
{"content":{"body":"> <@kriskowal:matrix.org> I assume you’re aware that third-party static-module-records can’t emulate live bindings.\n\nI'm aware that it cannot get the globalThis of the current compartment (it didn't pass as an argument in the initialize function)","format":"org.matrix.custom.html","formatted_body":"<mx-reply><blockquote><a href=\"https://matrix.to/#/!RkpmGMjJtqLKXzByOT:matrix.org/$saN-4TvCl66jHUD38CFvWNYBI3jFt-auWdvdi6c5wQc?via=matrix.org&via=igalia.com\">In reply to</a> <a href=\"https://matrix.to/#/@kriskowal:matrix.org\">@kriskowal:matrix.org</a><br />I assume you’re aware that third-party static-module-records can’t emulate live bindings.</blockquote></mx-reply>I'm aware that it cannot get the globalThis of the current compartment (it didn't pass as an argument in the initialize function)","m.relates_to":{"m.in_reply_to":{"event_id":"$saN-4TvCl66jHUD38CFvWNYBI3jFt-auWdvdi6c5wQc"}},"msgtype":"m.text"},"ts":1654579207298,"senderName":"Jack Works","senderId":"@jackworks:matrix.org","id":"$F8rtJx9vV7PLgt1VWZU2dQdcg3gOc2Hmzar9FemKW8k"}
]
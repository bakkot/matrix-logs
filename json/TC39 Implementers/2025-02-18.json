[
{"content":{"body":"shu: if you set kMaxTypedArrayInHeap to 0, and allocate an empty buffer, it will use an empty on-heap buffer: https://source.chromium.org/chromium/chromium/src/+/main:v8/src/builtins/typed-array-createtypedarray.tq;l=95?q=typedarrayinitialize&ss=chromium\n\nwhich is not inherently bad ig, but it leads to a weird thing where an embedder using max=0 will find that some empty typedarrays have a non-null data pointer. i assume this isn't directly intentional but i'm curious, given the sensitivity of arraybuffer stuff, whether v8 would be accepting of CLs to change this.","format":"org.matrix.custom.html","formatted_body":"<p><a href=\"https://matrix.to/#/@shuyuguo:matrix.org\">shu</a>: if you set kMaxTypedArrayInHeap to 0, and allocate an empty buffer, it will use an empty on-heap buffer: https://source.chromium.org/chromium/chromium/src/+/main:v8/src/builtins/typed-array-createtypedarray.tq;l=95?q=typedarrayinitialize&amp;ss=chromium</p>\n<p>which is not inherently bad ig, but it leads to a weird thing where an embedder using max=0 will find that some empty typedarrays have a non-null data pointer. i assume this isn't directly intentional but i'm curious, given the sensitivity of arraybuffer stuff, whether v8 would be accepting of CLs to change this.</p>\n","m.mentions":{"user_ids":["@shuyuguo:matrix.org"]},"msgtype":"m.text"},"ts":1739908337955,"senderName":"snek","senderId":"@devsnek:matrix.org","id":"$-ZV4-lBfBH33_vAVHbY8CU0uPvaAEsuaJHHZB50OH0I"},
{"content":{"body":"i don't know the implications of changing it. is it an important invariant in your embedding that max=0 implies null data ptr?","m.mentions":{},"msgtype":"m.text"},"ts":1739908612015,"senderName":"shu","senderId":"@shuyuguo:matrix.org","id":"$9XvVcd-6iixMemuQvMDzPSSmbV2IwrRXSE75FMCo20A"},
{"content":{"body":"its generally established in the node/node adjacent ecosystem that native addons see null pointers for empty buffers. we do have a workaround for it though: https://github.com/denoland/deno/blob/main/ext/ffi/ir.rs#L373-L381","m.mentions":{},"msgtype":"m.text"},"ts":1739908718183,"senderName":"snek","senderId":"@devsnek:matrix.org","id":"$LxDJtMwyW30lGx004lgnvOcp9wiprgtu6Sp7EWFZqC4"},
{"content":{"body":"it's worth asking the question at least. i don't know the current reason for its being like that, or how important it is, off the top of my head","m.mentions":{},"msgtype":"m.text"},"ts":1739908743136,"senderName":"shu","senderId":"@shuyuguo:matrix.org","id":"$J6DhhhZP-g_xvdSqIu0IoYu0y40YnSXqABJyFgUD1ek"},
{"content":{"body":"kk, i'll poke around a bit more then. thanks","m.mentions":{},"msgtype":"m.text"},"ts":1739908775538,"senderName":"snek","senderId":"@devsnek:matrix.org","id":"$lDi5Jg1lebkJ-5kMIJrepRYYbG0j0nbByavjxM210CI"}
]
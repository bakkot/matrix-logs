[
{"content":{"body":"> <@ljharb:matrix.org> what's the perf of Object.hasOwn vs Object.prototype.hasOwnProperty.call? (re https://github.com/nodejs/node/pull/54710#issuecomment-2325374488 )\n\ni agree with joyee's comment","format":"org.matrix.custom.html","formatted_body":"<mx-reply><blockquote><a href=\"https://matrix.to/#/!eHkwtWesRXuxHVBgDG:matrix.org/$CleOmDHygnHOm3kAzuRoIuMhMaHHzVh1m4dg345eLYw?via=matrix.org&via=mozilla.org&via=igalia.com\">In reply to</a> <a href=\"https://matrix.to/#/@ljharb:matrix.org\">@ljharb:matrix.org</a><br>what&#39;s the perf of Object.hasOwn vs Object.prototype.hasOwnProperty.call? (re https://github.com/nodejs/node/pull/54710#issuecomment-2325374488 )</blockquote></mx-reply>i agree with joyee's comment","m.mentions":{"user_ids":["@ljharb:matrix.org"]},"m.relates_to":{"m.in_reply_to":{"event_id":"$CleOmDHygnHOm3kAzuRoIuMhMaHHzVh1m4dg345eLYw"}},"msgtype":"m.text"},"ts":1725393933395,"senderName":"snek","senderId":"@devsnek:matrix.org","id":"$W4cZK-Ay3eU_O1xBpDlvlcFK3VToimIlcYQGs_AqxWg"},
{"content":{"body":"it could be improved though","m.mentions":{},"msgtype":"m.text"},"ts":1725393942201,"senderName":"snek","senderId":"@devsnek:matrix.org","id":"$rWSGuJxItSSiTV79ReYRhM_6MwBACIHBCuIYftJaf3k"},
{"content":{"body":"i'm sure it's accurate. but it doesn't make any sense to me why it'd be implemented in that way","m.mentions":{},"msgtype":"m.text"},"ts":1725394455730,"senderName":"ljharb","senderId":"@ljharb:matrix.org","id":"$Ebtwydma96c4kY-AexHF-V3JKqRjCeblgqaYu7fBI_w"},
{"content":{"body":"how would you implement it?","m.mentions":{},"msgtype":"m.text"},"ts":1725394466528,"senderName":"shu","senderId":"@shuyuguo:matrix.org","id":"$ig9TwTh6P55Q7Zzk0xJb7k91zZvSBkqHvH6NzRva_LY"},
{"content":{"body":"i would imagine it was convenient at the time. generally v8 development goes like 1) implement thing correctly and then 2) optimize given the known working impl","m.mentions":{},"msgtype":"m.text"},"ts":1725394498590,"senderName":"snek","senderId":"@devsnek:matrix.org","id":"$jUA7Ily1qvqKC9LSTJ3Jp66lT7g49dT0HmUon4uKsg4"},
{"content":{"body":"fwiw I implemented it basically the same in my engine","m.mentions":{},"msgtype":"m.text"},"ts":1725399763049,"senderName":"canadahonk","senderId":"@canadahonk:matrix.org","id":"$W6ezb22BgSCYbls6l074CDXUgyovEtNP4LfsiNAvouA"},
{"content":{"body":"i would assume that whatever hasOwnProperty does to check that the object has the property is the same thing hasOwn would do","m.mentions":{},"msgtype":"m.text"},"ts":1725404691387,"senderName":"ljharb","senderId":"@ljharb:matrix.org","id":"$8zN3SVnrGQe6VRGD6X_W2ahyExEXhk-4cW0H3j6BbM4"},
{"content":{"body":"as opposed to just wrapping hasOwnProperty","m.mentions":{},"msgtype":"m.text"},"ts":1725404699000,"senderName":"ljharb","senderId":"@ljharb:matrix.org","id":"$Xd3JqgZXoQewz23uubKO8k7DIrDuoGl0jx0wpQA8e6k"},
{"content":{"body":"then all of the various optimizations which look for hasOwnProperty would have to be updated to look for both hasOwn and hasOwnProperty","m.mentions":{},"msgtype":"m.text"},"ts":1725406063095,"senderName":"bakkot","senderId":"@bakkot:matrix.org","id":"$dYP5XGEDnQWS-H1gOO9o8Y8vF9aXaYUXLmxvuB7oDec"},
{"content":{"body":"> <@ljharb:matrix.org> i would assume that whatever hasOwnProperty does to check that the object has the property is the same thing hasOwn would do\n\nbut why would this make hasOwn faster than hasOwnProperty?","format":"org.matrix.custom.html","formatted_body":"<mx-reply><blockquote><a href=\"https://matrix.to/#/!eHkwtWesRXuxHVBgDG:matrix.org/$8zN3SVnrGQe6VRGD6X_W2ahyExEXhk-4cW0H3j6BbM4?via=matrix.org&via=mozilla.org&via=igalia.com\">In reply to</a> <a href=\"https://matrix.to/#/@ljharb:matrix.org\">@ljharb:matrix.org</a><br>i would assume that whatever hasOwnProperty does to check that the object has the property is the same thing hasOwn would do</blockquote></mx-reply>but why would this make hasOwn faster than hasOwnProperty?","m.mentions":{"user_ids":["@ljharb:matrix.org"]},"m.relates_to":{"m.in_reply_to":{"event_id":"$8zN3SVnrGQe6VRGD6X_W2ahyExEXhk-4cW0H3j6BbM4"}},"msgtype":"m.text"},"ts":1725406412653,"senderName":"shu","senderId":"@shuyuguo:matrix.org","id":"$nb5i8JaAeMpV4Hdy-xO-8CGoYwVdtG8tBTcqiQT-i-0"},
{"content":{"body":"it wouldn't, it'd make it no slower","m.mentions":{},"msgtype":"m.text"},"ts":1725406944266,"senderName":"ljharb","senderId":"@ljharb:matrix.org","id":"$ctQGSVl52FFcoNipdnpDHaGQA1AnCACzbqJNy_Pxcdk"},
{"content":{"body":" * it wouldn't, it'd make it \"no slower\"","m.mentions":{},"m.new_content":{"body":"it wouldn't, it'd make it \"no slower\"","m.mentions":{},"msgtype":"m.text"},"m.relates_to":{"event_id":"$ctQGSVl52FFcoNipdnpDHaGQA1AnCACzbqJNy_Pxcdk","rel_type":"m.replace"},"msgtype":"m.text"},"ts":1725406950569,"senderName":"ljharb","senderId":"@ljharb:matrix.org","id":"$MYjX8qdDfjSQRZyNUqItW1dEDwIH_FBtxBeVDOsqtvI"},
{"content":{"body":"best to benchmark the current difference, i expect a few branches won't matter too much in practice if you think hasOwn is better stylistically","m.mentions":{},"msgtype":"m.text"},"ts":1725407017920,"senderName":"shu","senderId":"@shuyuguo:matrix.org","id":"$E6CnRrtdyLFzPsK6-Jej5ddMy2Uf2TZ89LoQG52z9KA"},
{"content":{"body":"I don’t think the call is the slow part of the implementation?","msgtype":"m.text"},"ts":1725407042592,"senderName":"Justin Ridgewell","senderId":"@jridgewell:matrix.org","id":"$wbZANWmNcx7780jZp6mCzMloilwYEjgYcDJtOTawp7Y"},
{"content":{"body":"It’s the extra checks done before the call","msgtype":"m.text"},"ts":1725407056368,"senderName":"Justin Ridgewell","senderId":"@jridgewell:matrix.org","id":"$wmuD6LXb-XDWyTEXwTWvwA2kkdJh5jrld6V4xXSXPIM"},
{"content":{"body":"node folks get very perf-sensitive","m.mentions":{},"msgtype":"m.text"},"ts":1725407161206,"senderName":"ljharb","senderId":"@ljharb:matrix.org","id":"$yMamlb64ZQmELlnXWbdNAj3vMJMot8_bGm_kCQibuvQ"},
{"content":{"body":"so even the mere suggestion that hasOwn is slower caused the entire PR i linked to be abandoned.","m.mentions":{},"msgtype":"m.text"},"ts":1725407215752,"senderName":"ljharb","senderId":"@ljharb:matrix.org","id":"$66Z6Mhqdf2y94u0yJW6bCudtm9wuxKkatjouv2uTqiQ"},
{"content":{"body":"> <@jridgewell:matrix.org> It’s the extra checks done before the call\n\ni don't think those are expensive checks?","format":"org.matrix.custom.html","formatted_body":"<mx-reply><blockquote><a href=\"https://matrix.to/#/!eHkwtWesRXuxHVBgDG:matrix.org/$wmuD6LXb-XDWyTEXwTWvwA2kkdJh5jrld6V4xXSXPIM?via=matrix.org&via=mozilla.org&via=igalia.com\">In reply to</a> <a href=\"https://matrix.to/#/@jridgewell:matrix.org\">@jridgewell:matrix.org</a><br>It’s the extra checks done before the call</blockquote></mx-reply>i don't think those are expensive checks?","m.mentions":{"user_ids":["@jridgewell:matrix.org"]},"m.relates_to":{"m.in_reply_to":{"event_id":"$wmuD6LXb-XDWyTEXwTWvwA2kkdJh5jrld6V4xXSXPIM"}},"msgtype":"m.text"},"ts":1725407237728,"senderName":"shu","senderId":"@shuyuguo:matrix.org","id":"$AAPPy4Bv_X5_l6aR5cmz0ax62zzAkNc6tFjSNVEBaAc"},
{"content":{"body":"Definitely not expensive, but they’re extra work vs not doing the checks.","msgtype":"m.text"},"ts":1725407280657,"senderName":"Justin Ridgewell","senderId":"@jridgewell:matrix.org","id":"$p5np8z_5smZHhANKXoVz4qjnCVEs6XT7w-82QJChm64"},
{"content":{"body":"well of course, the question is does it matter","m.mentions":{},"msgtype":"m.text"},"ts":1725407290870,"senderName":"shu","senderId":"@shuyuguo:matrix.org","id":"$MsJC1YeeTs7ALPsGfZcVQt7CQnLtY937uYwAU3veTnk"},
{"content":{"body":"https://source.chromium.org/chromium/chromium/src/+/main:v8/src/builtins/builtins-object-gen.cc;l=690-717","m.mentions":{},"msgtype":"m.text"},"ts":1725407305567,"senderName":"bakkot","senderId":"@bakkot:matrix.org","id":"$kxlNTRzW5lr1Vrk5rkW8o5DnYc5wHas43iqZIFvpIjA"},
{"content":{"body":"fwiw mdn is recommending hasOwn over hasOwnProperty","m.mentions":{},"msgtype":"m.text"},"ts":1725407307014,"senderName":"Meghan Denny","senderId":"@meghanbun:matrix.org","id":"$fDovPggdvA1jvTSTgg8Djem33-up3R5rzQ6lGQz3NF0"},
{"content":{"body":"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/hasOwn","m.mentions":{},"msgtype":"m.text"},"ts":1725407307751,"senderName":"Meghan Denny","senderId":"@meghanbun:matrix.org","id":"$r3W5yJ69g6zcJzSaeE2_bt_rUhejvezSNUsg6vAS1FU"},
{"content":{"body":" * https://source.chromium.org/chromium/chromium/src/+/main:v8/src/builtins/builtins-object-gen.cc;l=690-717 (oh I see it was already linked in the node thread, oops)","m.mentions":{},"m.new_content":{"body":"https://source.chromium.org/chromium/chromium/src/+/main:v8/src/builtins/builtins-object-gen.cc;l=690-717 (oh I see it was already linked in the node thread, oops)","m.mentions":{},"msgtype":"m.text"},"m.relates_to":{"event_id":"$kxlNTRzW5lr1Vrk5rkW8o5DnYc5wHas43iqZIFvpIjA","rel_type":"m.replace"},"msgtype":"m.text"},"ts":1725407345777,"senderName":"bakkot","senderId":"@bakkot:matrix.org","id":"$UZsThSce2PvWUaD-cl5l4tiaBeGmEBlP48cXeDuua_M"},
{"content":{"body":"if the goal is to use 'hasOwn' for whatever reason, and that reason needs to be traded off against possible performance regressions, either you are willing to quantify the regression or not","m.mentions":{},"msgtype":"m.text"},"ts":1725407355665,"senderName":"shu","senderId":"@shuyuguo:matrix.org","id":"$6-aWcL5cjL7m3_jx-5lDWgY8N_iP3wBlbSuXezCszA0"},
{"content":{"body":"if you are not willing to quantify the regression (and find out if it matters), that says to me the \"whatever reason\" for wanting to use `hasOwn` is already pretty weak","format":"org.matrix.custom.html","formatted_body":"if you are not willing to quantify the regression (and find out if it matters), that says to me the \"whatever reason\" for wanting to use <code>hasOwn</code> is already pretty weak","m.mentions":{},"msgtype":"m.text"},"ts":1725407377407,"senderName":"shu","senderId":"@shuyuguo:matrix.org","id":"$3w9wxteL_DQQvoGeEKuDGJ28XzDgvIsWsYHibVnf5uQ"},
{"content":{"body":"and the thing you should do is to convince node maintainers that it's worth the price of finding out if it's slower in a way that matters, rather than VM optimizations","m.mentions":{},"msgtype":"m.text"},"ts":1725407412340,"senderName":"shu","senderId":"@shuyuguo:matrix.org","id":"$-PgkYB9lVleaQjz4mGlE3Qbk2MWq9D6r24ehpiO8Bd0"},
{"content":{"body":"> <@shuyuguo:matrix.org> well of course, the question is does it matter\n\nProbably not, but the PR doesn’t improve the code. I think it’s be worth it if the code we’re doing `hasOwnProperty.call(obj, key)`, but node already has a devirtualized helper.","format":"org.matrix.custom.html","formatted_body":"<mx-reply><blockquote><a href=\"https://matrix.to/#/!eHkwtWesRXuxHVBgDG%3Amatrix.org/%24MsJC1YeeTs7ALPsGfZcVQt7CQnLtY937uYwAU3veTnk\">In reply to</a> <a href=\"https://matrix.to/#/@shuyuguo:matrix.org\">@shuyuguo:matrix.org</a><br>well of course, the question is does it matter</blockquote></mx-reply>Probably not, but the PR doesn’t improve the code. I think it’s be worth it if the code we’re doing <code>hasOwnProperty.call(obj, key)</code>, but node already has a devirtualized helper.","m.relates_to":{"m.in_reply_to":{"event_id":"$MsJC1YeeTs7ALPsGfZcVQt7CQnLtY937uYwAU3veTnk"}},"msgtype":"m.text"},"ts":1725407439932,"senderName":"Justin Ridgewell","senderId":"@jridgewell:matrix.org","id":"$BIf8my-7QjGlWJaIbZeejrDHI_kqEOvzvHDGXQPj41o"},
{"content":{"body":"right, that makes sense to me","m.mentions":{},"msgtype":"m.text"},"ts":1725407451687,"senderName":"shu","senderId":"@shuyuguo:matrix.org","id":"$mdgAwuO67wo3YeMw3Xu7cBimxA54pXOf31_ykehKI8U"},
{"content":{"body":"the issue is that that helper already has to do a bind","m.mentions":{},"msgtype":"m.text"},"ts":1725407454766,"senderName":"ljharb","senderId":"@ljharb:matrix.org","id":"$G6i1Dxy_F4a7Jk30tsLeXX9CmEjNllNga9N24z5xebs"},
{"content":{"body":"so they were hoping to drop the bind/call/apply. but v8 does that internally for hasOwn, so it's probably a wash","m.mentions":{},"msgtype":"m.text"},"ts":1725407472308,"senderName":"ljharb","senderId":"@ljharb:matrix.org","id":"$cAohD79vaH77CDSmYonfPGrnPgLfN7M_l1iLiK9lBeA"},
{"content":{"body":"a .bind is very different than a .call/apply","m.mentions":{},"msgtype":"m.text"},"ts":1725407487001,"senderName":"shu","senderId":"@shuyuguo:matrix.org","id":"$JERKsswqlHHuaIrshOGirOj0qDL_CrhtyzRl7kpQnb0"},
{"content":{"body":"a .bind does an allocation, v8 does not internally do that?","m.mentions":{},"msgtype":"m.text"},"ts":1725407506391,"senderName":"shu","senderId":"@shuyuguo:matrix.org","id":"$_pvkKkpr2GbS-j6T5McYXlnwIlMPJzBuSf6aDHFsrdw"},
{"content":{"body":"it just calls the builtin directly","m.mentions":{},"msgtype":"m.text"},"ts":1725407513391,"senderName":"shu","senderId":"@shuyuguo:matrix.org","id":"$Sw5J9w_OJs2rztZxeaANfqPptEMvvLZ-i_xyHJ6Ao-M"},
{"content":{"body":"🤔","m.mentions":{},"msgtype":"m.text"},"ts":1725407561705,"senderName":"ljharb","senderId":"@ljharb:matrix.org","id":"$bVyoPihLym1hHUkhFrAyalmC9lCiIHaF3S9PtVoA9JM"},
{"content":{"body":"> <@meghanbun:matrix.org> fwiw mdn is recommending hasOwn over hasOwnProperty\n\nFor regular devs, `Object.hasOwn` is a definite improvement and they shouldn’t worry about any performance change.","format":"org.matrix.custom.html","formatted_body":"<mx-reply><blockquote><a href=\"https://matrix.to/#/!eHkwtWesRXuxHVBgDG%3Amatrix.org/%24fDovPggdvA1jvTSTgg8Djem33-up3R5rzQ6lGQz3NF0\">In reply to</a> <a href=\"https://matrix.to/#/@meghanbun:matrix.org\">@meghanbun:matrix.org</a><br>fwiw mdn is recommending hasOwn over hasOwnProperty</blockquote></mx-reply>For regular devs, <code>Object.hasOwn</code> is a definite improvement and they shouldn’t worry about any performance change.","m.relates_to":{"m.in_reply_to":{"event_id":"$fDovPggdvA1jvTSTgg8Djem33-up3R5rzQ6lGQz3NF0"}},"msgtype":"m.text"},"ts":1725407601775,"senderName":"Justin Ridgewell","senderId":"@jridgewell:matrix.org","id":"$G-uvECRrqdquFCRD4qUQTZbAUgOc7b0sMFtU9CnmdSs"},
{"content":{"body":"like, the IsNullOrUndefined check is pretty cheap","m.mentions":{},"msgtype":"m.text"},"ts":1725407620651,"senderName":"shu","senderId":"@shuyuguo:matrix.org","id":"$I1fVbs38sTYXpu604Ukq2iIk4APDFuIkIAVPxJh3Z-g"},
{"content":{"body":"most of the cost i imagine is the actual builtin call","m.mentions":{},"msgtype":"m.text"},"ts":1725407650612,"senderName":"shu","senderId":"@shuyuguo:matrix.org","id":"$eXY0iOB-duM6JFnqXK-m78EzLfOH3a0VXLGWH6Ou_Xc"},
{"content":{"body":"but this is all moot -- if the reason is that it doesn't improve the code anyway","m.mentions":{},"msgtype":"m.text"},"ts":1725407680447,"senderName":"shu","senderId":"@shuyuguo:matrix.org","id":"$J2Z7z2m3mqEHOBrF9AtTlRsppZM5yMYmd-w-6l8TNeE"}
]
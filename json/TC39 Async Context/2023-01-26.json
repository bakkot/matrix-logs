[
{"content":{"body":"Except that doesn't work with error stack properties yet :-/ (as we discussed earlier)","msgtype":"m.text","m.relates_to":{"event_id":"$jjNYJHhRDRV8sSHh8GQhdYiaeQeIMwHUFM0VM-QeLvc","is_falling_back":true,"m.in_reply_to":{"event_id":"$Ze_Ih3aqDhPieR9xUkF02wxYB7DeE_J6kxPYXyqDSA0"},"rel_type":"m.thread"}},"ts":1674692219214,"senderName":"James M Snell","senderId":"@jasnell:matrix.org","id":"$rAibSDdx1OgQmBcFY-NTdMsY2-wuPWv45uX0nYdcorw"},
{"content":{"msgtype":"m.text","body":"Yah, only dev tools","m.relates_to":{"event_id":"$jjNYJHhRDRV8sSHh8GQhdYiaeQeIMwHUFM0VM-QeLvc","is_falling_back":true,"m.in_reply_to":{"event_id":"$rAibSDdx1OgQmBcFY-NTdMsY2-wuPWv45uX0nYdcorw"},"rel_type":"m.thread"}},"ts":1674692259278,"senderName":"Justin Ridgewell","senderId":"@jridgewell:matrix.org","id":"$J2vBsC_xLzTgdLe4omVdkNzEMLb5Zqfv-8LfQrL5iiQ"},
{"content":{"msgtype":"m.text","body":"Agreed. I tried to find an exact definition of \"fluid variable\" but no luck for me.","m.relates_to":{"event_id":"$0Vt9bs9uRpeeVJsyPGeWbvMy_PiAW1KKcnQcqwdsWmA","is_falling_back":true,"m.in_reply_to":{"event_id":"$XljM6ByMhTjx0Y5BdFwrQYwItPp3fB6FxIjaatzckvM"},"rel_type":"m.thread"}},"ts":1674717384525,"senderName":"Chengzhong Wu","senderId":"@legendecas:matrix.org","id":"$ixGHXItFhBQ3eNOK3wW6yAwjHeThKO_ovzSZHSONtvE"},
{"content":{"msgtype":"m.text","body":"We have an issue on generator use case in OpenTelemetry too: https://github.com/open-telemetry/opentelemetry-js/issues/2951","m.relates_to":{"event_id":"$jgi5J_yl3vA12oENmApFQ2cXz0qqLdvjhYNc7PVgAfE","is_falling_back":true,"m.in_reply_to":{"event_id":"$i2TXH4hSH6k6OuuloKOGnwj3yOz3yUt-mIajY8jxiJo"},"rel_type":"m.thread"}},"ts":1674717737081,"senderName":"Chengzhong Wu","senderId":"@legendecas:matrix.org","id":"$O4vvawvqYqDTAZNwjTPPRVQTx1WUEvzbiG0K71GnDYc"},
{"content":{"msgtype":"m.text","body":"I'll create the issue then.","m.relates_to":{"event_id":"$jgi5J_yl3vA12oENmApFQ2cXz0qqLdvjhYNc7PVgAfE","is_falling_back":true,"m.in_reply_to":{"event_id":"$O4vvawvqYqDTAZNwjTPPRVQTx1WUEvzbiG0K71GnDYc"},"rel_type":"m.thread"}},"ts":1674717829866,"senderName":"Chengzhong Wu","senderId":"@legendecas:matrix.org","id":"$QPtd8tefC7eZrALLHLvfAxsGpNMl9hWX7fHDE-KU0g0"},
{"content":{"msgtype":"m.text","body":"https://github.com/legendecas/proposal-async-context/issues/18","m.relates_to":{"event_id":"$jgi5J_yl3vA12oENmApFQ2cXz0qqLdvjhYNc7PVgAfE","is_falling_back":true,"m.in_reply_to":{"event_id":"$QPtd8tefC7eZrALLHLvfAxsGpNMl9hWX7fHDE-KU0g0"},"rel_type":"m.thread"}},"ts":1674718717251,"senderName":"Chengzhong Wu","senderId":"@legendecas:matrix.org","id":"$wtGfUBt-dcd5MvVOoLHWoGboEw1Ki48CQK6B0V3wNJQ"},
{"content":{"msgtype":"m.text","body":"Would you mind expanding on \"rename run()\"?","m.relates_to":{"event_id":"$3G_aX1utupK2064qeQwq6UJJ3KC4Wd4EuJDqdhMdReA","is_falling_back":true,"m.in_reply_to":{"event_id":"$3G_aX1utupK2064qeQwq6UJJ3KC4Wd4EuJDqdhMdReA"},"rel_type":"m.thread"}},"ts":1674754710294,"senderName":"Chengzhong Wu","senderId":"@legendecas:matrix.org","id":"$LD0T3v7hVUnlq9kz2_1Ck3Ma_to-vMSlTRxPHVJBb7A"},
{"content":{"msgtype":"m.text","body":"Just for visibiity... WinterCG discussed defining an interoperable subset of AsyncLocalStorage ... draft is here https://github.com/wintercg/proposal-common-minimum-api/pull/38"},"ts":1674755499900,"senderName":"James M Snell","senderId":"@jasnell:matrix.org","id":"$V9u2cfgejRUqMZ9pQZEjDwO0XGKM4103cjKRL-qqj_k"},
{"content":{"msgtype":"m.text","body":"the idea is to define a minimal subset of the API that runtimes can implement now while waiting for AsyncContext to be finished"},"ts":1674755520424,"senderName":"James M Snell","senderId":"@jasnell:matrix.org","id":"$HHKZldJ036Sv7Y-jZe9BG8tlVDz7Vi93FqAobQZ6c8U"},
{"content":{"msgtype":"m.text","body":"the subset is intended to be minimally compatible with the model being defined here in order to prevent incompatibilties down the road"},"ts":1674755548617,"senderName":"James M Snell","senderId":"@jasnell:matrix.org","id":"$6D9lZc8lteAhqd3D7dujQzueGvqpGJepWdF_eM6_Vn0"},
{"content":{"msgtype":"m.text","body":"I think he's referencing the module-level run helper function, not the `AC.p.run` method","format":"org.matrix.custom.html","formatted_body":"I think he's referencing the module-level run helper function, not the <code>AC.p.run</code> method","m.relates_to":{"event_id":"$3G_aX1utupK2064qeQwq6UJJ3KC4Wd4EuJDqdhMdReA","is_falling_back":true,"m.in_reply_to":{"event_id":"$LD0T3v7hVUnlq9kz2_1Ck3Ma_to-vMSlTRxPHVJBb7A"},"rel_type":"m.thread"}},"ts":1674757605633,"senderName":"Justin Ridgewell","senderId":"@jridgewell:matrix.org","id":"$n71tW6rGJzZ4wbE8nTuAN94-HbPg7diT64yYsnN6uL4"},
{"content":{"msgtype":"m.text","body":"We could call it `doRun` or something short","format":"org.matrix.custom.html","formatted_body":"We could call it <code>doRun</code> or something short","m.relates_to":{"event_id":"$3G_aX1utupK2064qeQwq6UJJ3KC4Wd4EuJDqdhMdReA","is_falling_back":true,"m.in_reply_to":{"event_id":"$n71tW6rGJzZ4wbE8nTuAN94-HbPg7diT64yYsnN6uL4"},"rel_type":"m.thread"}},"ts":1674757624733,"senderName":"Justin Ridgewell","senderId":"@jridgewell:matrix.org","id":"$aZ9dDZBAPZFlPhaxxTbv0Q5jpXtRxKtw8Xxpu-rsifE"},
{"content":{"msgtype":"m.text","body":"> the subset is intended to be minimally compatible with the model being defined here in order to prevent incompatibilties down the road\n\nI think we're going to have an issue with `EventEmitter`/`EventTarget`","format":"org.matrix.custom.html","formatted_body":"<blockquote>\n<p>the subset is intended to be minimally compatible with the model being defined here in order to prevent incompatibilties down the road</p>\n</blockquote>\n<p>I think we're going to have an issue with <code>EventEmitter</code>/<code>EventTarget</code></p>\n"},"ts":1674757712675,"senderName":"Justin Ridgewell","senderId":"@jridgewell:matrix.org","id":"$cMmfo7184LgHNYNAykQekyCadgz0j5-9tcy2xbTnVMo"},
{"content":{"msgtype":"m.text","body":"My expectation on the web side is that `addEventListener` will act as an async resource and capture the current frame to be used when the event is emitted","format":"org.matrix.custom.html","formatted_body":"My expectation on the web side is that <code>addEventListener</code> will act as an async resource and capture the current frame to be used when the event is emitted"},"ts":1674757754409,"senderName":"Justin Ridgewell","senderId":"@jridgewell:matrix.org","id":"$pgeXU17qvWn-rwIOQxrOfTiO1z7pDrB1Ezk8wc73IIU"},
{"content":{"msgtype":"m.text","body":"I've had this pop up in other conversations also. I'm fine if we do that but it does introduce an incompatibility with Node.js, which does not currently propagate the context for either of these"},"ts":1674758196887,"senderName":"James M Snell","senderId":"@jasnell:matrix.org","id":"$5YSEptvfWtsiEA4bCuzAfiwp041baER03TACoEiZye4"},
{"content":{"msgtype":"m.text","body":"We have greater flexibility/authority to define the behavior for `EventTarget` here than `EventEmitter`, which is a node.js defined API","format":"org.matrix.custom.html","formatted_body":"We have greater flexibility/authority to define the behavior for <code>EventTarget</code> here than <code>EventEmitter</code>, which is a node.js defined API"},"ts":1674758245388,"senderName":"James M Snell","senderId":"@jasnell:matrix.org","id":"$4G7ozyO9cR5I9eMi_WtuXbY1EaqRNayMicBLYGInGjo"},
{"content":{"msgtype":"m.text","body":"but we can definitely raise this. one concern I know will come up with `EventEmitter` is that with the current async_hooks based design, there's going to be a performance hit","format":"org.matrix.custom.html","formatted_body":"but we can definitely raise this. one concern I know will come up with <code>EventEmitter</code> is that with the current async_hooks based design, there's going to be a performance hit"},"ts":1674758285549,"senderName":"James M Snell","senderId":"@jasnell:matrix.org","id":"$Z22J2ZT7-SFFqZu0m60D-2nuQ9p3fETflrY9cA3ajO0"},
{"content":{"msgtype":"m.text","body":"but that's an implementation specific concern"},"ts":1674758294206,"senderName":"James M Snell","senderId":"@jasnell:matrix.org","id":"$RQZBO8ud7_15qqkOEdpAMC-MX7RAgzBx-1CW_Du2TK4"},
{"content":{"msgtype":"m.text","body":"can I ask you to comment in the PR on this?"},"ts":1674758315470,"senderName":"James M Snell","senderId":"@jasnell:matrix.org","id":"$DF-MYKtpj7_WZsXhh3oT5rzbTj7pQBPwDyU2s5TM1zw"},
{"content":{"msgtype":"m.text","body":"> <@jridgewell:matrix.org> My expectation on the web side is that `addEventListener` will act as an async resource and capture the current frame to be used when the event is emitted\n\nThis doesn't match my expectation. I think Andreu Botella is investigating this sort of issue.","format":"org.matrix.custom.html","formatted_body":"<mx-reply><blockquote><a href=\"https://matrix.to/#/!siOjSOrhCVYVzIoThy:matrix.org/$pgeXU17qvWn-rwIOQxrOfTiO1z7pDrB1Ezk8wc73IIU?via=matrix.org&via=igalia.com\">In reply to</a> <a href=\"https://matrix.to/#/@jridgewell:matrix.org\">@jridgewell:matrix.org</a><br>My expectation on the web side is that <code>addEventListener</code> will act as an async resource and capture the current frame to be used when the event is emitted</blockquote></mx-reply>This doesn't match my expectation. I think <a href=\"https://matrix.to/#/@abotella:igalia.com\">Andreu Botella</a> is investigating this sort of issue.","m.relates_to":{"m.in_reply_to":{"event_id":"$pgeXU17qvWn-rwIOQxrOfTiO1z7pDrB1Ezk8wc73IIU"}}},"ts":1674758348996,"senderName":"littledan","senderId":"@littledan:matrix.org","id":"$VDhfgEmaKDNabfVobNMixugzH7cSkZwmCkDAUZfuf2g"},
{"content":{"msgtype":"m.text","body":"I think addEventListener will *sometimes* act like this, and sometimes not","format":"org.matrix.custom.html","formatted_body":"I think addEventListener will <em>sometimes</em> act like this, and sometimes not"},"ts":1674758366964,"senderName":"littledan","senderId":"@littledan:matrix.org","id":"$BN1Pq0AA2ai6DXT5Q4f67nDJJuEBuujo2-H-VYZvCdw"},
{"content":{"org.matrix.msc1767.text":"investigating that is on my TODO list","body":"investigating that is on my TODO list","msgtype":"m.text"},"ts":1674758393919,"senderName":"Andreu Botella","senderId":"@abotella:igalia.com","id":"$wlV26BhrlRjiVUX6IuESWx6I2s7ex8y92rGE-2GPG3M"},
{"content":{"msgtype":"m.text","body":"anyway I don't think solving this problem should block Deno and Cloudflare from shipping their AsyncLocalStorage subset"},"ts":1674758472331,"senderName":"littledan","senderId":"@littledan:matrix.org","id":"$xha366zcp3Li-RVtO8dgaaI9gmk4-dwqlI9v4JZYzZ0"},
{"content":{"msgtype":"m.text","body":"Sadly this one is pretty complicated. there are three distinct modes:\n\n1. Capture the context on EventTarget/EventEmitter creation (extends AsyncResource style, ala Node.js `EventEmitterAsyncResource`)\n2. Capture the context on addEventListener/on (e.g. AsyncResource.bind() / wrap())\n3. Use the current context when dispatchEvent/emit is called.","format":"org.matrix.custom.html","formatted_body":"<p>Sadly this one is pretty complicated. there are three distinct modes:</p>\n<ol>\n<li>Capture the context on EventTarget/EventEmitter creation (extends AsyncResource style, ala Node.js <code>EventEmitterAsyncResource</code>)</li>\n<li>Capture the context on addEventListener/on (e.g. AsyncResource.bind() / wrap())</li>\n<li>Use the current context when dispatchEvent/emit is called.</li>\n</ol>\n"},"ts":1674758481095,"senderName":"James M Snell","senderId":"@jasnell:matrix.org","id":"$fGJ4Bu4nNVZcAC30rwuTr89VDnQbUnCBfBGVV60srcQ"},
{"content":{"msgtype":"m.text","body":"The subset as currently described allows all three, with 3 being the default. Making either of the other two the default makes 3 more difficult (or even impossible?)"},"ts":1674758552971,"senderName":"James M Snell","senderId":"@jasnell:matrix.org","id":"$xhhO8HoJOxjiG9kvaEcChENe1aAQt_FyVaGFhZW7j6E"},
{"content":{"msgtype":"m.text","body":"Mostly I think this because I think they, like everyone who has shipped this feature, will have a long stream of bug reports about expectations being subtly broken and they will iterate a bit over time","m.relates_to":{"event_id":"$xha366zcp3Li-RVtO8dgaaI9gmk4-dwqlI9v4JZYzZ0","is_falling_back":true,"m.in_reply_to":{"event_id":"$xha366zcp3Li-RVtO8dgaaI9gmk4-dwqlI9v4JZYzZ0"},"rel_type":"m.thread"}},"ts":1674758560202,"senderName":"littledan","senderId":"@littledan:matrix.org","id":"$QySSJP1oO8eip1bly6BUd1ygHBwPj8S8Sm6HK6QKq80"},
{"content":{"body":"Ben Newman (Apollo, @benjamn on GH): do you want to submit your thenable patch to V8?","format":"org.matrix.custom.html","msgtype":"m.text","formatted_body":"<a href=\"https://matrix.to/#/@benjamn:matrix.org\">Ben Newman (Apollo, @benjamn on GH)</a>: do you want to submit your thenable patch to V8?"},"ts":1674775513977,"senderName":"Justin Ridgewell","senderId":"@jridgewell:matrix.org","id":"$iUriTX56agReBz5pNAU-eByYCKDj2piwgOmre425Pyw"}
]
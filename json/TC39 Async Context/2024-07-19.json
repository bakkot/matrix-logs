[
{"content":{"body":"I wonder if `dispatchSnapshot` as a property of events would be clear to developers who have no clue what AsyncContext even is or what it's meant for","format":"org.matrix.custom.html","formatted_body":"I wonder if <code>dispatchSnapshot</code> as a property of events would be clear to developers who have no clue what AsyncContext even is or what it's meant for","m.mentions":{},"msgtype":"m.text"},"ts":1721387451362,"senderName":"Andreu Botella","senderId":"@abotella:igalia.com","id":"$YQ1__HFK1QhN1_Z2t3MjlLakmCsiXCd6HUwhrSv6Fsk"},
{"content":{"body":"well, I guess we don't need it to be clear, we just need them not to use it","m.mentions":{},"msgtype":"m.text"},"ts":1721387461788,"senderName":"Andreu Botella","senderId":"@abotella:igalia.com","id":"$muI7jz-fWTrQe2MspCw-gAj0BnMXFluHVgYlBihhBiU"},
{"content":{"body":" * well, I guess we don't need it to be clear, we just need them not to use it by mistake","m.mentions":{},"m.new_content":{"body":"well, I guess we don't need it to be clear, we just need them not to use it by mistake","m.mentions":{},"msgtype":"m.text"},"m.relates_to":{"event_id":"$muI7jz-fWTrQe2MspCw-gAj0BnMXFluHVgYlBihhBiU","rel_type":"m.replace"},"msgtype":"m.text"},"ts":1721387504797,"senderName":"Andreu Botella","senderId":"@abotella:igalia.com","id":"$qVa3iTnAye6OS58_Z909FZLPB4MMw6ng6EZnu9oP1g4"},
{"content":{"body":"An important thing is that it’s \ngoogleable","format":"org.matrix.custom.html","formatted_body":"An important thing is that it’s<br />\ngoogleable","msgtype":"m.text"},"ts":1721393181335,"senderName":"littledan","senderId":"@littledan:matrix.org","id":"$EPF49so59s1Nvhv0aOI5u4-dvOj7U8NbRTlEWH6Pe54"},
{"content":{"body":"We could be very explicit and say causalAsyncContextSnapshot. Too long?","msgtype":"m.text"},"ts":1721393237000,"senderName":"littledan","senderId":"@littledan:matrix.org","id":"$W6rMd5nrgKWl29gnkCAIQdHRgnWDGcIsQSLQfIvzjek"},
{"content":{"body":"Anyway, all of these options should be googleable/searchable in mdn so this name search doesn’t have a big downside risk ","format":"org.matrix.custom.html","formatted_body":"Anyway, all of these options should be googleable/searchable in mdn so this name search doesn’t have a big downside risk","msgtype":"m.text"},"ts":1721393954728,"senderName":"littledan","senderId":"@littledan:matrix.org","id":"$H5m9bsBo-uDmOICh3IWqk0TvswqZb9ZyDaz4wCLjHB4"},
{"content":{"body":"I think it is ok to have a single property name to be generic but specifically searchable with its holder's name","m.mentions":{},"msgtype":"m.text"},"ts":1721394291366,"senderName":"Chengzhong Wu","senderId":"@legendecas:matrix.org","id":"$zyQqgPzoNhOLUzgMeBhaAPLTYNXo7BSq_GLqZwv72bc"},
{"content":{"body":"It might be acceptable, but will be not as convenient for some people","msgtype":"m.text"},"ts":1721394380755,"senderName":"littledan","senderId":"@littledan:matrix.org","id":"$FBGCH0WLAKrL4ljgCDiCW6X_5Yt0MzZqsjBfbB7MVH4"},
{"content":{"body":"Especially here, this will come up on a lot of autocompletes and people will be trying to figure out what it is","msgtype":"m.text"},"ts":1721394429872,"senderName":"littledan","senderId":"@littledan:matrix.org","id":"$zS-n7kPuffWK_OTywlqwsTkS3_PxmJin36hJ9XCrFHg"},
{"content":{"body":"Hey, we're discussing whether any of you have use cases for having the dispatch snapshot on user-created events","m.mentions":{},"msgtype":"m.text"},"ts":1721411394174,"senderName":"Andreu Botella","senderId":"@abotella:igalia.com","id":"$DRzMjKfNQoLsZrzfXE9gx85s7iNCN_zrFWNIpmPFRhQ"},
{"content":{"body":"So 1) should it be there at all, and 2) if so, should the default behavior would be to take the snapshot, or to have it as null","m.mentions":{},"msgtype":"m.text"},"ts":1721411491785,"senderName":"Andreu Botella","senderId":"@abotella:igalia.com","id":"$vxWujTeEaT7CWNk99Eb1Big0R49E7YDwT7VSXRfxntQ"},
{"content":{"body":"One use case is polyfills, but the property could be added with `Object.defineProperty`","format":"org.matrix.custom.html","formatted_body":"One use case is polyfills, but the property could be added with <code>Object.defineProperty</code>","m.mentions":{},"msgtype":"m.text"},"ts":1721411522485,"senderName":"Andreu Botella","senderId":"@abotella:igalia.com","id":"$VloSId4fhwNSBH7_8Jq7srlEg7t5kchH2F8yeWO9Fig"},
{"content":{"body":"For user-created events, could you define `class SnapshottingEvent extends Event { dispatchSnapshot = new AsyncContextSnapshot(); }` and then just dispatch that?","format":"org.matrix.custom.html","formatted_body":"For user-created events, could you define <code>class SnapshottingEvent extends Event { dispatchSnapshot = new AsyncContextSnapshot(); }</code> and then just dispatch that?","m.mentions":{},"msgtype":"m.text"},"ts":1721411563157,"senderName":"Steve Hicks","senderId":"@stephenhicks:matrix.org","id":"$RLDnGrxZAvWg-edOTxnU3gt-qUMSCV-TdYx8kagRJuM"},
{"content":{"body":"yeah","m.mentions":{},"msgtype":"m.text"},"ts":1721411617506,"senderName":"Andreu Botella","senderId":"@abotella:igalia.com","id":"$f2Nfr6DTpwjrtwN8bySD6R4xJ-0EpxgJjtTmLOZzUaU"},
{"content":{"body":"so I guess the discussion is rather, are there use cases for having the `dispatchSnapshot` property populated by default?","format":"org.matrix.custom.html","formatted_body":"so I guess the discussion is rather, are there use cases for having the <code>dispatchSnapshot</code> property populated by default?","m.mentions":{},"msgtype":"m.text"},"ts":1721411642447,"senderName":"Andreu Botella","senderId":"@abotella:igalia.com","id":"$JO8ZFoF-GrHb2mpEqUXh_N7U53XYprD-pjSCgcad_GQ"},
{"content":{"body":"So then the question is whether the dispatching code should need to be concerned about it","m.mentions":{},"msgtype":"m.text"},"ts":1721411647166,"senderName":"Steve Hicks","senderId":"@stephenhicks:matrix.org","id":"$KTmAmsaDcK1Tv_LR_5Uw5fHRHaBhkNDm-CIulZ-21gs"},
{"content":{"body":"I don't have a good sense here...  putting it on the Event constructor wouldn't be exactly accurate w.r.t. being the _dispatch_ snapshot, if event objects are shared or preallocated.  To really be accurate, you'd want `dispatchEvent` to populate it, but then what does that function use to decide whether to populate it or not...?","format":"org.matrix.custom.html","formatted_body":"I don't have a good sense here...  putting it on the Event constructor wouldn't be exactly accurate w.r.t. being the <em>dispatch</em> snapshot, if event objects are shared or preallocated.  To really be accurate, you'd want <code>dispatchEvent</code> to populate it, but then what does that function use to decide whether to populate it or not...?","m.mentions":{},"msgtype":"m.text"},"ts":1721411871416,"senderName":"Steve Hicks","senderId":"@stephenhicks:matrix.org","id":"$7PftdPKmmrOvCh8KoKG7BR2ADawIGHc4F_YdaJ9MB-0"},
{"content":{"body":"usually the creation and dispatch times is the same, and even for web platform events the spec text I'm proposing would set it when the event is created (not sure if that is ever not the same as when it's dispatched)","m.mentions":{},"msgtype":"m.text"},"ts":1721412095747,"senderName":"Andreu Botella","senderId":"@abotella:igalia.com","id":"$wq-S8Z0gtM9vm0bBNabbT_yN-XVNHYjY4MNhTWSb5gQ"},
{"content":{"body":"so I guess technically `dispatchSnapshot` wouldn't be an accurate name","format":"org.matrix.custom.html","formatted_body":"so I guess technically <code>dispatchSnapshot</code> wouldn't be an accurate name","m.mentions":{},"msgtype":"m.text"},"ts":1721412110414,"senderName":"Andreu Botella","senderId":"@abotella:igalia.com","id":"$673NAxmkPwyeBGZKm2fKhShVSlkrKAwiNQOZTp2nUAs"},
{"content":{"body":" * usually the creation and dispatch times is the same, and even for web platform events the spec text I'm proposing would set it when the event is created (not sure if that difference would be observable)","m.mentions":{},"m.new_content":{"body":"usually the creation and dispatch times is the same, and even for web platform events the spec text I'm proposing would set it when the event is created (not sure if that difference would be observable)","m.mentions":{},"msgtype":"m.text"},"m.relates_to":{"event_id":"$wq-S8Z0gtM9vm0bBNabbT_yN-XVNHYjY4MNhTWSb5gQ","rel_type":"m.replace"},"msgtype":"m.text"},"ts":1721412135188,"senderName":"Andreu Botella","senderId":"@abotella:igalia.com","id":"$jDPbfTSGH1fXoLbnv_-ZJMj8DE0a3rxZNICRN-7B10U"},
{"content":{"body":" * usually the creation and dispatch times is the same, and even for web platform events the spec text I'm proposing would set it when the event is created (not sure if that difference would be observable for any event)","m.mentions":{},"m.new_content":{"body":"usually the creation and dispatch times is the same, and even for web platform events the spec text I'm proposing would set it when the event is created (not sure if that difference would be observable for any event)","m.mentions":{},"msgtype":"m.text"},"m.relates_to":{"event_id":"$wq-S8Z0gtM9vm0bBNabbT_yN-XVNHYjY4MNhTWSb5gQ","rel_type":"m.replace"},"msgtype":"m.text"},"ts":1721412144477,"senderName":"Andreu Botella","senderId":"@abotella:igalia.com","id":"$_kfaMDT0DYgdKfZwdnpVeYY_-AgPHUe2UkFHMNLSJkM"},
{"content":{"body":"event creation time seems very reasonable","m.mentions":{},"msgtype":"m.text"},"ts":1721412302574,"senderName":"Steve Hicks","senderId":"@stephenhicks:matrix.org","id":"$vFKBYZsBRSuSDcaIlmSvX72eY1EZGhsx4twPmqdBB3g"},
{"content":{"body":"what's the reasoning to not put a snapshot on _every_ event?","format":"org.matrix.custom.html","formatted_body":"what's the reasoning to not put a snapshot on <em>every</em> event?","m.mentions":{},"msgtype":"m.text"},"ts":1721412318548,"senderName":"Steve Hicks","senderId":"@stephenhicks:matrix.org","id":"$mtvGsgnbIp7l1yW60GfLisCNd6VXlFYM4cvNTVsCYH8"},
{"content":{"body":"well, we don't want to use the registration-time snapshot--the we are back to Zalgo fallback logic","m.mentions":{},"msgtype":"m.text"},"ts":1721412351376,"senderName":"littledan","senderId":"@littledan:matrix.org","id":"$HjIe11_6ZJFZS50fjooVLTUvGSp1hSSpC4Vashfc-oc"},
{"content":{"body":"(if we care about that)","m.mentions":{},"msgtype":"m.text"},"ts":1721412355390,"senderName":"littledan","senderId":"@littledan:matrix.org","id":"$j5dbRJezlGAqAKnX1n6UJt95iRCvMINeNUussyDDPK0"},
{"content":{"body":"many events only have one relevant snapshot, and that's the registration-time one","m.mentions":{},"msgtype":"m.text"},"ts":1721412366883,"senderName":"littledan","senderId":"@littledan:matrix.org","id":"$zSKBP6bJc6atX2tblHehNQyw0By1c-5WcSzU68HMEBk"},
{"content":{"body":"sure, but for those the dispatchSnapshot (name tbd) would just be empty","m.mentions":{},"msgtype":"m.text"},"ts":1721412392882,"senderName":"Steve Hicks","senderId":"@stephenhicks:matrix.org","id":"$9LbJbF1Xv7LWfMqLq1eu53vof9KxF0S-C8vaT9AxE5s"},
{"content":{"body":"that was another point that Andreu and I were chatting about: should the property be missing, or filled in with null? Andreu convinced me the latter is better","m.mentions":{},"msgtype":"m.text"},"ts":1721412423390,"senderName":"littledan","senderId":"@littledan:matrix.org","id":"$Gw97kda-JlxlC-3G5mQvq7MDu7qTREydUKAlDSIPwTE"},
{"content":{"body":"it's more consistent to say, it's an attribute of Event","m.mentions":{},"msgtype":"m.text"},"ts":1721412436590,"senderName":"littledan","senderId":"@littledan:matrix.org","id":"$mn-kzQxxq9p59h-qmZgArmtcnwaL4eeerD1kMFcTP3s"},
{"content":{"body":"or filled in with the top-level snapshot?","m.mentions":{},"msgtype":"m.text"},"ts":1721412443519,"senderName":"Steve Hicks","senderId":"@stephenhicks:matrix.org","id":"$gAo9autqPyMGcdgYTvaWT_ZgZZLTRxaVMz1L4TuNdrE"},
{"content":{"body":"> <@stephenhicks:matrix.org> what's the reasoning to not put a snapshot on _every_ event?\n\nsome events would require quite some complexity around various specs to find the right one","format":"org.matrix.custom.html","formatted_body":"<mx-reply><blockquote><a href=\"https://matrix.to/#/!eQuZUAhGqudVFPodUG:matrix.org/$mtvGsgnbIp7l1yW60GfLisCNd6VXlFYM4cvNTVsCYH8?via=igalia.com&via=matrix.org&via=mozilla.org\">In reply to</a> <a href=\"https://matrix.to/#/@stephenhicks:matrix.org\">@stephenhicks:matrix.org</a><br>what's the reasoning to not put a snapshot on <em>every</em> event?</blockquote></mx-reply>some events would require quite some complexity around various specs to find the right one","m.mentions":{"user_ids":["@stephenhicks:matrix.org"]},"m.relates_to":{"m.in_reply_to":{"event_id":"$mtvGsgnbIp7l1yW60GfLisCNd6VXlFYM4cvNTVsCYH8"}},"msgtype":"m.text"},"ts":1721412452871,"senderName":"littledan","senderId":"@littledan:matrix.org","id":"$Kurp1z0MNCZ-KYRIyXeET4arna5XG5XS20BxSRsXGE4"},
{"content":{"body":"what we don't want to do is *change* the logic defining the snapshot *later*","format":"org.matrix.custom.html","formatted_body":"what we don't want to do is <em>change</em> the logic defining the snapshot <em>later</em>","m.mentions":{},"msgtype":"m.text"},"ts":1721412467043,"senderName":"littledan","senderId":"@littledan:matrix.org","id":"$mW09lwrkcZslPmS_aPHvQ5d9s7O9hPeCtWYt9ca_PNU"},
{"content":{"body":"> <@stephenhicks:matrix.org> or filled in with the top-level snapshot?\n\nwhy would this be useful?","format":"org.matrix.custom.html","formatted_body":"<mx-reply><blockquote><a href=\"https://matrix.to/#/!eQuZUAhGqudVFPodUG:matrix.org/$gAo9autqPyMGcdgYTvaWT_ZgZZLTRxaVMz1L4TuNdrE?via=igalia.com&via=matrix.org&via=mozilla.org\">In reply to</a> <a href=\"https://matrix.to/#/@stephenhicks:matrix.org\">@stephenhicks:matrix.org</a><br>or filled in with the top-level snapshot?</blockquote></mx-reply>why would this be useful?","m.mentions":{"user_ids":["@stephenhicks:matrix.org"]},"m.relates_to":{"m.in_reply_to":{"event_id":"$gAo9autqPyMGcdgYTvaWT_ZgZZLTRxaVMz1L4TuNdrE"}},"msgtype":"m.text"},"ts":1721412475905,"senderName":"littledan","senderId":"@littledan:matrix.org","id":"$CpDBMdUTGN0-ejaS0Wn5aT3zDL7R1KXRsGNsdtYieaI"},
{"content":{"body":"I thought we wanted to let people know whether there was a more interesting causal snapshot","m.mentions":{},"msgtype":"m.text"},"ts":1721412492453,"senderName":"littledan","senderId":"@littledan:matrix.org","id":"$ttkGjmExEnzwMZnTaRwlprrBGWa9sYrvuBeEEvlBrTk"},
{"content":{"body":" * I thought we wanted to let people know *whether* there was a more interesting causal snapshot","format":"org.matrix.custom.html","formatted_body":" * I thought we wanted to let people know <em>whether</em> there was a more interesting causal snapshot","m.mentions":{},"m.new_content":{"body":"I thought we wanted to let people know *whether* there was a more interesting causal snapshot","format":"org.matrix.custom.html","formatted_body":"I thought we wanted to let people know <em>whether</em> there was a more interesting causal snapshot","m.mentions":{},"msgtype":"m.text"},"m.relates_to":{"event_id":"$ttkGjmExEnzwMZnTaRwlprrBGWa9sYrvuBeEEvlBrTk","rel_type":"m.replace"},"msgtype":"m.text"},"ts":1721412500151,"senderName":"littledan","senderId":"@littledan:matrix.org","id":"$xbxkB42aYGkOXzHc6FL_2ALLnTmoVXufCgIRWcMHhFo"},
{"content":{"body":"> <@littledan:matrix.org> some events would require quite some complexity around various specs to find the right one\n\nI don't imagine doing any searching here - for consistency this property is just the snapshot when the event is created.  If there's another snapshot that's more relevant, it would need a different property","format":"org.matrix.custom.html","formatted_body":"<mx-reply><blockquote><a href=\"https://matrix.to/#/!eQuZUAhGqudVFPodUG:matrix.org/$Kurp1z0MNCZ-KYRIyXeET4arna5XG5XS20BxSRsXGE4?via=igalia.com&via=matrix.org&via=mozilla.org\">In reply to</a> <a href=\"https://matrix.to/#/@littledan:matrix.org\">@littledan:matrix.org</a><br>some events would require quite some complexity around various specs to find the right one</blockquote></mx-reply>I don't imagine doing any searching here - for consistency this property is just the snapshot when the event is created.  If there's another snapshot that's more relevant, it would need a different property","m.mentions":{"user_ids":["@littledan:matrix.org"]},"m.relates_to":{"m.in_reply_to":{"event_id":"$Kurp1z0MNCZ-KYRIyXeET4arna5XG5XS20BxSRsXGE4"}},"msgtype":"m.text"},"ts":1721412539436,"senderName":"Steve Hicks","senderId":"@stephenhicks:matrix.org","id":"$sSImmCscI9BzAk0J3tIi0HW9_HeKRbf3awqNa3ur2Fs"},
{"content":{"body":"As APMs tend to view what we are patching somewhat generically, it'd be in _our_ interest for the snapshot to _always_ be there regardless of origin.","format":"org.matrix.custom.html","formatted_body":"As APMs tend to view what we are patching somewhat generically, it'd be in <em>our</em> interest for the snapshot to <em>always</em> be there regardless of origin.","m.mentions":{},"msgtype":"m.text"},"ts":1721412568625,"senderName":"Stephen Belanger","senderId":"@stephenbelanger:matrix.org","id":"$G-HPaRjbthIMK9M4d8u9d6sclJnJyLtcIV_L3Myd6Tg"},
{"content":{"body":"> <@stephenhicks:matrix.org> I don't imagine doing any searching here - for consistency this property is just the snapshot when the event is created.  If there's another snapshot that's more relevant, it would need a different property\n\nthe issue is that for spec-internal async algorithms, there would be a lot of internal tracking that would need to be done","format":"org.matrix.custom.html","formatted_body":"<mx-reply><blockquote><a href=\"https://matrix.to/#/!eQuZUAhGqudVFPodUG:matrix.org/$sSImmCscI9BzAk0J3tIi0HW9_HeKRbf3awqNa3ur2Fs?via=igalia.com&via=matrix.org&via=mozilla.org\">In reply to</a> <a href=\"https://matrix.to/#/@stephenhicks:matrix.org\">@stephenhicks:matrix.org</a><br>I don't imagine doing any searching here - for consistency this property is just the snapshot when the event is created.  If there's another snapshot that's more relevant, it would need a different property</blockquote></mx-reply>the issue is that for spec-internal async algorithms, there would be a lot of internal tracking that would need to be done","m.mentions":{"user_ids":["@stephenhicks:matrix.org","@littledan:matrix.org"]},"m.relates_to":{"m.in_reply_to":{"event_id":"$sSImmCscI9BzAk0J3tIi0HW9_HeKRbf3awqNa3ur2Fs"}},"msgtype":"m.text"},"ts":1721412575827,"senderName":"Andreu Botella","senderId":"@abotella:igalia.com","id":"$GRNstXwtQyAqq3pUIgjrC0bSYDWS7auf18sVMUFwNE0"},
{"content":{"body":"and that's not trivial","m.mentions":{},"msgtype":"m.text"},"ts":1721412586385,"senderName":"Andreu Botella","senderId":"@abotella:igalia.com","id":"$VsNQ0GOZkNTatHw9n4ODCUOPlVNuokGGMSEKSpBjESg"},
{"content":{"body":"there's always a snapshot used when running the event handler, there's just not always an *additional* causal snapshot presented","format":"org.matrix.custom.html","formatted_body":"there's always a snapshot used when running the event handler, there's just not always an <em>additional</em> causal snapshot presented","m.mentions":{},"msgtype":"m.text"},"ts":1721412602969,"senderName":"littledan","senderId":"@littledan:matrix.org","id":"$isaAcHrlkUQbj864UuB-nlGHn3SMPufvrgxDltpqUH4"},
{"content":{"body":"the idea is to handle that for a subset of use cases in the initial rollout","m.mentions":{},"msgtype":"m.text"},"ts":1721412603738,"senderName":"Andreu Botella","senderId":"@abotella:igalia.com","id":"$3puDpHzCp3SFhuSmTTMKpS-kllZYVByNt4tiEyHai-Y"},
{"content":{"body":"and then incrementally increase that set","m.mentions":{},"msgtype":"m.text"},"ts":1721412609086,"senderName":"Andreu Botella","senderId":"@abotella:igalia.com","id":"$rD0-xjJktFuL1K4xFg5V-kkuiqkOFsoHcTkVKHOItsU"}
]
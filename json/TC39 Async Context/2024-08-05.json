[
{"content":{"body":"littledan: in the node impl its `super(AsyncContextFrame.current())` and in the deno impl its `{...previousContextMapping}`. There's no efficient copy-on-write structure available in js like there is in native code","format":"org.matrix.custom.html","formatted_body":"<a href=\"https://matrix.to/#/@littledan:matrix.org\">littledan</a>: in the node impl its <code>super(AsyncContextFrame.current())</code> and in the deno impl its <code>{...previousContextMapping}</code>. There's no efficient copy-on-write structure available in js like there is in native code","m.mentions":{"user_ids":["@littledan:matrix.org"]},"msgtype":"m.text"},"ts":1722862052243,"senderName":"snek","senderId":"@devsnek:matrix.org","id":"$Vj8mch7yyv_CjUS7HMl0PlzaPbU0EIHbyQ2hQSNyunw"},
{"content":{"body":"> <@devsnek:matrix.org> littledan: in the node impl its `super(AsyncContextFrame.current())` and in the deno impl its `{...previousContextMapping}`. There's no efficient copy-on-write structure available in js like there is in native code\n\nit should be possible to implement a HAMT in JS, shouldn't it? (hash based on an incrementing number that each Variable has)","format":"org.matrix.custom.html","formatted_body":"<mx-reply><blockquote><a href=\"https://matrix.to/#/!eQuZUAhGqudVFPodUG:matrix.org/$Vj8mch7yyv_CjUS7HMl0PlzaPbU0EIHbyQ2hQSNyunw?via=igalia.com&via=matrix.org&via=mozilla.org\">In reply to</a> <a href=\"https://matrix.to/#/@devsnek:matrix.org\">@devsnek:matrix.org</a><br><a href=\"https://matrix.to/#/@littledan:matrix.org\">littledan</a>: in the node impl its <code>super(AsyncContextFrame.current())</code> and in the deno impl its <code>{...previousContextMapping}</code>. There's no efficient copy-on-write structure available in js like there is in native code</blockquote></mx-reply>it should be possible to implement a HAMT in JS, shouldn't it? (hash based on an incrementing number that each Variable has)","m.mentions":{"user_ids":["@devsnek:matrix.org"]},"m.relates_to":{"m.in_reply_to":{"event_id":"$Vj8mch7yyv_CjUS7HMl0PlzaPbU0EIHbyQ2hQSNyunw"}},"msgtype":"m.text"},"ts":1722866434576,"senderName":"littledan","senderId":"@littledan:matrix.org","id":"$i0L4kv0oeqlE8C5Xr1wTsH94DvO5-its7xs2VGXjMjA"},
{"content":{"body":"or, equally, the simple linked list model (good enough sometimes--all web frameworks do this)","m.mentions":{},"msgtype":"m.text"},"ts":1722866457671,"senderName":"littledan","senderId":"@littledan:matrix.org","id":"$el746Lh-c1kA1DeRtYSQLWmrpNkSTNUpzG-p7pgrQ7U"},
{"content":{"body":"A linked list of contexts is what I was going for originally, but it makes things uncollectable even if theyâ€™ve been replaced in the store because they are held further up in the linked list. Needed to do the map clone approach for reasonable memory characteristics.","msgtype":"m.text"},"ts":1722872108026,"senderName":"Stephen Belanger","senderId":"@stephenbelanger:matrix.org","id":"$e-1I8DpkmR5k2ctbMjGxYRlDd5Wn0sxQX1KV-o2H-y4"},
{"content":{"body":"you can use a HAMT for this (the engine doesn't have special powers that JS doesn't have)","m.mentions":{},"msgtype":"m.text"},"ts":1722872133212,"senderName":"littledan","senderId":"@littledan:matrix.org","id":"$Th5yUmgXZDkUI873Ng-A7fLw0jTgaa8D243QGZ_jFf8"},
{"content":{"body":"https://en.wikipedia.org/wiki/Hash_array_mapped_trie","m.mentions":{},"msgtype":"m.text"},"ts":1722872144339,"senderName":"littledan","senderId":"@littledan:matrix.org","id":"$j-xBbcH-KWBEiBMBc2fjXzDxVTEtfsXmWImL54xNADU"},
{"content":{"body":"in particular a \"persistent\" one","m.mentions":{},"msgtype":"m.text"},"ts":1722872169083,"senderName":"littledan","senderId":"@littledan:matrix.org","id":"$xFEZh4r8TokN55PgxZMCz6QAoZOLu-fjyddjiSzrlAI"},
{"content":{"body":"I think engines would *not* implement this with a linked list plus magical GC","format":"org.matrix.custom.html","formatted_body":"I think engines would <em>not</em> implement this with a linked list plus magical GC","m.mentions":{},"msgtype":"m.text"},"ts":1722872181567,"senderName":"littledan","senderId":"@littledan:matrix.org","id":"$oLPMBjoaLJQGBmr4GEJuM2_T1rU1cO3jKpuXHfogBAA"}
]
[
{"content":{"body":"Monkey-patching for postMessage the way it's used as a scheduler would be something like this:\n```js\nclass MessageChannel extends globalThis.MessageChannel {\n  constructor(...args) {\n    super(...args);\n    this.port1.__channel = this;\n    this.port2.__channel = this;\n    patch(this.port1);\n    patch(this.port2);\n  }\n}\n```\nwhere `patch` wraps `onmessage`/`addEventListener` to get a registration-time snapshot, or as an alternative to store the `.postMessage`-time snapshot on this.__channel and run the event callback in it.","format":"org.matrix.custom.html","formatted_body":"<p>Monkey-patching for postMessage the way it's used as a scheduler would be something like this:</p>\n<pre><code class=\"language-js\">class MessageChannel extends globalThis.MessageChannel {\n  constructor(...args) {\n    super(...args);\n    this.port1.__channel = this;\n    this.port2.__channel = this;\n    patch(this.port1);\n    patch(this.port2);\n  }\n}\n</code></pre>\n<p>where <code>patch</code> wraps <code>onmessage</code>/<code>addEventListener</code> to get a registration-time snapshot, or as an alternative to store the <code>.postMessage</code>-time snapshot on this.__channel and run the event callback in it.</p>\n","m.mentions":{},"msgtype":"m.text"},"ts":1748431412021,"senderName":"nicolo-ribaudo","senderId":"@nicolo-ribaudo:matrix.org","id":"$I4L86KJe5ZFRNhN2_nWbSLNCCn0IO6kc8TZT-0KufB8"},
{"content":{"body":"(I think that this is bad code, but it's _possible_)","format":"org.matrix.custom.html","formatted_body":"(I think that this is bad code, but it's <em>possible</em>)","m.mentions":{},"msgtype":"m.text"},"ts":1748431433556,"senderName":"nicolo-ribaudo","senderId":"@nicolo-ribaudo:matrix.org","id":"$B7tHSvG_XowgOCtYmM8R3KuLV8IFr0DfPqWrAceKYJM"},
{"content":{"body":"And if the code patching is the same as the code needing the patch, it can just call `.wrap` instead (e.g. for React)","format":"org.matrix.custom.html","formatted_body":"And if the code patching is the same as the code needing the patch, it can just call <code>.wrap</code> instead (e.g. for React)","m.mentions":{},"msgtype":"m.text"},"ts":1748431470075,"senderName":"nicolo-ribaudo","senderId":"@nicolo-ribaudo:matrix.org","id":"$EmRXtSCfURSgVdFU6PgRKZxsG5TmNNfKzNBaUamllcs"},
{"content":{"body":"for MessageChannel, yes, but there's postMessage on window as well","m.mentions":{},"msgtype":"m.text"},"ts":1748434162954,"senderName":"Andreu Botella","senderId":"@abotella:igalia.com","id":"$ST8p93-T6A0rE9JcMbHYeXpB_3zobHZ-bLlMFsAl5Rc"},
{"content":{"body":"Hey folks-- great presentation today.  Thanks for the invite.","m.mentions":{},"msgtype":"m.text"},"ts":1748434606573,"senderName":"Michal Mocny","senderId":"@mmocny:matrix.org","id":"$8VoA8TS4QMIR206Oekc7E3YjZ9DVtqeciUBZa57CZRA"},
{"content":{"body":"thank you for attending and providing your use cases!","m.mentions":{},"msgtype":"m.text"},"ts":1748434646165,"senderName":"Andreu Botella","senderId":"@abotella:igalia.com","id":"$LSgyGqMCcjaq-e_ZgJdJYI-rdbOJFuqqij4d7PQT6TQ"},
{"content":{"body":"Well I didn't provide use cases today but I was prepared to :P Seems we didn't need more support in the room, though","m.mentions":{},"msgtype":"m.text"},"ts":1748434671595,"senderName":"Michal Mocny","senderId":"@mmocny:matrix.org","id":"$LOLzPScdgtASOD1tbAbp_DYFn44Nflx4d8qVgfoYV4E"},
{"content":{"body":"right ðŸ˜…","m.mentions":{},"msgtype":"m.text"},"ts":1748434723024,"senderName":"Andreu Botella","senderId":"@abotella:igalia.com","id":"$RHtqiOjYbR3rVN6VmwO1775rVQ38wFQZzQevUCuT5Gs"},
{"content":{"body":"I'm not too cogent after these long discussions","m.mentions":{},"msgtype":"m.text"},"ts":1748434736035,"senderName":"Andreu Botella","senderId":"@abotella:igalia.com","id":"$SDhFJmbbLvv17UU592-t1HZZANcwsrEZiyk0ZE98_3o"}
]
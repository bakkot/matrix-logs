[
{"content":{"body":"Monkey-patching for postMessage the way it's used as a scheduler would be something like this:\n```js\nclass MessageChannel extends globalThis.MessageChannel {\n  constructor(...args) {\n    super(...args);\n    this.port1.__channel = this;\n    this.port2.__channel = this;\n    patch(this.port1);\n    patch(this.port2);\n  }\n}\n```\nwhere `patch` wraps `onmessage`/`addEventListener` to get a registration-time snapshot, or as an alternative to store the `.postMessage`-time snapshot on this.__channel and run the event callback in it.","format":"org.matrix.custom.html","formatted_body":"<p>Monkey-patching for postMessage the way it's used as a scheduler would be something like this:</p>\n<pre><code class=\"language-js\">class MessageChannel extends globalThis.MessageChannel {\n  constructor(...args) {\n    super(...args);\n    this.port1.__channel = this;\n    this.port2.__channel = this;\n    patch(this.port1);\n    patch(this.port2);\n  }\n}\n</code></pre>\n<p>where <code>patch</code> wraps <code>onmessage</code>/<code>addEventListener</code> to get a registration-time snapshot, or as an alternative to store the <code>.postMessage</code>-time snapshot on this.__channel and run the event callback in it.</p>\n","m.mentions":{},"msgtype":"m.text"},"ts":1748431412021,"senderName":"nicolo-ribaudo","senderId":"@nicolo-ribaudo:matrix.org","id":"$I4L86KJe5ZFRNhN2_nWbSLNCCn0IO6kc8TZT-0KufB8"},
{"content":{"body":"(I think that this is bad code, but it's _possible_)","format":"org.matrix.custom.html","formatted_body":"(I think that this is bad code, but it's <em>possible</em>)","m.mentions":{},"msgtype":"m.text"},"ts":1748431433556,"senderName":"nicolo-ribaudo","senderId":"@nicolo-ribaudo:matrix.org","id":"$B7tHSvG_XowgOCtYmM8R3KuLV8IFr0DfPqWrAceKYJM"},
{"content":{"body":"And if the code patching is the same as the code needing the patch, it can just call `.wrap` instead (e.g. for React)","format":"org.matrix.custom.html","formatted_body":"And if the code patching is the same as the code needing the patch, it can just call <code>.wrap</code> instead (e.g. for React)","m.mentions":{},"msgtype":"m.text"},"ts":1748431470075,"senderName":"nicolo-ribaudo","senderId":"@nicolo-ribaudo:matrix.org","id":"$EmRXtSCfURSgVdFU6PgRKZxsG5TmNNfKzNBaUamllcs"}
]
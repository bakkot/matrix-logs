[
{"content":{"body":"We have spec text! https://tc39.es/proposal-async-context/","msgtype":"m.text"},"ts":1678299635419,"senderName":"Justin Ridgewell","senderId":"@jridgewell:matrix.org","id":"$ldw5q4dhUsXisUoGrGKzhL2-QcABzQtIIK8zBuS9gkc"},
{"content":{"body":"I think the only surprising change is the addition of `[[Construct]]` on wrapped callbacks:\n```\nconst Foo = AsyncContext.wrap(class Foo {});\n\n// The wrapper will invoke construct on the wrapped function\nnew Foo();\n```\n","format":"org.matrix.custom.html","formatted_body":"<p>I think the only surprising change is the addition of <code>[[Construct]]</code> on wrapped callbacks:</p>\n<pre><code>const Foo = AsyncContext.wrap(class Foo {});\n\n// The wrapper will invoke construct on the wrapped function\nnew Foo();\n</code></pre>\n","msgtype":"m.text"},"ts":1678299715814,"senderName":"Justin Ridgewell","senderId":"@jridgewell:matrix.org","id":"$ieFDLyNizOvqfQ7n7tMl8Xh8wiecgD-tSK9SFWgLT-0"},
{"content":{"body":"This comes from the behavior of `Function.p.bind`","format":"org.matrix.custom.html","formatted_body":"This comes from the behavior of <code>Function.p.bind</code>","msgtype":"m.text"},"ts":1678299735862,"senderName":"Justin Ridgewell","senderId":"@jridgewell:matrix.org","id":"$JHOfJOWXryvv554tYvxBpNvXdDJvHdoLZBr_gWqBPfo"},
{"content":{"body":"yeah I am OK with including or omitting the [[Construct]] behavior","msgtype":"m.text"},"ts":1678307131724,"senderName":"littledan","senderId":"@littledan:matrix.org","id":"$NtsRN4wShe4cNvEYKAgoHYxkFPWQzbqsp_qbjxmZm-E"},
{"content":{"body":"the spec would probably be clearer if we could use whatwg infra algorithms","msgtype":"m.text"},"ts":1678308138394,"senderName":"littledan","senderId":"@littledan:matrix.org","id":"$krmqTVRle2_KyRT7CPyGsivUsJohwIyIFNyu7RtdCeU"},
{"content":{"body":"(for the mapping)","msgtype":"m.text"},"ts":1678308148516,"senderName":"littledan","senderId":"@littledan:matrix.org","id":"$BAEsCJhkureS2TeQAqpBx7-c4KsrDL7GcdnDwPgAJ_0"},
{"content":{"body":"we should probably think about exposing reusable algorithms (for web specs) for get and run, but this is an editorial thing","msgtype":"m.text"},"ts":1678308219074,"senderName":"littledan","senderId":"@littledan:matrix.org","id":"$2O3QMlwni6RM-SNeUQD2S5ejkKq5kVIEBf6d58haE9A"},
{"content":{"body":"it might be nicer editorially if we avoided SameValueZero; SameValue or simply = is enough. (But the nicest would be to say that it's a mapping...)","msgtype":"m.text"},"ts":1678308248692,"senderName":"littledan","senderId":"@littledan:matrix.org","id":"$lQhZIWYwsPcmGE6IUDL2SZDCjNL0mFD6tXVI7y16zKY"},
{"content":{"body":"anyway I don't see any bugs in the spec; looks good for Stage 2 to me","msgtype":"m.text"},"ts":1678308271584,"senderName":"littledan","senderId":"@littledan:matrix.org","id":"$lCpJnKu4Nm5I1s6EgdvJ9UnnEaftRJ1xrlG1XPoX8hI"},
{"content":{"body":"IIRC the `setTimeout` infrastructure in HTML jumps off-thread to sleep, and then queues a task on the event loop","format":"org.matrix.custom.html","formatted_body":"IIRC the <code>setTimeout</code> infrastructure in HTML jumps off-thread to sleep, and then queues a task on the event loop","msgtype":"m.text"},"ts":1678308491181,"senderName":"Andreu Botella","senderId":"@abotella:igalia.com","id":"$lUUQQqJFMJY5pU8h5O3BSQjixkJOeUhHkDxhAUfXvzo"},
{"content":{"body":"a wrapped `setTimeout` would have to \"send\" a snapshot off-thread","format":"org.matrix.custom.html","formatted_body":"a wrapped <code>setTimeout</code> would have to &quot;send&quot; a snapshot off-thread","msgtype":"m.text"},"ts":1678308511000,"senderName":"Andreu Botella","senderId":"@abotella:igalia.com","id":"$yO0jcDcncXEDsmXMr_nUJpN27LYNV0Jp-xtPEVLeOFk"},
{"content":{"body":"is that fine, as long as the values are not read?","msgtype":"m.text"},"ts":1678308516678,"senderName":"Andreu Botella","senderId":"@abotella:igalia.com","id":"$UJgaVyfkrmC5IwgYgWVpN7QzfL4UpsefVxt8xIEJnYc"},
{"content":{"body":"I'm not sure if it should be phrased like that","msgtype":"m.text"},"ts":1678308545180,"senderName":"littledan","senderId":"@littledan:matrix.org","id":"$Wu9iwF2jDXUSD4XOtbGmKDW0SA5_yHyU_KqnWXLnttA"},
{"content":{"body":"I hope that you can work with ms2ger and Yoav on a proposed wording here","msgtype":"m.text"},"ts":1678308563828,"senderName":"littledan","senderId":"@littledan:matrix.org","id":"$VW60e2QXlLHRYYOVmFMxCChd-6Dbw72pvMYlKcmKBV4"},
{"content":{"body":"I think queued tasks would often carry asynccontext snapshots with them, but that snapshot shouldn't ever logically leave the main thread","msgtype":"m.text"},"ts":1678308601165,"senderName":"littledan","senderId":"@littledan:matrix.org","id":"$H54Uc7hTwo3_lkW53RauKhX3JLiJSlKyH8az5DBVjn8"},
{"content":{"body":" * a `setTimeout` that wraps the callback would have to \"send\" a snapshot off-thread","format":"org.matrix.custom.html","formatted_body":" * a <code>setTimeout</code> that wraps the callback would have to &quot;send&quot; a snapshot off-thread","m.new_content":{"body":"a `setTimeout` that wraps the callback would have to \"send\" a snapshot off-thread","format":"org.matrix.custom.html","formatted_body":"a <code>setTimeout</code> that wraps the callback would have to &quot;send&quot; a snapshot off-thread","msgtype":"m.text"},"m.relates_to":{"event_id":"$yO0jcDcncXEDsmXMr_nUJpN27LYNV0Jp-xtPEVLeOFk","rel_type":"m.replace"},"msgtype":"m.text"},"ts":1678308635272,"senderName":"Andreu Botella","senderId":"@abotella:igalia.com","id":"$5eEcfvrKih--ce0VtkbZGCK1sfnOGNnJ4q1yUjwYdzU"},
{"content":{"body":"in any case, you'll want to have clean abstract algorithms for creating an AsyncContext, and get and run, so that the embedding spec doesn't need to call the actual JS functions","msgtype":"m.text"},"ts":1678308664549,"senderName":"littledan","senderId":"@littledan:matrix.org","id":"$kb7MURY0zbVgyBSLmLbk8r8JVL--7e5kMtsJPnVZp8c"}
]
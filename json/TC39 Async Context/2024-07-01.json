[
{"content":{"body":"I was thinking that the unhandled rejection context here is `\"foo\"`, not `\"baz\"`:\n```js\nasyncVar.run(\"foo\", main);\n\nasync function main() {\n\tawait asyncVar.run(\"bar\", async () => {\n\t\tawait asyncVar.run(\"baz\", async () => {\n\t\t\tthrow new Error();\n\t\t});\n\t});\n}\n```","format":"org.matrix.custom.html","formatted_body":"<p>I was thinking that the unhandled rejection context here is <code>\"foo\"</code>, not <code>\"baz\"</code>:</p>\n<pre><code class=\"language-js\">asyncVar.run(\"foo\", main);\n\nasync function main() {\n\tawait asyncVar.run(\"bar\", async () =&gt; {\n\t\tawait asyncVar.run(\"baz\", async () =&gt; {\n\t\t\tthrow new Error();\n\t\t});\n\t});\n}\n</code></pre>\n","m.mentions":{},"msgtype":"m.text"},"ts":1719839472632,"senderName":"Andreu Botella","senderId":"@abotella:igalia.com","id":"$-U5pW_mwO2UMMP1Vk6MyBngnvYdRIqW2mImf9P0EW7c"},
{"content":{"body":"so shouldn't it be the same for sync errors?","m.mentions":{},"msgtype":"m.text"},"ts":1719839485492,"senderName":"Andreu Botella","senderId":"@abotella:igalia.com","id":"$YgrG3oIZyR2lNxI06x1Y3mp4fX58uz_zhgq0hl3Qz3s"},
{"content":{"body":" * so shouldn't it be the same for sync unhandled errors?","m.mentions":{},"m.new_content":{"body":"so shouldn't it be the same for sync unhandled errors?","m.mentions":{},"msgtype":"m.text"},"m.relates_to":{"event_id":"$YgrG3oIZyR2lNxI06x1Y3mp4fX58uz_zhgq0hl3Qz3s","rel_type":"m.replace"},"msgtype":"m.text"},"ts":1719839490581,"senderName":"Andreu Botella","senderId":"@abotella:igalia.com","id":"$1ZWcRD_ilkZoYR-RBTETe7ukTcR5vDtONh6-GvvRW3E"},
{"content":{"body":"I don't understand what you're getting at; the async/await case is different since it corresponds to a bunch of nested try/catch/rethrow patterns.","m.mentions":{},"msgtype":"m.text"},"ts":1719840540985,"senderName":"littledan","senderId":"@littledan:matrix.org","id":"$G5EfVaC1XLBqkfF1xcEY57jWqk6UAxR6VmxS69ih66s"},
{"content":{"body":"will that be obvious to developers?","m.mentions":{},"msgtype":"m.text"},"ts":1719840651055,"senderName":"Andreu Botella","senderId":"@abotella:igalia.com","id":"$A-tM9nLg68ht3keXy_TgZBYfN6n-CvrmKUNjbXWoXAI"},
{"content":{"body":"no, developers will expect that the inner place where the error inside the async/await is the source. But making it \"also broken\" for sync exceptions won't fix that expectation.","m.mentions":{},"msgtype":"m.text"},"ts":1719840688305,"senderName":"littledan","senderId":"@littledan:matrix.org","id":"$9_hZm9hYUv-elAjPwbUicdkIJ356i6F0hBkXDu8kkyQ"},
{"content":{"body":"Are we talking about the callback's context or the one that's hung on the `unhandledrejection`/`error` event?  If the former, I'm arguing it should always be registration context.  Would it be possible for `event.errorSnapshot` to be `\"baz\"` even for the `unhandledrejection` case?","format":"org.matrix.custom.html","formatted_body":"Are we talking about the callback's context or the one that's hung on the <code>unhandledrejection</code>/<code>error</code> event?  If the former, I'm arguing it should always be registration context.  Would it be possible for <code>event.errorSnapshot</code> to be <code>\"baz\"</code> even for the <code>unhandledrejection</code> case?","m.mentions":{},"msgtype":"m.text"},"ts":1719865775348,"senderName":"Steve Hicks","senderId":"@stephenhicks:matrix.org","id":"$2OWEowMx-8HWEnglQ3kmWP8w9KEJbdsvxEJpA6jRwfE"},
{"content":{"body":"I've come around to the view that one of the advantages of heterogeneous access to causal contexts (which I was arguing against a few weeks ago) is that you can target more clearly exactly which context you get.","m.mentions":{},"msgtype":"m.text"},"ts":1719865957245,"senderName":"Steve Hicks","senderId":"@stephenhicks:matrix.org","id":"$t9UhJw6pQiSM9yWg0HP3Iajd6kQyXU6oEN7pdHhMhMQ"},
{"content":{"body":"I think we're talking about the supplemental context that exists as a property","m.mentions":{},"msgtype":"m.text"},"ts":1719865958071,"senderName":"littledan","senderId":"@littledan:matrix.org","id":"$DvQRW4TtK7MlealaPRSZkSfz_4P-0IOuWyqwhWevUek"},
{"content":{"body":"even for that there's a lot of decisions to make!","m.mentions":{},"msgtype":"m.text"},"ts":1719865977470,"senderName":"littledan","senderId":"@littledan:matrix.org","id":"$s5KQo0O-o48rNfdy2drqtgbV9yk3OXl_mVrFkVq5WN8"},
{"content":{"body":"yes there are","m.mentions":{},"msgtype":"m.text"},"ts":1719865987685,"senderName":"Steve Hicks","senderId":"@stephenhicks:matrix.org","id":"$YJHzGCOegfAZV7BNQhdhiPzda5lOAh8sCVRjzgAwdGQ"},
{"content":{"body":"we *could* expose a whole bunch of them, but IMO one of them will probably be good enough to start, and people won't really be so great at choosing between a bunch of them anyway","format":"org.matrix.custom.html","formatted_body":"we <em>could</em> expose a whole bunch of them, but IMO one of them will probably be good enough to start, and people won't really be so great at choosing between a bunch of them anyway","m.mentions":{},"msgtype":"m.text"},"ts":1719866010695,"senderName":"littledan","senderId":"@littledan:matrix.org","id":"$ttFlFLPd468lxnF9v-3YMRkRPs6pmYEaaF6u7gvPHSc"},
{"content":{"body":"so i guess i'm asking, is there a reasonable way to spec it so that the unhandled rejection is _also_ baz?","format":"org.matrix.custom.html","formatted_body":"so i guess i'm asking, is there a reasonable way to spec it so that the unhandled rejection is <em>also</em> baz?","m.mentions":{},"msgtype":"m.text"},"ts":1719866030641,"senderName":"Steve Hicks","senderId":"@stephenhicks:matrix.org","id":"$1BIILQ2bISYygUlkWazcKmzh-zxv1HRAv64xm8Nhs-Y"},
{"content":{"body":"right, I don't think we should expose a ton","m.mentions":{},"msgtype":"m.text"},"ts":1719866045267,"senderName":"Steve Hicks","senderId":"@stephenhicks:matrix.org","id":"$wNai7g_H3AwpeiaZJVhbUMZ0UIJI5PcE7v1axkJxlu0"},
{"content":{"body":"> <@stephenhicks:matrix.org> so i guess i'm asking, is there a reasonable way to spec it so that the unhandled rejection is _also_ baz?\n\nI have a huge amount of trouble understanding how that'd work. BUT we could make it so that error objects have a causal context when they're allocated or thrown for the first time, and maybe that'd solve most of the problem.","format":"org.matrix.custom.html","formatted_body":"<mx-reply><blockquote><a href=\"https://matrix.to/#/!eQuZUAhGqudVFPodUG:matrix.org/$1BIILQ2bISYygUlkWazcKmzh-zxv1HRAv64xm8Nhs-Y?via=igalia.com&via=matrix.org&via=mozilla.org\">In reply to</a> <a href=\"https://matrix.to/#/@stephenhicks:matrix.org\">@stephenhicks:matrix.org</a><br>so i guess i'm asking, is there a reasonable way to spec it so that the unhandled rejection is <em>also</em> baz?</blockquote></mx-reply>I have a huge amount of trouble understanding how that'd work. BUT we could make it so that error objects have a causal context when they're allocated or thrown for the first time, and maybe that'd solve most of the problem.","m.mentions":{"user_ids":["@stephenhicks:matrix.org"]},"m.relates_to":{"m.in_reply_to":{"event_id":"$1BIILQ2bISYygUlkWazcKmzh-zxv1HRAv64xm8Nhs-Y"}},"msgtype":"m.text"},"ts":1719866087900,"senderName":"littledan","senderId":"@littledan:matrix.org","id":"$rH8zFjj0DEn8kjePMivm3hIF7BLyfojBXZhaJKvpmZ0"},
{"content":{"body":"IMO error construction should capture a context snapshot and you can read out of that later by accessing some property on that error.","msgtype":"m.text"},"ts":1719866100275,"senderName":"Stephen Belanger","senderId":"@stephenbelanger:matrix.org","id":"$9EWQl1WoHonoFQlkN1T2BkOPXWI--slGnPlar-UNZws"},
{"content":{"body":"jinx","m.mentions":{},"msgtype":"m.text"},"ts":1719866110582,"senderName":"littledan","senderId":"@littledan:matrix.org","id":"$0nIgbV6PbWJPMdFR1igK08IHIFaZG4fE9Y42wATWXmA"},
{"content":{"body":"Yeah.","msgtype":"m.text"},"ts":1719866125876,"senderName":"Stephen Belanger","senderId":"@stephenbelanger:matrix.org","id":"$B-vQ3eV1NyTIGq8e9kjTr7TV2N2OIujWGKIsJjYXc_M"},
{"content":{"body":"(I prefer allocated better than first thrown too)","m.mentions":{},"msgtype":"m.text"},"ts":1719866128026,"senderName":"littledan","senderId":"@littledan:matrix.org","id":"$mPfy5KAv8RV56gjVM6tfKw5ViE3AXNKnkQ5bn5uxpcU"},
{"content":{"body":"i think that's a good balance","m.mentions":{},"msgtype":"m.text"},"ts":1719866143444,"senderName":"Steve Hicks","senderId":"@stephenhicks:matrix.org","id":"$Wz4lNBpjeN-J_OwAsmbSbnWTUFmAhddr8wM2JfOWr8g"},
{"content":{"body":"First thrown is a bit mysterious but possibly more correct. You need extra logic to detect if it already HAS a context on a rethrow though.","msgtype":"m.text"},"ts":1719866176217,"senderName":"Stephen Belanger","senderId":"@stephenbelanger:matrix.org","id":"$Ysl3gQ9OrnZRniinzqkBAbuVy3vqHnDicHAijEreApk"},
{"content":{"body":"first thrown is sad-feeling because it means mutating an object. what if the same thing is thrown twice? anyway that is not very pragmatic knowledge, it's my theorist side talking","m.mentions":{},"msgtype":"m.text"},"ts":1719866212379,"senderName":"littledan","senderId":"@littledan:matrix.org","id":"$8fXXllBj8Vc_pr-tVinBY8t62rqFTDho2yuyBVE1vEA"},
{"content":{"body":" * first thrown is sad-feeling because it means mutating an object. what if the same thing is thrown twice? anyway that is not very pragmatic motivation, it's my theorist side talking","m.mentions":{},"m.new_content":{"body":"first thrown is sad-feeling because it means mutating an object. what if the same thing is thrown twice? anyway that is not very pragmatic motivation, it's my theorist side talking","m.mentions":{},"msgtype":"m.text"},"m.relates_to":{"event_id":"$8fXXllBj8Vc_pr-tVinBY8t62rqFTDho2yuyBVE1vEA","rel_type":"m.replace"},"msgtype":"m.text"},"ts":1719866220970,"senderName":"littledan","senderId":"@littledan:matrix.org","id":"$Bx3U0WFHq5nJPQikNsN5J1tyx7felMwlea9gc7OGIJA"},
{"content":{"body":"Yeah. Almost makes more sense to not be attached to the Error object, but then where would you put it?","msgtype":"m.text"},"ts":1719866269990,"senderName":"Stephen Belanger","senderId":"@stephenbelanger:matrix.org","id":"$mEH1lX-C5cEZQlI3JP75z1OPa7tr0ERCRxD9MkDvjjk"},
{"content":{"body":"but we might still need a causative context for unhandled rejections in case they aren't error objects","m.mentions":{},"msgtype":"m.text"},"ts":1719866270577,"senderName":"littledan","senderId":"@littledan:matrix.org","id":"$gkP3bz4FnJSSfcEeiO3pQ1bER_9rqASF6tKNSH4mjH0"},
{"content":{"body":"True.","msgtype":"m.text"},"ts":1719866284627,"senderName":"Stephen Belanger","senderId":"@stephenbelanger:matrix.org","id":"$3llWkZMiuor2QgeLSnq0Q2xHxNzvp0NjpPO8M6bC2AY"},
{"content":{"body":"> <@stephenbelanger:matrix.org> Yeah. Almost makes more sense to not be attached to the Error object, but then where would you put it?\n\nit could be on the event (but still, requires extra machinery in implementations)","format":"org.matrix.custom.html","formatted_body":"<mx-reply><blockquote><a href=\"https://matrix.to/#/!eQuZUAhGqudVFPodUG:matrix.org/$mEH1lX-C5cEZQlI3JP75z1OPa7tr0ERCRxD9MkDvjjk?via=igalia.com&via=matrix.org&via=mozilla.org\">In reply to</a> <a href=\"https://matrix.to/#/@stephenbelanger:matrix.org\">@stephenbelanger:matrix.org</a><br>Yeah. Almost makes more sense to not be attached to the Error object, but then where would you put it?</blockquote></mx-reply>it could be on the event (but still, requires extra machinery in implementations)","m.mentions":{"user_ids":["@stephenbelanger:matrix.org"]},"m.relates_to":{"m.in_reply_to":{"event_id":"$mEH1lX-C5cEZQlI3JP75z1OPa7tr0ERCRxD9MkDvjjk"}},"msgtype":"m.text"},"ts":1719866289280,"senderName":"littledan","senderId":"@littledan:matrix.org","id":"$-_olYFL9rI88KMnZSvZgjI4g1oJCTLP2gHiTX2Z8nyw"},
{"content":{"body":"For unhandledRejection we probably _would_ need the point it throws and not an Error property given you _can_ throw non-errors and unfortunately sometimes people do. 😐","format":"org.matrix.custom.html","formatted_body":"For unhandledRejection we probably <em>would</em> need the point it throws and not an Error property given you <em>can</em> throw non-errors and unfortunately sometimes people do. 😐","msgtype":"m.text"},"ts":1719866329832,"senderName":"Stephen Belanger","senderId":"@stephenbelanger:matrix.org","id":"$MJI8En3XpH4mX4oXowdFcPEJeUNXudeX0bJnljtRgJ4"},
{"content":{"body":"unhandledrejection isn't dispatched synchronously, so it's a little more awkward","m.mentions":{},"msgtype":"m.text"},"ts":1719866343264,"senderName":"Steve Hicks","senderId":"@stephenhicks:matrix.org","id":"$nfAGQL-k-IjsfM8B-0tIUw62rEnT8Rl6CJGeklQbFcU"},
{"content":{"body":"ideally it could reuse the same mechanism for synchronous events (i.e. dispatchEvent captures the snapshot)","m.mentions":{},"msgtype":"m.text"},"ts":1719866369808,"senderName":"Steve Hicks","senderId":"@stephenhicks:matrix.org","id":"$98hMcXsLFnTbJutbKMwwrWesdfwr0ClTSFwPASGGu-Q"},
{"content":{"body":"as we've previously reasoned, we could either store the context when the Promise is allocated (as in Node) or rejected (as in the current spec). I guess in either case, it could be in the Promise itself, and then it's only read by the unhandled rejection thing.","m.mentions":{},"msgtype":"m.text"},"ts":1719866422246,"senderName":"littledan","senderId":"@littledan:matrix.org","id":"$xXlbvuJHcNqx0DxZLpCzEewfcbbtmWaMKuL5azWID7U"},
{"content":{"body":"Capturing on dispatchEvent also means we could have _anything_ be able to access both register time _and_ call time contexts. 🤔","format":"org.matrix.custom.html","formatted_body":"Capturing on dispatchEvent also means we could have <em>anything</em> be able to access both register time <em>and</em> call time contexts. 🤔","msgtype":"m.text"},"ts":1719866476861,"senderName":"Stephen Belanger","senderId":"@stephenbelanger:matrix.org","id":"$iLgi1LA4FjP7YtdqMs2Im_1gEXKoDWGcrIXdYLZF-wk"},
{"content":{"body":"I previously convinced myself that the rejected-time context is definitely way better, but now, with distance, I could see that either could be OK...","m.mentions":{},"msgtype":"m.text"},"ts":1719866480821,"senderName":"littledan","senderId":"@littledan:matrix.org","id":"$mQ9ZN-yVzGLwy6SYs-mZ8473ewaa_uaaN6eTBtYZ-Mg"},
{"content":{"body":"> <@stephenbelanger:matrix.org> Capturing on dispatchEvent also means we could have _anything_ be able to access both register time _and_ call time contexts. 🤔\n\nlots of stuff isn't dispatchEvent...","format":"org.matrix.custom.html","formatted_body":"<mx-reply><blockquote><a href=\"https://matrix.to/#/!eQuZUAhGqudVFPodUG:matrix.org/$iLgi1LA4FjP7YtdqMs2Im_1gEXKoDWGcrIXdYLZF-wk?via=igalia.com&via=matrix.org&via=mozilla.org\">In reply to</a> <a href=\"https://matrix.to/#/@stephenbelanger:matrix.org\">@stephenbelanger:matrix.org</a><br>Capturing on dispatchEvent also means we could have <em>anything</em> be able to access both register time <em>and</em> call time contexts. 🤔</blockquote></mx-reply>lots of stuff isn't dispatchEvent...","m.mentions":{"user_ids":["@stephenbelanger:matrix.org"]},"m.relates_to":{"m.in_reply_to":{"event_id":"$iLgi1LA4FjP7YtdqMs2Im_1gEXKoDWGcrIXdYLZF-wk"}},"msgtype":"m.text"},"ts":1719866498037,"senderName":"littledan","senderId":"@littledan:matrix.org","id":"$ghMEEa5Trv5FCQfK8Py12Kb9epI0QOjfpplszkOIhCk"},
{"content":{"body":"unless you mean the internal equivalent","m.mentions":{},"msgtype":"m.text"},"ts":1719866504945,"senderName":"littledan","senderId":"@littledan:matrix.org","id":"$w2fpJmSTGAsYcQ5MZXIWKqkOWQ7HPykk-YGfKjWBRtg"},
{"content":{"body":"Yes, internal equivalent.","msgtype":"m.text"},"ts":1719866515627,"senderName":"Stephen Belanger","senderId":"@stephenbelanger:matrix.org","id":"$ZPQKwahj8IMPqOGfeTKKd1_OjreaxkGgg2mc6bdHMKI"},
{"content":{"body":"reject-time means you're not making as many unused snapshots","m.mentions":{},"msgtype":"m.text"},"ts":1719866520217,"senderName":"Steve Hicks","senderId":"@stephenhicks:matrix.org","id":"$yjsDmufbKDsnNboQHMr6_kHp3eVHpsf1H-IdOEnDuS0"},
{"content":{"body":"> <@stephenbelanger:matrix.org> Yes, internal equivalent.\n\nyeah so conversations with DOM people like Anne seemed to point to, we'd only get this little by little, for particular things where it made sense, since it's complicated and depends on that particular API's details","format":"org.matrix.custom.html","formatted_body":"<mx-reply><blockquote><a href=\"https://matrix.to/#/!eQuZUAhGqudVFPodUG:matrix.org/$ZPQKwahj8IMPqOGfeTKKd1_OjreaxkGgg2mc6bdHMKI?via=igalia.com&via=matrix.org&via=mozilla.org\">In reply to</a> <a href=\"https://matrix.to/#/@stephenbelanger:matrix.org\">@stephenbelanger:matrix.org</a><br>Yes, internal equivalent.</blockquote></mx-reply>yeah so conversations with DOM people like Anne seemed to point to, we'd only get this little by little, for particular things where it made sense, since it's complicated and depends on that particular API's details","m.mentions":{"user_ids":["@stephenbelanger:matrix.org"]},"m.relates_to":{"m.in_reply_to":{"event_id":"$ZPQKwahj8IMPqOGfeTKKd1_OjreaxkGgg2mc6bdHMKI"}},"msgtype":"m.text"},"ts":1719866553598,"senderName":"littledan","senderId":"@littledan:matrix.org","id":"$WiAsxojoUrOE5MSFe9ExIGsGtpzmGd5bF77X1Wu55C8"},
{"content":{"body":"> <@stephenhicks:matrix.org> reject-time means you're not making as many unused snapshots\n\nbut \"making a snapshot\" is copying a pointer","format":"org.matrix.custom.html","formatted_body":"<mx-reply><blockquote><a href=\"https://matrix.to/#/!eQuZUAhGqudVFPodUG:matrix.org/$yjsDmufbKDsnNboQHMr6_kHp3eVHpsf1H-IdOEnDuS0?via=igalia.com&via=matrix.org&via=mozilla.org\">In reply to</a> <a href=\"https://matrix.to/#/@stephenhicks:matrix.org\">@stephenhicks:matrix.org</a><br>reject-time means you&#39;re not making as many unused snapshots</blockquote></mx-reply>but \"making a snapshot\" is copying a pointer","m.mentions":{"user_ids":["@stephenhicks:matrix.org"]},"m.relates_to":{"m.in_reply_to":{"event_id":"$yjsDmufbKDsnNboQHMr6_kHp3eVHpsf1H-IdOEnDuS0"}},"msgtype":"m.text"},"ts":1719866566476,"senderName":"littledan","senderId":"@littledan:matrix.org","id":"$vdlbGCQoAsaHWIpKRlbS_meBbOMeSvHPx-cMA8UV4p0"},
{"content":{"body":"we're *not* doing an allocation, in particular","format":"org.matrix.custom.html","formatted_body":"we're <em>not</em> doing an allocation, in particular","m.mentions":{},"msgtype":"m.text"},"ts":1719866582838,"senderName":"littledan","senderId":"@littledan:matrix.org","id":"$QQXJ2ry0ItVKaHf7-7FKN4rF-GAdwlF2OrG5QxEUjRY"},
{"content":{"body":"is there a concern about lifetime management?","m.mentions":{},"msgtype":"m.text"},"ts":1719866588714,"senderName":"Steve Hicks","senderId":"@stephenhicks:matrix.org","id":"$9jTFiBjKCvK6tRC2rj965hGWMQFw7srYl55VdtU48rs"},
{"content":{"body":"> <@stephenhicks:matrix.org> is there a concern about lifetime management?\n\nwell, IMO we should give a fresh object identity for the snapshot each time you use it, so we don't have to worry about that","format":"org.matrix.custom.html","formatted_body":"<mx-reply><blockquote><a href=\"https://matrix.to/#/!eQuZUAhGqudVFPodUG:matrix.org/$9jTFiBjKCvK6tRC2rj965hGWMQFw7srYl55VdtU48rs?via=igalia.com&via=matrix.org&via=mozilla.org\">In reply to</a> <a href=\"https://matrix.to/#/@stephenhicks:matrix.org\">@stephenhicks:matrix.org</a><br>is there a concern about lifetime management?</blockquote></mx-reply>well, IMO we should give a fresh object identity for the snapshot each time you use it, so we don't have to worry about that","m.mentions":{"user_ids":["@stephenhicks:matrix.org"]},"m.relates_to":{"m.in_reply_to":{"event_id":"$9jTFiBjKCvK6tRC2rj965hGWMQFw7srYl55VdtU48rs"}},"msgtype":"m.text"},"ts":1719866611951,"senderName":"littledan","senderId":"@littledan:matrix.org","id":"$L-MBkY0n-ieVJ9YHmjwBoMAU5Hx0FCBE3PAK9MNLSak"},
{"content":{"body":"via the getter","m.mentions":{},"msgtype":"m.text"},"ts":1719866627404,"senderName":"littledan","senderId":"@littledan:matrix.org","id":"$Z4wECMD9Pr3WzN9uH_y7vOtpFziPbF2w9wt9Q7-ptpA"},
{"content":{"body":"> <@littledan:matrix.org> yeah so conversations with DOM people like Anne seemed to point to, we'd only get this little by little, for particular things where it made sense, since it's complicated and depends on that particular API's details\n\nI mean…that’s possibly fine? We just need to make a bunch of individual cases for each API, which it seemed like Andreu was already doing the research work for?","format":"org.matrix.custom.html","formatted_body":"<mx-reply><blockquote><a href=\"https://matrix.to/#/!eQuZUAhGqudVFPodUG%3Amatrix.org/%24WiAsxojoUrOE5MSFe9ExIGsGtpzmGd5bF77X1Wu55C8\">In reply to</a> <a href=\"https://matrix.to/#/@littledan:matrix.org\">@littledan:matrix.org</a><br>yeah so conversations with DOM people like Anne seemed to point to, we'd only get this little by little, for particular things where it made sense, since it's complicated and depends on that particular API's details</blockquote></mx-reply>I mean…that’s possibly fine? We just need to make a bunch of individual cases for each API, which it seemed like Andreu was already doing the research work for?","m.relates_to":{"m.in_reply_to":{"event_id":"$WiAsxojoUrOE5MSFe9ExIGsGtpzmGd5bF77X1Wu55C8"}},"msgtype":"m.text"},"ts":1719866627976,"senderName":"Stephen Belanger","senderId":"@stephenbelanger:matrix.org","id":"$aCB3Q_0lTcM6FZS40BY6hz1YxUeZe8vH4jG0QaxBv10"},
{"content":{"body":"or maybe that's too weird and un-getter-like?","m.mentions":{},"msgtype":"m.text"},"ts":1719866637816,"senderName":"littledan","senderId":"@littledan:matrix.org","id":"$PY_E0ExhWbYZs1fuv_A1vXmVGHZq2bd-ismHZ9wAoCM"},
{"content":{"body":"the alternative is, you eagerly stash a pointer to the underlying data structure, but somehow you can dynamically type check that, and on first access, you replace it with a snapshot in place, and subsequent accesses notice that it's already a snapshot","m.mentions":{},"msgtype":"m.text"},"ts":1719866677878,"senderName":"littledan","senderId":"@littledan:matrix.org","id":"$g5MW34pCsbbODtfeGf-2NMdABUs2U_VIUMA_OeUd3PM"},
{"content":{"body":"> <@littledan:matrix.org> well, IMO we should give a fresh object identity for the snapshot each time you use it, so we don't have to worry about that\n\nNot sure we're talking about the same thing?  IIUC there was concern about when a snapshot was no longer reachable (hence all the explicit resource management discussions) and if we've got a never-will-be-used snapshot hanging on a long-lived promise, that could confuse it","format":"org.matrix.custom.html","formatted_body":"<mx-reply><blockquote><a href=\"https://matrix.to/#/!eQuZUAhGqudVFPodUG:matrix.org/$L-MBkY0n-ieVJ9YHmjwBoMAU5Hx0FCBE3PAK9MNLSak?via=igalia.com&via=matrix.org&via=mozilla.org\">In reply to</a> <a href=\"https://matrix.to/#/@littledan:matrix.org\">@littledan:matrix.org</a><br>well, IMO we should give a fresh object identity for the snapshot each time you use it, so we don't have to worry about that</blockquote></mx-reply>Not sure we're talking about the same thing?  IIUC there was concern about when a snapshot was no longer reachable (hence all the explicit resource management discussions) and if we've got a never-will-be-used snapshot hanging on a long-lived promise, that could confuse it","m.mentions":{"user_ids":["@littledan:matrix.org"]},"m.relates_to":{"m.in_reply_to":{"event_id":"$L-MBkY0n-ieVJ9YHmjwBoMAU5Hx0FCBE3PAK9MNLSak"}},"msgtype":"m.text"},"ts":1719866701687,"senderName":"Steve Hicks","senderId":"@stephenhicks:matrix.org","id":"$kMrqNyHhvPacSYOD-pCpMMcxaEoGcvc-UuYWsCUMdfI"},
{"content":{"body":"> <@stephenbelanger:matrix.org> I mean…that’s possibly fine? We just need to make a bunch of individual cases for each API, which it seemed like Andreu was already doing the research work for?\n\nyes, though there's still the question of, \"are we doing this now or 'later'\". IMO we should identify the cases where we believe it's needed *now* (e.g., some of this error stuff) and document why it's needed, and expect that the initially shipped version doesn't include so many of these","format":"org.matrix.custom.html","formatted_body":"<mx-reply><blockquote><a href=\"https://matrix.to/#/!eQuZUAhGqudVFPodUG:matrix.org/$aCB3Q_0lTcM6FZS40BY6hz1YxUeZe8vH4jG0QaxBv10?via=igalia.com&via=matrix.org&via=mozilla.org\">In reply to</a> <a href=\"https://matrix.to/#/@stephenbelanger:matrix.org\">@stephenbelanger:matrix.org</a><br>I mean…that’s possibly fine? We just need to make a bunch of individual cases for each API, which it seemed like Andreu was already doing the research work for?</blockquote></mx-reply>yes, though there's still the question of, \"are we doing this now or 'later'\". IMO we should identify the cases where we believe it's needed <em>now</em> (e.g., some of this error stuff) and document why it's needed, and expect that the initially shipped version doesn't include so many of these","m.mentions":{"user_ids":["@stephenbelanger:matrix.org"]},"m.relates_to":{"m.in_reply_to":{"event_id":"$aCB3Q_0lTcM6FZS40BY6hz1YxUeZe8vH4jG0QaxBv10"}},"msgtype":"m.text"},"ts":1719866750463,"senderName":"littledan","senderId":"@littledan:matrix.org","id":"$RFvsHedf1bjsGKlvsYxFOvvHAXFiKW-56rX61j1RUhw"},
{"content":{"body":"> <@stephenhicks:matrix.org> Not sure we're talking about the same thing?  IIUC there was concern about when a snapshot was no longer reachable (hence all the explicit resource management discussions) and if we've got a never-will-be-used snapshot hanging on a long-lived promise, that could confuse it\n\noh oops I was talking about a superficial object identity issue, totally separate. For lifetime.... yeah just leak?","format":"org.matrix.custom.html","formatted_body":"<mx-reply><blockquote><a href=\"https://matrix.to/#/!eQuZUAhGqudVFPodUG:matrix.org/$kMrqNyHhvPacSYOD-pCpMMcxaEoGcvc-UuYWsCUMdfI?via=igalia.com&via=matrix.org&via=mozilla.org\">In reply to</a> <a href=\"https://matrix.to/#/@stephenhicks:matrix.org\">@stephenhicks:matrix.org</a><br>Not sure we're talking about the same thing?  IIUC there was concern about when a snapshot was no longer reachable (hence all the explicit resource management discussions) and if we've got a never-will-be-used snapshot hanging on a long-lived promise, that could confuse it</blockquote></mx-reply>oh oops I was talking about a superficial object identity issue, totally separate. For lifetime.... yeah just leak?","m.mentions":{"user_ids":["@stephenhicks:matrix.org"]},"m.relates_to":{"m.in_reply_to":{"event_id":"$kMrqNyHhvPacSYOD-pCpMMcxaEoGcvc-UuYWsCUMdfI"}},"msgtype":"m.text"},"ts":1719866784810,"senderName":"littledan","senderId":"@littledan:matrix.org","id":"$SeFriIUNznxR2-9Eo49fi8ZpBq-MrHatSecFWKBnAws"},
{"content":{"body":"I don't see a solution to this lifetime question","m.mentions":{},"msgtype":"m.text"},"ts":1719866794680,"senderName":"littledan","senderId":"@littledan:matrix.org","id":"$HKYNwtXARywpkgu7Usi-wmVPI0gmEICM7SgmGVJRiOQ"},
{"content":{"body":"Selfishly, APM’s probably won’t care as we’re focused on servers where most of those APIs don’t exist anyway. 😅","msgtype":"m.text"},"ts":1719866815726,"senderName":"Stephen Belanger","senderId":"@stephenbelanger:matrix.org","id":"$yxYQl7eEWscqDigvuevcSA48e739ZxtoAAsUIKiEMJo"},
{"content":{"body":"well, some people care about client-side performance monitoring, but I take it that's not your team","m.mentions":{},"msgtype":"m.text"},"ts":1719866853257,"senderName":"littledan","senderId":"@littledan:matrix.org","id":"$ncMJqYo5FbcKdqy3Qbdxf2ycLtKm8Kb_BvCPL_qw1JM"},
{"content":{"body":"I guess the lifetime thing might be especially bad for something like Error objects, where it might be really non-obvious what you're keeping around","m.mentions":{},"msgtype":"m.text"},"ts":1719866877653,"senderName":"littledan","senderId":"@littledan:matrix.org","id":"$JVWnK1R5jE1-HL1H2fz5Q6bIgS1eEGJfRqaR5XJwZFE"},
{"content":{"body":"you could have HostPromiseRejectionHandler add/remove it?","m.mentions":{},"msgtype":"m.text"},"ts":1719866882726,"senderName":"Steve Hicks","senderId":"@stephenhicks:matrix.org","id":"$-IEuhyeRvKgh5qSSMzmf-F4CjvQHq71wKr8pGPRFL4I"},
{"content":{"body":"and you can imagine keeping errors around","m.mentions":{},"msgtype":"m.text"},"ts":1719866885848,"senderName":"littledan","senderId":"@littledan:matrix.org","id":"$OlLstHujIiWBRnX650z3UdJjB60TS5wjbgy2MiX2MoM"},
{"content":{"body":"> <@stephenhicks:matrix.org> you could have HostPromiseRejectionHandler add/remove it?\n\nit would modify the error?","format":"org.matrix.custom.html","formatted_body":"<mx-reply><blockquote><a href=\"https://matrix.to/#/!eQuZUAhGqudVFPodUG:matrix.org/$-IEuhyeRvKgh5qSSMzmf-F4CjvQHq71wKr8pGPRFL4I?via=igalia.com&via=matrix.org&via=mozilla.org\">In reply to</a> <a href=\"https://matrix.to/#/@stephenhicks:matrix.org\">@stephenhicks:matrix.org</a><br>you could have HostPromiseRejectionHandler add/remove it?</blockquote></mx-reply>it would modify the error?","m.mentions":{"user_ids":["@stephenhicks:matrix.org"]},"m.relates_to":{"m.in_reply_to":{"event_id":"$-IEuhyeRvKgh5qSSMzmf-F4CjvQHq71wKr8pGPRFL4I"}},"msgtype":"m.text"},"ts":1719866896820,"senderName":"littledan","senderId":"@littledan:matrix.org","id":"$aEllTqsbj5jLmYG08KXLK4a_Yf0NSTwAagKv8CwsvhI"},
{"content":{"body":"> <@littledan:matrix.org> well, some people care about client-side performance monitoring, but I take it that's not your team\n\nthis is our use case","format":"org.matrix.custom.html","formatted_body":"<mx-reply><blockquote><a href=\"https://matrix.to/#/!eQuZUAhGqudVFPodUG:matrix.org/$ncMJqYo5FbcKdqy3Qbdxf2ycLtKm8Kb_BvCPL_qw1JM?via=igalia.com&via=matrix.org&via=mozilla.org\">In reply to</a> <a href=\"https://matrix.to/#/@littledan:matrix.org\">@littledan:matrix.org</a><br>well, some people care about client-side performance monitoring, but I take it that&#39;s not your team</blockquote></mx-reply>this is our use case","m.mentions":{"user_ids":["@littledan:matrix.org"]},"m.relates_to":{"m.in_reply_to":{"event_id":"$ncMJqYo5FbcKdqy3Qbdxf2ycLtKm8Kb_BvCPL_qw1JM"}},"msgtype":"m.text"},"ts":1719866917602,"senderName":"Steve Hicks","senderId":"@stephenhicks:matrix.org","id":"$I1kMVYfQzGnE4LrdEy7C-XTNQvDE8DsYDobbgKPzq9A"},
{"content":{"body":"> <@littledan:matrix.org> it would modify the error?\n\nno, the promise","format":"org.matrix.custom.html","formatted_body":"<mx-reply><blockquote><a href=\"https://matrix.to/#/!eQuZUAhGqudVFPodUG:matrix.org/$aEllTqsbj5jLmYG08KXLK4a_Yf0NSTwAagKv8CwsvhI?via=igalia.com&via=matrix.org&via=mozilla.org\">In reply to</a> <a href=\"https://matrix.to/#/@littledan:matrix.org\">@littledan:matrix.org</a><br>it would modify the error?</blockquote></mx-reply>no, the promise","m.mentions":{"user_ids":["@littledan:matrix.org"]},"m.relates_to":{"m.in_reply_to":{"event_id":"$aEllTqsbj5jLmYG08KXLK4a_Yf0NSTwAagKv8CwsvhI"}},"msgtype":"m.text"},"ts":1719866960500,"senderName":"Steve Hicks","senderId":"@stephenhicks:matrix.org","id":"$sKpvPs5axdlvac6SK5QPWsAo39ZVFSvtCdSB8NiyY9U"},
{"content":{"body":"> <@stephenhicks:matrix.org> no, the promise\n\noh, right... yeah that makes sense, the unhandled rejection can only happen once. (In fact, maybe the spec doesn't even say any of this.) But this doesn't handle the error issue.","format":"org.matrix.custom.html","formatted_body":"<mx-reply><blockquote><a href=\"https://matrix.to/#/!eQuZUAhGqudVFPodUG:matrix.org/$sKpvPs5axdlvac6SK5QPWsAo39ZVFSvtCdSB8NiyY9U?via=igalia.com&via=matrix.org&via=mozilla.org\">In reply to</a> <a href=\"https://matrix.to/#/@stephenhicks:matrix.org\">@stephenhicks:matrix.org</a><br>no, the promise</blockquote></mx-reply>oh, right... yeah that makes sense, the unhandled rejection can only happen once. (In fact, maybe the spec doesn't even say any of this.) But this doesn't handle the error issue.","m.mentions":{"user_ids":["@stephenhicks:matrix.org"]},"m.relates_to":{"m.in_reply_to":{"event_id":"$sKpvPs5axdlvac6SK5QPWsAo39ZVFSvtCdSB8NiyY9U"}},"msgtype":"m.text"},"ts":1719867013722,"senderName":"littledan","senderId":"@littledan:matrix.org","id":"$4U1m6iI-q1lxgBScPzBZERFmQ6EvowjAl543HafG4IY"},
{"content":{"body":"> <@stephenbelanger:matrix.org> For unhandledRejection we probably _would_ need the point it throws and not an Error property given you _can_ throw non-errors and unfortunately sometimes people do. 😐\n\nI’d honestly be happy saying that’s an anti-pattern and you don’t get the correct context in this case.","format":"org.matrix.custom.html","formatted_body":"<mx-reply><blockquote><a href=\"https://matrix.to/#/!eQuZUAhGqudVFPodUG%3Amatrix.org/%24MJI8En3XpH4mX4oXowdFcPEJeUNXudeX0bJnljtRgJ4\">In reply to</a><a href=\"https://matrix.to/#/%40stephenbelanger%3Amatrix.org\">@stephenbelanger:matrix.org</a><br />For unhandledRejection we probably <em>would</em> need the point it throws and not an Error property given you <em>can</em> throw non-errors and unfortunately sometimes people do. 😐</blockquote></mx-reply>I’d honestly be happy saying that’s an anti-pattern and you don’t get the correct context in this case.","m.relates_to":{"m.in_reply_to":{"event_id":"$MJI8En3XpH4mX4oXowdFcPEJeUNXudeX0bJnljtRgJ4"}},"msgtype":"m.text"},"ts":1719867019719,"senderName":"Justin Ridgewell","senderId":"@jridgewell:matrix.org","id":"$2bHlF1uWcKRESiJMKo51SbqkERLk_zZhPml-D6Ifx-4"},
{"content":{"body":"> <@stephenhicks:matrix.org> no, the promise\n\n * oh, right... yeah that makes sense, the unhandled rejection can only happen once. (In fact, maybe the spec doesn't even say any of this, since it's implied by unreachability.) But this doesn't handle the error issue.","format":"org.matrix.custom.html","formatted_body":"<mx-reply><blockquote><a href=\"https://matrix.to/#/!eQuZUAhGqudVFPodUG:matrix.org/$sKpvPs5axdlvac6SK5QPWsAo39ZVFSvtCdSB8NiyY9U?via=igalia.com&amp;via=matrix.org&amp;via=mozilla.org\">In reply to</a> <a href=\"https://matrix.to/#/@stephenhicks:matrix.org\">@stephenhicks:matrix.org</a><br>no, the promise</blockquote></mx-reply> * oh, right... yeah that makes sense, the unhandled rejection can only happen once. (In fact, maybe the spec doesn't even say any of this, since it's implied by unreachability.) But this doesn't handle the error issue.","m.mentions":{},"m.new_content":{"body":"oh, right... yeah that makes sense, the unhandled rejection can only happen once. (In fact, maybe the spec doesn't even say any of this, since it's implied by unreachability.) But this doesn't handle the error issue.","format":"org.matrix.custom.html","formatted_body":"oh, right... yeah that makes sense, the unhandled rejection can only happen once. (In fact, maybe the spec doesn't even say any of this, since it's implied by unreachability.) But this doesn't handle the error issue.","m.mentions":{"user_ids":["@stephenhicks:matrix.org"]},"msgtype":"m.text"},"m.relates_to":{"event_id":"$4U1m6iI-q1lxgBScPzBZERFmQ6EvowjAl543HafG4IY","rel_type":"m.replace"},"msgtype":"m.text"},"ts":1719867027921,"senderName":"littledan","senderId":"@littledan:matrix.org","id":"$aL4_doJ8OaGM72aRs9IMl-lsAKsBxns7jVLKIzF4p44"},
{"content":{"body":"> <@littledan:matrix.org> as we've previously reasoned, we could either store the context when the Promise is allocated (as in Node) or rejected (as in the current spec). I guess in either case, it could be in the Promise itself, and then it's only read by the unhandled rejection thing.\n\nI don’t think this helps in Andreu’s code sample, unless we’re expecting the `”foo”` context","format":"org.matrix.custom.html","formatted_body":"<mx-reply><blockquote><a href=\"https://matrix.to/#/!eQuZUAhGqudVFPodUG%3Amatrix.org/%24xXlbvuJHcNqx0DxZLpCzEewfcbbtmWaMKuL5azWID7U\">In reply to</a><a href=\"https://matrix.to/#/%40littledan%3Amatrix.org\">@littledan:matrix.org</a><br />as we&#39;ve previously reasoned, we could either store the context when the Promise is allocated (as in Node) or rejected (as in the current spec). I guess in either case, it could be in the Promise itself, and then it&#39;s only read by the unhandled rejection thing.</blockquote></mx-reply>I don’t think this helps in Andreu’s code sample, unless we’re expecting the <code data-md=\"`\">”foo”</code> context","m.relates_to":{"m.in_reply_to":{"event_id":"$xXlbvuJHcNqx0DxZLpCzEewfcbbtmWaMKuL5azWID7U"}},"msgtype":"m.text"},"ts":1719867056132,"senderName":"Justin Ridgewell","senderId":"@jridgewell:matrix.org","id":"$IASN4QTxjEv0FxGBTmcl-dHavjOCktYjFQEpxDkURI8"},
{"content":{"body":"> <@jridgewell:matrix.org> I’d honestly be happy saying that’s an anti-pattern and you don’t get the correct context in this case.\n\nactually we care a lot about this case at Bloomberg, but maybe for reasons which don't deserve to be prioritized","format":"org.matrix.custom.html","formatted_body":"<mx-reply><blockquote><a href=\"https://matrix.to/#/!eQuZUAhGqudVFPodUG:matrix.org/$2bHlF1uWcKRESiJMKo51SbqkERLk_zZhPml-D6Ifx-4?via=igalia.com&via=matrix.org&via=mozilla.org\">In reply to</a> <a href=\"https://matrix.to/#/@jridgewell:matrix.org\">@jridgewell:matrix.org</a><br>I’d honestly be happy saying that’s an anti-pattern and you don’t get the correct context in this case.</blockquote></mx-reply>actually we care a lot about this case at Bloomberg, but maybe for reasons which don't deserve to be prioritized","m.mentions":{"user_ids":["@jridgewell:matrix.org"]},"m.relates_to":{"m.in_reply_to":{"event_id":"$2bHlF1uWcKRESiJMKo51SbqkERLk_zZhPml-D6Ifx-4"}},"msgtype":"m.text"},"ts":1719867057957,"senderName":"littledan","senderId":"@littledan:matrix.org","id":"$j-TZrTEWoGPl5Iu8NO0_wvmKi9meVLsB1UuXkfHjNxQ"},
{"content":{"body":"> <@jridgewell:matrix.org> I don’t think this helps in Andreu’s code sample, unless we’re expecting the `”foo”` context\n\nthat's right, I'm discussing strategies for getting \"foo\"","format":"org.matrix.custom.html","formatted_body":"<mx-reply><blockquote><a href=\"https://matrix.to/#/!eQuZUAhGqudVFPodUG:matrix.org/$IASN4QTxjEv0FxGBTmcl-dHavjOCktYjFQEpxDkURI8?via=igalia.com&via=matrix.org&via=mozilla.org\">In reply to</a> <a href=\"https://matrix.to/#/@jridgewell:matrix.org\">@jridgewell:matrix.org</a><br>I don’t think this helps in Andreu’s code sample, unless we’re expecting the <code data-md=\"`\">”foo”</code> context</blockquote></mx-reply>that's right, I'm discussing strategies for getting \"foo\"","m.mentions":{"user_ids":["@jridgewell:matrix.org"]},"m.relates_to":{"m.in_reply_to":{"event_id":"$IASN4QTxjEv0FxGBTmcl-dHavjOCktYjFQEpxDkURI8"}},"msgtype":"m.text"},"ts":1719867083217,"senderName":"littledan","senderId":"@littledan:matrix.org","id":"$bjFIMAzESHmzR1qfIAN5Zsc__9JZHsnag9UwEFY7ras"},
{"content":{"body":"Google also cares about throwing non-errors, but we believe the solution is \"Don't do that\" rather than bloating the standards to account for it","m.mentions":{},"msgtype":"m.text"},"ts":1719867092696,"senderName":"Steve Hicks","senderId":"@stephenhicks:matrix.org","id":"$EfQnIX0sXXnayo20ChlGbWAGg1a5IXA7owTIGI6jfxU"},
{"content":{"body":"well, maybe we can look into the \"don't do that\" path... maybe Chengzhong can follow up on this?","m.mentions":{},"msgtype":"m.text"},"ts":1719867126461,"senderName":"littledan","senderId":"@littledan:matrix.org","id":"$-DquIoA2zJ2HfHUuR8fy-DDksTry2xxQoMrG8t8Vj4I"},
{"content":{"body":"Chengzhong Wu: ^","format":"org.matrix.custom.html","formatted_body":"<a href=\"https://matrix.to/#/@legendecas:matrix.org\">Chengzhong Wu</a>: ^","m.mentions":{"user_ids":["@legendecas:matrix.org"]},"msgtype":"m.text"},"ts":1719867130625,"senderName":"littledan","senderId":"@littledan:matrix.org","id":"$ThEvIyrBQI3mMAJstGFN23wMY0WH34aTu5-Jgg7m0zo"},
{"content":{"body":"> <@littledan:matrix.org> well, maybe we can look into the \"don't do that\" path... maybe Chengzhong can follow up on this?\n\n(aside) in particular, one strategy we're consider is to transpile all `throw x`s to `throw trackNonError(x)` that throws a real error with a stack trace asynchronously so as to at least get some logging in place to identify all the offenders","format":"org.matrix.custom.html","formatted_body":"<mx-reply><blockquote><a href=\"https://matrix.to/#/!eQuZUAhGqudVFPodUG:matrix.org/$-DquIoA2zJ2HfHUuR8fy-DDksTry2xxQoMrG8t8Vj4I?via=igalia.com&via=matrix.org&via=mozilla.org\">In reply to</a> <a href=\"https://matrix.to/#/@littledan:matrix.org\">@littledan:matrix.org</a><br>well, maybe we can look into the &quot;don&#39;t do that&quot; path... maybe Chengzhong can follow up on this?</blockquote></mx-reply>(aside) in particular, one strategy we're consider is to transpile all <code>throw x</code>s to <code>throw trackNonError(x)</code> that throws a real error with a stack trace asynchronously so as to at least get some logging in place to identify all the offenders","m.mentions":{"user_ids":["@littledan:matrix.org"]},"m.relates_to":{"m.in_reply_to":{"event_id":"$-DquIoA2zJ2HfHUuR8fy-DDksTry2xxQoMrG8t8Vj4I"}},"msgtype":"m.text"},"ts":1719867235953,"senderName":"Steve Hicks","senderId":"@stephenhicks:matrix.org","id":"$H3SfQvf9FVNTNWBTIwwfYs2Lkh4mK9JJMO_fAkyqgkQ"},
{"content":{"body":"Are you suggesting we attach the context onto the error instead of just running the `unhandledRejectionHandler` in the correct context?","format":"org.matrix.custom.html","formatted_body":"Are you suggesting we attach the context onto the error instead of just running the <code data-md=\"`\">unhandledRejectionHandler</code> in the correct context?","msgtype":"m.text"},"ts":1719867265584,"senderName":"Justin Ridgewell","senderId":"@jridgewell:matrix.org","id":"$Qv6ttU83NPWDlE-a9MgKq7vE1qbXLX0M2en0pccrlQk"},
{"content":{"body":"> <@jridgewell:matrix.org> Are you suggesting we attach the context onto the error instead of just running the `unhandledRejectionHandler` in the correct context?\n\nYes?","format":"org.matrix.custom.html","formatted_body":"<mx-reply><blockquote><a href=\"https://matrix.to/#/!eQuZUAhGqudVFPodUG:matrix.org/$Qv6ttU83NPWDlE-a9MgKq7vE1qbXLX0M2en0pccrlQk?via=igalia.com&via=matrix.org&via=mozilla.org\">In reply to</a> <a href=\"https://matrix.to/#/@jridgewell:matrix.org\">@jridgewell:matrix.org</a><br>Are you suggesting we attach the context onto the error instead of just running the <code data-md=\"`\">unhandledRejectionHandler</code> in the correct context?</blockquote></mx-reply>Yes?","m.mentions":{"user_ids":["@jridgewell:matrix.org"]},"m.relates_to":{"m.in_reply_to":{"event_id":"$Qv6ttU83NPWDlE-a9MgKq7vE1qbXLX0M2en0pccrlQk"}},"msgtype":"m.text"},"ts":1719867292443,"senderName":"Steve Hicks","senderId":"@stephenhicks:matrix.org","id":"$GuNOkZv8bWuIV0A1hL3dtVj5ga0hCF5jiDZeM9O6mBM"},
{"content":{"body":"at that point, maybe there's not as much of a reason to even attach a context to `unhandledrejection`?","format":"org.matrix.custom.html","formatted_body":"at that point, maybe there's not as much of a reason to even attach a context to <code>unhandledrejection</code>?","m.mentions":{},"msgtype":"m.text"},"ts":1719867328157,"senderName":"Steve Hicks","senderId":"@stephenhicks:matrix.org","id":"$l5_MCgoKu5Lw-nLF3GfCVxGVVmk-h-1v9yvFkBdKxko"},
{"content":{"body":"> <@jridgewell:matrix.org> Are you suggesting we attach the context onto the error instead of just running the `unhandledRejectionHandler` in the correct context?\n\nwell, we're somewhat deep into this thread of \"run everything in registration context, and the 'correct' context is off to the side somewhere\", and so we're trying to reason about whether the error's context is enough, or if we also need the rejection's context","format":"org.matrix.custom.html","formatted_body":"<mx-reply><blockquote><a href=\"https://matrix.to/#/!eQuZUAhGqudVFPodUG:matrix.org/$Qv6ttU83NPWDlE-a9MgKq7vE1qbXLX0M2en0pccrlQk?via=igalia.com&via=matrix.org&via=mozilla.org\">In reply to</a> <a href=\"https://matrix.to/#/@jridgewell:matrix.org\">@jridgewell:matrix.org</a><br>Are you suggesting we attach the context onto the error instead of just running the <code data-md=\"`\">unhandledRejectionHandler</code> in the correct context?</blockquote></mx-reply>well, we're somewhat deep into this thread of \"run everything in registration context, and the 'correct' context is off to the side somewhere\", and so we're trying to reason about whether the error's context is enough, or if we also need the rejection's context","m.mentions":{"user_ids":["@jridgewell:matrix.org"]},"m.relates_to":{"m.in_reply_to":{"event_id":"$Qv6ttU83NPWDlE-a9MgKq7vE1qbXLX0M2en0pccrlQk"}},"msgtype":"m.text"},"ts":1719867328402,"senderName":"littledan","senderId":"@littledan:matrix.org","id":"$a0KNFv4p7tTPEDLG1FQNEUwGkizExh4XGBNAlgJKpOE"},
{"content":{"body":"if we get the rejection's context, it could be exposed in the event","m.mentions":{},"msgtype":"m.text"},"ts":1719867341581,"senderName":"littledan","senderId":"@littledan:matrix.org","id":"$U59yHpI6s0mcj9aVAK4A5TfiByXhKsY14AbnOZlmDl8"},
{"content":{"body":"I'm still hopeful that maybe we can get a more general resolution context for promises, but my understanding is that littledan has reason to think that's not feasible","format":"org.matrix.custom.html","formatted_body":"I'm still hopeful that maybe we can get a more general resolution context for promises, but my understanding is that <a href=\"https://matrix.to/#/@littledan:matrix.org\">littledan</a> has reason to think that's not feasible","m.mentions":{"user_ids":["@littledan:matrix.org"]},"msgtype":"m.text"},"ts":1719867420576,"senderName":"Steve Hicks","senderId":"@stephenhicks:matrix.org","id":"$3Ei2SoyWrua8DAiBz1vMdLrFk87jhJPS09WTY5g0fFA"},
{"content":{"body":"I think a general resolution context for all promises would be seen as an information leak, but again that's not a very pragmatic reason for anything. Definitely it's easier to *just* capture the context where resolve()/reject() was done, rather than have that somehow be propagated across .then() as we've previously discussed.","format":"org.matrix.custom.html","formatted_body":"I think a general resolution context for all promises would be seen as an information leak, but again that's not a very pragmatic reason for anything. Definitely it's easier to <em>just</em> capture the context where resolve()/reject() was done, rather than have that somehow be propagated across .then() as we've previously discussed.","m.mentions":{},"msgtype":"m.text"},"ts":1719867514663,"senderName":"littledan","senderId":"@littledan:matrix.org","id":"$txGW2MJdP4E59P2zDrdLLqRnOsLx50MIro6REsbxUoY"},
{"content":{"body":"with the semantics I'm picturing for capturing causal contexts for all Promises, for async functions, the resolve/reject context would be boring: it would be the context when the async function was called","m.mentions":{},"msgtype":"m.text"},"ts":1719867760135,"senderName":"littledan","senderId":"@littledan:matrix.org","id":"$tS7zKo-ox6roZ2P6hMgzOTPuD--Mrux_FUjwHNjEgCo"},
{"content":{"body":"it would only be something different if you call the promise constructor/withResolvers","m.mentions":{},"msgtype":"m.text"},"ts":1719867811930,"senderName":"littledan","senderId":"@littledan:matrix.org","id":"$qHtGca2o37HCgGNwkO0YPdRWKtdnmvxXygyILcYYRbY"},
{"content":{"body":"> <@littledan:matrix.org> well, maybe we can look into the \"don't do that\" path... maybe Chengzhong can follow up on this?\n\nI am not a fan of granting \"throw\" super power in spec to recover stacks and contexts either. Definitely, people can throw primitive values, just don't do that","format":"org.matrix.custom.html","formatted_body":"<mx-reply><blockquote><a href=\"https://matrix.to/#/!eQuZUAhGqudVFPodUG:matrix.org/$-DquIoA2zJ2HfHUuR8fy-DDksTry2xxQoMrG8t8Vj4I?via=igalia.com&via=matrix.org&via=mozilla.org\">In reply to</a> <a href=\"https://matrix.to/#/@littledan:matrix.org\">@littledan:matrix.org</a><br>well, maybe we can look into the &quot;don&#39;t do that&quot; path... maybe Chengzhong can follow up on this?</blockquote></mx-reply>I am not a fan of granting \"throw\" super power in spec to recover stacks and contexts either. Definitely, people can throw primitive values, just don't do that","m.mentions":{"user_ids":["@littledan:matrix.org"]},"m.relates_to":{"m.in_reply_to":{"event_id":"$-DquIoA2zJ2HfHUuR8fy-DDksTry2xxQoMrG8t8Vj4I"}},"msgtype":"m.text"},"ts":1719868014639,"senderName":"Chengzhong Wu","senderId":"@legendecas:matrix.org","id":"$Knbc2-iMNiWTpwa9LZYzCgx-RSQKfewj_rtyOu96ETM"},
{"content":{"body":"> <@legendecas:matrix.org> I am not a fan of granting \"throw\" super power in spec to recover stacks and contexts either. Definitely, people can throw primitive values, just don't do that\n\nOK, but how does this apply to unhandled rejections?","format":"org.matrix.custom.html","formatted_body":"<mx-reply><blockquote><a href=\"https://matrix.to/#/!eQuZUAhGqudVFPodUG:matrix.org/$Knbc2-iMNiWTpwa9LZYzCgx-RSQKfewj_rtyOu96ETM?via=igalia.com&via=matrix.org&via=mozilla.org\">In reply to</a> <a href=\"https://matrix.to/#/@legendecas:matrix.org\">@legendecas:matrix.org</a><br>I am not a fan of granting \"throw\" super power in spec to recover stacks and contexts either. Definitely, people can throw primitive values, just don't do that</blockquote></mx-reply>OK, but how does this apply to unhandled rejections?","m.mentions":{"user_ids":["@legendecas:matrix.org"]},"m.relates_to":{"m.in_reply_to":{"event_id":"$Knbc2-iMNiWTpwa9LZYzCgx-RSQKfewj_rtyOu96ETM"}},"msgtype":"m.text"},"ts":1719868044570,"senderName":"littledan","senderId":"@littledan:matrix.org","id":"$AtX9S57-6LFggg60p3nr6P281G-zbEo6gVFuBQs90-0"},
{"content":{"body":"I think it could be a property of PromiseRejectionEvent/ErrorEvent, as documented in https://github.com/tc39/proposal-async-context/pull/94/files#diff-85367a6a792209cf5826726990ddd1f0fd7a572bac4162097bc5e7e192aa625cR295, updated today","m.mentions":{},"msgtype":"m.text"},"ts":1719868118166,"senderName":"Chengzhong Wu","senderId":"@legendecas:matrix.org","id":"$fbeGejNwEpaV7Sgb7RNr3uzzF9_Mr6n8_aY6NLdb_C4"},
{"content":{"body":"Well, I think this could be definitely in its own piece of document expansion.","m.mentions":{},"msgtype":"m.text"},"ts":1719868158877,"senderName":"Chengzhong Wu","senderId":"@legendecas:matrix.org","id":"$S_7EMM2dLiE1pSVXnANY0lNzWLC0ooNNsr8ee80tFsU"},
{"content":{"body":"isn't putting it in ErrorEvent giving those superpowers?","m.mentions":{},"msgtype":"m.text"},"ts":1719868176788,"senderName":"littledan","senderId":"@littledan:matrix.org","id":"$4Kx_VFXBruZZuxOyMO8dso0EcGc5dQtxCkcR8GaeeFY"},
{"content":{"body":" * isn't putting a context in ErrorEvent giving those superpowers?","m.mentions":{},"m.new_content":{"body":"isn't putting a context in ErrorEvent giving those superpowers?","m.mentions":{},"msgtype":"m.text"},"m.relates_to":{"event_id":"$4Kx_VFXBruZZuxOyMO8dso0EcGc5dQtxCkcR8GaeeFY","rel_type":"m.replace"},"msgtype":"m.text"},"ts":1719868185474,"senderName":"littledan","senderId":"@littledan:matrix.org","id":"$NJilmy-vhn9vzwpCz4cEwHGhKV07jDkVjA9mqzKYvzI"},
{"content":{"body":"ErrorEvents are errors captured at the top level","m.mentions":{},"msgtype":"m.text"},"ts":1719868214561,"senderName":"Chengzhong Wu","senderId":"@legendecas:matrix.org","id":"$qIl6aLRt2Ym2EO_WqwEnC0Fl0GQNWWpuy1555uTmyRg"},
{"content":{"body":"\"throw\" itself doesn't have this superpower","m.mentions":{},"msgtype":"m.text"},"ts":1719868223356,"senderName":"Chengzhong Wu","senderId":"@legendecas:matrix.org","id":"$IRj5zmGD7-ELxj7gw4eWWeFfwZF6treprswiKXVBdjg"},
{"content":{"body":"so this won't have a re-throw problem","m.mentions":{},"msgtype":"m.text"},"ts":1719868236444,"senderName":"Chengzhong Wu","senderId":"@legendecas:matrix.org","id":"$rD-Rac61hafcciN109z_lbr4JHY6TEN2WKhQowPtl-0"},
{"content":{"body":" * ErrorEvents are errors captured at the host level","m.mentions":{},"m.new_content":{"body":"ErrorEvents are errors captured at the host level","m.mentions":{},"msgtype":"m.text"},"m.relates_to":{"event_id":"$qIl6aLRt2Ym2EO_WqwEnC0Fl0GQNWWpuy1555uTmyRg","rel_type":"m.replace"},"msgtype":"m.text"},"ts":1719868253190,"senderName":"Chengzhong Wu","senderId":"@legendecas:matrix.org","id":"$A9xOKVSEZQh5CAFs037UonAIeSvo98QdH1ewLPf8-GQ"},
{"content":{"body":"Hosts already compute stack traces at error construction time, so it seems pretty reasonable to also copy the context pointer at the same time.  But I'm a little fuzzy on how this proposal interacts with that, since EcmaScript doesn't even mention `stack` anywhere, even non-normatively.","format":"org.matrix.custom.html","formatted_body":"Hosts already compute stack traces at error construction time, so it seems pretty reasonable to also copy the context pointer at the same time.  But I'm a little fuzzy on how this proposal interacts with that, since EcmaScript doesn't even mention <code>stack</code> anywhere, even non-normatively.","m.mentions":{},"msgtype":"m.text"},"ts":1719869933069,"senderName":"Steve Hicks","senderId":"@stephenhicks:matrix.org","id":"$0N9mx5GK-3OV73akpSX4hZdwgSA9_8Xnavi0Pr11ilo"},
{"content":{"body":"Where are we planning on documenting the various DOM interactions?","m.mentions":{},"msgtype":"m.text"},"ts":1719869961802,"senderName":"Steve Hicks","senderId":"@stephenhicks:matrix.org","id":"$WG_KA_8pFKCUwjD8VwlTg2FCeZlxuBy8MFQg9sva7eI"},
{"content":{"body":"> <@stephenhicks:matrix.org> Hosts already compute stack traces at error construction time, so it seems pretty reasonable to also copy the context pointer at the same time.  But I'm a little fuzzy on how this proposal interacts with that, since EcmaScript doesn't even mention `stack` anywhere, even non-normatively.\n\nit's being worked at https://github.com/tc39/proposal-error-stacks.","format":"org.matrix.custom.html","formatted_body":"<mx-reply><blockquote><a href=\"https://matrix.to/#/!eQuZUAhGqudVFPodUG:matrix.org/$0N9mx5GK-3OV73akpSX4hZdwgSA9_8Xnavi0Pr11ilo?via=igalia.com&via=matrix.org&via=mozilla.org\">In reply to</a> <a href=\"https://matrix.to/#/@stephenhicks:matrix.org\">@stephenhicks:matrix.org</a><br>Hosts already compute stack traces at error construction time, so it seems pretty reasonable to also copy the context pointer at the same time.  But I'm a little fuzzy on how this proposal interacts with that, since EcmaScript doesn't even mention <code>stack</code> anywhere, even non-normatively.</blockquote></mx-reply>it's being worked at https://github.com/tc39/proposal-error-stacks.","m.mentions":{"user_ids":["@stephenhicks:matrix.org"]},"m.relates_to":{"m.in_reply_to":{"event_id":"$0N9mx5GK-3OV73akpSX4hZdwgSA9_8Xnavi0Pr11ilo"}},"msgtype":"m.text"},"ts":1719869988996,"senderName":"Chengzhong Wu","senderId":"@legendecas:matrix.org","id":"$X3t_DVzX_GS3vfGscD_TW83MFSwg9Bm1l87zmTBKfeQ"},
{"content":{"body":"> <@stephenhicks:matrix.org> Where are we planning on documenting the various DOM interactions?\n\nwe'll need to do so in places linked from https://github.com/whatwg/html/issues/10432 . I believe Andreu Botella is working on a document for this.","format":"org.matrix.custom.html","formatted_body":"<mx-reply><blockquote><a href=\"https://matrix.to/#/!eQuZUAhGqudVFPodUG:matrix.org/$WG_KA_8pFKCUwjD8VwlTg2FCeZlxuBy8MFQg9sva7eI?via=igalia.com&via=matrix.org&via=mozilla.org\">In reply to</a> <a href=\"https://matrix.to/#/@stephenhicks:matrix.org\">@stephenhicks:matrix.org</a><br>Where are we planning on documenting the various DOM interactions?</blockquote></mx-reply>we'll need to do so in places linked from https://github.com/whatwg/html/issues/10432 . I believe <a href=\"https://matrix.to/#/@abotella:igalia.com\">Andreu Botella</a> is working on a document for this.","m.mentions":{"user_ids":["@stephenhicks:matrix.org","@abotella:igalia.com"]},"m.relates_to":{"m.in_reply_to":{"event_id":"$WG_KA_8pFKCUwjD8VwlTg2FCeZlxuBy8MFQg9sva7eI"}},"msgtype":"m.text"},"ts":1719870016488,"senderName":"littledan","senderId":"@littledan:matrix.org","id":"$8nNL8PKf3tsvOHfxAWwJSH9J6nIyYZouyiFU-xddSc4"},
{"content":{"body":"> <@legendecas:matrix.org> it's being worked at https://github.com/tc39/proposal-error-stacks.\n\n\"Being worked on\" is generous for this proposal; the champions do not plan to work in a way that meets the (reasonable, IMO) requirements of browsers for spec work in this area. So we should definitely not depend on it.","format":"org.matrix.custom.html","formatted_body":"<mx-reply><blockquote><a href=\"https://matrix.to/#/!eQuZUAhGqudVFPodUG:matrix.org/$X3t_DVzX_GS3vfGscD_TW83MFSwg9Bm1l87zmTBKfeQ?via=igalia.com&via=matrix.org&via=mozilla.org\">In reply to</a> <a href=\"https://matrix.to/#/@legendecas:matrix.org\">@legendecas:matrix.org</a><br>it's being worked at https://github.com/tc39/proposal-error-stacks.</blockquote></mx-reply>\"Being worked on\" is generous for this proposal; the champions do not plan to work in a way that meets the (reasonable, IMO) requirements of browsers for spec work in this area. So we should definitely not depend on it.","m.mentions":{"user_ids":["@legendecas:matrix.org","@stephenhicks:matrix.org"]},"m.relates_to":{"m.in_reply_to":{"event_id":"$X3t_DVzX_GS3vfGscD_TW83MFSwg9Bm1l87zmTBKfeQ"}},"msgtype":"m.text"},"ts":1719870125389,"senderName":"littledan","senderId":"@littledan:matrix.org","id":"$Rs6Lg432Y0chbcczLfBPcy5h4QzRXgwWxBWuYWmBJ2w"},
{"content":{"body":"I don't think there's active work in that repo either, given that browsers expressed requirements and that was demotivating","m.mentions":{},"msgtype":"m.text"},"ts":1719870144567,"senderName":"littledan","senderId":"@littledan:matrix.org","id":"$PACxeNnj0DdUbx-8zUQ5ZDXdMfPu3XG7A1FjVEXp6j4"},
{"content":{"body":"😅 \"stalled for years\"","m.mentions":{},"msgtype":"m.text"},"ts":1719870184814,"senderName":"Chengzhong Wu","senderId":"@legendecas:matrix.org","id":"$0vai5drMMZc2G2CkZCvaulwZ74DvsXT2jcqiSHGaZ-Q"}
]
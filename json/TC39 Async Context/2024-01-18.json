[
{"content":{"body":"I wonder if it makes sense to add a method to the C++ embedder API for `AsyncContext.Snapshot` to tell whether two objects represent the same underlying map","format":"org.matrix.custom.html","formatted_body":"I wonder if it makes sense to add a method to the C++ embedder API for <code>AsyncContext.Snapshot</code> to tell whether two objects represent the same underlying map","msgtype":"m.text"},"ts":1705581215036,"senderName":"Andreu Botella","senderId":"@abotella:igalia.com","id":"$yMOCo6vM1seUfkhj0f5xsW2JA0WKWLAtTpXMb-6S3-Q"},
{"content":{"body":"also to create an `AsyncContext.Snapshot` with an empty map (well, with the map being `undefined` in my V8 implementation)","format":"org.matrix.custom.html","formatted_body":"also to create an <code>AsyncContext.Snapshot</code> with an empty map (well, with the map being <code>undefined</code> in my V8 implementation)","msgtype":"m.text"},"ts":1705581644155,"senderName":"Andreu Botella","senderId":"@abotella:igalia.com","id":"$07EHLhcRsOku4MxlCLEbDzuQQHCqAU_2krXw-QhbJt0"},
{"content":{"body":"Do you have use cases for those in mind?","msgtype":"m.text"},"ts":1705583155485,"senderName":"littledan","senderId":"@littledan:matrix.org","id":"$F6MNmovER6jeFWJjsjhF8ZRt5N0zhJXaOXFTeBJg3xg"},
{"content":{"body":"For the latter, I really don’t want to expose that to JS, and I wonder why it would ever be valid to do ","format":"org.matrix.custom.html","formatted_body":"For the latter, I really don’t want to expose that to JS, and I wonder why it would ever be valid to do","msgtype":"m.text"},"ts":1705583181053,"senderName":"littledan","senderId":"@littledan:matrix.org","id":"$LQPRkLIU2V3eiGY34dv986JnqmCc5We6JMruQ-ekfCE"},
{"content":{"body":"not to JS, to embedders","msgtype":"m.text"},"ts":1705583848973,"senderName":"Andreu Botella","senderId":"@abotella:igalia.com","id":"$WqxnnFi0lmXDfSZVb1tTb2xg_OiPo7bKou3bXrdiGwc"},
{"content":{"body":"because of reasons involving the architecture of Blink, task attribution is using a `std::unique_ptr<Scope>` as an RAII scope for the equivalent of `snapshot.run()`","format":"org.matrix.custom.html","formatted_body":"because of reasons involving the architecture of Blink, task attribution is using a <code>std::unique_ptr&lt;Scope&gt;</code> as an RAII scope for the equivalent of <code>snapshot.run()</code>","msgtype":"m.text"},"ts":1705584687120,"senderName":"Andreu Botella","senderId":"@abotella:igalia.com","id":"$ac4MNgq9QUlGB6YV3fhl_XOAs2qPsvfbwutsQI0MAJ0"},
{"content":{"body":"it has to be an allocation because users of this scope can't depend on the actual C++ files calling into V8, so `Scope` there has to be an abstract class that is implemented elsewhere","format":"org.matrix.custom.html","formatted_body":"it has to be an allocation because users of this scope can't depend on the actual C++ files calling into V8, so <code>Scope</code> there has to be an abstract class that is implemented elsewhere","msgtype":"m.text"},"ts":1705584787221,"senderName":"Andreu Botella","senderId":"@abotella:igalia.com","id":"$wJY2Nmgy_JUnnjHEPL8yhmd84-Srw4DqvbdiLVcd-xc"},
{"content":{"body":"you can save the allocation if you can be sure that the snapshot you'd be running is the same as the current one, and if there's nothing new to set task allocation-wise that wasn't there before","msgtype":"m.text"},"ts":1705584827715,"senderName":"Andreu Botella","senderId":"@abotella:igalia.com","id":"$IAQKAvTeSlCf-m9-JUQDbu5RO1EAyxt_ROt8wnNM3V8"},
{"content":{"body":"by returning a null `unique_ptr`","format":"org.matrix.custom.html","formatted_body":"by returning a null <code>unique_ptr</code>","msgtype":"m.text"},"ts":1705584861423,"senderName":"Andreu Botella","senderId":"@abotella:igalia.com","id":"$QWT-x7kuLr0FkAUER-n1ess3BHthB3ihI46I-QtVnTo"},
{"content":{"body":"the snapshot with an empty map, I just realized I don't actually need it for Blink","msgtype":"m.text"},"ts":1705584990963,"senderName":"Andreu Botella","senderId":"@abotella:igalia.com","id":"$d77W5clQ7qu6VtmZmD1sdrGSUwUmRTRr-cq8AtS8u-w"},
{"content":{"body":" * the snapshot with an empty map, I just realized I don't actually need it in Blink","m.new_content":{"body":"the snapshot with an empty map, I just realized I don't actually need it in Blink","msgtype":"m.text"},"m.relates_to":{"event_id":"$d77W5clQ7qu6VtmZmD1sdrGSUwUmRTRr-cq8AtS8u-w","rel_type":"m.replace"},"msgtype":"m.text"},"ts":1705584998500,"senderName":"Andreu Botella","senderId":"@abotella:igalia.com","id":"$jo67d-i7wvOPY8Cia7JDr1l5-cDuJPg9Hp26EDhiCDY"},
{"content":{"body":"> <@abotella:igalia.com> the snapshot with an empty map, I just realized I don't actually need it in Blink\n\nRight, I was thinking, I couldn't think of any reason why a web spec or other embedder would ever validly want to get an empty snapshot. Anyway if we don't have a use case in mind yet, then that problem can be stashed for later.","format":"org.matrix.custom.html","formatted_body":"<mx-reply><blockquote><a href=\"https://matrix.to/#/!eQuZUAhGqudVFPodUG:matrix.org/$d77W5clQ7qu6VtmZmD1sdrGSUwUmRTRr-cq8AtS8u-w?via=matrix.org&via=mozilla.org&via=igalia.com\">In reply to</a> <a href=\"https://matrix.to/#/@abotella:igalia.com\">@abotella:igalia.com</a><br>the snapshot with an empty map, I just realized I don&#39;t actually need it in Blink</blockquote></mx-reply>Right, I was thinking, I couldn't think of any reason why a web spec or other embedder would ever validly want to get an empty snapshot. Anyway if we don't have a use case in mind yet, then that problem can be stashed for later.","m.mentions":{"user_ids":["@abotella:igalia.com"]},"m.relates_to":{"m.in_reply_to":{"event_id":"$d77W5clQ7qu6VtmZmD1sdrGSUwUmRTRr-cq8AtS8u-w"}},"msgtype":"m.text"},"ts":1705611691604,"senderName":"littledan","senderId":"@littledan:matrix.org","id":"$tSHxVgQYcSlJNWDS2LBIMrqHjWCGSfSC9GaqYqvTPRI"},
{"content":{"body":"> <@abotella:igalia.com> because of reasons involving the architecture of Blink, task attribution is using a `std::unique_ptr<Scope>` as an RAII scope for the equivalent of `snapshot.run()`\n\nYeah, we were going to make the API look like that too, weren't we?","format":"org.matrix.custom.html","formatted_body":"<mx-reply><blockquote><a href=\"https://matrix.to/#/!eQuZUAhGqudVFPodUG:matrix.org/$ac4MNgq9QUlGB6YV3fhl_XOAs2qPsvfbwutsQI0MAJ0?via=matrix.org&via=mozilla.org&via=igalia.com\">In reply to</a> <a href=\"https://matrix.to/#/@abotella:igalia.com\">@abotella:igalia.com</a><br>because of reasons involving the architecture of Blink, task attribution is using a <code>std::unique_ptr&lt;Scope&gt;</code> as an RAII scope for the equivalent of <code>snapshot.run()</code></blockquote></mx-reply>Yeah, we were going to make the API look like that too, weren't we?","m.mentions":{"user_ids":["@abotella:igalia.com"]},"m.relates_to":{"m.in_reply_to":{"event_id":"$ac4MNgq9QUlGB6YV3fhl_XOAs2qPsvfbwutsQI0MAJ0"}},"msgtype":"m.text"},"ts":1705611785606,"senderName":"littledan","senderId":"@littledan:matrix.org","id":"$O1f5jKFWZHiaIw4meZ4ugypnlYzQNG__nA3v0yQAYQA"},
{"content":{"body":"> <@abotella:igalia.com> you can save the allocation if you can be sure that the snapshot you'd be running is the same as the current one, and if there's nothing new to set task allocation-wise that wasn't there before\n\nHow could we do this RAII pattern only conditionally? Anyway couldn't this optimization be contained within the implementation of .run/the RAII equivalent?","format":"org.matrix.custom.html","formatted_body":"<mx-reply><blockquote><a href=\"https://matrix.to/#/!eQuZUAhGqudVFPodUG:matrix.org/$IAQKAvTeSlCf-m9-JUQDbu5RO1EAyxt_ROt8wnNM3V8?via=matrix.org&via=mozilla.org&via=igalia.com\">In reply to</a> <a href=\"https://matrix.to/#/@abotella:igalia.com\">@abotella:igalia.com</a><br>you can save the allocation if you can be sure that the snapshot you&#39;d be running is the same as the current one, and if there&#39;s nothing new to set task allocation-wise that wasn&#39;t there before</blockquote></mx-reply>How could we do this RAII pattern only conditionally? Anyway couldn't this optimization be contained within the implementation of .run/the RAII equivalent?","m.mentions":{"user_ids":["@abotella:igalia.com"]},"m.relates_to":{"m.in_reply_to":{"event_id":"$IAQKAvTeSlCf-m9-JUQDbu5RO1EAyxt_ROt8wnNM3V8"}},"msgtype":"m.text"},"ts":1705611834970,"senderName":"littledan","senderId":"@littledan:matrix.org","id":"$vBoHLVhcYpab45oICOxVpYKHIr8wQc0ppx5bolVWjGM"}
]
[
{"content":{"body":"Where are we in understanding https://github.com/tc39/proposal-async-context/issues/83 ?","m.mentions":{},"msgtype":"m.text"},"ts":1715621854525,"senderName":"littledan","senderId":"@littledan:matrix.org","id":"$QlHQQVKD-M1wlCuKG6WQlL84p8Vur6FWibQTe3BhRA4"},
{"content":{"body":"I talked with Dean Tribble on Friday, picking his brain from his Midori experience. I think the conclusion is that there is no way to abstract \"calling\" context in an API shape like AsyncContext. The biggest problem is that the most recent calling context may not be the one you really need, that providing more than one would result in unbounded calling context history, and that it would expose some implementation details about the execution order of the \"callers\". For telemetry / debugging use cases, one approach is to gather points at certain key times. For promises for example, you can give them an ID and \"log\" when they are resolved (potentially to another promise), when reactions are added and executed, etc.. Then you can correlate all this and recompose your execution graph. this of course sounds very similar to async_hooks, and is too powerful of an API to expose to \"unprivileged\" code.","msgtype":"m.text"},"ts":1715625733150,"senderName":"Mathieu Hofman","senderId":"@mhofman:matrix.org","id":"$PEWCklRsDU27NM8P0xFInM3f_3zRMEAWswzbrw9z_8M"},
{"content":{"body":"> <@mhofman:matrix.org> I talked with Dean Tribble on Friday, picking his brain from his Midori experience. I think the conclusion is that there is no way to abstract \"calling\" context in an API shape like AsyncContext. The biggest problem is that the most recent calling context may not be the one you really need, that providing more than one would result in unbounded calling context history, and that it would expose some implementation details about the execution order of the \"callers\". For telemetry / debugging use cases, one approach is to gather points at certain key times. For promises for example, you can give them an ID and \"log\" when they are resolved (potentially to another promise), when reactions are added and executed, etc.. Then you can correlate all this and recompose your execution graph. this of course sounds very similar to async_hooks, and is too powerful of an API to expose to \"unprivileged\" code.\n\nThis makes sense; thanks for the summary. What does Dean recommend that we do for AsyncContext?","format":"org.matrix.custom.html","formatted_body":"<mx-reply><blockquote><a href=\"https://matrix.to/#/!eQuZUAhGqudVFPodUG:matrix.org/$PEWCklRsDU27NM8P0xFInM3f_3zRMEAWswzbrw9z_8M?via=matrix.org&via=mozilla.org&via=igalia.com\">In reply to</a> <a href=\"https://matrix.to/#/@mhofman:matrix.org\">@mhofman:matrix.org</a><br>I talked with Dean Tribble on Friday, picking his brain from his Midori experience. I think the conclusion is that there is no way to abstract &quot;calling&quot; context in an API shape like AsyncContext. The biggest problem is that the most recent calling context may not be the one you really need, that providing more than one would result in unbounded calling context history, and that it would expose some implementation details about the execution order of the &quot;callers&quot;. For telemetry / debugging use cases, one approach is to gather points at certain key times. For promises for example, you can give them an ID and &quot;log&quot; when they are resolved (potentially to another promise), when reactions are added and executed, etc.. Then you can correlate all this and recompose your execution graph. this of course sounds very similar to async_hooks, and is too powerful of an API to expose to &quot;unprivileged&quot; code.</blockquote></mx-reply>This makes sense; thanks for the summary. What does Dean recommend that we do for AsyncContext?","m.mentions":{"user_ids":["@mhofman:matrix.org"]},"m.relates_to":{"m.in_reply_to":{"event_id":"$PEWCklRsDU27NM8P0xFInM3f_3zRMEAWswzbrw9z_8M"}},"msgtype":"m.text"},"ts":1715627007968,"senderName":"littledan","senderId":"@littledan:matrix.org","id":"$u22Nt_le_etY1kfrGURMi3OMMbwGOGQsp1P1jH1rDcY"},
{"content":{"body":"\"just choose something for each case\" is the strategy that I was imagining; maybe too naive but it sounds like this is maybe what Dean is saying?","m.mentions":{},"msgtype":"m.text"},"ts":1715627041285,"senderName":"littledan","senderId":"@littledan:matrix.org","id":"$nsVM4GwckF7gTVawJQh0sBoR6j81c1CYRCReW7TX6YE"},
{"content":{"body":"I'm wondering if there's any way we could expose \"just\" the necessary information to hook up the extra follows-from links, or distinguish child vs following links. I think Stephen Belanger may have been asking for one of these, though I'm not sure. Did you discuss this topic with Dean?","format":"org.matrix.custom.html","formatted_body":"I'm wondering if there's any way we could expose \"just\" the necessary information to hook up the extra follows-from links, or distinguish child vs following links. I think <a href=\"https://matrix.to/#/@stephenbelanger:matrix.org\">Stephen Belanger</a> may have been asking for one of these, though I'm not sure. Did you discuss this topic with Dean?","m.mentions":{"user_ids":["@stephenbelanger:matrix.org"]},"msgtype":"m.text"},"ts":1715627167309,"senderName":"littledan","senderId":"@littledan:matrix.org","id":"$IzFwlPJfzUl04WpoUKU8l3vfYbtaMUDtjzIOxf_EzqU"},
{"content":{"body":"Yeah having a default of \"snapshoting\" at registration makes sense for AsyncContext. It's just that AsyncContext might not be the right API shape for telemetry use cases. And yes we tried to figure out how the necessary info could be exposed through AsyncContext, but couldn't find a way.","msgtype":"m.text"},"ts":1715627574867,"senderName":"Mathieu Hofman","senderId":"@mhofman:matrix.org","id":"$bWHfXShwuAodr7BXEuC6AzjYu6S5yVCfkHx4Mqpdjak"},
{"content":{"body":"I think the current shape of AsyncContext has a \"good enough in practice\" shape for telemetry since it matches what's done in Node.js today. Maybe something better is possible; certainly telemetry infrastructure can be trusted.","m.mentions":{},"msgtype":"m.text"},"ts":1715627665008,"senderName":"littledan","senderId":"@littledan:matrix.org","id":"$d9C8ogE5D21n0ZX6q9jprt2xeUYoIibtsYPOdf5nUxg"},
{"content":{"body":"Mathieu Hofman: Do you think we should continue with AsyncContext as currently proposed, without changes like #83?","format":"org.matrix.custom.html","formatted_body":"<a href=\"https://matrix.to/#/@mhofman:matrix.org\">Mathieu Hofman</a>: Do you think we should continue with AsyncContext as currently proposed, without changes like #83?","m.mentions":{"user_ids":["@mhofman:matrix.org"]},"msgtype":"m.text"},"ts":1715627701185,"senderName":"littledan","senderId":"@littledan:matrix.org","id":"$W-_HHNuKQVMI4IYrCN8-IQDbjOSUkozi8j__jACnH_E"},
{"content":{"body":"Are we also considering taking the smaller-scoped `callingContext` API off the table?","format":"org.matrix.custom.html","formatted_body":"Are we also considering taking the smaller-scoped <code>callingContext</code> API off the table?","m.mentions":{},"msgtype":"m.text"},"ts":1715628739123,"senderName":"Steve Hicks","senderId":"@stephenhicks:matrix.org","id":"$cruTKK-zcor5a6DQ7FaPqi3RiXWqtNuxc2fNoIiEN4U"},
{"content":{"body":"#83 has made me pretty concerned about scope creep.  But I'm also obviously concerned about my own pet use cases.  I've got a meeting with Jatin this evening to hopefully nail down exactly what kind of registration- vs. call-time semantics we will need.","m.mentions":{},"msgtype":"m.text"},"ts":1715628814532,"senderName":"Steve Hicks","senderId":"@stephenhicks:matrix.org","id":"$GHtsLpVP4PMtVEPOAfiKWXmJaeCeJOxg_lhdmYv0xQY"}
]
[
{"content":{"body":"Our tracing lead reached out to me today with a problem caused by a commonly-used API that uses promises for event handling - i.e. `dialog.after().then(() => ...)` - which of course makes it impossible to preserve the dispatch context when calling the \"after\" callbacks.  I wonder to what extent this pattern is used externally?  Our workaround is to deprecate the promise-based API and cut out the middle `).then(`, so that you just pass the callback directly to `after`, but this is a pretty big migration.  I don't see any other alternative, though, since it's pretty fundamental that promises shouldn't try to record their resolution context or something like that, which would lead to inconsistencies vs. await, etc.  Is this something anyone else has run into and/or thought about?","format":"org.matrix.custom.html","formatted_body":"Our tracing lead reached out to me today with a problem caused by a commonly-used API that uses promises for event handling - i.e. <code>dialog.after().then(() =&gt; ...)</code> - which of course makes it impossible to preserve the dispatch context when calling the \"after\" callbacks.  I wonder to what extent this pattern is used externally?  Our workaround is to deprecate the promise-based API and cut out the middle <code>).then(</code>, so that you just pass the callback directly to <code>after</code>, but this is a pretty big migration.  I don't see any other alternative, though, since it's pretty fundamental that promises shouldn't try to record their resolution context or something like that, which would lead to inconsistencies vs. await, etc.  Is this something anyone else has run into and/or thought about?","m.mentions":{},"msgtype":"m.text"},"ts":1754951648549,"senderName":"Steve Hicks","senderId":"@stephenhicks:matrix.org","id":"$VfLbIZieUm09cf0RSXQQroVp8b3Il34G8y1sr8tRLjU"}
]
[
{"content":{"body":"Our tracing lead reached out to me today with a problem caused by a commonly-used API that uses promises for event handling - i.e. `dialog.after().then(() => ...)` - which of course makes it impossible to preserve the dispatch context when calling the \"after\" callbacks.  I wonder to what extent this pattern is used externally?  Our workaround is to deprecate the promise-based API and cut out the middle `).then(`, so that you just pass the callback directly to `after`, but this is a pretty big migration.  I don't see any other alternative, though, since it's pretty fundamental that promises shouldn't try to record their resolution context or something like that, which would lead to inconsistencies vs. await, etc.  Is this something anyone else has run into and/or thought about?","format":"org.matrix.custom.html","formatted_body":"Our tracing lead reached out to me today with a problem caused by a commonly-used API that uses promises for event handling - i.e. <code>dialog.after().then(() =&gt; ...)</code> - which of course makes it impossible to preserve the dispatch context when calling the \"after\" callbacks.  I wonder to what extent this pattern is used externally?  Our workaround is to deprecate the promise-based API and cut out the middle <code>).then(</code>, so that you just pass the callback directly to <code>after</code>, but this is a pretty big migration.  I don't see any other alternative, though, since it's pretty fundamental that promises shouldn't try to record their resolution context or something like that, which would lead to inconsistencies vs. await, etc.  Is this something anyone else has run into and/or thought about?","m.mentions":{},"msgtype":"m.text"},"ts":1754951648549,"senderName":"Steve Hicks","senderId":"@stephenhicks:matrix.org","id":"$VfLbIZieUm09cf0RSXQQroVp8b3Il34G8y1sr8tRLjU"},
{"content":{"body":"What's the tracing semantic on `dialog.after().then(() => /* what's the expected active span here */ )` ?","format":"org.matrix.custom.html","formatted_body":"What's the tracing semantic on <code>dialog.after().then(() =&gt; /* what's the expected active span here */ )</code> ?","m.mentions":{},"msgtype":"m.text"},"ts":1754951879304,"senderName":"Chengzhong Wu","senderId":"@legendecas:matrix.org","id":"$xbCnf0jx9O_WPh9thh8-uH96I1Qd0UJApt_giNfsf5k"},
{"content":{"body":"^ same question","m.mentions":{},"msgtype":"m.text"},"ts":1754951939263,"senderName":"Justin Ridgewell","senderId":"@jridgewell:matrix.org","id":"$Ba_Ir9pIr9E5ckgbnHYACly3VzQgKQEV0ruzmLdtm5M"},
{"content":{"body":"I feel like it's pretty common to model a once event as a Promise instead of a `.onfoo = () => {}`","format":"org.matrix.custom.html","formatted_body":"I feel like it's pretty common to model a once event as a Promise instead of a <code>.onfoo = () =&gt; {}</code>","m.mentions":{},"msgtype":"m.text"},"ts":1754951979663,"senderName":"Justin Ridgewell","senderId":"@jridgewell:matrix.org","id":"$QXHqqvh3-3aMxlCavwFvXNewtwfKX-i_p2p4c2IFV_c"},
{"content":{"body":"* What's the tracing library's semantic on `dialog.after().then(() => /* what's the expected active span here */ )` ?","format":"org.matrix.custom.html","formatted_body":"* What's the tracing library's semantic on <code>dialog.after().then(() =&gt; /* what's the expected active span here */ )</code> ?","m.mentions":{},"m.new_content":{"body":"What's the tracing library's semantic on `dialog.after().then(() => /* what's the expected active span here */ )` ?","format":"org.matrix.custom.html","formatted_body":"What's the tracing library's semantic on <code>dialog.after().then(() =&gt; /* what's the expected active span here */ )</code> ?","m.mentions":{},"msgtype":"m.text"},"m.relates_to":{"event_id":"$xbCnf0jx9O_WPh9thh8-uH96I1Qd0UJApt_giNfsf5k","rel_type":"m.replace"},"msgtype":"m.text"},"ts":1754952040854,"senderName":"Chengzhong Wu","senderId":"@legendecas:matrix.org","id":"$XMFdU_S3IJHcRS3TVsu_PzwurMEd8xZYxMC70DhBzgA"},
{"content":{"body":"* What's this tracing library's semantic on `dialog.after().then(() => /* what's the expected active span here */ )` ?","format":"org.matrix.custom.html","formatted_body":"* What's this tracing library's semantic on <code>dialog.after().then(() =&gt; /* what's the expected active span here */ )</code> ?","m.mentions":{},"m.new_content":{"body":"What's this tracing library's semantic on `dialog.after().then(() => /* what's the expected active span here */ )` ?","format":"org.matrix.custom.html","formatted_body":"What's this tracing library's semantic on <code>dialog.after().then(() =&gt; /* what's the expected active span here */ )</code> ?","m.mentions":{},"msgtype":"m.text"},"m.relates_to":{"event_id":"$xbCnf0jx9O_WPh9thh8-uH96I1Qd0UJApt_giNfsf5k","rel_type":"m.replace"},"msgtype":"m.text"},"ts":1754952048410,"senderName":"Chengzhong Wu","senderId":"@legendecas:matrix.org","id":"$7WDDvWZiPJ28yGLAlrVPh7KH5fDIwsFCOhBqnesx0zc"}
]
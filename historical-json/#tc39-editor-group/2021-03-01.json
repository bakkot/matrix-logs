[
{"content":{"body":"ljharb: do you know what","msgtype":"m.text"},"ts":1614632535000,"senderName":"bakkot","senderId":"bakkot@irc"},
{"content":{"body":"*what's up with the `build-spec` package.json command?","msgtype":"m.text"},"ts":1614632544000,"senderName":"bakkot","senderId":"bakkot@irc"},
{"content":{"body":"it's used by build-travis, so it's the one that gets deployed to the website","msgtype":"m.text"},"ts":1614632991000,"senderName":"ljharb","senderId":"ljharb@irc"},
{"content":{"body":"i'll have to refactor it when i get around to fully dropping travis","msgtype":"m.text"},"ts":1614633017000,"senderName":"ljharb","senderId":"ljharb@irc"},
{"content":{"body":"ah, ok","msgtype":"m.text"},"ts":1614633073000,"senderName":"bakkot","senderId":"bakkot@irc"},
{"content":{"body":"I'm adding the --multipage flag and want to make sure I put it in the right places","msgtype":"m.text"},"ts":1614633086000,"senderName":"bakkot","senderId":"bakkot@irc"},
{"content":{"body":"oh jeeze, they're already out of sync","msgtype":"m.text"},"ts":1614633692000,"senderName":"bakkot","senderId":"bakkot@irc"},
{"content":{"body":"with observable consequences","msgtype":"m.text"},"ts":1614633698000,"senderName":"bakkot","senderId":"bakkot@irc"},
{"content":{"body":"https://github.com/tc39/ecma262/issues/1257 is not fixed on https://tc39.es/ecma262/2020/","msgtype":"m.text"},"ts":1614633732000,"senderName":"bakkot","senderId":"bakkot@irc"},
{"content":{"body":"oof","msgtype":"m.text"},"ts":1614633760000,"senderName":"ljharb","senderId":"ljharb@irc"},
{"content":{"body":"i can fix that","msgtype":"m.text"},"ts":1614633785000,"senderName":"ljharb","senderId":"ljharb@irc"},
{"content":{"body":"oh actually it's just the `--no-ecma-262-biblio` that's missing, right?","msgtype":"m.text"},"ts":1614633882000,"senderName":"ljharb","senderId":"ljharb@irc"},
{"content":{"body":"i'll rework it so there's a single source of truth for the `ecmarkup` command","msgtype":"m.text"},"ts":1614633892000,"senderName":"ljharb","senderId":"ljharb@irc"},
{"content":{"body":"yeah, just that","msgtype":"m.text"},"ts":1614634236000,"senderName":"bakkot","senderId":"bakkot@irc"},
{"content":{"body":"that said, why does the 2020 branch get updated?","msgtype":"m.text"},"ts":1614634247000,"senderName":"bakkot","senderId":"bakkot@irc"},
{"content":{"body":"I thought 2020 was the one which we cut a while ago?","msgtype":"m.text"},"ts":1614634253000,"senderName":"bakkot","senderId":"bakkot@irc"},
{"content":{"body":"or am I confused","msgtype":"m.text"},"ts":1614634255000,"senderName":"bakkot","senderId":"bakkot@irc"},
{"content":{"body":"hm","msgtype":"m.text"},"ts":1614634331000,"senderName":"ljharb","senderId":"ljharb@irc"},
{"content":{"body":"ah. that doesn't update the branch - it builds the `/2020/` site *from* the `es2020` branch","msgtype":"m.text"},"ts":1614634370000,"senderName":"ljharb","senderId":"ljharb@irc"},
{"content":{"body":"so that `/` is the main spec and `/2020/` is the last 2020 build","msgtype":"m.text"},"ts":1614634382000,"senderName":"ljharb","senderId":"ljharb@irc"},
{"content":{"body":"ah, ok","msgtype":"m.text"},"ts":1614634413000,"senderName":"bakkot","senderId":"bakkot@irc"},
{"content":{"body":"realistically we shouldn't update /2020/ after it's cut, and we should also keep around the old years","msgtype":"m.text"},"ts":1614634417000,"senderName":"ljharb","senderId":"ljharb@irc"},
{"content":{"body":"yeah, agreed with both of those things","msgtype":"m.text"},"ts":1614634439000,"senderName":"bakkot","senderId":"bakkot@irc"},
{"content":{"body":"at some point we could make a script that does that properly","msgtype":"m.text"},"ts":1614634439000,"senderName":"ljharb","senderId":"ljharb@irc"},
{"content":{"body":"could","msgtype":"m.text"},"ts":1614634470000,"senderName":"bakkot","senderId":"bakkot@irc"},
{"content":{"body":"could also just have a branch which has all of them","msgtype":"m.text"},"ts":1614634484000,"senderName":"bakkot","senderId":"bakkot@irc"},
{"content":{"body":"has them committed, that is","msgtype":"m.text"},"ts":1614634488000,"senderName":"bakkot","senderId":"bakkot@irc"},
{"content":{"body":"and update it once a year","msgtype":"m.text"},"ts":1614634495000,"senderName":"bakkot","senderId":"bakkot@irc"},
{"content":{"body":"it'd have to be the same branch as the one that every master build updates tho","msgtype":"m.text"},"ts":1614634515000,"senderName":"ljharb","senderId":"ljharb@irc"},
{"content":{"body":"and currently it's using `travis-scripts`, which doesn't have the ability to update a branch in place","msgtype":"m.text"},"ts":1614634530000,"senderName":"ljharb","senderId":"ljharb@irc"},
{"content":{"body":"so part of the actions migration will be to fix that anyways","msgtype":"m.text"},"ts":1614634535000,"senderName":"ljharb","senderId":"ljharb@irc"},
{"content":{"body":"https://github.com/tc39/ecma262/pull/2337","msgtype":"m.text"},"ts":1614634537000,"senderName":"ljharb","senderId":"ljharb@irc"},
{"content":{"body":"no, I mean, do a `git co that-branch -- years-directory` and copy the files to the right place","msgtype":"m.text"},"ts":1614634550000,"senderName":"bakkot","senderId":"bakkot@irc"},
{"content":{"body":"ah, right","msgtype":"m.text"},"ts":1614634559000,"senderName":"ljharb","senderId":"ljharb@irc"},
{"content":{"body":"altho hmm","msgtype":"m.text"},"ts":1614634626000,"senderName":"ljharb","senderId":"ljharb@irc"},
{"content":{"body":"lol `npm run build-travis` doesn't seem to run anyways","msgtype":"m.text"},"ts":1614634636000,"senderName":"ljharb","senderId":"ljharb@irc"},
{"content":{"body":"i'll spend some time and detangle this.","msgtype":"m.text"},"ts":1614634647000,"senderName":"ljharb","senderId":"ljharb@irc"},
{"content":{"body":"amazing","msgtype":"m.text"},"ts":1614634679000,"senderName":"bakkot","senderId":"bakkot@irc"},
{"content":{"body":"tools are great!","msgtype":"m.text"},"ts":1614634687000,"senderName":"bakkot","senderId":"bakkot@irc"},
{"content":{"body":"ah ok wait. scripts/auto-deploy.sh does run build-travis","msgtype":"m.text"},"ts":1614634693000,"senderName":"ljharb","senderId":"ljharb@irc"},
{"content":{"body":"ahh","msgtype":"m.text"},"ts":1614634700000,"senderName":"bakkot","senderId":"bakkot@irc"},
{"content":{"body":"so (－‸ლ) this is even more fun. part of the script is `git checkout es2020`, so it simply won't pick up the meta fixes unless i push them there","msgtype":"m.text"},"ts":1614634896000,"senderName":"ljharb","senderId":"ljharb@irc"},
{"content":{"body":"i remember now. that's why i wanted travis-scripts to not always replace the entire branch - so i didn't have to rebuild old years every time","msgtype":"m.text"},"ts":1614634964000,"senderName":"ljharb","senderId":"ljharb@irc"},
{"content":{"body":"ah","msgtype":"m.text"},"ts":1614635010000,"senderName":"bakkot","senderId":"bakkot@irc"},
{"content":{"body":"but it does not run `npm i` so it will use the modern version of ecmarkup","msgtype":"m.text"},"ts":1614635038000,"senderName":"bakkot","senderId":"bakkot@irc"},
{"content":{"body":"which is bad probably","msgtype":"m.text"},"ts":1614635042000,"senderName":"bakkot","senderId":"bakkot@irc"},
{"content":{"body":"I like the \"just commit all the files to a branch\" idea","msgtype":"m.text"},"ts":1614635048000,"senderName":"bakkot","senderId":"bakkot@irc"},
{"content":{"body":"all the files from old years, that is","msgtype":"m.text"},"ts":1614635065000,"senderName":"bakkot","senderId":"bakkot@irc"},
{"content":{"body":"lol and travis-scripts is now apparently deprecated?","msgtype":"m.text"},"ts":1614635118000,"senderName":"bakkot","senderId":"bakkot@irc"},
{"content":{"body":"the bitrot is real","msgtype":"m.text"},"ts":1614635125000,"senderName":"bakkot","senderId":"bakkot@irc"},
{"content":{"body":"exactly","msgtype":"m.text"},"ts":1614635172000,"senderName":"ljharb","senderId":"ljharb@irc"},
{"content":{"body":"and yeah travis-scripts is deprecated because travis is effectively dead. which is reasonable.","msgtype":"m.text"},"ts":1614635182000,"senderName":"ljharb","senderId":"ljharb@irc"},
{"content":{"body":"so i think the appropriate path is to build a github actions script that can tack onto an existing gh-pages branch; and then build a command that's run on the push of an `esYYYY` branch that updates that dir in the gh-pages branch, and then manually update the old year branches","msgtype":"m.text"},"ts":1614635237000,"senderName":"ljharb","senderId":"ljharb@irc"},
{"content":{"body":"then old ones never get changed and new ones get autoupdated","msgtype":"m.text"},"ts":1614635245000,"senderName":"ljharb","senderId":"ljharb@irc"},
{"content":{"body":"(unless you have a better idea ofc)","msgtype":"m.text"},"ts":1614635265000,"senderName":"ljharb","senderId":"ljharb@irc"},
{"content":{"body":"\"manually update the old year branches\" meaning, once a year when we do a release (and shortly after while backporting fixes)?","msgtype":"m.text"},"ts":1614635333000,"senderName":"bakkot","senderId":"bakkot@irc"},
{"content":{"body":"or do you just mean, while setting this up you'd make those dirs manually?","msgtype":"m.text"},"ts":1614635378000,"senderName":"bakkot","senderId":"bakkot@irc"},
{"content":{"body":"the latter","msgtype":"m.text"},"ts":1614635381000,"senderName":"ljharb","senderId":"ljharb@irc"},
{"content":{"body":"sgtm","msgtype":"m.text"},"ts":1614635389000,"senderName":"bakkot","senderId":"bakkot@irc"},
{"content":{"body":"but, it'd be setup to automatically handle it once a year when we do a release (and with backports)","msgtype":"m.text"},"ts":1614635399000,"senderName":"ljharb","senderId":"ljharb@irc"},
{"content":{"body":"don't know if automating that part is worthwhile, given that it happens pretty rarely, but I agree it's the ideal solution","msgtype":"m.text"},"ts":1614635439000,"senderName":"bakkot","senderId":"bakkot@irc"},
{"content":{"body":"it avoids the scenario where a backport forgets to update the year build","msgtype":"m.text"},"ts":1614635565000,"senderName":"ljharb","senderId":"ljharb@irc"},
{"content":{"body":"yeah","msgtype":"m.text"},"ts":1614635573000,"senderName":"bakkot","senderId":"bakkot@irc"},
{"content":{"body":"it's definitely better I just don't know that it happens enough to bother with","msgtype":"m.text"},"ts":1614635597000,"senderName":"bakkot","senderId":"bakkot@irc"},
{"content":{"body":"but hey if you want to write that part I'm certainly not going to object","msgtype":"m.text"},"ts":1614635606000,"senderName":"bakkot","senderId":"bakkot@irc"},
{"content":{"body":"ha, fair","msgtype":"m.text"},"ts":1614635621000,"senderName":"ljharb","senderId":"ljharb@irc"},
{"content":{"body":"so, just to recap: we'll have the gh-pages branch which has all past year build artifacts committed, as well as the latest build artifact from master, and whenever master or esYYYY is updated it will 1) check out the just-updated branch 2) run `npm run build`, 3) `git checkout gh-pages && git checkout es${YEAR} -- out && mv out/* es${YEAR}/ && git add . && git commit --amend --no-edit && git push --force`","msgtype":"m.text"},"ts":1614636153000,"senderName":"bakkot","senderId":"bakkot@irc"},
{"content":{"body":"I guess with appropriate tweak for step 3 to handle master","msgtype":"m.text"},"ts":1614636168000,"senderName":"bakkot","senderId":"bakkot@irc"},
{"content":{"body":"or, wait","msgtype":"m.text"},"ts":1614636178000,"senderName":"bakkot","senderId":"bakkot@irc"},
{"content":{"body":"not quite that","msgtype":"m.text"},"ts":1614636180000,"senderName":"bakkot","senderId":"bakkot@irc"},
{"content":{"body":"delete the `git checkout es${YEAR} -- out` one since that isn't committed","msgtype":"m.text"},"ts":1614636204000,"senderName":"bakkot","senderId":"bakkot@irc"},
{"content":{"body":"`git checkout gh-pages && mv out/* es${YEAR}/ && git add . && git commit --amend --no-edit && git push --force`","msgtype":"m.text"},"ts":1614636225000,"senderName":"bakkot","senderId":"bakkot@irc"},
{"content":{"body":"right","msgtype":"m.text"},"ts":1614636243000,"senderName":"ljharb","senderId":"ljharb@irc"},
{"content":{"body":"or `git checkout gh-pages && mv out/* ./ && git add . && git commit --amend --no-edit && git push --force` in the case of master","msgtype":"m.text"},"ts":1614636246000,"senderName":"bakkot","senderId":"bakkot@irc"},
{"content":{"body":"sgtm","msgtype":"m.text"},"ts":1614636250000,"senderName":"bakkot","senderId":"bakkot@irc"},
{"content":{"body":"is https://github.com/tc39/ecma262/pull/2337 worth landing in the mean time, do you figure?","msgtype":"m.text"},"ts":1614637417000,"senderName":"bakkot","senderId":"bakkot@irc"},
{"content":{"body":"yeah, i think probably so. it's a useful refactor","msgtype":"m.text"},"ts":1614637774000,"senderName":"ljharb","senderId":"ljharb@irc"}
]
[
{"content":{"body":"this is pretty small pain, just search for addEventListener and message","msgtype":"m.text"},"ts":1209254400000,"senderName":"jwalden","senderId":"jwalden@irc"},
{"content":{"body":"so it's not too bad","msgtype":"m.text"},"ts":1209254401000,"senderName":"jwalden","senderId":"jwalden@irc"},
{"content":{"body":"and indeed, I think I'm done making the changes now :-)","msgtype":"m.text"},"ts":1209255060000,"senderName":"jwalden","senderId":"jwalden@irc"},
{"content":{"body":"nearly, at least","msgtype":"m.text"},"ts":1209255120000,"senderName":"jwalden","senderId":"jwalden@irc"},
{"content":{"body":"curses multiple inheritance ambiguity","msgtype":"m.emote"},"ts":1209255121000,"senderName":"jwalden","senderId":"jwalden@irc"},
{"content":{"body":"cool","msgtype":"m.text"},"ts":1209256920000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"i'm playing twilight imperium 3 right now","msgtype":"m.text"},"ts":1209256921000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"but when i get back home i'll send mail about it","msgtype":"m.text"},"ts":1209256922000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"heh","msgtype":"m.text"},"ts":1209256923000,"senderName":"jwalden","senderId":"jwalden@irc"},
{"content":{"body":"thanks","msgtype":"m.text"},"ts":1209256980000,"senderName":"jwalden","senderId":"jwalden@irc"},
{"content":{"body":"waits for recompile","msgtype":"m.emote"},"ts":1209256981000,"senderName":"jwalden","senderId":"jwalden@irc"},
{"content":{"body":"othermaciej: it's not so much the timing of the late-breaking changes that makes me sad as that they're going to make it very, very, very hard for anything like the original circumstances where postMessage got approval to land so late to ever happen again","msgtype":"m.text"},"ts":1209257100000,"senderName":"jwalden","senderId":"jwalden@irc"},
{"content":{"body":"othermaciej: I think if people had known the two sets of changes were going to happen after that, they'd have said no","msgtype":"m.text"},"ts":1209257101000,"senderName":"jwalden","senderId":"jwalden@irc"},
{"content":{"body":"heck, *I* might even have said no","msgtype":"m.text"},"ts":1209257102000,"senderName":"jwalden","senderId":"jwalden@irc"},
{"content":{"body":"jwalden: I probably would have said yes to the postMessage work before Safari 3.1 even if I had known it would be followed by changes, because I think that level of engagement was part of what led to the changes","msgtype":"m.text"},"ts":1209257160000,"senderName":"othermaciej","senderId":"othermaciej@irc"},
{"content":{"body":"(and I think the changes that made us pull it were for the better)","msgtype":"m.text"},"ts":1209257161000,"senderName":"othermaciej","senderId":"othermaciej@irc"},
{"content":{"body":"I do understand that implementing features against an unstable spec, especially late in a dev cycle, can be disruptive","msgtype":"m.text"},"ts":1209257220000,"senderName":"othermaciej","senderId":"othermaciej@irc"},
{"content":{"body":"I had the work all done for several months; it just wasn't in the tree because we were \"past\" feature freeze","msgtype":"m.text"},"ts":1209257221000,"senderName":"jwalden","senderId":"jwalden@irc"},
{"content":{"body":"I don't mind the implementation","msgtype":"m.text"},"ts":1209257222000,"senderName":"jwalden","senderId":"jwalden@irc"},
{"content":{"body":"jwalden: If the feature wasn't approved for FF3, how long would it be before it could be in a release?","msgtype":"m.text"},"ts":1209257223000,"senderName":"Philip`","senderId":"Philip`@irc"},
{"content":{"body":"I don't know","msgtype":"m.text"},"ts":1209257224000,"senderName":"jwalden","senderId":"jwalden@irc"},
{"content":{"body":"that's the other half of the matter","msgtype":"m.text"},"ts":1209257225000,"senderName":"jwalden","senderId":"jwalden@irc"},
{"content":{"body":"as I understand it .next is supposed to be a quick turnaround, but I don't know how quick","msgtype":"m.text"},"ts":1209257226000,"senderName":"jwalden","senderId":"jwalden@irc"},
{"content":{"body":"Is .next different from Mozilla 2?","msgtype":"m.text"},"ts":1209257280000,"senderName":"Philip`","senderId":"Philip`@irc"},
{"content":{"body":"I *think* so","msgtype":"m.text"},"ts":1209257281000,"senderName":"jwalden","senderId":"jwalden@irc"},
{"content":{"body":"Mozilla 2 has never sounded particularly likely for quick turnaround to me","msgtype":"m.text"},"ts":1209257282000,"senderName":"Philip`","senderId":"Philip`@irc"},
{"content":{"body":"a 3.5, so to speak, with a few cherry-picked things","msgtype":"m.text"},"ts":1209257283000,"senderName":"jwalden","senderId":"jwalden@irc"},
{"content":{"body":"for Safari/WebKit I am expecting gaps of less than a year between releases with new engine features for the foreseeable future","msgtype":"m.text"},"ts":1209257284000,"senderName":"othermaciej","senderId":"othermaciej@irc"},
{"content":{"body":"The whole \"let's (automatically) rewrite all our code and change all our APIs\" thing makes me a little nervous","msgtype":"m.text"},"ts":1209257285000,"senderName":"Philip`","senderId":"Philip`@irc"},
{"content":{"body":"if it's not different from 2, then it's not a quick turnaround","msgtype":"m.text"},"ts":1209257286000,"senderName":"jwalden","senderId":"jwalden@irc"},
{"content":{"body":"the change APIs thing is more, \"we'll change where we've needed to change\"","msgtype":"m.text"},"ts":1209257340000,"senderName":"jwalden","senderId":"jwalden@irc"},
{"content":{"body":"Mozilla 2 work is being scoped back beyond the vague \"rewrite everything\" plans from 2 years ago","msgtype":"m.text"},"ts":1209257341000,"senderName":"gavin_","senderId":"gavin_@irc"},
{"content":{"body":"wonders if he might get canvas shadows into 3.5 :-)","msgtype":"m.emote"},"ts":1209257342000,"senderName":"Philip`","senderId":"Philip`@irc"},
{"content":{"body":"but yeah, I'm still not clear on exactly how everything's panning out","msgtype":"m.text"},"ts":1209257343000,"senderName":"jwalden","senderId":"jwalden@irc"},
{"content":{"body":"and, that's expected, really","msgtype":"m.text"},"ts":1209257344000,"senderName":"gavin_","senderId":"gavin_@irc"},
{"content":{"body":"Philip`: almost certainly","msgtype":"m.text"},"ts":1209257345000,"senderName":"gavin_","senderId":"gavin_@irc"},
{"content":{"body":"reasonably self-contained feature-size things are generally what's in the plans","msgtype":"m.text"},"ts":1209257400000,"senderName":"jwalden","senderId":"jwalden@irc"},
{"content":{"body":"Hmm, I did the shadow thing six months ago - I didn't realise it was that long :-/","msgtype":"m.text"},"ts":1209257401000,"senderName":"Philip`","senderId":"Philip`@irc"},
{"content":{"body":"(and apparently it was feature freeze back then)","msgtype":"m.text"},"ts":1209257460000,"senderName":"Philip`","senderId":"Philip`@irc"},
{"content":{"body":"so the 100K patch that adds stuff and doesn't have twisty interactions but is just too late to trust, is the prototypical \"take\"","msgtype":"m.text"},"ts":1209257461000,"senderName":"jwalden","senderId":"jwalden@irc"},
{"content":{"body":"but no fundamental reworkings of anything","msgtype":"m.text"},"ts":1209257462000,"senderName":"jwalden","senderId":"jwalden@irc"},
{"content":{"body":"That sounds quite sensible","msgtype":"m.text"},"ts":1209257463000,"senderName":"Philip`","senderId":"Philip`@irc"},
{"content":{"body":"Hooray, I used the scientific method today","msgtype":"m.text"},"ts":1209258840000,"senderName":"Philip`","senderId":"Philip`@irc"},
{"content":{"body":"There were about a hundred small flying insects sitting on the ceiling by the light above my bed this evening, so I hypothesised that they were attracted by lights","msgtype":"m.text"},"ts":1209258900000,"senderName":"Philip`","senderId":"Philip`@irc"},
{"content":{"body":"so I turned that light off and pointed a desk lamp at a wall as far away as possible (about two metres) from my bed, and after several hours they've nearly all migrated to that wall","msgtype":"m.text"},"ts":1209258960000,"senderName":"Philip`","senderId":"Philip`@irc"},
{"content":{"body":"so I think I'll consider my hypothesis to be true","msgtype":"m.text"},"ts":1209258961000,"senderName":"Philip`","senderId":"Philip`@irc"},
{"content":{"body":"Also it means I can go to bed without being scared of insects dropping onto my head","msgtype":"m.text"},"ts":1209258962000,"senderName":"Philip`","senderId":"Philip`@irc"},
{"content":{"body":"you can consider your hypothesis not falsified by your experiment","msgtype":"m.text"},"ts":1209259020000,"senderName":"othermaciej_","senderId":"othermaciej_@irc"},
{"content":{"body":"(if you wanna be hardcore scientific method)","msgtype":"m.text"},"ts":1209259021000,"senderName":"othermaciej_","senderId":"othermaciej_@irc"},
{"content":{"body":"I don't want to be that hardcore - I like to be able to believe that at least some things in this world are true, and aren't merely not known to be false :-)","msgtype":"m.text"},"ts":1209259022000,"senderName":"Philip`","senderId":"Philip`@irc"},
{"content":{"body":"https://bugs.webkit.org/show_bug.cgi?id=18762#c2 - oops, I guess I should have checked that","msgtype":"m.text"},"ts":1209263280000,"senderName":"Philip`","senderId":"Philip`@irc"},
{"content":{"body":"Philip`: :)","msgtype":"m.text"},"ts":1209264240000,"senderName":"weinig","senderId":"weinig@irc"},
{"content":{"body":"Philip`: it took me a couple minutes to notice as well","msgtype":"m.text"},"ts":1209264300000,"senderName":"weinig","senderId":"weinig@irc"},
{"content":{"body":"Philip`: still, that is a bad bug","msgtype":"m.text"},"ts":1209264301000,"senderName":"weinig","senderId":"weinig@irc"},
{"content":{"body":"weinig: I really should have realised that if it only had one yellow rectangle, the drawImage wasn't working","msgtype":"m.text"},"ts":1209264540000,"senderName":"Philip`","senderId":"Philip`@irc"},
{"content":{"body":"meh","msgtype":"m.text"},"ts":1209264600000,"senderName":"weinig","senderId":"weinig@irc"},
{"content":{"body":"Philip`: that is my job :)","msgtype":"m.text"},"ts":1209264601000,"senderName":"weinig","senderId":"weinig@irc"},
{"content":{"body":"At least it is an actual bug, so I can still legitimately complain about it :-)","msgtype":"m.text"},"ts":1209264602000,"senderName":"Philip`","senderId":"Philip`@irc"},
{"content":{"body":":)","msgtype":"m.text"},"ts":1209264603000,"senderName":"weinig","senderId":"weinig@irc"},
{"content":{"body":"man, philip is still complaining about canvas","msgtype":"m.text"},"ts":1209265380000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"i'm pretty sure that by now the spec has been fixed so many times because of his feedback that his complaints are actually complaints on his own earlier suggestions","msgtype":"m.text"},"ts":1209265440000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"You could have a live re-enactment of this one: http://ansuz.sooke.bc.ca/bonobo-conspiracy/?i=926","msgtype":"m.text"},"ts":1209266220000,"senderName":"Dashiva","senderId":"Dashiva@irc"},
{"content":{"body":"Hixie: I think some of the cases are where I originally suggested something far too complex, and you changed the spec to say something near that but slightly too simple, so more feedback is needed, and hopefully it'll stop oscillating and settle on something nearly correct :-)","msgtype":"m.text"},"ts":1209266340000,"senderName":"Philip`","senderId":"Philip`@irc"},
{"content":{"body":":-)","msgtype":"m.text"},"ts":1209266341000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"but sometimes I just change my mind and disagree with my former self","msgtype":"m.text"},"ts":1209266400000,"senderName":"Philip`","senderId":"Philip`@irc"},
{"content":{"body":"and sometimes I disagree with my current self, but that's harder to sort out","msgtype":"m.text"},"ts":1209266401000,"senderName":"Philip`","senderId":"Philip`@irc"},
{"content":{"body":"Hello all","msgtype":"m.text"},"ts":1209270000000,"senderName":"htmlfivedotnet","senderId":"htmlfivedotnet@irc"},
{"content":{"body":"I think that most on this channel are on a different time zone than me, and probably asleep by now, but I saw some grievance about my site, and wanted to settle it with those directly involved. Any and all problems or issues I am more than happy to fix ","msgtype":"m.text"},"ts":1209270240000,"senderName":"htmlfivedotnet","senderId":"htmlfivedotnet@irc"},
{"content":{"body":"heya","msgtype":"m.text"},"ts":1209271080000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"i think so long as you comply with the license and give clear attribution, nobody is too worried","msgtype":"m.text"},"ts":1209271081000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"also if you make money you should send us some goodies as thanks :-D","msgtype":"m.text"},"ts":1209271082000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"after I saw annevk had already found my site, two days after purchase, i made sure to put that info at the top, as I saw you guys notice. It isn't that I hadn't planned to do so, it's just that it was and is still a WIP. ","msgtype":"m.text"},"ts":1209271260000,"senderName":"htmlfivedotnet","senderId":"htmlfivedotnet@irc"},
{"content":{"body":"It looks like I'm going to have to modify the plugin to post the correct date, and have the correct linkback to the original post... which seems like it's going to be harder to do than i hoped","msgtype":"m.text"},"ts":1209271261000,"senderName":"htmlfivedotnet","senderId":"htmlfivedotnet@irc"},
{"content":{"body":"heh","msgtype":"m.text"},"ts":1209271380000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"welcome btw :-)","msgtype":"m.text"},"ts":1209271440000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"hey, thanks :-)","msgtype":"m.text"},"ts":1209271500000,"senderName":"htmlfivedotnet","senderId":"htmlfivedotnet@irc"},
{"content":{"body":"so am i missing something, or is this where the authors and contributors get together to discuss html5?","msgtype":"m.text"},"ts":1209271740000,"senderName":"htmlfivedotnet","senderId":"htmlfivedotnet@irc"},
{"content":{"body":"yup, this is the whatwg irc channel","msgtype":"m.text"},"ts":1209271741000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"but it's a weekend","msgtype":"m.text"},"ts":1209271742000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"and 5am in europe","msgtype":"m.text"},"ts":1209271743000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"it sure is. that's a shame, I do my work at night. Hopefully I can still contribute in some way. ","msgtype":"m.text"},"ts":1209271920000,"senderName":"htmlfivedotnet","senderId":"htmlfivedotnet@irc"},
{"content":{"body":"Hmm, browsing through the XTech schedule I find this: http://2008.xtech.org/public/schedule/detail/653","msgtype":"m.text"},"ts":1209286620000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"That could be fun...","msgtype":"m.text"},"ts":1209286621000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"i wish we could boil the oceans","msgtype":"m.text"},"ts":1209286680000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"it would make the web such an easier place to code","msgtype":"m.text"},"ts":1209286681000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"and silverlight is a much better boil-the-oceans solution than xhtml+xforms+svg, for sure","msgtype":"m.text"},"ts":1209286740000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"hey htmlfivedotnet, welcome.","msgtype":"m.text"},"ts":1209289140000,"senderName":"Lachy","senderId":"Lachy@irc"},
{"content":{"body":"http://www.whatwg.org/specs/web-apps/current-work/#dialogs","msgtype":"m.text"},"ts":1209289800000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"is there any <audio> hacks with Flash, in order to playback mp3/oggs in \"legacy\" browsers?","msgtype":"m.text"},"ts":1209292800000,"senderName":"hendry","senderId":"hendry@irc"},
{"content":{"body":"Philip`: so far it seems that switch-case block per tokenizer state is insanely bad on Java 5 PowerPC HotSpot client VM","msgtype":"m.text"},"ts":1209292860000,"senderName":"hsivonen","senderId":"hsivonen@irc"},
{"content":{"body":"like makes-you-want-to-cry bad","msgtype":"m.text"},"ts":1209292861000,"senderName":"hsivonen","senderId":"hsivonen@irc"},
{"content":{"body":"there should be like a 30x perf gain if the compiler did the right thing","msgtype":"m.text"},"ts":1209292980000,"senderName":"hsivonen","senderId":"hsivonen@irc"},
{"content":{"body":"Conceptually, both return and switch on enum should compile into a jump to an address","msgtype":"m.text"},"ts":1209293640000,"senderName":"hsivonen","senderId":"hsivonen@irc"},
{"content":{"body":"but it seems switch on enum is ridiculously slower than return","msgtype":"m.text"},"ts":1209293700000,"senderName":"hsivonen","senderId":"hsivonen@irc"},
{"content":{"body":"hmm. after googling, I find that on Sun HotSpot 5, switch on enum is insanely bad compared to switch on int","msgtype":"m.text"},"ts":1209294780000,"senderName":"hsivonen","senderId":"hsivonen@irc"},
{"content":{"body":"hsivonen: I've always assumed that enums are basically lists of static objects, so enum values are pointers and are only determined at runtime and it'd have to compile into \"if (value == ONE) ... else if (value == TWO) ...\" (or a binary search if the optimiser was really clever), so it makes some sense that that's much slower than a compile-time non-sparse integer switch table","msgtype":"m.text"},"ts":1209295500000,"senderName":"Philip`","senderId":"Philip`@irc"},
{"content":{"body":"but my assumptions could be horribly wrong","msgtype":"m.text"},"ts":1209295501000,"senderName":"Philip`","senderId":"Philip`@irc"},
{"content":{"body":"and I've never known how to attempt to validate my assumptions about how the JVM works :-(","msgtype":"m.text"},"ts":1209295502000,"senderName":"Philip`","senderId":"Philip`@irc"},
{"content":{"body":"Philip`: for switch enums map to ints. (check out 'ordinal' in a debugger)","msgtype":"m.text"},"ts":1209295560000,"senderName":"hsivonen","senderId":"hsivonen@irc"},
{"content":{"body":"Philip`: but it seems that the VM gets an array of the ordinals every time it enters the switch or something similarly insane","msgtype":"m.text"},"ts":1209295561000,"senderName":"hsivonen","senderId":"hsivonen@irc"},
{"content":{"body":"Ah, okay","msgtype":"m.text"},"ts":1209295620000,"senderName":"Philip`","senderId":"Philip`@irc"},
{"content":{"body":"Hixie: Did you change the IE icon used by the spec status annotation thing? (http://msdn2.microsoft.com/en-us/library/ms535205.new(en-us,VS.85).gif is now a star thing, which doesn't look like IE at all)","msgtype":"m.text"},"ts":1209295680000,"senderName":"Philip`","senderId":"Philip`@irc"},
{"content":{"body":"Philip`: anyway, the code I wrote should have been the best-performing alternative if switch on enum was like jump to an address held in a variable","msgtype":"m.text"},"ts":1209295681000,"senderName":"hsivonen","senderId":"hsivonen@irc"},
{"content":{"body":"but it's nothing of the sort","msgtype":"m.text"},"ts":1209295740000,"senderName":"hsivonen","senderId":"hsivonen@irc"},
{"content":{"body":"installed hardy","msgtype":"m.text"},"ts":1209295741000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"so now I have to refactor some more with the assumption that using 'return' is a big win","msgtype":"m.text"},"ts":1209295742000,"senderName":"hsivonen","senderId":"hsivonen@irc"},
{"content":{"body":"apart from the bird i don't notice anything new","msgtype":"m.text"},"ts":1209295743000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"installed hardy on Parallels","msgtype":"m.emote"},"ts":1209295744000,"senderName":"hsivonen","senderId":"hsivonen@irc"},
{"content":{"body":"hsivonen: Can't you switch on int, if that isn't so slow?","msgtype":"m.text"},"ts":1209295800000,"senderName":"Philip`","senderId":"Philip`@irc"},
{"content":{"body":"Philip`: I'm going to ints right about now","msgtype":"m.text"},"ts":1209295801000,"senderName":"hsivonen","senderId":"hsivonen@irc"},
{"content":{"body":"Okay - it'll be interesting to see what happens :-)","msgtype":"m.text"},"ts":1209295802000,"senderName":"Philip`","senderId":"Philip`@irc"},
{"content":{"body":"ipodtouch update for 18 EUR is pretty neat","msgtype":"m.text"},"ts":1209295980000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"Hixie, maybe you should add a note that the \"features\" argument is not defined/used?","msgtype":"m.text"},"ts":1209296100000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"Philip`: avoiding enum gives me an 8% boost on Java 5 PPC client","msgtype":"m.text"},"ts":1209296400000,"senderName":"hsivonen","senderId":"hsivonen@irc"},
{"content":{"body":"the overall perf still sucks big time","msgtype":"m.text"},"ts":1209296401000,"senderName":"hsivonen","senderId":"hsivonen@irc"},
{"content":{"body":"hsivonen: Hmm, that doesn't sound fantastic","msgtype":"m.text"},"ts":1209296402000,"senderName":"Philip`","senderId":"Philip`@irc"},
{"content":{"body":"wonders why it's so slow","msgtype":"m.emote"},"ts":1209296460000,"senderName":"Philip`","senderId":"Philip`@irc"},
{"content":{"body":"looks like I should make read() a method again, so that the VM can do a fast jump on return","msgtype":"m.text"},"ts":1209296461000,"senderName":"hsivonen","senderId":"hsivonen@irc"},
{"content":{"body":"Do you have a profiler that can tell you where the JVM is spending all its time?","msgtype":"m.text"},"ts":1209296462000,"senderName":"Philip`","senderId":"Philip`@irc"},
{"content":{"body":"given that switch seems to suck badly","msgtype":"m.text"},"ts":1209296463000,"senderName":"hsivonen","senderId":"hsivonen@irc"},
{"content":{"body":"Philip`: I do","msgtype":"m.text"},"ts":1209296464000,"senderName":"hsivonen","senderId":"hsivonen@irc"},
{"content":{"body":"(I know VTune can do that, but the output always seems pretty confusing, particularly since the program keeps getting recompiled at runtime)","msgtype":"m.text"},"ts":1209296520000,"senderName":"Philip`","senderId":"Philip`@irc"},
{"content":{"body":"also, if switch is expensive, I should probably reintroduce for(;;) { ... continue; ...} for staying in a state","msgtype":"m.text"},"ts":1209296580000,"senderName":"hsivonen","senderId":"hsivonen@irc"},
{"content":{"body":"if I make read a method again, that would be doable again","msgtype":"m.text"},"ts":1209296581000,"senderName":"hsivonen","senderId":"hsivonen@irc"},
{"content":{"body":"I want me some goto with memory address variables","msgtype":"m.text"},"ts":1209296582000,"senderName":"hsivonen","senderId":"hsivonen@irc"},
{"content":{"body":"How would that work, when the JIT can keep changing the address of the code to execute?","msgtype":"m.text"},"ts":1209296640000,"senderName":"Philip`","senderId":"Philip`@irc"},
{"content":{"body":"pointers?","msgtype":"m.text"},"ts":1209296641000,"senderName":"hsivonen","senderId":"hsivonen@irc"},
{"content":{"body":"Pointers to what?","msgtype":"m.text"},"ts":1209296700000,"senderName":"Philip`","senderId":"Philip`@irc"},
{"content":{"body":"pointers to VM managed code memory addresses","msgtype":"m.text"},"ts":1209296701000,"senderName":"hsivonen","senderId":"hsivonen@irc"},
{"content":{"body":"Ah, that sounds plausible","msgtype":"m.text"},"ts":1209296702000,"senderName":"Philip`","senderId":"Philip`@irc"},
{"content":{"body":"it sucks how much juggling is needed to get fast jumps without goto","msgtype":"m.text"},"ts":1209296820000,"senderName":"hsivonen","senderId":"hsivonen@irc"},
{"content":{"body":"particularly is switch is not part of the arsenal","msgtype":"m.text"},"ts":1209296821000,"senderName":"hsivonen","senderId":"hsivonen@irc"},
{"content":{"body":"switch is fast in C++ :-)","msgtype":"m.text"},"ts":1209296822000,"senderName":"Philip`","senderId":"Philip`@irc"},
{"content":{"body":"it could well be that the code I now would be fast in a line-by-line port to C++","msgtype":"m.text"},"ts":1209296880000,"senderName":"hsivonen","senderId":"hsivonen@irc"},
{"content":{"body":"I think I'm going to have to introduce duplicate code for states that can be entered with both \"consume\" and \"reconsume\" :-(","msgtype":"m.text"},"ts":1209297000000,"senderName":"hsivonen","senderId":"hsivonen@irc"},
{"content":{"body":"unless I split out methods","msgtype":"m.text"},"ts":1209297001000,"senderName":"hsivonen","senderId":"hsivonen@irc"},
{"content":{"body":"it also sucks that all kinds of config affects read()","msgtype":"m.text"},"ts":1209297120000,"senderName":"hsivonen","senderId":"hsivonen@irc"},
{"content":{"body":"so read() is full of conditionals","msgtype":"m.text"},"ts":1209297121000,"senderName":"hsivonen","senderId":"hsivonen@irc"},
{"content":{"body":"I bet this would be so much faster if the parser config happened at compile time","msgtype":"m.text"},"ts":1209297122000,"senderName":"hsivonen","senderId":"hsivonen@irc"},
{"content":{"body":"perhaps I should have an abstract class with read() and subclasses with implementation for each config combo..","msgtype":"m.text"},"ts":1209297240000,"senderName":"hsivonen","senderId":"hsivonen@irc"},
{"content":{"body":"is too used to C++, where virtual methods are scary and slow","msgtype":"m.emote"},"ts":1209297300000,"senderName":"Philip`","senderId":"Philip`@irc"},
{"content":{"body":"or at least I should make the conditionals on final booleans instead of non-final enums","msgtype":"m.text"},"ts":1209297360000,"senderName":"hsivonen","senderId":"hsivonen@irc"},
{"content":{"body":"but modern CPUs are too clever and have too many caches and things, so things I thought were true five years ago are even less likely to be actually true now :-(","msgtype":"m.text"},"ts":1209297361000,"senderName":"Philip`","senderId":"Philip`@irc"},
{"content":{"body":"although in ifs enum compare should be memory address compare","msgtype":"m.text"},"ts":1209297362000,"senderName":"hsivonen","senderId":"hsivonen@irc"},
{"content":{"body":"if anything, all this shows that HotSpot doesn't magically make any code fast but different refactoring do affect perf","msgtype":"m.text"},"ts":1209297420000,"senderName":"hsivonen","senderId":"hsivonen@irc"},
{"content":{"body":"You just need to wait for the next version of HotSpot, which will magically make everything faster than C++","msgtype":"m.text"},"ts":1209297900000,"senderName":"Philip`","senderId":"Philip`@irc"},
{"content":{"body":"Actually, the above was on PPC HotSpot 5","msgtype":"m.text"},"ts":1209297901000,"senderName":"hsivonen","senderId":"hsivonen@irc"},
{"content":{"body":"next, I'm going to run test on x86 HotSpot 7ish","msgtype":"m.text"},"ts":1209297960000,"senderName":"hsivonen","senderId":"hsivonen@irc"},
{"content":{"body":"Regardless of the version, it's always the next one that'll make code fast","msgtype":"m.text"},"ts":1209297961000,"senderName":"Philip`","senderId":"Philip`@irc"},
{"content":{"body":"I installed icedtea under Parallels","msgtype":"m.text"},"ts":1209297962000,"senderName":"hsivonen","senderId":"hsivonen@irc"},
{"content":{"body":"I wouldn't care if this was about as fast as Xerces, but it used to be 50% of Xerces perf","msgtype":"m.text"},"ts":1209298020000,"senderName":"hsivonen","senderId":"hsivonen@irc"},
{"content":{"body":"and now it's 5% of Xerces perf","msgtype":"m.text"},"ts":1209298021000,"senderName":"hsivonen","senderId":"hsivonen@irc"},
{"content":{"body":"so I think I should be able to do something that gives a ten-fold boost again","msgtype":"m.text"},"ts":1209298080000,"senderName":"hsivonen","senderId":"hsivonen@irc"},
{"content":{"body":"Something other than 'svn revert'?","msgtype":"m.text"},"ts":1209298081000,"senderName":"Philip`","senderId":"Philip`@irc"},
{"content":{"body":"yeah. I want something that preserves desirable characteristics of this refactoring","msgtype":"m.text"},"ts":1209298082000,"senderName":"hsivonen","senderId":"hsivonen@irc"},
{"content":{"body":"but anyway, I now very much sympathize with Antlr devs wanting to go straight to bytecode","msgtype":"m.text"},"ts":1209298320000,"senderName":"hsivonen","senderId":"hsivonen@irc"},
{"content":{"body":"also, I now understand why Java XML parsers have a ton of methods instead of a huge switch","msgtype":"m.text"},"ts":1209298380000,"senderName":"hsivonen","senderId":"hsivonen@irc"},
{"content":{"body":"I wonder if using exception to break a loop is still bad","msgtype":"m.text"},"ts":1209298500000,"senderName":"hsivonen","senderId":"hsivonen@irc"},
{"content":{"body":"I'm pretty sure exceptions are an area where Java beats C++, but that's because C++ is rubbish at them and I have no idea how significantly less rubbish Java is :-)","msgtype":"m.text"},"ts":1209298560000,"senderName":"Philip`","senderId":"Philip`@irc"},
{"content":{"body":"the tokenizer loop already has to be prepared to exit on ArrayIndexOutOfBoundsException, so I wonder if an additional exception is costly","msgtype":"m.text"},"ts":1209298680000,"senderName":"hsivonen","senderId":"hsivonen@irc"},
{"content":{"body":"I wonder if JVM hacker would be amused at this IRC log of discovery of what sucks and what doesn't suck on HotSpot","msgtype":"m.text"},"ts":1209298681000,"senderName":"hsivonen","senderId":"hsivonen@irc"},
{"content":{"body":"Xerces-C has a particularly annoying issue where it throws an EndOfEntityException while parsing an XML file, and the Visual Studio deugger prints a message to the debug window whenever an exception is thrown, and the debug window is immensely slow (like ~10ms to print a single line), which makes anything using Xerces a lot go very slowly while debugging","msgtype":"m.text"},"ts":1209298740000,"senderName":"Philip`","senderId":"Philip`@irc"},
{"content":{"body":"(I want to replace Xerces with a nicer XML parser in that program, but the problems are hidden for now since all the parsed XML gets cached into some custom binary-XML format, and there are always other more useful things to work on before replacing the XML parser...)","msgtype":"m.text"},"ts":1209299040000,"senderName":"Philip`","senderId":"Philip`@irc"},
{"content":{"body":"My test harness is available from http://about.validator.nu/htmlparser/perf.zip","msgtype":"m.text"},"ts":1209300420000,"senderName":"hsivonen","senderId":"hsivonen@irc"},
{"content":{"body":"is upgrading blog.whatwg.org","msgtype":"m.emote"},"ts":1209301080000,"senderName":"Lachy","senderId":"Lachy@irc"},
{"content":{"body":"WP 2.5 is awesome","msgtype":"m.text"},"ts":1209301200000,"senderName":"Lachy","senderId":"Lachy@irc"},
{"content":{"body":"let me know if anything went wrong with the upgrade","msgtype":"m.text"},"ts":1209301201000,"senderName":"Lachy","senderId":"Lachy@irc"},
{"content":{"body":"wow, it has automated plugin updating feature. All I have to do is click \"update automatically\" on each out of date plugin.","msgtype":"m.text"},"ts":1209301680000,"senderName":"Lachy","senderId":"Lachy@irc"},
{"content":{"body":"I reuploaded an updated perf harness","msgtype":"m.text"},"ts":1209302340000,"senderName":"hsivonen","senderId":"hsivonen@irc"},
{"content":{"body":"Lachy: Hopefully that's not the version of 2.5 that lets any user register and give themselves an admin account? :-)","msgtype":"m.text"},"ts":1209302820000,"senderName":"Philip`","senderId":"Philip`@irc"},
{"content":{"body":"OpenJDK 6 HotSpot running under Parallels on my MacBook is much faster than my PowerMac G5","msgtype":"m.text"},"ts":1209302880000,"senderName":"hsivonen","senderId":"hsivonen@irc"},
{"content":{"body":"What type of MacBook is that?","msgtype":"m.text"},"ts":1209302940000,"senderName":"Philip`","senderId":"Philip`@irc"},
{"content":{"body":"pro desktops get overtaken by non-pro laptops in under 3 years","msgtype":"m.text"},"ts":1209302941000,"senderName":"hsivonen","senderId":"hsivonen@irc"},
{"content":{"body":"Philip`: the middle one of the current lineup","msgtype":"m.text"},"ts":1209302942000,"senderName":"hsivonen","senderId":"hsivonen@irc"},
{"content":{"body":"2.4 GHz Core 2 Duo","msgtype":"m.text"},"ts":1209302943000,"senderName":"hsivonen","senderId":"hsivonen@irc"},
{"content":{"body":"Ah, that's a quite decent CPU :-)","msgtype":"m.text"},"ts":1209303000000,"senderName":"Philip`","senderId":"Philip`@irc"},
{"content":{"body":"the PowerMac is Dual 2.0 GHz G5","msgtype":"m.text"},"ts":1209303001000,"senderName":"hsivonen","senderId":"hsivonen@irc"},
{"content":{"body":"though is your performance testing thing using >1 core?","msgtype":"m.text"},"ts":1209303002000,"senderName":"Philip`","senderId":"Philip`@irc"},
{"content":{"body":"it's single-threaded","msgtype":"m.text"},"ts":1209303060000,"senderName":"hsivonen","senderId":"hsivonen@irc"},
{"content":{"body":"Philip`, it's the latest verstion available from wordpress.com","msgtype":"m.text"},"ts":1209303120000,"senderName":"Lachy","senderId":"Lachy@irc"},
{"content":{"body":"so hopefully the fixed that bug","msgtype":"m.text"},"ts":1209303121000,"senderName":"Lachy","senderId":"Lachy@irc"},
{"content":{"body":"Hmm, looks like (at least) the MBP lineup changed recently - the middle one was 2.4GHz/160GB not long ago, and is 2.5/250 now","msgtype":"m.text"},"ts":1209303180000,"senderName":"Philip`","senderId":"Philip`@irc"},
{"content":{"body":"wonders when that changed","msgtype":"m.emote"},"ts":1209303181000,"senderName":"Philip`","senderId":"Philip`@irc"},
{"content":{"body":"Oh, apparently two months ago","msgtype":"m.text"},"ts":1209303240000,"senderName":"Philip`","senderId":"Philip`@irc"},
{"content":{"body":"Philip`, yeah, that's when they added multitouch to the MBPs just like the new MBAs","msgtype":"m.text"},"ts":1209303300000,"senderName":"Lachy","senderId":"Lachy@irc"},
{"content":{"body":"Computers should stop getting better all the time :-(","msgtype":"m.text"},"ts":1209303301000,"senderName":"Philip`","senderId":"Philip`@irc"},
{"content":{"body":"Lachy: I'd be happy enough if they just made the touchpad less totally rubbish under Windows","msgtype":"m.text"},"ts":1209303360000,"senderName":"Philip`","senderId":"Philip`@irc"},
{"content":{"body":"Philip`, you shouldn't be running Windows on a Mac! That's just cruel.","msgtype":"m.text"},"ts":1209303420000,"senderName":"Lachy","senderId":"Lachy@irc"},
{"content":{"body":"Lachy: But OS X hasn't done anything to make me like it, and I want to play games :-)","msgtype":"m.text"},"ts":1209303421000,"senderName":"Philip`","senderId":"Philip`@irc"},
{"content":{"body":"but what's so rubbish about it?","msgtype":"m.text"},"ts":1209303422000,"senderName":"Lachy","senderId":"Lachy@irc"},
{"content":{"body":"except that it can be a bit slow and insensitive at times.","msgtype":"m.text"},"ts":1209303480000,"senderName":"Lachy","senderId":"Lachy@irc"},
{"content":{"body":"You can't touch to click; the scrolling thing is extremely sensitive to the orientation of your fingers, so it often goes up when you want it to go down; to right click you need two fingers and then click the button, but since the scrolling is very sensitive you end up scrolling instead of clicking","msgtype":"m.text"},"ts":1209303540000,"senderName":"Philip`","senderId":"Philip`@irc"},
{"content":{"body":"I'm not sure if it's even possible to middle-click","msgtype":"m.text"},"ts":1209303541000,"senderName":"Philip`","senderId":"Philip`@irc"},
{"content":{"body":"AFAIK, it's not possible to middle click on any touchpad","msgtype":"m.text"},"ts":1209303600000,"senderName":"Lachy","senderId":"Lachy@irc"},
{"content":{"body":"but tap to click should work. It definitely works under OSX","msgtype":"m.text"},"ts":1209303601000,"senderName":"Lachy","senderId":"Lachy@irc"},
{"content":{"body":"It is on my cheap HP with Linux - press left+right buttons together, or tap with two fingers","msgtype":"m.text"},"ts":1209303602000,"senderName":"Philip`","senderId":"Philip`@irc"},
{"content":{"body":"(and three fingers for right-click)","msgtype":"m.text"},"ts":1209303603000,"senderName":"Philip`","senderId":"Philip`@irc"},
{"content":{"body":"Lachy: The touchpad works far better under OS X (except for really slow acceleration that I haven't got used to) - it's just the Windows (Boot Camp) driver that is barely usable","msgtype":"m.text"},"ts":1209303660000,"senderName":"Philip`","senderId":"Philip`@irc"},
{"content":{"body":"Oh, also the touchpad is directly under my (right) wrist when I'm playing a game with WASD controls, so I have to stick several layers of tissues over it to avoid it getting misinterpreted as intentional mouse movement","msgtype":"m.text"},"ts":1209303840000,"senderName":"Philip`","senderId":"Philip`@irc"},
{"content":{"body":"do you use your right hand to use WASD controls, instead of your left?","msgtype":"m.text"},"ts":1209303900000,"senderName":"Lachy","senderId":"Lachy@irc"},
{"content":{"body":"Yes","msgtype":"m.text"},"ts":1209303901000,"senderName":"Philip`","senderId":"Philip`@irc"},
{"content":{"body":"since I use my mouse left-handed","msgtype":"m.text"},"ts":1209303902000,"senderName":"Philip`","senderId":"Philip`@irc"},
{"content":{"body":"wow, that's crazy","msgtype":"m.text"},"ts":1209303903000,"senderName":"Lachy","senderId":"Lachy@irc"},
{"content":{"body":"and remapping the controls is too much of a pain, since most games need dozens of keys","msgtype":"m.text"},"ts":1209303960000,"senderName":"Philip`","senderId":"Philip`@irc"},
{"content":{"body":"(I'm not really left handed, since I write with my right)","msgtype":"m.text"},"ts":1209303961000,"senderName":"Philip`","senderId":"Philip`@irc"},
{"content":{"body":"I can't operate a mouse at all with my left hand","msgtype":"m.text"},"ts":1209303962000,"senderName":"Lachy","senderId":"Lachy@irc"},
{"content":{"body":"I can manage up/down/left/right/left-click with my right, but anything needing precise aiming is more of a pain","msgtype":"m.text"},"ts":1209304020000,"senderName":"Philip`","senderId":"Philip`@irc"},
{"content":{"body":"(I tend to assume the only problem is practice, rather than some physical incapability, but I've never bothered trying to test that)","msgtype":"m.text"},"ts":1209304080000,"senderName":"Philip`","senderId":"Philip`@irc"},
{"content":{"body":"Oh, also the MBP doesn't have a right mouse button, so I can't do the right-left or left-right mouse gestures in Opera, which is a pain","msgtype":"m.text"},"ts":1209304200000,"senderName":"Philip`","senderId":"Philip`@irc"},
{"content":{"body":"Cmd+Left and Cmd+Right works well enough for that","msgtype":"m.text"},"ts":1209304260000,"senderName":"Lachy","senderId":"Lachy@irc"},
{"content":{"body":"though it would be nice to have the multitouch touch pad that supports it natively","msgtype":"m.text"},"ts":1209304261000,"senderName":"Lachy","senderId":"Lachy@irc"},
{"content":{"body":"I'm thinking of the right-button-then-left-button thing, not the right-button-and-move-right-to-left thing - would multitouch support the former?","msgtype":"m.text"},"ts":1209304440000,"senderName":"Philip`","senderId":"Philip`@irc"},
{"content":{"body":"multitouch supports 3-finger swipe on the touchpad","msgtype":"m.text"},"ts":1209304500000,"senderName":"Lachy","senderId":"Lachy@irc"},
{"content":{"body":"I'm not sure if it works in Opera though, there are a few things that don't because it's a carbon app, not cocoa.","msgtype":"m.text"},"ts":1209304560000,"senderName":"Lachy","senderId":"Lachy@irc"},
{"content":{"body":"oh, wait, that's on mac. not windows","msgtype":"m.text"},"ts":1209304620000,"senderName":"Lachy","senderId":"Lachy@irc"},
{"content":{"body":"I'm not sure how well the multitouch features would function in windows.","msgtype":"m.text"},"ts":1209304621000,"senderName":"Lachy","senderId":"Lachy@irc"},
{"content":{"body":"Philip`: OK. Now I think I have benchmark data showing that switch in Java sucks","msgtype":"m.text"},"ts":1209306840000,"senderName":"hsivonen","senderId":"hsivonen@irc"},
{"content":{"body":"Philip`: so given a choice between private final methods and avoiding method invocation using switch, one should take the methods any day","msgtype":"m.text"},"ts":1209306841000,"senderName":"hsivonen","senderId":"hsivonen@irc"},
{"content":{"body":"http://pastebin.ca/999313","msgtype":"m.text"},"ts":1209307080000,"senderName":"hsivonen","senderId":"hsivonen@irc"},
{"content":{"body":"hsivonen: I get 31240/17893/1679 for the three real runs over one minute on http://en.wikipedia.org/wiki/Main_Page on a 2.0GHz C2D with \"Java(TM) SE Runtime Environment (build 1.6.0_05-b13)\", \"Java HotSpot(TM) Client VM (build 10.0-b19, mixed mode)\"","msgtype":"m.text"},"ts":1209307860000,"senderName":"Philip`","senderId":"Philip`@irc"},
{"content":{"body":"so that seems to agree with your results","msgtype":"m.text"},"ts":1209307861000,"senderName":"Philip`","senderId":"Philip`@irc"},
{"content":{"body":"Philip`: thanks. ","msgtype":"m.text"},"ts":1209308040000,"senderName":"hsivonen","senderId":"hsivonen@irc"},
{"content":{"body":"Philip`: re: profiling: the profiling measures execution time in methods","msgtype":"m.text"},"ts":1209308041000,"senderName":"hsivonen","senderId":"hsivonen@irc"},
{"content":{"body":"so it doesn't tell what exactly sucks inside the huge method","msgtype":"m.text"},"ts":1209308100000,"senderName":"hsivonen","senderId":"hsivonen@irc"},
{"content":{"body":"in general, though, isPrivateUse and isNonCharacter take way too much time","msgtype":"m.text"},"ts":1209308101000,"senderName":"hsivonen","senderId":"hsivonen@irc"},
{"content":{"body":"VTune gives profiling data at the JITted x86 instruction level, which is sometimes a nicer way of looking at things","msgtype":"m.text"},"ts":1209308160000,"senderName":"Philip`","senderId":"Philip`@irc"},
{"content":{"body":"how big a deal getting VTune and setting it up on Leopard or Hardy is? it looks like a for-pay product mainly for Windows.","msgtype":"m.text"},"ts":1209308340000,"senderName":"hsivonen","senderId":"hsivonen@irc"},
{"content":{"body":"mm. 700 dollars","msgtype":"m.text"},"ts":1209308400000,"senderName":"hsivonen","senderId":"hsivonen@irc"},
{"content":{"body":"not exactly cheap","msgtype":"m.text"},"ts":1209308401000,"senderName":"hsivonen","senderId":"hsivonen@irc"},
{"content":{"body":"I just used the free evaluation version a few years ago on Windows","msgtype":"m.text"},"ts":1209308520000,"senderName":"Philip`","senderId":"Philip`@irc"},
{"content":{"body":"so it's probably far from the best solution","msgtype":"m.text"},"ts":1209308521000,"senderName":"Philip`","senderId":"Philip`@irc"},
{"content":{"body":"but I don't know what other tools implement the same kinds of features","msgtype":"m.text"},"ts":1209308522000,"senderName":"Philip`","senderId":"Philip`@irc"},
{"content":{"body":"(I'm pretty sure there are some, I just have no idea what they're called)","msgtype":"m.text"},"ts":1209308523000,"senderName":"Philip`","senderId":"Philip`@irc"},
{"content":{"body":"I think it is pretty safe to conclude that given my findings and the Antlr page, switch sucks","msgtype":"m.text"},"ts":1209308700000,"senderName":"hsivonen","senderId":"hsivonen@irc"},
{"content":{"body":"so the next step I should take is using more return and continue without switch","msgtype":"m.text"},"ts":1209308701000,"senderName":"hsivonen","senderId":"hsivonen@irc"},
{"content":{"body":"reads the definition of arcTo, and wonders who to blame for it","msgtype":"m.emote"},"ts":1209312960000,"senderName":"Philip`","senderId":"Philip`@irc"},
{"content":{"body":"I suppose it's either me, or Hixie, or whoever wrote the equivalent function in OS X","msgtype":"m.text"},"ts":1209313020000,"senderName":"Philip`","senderId":"Philip`@irc"},
{"content":{"body":"some canvas neatness to rest your eyes on, http://www.p01.org/releases/DHTML_contests/files/20lines_twinkle/","msgtype":"m.text"},"ts":1209323400000,"senderName":"virtuelv","senderId":"virtuelv@irc"},
{"content":{"body":"Much smoother in Firefox 3 than Opera 9.5 :-)","msgtype":"m.text"},"ts":1209323580000,"senderName":"Philip`","senderId":"Philip`@irc"},
{"content":{"body":"(at least on Linux)","msgtype":"m.text"},"ts":1209323581000,"senderName":"Philip`","senderId":"Philip`@irc"},
{"content":{"body":"Only seems to render the first frame in Konqueror 4, then stops","msgtype":"m.text"},"ts":1209323640000,"senderName":"Philip`","senderId":"Philip`@irc"},
{"content":{"body":"I don't notice much of a difference between Opera and FF here","msgtype":"m.text"},"ts":1209323700000,"senderName":"virtuelv","senderId":"virtuelv@irc"},
{"content":{"body":"moving the cursor modifies the animation","msgtype":"m.text"},"ts":1209323701000,"senderName":"virtuelv","senderId":"virtuelv@irc"},
{"content":{"body":"Hmm, Safari 3.somethingold has the same problem as Konqueror","msgtype":"m.text"},"ts":1209323702000,"senderName":"Philip`","senderId":"Philip`@irc"},
{"content":{"body":"Yeah, I assume p01 has actually tested against Safari, possibly with a recentish nighly of WebKit","msgtype":"m.text"},"ts":1209323760000,"senderName":"virtuelv","senderId":"virtuelv@irc"},
{"content":{"body":"Same problem (only draws one frame) in WebKit r32574 (from yesterday) on Windows","msgtype":"m.text"},"ts":1209323820000,"senderName":"Philip`","senderId":"Philip`@irc"},
{"content":{"body":"Philip`: looks like Safari has problems with CanvasRenderingContext2D.prototype","msgtype":"m.text"},"ts":1209324060000,"senderName":"hasather","senderId":"hasather@irc"},
{"content":{"body":"which has been discussed in this channel before","msgtype":"m.text"},"ts":1209324061000,"senderName":"hasather","senderId":"hasather@irc"},
{"content":{"body":"hasather: Ah, that would make sense","msgtype":"m.text"},"ts":1209324120000,"senderName":"Philip`","senderId":"Philip`@irc"},
{"content":{"body":"http://philip.html5.org/tests/canvas/suite/tests/index.2d.type.html - hmm, Konqueror appears to do CanvasRenderingContext2D properly (whereas WebKit doesn't) but still doesn't work on that demo","msgtype":"m.text"},"ts":1209324240000,"senderName":"Philip`","senderId":"Philip`@irc"},
{"content":{"body":"I wonder what the relative frequencies of the tokenizer states preceding 'bogus doctype' are...","msgtype":"m.text"},"ts":1209324840000,"senderName":"hsivonen","senderId":"hsivonen@irc"},
{"content":{"body":"hsivonen: You might be able to deduce it from http://canvex.lazyilluminati.com/misc/stats/tokeniser.html (for a somewhat old version of the spec)","msgtype":"m.text"},"ts":1209324841000,"senderName":"Philip`","senderId":"Philip`@irc"},
{"content":{"body":"(It shows \"current state: conditions that were true and will cause the relevant set of steps to execute\")","msgtype":"m.text"},"ts":1209324900000,"senderName":"Philip`","senderId":"Philip`@irc"},
{"content":{"body":"(where \"true\" is the \"anything else\" fallback when all other conditionals in that state have not matched)","msgtype":"m.text"},"ts":1209324960000,"senderName":"Philip`","senderId":"Philip`@irc"},
{"content":{"body":"Philip`: there's only one match for BogusDoctype","msgtype":"m.text"},"ts":1209325740000,"senderName":"hsivonen","senderId":"hsivonen@irc"},
{"content":{"body":"Philip`: I think I don't understand what I should look for","msgtype":"m.text"},"ts":1209325800000,"senderName":"hsivonen","senderId":"hsivonen@irc"},
{"content":{"body":"hsivonen: You need to first find the places where the spec says to move to 'bogus doctype'","msgtype":"m.text"},"ts":1209326460000,"senderName":"Philip`","senderId":"Philip`@irc"},
{"content":{"body":"e.g. the 'anything else' part of 'before doctype public identifier'","msgtype":"m.text"},"ts":1209326461000,"senderName":"Philip`","senderId":"Philip`@irc"},
{"content":{"body":"and that part is named \"BeforeDoctypePublicIdentifierState: true\" in my table thingy (since \"true\" is the catch-all condition, which is used for \"anything else\")","msgtype":"m.text"},"ts":1209326520000,"senderName":"Philip`","senderId":"Philip`@irc"},
{"content":{"body":"and that isn't in the list at all, so that never occurred in the HTML I was parsing, so that's not the best example","msgtype":"m.text"},"ts":1209326580000,"senderName":"Philip`","senderId":"Philip`@irc"},
{"content":{"body":"Um, I can't actually find any in the list that are moving into bogus doctype state...","msgtype":"m.text"},"ts":1209326700000,"senderName":"Philip`","senderId":"Philip`@irc"},
{"content":{"body":"(which is odd since it says there were 104 tokeniser steps inside bogus doctype state)","msgtype":"m.text"},"ts":1209326760000,"senderName":"Philip`","senderId":"Philip`@irc"},
{"content":{"body":"(so I'm not entirely sure what's going on there)","msgtype":"m.text"},"ts":1209326761000,"senderName":"Philip`","senderId":"Philip`@irc"},
{"content":{"body":"(Oh well)","msgtype":"m.text"},"ts":1209326820000,"senderName":"Philip`","senderId":"Philip`@irc"},
{"content":{"body":"Conclusion: pages usually have about half a doctype, and a significant majority of those are non-bogus, so it's hard to get extensive data about bogosity, and I can't say anything more useful without having to do some work","msgtype":"m.text"},"ts":1209327180000,"senderName":"Philip`","senderId":"Philip`@irc"},
{"content":{"body":"Philip`: that probably also means that it's not a point worth optimizing.","msgtype":"m.text"},"ts":1209327900000,"senderName":"hsivonen","senderId":"hsivonen@irc"},
{"content":{"body":"thanks","msgtype":"m.text"},"ts":1209327901000,"senderName":"hsivonen","senderId":"hsivonen@irc"},
{"content":{"body":"hsivonen: Unless someone has a pathological case of a whole page full of bogus doctypes, it seems like not the most critical area for performance","msgtype":"m.text"},"ts":1209327960000,"senderName":"Philip`","senderId":"Philip`@irc"},
{"content":{"body":"hmm. I refactored the code some more and now the perf sucks even more","msgtype":"m.text"},"ts":1209329880000,"senderName":"hsivonen","senderId":"hsivonen@irc"},
{"content":{"body":"the most reasonable expectation is that HotSpot isn't doing field-to-stack hoisting","msgtype":"m.text"},"ts":1209329940000,"senderName":"hsivonen","senderId":"hsivonen@irc"},
{"content":{"body":"s/expectation/explanation/","msgtype":"m.text"},"ts":1209330060000,"senderName":"hsivonen","senderId":"hsivonen@irc"},
{"content":{"body":"if HotSpot isn't doing field-to-stack hoisting, so of my earlier conclusions are wrong","msgtype":"m.text"},"ts":1209331680000,"senderName":"hsivonen","senderId":"hsivonen@irc"},
{"content":{"body":"Whoops, using jQuery's 'wrap' method to nest forms is a bad idea, since it breaks (at least) Opera","msgtype":"m.text"},"ts":1209334800000,"senderName":"Philip`","senderId":"Philip`@irc"},
{"content":{"body":"(by making the outer form end just before the inner form)","msgtype":"m.text"},"ts":1209334801000,"senderName":"Philip`","senderId":"Philip`@irc"},
{"content":{"body":"(whereas it works fine in Firefox)","msgtype":"m.text"},"ts":1209334802000,"senderName":"Philip`","senderId":"Philip`@irc"},
{"content":{"body":"goes back to using plain ugly DOM methods to nest forms","msgtype":"m.emote"},"ts":1209334803000,"senderName":"Philip`","senderId":"Philip`@irc"},
{"content":{"body":"thus finds that form.setAttribute('enctype') doesn't work in IE","msgtype":"m.emote"},"ts":1209335640000,"senderName":"Philip`","senderId":"Philip`@irc"},
{"content":{"body":"I'm still amazed by the 10-fold difference in parser perf after the refactoring","msgtype":"m.text"},"ts":1209336000000,"senderName":"hsivonen","senderId":"hsivonen@irc"},
{"content":{"body":"somehow I suspect that the slow-down is due to something I've failed to consider and switch itself can't be *that* slow","msgtype":"m.text"},"ts":1209336001000,"senderName":"hsivonen","senderId":"hsivonen@irc"},
{"content":{"body":"could it be that the HotSpot simply avoids compiling the huge tokenization method?","msgtype":"m.text"},"ts":1209336060000,"senderName":"hsivonen","senderId":"hsivonen@irc"},
{"content":{"body":"hsivonen: Does execution ever leave that method?","msgtype":"m.text"},"ts":1209336120000,"senderName":"Philip`","senderId":"Philip`@irc"},
{"content":{"body":"Maybe it can't JIT methods while it's executing in the middle of them","msgtype":"m.text"},"ts":1209336121000,"senderName":"Philip`","senderId":"Philip`@irc"},
{"content":{"body":"Philip`: yes. and the FAQ says that HotSpot does on the stack replacement anyway","msgtype":"m.text"},"ts":1209336122000,"senderName":"hsivonen","senderId":"hsivonen@irc"},
{"content":{"body":"Oh, okay","msgtype":"m.text"},"ts":1209336180000,"senderName":"Philip`","senderId":"Philip`@irc"},
{"content":{"body":"http://forum.java.sun.com/thread.jspa?threadID=790229 - \"There is an overriding size limit on methods that can get compiled. In 5.0, methods larger than 8000 bytes (of bytecode) are not considered for compilation.\"","msgtype":"m.text"},"ts":1209336181000,"senderName":"Philip`","senderId":"Philip`@irc"},
{"content":{"body":"but then it says \"Method size is not a compilation criterion, but it is an inlining criteria.\" so I'm not sure how that relates to the previous statement","msgtype":"m.text"},"ts":1209336240000,"senderName":"Philip`","senderId":"Philip`@irc"},
{"content":{"body":"Can't you use DTrace to work out what' going on?","msgtype":"m.text"},"ts":1209336360000,"senderName":"jgraham","senderId":"jgraham@irc"},
{"content":{"body":"http://java.sun.com/javase/6/docs/technotes/guides/vm/dtrace.html","msgtype":"m.text"},"ts":1209336361000,"senderName":"jgraham","senderId":"jgraham@irc"},
{"content":{"body":"(that link is for DTrace + hotspot)","msgtype":"m.text"},"ts":1209336362000,"senderName":"jgraham","senderId":"jgraham@irc"},
{"content":{"body":"jgraham: I'd need Solaris to run that, wouldn't I?","msgtype":"m.text"},"ts":1209336363000,"senderName":"hsivonen","senderId":"hsivonen@irc"},
{"content":{"body":"since Linux doesn't have DTrace and OS X doesn't have Java 6","msgtype":"m.text"},"ts":1209336420000,"senderName":"hsivonen","senderId":"hsivonen@irc"},
{"content":{"body":"hsivonen: I guess, if there's no way to get Java 6 on OS X","msgtype":"m.text"},"ts":1209336421000,"senderName":"jgraham","senderId":"jgraham@irc"},
{"content":{"body":"Would OpenSolaris work?","msgtype":"m.text"},"ts":1209336422000,"senderName":"jgraham","senderId":"jgraham@irc"},
{"content":{"body":"jgraham: yeah, except for all the work of installing it","msgtype":"m.text"},"ts":1209336423000,"senderName":"hsivonen","senderId":"hsivonen@irc"},
{"content":{"body":"has a Solaris box","msgtype":"m.emote"},"ts":1209336480000,"senderName":"Philip`","senderId":"Philip`@irc"},
{"content":{"body":"but I think it's pretty old","msgtype":"m.text"},"ts":1209336481000,"senderName":"Philip`","senderId":"Philip`@irc"},
{"content":{"body":"(I'm not sure how old it actually is but its uptime is 1030 days)","msgtype":"m.text"},"ts":1209336482000,"senderName":"Philip`","senderId":"Philip`@irc"},
{"content":{"body":"hsivonen: They have a live CD","msgtype":"m.text"},"ts":1209336540000,"senderName":"jgraham","senderId":"jgraham@irc"},
{"content":{"body":"(It's even got Java, but 1.4.0_03)","msgtype":"m.text"},"ts":1209336541000,"senderName":"Philip`","senderId":"Philip`@irc"},
{"content":{"body":"Philip`: Almost the whole IoA runs on old solaris boxes (except, in practice lots of people just use personal machines instead)","msgtype":"m.text"},"ts":1209336600000,"senderName":"jgraham","senderId":"jgraham@irc"},
{"content":{"body":"(fortunately I'm in a group that has its own computing budget and modern linux-running hardware)","msgtype":"m.text"},"ts":1209336660000,"senderName":"jgraham","senderId":"jgraham@irc"},
{"content":{"body":"indeed it appears that the tokenizer's main loop never gets compiled","msgtype":"m.text"},"ts":1209336720000,"senderName":"hsivonen","senderId":"hsivonen@irc"},
{"content":{"body":"that's dumb!","msgtype":"m.text"},"ts":1209336721000,"senderName":"hsivonen","senderId":"hsivonen@irc"},
{"content":{"body":"leaving the most important thing uncompiled","msgtype":"m.text"},"ts":1209336722000,"senderName":"hsivonen","senderId":"hsivonen@irc"},
{"content":{"body":"wtf?","msgtype":"m.text"},"ts":1209336723000,"senderName":"hsivonen","senderId":"hsivonen@irc"},
{"content":{"body":"It's strange that even the server VM doesn't do that","msgtype":"m.text"},"ts":1209336780000,"senderName":"Philip`","senderId":"Philip`@irc"},
{"content":{"body":"likes languages with predictable performance :-)","msgtype":"m.emote"},"ts":1209336840000,"senderName":"Philip`","senderId":"Philip`@irc"},
{"content":{"body":"I'd love to have some radically traditional compilation right now","msgtype":"m.text"},"ts":1209336900000,"senderName":"hsivonen","senderId":"hsivonen@irc"},
{"content":{"body":"GCJ!","msgtype":"m.text"},"ts":1209336901000,"senderName":"Philip`","senderId":"Philip`@irc"},
{"content":{"body":"Or use a series of sed scripts to convert the tokeniser into a JNI C++ component","msgtype":"m.text"},"ts":1209337020000,"senderName":"Philip`","senderId":"Philip`@irc"},
{"content":{"body":"Philip`: not an entirely bad idea","msgtype":"m.text"},"ts":1209337021000,"senderName":"hsivonen","senderId":"hsivonen@irc"},
{"content":{"body":"Uh oh","msgtype":"m.text"},"ts":1209337080000,"senderName":"Philip`","senderId":"Philip`@irc"},
{"content":{"body":"(Which of the ideas do you mean?)","msgtype":"m.text"},"ts":1209337081000,"senderName":"Philip`","senderId":"Philip`@irc"},
{"content":{"body":"(not that it would affect my reaction much)","msgtype":"m.text"},"ts":1209337140000,"senderName":"Philip`","senderId":"Philip`@irc"},
{"content":{"body":"predicts it's not the sed option","msgtype":"m.emote"},"ts":1209337141000,"senderName":"jgraham","senderId":"jgraham@irc"},
{"content":{"body":"sed to C++","msgtype":"m.text"},"ts":1209337142000,"senderName":"hsivonen","senderId":"hsivonen@irc"},
{"content":{"body":"needs to polish his crystal ball","msgtype":"m.emote"},"ts":1209337200000,"senderName":"jgraham","senderId":"jgraham@irc"},
{"content":{"body":"but seriously, how can it be a good idea to leave the largest methods uncompiled","msgtype":"m.text"},"ts":1209338220000,"senderName":"hsivonen","senderId":"hsivonen@irc"},
{"content":{"body":"those are almost sure to be parser code","msgtype":"m.text"},"ts":1209338221000,"senderName":"hsivonen","senderId":"hsivonen@irc"},
{"content":{"body":"or generated code","msgtype":"m.text"},"ts":1209338222000,"senderName":"hsivonen","senderId":"hsivonen@irc"},
{"content":{"body":"i.e. stuff that should be Fast","msgtype":"m.text"},"ts":1209338223000,"senderName":"hsivonen","senderId":"hsivonen@irc"},
{"content":{"body":"http://www.p01.org/releases/DHTML_contests/files/20lines_twinkle/ is cool","msgtype":"m.text"},"ts":1209339720000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"i should put that on a slide calling it \"the new <marquee>","msgtype":"m.text"},"ts":1209339780000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"\"","msgtype":"m.text"},"ts":1209339781000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"annevk: That's an excellent idea - <marquee><canvas/></marquee>","msgtype":"m.text"},"ts":1209339900000,"senderName":"Philip`","senderId":"Philip`@irc"},
{"content":{"body":"Works quite nicely on that 20lines_twinkle page","msgtype":"m.text"},"ts":1209339901000,"senderName":"Philip`","senderId":"Philip`@irc"},
{"content":{"body":"now I need a tool that shows me the bytecode sizes of my methods","msgtype":"m.text"},"ts":1209340020000,"senderName":"hsivonen","senderId":"hsivonen@irc"},
{"content":{"body":"Philip`, hehe, that makes it toaly crazy :)","msgtype":"m.text"},"ts":1209340021000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"(I quite like the edit source function of Opera)","msgtype":"m.text"},"ts":1209340022000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"hsivonen: javap -c ClassName","msgtype":"m.text"},"ts":1209340140000,"senderName":"Philip`","senderId":"Philip`@irc"},
{"content":{"body":"shows disassembly, including instruction numbering","msgtype":"m.text"},"ts":1209340141000,"senderName":"Philip`","senderId":"Philip`@irc"},
{"content":{"body":"Philip`: it doesn't show the method I'm looking for","msgtype":"m.text"},"ts":1209340380000,"senderName":"hsivonen","senderId":"hsivonen@irc"},
{"content":{"body":"Add -private ?","msgtype":"m.text"},"ts":1209340440000,"senderName":"Philip`","senderId":"Philip`@irc"},
{"content":{"body":"yeah. thanks","msgtype":"m.text"},"ts":1209340500000,"senderName":"hsivonen","senderId":"hsivonen@irc"},
{"content":{"body":"I need to spilt out NCR value handling","msgtype":"m.text"},"ts":1209340620000,"senderName":"hsivonen","senderId":"hsivonen@irc"}
]
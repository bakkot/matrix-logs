[
{"content":{"body":"annevk: is https://github.com/web-platform-tests/wpt/blob/master/xhr/open-url-multi-window-4.htm a legit test? The referenced pull request was closed without being merged, no browser other than Safari passes it, and it times out (like Firefox) when I fix https://crbug.com/879620","msgtype":"m.text"},"ts":1536196752000,"senderName":"TimothyGu","senderId":"TimothyGu@irc"},
{"content":{"body":"In particular I don't think the test for `error` event is kosher, as discard a Document aborts the document, and should only fire `abort` event","msgtype":"m.text"},"ts":1536196869000,"senderName":"TimothyGu","senderId":"TimothyGu@irc"},
{"content":{"body":"(by \"it\" times out, I mean Chrome times out when I fix the linked bug, which is what Firefox currently does)","msgtype":"m.text"},"ts":1536197095000,"senderName":"TimothyGu","senderId":"TimothyGu@irc"},
{"content":{"body":"TimothyGu: some xhr tests are really old and could prolly use a fresh look","msgtype":"m.text"},"ts":1536203717000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"TimothyGu: I can take look later","msgtype":"m.text"},"ts":1536203769000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"annevk: that'd be appreciated, thanks","msgtype":"m.text"},"ts":1536203781000,"senderName":"TimothyGu","senderId":"TimothyGu@irc"},
{"content":{"body":"annevk: the main issue here seems to be that in Chrome and Firefox, XMLHttpRequest objects in an inactive document go \"dead\" and will not fire any events, period. not sure if that behavior is spec'd anywhere though","msgtype":"m.text"},"ts":1536204570000,"senderName":"TimothyGu","senderId":"TimothyGu@irc"},
{"content":{"body":"TimothyGu: xhr does spec a fully active check iirc","msgtype":"m.text"},"ts":1536205286000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"TimothyGu: the weird thing is that we don’t have it for similar APIs","msgtype":"m.text"},"ts":1536205314000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"annevk: it's only in open() though","msgtype":"m.text"},"ts":1536205314000,"senderName":"TimothyGu","senderId":"TimothyGu@irc"},
{"content":{"body":"True","msgtype":"m.text"},"ts":1536205327000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"from the impl side it looks like it should really be in fetch","msgtype":"m.text"},"ts":1536205340000,"senderName":"TimothyGu","senderId":"TimothyGu@irc"},
{"content":{"body":"(by impl I mean Blink and probably WebKit and Gecko)","msgtype":"m.text"},"ts":1536205354000,"senderName":"TimothyGu","senderId":"TimothyGu@irc"},
{"content":{"body":"And what does the caller get? Network error?","msgtype":"m.text"},"ts":1536205413000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"probably?","msgtype":"m.text"},"ts":1536205430000,"senderName":"TimothyGu","senderId":"TimothyGu@irc"},
{"content":{"body":"Given that’s async it could change over time too","msgtype":"m.text"},"ts":1536205456000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"either that or an aborted request","msgtype":"m.text"},"ts":1536205461000,"senderName":"TimothyGu","senderId":"TimothyGu@irc"},
{"content":{"body":"But I guess we terminate fetches when docs go inactive","msgtype":"m.text"},"ts":1536205487000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"Fetch groups are still poorly specced unfortunately","msgtype":"m.text"},"ts":1536205513000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":":(","msgtype":"m.text"},"ts":1536205528000,"senderName":"TimothyGu","senderId":"TimothyGu@irc"},
{"content":{"body":"have you looked at the test yet?","msgtype":"m.text"},"ts":1536205541000,"senderName":"TimothyGu","senderId":"TimothyGu@irc"},
{"content":{"body":"it's sort-of blocking my work on Chromium making the abort event async","msgtype":"m.text"},"ts":1536205557000,"senderName":"TimothyGu","senderId":"TimothyGu@irc"},
{"content":{"body":"Stuck with my phone and a baby; I cannot take a good look for another couple hours","msgtype":"m.text"},"ts":1536205587000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"I guess I can peek at the source","msgtype":"m.text"},"ts":1536205599000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"ah. it's not too terribly huge","msgtype":"m.text"},"ts":1536205609000,"senderName":"TimothyGu","senderId":"TimothyGu@irc"},
{"content":{"body":"the resources/init.htm file just calls top.init() when loaded, nothing spectacular","msgtype":"m.text"},"ts":1536205635000,"senderName":"TimothyGu","senderId":"TimothyGu@irc"},
{"content":{"body":"anyway I'll sleep soon and won't get to this until tomorrow, so feel free to take your time.","msgtype":"m.text"},"ts":1536205697000,"senderName":"TimothyGu","senderId":"TimothyGu@irc"},
{"content":{"body":"TimothyGu: so this depends on unspecced stuff","msgtype":"m.text"},"ts":1536205737000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"TimothyGu: how exactly canceling a fetch group looks","msgtype":"m.text"},"ts":1536205761000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"TimothyGu: if error events this would make sense, but dunno what would be best and what compat allows for","msgtype":"m.text"},"ts":1536205818000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"s/looks/functions/","msgtype":"m.text"},"ts":1536205840000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"So Safari is the only one that does error events, per wpt.fyi (Edge result is missing though). A reasonable guess is that they only implemented that in order to fix this specific test.","msgtype":"m.text"},"ts":1536205917000,"senderName":"TimothyGu","senderId":"TimothyGu@irc"},
{"content":{"body":"Yeah","msgtype":"m.text"},"ts":1536206064000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"I guess the question is, when a doc goes inactive, how do all fetchy things behave today and does that match what we think is good","msgtype":"m.text"},"ts":1536206128000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"Not firing events seems weird, but if you want to stop running code in a closed tab makes sense","msgtype":"m.text"},"ts":1536206181000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"bz would probably be a person to talk to. And also this has implication on salvageability too","msgtype":"m.text"},"ts":1536206266000,"senderName":"TimothyGu","senderId":"TimothyGu@irc"},
{"content":{"body":"Yeah","msgtype":"m.text"},"ts":1536206363000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"anyway, for the purpose of implementing the abort event timing correctly in Chrome, I'll just change the expectation to time out instead of failing","msgtype":"m.text"},"ts":1536206416000,"senderName":"TimothyGu","senderId":"TimothyGu@irc"},
{"content":{"body":"sgtm","msgtype":"m.text"},"ts":1536207452000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"annevk: yt?","msgtype":"m.text"},"ts":1536208264000,"senderName":"rniwa","senderId":"rniwa@irc"},
{"content":{"body":"smaug____: yt?","msgtype":"m.text"},"ts":1536208587000,"senderName":"rniwa","senderId":"rniwa@irc"},
{"content":{"body":"smaug____: ping?","msgtype":"m.text"},"ts":1536215613000,"senderName":"rniwa","senderId":"rniwa@irc"},
{"content":{"body":"rniwa: am now","msgtype":"m.text"},"ts":1536216317000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"If this is about web components, I haven't gotten around to looking at the latest there yet","msgtype":"m.text"},"ts":1536216334000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"annevk: i have: https://github.com/whatwg/dom/issues/685","msgtype":"m.text"},"ts":1536216351000,"senderName":"rniwa","senderId":"rniwa@irc"},
{"content":{"body":"annevk: I just wanna know if the current spec's wording is intentional","msgtype":"m.text"},"ts":1536216367000,"senderName":"rniwa","senderId":"rniwa@irc"},
{"content":{"body":"annevk: or it's just an oversight","msgtype":"m.text"},"ts":1536216372000,"senderName":"rniwa","senderId":"rniwa@irc"},
{"content":{"body":"annevk: I have a completely unrelated question about \"submit\" event though","msgtype":"m.text"},"ts":1536216457000,"senderName":"rniwa","senderId":"rniwa@irc"},
{"content":{"body":"annevk: does HTML or DOM spec have any text about how \"submit\" is stopped propagation at the first form element it encounters?","msgtype":"m.text"},"ts":1536216484000,"senderName":"rniwa","senderId":"rniwa@irc"},
{"content":{"body":"I couldn't find any normative text","msgtype":"m.text"},"ts":1536216489000,"senderName":"rniwa","senderId":"rniwa@irc"},
{"content":{"body":"That looks like it might be an oversight, I'll investigate","msgtype":"m.text"},"ts":1536216493000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"rniwa: you're looking for https://github.com/whatwg/html/issues/3599","msgtype":"m.text"},"ts":1536216532000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"annevk: cool","msgtype":"m.text"},"ts":1536216578000,"senderName":"rniwa","senderId":"rniwa@irc"},
{"content":{"body":"annevk: I did some investigation about that event.composedPath() seem to indicate Blink, Gecko, & WebKit all seem to simply stop the propagation instead of shrinking the event path","msgtype":"m.text"},"ts":1536216707000,"senderName":"rniwa","senderId":"rniwa@irc"},
{"content":{"body":"annevk: it's crazy..","msgtype":"m.text"},"ts":1536216713000,"senderName":"rniwa","senderId":"rniwa@irc"},
{"content":{"body":"rniwa: the amount of changes I had to make to the event dispatch algorithm over the years to account for weird stuff browsers implemented is rather staggering","msgtype":"m.text"},"ts":1536216872000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"annevk: ya, truly mind boggling.","msgtype":"m.text"},"ts":1536216889000,"senderName":"rniwa","senderId":"rniwa@irc"},
{"content":{"body":"annevk: it looks like we're also missing a special case of disabled form controls","msgtype":"m.text"},"ts":1536217230000,"senderName":"rniwa","senderId":"rniwa@irc"},
{"content":{"body":"annevk: as far as I can tell, Gecko stop the propagation of all events on disabled form controls...","msgtype":"m.text"},"ts":1536217244000,"senderName":"rniwa","senderId":"rniwa@irc"},
{"content":{"body":"rniwa: I always assumed disabled form controls was some hit testing special case, but I never truly investigated...","msgtype":"m.text"},"ts":1536217285000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"annevk: hit testing is working","msgtype":"m.text"},"ts":1536217303000,"senderName":"rniwa","senderId":"rniwa@irc"},
{"content":{"body":"annevk: Gecko stops propagation","msgtype":"m.text"},"ts":1536217309000,"senderName":"rniwa","senderId":"rniwa@irc"},
{"content":{"body":"Okay, we really need more people to define all this legacy shit","msgtype":"m.text"},"ts":1536217323000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"annevk: WebKit & Blink simply ignores the event; doesn't call event listeners but let the event pass through to ancestors LOL","msgtype":"m.text"},"ts":1536217326000,"senderName":"rniwa","senderId":"rniwa@irc"},
{"content":{"body":"o_O","msgtype":"m.text"},"ts":1536217342000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"annevk: https://gist.github.com/rniwa/bf0f1411d6b811fcb605e796498740f3","msgtype":"m.text"},"ts":1536217529000,"senderName":"rniwa","senderId":"rniwa@irc"},
{"content":{"body":"annevk: Gecko outputs nothing","msgtype":"m.text"},"ts":1536217532000,"senderName":"rniwa","senderId":"rniwa@irc"},
{"content":{"body":"annevk: WebKit & Blink says","msgtype":"m.text"},"ts":1536217557000,"senderName":"rniwa","senderId":"rniwa@irc"},
{"content":{"body":"click on div","msgtype":"m.text"},"ts":1536217557000,"senderName":"rniwa","senderId":"rniwa@irc"},
{"content":{"body":"test on button","msgtype":"m.text"},"ts":1536217557000,"senderName":"rniwa","senderId":"rniwa@irc"},
{"content":{"body":"test on div","msgtype":"m.text"},"ts":1536217557000,"senderName":"rniwa","senderId":"rniwa@irc"},
{"content":{"body":"Well that's no fun, so much special behavior","msgtype":"m.text"},"ts":1536217659000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"annevk: yeah, this is isane...","msgtype":"m.text"},"ts":1536217673000,"senderName":"rniwa","senderId":"rniwa@irc"},
{"content":{"body":"annevk: I bet some websites rely on it though...","msgtype":"m.text"},"ts":1536217679000,"senderName":"rniwa","senderId":"rniwa@irc"},
{"content":{"body":"I like what Gecko does I guess, just return early if the target has some flag set","msgtype":"m.text"},"ts":1536217703000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"annevk: i guess we'd have to check what it does if an event propagates to a disabled form controls","msgtype":"m.text"},"ts":1536217742000,"senderName":"rniwa","senderId":"rniwa@irc"},
{"content":{"body":"Although wait, that's not what it does, it goes through ancestors first","msgtype":"m.text"},"ts":1536217749000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"Yeah, it seems that if there's something on the path with a flag set, it returns early","msgtype":"m.text"},"ts":1536217774000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"annevk: you mean like capturing?","msgtype":"m.text"},"ts":1536217781000,"senderName":"rniwa","senderId":"rniwa@irc"},
{"content":{"body":"rniwa: I mean that in your example you dispatch on <span> which is a child of a disabled element, so the path is span -> disabled element (ignoring other ancestors)","msgtype":"m.text"},"ts":1536217818000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"annevk: i guess I should add event listeners to span","msgtype":"m.text"},"ts":1536217859000,"senderName":"rniwa","senderId":"rniwa@irc"},
{"content":{"body":"ooh, yes","msgtype":"m.text"},"ts":1536217880000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"annevk: ok, so it dispatches to span!","msgtype":"m.text"},"ts":1536217888000,"senderName":"rniwa","senderId":"rniwa@irc"},
{"content":{"body":"annevk: but then it stops","msgtype":"m.text"},"ts":1536217891000,"senderName":"rniwa","senderId":"rniwa@irc"},
{"content":{"body":"I guess that's similar to the <form> scenario? But it doesn't care about the event name here","msgtype":"m.text"},"ts":1536217920000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"annevk: Blink & WebKit cares about event being a mouse event","msgtype":"m.text"},"ts":1536217941000,"senderName":"rniwa","senderId":"rniwa@irc"},
{"content":{"body":"annevk: but Gecko doesn't","msgtype":"m.text"},"ts":1536217943000,"senderName":"rniwa","senderId":"rniwa@irc"},
{"content":{"body":"annevk: okay, so capturing also only happens on span","msgtype":"m.text"},"ts":1536218043000,"senderName":"rniwa","senderId":"rniwa@irc"},
{"content":{"body":"annevk: I think Gecko's behavior makes most sense here. it's truncating the composed path to 1.","msgtype":"m.text"},"ts":1536218085000,"senderName":"rniwa","senderId":"rniwa@irc"},
{"content":{"body":"for some definition of \"makes sense\"","msgtype":"m.text"},"ts":1536218105000,"senderName":"rniwa","senderId":"rniwa@irc"},
{"content":{"body":"Ah okay, I was about to say that I don't understand how that would work, but if the path is very short I guess it does","msgtype":"m.text"},"ts":1536218119000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"so maybe 1. restrict this behavior to mouse event & then truncate the event path at the first disabled form control","msgtype":"m.text"},"ts":1536218130000,"senderName":"rniwa","senderId":"rniwa@irc"},
{"content":{"body":"might be good","msgtype":"m.text"},"ts":1536218136000,"senderName":"rniwa","senderId":"rniwa@irc"},
{"content":{"body":"That would argue for changing \"get the parent\" somehow","msgtype":"m.text"},"ts":1536218141000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"ya","msgtype":"m.text"},"ts":1536218146000,"senderName":"rniwa","senderId":"rniwa@irc"},
{"content":{"body":"So form controls can have their own \"get the parent\" that sometimes returns null","msgtype":"m.text"},"ts":1536218156000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"No wait, that doesn't work","msgtype":"m.text"},"ts":1536218171000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"HTMLElement would need its own \"get the parent\" that special cases form controls","msgtype":"m.text"},"ts":1536218194000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"oh no :(","msgtype":"m.text"},"ts":1536218200000,"senderName":"rniwa","senderId":"rniwa@irc"},
{"content":{"body":"annevk: maybe modifying the dispatching algorithm in DOM is better.","msgtype":"m.text"},"ts":1536218223000,"senderName":"rniwa","senderId":"rniwa@irc"},
{"content":{"body":"Hmm, actually, probably Element, if we mix namespaces","msgtype":"m.text"},"ts":1536218226000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"Yeah","msgtype":"m.text"},"ts":1536218231000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"annevk: scattering these quirks throughout different specs make it really hard to find out these edge cases","msgtype":"m.text"},"ts":1536218245000,"senderName":"rniwa","senderId":"rniwa@irc"},
{"content":{"body":"annevk: my goodness. https://github.com/whatwg/html/issues/3599 goes through all elements during the capturing phase","msgtype":"m.text"},"ts":1536218609000,"senderName":"rniwa","senderId":"rniwa@irc"},
{"content":{"body":"annevk: so these two quirks have completely distinct behaviors :(","msgtype":"m.text"},"ts":1536218628000,"senderName":"rniwa","senderId":"rniwa@irc"},
{"content":{"body":"even within each browser!","msgtype":"m.text"},"ts":1536218637000,"senderName":"rniwa","senderId":"rniwa@irc"},
{"content":{"body":"Good times","msgtype":"m.text"},"ts":1536218984000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"rniwa: did you file an issue for the disabled control event path quirk?","msgtype":"m.text"},"ts":1536219000000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"rniwa: I agree that it makes some sense to not spread out quirks too much btw, but if they can be defined in terms of a generic mechanism that could be nice, but it seems that get the parent is not it","msgtype":"m.text"},"ts":1536219030000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"rniwa: we could also make the generic \"get the parent\" check for a [[Nope]] internal slot","msgtype":"m.text"},"ts":1536219076000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"annevk: it's https://github.com/whatwg/html/issues/2368","msgtype":"m.text"},"ts":1536219115000,"senderName":"rniwa","senderId":"rniwa@irc"},
{"content":{"body":"annevk: I think I'm a bit worried about implementing Gecko's behavior given how permissive WebKit & Blink are.","msgtype":"m.text"},"ts":1536219152000,"senderName":"rniwa","senderId":"rniwa@irc"},
{"content":{"body":"annevk: not firing event listeners sound crazy may not be the end of the world given we'd have to add some quirk somewhere","msgtype":"m.text"},"ts":1536219176000,"senderName":"rniwa","senderId":"rniwa@irc"},
{"content":{"body":"annevk: i was hoping to get away by truncating/shrinking event path for both cases but it seems like we can't due to capturing phase","msgtype":"m.text"},"ts":1536219194000,"senderName":"rniwa","senderId":"rniwa@irc"},
{"content":{"body":"Okay, I don't care too much what we end up doing; I guess I'll wait and see what smaug____ says","msgtype":"m.text"},"ts":1536219228000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"annevk: at that point, maybe we should go with whatever gets us compat with least effect","msgtype":"m.text"},"ts":1536219231000,"senderName":"rniwa","senderId":"rniwa@irc"},
{"content":{"body":"looks up","msgtype":"m.emote"},"ts":1536222148000,"senderName":"smaug____","senderId":"smaug____@irc"},
{"content":{"body":"something about disabled form elements","msgtype":"m.text"},"ts":1536222179000,"senderName":"smaug____","senderId":"smaug____@irc"},
{"content":{"body":"blink was changing and planning to change the behavior recently","msgtype":"m.text"},"ts":1536222213000,"senderName":"smaug____","senderId":"smaug____@irc"},
{"content":{"body":"oh, about the issue I filed","msgtype":"m.text"},"ts":1536222478000,"senderName":"smaug____","senderId":"smaug____@irc"},
{"content":{"body":"Hmm, I'm getting \"The requested URL returned error: 400 Bad Request\" from Bikeshed again","msgtype":"m.text"},"ts":1536238376000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"annevk: is there a way for me to file bugs on bugzilla.mozilla.org without being given the default template?","msgtype":"m.text"},"ts":1536267067000,"senderName":"TimothyGu","senderId":"TimothyGu@irc"},
{"content":{"body":"TimothyGu: you need to add &format=__default__ to the query params for the enter-bug URL","msgtype":"m.text"},"ts":1536273375000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"https://bugzilla.mozilla.org/enter_bug.cgi?product=Core&format=__default__","msgtype":"m.text"},"ts":1536273383000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"ahh","msgtype":"m.text"},"ts":1536273393000,"senderName":"TimothyGu","senderId":"TimothyGu@irc"},
{"content":{"body":"how interesting","msgtype":"m.text"},"ts":1536273397000,"senderName":"TimothyGu","senderId":"TimothyGu@irc"},
{"content":{"body":"heh yeah “interesting” is a good word for it","msgtype":"m.text"},"ts":1536273414000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"}
]
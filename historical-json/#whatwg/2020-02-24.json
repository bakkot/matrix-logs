[
{"content":{"body":"Domenic: Chrome doesn't implement the fully active part of \"check if we can run script\", right?","msgtype":"m.text"},"ts":1582515535000,"senderName":"TimothyGu","senderId":"TimothyGu@irc"},
{"content":{"body":"TimothyGu: I couldn't say off the top of my head... I'd find that a bit surprising, as avoiding non-fully active document scripts is something I'd think people like Hiroshige and Kouhei would be excited about. If you have a repro case it'd be worth filing and CCing me+them.","msgtype":"m.text"},"ts":1582515723000,"senderName":"Domenic","senderId":"Domenic@irc"},
{"content":{"body":"Oh okay. don't have a repro or anything but that seemed to be what I remembered","msgtype":"m.text"},"ts":1582515810000,"senderName":"TimothyGu","senderId":"TimothyGu@irc"},
{"content":{"body":"Hmm, why would html:script and svg:script behave differently https://github.com/web-platform-tests/wpt/blob/master/content-security-policy/nonce-hiding/script-nonces-hidden-meta.sub.html#L49 https://github.com/web-platform-tests/wpt/blob/master/content-security-policy/nonce-hiding/svgscript-nonces-hidden-meta.sub.html#L52","msgtype":"m.text"},"ts":1582557037000,"senderName":"smaug____","senderId":"smaug____@irc"},
{"content":{"body":"smaug____: I think that's a bug in the test","msgtype":"m.text"},"ts":1582557131000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"smaug____: probably because Chrome has a bug as I discovered elsewhere and they just aligned the test with their impl...","msgtype":"m.text"},"ts":1582557163000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"ah","msgtype":"m.text"},"ts":1582557175000,"senderName":"smaug____","senderId":"smaug____@irc"},
{"content":{"body":"smaug____: sigh","msgtype":"m.text"},"ts":1582557189000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"smaug____: I can prepare another patch","msgtype":"m.text"},"ts":1582557211000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"thanks","msgtype":"m.text"},"ts":1582557218000,"senderName":"smaug____","senderId":"smaug____@irc"},
{"content":{"body":"(this is why parametrized tests are nice btw, as in that case this kind of nonsense would be much more easily spotted)","msgtype":"m.text"},"ts":1582557227000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"Domenic: ^^","msgtype":"m.text"},"ts":1582557233000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"looks like mozilla repo has still the tentative variants of the tests","msgtype":"m.text"},"ts":1582557242000,"senderName":"smaug____","senderId":"smaug____@irc"},
{"content":{"body":"smaug____: yeah I saw that :/","msgtype":"m.text"},"ts":1582557255000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"smaug____: ckerschb could pull in the updated tests if he wants, I think that's okay to do","msgtype":"m.text"},"ts":1582557278000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"yup","msgtype":"m.text"},"ts":1582557294000,"senderName":"smaug____","senderId":"smaug____@irc"},
{"content":{"body":"or wait the next merge","msgtype":"m.text"},"ts":1582557299000,"senderName":"smaug____","senderId":"smaug____@irc"},
{"content":{"body":"smaug____: that mistake was present in both SVG files btw","msgtype":"m.text"},"ts":1582557910000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"ah","msgtype":"m.text"},"ts":1582557919000,"senderName":"smaug____","senderId":"smaug____@irc"},
{"content":{"body":"https://github.com/web-platform-tests/wpt/pull/21934","msgtype":"m.text"},"ts":1582557965000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"smaug____: ^","msgtype":"m.text"},"ts":1582557967000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"yup, looking","msgtype":"m.text"},"ts":1582557978000,"senderName":"smaug____","senderId":"smaug____@irc"},
{"content":{"body":"annevk: what is the change to script-nonces-hidden.html ?","msgtype":"m.text"},"ts":1582558042000,"senderName":"smaug____","senderId":"smaug____@irc"},
{"content":{"body":"smaug____: it moves \"assert_equals(eventList.length, 3);\" down, but I also added messages to the other asserts to make them more useful and the diff is the annoying result of those rather basic changes","msgtype":"m.text"},"ts":1582558200000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"so just cleanups","msgtype":"m.text"},"ts":1582558254000,"senderName":"smaug____","senderId":"smaug____@irc"},
{"content":{"body":"smaug____: aye","msgtype":"m.text"},"ts":1582558288000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"this small nonce thing has required surprisingly lots of time :/","msgtype":"m.text"},"ts":1582558308000,"senderName":"smaug____","senderId":"smaug____@irc"},
{"content":{"body":"these are the risks with one person doing tests/spec/impl","msgtype":"m.text"},"ts":1582558412000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"review can only balance so much of that and I don't think we did as careful test review back then","msgtype":"m.text"},"ts":1582558438000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"Sorry. :(","msgtype":"m.text"},"ts":1582559357000,"senderName":"mkwst","senderId":"mkwst@irc"},
{"content":{"body":"mkwst: Since you're here :) referrer-policy/ takes like 10% of the total runtime of wpt (actually more like 13% of the time running tests). Which is the single biggest directory other than css/ (and maybe html/). Do we know if there's any efficiency wins to be had there?","msgtype":"m.text"},"ts":1582559619000,"senderName":"jgraham","senderId":"jgraham@irc"},
{"content":{"body":"There 100% are efficiency wins to be had.","msgtype":"m.text"},"ts":1582559643000,"senderName":"mkwst","senderId":"mkwst@irc"},
{"content":{"body":"I think horo@(?) was poking at splitting up the `referer` header length tests, which were likely a big perf regression.","msgtype":"m.text"},"ts":1582559683000,"senderName":"mkwst","senderId":"mkwst@irc"},
{"content":{"body":"We'd added them to _all_ the tests, but that probably isn't actually helpful.","msgtype":"m.text"},"ts":1582559698000,"senderName":"mkwst","senderId":"mkwst@irc"},
{"content":{"body":"So, that's a thing we could change.","msgtype":"m.text"},"ts":1582559702000,"senderName":"mkwst","senderId":"mkwst@irc"},
{"content":{"body":"I haven't looked at the rest in detail in a long time, but there are a lot of tests there that rely on fetches and redirects and navigations, all of which is slow.","msgtype":"m.text"},"ts":1582559728000,"senderName":"mkwst","senderId":"mkwst@irc"},
{"content":{"body":"We're going to make it worse in a bit by generating tests that do similar work for fetch metadata.","msgtype":"m.text"},"ts":1582559752000,"senderName":"mkwst","senderId":"mkwst@irc"},
{"content":{"body":"There's likely room for us to collaborate on figuring out a way to test multiple things at once about a given response so that we make a given request once  and test all the features, rather than making the request once per feature.","msgtype":"m.text"},"ts":1582559796000,"senderName":"mkwst","senderId":"mkwst@irc"},
{"content":{"body":"But that's something of a large project.","msgtype":"m.text"},"ts":1582559804000,"senderName":"mkwst","senderId":"mkwst@irc"},
{"content":{"body":"OK, thanks. Sounds like there is work that can be done, but not a lot of known low-hanging-fruit","msgtype":"m.text"},"ts":1582559926000,"senderName":"jgraham","senderId":"jgraham@irc"},
{"content":{"body":"Wow, referrer-policy is definitely on the extreme side of templating in tests","msgtype":"m.text"},"ts":1582561088000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"https://hoppipolla.co.uk/410/wpt-flame.svg is the graph I'm using for the 10% number btw; shows which tests are slow in gecko","msgtype":"m.text"},"ts":1582561903000,"senderName":"jgraham","senderId":"jgraham@irc"},
{"content":{"body":"Encodings also seems excessive","msgtype":"m.text"},"ts":1582562620000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"Or maybe lots of things are tested poorly","msgtype":"m.text"},"ts":1582562634000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"I presume encoding is caused by encoding/legacy-mb-*","msgtype":"m.text"},"ts":1582562733000,"senderName":"gsnedders","senderId":"gsnedders@irc"},
{"content":{"body":"yeah, it is","msgtype":"m.text"},"ts":1582562749000,"senderName":"gsnedders","senderId":"gsnedders@irc"},
{"content":{"body":"Looks like we spend ~10 minutes on each of those","msgtype":"m.text"},"ts":1582562852000,"senderName":"jgraham","senderId":"jgraham@irc"},
{"content":{"body":"Unfortunately the way those tests are written also makes it hard to refactor them","msgtype":"m.text"},"ts":1582565258000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"jgraham: gsnedders: starting with some kind of coding guidelines around tests might be good","msgtype":"m.text"},"ts":1582565310000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"jgraham: gsnedders: might have kept the free-for-all thing going for a bit too long?","msgtype":"m.text"},"ts":1582565327000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"annevk: as long as we have two-way syncing, it's hard to get buy in for anything stricter than existing browser testsuites :(","msgtype":"m.text"},"ts":1582565785000,"senderName":"gsnedders","senderId":"gsnedders@irc"},
{"content":{"body":"annevk: also unclear how to enforce any sort of coding guidelines with so many potential reviewers (i.e., basically everyone with commit access to browsers)","msgtype":"m.text"},"ts":1582565820000,"senderName":"gsnedders","senderId":"gsnedders@irc"},
{"content":{"body":"gsnedders: the status quo where it depends on who you ask for review is also rather terrible, so I'd like us to at least try to do better","msgtype":"m.text"},"ts":1582566219000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"gsnedders: perhaps it doesn't prevent bad stuff from getting in, but at least there's some kind of baseline to measure things against","msgtype":"m.text"},"ts":1582566258000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"jgraham: nice use of flame graphs :) - how was that generated?","msgtype":"m.text"},"ts":1582575565000,"senderName":"Krinkle","senderId":"Krinkle@irc"},
{"content":{"body":"instrumented within the JS codee?","msgtype":"m.text"},"ts":1582575574000,"senderName":"Krinkle","senderId":"Krinkle@irc"},
{"content":{"body":"Krinkle: pretty sure it's post-processing of the log files from the runner","msgtype":"m.text"},"ts":1582576457000,"senderName":"gsnedders","senderId":"gsnedders@irc"},
{"content":{"body":"Krinkle: (where the runner is Python)","msgtype":"m.text"},"ts":1582576503000,"senderName":"gsnedders","senderId":"gsnedders@irc"}
]
[
{"content":{"body":"zcorpan_: what's the difference?","msgtype":"m.text"},"ts":1599811432000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"annevk: difference between what?","msgtype":"m.text"},"ts":1599811493000,"senderName":"zcorpan_","senderId":"zcorpan_@irc"},
{"content":{"body":"zcorpan_: speculative fetches and parsing","msgtype":"m.text"},"ts":1599811535000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"annevk: so speculative fetches can happen both from speculative parser and non-speculative parser","msgtype":"m.text"},"ts":1599811606000,"senderName":"zcorpan_","senderId":"zcorpan_@irc"},
{"content":{"body":"annevk: with normal parsing, the tree builder decides to speculatively fetch e.g. a stylesheet when it processes the \"link\" token. the parser batches DOM insertions so the element can be inserted to the DOM at some later time","msgtype":"m.text"},"ts":1599811727000,"senderName":"zcorpan_","senderId":"zcorpan_@irc"},
{"content":{"body":"(and scripts have opportunity to modify the DOM in between)","msgtype":"m.text"},"ts":1599811786000,"senderName":"zcorpan_","senderId":"zcorpan_@irc"},
{"content":{"body":"from what I can tell, that's the case that's relevant for https://github.com/privacycg/proposals/issues/19 -- not speculative fetches from speculative parser","msgtype":"m.text"},"ts":1599811878000,"senderName":"zcorpan_","senderId":"zcorpan_@irc"},
{"content":{"body":"Is the main difference that the speculative parser can be confused by document.write()? Though maybe the real parser can be confused by script too if it moved the node to a document that doesn't fetch?","msgtype":"m.text"},"ts":1599811977000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"if by confused you mean that a speculative fetch turns out to be invalid, then yeah the normal parser can't be confused by document.write because ... there's no speculative parsing :) but indeed, a script can insert a CSP meta or move or remove a parent element after the normal parser started a speculative fetch","msgtype":"m.text"},"ts":1599812182000,"senderName":"zcorpan_","senderId":"zcorpan_@irc"},
{"content":{"body":"othermaciej also mentioned predictive speculative fetches, which wouldn't come from either parser but happen as part of navigation or so","msgtype":"m.text"},"ts":1599812456000,"senderName":"zcorpan_","senderId":"zcorpan_@irc"},
{"content":{"body":"Thanks, to get back to the earlier questions, I think we should define when fetches can happen (and what \"security context\" they happen in) and how they get de-duplicated with \"actual\" fetches later","msgtype":"m.text"},"ts":1599812739000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":":+1:","msgtype":"m.text"},"ts":1599813902000,"senderName":"zcorpan_","senderId":"zcorpan_@irc"},
{"content":{"body":"annevk: FYI, I raised https://github.com/tabatkins/bikeshed/issues/1763 proposing that Bikeshed output have “This section is non-normative” text the way the HTML spec does.","msgtype":"m.text"},"ts":1599814695000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"MikeSmith: sounds cool","msgtype":"m.text"},"ts":1599814756000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"from looking at the Bikeshed source, I think adding class=non-normative to any element will cause Bikeshed to consider that element and descendants to be non-normative","msgtype":"m.text"},"ts":1599814779000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"but I don’t know if we are using sections in our Bikeshed specs","msgtype":"m.text"},"ts":1599814801000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"if not, then maybe Bikeshed would need to support it through comments, as we do with the HTML spec","msgtype":"m.text"},"ts":1599814835000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"<!-- NON-NORMATIVE SECTION -->","msgtype":"m.text"},"ts":1599814846000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"MikeSmith: we do not have sections currently, but we maybe should at least for algorithms as it adds some useful reading tools","msgtype":"m.text"},"ts":1599814897000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"such as highlighting variables","msgtype":"m.text"},"ts":1599814903000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"hmm yeah","msgtype":"m.text"},"ts":1599814908000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"well for now maybe if we just added class=non-normative to the headings in the spec sources","msgtype":"m.text"},"ts":1599814963000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"and then the Bikeshed behavior would be to emit a “This section is non-normative” paragraph after any such heading","msgtype":"m.text"},"ts":1599815008000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"...if that doesn’t sound too hacky","msgtype":"m.text"},"ts":1599815023000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"that way at least we wouldn’t need to add explit section wrappers just to get this, and I wouldn’t need to implement the <!-- NON-NORMATIVE SECTION --> comment thing in Bikeshed","msgtype":"m.text"},"ts":1599815092000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"to me, that <!-- NON-NORMATIVE SECTION --> comment thing seems much more like a hack than just putting some class on the headings","msgtype":"m.text"},"ts":1599815116000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"MikeSmith: yeah that seems fine","msgtype":"m.text"},"ts":1599815579000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"Actual <section> wrappers would also allow position: sticky headings; see https://github.com/whatwg/whatwg.org/issues/320","msgtype":"m.text"},"ts":1599839308000,"senderName":"Domenic","senderId":"Domenic@irc"},
{"content":{"body":"Also maybe Bikeshed/Wattsi could translate <h1> into <hN>  based on section depth","msgtype":"m.text"},"ts":1599839324000,"senderName":"Domenic","senderId":"Domenic@irc"},
{"content":{"body":"To make authoring a bit nicer.","msgtype":"m.text"},"ts":1599839327000,"senderName":"Domenic","senderId":"Domenic@irc"}
]
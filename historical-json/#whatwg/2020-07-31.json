[
{"content":{"body":"zcorpan annevk: window.innerWidth is an integer, but when DPR != 1, the actual bounds may have a fractional part. This feels weird to me, but has it ever come up or been problematic?","msgtype":"m.text"},"ts":1596206853000,"senderName":"eeeps","senderId":"eeeps@irc"},
{"content":{"body":"devsnek: I would use DOM access instead of regex, but that seems about right in general. Or use the URL, but I'm assuming that's not on the table for you.","msgtype":"m.text"},"ts":1596216190000,"senderName":"Domenic","senderId":"Domenic@irc"},
{"content":{"body":"Domenic: you mean parse html -> insert thing -> stringify?","msgtype":"m.text"},"ts":1596216233000,"senderName":"devsnek","senderId":"devsnek@irc"},
{"content":{"body":"devsnek: I mean if you're running JS then just do `document.head.firstChild` or something instead of regexing `document.outerHTML`.","msgtype":"m.text"},"ts":1596216281000,"senderName":"Domenic","senderId":"Domenic@irc"},
{"content":{"body":"well it has to be inserted","msgtype":"m.text"},"ts":1596216303000,"senderName":"devsnek","senderId":"devsnek@irc"},
{"content":{"body":"the metadata i mean","msgtype":"m.text"},"ts":1596216312000,"senderName":"devsnek","senderId":"devsnek@irc"},
{"content":{"body":"Oh I thought you were talking about regexing it out, not inserting it","msgtype":"m.text"},"ts":1596216313000,"senderName":"Domenic","senderId":"Domenic@irc"},
{"content":{"body":"On the insertion I'd just prefix it","msgtype":"m.text"},"ts":1596216326000,"senderName":"Domenic","senderId":"Domenic@irc"},
{"content":{"body":"I think that works...","msgtype":"m.text"},"ts":1596216330000,"senderName":"Domenic","senderId":"Domenic@irc"},
{"content":{"body":"sounds quirky","msgtype":"m.text"},"ts":1596216350000,"senderName":"devsnek","senderId":"devsnek@irc"},
{"content":{"body":"http://software.hixie.ch/utilities/js/live-dom-viewer/?saved=8325","msgtype":"m.text"},"ts":1596216400000,"senderName":"Domenic","senderId":"Domenic@irc"},
{"content":{"body":"oh","msgtype":"m.text"},"ts":1596216423000,"senderName":"devsnek","senderId":"devsnek@irc"},
{"content":{"body":"that's really cool","msgtype":"m.text"},"ts":1596216439000,"senderName":"devsnek","senderId":"devsnek@irc"},
{"content":{"body":"thx","msgtype":"m.text"},"ts":1596216440000,"senderName":"devsnek","senderId":"devsnek@irc"},
{"content":{"body":"devsnek: assuming you can control the server, you  could  also add an attribute or  export a native JS value.e.g. <html data-foo=\"\"> a nd then  document.documentElement.dataset.foo  (or docEl.getAttribute('data-foo')), or  e.g.  <html><script>X_MYDATA={ \"some\": \"data  here\"}</script> and then  access the the X_MYDATA variable in JS anytime. the server  could  use a JSON encoder  to  export the data safely.","msgtype":"m.text"},"ts":1596228138000,"senderName":"Krinkle","senderId":"Krinkle@irc"},
{"content":{"body":"Krinkle: can control the server, the main issue would be that parsing and stringifying the html would not be great for latency","msgtype":"m.text"},"ts":1596228189000,"senderName":"devsnek","senderId":"devsnek@irc"},
{"content":{"body":"devsnek: where  would htere be parsing and stringifying of html?","msgtype":"m.text"},"ts":1596228231000,"senderName":"Krinkle","senderId":"Krinkle@irc"},
{"content":{"body":"how do you insert tags in the document without knowing where to insert them","msgtype":"m.text"},"ts":1596228255000,"senderName":"devsnek","senderId":"devsnek@irc"},
{"content":{"body":"you want to use JS to read it, not to  insert it, right?","msgtype":"m.text"},"ts":1596228282000,"senderName":"Krinkle","senderId":"Krinkle@irc"},
{"content":{"body":"both","msgtype":"m.text"},"ts":1596228291000,"senderName":"devsnek","senderId":"devsnek@irc"},
{"content":{"body":"the server can presumably  just print it as  part of its HTML buffer.","msgtype":"m.text"},"ts":1596228294000,"senderName":"Krinkle","senderId":"Krinkle@irc"},
{"content":{"body":"how is the HTML  page  built?","msgtype":"m.text"},"ts":1596228301000,"senderName":"Krinkle","senderId":"Krinkle@irc"},
{"content":{"body":"imagine an express middleware","msgtype":"m.text"},"ts":1596228302000,"senderName":"devsnek","senderId":"devsnek@irc"},
{"content":{"body":"idk how the html page is built, i just have a string of html","msgtype":"m.text"},"ts":1596228312000,"senderName":"devsnek","senderId":"devsnek@irc"},
{"content":{"body":"hm.. that seems fragile to me, is  there not any kind of contract  you an establish with the surrounding server? I  mean, what's to say there isn't another  thing trying a similar thing then?","msgtype":"m.text"},"ts":1596228351000,"senderName":"Krinkle","senderId":"Krinkle@irc"},
{"content":{"body":"there isn't","msgtype":"m.text"},"ts":1596228364000,"senderName":"devsnek","senderId":"devsnek@irc"},
{"content":{"body":"so you know nothing  about the server, but you do know  you're the only one trying to export data?","msgtype":"m.text"},"ts":1596228385000,"senderName":"Krinkle","senderId":"Krinkle@irc"},
{"content":{"body":"I suppose it might be a static  html proxy/server?","msgtype":"m.text"},"ts":1596228403000,"senderName":"Krinkle","senderId":"Krinkle@irc"},
{"content":{"body":"i mean there's no way to say someone else isn't also trying to do a similar thing at the same time","msgtype":"m.text"},"ts":1596228466000,"senderName":"devsnek","senderId":"devsnek@irc"},
{"content":{"body":"https://www.moesif.com/blog/engineering/middleware/What-Is-HTTP-Middleware/","msgtype":"m.text"},"ts":1596228488000,"senderName":"devsnek","senderId":"devsnek@irc"},
{"content":{"body":"anyhow, if you can assume at least that it's a well-formed  HTML document (doctype +html + head+ body, note that all these are strictly speaking optional) , then a limited string search  for  the first  <head> seems reasonable enough to string-replace and add your  <script> there. That way it is not prone to breaking if someone else does the same thing so long as you use different  variable names.","msgtype":"m.text"},"ts":1596228533000,"senderName":"Krinkle","senderId":"Krinkle@irc"},
{"content":{"body":"e.g. <head><script>OTHERLIB=2</script><script>MYLIBDATA=1</script> will still do what you need, not so much if there's two HTML comments, that becomes  harder  to  deal with.","msgtype":"m.text"},"ts":1596228602000,"senderName":"Krinkle","senderId":"Krinkle@irc"},
{"content":{"body":"of course if the original page does have something positional in its <head> then this would break what document.head.firstChild  points to.","msgtype":"m.text"},"ts":1596228658000,"senderName":"Krinkle","senderId":"Krinkle@irc"},
{"content":{"body":"how does the consumer of the data arrive on the  page, perhaps you can  ship the data through there.","msgtype":"m.text"},"ts":1596228675000,"senderName":"Krinkle","senderId":"Krinkle@irc"},
{"content":{"body":"e.g. if  you know  the consumer is loaded late, you could choose to append the  script at the  end  instead, the only reason to  insert it early  would be if you don't know  when the consumer might look for it.","msgtype":"m.text"},"ts":1596228733000,"senderName":"Krinkle","senderId":"Krinkle@irc"},
{"content":{"body":"Use  of lastChild/:last-child is  relatively rare so  would be less risky in  terms of not breaking  compat  with the  original documen","msgtype":"m.text"},"ts":1596228788000,"senderName":"Krinkle","senderId":"Krinkle@irc"}
]
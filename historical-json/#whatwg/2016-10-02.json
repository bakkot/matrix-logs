[
{"content":{"body":"Is UIEvent supposed to be exposed only on Window?","msgtype":"m.text"},"ts":1475416844000,"senderName":"nox","senderId":"nox@irc"},
{"content":{"body":"nox: seems logical","msgtype":"m.text"},"ts":1475417662000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"esprehn: you might recall why HTML spec has compound microtasks?","msgtype":"m.text"},"ts":1475442644000,"senderName":"smaug","senderId":"smaug@irc"},
{"content":{"body":"I'm not familiar with that term","msgtype":"m.text"},"ts":1475442777000,"senderName":"esprehn","senderId":"esprehn@irc"},
{"content":{"body":"ah. I'm mostly wondering why MutationObservers and others (well, Promises) get processed differently","msgtype":"m.text"},"ts":1475442829000,"senderName":"smaug","senderId":"smaug@irc"},
{"content":{"body":"feels like a bug to me, but I'm clearly missing something, since I don't know why we have these special cases","msgtype":"m.text"},"ts":1475442868000,"senderName":"smaug","senderId":"smaug@irc"},
{"content":{"body":"smaug: the spec doesn't define the term, this whole section probably needs some love","msgtype":"m.text"},"ts":1475443047000,"senderName":"esprehn","senderId":"esprehn@irc"},
{"content":{"body":"it looks like compound microtask are related to spinning nested event loops if im reading this right","msgtype":"m.text"},"ts":1475443072000,"senderName":"esprehn","senderId":"esprehn@irc"},
{"content":{"body":"well, https://dom.spec.whatwg.org/#queue-a-mutation-observer-compound-microtask","msgtype":"m.text"},"ts":1475443075000,"senderName":"smaug","senderId":"smaug@irc"},
{"content":{"body":"and then HTML spec uses that","msgtype":"m.text"},"ts":1475443087000,"senderName":"smaug","senderId":"smaug@irc"},
{"content":{"body":"but I don't understand why MutationObservers are special here","msgtype":"m.text"},"ts":1475443101000,"senderName":"smaug","senderId":"smaug@irc"},
{"content":{"body":"hmm that looks like batching ?","msgtype":"m.text"},"ts":1475443178000,"senderName":"esprehn","senderId":"esprehn@irc"},
{"content":{"body":"the spec needs to define what a compound vs ... microtask is and what they're for","msgtype":"m.text"},"ts":1475443195000,"senderName":"esprehn","senderId":"esprehn@irc"},
{"content":{"body":"Why each MO couldn't be notified as a normal microtask?","msgtype":"m.text"},"ts":1475443400000,"senderName":"smaug","senderId":"smaug@irc"},
{"content":{"body":"smaug: or not. this actually seems like it's trying to describe the behavior where mutations inside microtasks queue more MutationObserver deliveries","msgtype":"m.text"},"ts":1475443433000,"senderName":"esprehn","senderId":"esprehn@irc"},
{"content":{"body":"that's a good question. I dont think we have any of this special handling in the engine. I'm curious what the spec is trying to do here.","msgtype":"m.text"},"ts":1475443470000,"senderName":"esprehn","senderId":"esprehn@irc"},
{"content":{"body":"esprehn: ok. thanks. I'll try hunt the source for this particular spec text tomorrow.","msgtype":"m.text"},"ts":1475443588000,"senderName":"smaug","senderId":"smaug@irc"},
{"content":{"body":"our system is based on a scope with a depth counter. when the scope is exited and the depth is zero run microtasks. anything that would queue a microtask while in the process of delivering microtasks prolongs that delivery step.","msgtype":"m.text"},"ts":1475443593000,"senderName":"esprehn","senderId":"esprehn@irc"},
{"content":{"body":"maybe Domenic remembers","msgtype":"m.text"},"ts":1475443595000,"senderName":"smaug","senderId":"smaug@irc"},
{"content":{"body":"in Gecko MT (MutationObserver one, not the buggy Promise stuff) is also based on depth number","msgtype":"m.text"},"ts":1475443633000,"senderName":"smaug","senderId":"smaug@irc"},
{"content":{"body":"This was Raf Weinstein's design I believe","msgtype":"m.text"},"ts":1475443633000,"senderName":"Domenic","senderId":"Domenic@irc"},
{"content":{"body":"upon returning to the event loop we always perform a checkpoint as well","msgtype":"m.text"},"ts":1475443642000,"senderName":"esprehn","senderId":"esprehn@irc"},
{"content":{"body":"Something about ensuring that the order of the mutation observers are notified is the same as the order they were subscribed in","msgtype":"m.text"},"ts":1475443646000,"senderName":"Domenic","senderId":"Domenic@irc"},
{"content":{"body":"So you just have a single microtask that then runs through all the mutation observers or something. That's what a compound microtask is, I think.","msgtype":"m.text"},"ts":1475443664000,"senderName":"Domenic","senderId":"Domenic@irc"},
{"content":{"body":"which catches cases like editing or the parser mutating without calling into script","msgtype":"m.text"},"ts":1475443666000,"senderName":"esprehn","senderId":"esprehn@irc"},
{"content":{"body":"(whereas if you used normal microtasks it would just notify in the order that the mutations happened, which is for some reason not desired)","msgtype":"m.text"},"ts":1475443683000,"senderName":"Domenic","senderId":"Domenic@irc"},
{"content":{"body":"Domenic: microtask processing in the spec is pretty confusing. I wish this was more pseudo code like.","msgtype":"m.text"},"ts":1475443717000,"senderName":"esprehn","senderId":"esprehn@irc"},
{"content":{"body":":)","msgtype":"m.text"},"ts":1475443724000,"senderName":"esprehn","senderId":"esprehn@irc"},
{"content":{"body":"esprehn: concrete suggestions would be helpful; from my perspective it's pretty straightforward and algorithmic, but I'm sure I'm just too deep into it.","msgtype":"m.text"},"ts":1475443747000,"senderName":"Domenic","senderId":"Domenic@irc"},
{"content":{"body":"Anyway yeah tomorrow someone should dig up the old bugs where I'm sure Hixie and raf had a long back and forth designing this system","msgtype":"m.text"},"ts":1475443764000,"senderName":"Domenic","senderId":"Domenic@irc"},
{"content":{"body":"for starters the spec should define what the two types are","msgtype":"m.text"},"ts":1475443903000,"senderName":"esprehn","senderId":"esprehn@irc"},
{"content":{"body":"it just mentions them and the links back are to the mentions, not to descriptions of their purpose","msgtype":"m.text"},"ts":1475443932000,"senderName":"esprehn","senderId":"esprehn@irc"},
{"content":{"body":"ah i see yeah","msgtype":"m.text"},"ts":1475443987000,"senderName":"Domenic","senderId":"Domenic@irc"},
{"content":{"body":"oh yeah, I was wondering what \"solitary callback microtasks\" are couple of days ago.","msgtype":"m.text"},"ts":1475443998000,"senderName":"smaug","senderId":"smaug@irc"},
{"content":{"body":"the spec doesn't really guarantee ordering of MO. If callback for MO A modifies DOM, MO's after A will get notified first, since callback for MO A will be called only after 'perform a microtask checkpoint' is called the next time","msgtype":"m.text"},"ts":1475444504000,"senderName":"smaug","senderId":"smaug@irc"},
{"content":{"body":"hmm","msgtype":"m.text"},"ts":1475444506000,"senderName":"smaug","senderId":"smaug@irc"}
]
[
{"content":{"body":"zewt: http://validator.w3.org/nu/ has an option that lets you persistently filter out any errors or warnings you don't want to see","msgtype":"m.text"},"ts":1392868778000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"after you check a document, you'll see a \"Message filtering\" button. If you press that, it'll show you all the messages with  show/hide checkboxes","msgtype":"m.text"},"ts":1392868872000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"but I don't know why it would be giving errors or warnings for non-80 ports","msgtype":"m.text"},"ts":1392868973000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"OK after looking at the code I find the reason you're seeing that message is because of the library we're currently using for URL checking","msgtype":"m.text"},"ts":1392870251000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"it has a warning case for this","msgtype":"m.text"},"ts":1392870269000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"http://jena.sourceforge.net/iri/javadoc/com/hp/hpl/jena/iri/ViolationCodes.html#PORT_SHOULD_NOT_BE_WELL_KNOWN","msgtype":"m.text"},"ts":1392870270000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"and the reason that library does it is because of http://www.apps.ietf.org/rfc/rfc3986.html#sec-7.2","msgtype":"m.text"},"ts":1392870313000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"but I agree there's no reason we should be emitting it from the validator so I'll patch the sources to just drop it on the floor","msgtype":"m.text"},"ts":1392870416000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"for now","msgtype":"m.text"},"ts":1392870429000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"but the plan is to replace that library anyway, using smola's library that's based on the current URL standard","msgtype":"m.text"},"ts":1392870485000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"zewt: fixed https://github.com/validator/syntax/commit/d815de537a86d4334294725d40f077ee2eb0cde9","msgtype":"m.text"},"ts":1392871780000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"and pushed to http://validator.w3.org/nu/","msgtype":"m.text"},"ts":1392871793000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"Hixie: about ins & del the thing that confused me is that there are UA requirements there but I couldn't see how to actually test that UA conforms to them","msgtype":"m.text"},"ts":1392871866000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"Hixie: http://lists.w3.org/Archives/Public/public-whatwg-archive/2014Feb/0100.html doesn't seem like a usability win","msgtype":"m.text"},"ts":1392874380000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"(message from tkent about input@type=number)","msgtype":"m.text"},"ts":1392874401000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"MikeSmith: yeah, there's been a bunch of feedback on type=number that i need to go through","msgtype":"m.text"},"ts":1392877117000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"MikeSmith: re ins/del, you mean about parsing datetime?","msgtype":"m.text"},"ts":1392877158000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"Hixie: yeah, that","msgtype":"m.text"},"ts":1392877166000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"MikeSmith: that's mostly just there in case a tool wants to do something with the attribute... but yeah, nobody is required to do anything with it, so it's a bit fluffy","msgtype":"m.text"},"ts":1392877190000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"ok","msgtype":"m.text"},"ts":1392877198000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"Makefile:16: *** missing separator (did you mean TAB instead of 8 spaces?).  Stop.","msgtype":"m.text"},"ts":1392877367000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"i think the existence of that error message is an insult.","msgtype":"m.text"},"ts":1392877379000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"i often mistakenly type 8 spaces when i forget it's much easier to press that other key in notepad","msgtype":"m.text"},"ts":1392877591000,"senderName":"zcorpan","senderId":"zcorpan@irc"},
{"content":{"body":"the joys of makefiles","msgtype":"m.text"},"ts":1392877888000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"I guess to be cool you're supposed to be using something else these days","msgtype":"m.text"},"ts":1392877918000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"implement make in javascript","msgtype":"m.text"},"ts":1392878054000,"senderName":"zcorpan","senderId":"zcorpan@irc"},
{"content":{"body":"wonders if zcorpan is traveling or just up early","msgtype":"m.emote"},"ts":1392878510000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"the latter, but i'm usually up early when wfh","msgtype":"m.text"},"ts":1392878648000,"senderName":"zcorpan","senderId":"zcorpan@irc"},
{"content":{"body":"seems to me then you probably don't sleep enough","msgtype":"m.text"},"ts":1392878759000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"around 8h","msgtype":"m.text"},"ts":1392878886000,"senderName":"zcorpan","senderId":"zcorpan@irc"},
{"content":{"body":"oh","msgtype":"m.text"},"ts":1392878985000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"well then I guess you do","msgtype":"m.text"},"ts":1392879000000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"not sleeping enough is bad for the health, so i try not to. but sometimes i do anyway if i get stuck reading about interesting things, e.g. health related stuff (ironically)","msgtype":"m.text"},"ts":1392879018000,"senderName":"zcorpan","senderId":"zcorpan@irc"},
{"content":{"body":"just I still see you on sometimes at like 8am Japan time","msgtype":"m.text"},"ts":1392879020000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"hah","msgtype":"m.text"},"ts":1392879027000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"yeah from what I understand you're really supposed to get 8hours of sleep","msgtype":"m.text"},"ts":1392879051000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"not you personally","msgtype":"m.text"},"ts":1392879068000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"*we're really supposed to","msgtype":"m.text"},"ts":1392879092000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"anyway, https://twitter.com/snystrom/status/436387977259139072 and http://sequoiacapital.tumblr.com/post/77211282835/four-numbers-that-explain-why-facebook-acquired","msgtype":"m.text"},"ts":1392879152000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"WhatsApp apparently has only 32 engineers","msgtype":"m.text"},"ts":1392879173000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"that aquisition boggles my mind","msgtype":"m.text"},"ts":1392879197000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"buying the users I guess","msgtype":"m.text"},"ts":1392879254000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"since it's pretty much commodity technology","msgtype":"m.text"},"ts":1392879280000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"$35 a user is pretty high.","msgtype":"m.text"},"ts":1392879297000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"i wonder how many of their 450 million users have crossed the 1-year mark when they have to pay","msgtype":"m.text"},"ts":1392879361000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"anyhoo, i should head to bed. nn.","msgtype":"m.text"},"ts":1392879391000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"night","msgtype":"m.text"},"ts":1392879399000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"https://twitter.com/edds/status/436395256192704512 makes the buy look reasonableâ€¦","msgtype":"m.text"},"ts":1392889906000,"senderName":"annevk-cloud","senderId":"annevk-cloud@irc"},
{"content":{"body":"annevk-cloud: canna read that","msgtype":"m.text"},"ts":1392890462000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"tweets protected","msgtype":"m.text"},"ts":1392890469000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"Oh sorry, it compares money per user with other acquisitions such as YouTube","msgtype":"m.text"},"ts":1392891240000,"senderName":"annevk-cloud","senderId":"annevk-cloud@irc"},
{"content":{"body":"All about the same","msgtype":"m.text"},"ts":1392891284000,"senderName":"annevk-cloud","senderId":"annevk-cloud@irc"},
{"content":{"body":"ok","msgtype":"m.text"},"ts":1392891543000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"annevk-cloud: so the money per use for whatsapp comes from users paying a subscription fee?","msgtype":"m.text"},"ts":1392891579000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"*per user","msgtype":"m.text"},"ts":1392891586000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"oh wait I guess you don't mean that","msgtype":"m.text"},"ts":1392891631000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"you mean the cost of the acquisition compared to the number of users it brings","msgtype":"m.text"},"ts":1392891656000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"so for YouTube is must have also been about $35 per user","msgtype":"m.text"},"ts":1392891741000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"\"Skype was acquired by eBay in 2005 for $2.6 billion, working out to roughly $240 per user. Google bought YouTube for $1.65 billion, or nearly $49 per user\"","msgtype":"m.text"},"ts":1392892134000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"http://www.investopedia.com/financial-edge/0412/did-facebook-overpay-for-instagram.aspx","msgtype":"m.text"},"ts":1392892143000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"It's still crazy. Imagine that kind of money being invested into industry, transportation or raw materials instead. You'd get a much quicker return.","msgtype":"m.text"},"ts":1392892403000,"senderName":"wilhelm","senderId":"wilhelm@irc"},
{"content":{"body":"wow del.icio.us acquisition was $150 per user","msgtype":"m.text"},"ts":1392892430000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"wilhelm: sure","msgtype":"m.text"},"ts":1392892437000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"fwiw there's a longer list at https://docs.google.com/spreadsheet/pub?key=0Ag0BxADNLZqgdHdzYVR3a3BoM09jLUxNMC1lMDk2amc","msgtype":"m.text"},"ts":1392892559000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"anyway in other news I set up https://github.com/whatwg/web-history/blob/master/README.md today","msgtype":"m.text"},"ts":1392892737000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"contributions encouraged","msgtype":"m.text"},"ts":1392892743000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"it's pretty thin from 2009 on","msgtype":"m.text"},"ts":1392892779000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"planning to add more when I can but in the mean time maybe somebody else could add a few things","msgtype":"m.text"},"ts":1392892832000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"hi, I want to know what is host, inclusive ancestor and host-including inclusive ancestor, can someone please explain, if possible with example?","msgtype":"m.text"},"ts":1392895827000,"senderName":"bhanu","senderId":"bhanu@irc"},
{"content":{"body":"bhanu: that's in the DOM spec isn't it","msgtype":"m.text"},"ts":1392896370000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"are you reading some other spec that uses it?","msgtype":"m.text"},"ts":1392896378000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"http://robert.ocallahan.org/2014/02/3-mile-limit.html is pretty cool","msgtype":"m.text"},"ts":1392896427000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"MikeSmith: I couldn't follow it clearly from the spec, so want to understand it","msgtype":"m.text"},"ts":1392896434000,"senderName":"bhanu","senderId":"bhanu@irc"},
{"content":{"body":"bhanu: I guess you want to ask annevk-cloud when he's around","msgtype":"m.text"},"ts":1392896488000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"or Ms2ger","msgtype":"m.text"},"ts":1392896502000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"MikeSmith: I will check with them","msgtype":"m.text"},"ts":1392896529000,"senderName":"bhanu","senderId":"bhanu@irc"},
{"content":{"body":"annevk :)","msgtype":"m.text"},"ts":1392896534000,"senderName":"Ms2ger","senderId":"Ms2ger@irc"},
{"content":{"body":"Or dglazkov","msgtype":"m.text"},"ts":1392896552000,"senderName":"Ms2ger","senderId":"Ms2ger@irc"},
{"content":{"body":"Ms2ger: will check with dglazkov since annevk seems to be offline","msgtype":"m.text"},"ts":1392896652000,"senderName":"bhanu","senderId":"bhanu@irc"},
{"content":{"body":"dglazkov: hi, I couldn't clearly understand the terminologies i.e host, inclusive ancestor and host-including inclusive ancestor","msgtype":"m.text"},"ts":1392896745000,"senderName":"bhanu","senderId":"bhanu@irc"},
{"content":{"body":"dglazkov won't be online for a while yet","msgtype":"m.text"},"ts":1392896753000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"like 4 hours or so","msgtype":"m.text"},"ts":1392896771000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"MikeSmith: oh ok, will check with him later, thanks","msgtype":"m.text"},"ts":1392896788000,"senderName":"bhanu","senderId":"bhanu@irc"},
{"content":{"body":"GPHemsley: http://mimesniff.spec.whatwg.org/#parse-a-mime-type compares bytes to code points","msgtype":"m.text"},"ts":1392897301000,"senderName":"zcorpan","senderId":"zcorpan@irc"},
{"content":{"body":"zcorpan: r? https://critic.hoppipolla.co.uk/r/824 (a few simple validator tests for ins|del@datetime)","msgtype":"m.text"},"ts":1392898868000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"MikeSmith: i was now reminded of \"del elements should not cross implied paragraph boundaries.\"","msgtype":"m.text"},"ts":1392898997000,"senderName":"zcorpan","senderId":"zcorpan@irc"},
{"content":{"body":"which seems like a \"fun\" thing to check for","msgtype":"m.text"},"ts":1392899018000,"senderName":"zcorpan","senderId":"zcorpan@irc"},
{"content":{"body":"what that","msgtype":"m.text"},"ts":1392899022000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"looks at spec","msgtype":"m.emote"},"ts":1392899027000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"hmm yeah","msgtype":"m.text"},"ts":1392899239000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"we don't check for that yet","msgtype":"m.text"},"ts":1392899265000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"I'll raise a bug for it","msgtype":"m.text"},"ts":1392899273000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"zcorpan: http://bugzilla.validator.nu/show_bug.cgi?id=986","msgtype":"m.text"},"ts":1392899994000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"hmm... http://syntax.whatwg.org/ was apparently once a working URL","msgtype":"m.text"},"ts":1392902709000,"senderName":"GPHemsley","senderId":"GPHemsley@irc"},
{"content":{"body":"(it is no longer)","msgtype":"m.text"},"ts":1392902713000,"senderName":"GPHemsley","senderId":"GPHemsley@irc"},
{"content":{"body":"zcorpan: Filed https://www.w3.org/Bugs/Public/show_bug.cgi?id=24745","msgtype":"m.text"},"ts":1392903050000,"senderName":"GPHemsley","senderId":"GPHemsley@irc"},
{"content":{"body":"MikeSmith: you might reject asking for that review","msgtype":"m.text"},"ts":1392903096000,"senderName":"zcorpan","senderId":"zcorpan@irc"},
{"content":{"body":"er","msgtype":"m.text"},"ts":1392903100000,"senderName":"zcorpan","senderId":"zcorpan@irc"},
{"content":{"body":"regret","msgtype":"m.text"},"ts":1392903102000,"senderName":"zcorpan","senderId":"zcorpan@irc"},
{"content":{"body":"zcorpan: any review is a good review","msgtype":"m.text"},"ts":1392904760000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"I don't mind adding more stuff","msgtype":"m.text"},"ts":1392904800000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"would be nice to get people contributing validator test cases but I don't hold out much hope for that happening, given how hard it is to just get regular tests","msgtype":"m.text"},"ts":1392904862000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"ok i think i'm done now","msgtype":"m.text"},"ts":1392905000000,"senderName":"zcorpan","senderId":"zcorpan@irc"},
{"content":{"body":"whew","msgtype":"m.text"},"ts":1392905313000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"heh it's less than it coulda been","msgtype":"m.text"},"ts":1392905362000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"anyway, maybe we need to separate the tests out to .. somewhere else","msgtype":"m.text"},"ts":1392905405000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"I mean other then in the dirs for ins/del","msgtype":"m.text"},"ts":1392905415000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"hmm no, can't do that because datetime for <time> is less restrictive","msgtype":"m.text"},"ts":1392905448000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"so need to keep them with the elements","msgtype":"m.text"},"ts":1392905476000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"but you could test ins and del in the same page","msgtype":"m.text"},"ts":1392905524000,"senderName":"zcorpan","senderId":"zcorpan@irc"},
{"content":{"body":"i think i'd write the tests in an easy-to-write source format and then generate the html","msgtype":"m.text"},"ts":1392905712000,"senderName":"zcorpan","senderId":"zcorpan@irc"},
{"content":{"body":"<test-name><space><input>","msgtype":"m.text"},"ts":1392905761000,"senderName":"zcorpan","senderId":"zcorpan@irc"},
{"content":{"body":"either two files to separate valid from invalid or a magic line that switches to invalid","msgtype":"m.text"},"ts":1392905856000,"senderName":"zcorpan","senderId":"zcorpan@irc"},
{"content":{"body":"zcorpan: the limitation I have there is that the test harness is set up to catch only the first error that gets reported","msgtype":"m.text"},"ts":1392906241000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"I guess I should have it catch all the errors","msgtype":"m.text"},"ts":1392906275000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"instead","msgtype":"m.text"},"ts":1392906278000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"that way I could put as many cases as I wanted into each file","msgtype":"m.text"},"ts":1392906333000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"MikeSmith: i meant that a script would generate the html files, one test case per file","msgtype":"m.text"},"ts":1392906367000,"senderName":"zcorpan","senderId":"zcorpan@irc"},
{"content":{"body":"sure","msgtype":"m.text"},"ts":1392906374000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"but I mean I have a testrunner in the validator code that automates the tests, and it expects only on error per *novalid.html file","msgtype":"m.text"},"ts":1392906417000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"or rather it only sees the first error","msgtype":"m.text"},"ts":1392906428000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"yeah, i don't follow why that is a problem","msgtype":"m.text"},"ts":1392906465000,"senderName":"zcorpan","senderId":"zcorpan@irc"},
{"content":{"body":"oh sorry","msgtype":"m.text"},"ts":1392906477000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"yeah, I wasn't paying attention to what you actually wrote. Yeah, you're right, it'd be better to generate them from a script","msgtype":"m.text"},"ts":1392906521000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"python I guess","msgtype":"m.text"},"ts":1392906544000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"i think using the test name in the filename is better than 001","msgtype":"m.text"},"ts":1392906634000,"senderName":"zcorpan","senderId":"zcorpan@irc"},
{"content":{"body":"yeah I'm not fond of the numbering thing","msgtype":"m.text"},"ts":1392906700000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"using the test names makes for longer filenames but it's not like we gain anything from short filenames","msgtype":"m.text"},"ts":1392906755000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"except shorter URLs but the URLs are pretty long already anyway","msgtype":"m.text"},"ts":1392906781000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"zcorpan: https://critic.hoppipolla.co.uk/r/822","msgtype":"m.text"},"ts":1392913189000,"senderName":"foolip","senderId":"foolip@irc"},
{"content":{"body":"done","msgtype":"m.text"},"ts":1392913437000,"senderName":"zcorpan","senderId":"zcorpan@irc"},
{"content":{"body":"setTimeout doesn't get clamped when the page is in the background, does it?","msgtype":"m.text"},"ts":1392913484000,"senderName":"TabAtkins","senderId":"TabAtkins@irc"},
{"content":{"body":"No, although it is allowed to per spec","msgtype":"m.text"},"ts":1392913668000,"senderName":"jgraham","senderId":"jgraham@irc"},
{"content":{"body":"Darn, and Chrome definitely does it.  Hrm.","msgtype":"m.text"},"ts":1392913920000,"senderName":"TabAtkins","senderId":"TabAtkins@irc"},
{"content":{"body":"http://imgur.com/ZWzDUdS","msgtype":"m.text"},"ts":1392914172000,"senderName":"gsnedders","senderId":"gsnedders@irc"},
{"content":{"body":"TabAtkins: Maybe all browsers do","msgtype":"m.text"},"ts":1392914183000,"senderName":"jgraham","senderId":"jgraham@irc"},
{"content":{"body":"It is allowed per spec, I just don't recall it being required","msgtype":"m.text"},"ts":1392914197000,"senderName":"jgraham","senderId":"jgraham@irc"},
{"content":{"body":"Seems like Firefox does too at least","msgtype":"m.text"},"ts":1392914308000,"senderName":"jgraham","senderId":"jgraham@irc"},
{"content":{"body":"<body></body> seems to create 2 newlines in body","msgtype":"m.text"},"ts":1392914589000,"senderName":"smaug____","senderId":"smaug____@irc"},
{"content":{"body":"does something require them to be created with just one DOM mutation","msgtype":"m.text"},"ts":1392914606000,"senderName":"smaug____","senderId":"smaug____@irc"},
{"content":{"body":"smaug____: just one newline after the <body> start tag, isn't it?","msgtype":"m.text"},"ts":1392917478000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"MikeSmith: 2","msgtype":"m.text"},"ts":1392917560000,"senderName":"smaug____","senderId":"smaug____@irc"},
{"content":{"body":"I haven't figured out what in the spec adds any","msgtype":"m.text"},"ts":1392917572000,"senderName":"smaug____","senderId":"smaug____@irc"},
{"content":{"body":"but Gecko and Blink both seem to insert 2","msgtype":"m.text"},"ts":1392917608000,"senderName":"smaug____","senderId":"smaug____@irc"},
{"content":{"body":"how do I observe that?","msgtype":"m.text"},"ts":1392917643000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"Hmm?","msgtype":"m.text"},"ts":1392917660000,"senderName":"Ms2ger","senderId":"Ms2ger@irc"},
{"content":{"body":"smaug____, what's the test case?","msgtype":"m.text"},"ts":1392917670000,"senderName":"Ms2ger","senderId":"Ms2ger@irc"},
{"content":{"body":"Ms2ger: https://pastebin.mozilla.org/4348132","msgtype":"m.text"},"ts":1392917947000,"senderName":"smaug____","senderId":"smaug____@irc"},
{"content":{"body":"the newline after the </body>","msgtype":"m.text"},"ts":1392917964000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"Yeah, that","msgtype":"m.text"},"ts":1392917968000,"senderName":"Ms2ger","senderId":"Ms2ger@irc"},
{"content":{"body":"and i bet you have a newline after the </html>","msgtype":"m.text"},"ts":1392917969000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"(i tried to fix this, but it turns out there's compat needs or something)","msgtype":"m.text"},"ts":1392918008000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"body contains two newlines","msgtype":"m.text"},"ts":1392918017000,"senderName":"smaug____","senderId":"smaug____@irc"},
{"content":{"body":"and I'm trying to figure out why","msgtype":"m.text"},"ts":1392918025000,"senderName":"smaug____","senderId":"smaug____@irc"},
{"content":{"body":"all text including whitespace after the </body> end up in the <body>","msgtype":"m.text"},"ts":1392918032000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"you have two newlines after the </body>","msgtype":"m.text"},"ts":1392918039000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"aha","msgtype":"m.text"},"ts":1392918041000,"senderName":"smaug____","senderId":"smaug____@irc"},
{"content":{"body":"is it ok for implementation to first insert textnode (\"\\n\"), and then append \"\\n\" to it","msgtype":"m.text"},"ts":1392918073000,"senderName":"smaug____","senderId":"smaug____@irc"},
{"content":{"body":"it's because \"a</body>\\nb\" has to have a space between the a and the b, and they both have to be in the body","msgtype":"m.text"},"ts":1392918074000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"per spec i think all characters are individually appended","msgtype":"m.text"},"ts":1392918098000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"and/or is it ok to just create textnode (\"\\n\\n\") and append that to body","msgtype":"m.text"},"ts":1392918101000,"senderName":"smaug____","senderId":"smaug____@irc"},
{"content":{"body":"and then mutation observers coallesce the edits","msgtype":"m.text"},"ts":1392918116000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"or something","msgtype":"m.text"},"ts":1392918117000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"that is my interpretation too, currently","msgtype":"m.text"},"ts":1392918118000,"senderName":"smaug____","senderId":"smaug____@irc"},
{"content":{"body":"mutation observer doesn't coalesce character data changes","msgtype":"m.text"},"ts":1392918137000,"senderName":"smaug____","senderId":"smaug____@irc"},
{"content":{"body":"probably should be allowed to, at least from the parser","msgtype":"m.text"},"ts":1392918149000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"though nothing stops the parser from spinning the event loop between each character so it can't be a requirement at the end of the day","msgtype":"m.text"},"ts":1392918170000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"(i mean, you don't control when the network gives you bytes)","msgtype":"m.text"},"ts":1392918179000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"yup","msgtype":"m.text"},"ts":1392918280000,"senderName":"smaug____","senderId":"smaug____@irc"},
{"content":{"body":"zcorpan and i have unfortunately non-overlapping hours","msgtype":"m.text"},"ts":1392919195000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"Hixie: here now (for a bit)","msgtype":"m.text"},"ts":1392921334000,"senderName":"zcorpan","senderId":"zcorpan@irc"},
{"content":{"body":"zcorpan: now, what was it i wanted to ask...","msgtype":"m.text"},"ts":1392921592000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"Hixie: next time pretend i'm here when i'm not :-P","msgtype":"m.text"},"ts":1392921633000,"senderName":"zcorpan","senderId":"zcorpan@irc"},
{"content":{"body":"zcorpan: :-)","msgtype":"m.text"},"ts":1392921683000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"i get confused because you leave the channel and i forget you see the logs! :-)","msgtype":"m.text"},"ts":1392921709000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"is it bad that my reaction to this thread about P2P web-based games is \"use a server\"","msgtype":"m.text"},"ts":1392921729000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"Hixie: yeah, the design seems fragile, if that first player crashes or drops the connection the game is over?","msgtype":"m.text"},"ts":1392922487000,"senderName":"jcgregorio","senderId":"jcgregorio@irc"},
{"content":{"body":"damnit, i just figured out why i needed zcorpan, and he's gone. :-)","msgtype":"m.text"},"ts":1392923216000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"jcgregorio: presumably they support handing over to a new peer and doing a master election to pick a new server?","msgtype":"m.text"},"ts":1392923230000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"zcorpan: so, we need an event that means \"the user agent would like to scroll to this element\", which can be canceled so that the author can implement scrolling when it's in a canvas","msgtype":"m.text"},"ts":1392923282000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"zcorpan: that sounds like it belongs in CSSOM? maybe?","msgtype":"m.text"},"ts":1392923296000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"zcorpan: i'll file a bug","msgtype":"m.text"},"ts":1392923320000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"Hixie: I have no idea what https://www.w3.org/Bugs/Public/show_bug.cgi?id=22296#c52 means.","msgtype":"m.text"},"ts":1392923703000,"senderName":"rafaelw","senderId":"rafaelw@irc"},
{"content":{"body":"it sounds like he's saying that table sorting has to be special in some way in this scheme","msgtype":"m.text"},"ts":1392923729000,"senderName":"jamesr__","senderId":"jamesr__@irc"},
{"content":{"body":"rafaelw: there are several kinds of microtasks, right?","msgtype":"m.text"},"ts":1392923743000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"rafaelw: e.g. mutation observers","msgtype":"m.text"},"ts":1392923748000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"rafaelw: but also eg. resorting tables, initialising web components, etc","msgtype":"m.text"},"ts":1392923768000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"I'd say there are different types of work done in microtasks (just like tasks)","msgtype":"m.text"},"ts":1392923779000,"senderName":"rafaelw","senderId":"rafaelw@irc"},
{"content":{"body":"yes","msgtype":"m.text"},"ts":1392923783000,"senderName":"rafaelw","senderId":"rafaelw@irc"},
{"content":{"body":"rafaelw: ok. call these different types type1, type, type3, etc.","msgtype":"m.text"},"ts":1392923788000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"with you.","msgtype":"m.text"},"ts":1392923802000,"senderName":"rafaelw","senderId":"rafaelw@irc"},
{"content":{"body":"TabAtkins: sounds like this has been covered but rAF never runs in the background (required by spec) and setTimeout is throttled pretty aggressively in lots of browsers (allowed by spec but not required)","msgtype":"m.text"},"ts":1392923820000,"senderName":"jamesr__","senderId":"jamesr__@irc"},
{"content":{"body":"rafaelw: if we have a batch of type1 microtasks and a batch of type2 microtasks that all got queued during some especially complicated script, should they all run in the order they were queued, or should they run first all type1, then all type2?","msgtype":"m.text"},"ts":1392923838000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"setTimeout has a \"wait by some arbitrary additional UA-determined period of time\" step","msgtype":"m.text"},"ts":1392923844000,"senderName":"jamesr__","senderId":"jamesr__@irc"},
{"content":{"body":"Hixie: FIFO","msgtype":"m.text"},"ts":1392923860000,"senderName":"jamesr__","senderId":"jamesr__@irc"},
{"content":{"body":"there's no such thing as a batch of type1 & batch of type2.","msgtype":"m.text"},"ts":1392923873000,"senderName":"rafaelw","senderId":"rafaelw@irc"},
{"content":{"body":"there's just a bunch of microtasks and they get run in FIFO order.","msgtype":"m.text"},"ts":1392923886000,"senderName":"rafaelw","senderId":"rafaelw@irc"},
{"content":{"body":"rafaelw: ok so i agree with jamesr__ and i agree with what you just said, but that contradicts what you said in https://www.w3.org/Bugs/Public/show_bug.cgi?id=22296#c47","msgtype":"m.text"},"ts":1392923900000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"assuming the \"no\" was a response to comment 46","msgtype":"m.text"},"ts":1392923916000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"brb.","msgtype":"m.text"},"ts":1392923938000,"senderName":"rafaelw","senderId":"rafaelw@irc"},
{"content":{"body":"i think you're trying to read too much into the internals of how mutation observers work","msgtype":"m.text"},"ts":1392923975000,"senderName":"jamesr__","senderId":"jamesr__@irc"},
{"content":{"body":"i'm trying to write the internals of how mutation observers work","msgtype":"m.text"},"ts":1392924001000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":":-)","msgtype":"m.text"},"ts":1392924006000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"no","msgtype":"m.text"},"ts":1392924009000,"senderName":"jamesr__","senderId":"jamesr__@irc"},
{"content":{"body":"you're trying to write the internals of how microtasks work","msgtype":"m.text"},"ts":1392924014000,"senderName":"jamesr__","senderId":"jamesr__@irc"},
{"content":{"body":"well, right now, mutation observers provide me with one hook, which i call, and which runs all the mutation observers","msgtype":"m.text"},"ts":1392924047000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"what i'm arguing is that we should change that so that mutation observers provide me with a hook that just runs a single mutation observer.","msgtype":"m.text"},"ts":1392924066000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"and i'm saying you are wrong","msgtype":"m.text"},"ts":1392924095000,"senderName":"jamesr__","senderId":"jamesr__@irc"},
{"content":{"body":"why do you think your proposal is better?","msgtype":"m.text"},"ts":1392924103000,"senderName":"jamesr__","senderId":"jamesr__@irc"},
{"content":{"body":"i'm confused","msgtype":"m.text"},"ts":1392924111000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"my proposal is what you just said we should do","msgtype":"m.text"},"ts":1392924117000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"this is what comment #25 part 4 is about","msgtype":"m.text"},"ts":1392924126000,"senderName":"jamesr__","senderId":"jamesr__@irc"},
{"content":{"body":"do you understand that bit?","msgtype":"m.text"},"ts":1392924130000,"senderName":"jamesr__","senderId":"jamesr__@irc"},
{"content":{"body":"no, i do not understand comment 25 part 4 (see comment 48 where i said as much)","msgtype":"m.text"},"ts":1392924153000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"or comment #28","msgtype":"m.text"},"ts":1392924159000,"senderName":"jamesr__","senderId":"jamesr__@irc"},
{"content":{"body":"comment 28 seems to contradict what you said above in this irc conversation","msgtype":"m.text"},"ts":1392924189000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"no?","msgtype":"m.text"},"ts":1392924194000,"senderName":"jamesr__","senderId":"jamesr__@irc"},
{"content":{"body":"then i do not understand one of those two things (or both)","msgtype":"m.text"},"ts":1392924218000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"i think your source of confusion is you are attempting to conflate different units of work into one microtask concept","msgtype":"m.text"},"ts":1392924255000,"senderName":"jamesr__","senderId":"jamesr__@irc"},
{"content":{"body":"not everything is on its own a microtask","msgtype":"m.text"},"ts":1392924269000,"senderName":"jamesr__","senderId":"jamesr__@irc"},
{"content":{"body":"i don't know what you mean by \"one microtask concept\"","msgtype":"m.text"},"ts":1392924274000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"i.e. not every mutation observer callback is a separate independent microtask","msgtype":"m.text"},"ts":1392924280000,"senderName":"jamesr__","senderId":"jamesr__@irc"},
{"content":{"body":"ok","msgtype":"m.text"},"ts":1392924284000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"that's what i was asking earlier when you said it was :-)","msgtype":"m.text"},"ts":1392924290000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"no, you asked the question badly","msgtype":"m.text"},"ts":1392924296000,"senderName":"jamesr__","senderId":"jamesr__@irc"},
{"content":{"body":"i'm happy to concede that","msgtype":"m.text"},"ts":1392924302000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"you asked a question about a bunch of microtasks","msgtype":"m.text"},"ts":1392924303000,"senderName":"jamesr__","senderId":"jamesr__@irc"},
{"content":{"body":"let me rephrase the question.","msgtype":"m.text"},"ts":1392924313000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"but if the things you're asking about are not microtasks then the answer will be different","msgtype":"m.text"},"ts":1392924323000,"senderName":"jamesr__","senderId":"jamesr__@irc"},
{"content":{"body":"suppose you have a script which causes a bunch of mutations, then causes a table to need to be sorted, then causes a bunch more mutations.","msgtype":"m.text"},"ts":1392924354000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"i would say (1) all microtasks run in FIFO order and (2) some systems, like mutation observers, perform multiple actions within the execution of a single microtask","msgtype":"m.text"},"ts":1392924354000,"senderName":"jamesr__","senderId":"jamesr__@irc"},
{"content":{"body":"what should happen when we get to running microtasks in that situation?","msgtype":"m.text"},"ts":1392924378000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"i'm not familiar with the table sorting mechanism. how does it work?","msgtype":"m.text"},"ts":1392924378000,"senderName":"jamesr__","senderId":"jamesr__@irc"},
{"content":{"body":"back.","msgtype":"m.text"},"ts":1392924398000,"senderName":"rafaelw","senderId":"rafaelw@irc"},
{"content":{"body":"well, that's up in the air, but the proposal is that when a table needs sorting, a microtask is queued to sort it.","msgtype":"m.text"},"ts":1392924401000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"let's do the example with promises","msgtype":"m.text"},"ts":1392924407000,"senderName":"jamesr__","senderId":"jamesr__@irc"},
{"content":{"body":"hixie: mutation observers have to deliver in order of mutation observer creation time.","msgtype":"m.text"},"ts":1392924408000,"senderName":"rafaelw","senderId":"rafaelw@irc"},
{"content":{"body":"those are simple","msgtype":"m.text"},"ts":1392924409000,"senderName":"jamesr__","senderId":"jamesr__@irc"},
{"content":{"body":"that's already shipped. we can't break compat.","msgtype":"m.text"},"ts":1392924413000,"senderName":"rafaelw","senderId":"rafaelw@irc"},
{"content":{"body":"rafaelw: i don't think anyone is disagreeing with that","msgtype":"m.text"},"ts":1392924421000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"i have no idea how promises work, but ok","msgtype":"m.text"},"ts":1392924449000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"so let's say you do \"d.appendChild(a); d.appendChild(b); promise.resolve(); d.appendChild(c);\". the question is what bits enqueue microtasks and what order they fire in, correct?","msgtype":"m.text"},"ts":1392924473000,"senderName":"jamesr__","senderId":"jamesr__@irc"},
{"content":{"body":"what what do you think i was saying in comment 28?","msgtype":"m.text"},"ts":1392924475000,"senderName":"rafaelw","senderId":"rafaelw@irc"},
{"content":{"body":"jamesr__: that is a question for which i would like the answer, yes","msgtype":"m.text"},"ts":1392924498000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"(assuming that promise.resolve() enqueues a microtask to run the promise stuff, whatever that is)","msgtype":"m.text"},"ts":1392924519000,"senderName":"jamesr__","senderId":"jamesr__@irc"},
{"content":{"body":"good. so in jame's example:","msgtype":"m.text"},"ts":1392924524000,"senderName":"rafaelw","senderId":"rafaelw@irc"},
{"content":{"body":"i think the answer falls out pretty naturally from 25/28 but let's step through it","msgtype":"m.text"},"ts":1392924533000,"senderName":"jamesr__","senderId":"jamesr__@irc"},
{"content":{"body":"the first appendChild schedules *the* mutation observer microtask to be scheduled.","msgtype":"m.text"},"ts":1392924545000,"senderName":"rafaelw","senderId":"rafaelw@irc"},
{"content":{"body":"all subsequent appendChilds discover that the mutation observer microtask is already scheduled (and don't schedule new microtasks)","msgtype":"m.text"},"ts":1392924577000,"senderName":"rafaelw","senderId":"rafaelw@irc"},
{"content":{"body":"the promise.resolve() schedules a microtask for *only itself*.","msgtype":"m.text"},"ts":1392924593000,"senderName":"rafaelw","senderId":"rafaelw@irc"},
{"content":{"body":"so the answer is \"c\"'s observer fires before the promise?","msgtype":"m.text"},"ts":1392924596000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"yes.","msgtype":"m.text"},"ts":1392924604000,"senderName":"rafaelw","senderId":"rafaelw@irc"},
{"content":{"body":"...why would we want that?","msgtype":"m.text"},"ts":1392924617000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"because that's the only way that makes any sense at all?","msgtype":"m.text"},"ts":1392924624000,"senderName":"jamesr__","senderId":"jamesr__@irc"},
{"content":{"body":"why does it make sense?","msgtype":"m.text"},"ts":1392924633000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"keep in mind that the mutation *observer* callback set is not necessary \"a, b, c\"","msgtype":"m.text"},"ts":1392924642000,"senderName":"jamesr__","senderId":"jamesr__@irc"},
{"content":{"body":"sorry, that was confusing","msgtype":"m.text"},"ts":1392924654000,"senderName":"jamesr__","senderId":"jamesr__@irc"},
{"content":{"body":"the mapping from callbacks for mutations to their originating mutations is not the important part","msgtype":"m.text"},"ts":1392924672000,"senderName":"jamesr__","senderId":"jamesr__@irc"},
{"content":{"body":"i can't argue that's what we want.","msgtype":"m.text"},"ts":1392924672000,"senderName":"rafaelw","senderId":"rafaelw@irc"},
{"content":{"body":"what happens if a's callback resolves a promise and then mutates dom node d?","msgtype":"m.text"},"ts":1392924682000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"i'm arguing that's the only choice i know of that works.","msgtype":"m.text"},"ts":1392924684000,"senderName":"rafaelw","senderId":"rafaelw@irc"},
{"content":{"body":"don't think about \"a's callback\"","msgtype":"m.text"},"ts":1392924699000,"senderName":"jamesr__","senderId":"jamesr__@irc"},
{"content":{"body":"think about \"the mutation observer microtask\"","msgtype":"m.text"},"ts":1392924704000,"senderName":"jamesr__","senderId":"jamesr__@irc"},
{"content":{"body":"what happens if a callback resolves a promise and then mutates dom node d?","msgtype":"m.text"},"ts":1392924706000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"(doesn't break compat with mutation observers)","msgtype":"m.text"},"ts":1392924707000,"senderName":"rafaelw","senderId":"rafaelw@irc"},
{"content":{"body":"if during the mutation observer microtask one of the callbacks mutates the dom, that will enqueue another microtask for mutation observers","msgtype":"m.text"},"ts":1392924725000,"senderName":"jamesr__","senderId":"jamesr__@irc"},
{"content":{"body":"it's actually not even as simple as that.","msgtype":"m.text"},"ts":1392924740000,"senderName":"rafaelw","senderId":"rafaelw@irc"},
{"content":{"body":"from the author perspective, and from my perspective as the guy who has to try to spec how this works with spinning the event loop, the atomic unit we care about is the callback, not the microtask, fwiw.","msgtype":"m.text"},"ts":1392924744000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"it's not helpful to ask general questions like that.","msgtype":"m.text"},"ts":1392924748000,"senderName":"rafaelw","senderId":"rafaelw@irc"},
{"content":{"body":"Hixie: that's not a useful perspective to have","msgtype":"m.text"},"ts":1392924754000,"senderName":"jamesr__","senderId":"jamesr__@irc"},
{"content":{"body":"you can only reason about concrete examples.","msgtype":"m.text"},"ts":1392924755000,"senderName":"rafaelw","senderId":"rafaelw@irc"},
{"content":{"body":"that's as may be, but it's still my perspective :-)","msgtype":"m.text"},"ts":1392924771000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"and that's why you find this so confusing. think about it in terms of microtasks and it's actually very simple","msgtype":"m.text"},"ts":1392924784000,"senderName":"jamesr__","senderId":"jamesr__@irc"},
{"content":{"body":"Oh, are we back to telling Hixie he's an idiot?","msgtype":"m.text"},"ts":1392924787000,"senderName":"Ms2ger","senderId":"Ms2ger@irc"},
{"content":{"body":"there are many ways to think about the problem. some of them make the problem simple, some make it very complicated","msgtype":"m.text"},"ts":1392924807000,"senderName":"jamesr__","senderId":"jamesr__@irc"},
{"content":{"body":"i'm saying if you pick the simple one then you'll be much happier","msgtype":"m.text"},"ts":1392924813000,"senderName":"jamesr__","senderId":"jamesr__@irc"},
{"content":{"body":"jamesr__: ok, but if we think about this in terms of microtasks, please explain how we split the microtask when we sping the event loop when a callback calls showModalDialog().","msgtype":"m.text"},"ts":1392924817000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"jamesr__: because without thinking of callbacks, i have no idea how to spec that.","msgtype":"m.text"},"ts":1392924828000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"my vote was that we just throw an exception when calling showModalDialog()","msgtype":"m.text"},"ts":1392924850000,"senderName":"jamesr__","senderId":"jamesr__@irc"},
{"content":{"body":"our usage numbers are pretty darn low for that to begin with","msgtype":"m.text"},"ts":1392924857000,"senderName":"jamesr__","senderId":"jamesr__@irc"},
{"content":{"body":"that's my vote as well.","msgtype":"m.text"},"ts":1392924858000,"senderName":"rafaelw","senderId":"rafaelw@irc"},
{"content":{"body":"that was my vote too, but i got outvoted.","msgtype":"m.text"},"ts":1392924858000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"(actually not throw, just silently return)","msgtype":"m.text"},"ts":1392924869000,"senderName":"rafaelw","senderId":"rafaelw@irc"},
{"content":{"body":"abarth liked the idea as well.","msgtype":"m.text"},"ts":1392924875000,"senderName":"rafaelw","senderId":"rafaelw@irc"},
{"content":{"body":"still, it's not that bad","msgtype":"m.text"},"ts":1392924876000,"senderName":"jamesr__","senderId":"jamesr__@irc"},
{"content":{"body":"the mutation observer system has to keep track of which callbacks have run and not run","msgtype":"m.text"},"ts":1392924883000,"senderName":"jamesr__","senderId":"jamesr__@irc"},
{"content":{"body":"i was going to post a patch to blink for exactly this.","msgtype":"m.text"},"ts":1392924884000,"senderName":"rafaelw","senderId":"rafaelw@irc"},
{"content":{"body":"rafaelw: why does a's mutation observer, b's mutation observer, promise stuff, c's mutation observer not work?","msgtype":"m.text"},"ts":1392924886000,"senderName":"Domenic_","senderId":"Domenic_@irc"},
{"content":{"body":"that's not the microtask system's job","msgtype":"m.text"},"ts":1392924887000,"senderName":"jamesr__","senderId":"jamesr__@irc"},
{"content":{"body":"rafaelw: unfortunately, my vote counts for squat, and you, jamesr__, and abarth's votes collectively only count as one.","msgtype":"m.text"},"ts":1392924901000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"dom: you're making a false assumption.","msgtype":"m.text"},"ts":1392924905000,"senderName":"rafaelw","senderId":"rafaelw@irc"},
{"content":{"body":"probably :). which one?","msgtype":"m.text"},"ts":1392924920000,"senderName":"Domenic_","senderId":"Domenic_@irc"},
{"content":{"body":"there are observers and there are nodes. it's a many-to-many relationship.","msgtype":"m.text"},"ts":1392924926000,"senderName":"rafaelw","senderId":"rafaelw@irc"},
{"content":{"body":"not a 1;1","msgtype":"m.text"},"ts":1392924933000,"senderName":"rafaelw","senderId":"rafaelw@irc"},
{"content":{"body":"right, ok.","msgtype":"m.text"},"ts":1392924935000,"senderName":"Domenic_","senderId":"Domenic_@irc"},
{"content":{"body":"ok. i'll post a patch which prevents showModalDialog during a microtaskCheckpoint today.","msgtype":"m.text"},"ts":1392924956000,"senderName":"rafaelw","senderId":"rafaelw@irc"},
{"content":{"body":"jamesr__: when you spin the event loop, you have to put a task on the main event loop task queue. What does that task consist of? I was assuming it would consist of just finishing the callback.","msgtype":"m.text"},"ts":1392924958000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"is that helpful?","msgtype":"m.text"},"ts":1392924959000,"senderName":"rafaelw","senderId":"rafaelw@irc"},
{"content":{"body":"but let's pretend we wrote sample code like doSomeStuffToTriggerObserverA(); doSomeStuffToTriggerPromiseB(); doSomeStuffToTriggerObserverC()","msgtype":"m.text"},"ts":1392924962000,"senderName":"Domenic_","senderId":"Domenic_@irc"},
{"content":{"body":"it sounds like that would cause observerA, observerC, promiseB","msgtype":"m.text"},"ts":1392924982000,"senderName":"Domenic_","senderId":"Domenic_@irc"},
{"content":{"body":"becaues you only have a single microtask for all observers","msgtype":"m.text"},"ts":1392924991000,"senderName":"Domenic_","senderId":"Domenic_@irc"},
{"content":{"body":"Hixie: i think i've argued with you before that the way the spec handles spinning the event loop does not match what browsers actually do and is thus not all that helpful","msgtype":"m.text"},"ts":1392925003000,"senderName":"jamesr__","senderId":"jamesr__@irc"},
{"content":{"body":"the behavior i'd actually expect would be that the browser runs the showModalDialog code on top of the callstack of the mutation observer system, then returns, then the mutation observer system takes a look at the state it has after running the showModalDialog and decides what to do","msgtype":"m.text"},"ts":1392925064000,"senderName":"jamesr__","senderId":"jamesr__@irc"},
{"content":{"body":"i.e. the \"split a task\" thing never happens in reality","msgtype":"m.text"},"ts":1392925069000,"senderName":"jamesr__","senderId":"jamesr__@irc"},
{"content":{"body":"the pending work is sitting on the callstack","msgtype":"m.text"},"ts":1392925079000,"senderName":"jamesr__","senderId":"jamesr__@irc"},
{"content":{"body":"jamesr__: so all mutation observers stop during the modal dialog, and then after it returns you get a huge deluge of them?","msgtype":"m.text"},"ts":1392925093000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"why would it not be observerA, promiseB, observerC?","msgtype":"m.text"},"ts":1392925099000,"senderName":"Domenic_","senderId":"Domenic_@irc"},
{"content":{"body":"that's not what i said","msgtype":"m.text"},"ts":1392925100000,"senderName":"jamesr__","senderId":"jamesr__@irc"},
{"content":{"body":"it's reentrant","msgtype":"m.text"},"ts":1392925102000,"senderName":"jamesr__","senderId":"jamesr__@irc"},
{"content":{"body":"dom: in order to reason about these examples you need; creation order of observers, which observers observe which nodes and what order mutations took place/promises resolve.","msgtype":"m.text"},"ts":1392925124000,"senderName":"rafaelw","senderId":"rafaelw@irc"},
{"content":{"body":"jamesr__: so the next time we do microtasks, it continues from where it left off?","msgtype":"m.text"},"ts":1392925127000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"jsbin is probably the only way to have the conversation.","msgtype":"m.text"},"ts":1392925133000,"senderName":"rafaelw","senderId":"rafaelw@irc"},
{"content":{"body":"rafaelw: well, ok. but i'll try just asking directly then. why would you batch together all observers, instead of interleaving promises as appropriate?","msgtype":"m.text"},"ts":1392925177000,"senderName":"Domenic_","senderId":"Domenic_@irc"},
{"content":{"body":"above you seemed to imply that was the only thing that worked, but i don't understand why that would be the case","msgtype":"m.text"},"ts":1392925194000,"senderName":"Domenic_","senderId":"Domenic_@irc"},
{"content":{"body":"i think the \"as appropriate\" bit depends on the actual example","msgtype":"m.text"},"ts":1392925201000,"senderName":"jamesr__","senderId":"jamesr__@irc"},
{"content":{"body":"Hixie; FWIW, this is my frustration as well. It's too hard for me to reason about this when the spec language is so different from what the implementation does.","msgtype":"m.text"},"ts":1392925204000,"senderName":"rafaelw","senderId":"rafaelw@irc"},
{"content":{"body":"Hixie: that depends on what's changed while the modal dialog is up, i would think","msgtype":"m.text"},"ts":1392925225000,"senderName":"jamesr__","senderId":"jamesr__@irc"},
{"content":{"body":"dom: i can only answer that for you by posing a challenge to you: implement microtask delivery as a FIFO queue, and retain the invariant that mutation observers deliver in creation-time order.","msgtype":"m.text"},"ts":1392925267000,"senderName":"rafaelw","senderId":"rafaelw@irc"},
{"content":{"body":"jamesr__: well presumably the next time you get a microtask checkpoint is very soon after the dialog went up. at most one regular task can run between the time of the method call and the next time we run microtasks.","msgtype":"m.text"},"ts":1392925305000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"jamesr__: so assume that task does nothing, for the sake of argument","msgtype":"m.text"},"ts":1392925314000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"rafaelw: makes sense. the distinction between creation-time order and mutation-order is crucial. i imagine after thinking really hard about this i'll come to the same conclusion as you.","msgtype":"m.text"},"ts":1392925329000,"senderName":"Domenic_","senderId":"Domenic_@irc"},
{"content":{"body":"rafaelw: i don't understand how other callbacks being run can in any way affect the order of mutation observer delivery.","msgtype":"m.text"},"ts":1392925351000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"i've got a cake with your name on it if you figure out something better.","msgtype":"m.text"},"ts":1392925353000,"senderName":"rafaelw","senderId":"rafaelw@irc"},
{"content":{"body":";-)","msgtype":"m.text"},"ts":1392925377000,"senderName":"rafaelw","senderId":"rafaelw@irc"},
{"content":{"body":"rafaelw: other than potentially causing more mutations (which mo callbacks can as well), how can they have any impact at all?","msgtype":"m.text"},"ts":1392925393000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"hixie: what's the current topic?","msgtype":"m.text"},"ts":1392925415000,"senderName":"rafaelw","senderId":"rafaelw@irc"},
{"content":{"body":"rafaelw: how other callbacks being run can in any way affect the order of mutation observer delivery.","msgtype":"m.text"},"ts":1392925427000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"and how is that relevant?","msgtype":"m.text"},"ts":1392925438000,"senderName":"rafaelw","senderId":"rafaelw@irc"},
{"content":{"body":"isn't that what we've been talking about for the past 40 minutes?","msgtype":"m.text"},"ts":1392925460000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"you want to batch the mutation observer callbacks rather than run them one at a time interleaved with other microtask callbacks, right?","msgtype":"m.text"},"ts":1392925503000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"i think we need to do this differently.","msgtype":"m.text"},"ts":1392925540000,"senderName":"rafaelw","senderId":"rafaelw@irc"},
{"content":{"body":"every time i ask a question you try to change the approach, it's making it very hard for me to improve my understanding.","msgtype":"m.text"},"ts":1392925565000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"how about you propose an approach and i'll try to provide a case which doesn't retain creation-order delivery for mutation observers.","msgtype":"m.text"},"ts":1392925567000,"senderName":"rafaelw","senderId":"rafaelw@irc"},
{"content":{"body":"ok","msgtype":"m.text"},"ts":1392925573000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"my approach is this:","msgtype":"m.text"},"ts":1392925576000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"when it's time to run microtasks, run these steps:","msgtype":"m.text"},"ts":1392925595000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"1. if one or more mutation observers need to run, run one.","msgtype":"m.text"},"ts":1392925616000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"2. run another microtask, in the order they were queued.","msgtype":"m.text"},"ts":1392925628000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"3. goto 1 unless there's no more work to be done.","msgtype":"m.text"},"ts":1392925635000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"ok. what you've proposed is not a fifo queue.","msgtype":"m.text"},"ts":1392925664000,"senderName":"rafaelw","senderId":"rafaelw@irc"},
{"content":{"body":"it's a priority queue.","msgtype":"m.text"},"ts":1392925670000,"senderName":"rafaelw","senderId":"rafaelw@irc"},
{"content":{"body":"(this is not a final proposal, i'm just trying to work out if it would work, so that i can figure out the problem you're describing)","msgtype":"m.text"},"ts":1392925681000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"yes. it's possible to retain creation-time ordering with this approach.","msgtype":"m.text"},"ts":1392925700000,"senderName":"rafaelw","senderId":"rafaelw@irc"},
{"content":{"body":"ok","msgtype":"m.text"},"ts":1392925704000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"so, new approach:","msgtype":"m.text"},"ts":1392925709000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"whenever a mutation occurs, queue a microtask for each observer that it could fire, ignoring all previously queued microtasks.","msgtype":"m.text"},"ts":1392925770000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"when a mutation observer microtask comes up, run the callback that applies, taking into account all subsequently queued microtasks, and remove any subsequently queued microtasks that no longer apply because we handled them here.","msgtype":"m.text"},"ts":1392925806000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"microtask handling consists of:","msgtype":"m.text"},"ts":1392925818000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"1. run the oldest queued microtask.","msgtype":"m.text"},"ts":1392925824000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"2. goto 1 unless there's no more queued work.","msgtype":"m.text"},"ts":1392925831000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"thinking","msgtype":"m.text"},"ts":1392925925000,"senderName":"rafaelw","senderId":"rafaelw@irc"},
{"content":{"body":"IOW, have microtask deliver be the same but redefine the mutation observer microtask's work to be something else. that seems basically equivalent to #25 assuming that the \"taking into account all subsequently\" also takes care of the reordering that would happen to satisfy the mutation observer constraints","msgtype":"m.text"},"ts":1392925943000,"senderName":"jamesr__","senderId":"jamesr__@irc"},
{"content":{"body":"can you elaborate on the reordering thing?","msgtype":"m.text"},"ts":1392925975000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"trivial mapping back to the comment 25 proposal: the \"taking into account\" step includes generating all the other callbacks needed to preserver order and firing them","msgtype":"m.text"},"ts":1392925977000,"senderName":"jamesr__","senderId":"jamesr__@irc"},
{"content":{"body":"and cancelling all other mutation-related microtasks","msgtype":"m.text"},"ts":1392925988000,"senderName":"jamesr__","senderId":"jamesr__@irc"},
{"content":{"body":"my aim here is for each microtask to only ever fire one callback","msgtype":"m.text"},"ts":1392925996000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"can you explain: \"taking into account all subsequently queued microtasks, and remove any subsequently queued microtasks that no longer apply because we handled them here\"","msgtype":"m.text"},"ts":1392926100000,"senderName":"rafaelw","senderId":"rafaelw@irc"},
{"content":{"body":"hixie: can i re-state this approach as follows:","msgtype":"m.text"},"ts":1392926248000,"senderName":"rafaelw","senderId":"rafaelw@irc"},
{"content":{"body":"-every time an observed node is mutated, schedule a new mutation observer microtask","msgtype":"m.text"},"ts":1392926271000,"senderName":"rafaelw","senderId":"rafaelw@irc"},
{"content":{"body":"-all mutation observer callbacks do the same thing:","msgtype":"m.text"},"ts":1392926282000,"senderName":"rafaelw","senderId":"rafaelw@irc"},
{"content":{"body":"-find the observer with the oldest creation time and deliver all pending records to it","msgtype":"m.text"},"ts":1392926307000,"senderName":"rafaelw","senderId":"rafaelw@irc"},
{"content":{"body":"does \"deliver all pending records\" mean more than one callback?","msgtype":"m.text"},"ts":1392926328000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"Hixie: no, that's a single callback (the callback takes an array of MutationRecords)","msgtype":"m.text"},"ts":1392926356000,"senderName":"aklein","senderId":"aklein@irc"},
{"content":{"body":"it doesn't. it means one callback.","msgtype":"m.text"},"ts":1392926357000,"senderName":"rafaelw","senderId":"rafaelw@irc"},
{"content":{"body":"k","msgtype":"m.text"},"ts":1392926361000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"wouldn't you need to schedule one of these per observer per mutation?","msgtype":"m.text"},"ts":1392926392000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"per relevant observer, at least","msgtype":"m.text"},"ts":1392926398000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"yes.","msgtype":"m.text"},"ts":1392926407000,"senderName":"rafaelw","senderId":"rafaelw@irc"},
{"content":{"body":"sorry. you are right.","msgtype":"m.text"},"ts":1392926411000,"senderName":"rafaelw","senderId":"rafaelw@irc"},
{"content":{"body":"fwiw the Object.observe deliverChangeRecords() algorithm invokes a callback multiple times (if i've found the right proposal)","msgtype":"m.text"},"ts":1392926427000,"senderName":"jamesr__","senderId":"jamesr__@irc"},
{"content":{"body":"you'd need to schedule a microtask for each observer which had a mutation record added to it's pending queue.","msgtype":"m.text"},"ts":1392926433000,"senderName":"rafaelw","senderId":"rafaelw@irc"},
{"content":{"body":"is off to lunch, back soon","msgtype":"m.emote"},"ts":1392926440000,"senderName":"jamesr__","senderId":"jamesr__@irc"},
{"content":{"body":"jamesr__: correct.","msgtype":"m.text"},"ts":1392926450000,"senderName":"rafaelw","senderId":"rafaelw@irc"},
{"content":{"body":"right","msgtype":"m.text"},"ts":1392926453000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"as far as dom mutation observers go, i think what you describe is what i meant, yes","msgtype":"m.text"},"ts":1392926476000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"hixie: have i correctly restated your proposal?","msgtype":"m.text"},"ts":1392926478000,"senderName":"rafaelw","senderId":"rafaelw@irc"},
{"content":{"body":"ok, so this actually does break compat with the current ordering behavior (though it does retain the creation-time invariant).","msgtype":"m.text"},"ts":1392926519000,"senderName":"rafaelw","senderId":"rafaelw@irc"},
{"content":{"body":"oh ok, good. how so?","msgtype":"m.text"},"ts":1392926530000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"the way ordering is spec works like this:","msgtype":"m.text"},"ts":1392926544000,"senderName":"rafaelw","senderId":"rafaelw@irc"},
{"content":{"body":"when mutation observers deliver","msgtype":"m.text"},"ts":1392926550000,"senderName":"rafaelw","senderId":"rafaelw@irc"},
{"content":{"body":"take the set of observers whcih pending change records","msgtype":"m.text"},"ts":1392926562000,"senderName":"rafaelw","senderId":"rafaelw@irc"},
{"content":{"body":"order that set by creation time","msgtype":"m.text"},"ts":1392926571000,"senderName":"rafaelw","senderId":"rafaelw@irc"},
{"content":{"body":"deliver to that set in creation order","msgtype":"m.text"},"ts":1392926580000,"senderName":"rafaelw","senderId":"rafaelw@irc"},
{"content":{"body":"when you are done, if there are new observers pending delivery, start over.","msgtype":"m.text"},"ts":1392926596000,"senderName":"rafaelw","senderId":"rafaelw@irc"},
{"content":{"body":"so basically, you've created a *strict* priority queue for mutation observers, but unfortunately, that's not what is implemented.","msgtype":"m.text"},"ts":1392926619000,"senderName":"rafaelw","senderId":"rafaelw@irc"},
{"content":{"body":"(sorry. i have to go to lunch and i'm out tomorrow. we can pick this up next week).","msgtype":"m.text"},"ts":1392926644000,"senderName":"rafaelw","senderId":"rafaelw@irc"},
{"content":{"body":"what you describe doesn't quite seem to match what i'm reading on dom.spec.whatwg.org","msgtype":"m.text"},"ts":1392926670000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"it seems like you're trying really hard to have 1-1 microtask-callback.","msgtype":"m.text"},"ts":1392926671000,"senderName":"rafaelw","senderId":"rafaelw@irc"},
{"content":{"body":"this is going to be hard.","msgtype":"m.text"},"ts":1392926674000,"senderName":"rafaelw","senderId":"rafaelw@irc"},
{"content":{"body":"custom element callbacks present a different set of ordering requirements","msgtype":"m.text"},"ts":1392926684000,"senderName":"rafaelw","senderId":"rafaelw@irc"},
{"content":{"body":"the alternative is harder, if we have showModalDialog() :-)","msgtype":"m.text"},"ts":1392926692000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"if you could convince the other vendors to kill showModalDialog(), this would make our lives way easier","msgtype":"m.text"},"ts":1392926709000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"even just kill showModalDialog() inside microtasks","msgtype":"m.text"},"ts":1392926721000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"it's the only remaining spin-the-event-loop callsite that can be invoked in a microtask","msgtype":"m.text"},"ts":1392926737000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"anyway, we'll carry on next week, sure","msgtype":"m.text"},"ts":1392926751000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"Hixie: re: the dom spec, which part of the algorithm at http://dom.spec.whatwg.org/#concept-mo-invoke doesn't match Rafael's explanation?","msgtype":"m.text"},"ts":1392926804000,"senderName":"aklein","senderId":"aklein@irc"},
{"content":{"body":"MikeSmith: if we go with that proposal i suggested, then that IBM.* issue would be much simpler -- they would just click \"add as proprietary value\" each time they validated a document with a new value, and it'd never come up again","msgtype":"m.text"},"ts":1392926835000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"we worked pretty closely with annevk to get it to match up with the implementation (after several go-rounds that read differently than the implementation)","msgtype":"m.text"},"ts":1392926838000,"senderName":"aklein","senderId":"aklein@irc"},
{"content":{"body":"aklein: if i understand rafaelw's description, you first make a list of observers and their records, and then call their callbacks; the spec, though, just makes a list of observers, then for each one gets the records and calls the callback.","msgtype":"m.text"},"ts":1392926880000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"aklein: so if you have observers A and B, and they each have a record, and A's callback adds a record to B, the next thing that happens is B's callback with two records","msgtype":"m.text"},"ts":1392926908000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"aklein: as opposed to the next thing being B having two separate callbacks","msgtype":"m.text"},"ts":1392926919000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"Hixie: I think you just misunderstood rafaelw (or he misspoke). in the case you've outlined, A is first called with a single record, and then B is called (once) with two records","msgtype":"m.text"},"ts":1392926992000,"senderName":"aklein","senderId":"aklein@irc"},
{"content":{"body":"would you agree that's what the spec says? that's what our implementation does","msgtype":"m.text"},"ts":1392927005000,"senderName":"aklein","senderId":"aklein@irc"},
{"content":{"body":"i agree that the spec calls B with two records at once in that case","msgtype":"m.text"},"ts":1392927019000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"Hixie: yeah except that everybody who used the validator would click that button every time they checked a page that had unregistered meta@name values and eventually we'd have a gazillion values registereed and that state would be pretty much just like making any arbitary string valid","msgtype":"m.text"},"ts":1392927021000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"aklein: but so how is what i proposed earlier different?","msgtype":"m.text"},"ts":1392927025000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"Hixie: for this case, it's the same","msgtype":"m.text"},"ts":1392927047000,"senderName":"aklein","senderId":"aklein@irc"},
{"content":{"body":"MikeSmith: except that the validator would say \"valid! (uses proprietary values)\" instead of just \"valid!\"","msgtype":"m.text"},"ts":1392927053000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"but imagine that A causes a mutation that adds another record to A's queue","msgtype":"m.text"},"ts":1392927059000,"senderName":"aklein","senderId":"aklein@irc"},
{"content":{"body":"MikeSmith: and typos would get caught","msgtype":"m.text"},"ts":1392927060000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"Hixie: in that case, you and the spec differ. the spec says to call A with one record, then B with one record, then A again","msgtype":"m.text"},"ts":1392927085000,"senderName":"aklein","senderId":"aklein@irc"},
{"content":{"body":"Hixie: typos would get registered too","msgtype":"m.text"},"ts":1392927097000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"whereas your ordering would be A (one record), A (one record), B (one record)","msgtype":"m.text"},"ts":1392927106000,"senderName":"aklein","senderId":"aklein@irc"},
{"content":{"body":"MikeSmith: why?","msgtype":"m.text"},"ts":1392927108000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"aklein: ah, yeah, i guess that's a difference between my original proposal and rafaelw's restatement","msgtype":"m.text"},"ts":1392927137000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"aklein: i meant each microtask to be designated a specific observer whose's queue should be flushed.","msgtype":"m.text"},"ts":1392927157000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"because somebody would click \"register\" when their document had a typoed value that generated an error slash \"do you want to register me?\" message","msgtype":"m.text"},"ts":1392927169000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"Hixie: that's why rafael asked what you meant by \"taking into account other queued microtasks\"","msgtype":"m.text"},"ts":1392927187000,"senderName":"aklein","senderId":"aklein@irc"},
{"content":{"body":"aklein: but i guess that would mean my proposal misses the case of A having one record, B having none, and A's callback adding to A and B","msgtype":"m.text"},"ts":1392927189000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"aklein: since per spec today you'd want A, B, A, but i'd give A, A, B","msgtype":"m.text"},"ts":1392927204000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"aklein: and that can't be fixed easily since B might not exist when the first record is queued","msgtype":"m.text"},"ts":1392927236000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"interesting","msgtype":"m.text"},"ts":1392927239000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"Hixie: oh, I think I may begin to understand what you were proposing","msgtype":"m.text"},"ts":1392927262000,"senderName":"aklein","senderId":"aklein@irc"},
{"content":{"body":"MikeSmith: well that's why in my proposal we have \"did you mean /author/?\" and so on. at the end of the day, if people are validating but don't care about the errors, the validator is pointless.","msgtype":"m.text"},"ts":1392927286000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"MikeSmith: we could just provide a trivial implementation that just said \"it's valid! pat pat!\"","msgtype":"m.text"},"ts":1392927300000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"Hixie: were you saying that you enqueue tasks for all possible observers whenever a mutation occurs? even ones for which no records were enqueued by that mutation?","msgtype":"m.text"},"ts":1392927314000,"senderName":"aklein","senderId":"aklein@irc"},
{"content":{"body":"MikeSmith: i have to believe that validator users at least want to know about errors","msgtype":"m.text"},"ts":1392927315000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"aklein: i wasn't, but then i was, but then i realised that wouldn't work because mutation observers might be created later","msgtype":"m.text"},"ts":1392927342000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"MikeSmith: (note that in my proposal there was also the back-end review process where typos would get flagged as permanently not ok)","msgtype":"m.text"},"ts":1392927382000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"MikeSmith: (so at least eventually they'd get flagged)","msgtype":"m.text"},"ts":1392927390000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"MikeSmith: (with a useful message)","msgtype":"m.text"},"ts":1392927397000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"yeah I understand all that. I have a half-finished draft of a reply to you on that thread that I will try to finish soon. In the mean time it would still be good to try to get hsivonen to chime in.","msgtype":"m.text"},"ts":1392927493000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"for now I gotta get some sleep","msgtype":"m.text"},"ts":1392927502000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"yeah i wish i knew what henri wanted here","msgtype":"m.text"},"ts":1392927505000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"yeah","msgtype":"m.text"},"ts":1392927515000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"aklein: i guess we really do want two kinds of microtasks, those that are trivial with at most one callback, which can be handled easily by the current prose, and then the ones for mutation observers which would need to do special work for each of their callbacks","msgtype":"m.text"},"ts":1392927526000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"aklein: assuming we can't just break compat and go to just a queued model, anyway","msgtype":"m.text"},"ts":1392927546000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"Hixie: note that custom elements also have special ordering constraints, mutation observers aren't the only one","msgtype":"m.text"},"ts":1392927709000,"senderName":"aklein","senderId":"aklein@irc"},
{"content":{"body":"Hixie: it's definitely unclear to me how much the web depends on the ordering here","msgtype":"m.text"},"ts":1392927723000,"senderName":"aklein","senderId":"aklein@irc"},
{"content":{"body":"but without the specified creation-time ordering, we worried that implementations might end up with different orderings due to DOM implementation details","msgtype":"m.text"},"ts":1392927775000,"senderName":"aklein","senderId":"aklein@irc"},
{"content":{"body":"(e.g., the ordering might be dependent on hash table implementations)","msgtype":"m.text"},"ts":1392927832000,"senderName":"aklein","senderId":"aklein@irc"},
{"content":{"body":"yeah","msgtype":"m.text"},"ts":1392927878000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"btw, it looks like showModalDialog use is low enough were we might be able to just straight kill it","msgtype":"m.text"},"ts":1392930014000,"senderName":"jamesr__","senderId":"jamesr__@irc"},
{"content":{"body":"jamesr__: i certainly would support that!","msgtype":"m.text"},"ts":1392930346000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"jamesr__: historically all attempts at convincing other vendors of this have been unsuccessful :-(","msgtype":"m.text"},"ts":1392930361000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"k","msgtype":"m.text"},"ts":1392933642000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"i wish there was a way in bugzilla to select bugs for which i was not the last person who commented","msgtype":"m.text"},"ts":1392934262000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"anyone got IE around who can tell me what the two frames in this test say for HTTP_REFERER ?","msgtype":"m.text"},"ts":1392935065000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"http://software.hixie.ch/utilities/js/live-dom-viewer/saved/2830","msgtype":"m.text"},"ts":1392935068000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"also, does safari just not send referers for iframes or something?","msgtype":"m.text"},"ts":1392935100000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"or actually, try http://software.hixie.ch/utilities/js/live-dom-viewer/saved/2831","msgtype":"m.text"},"ts":1392935183000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"it has a third frame at the bottom","msgtype":"m.text"},"ts":1392935190000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"(very bottom of the dom viewer)","msgtype":"m.text"},"ts":1392935202000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"if you have results for that test, the bug is https://www.w3.org/Bugs/Public/show_bug.cgi?id=24613","msgtype":"m.text"},"ts":1392935266000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"What other things do custom elements not explain? Form submission is an easy and obvious one, but what else can native elements do that custom elements can't?","msgtype":"m.text"},"ts":1392936775000,"senderName":"Domenic_","senderId":"Domenic_@irc"},
{"content":{"body":"<input> in general is pretty hard to explain","msgtype":"m.text"},"ts":1392936847000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"e.g. the way it impacts <form>.elements","msgtype":"m.text"},"ts":1392936861000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"the way you can change hte type=\"\" attribute","msgtype":"m.text"},"ts":1392936867000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"the way type=file lets you access the file system","msgtype":"m.text"},"ts":1392936875000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"the way it interacts with <label>","msgtype":"m.text"},"ts":1392936885000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"yeah jonas was saying how <form>.elements is screwy","msgtype":"m.text"},"ts":1392937303000,"senderName":"Domenic_","senderId":"Domenic_@irc"},
{"content":{"body":"what is tricky about the interaction with label?","msgtype":"m.text"},"ts":1392937326000,"senderName":"Domenic_","senderId":"Domenic_@irc"},
{"content":{"body":"Domenic_: nothing particularly tricky, but <label> doesn't know about custom elements, so it won't do anything useful with them","msgtype":"m.text"},"ts":1392938148000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"Domenic_: note that i think form submission is kind of a red herring. With things like web sockets, it's not as important to actually submit anything. It's more interesting to be in form.elements and the like.","msgtype":"m.text"},"ts":1392938197000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"ah right","msgtype":"m.text"},"ts":1392938197000,"senderName":"Domenic_","senderId":"Domenic_@irc"},
{"content":{"body":"hober: it's cute how we're finally discussing these things that i had specced in xbl2 and web control 2.0 back in 2004 :-P","msgtype":"m.text"},"ts":1392938267000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"Hixie: right?","msgtype":"m.text"},"ts":1392938526000,"senderName":"hober","senderId":"hober@irc"},
{"content":{"body":"i wish it had gotten more traction back then","msgtype":"m.text"},"ts":1392938576000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"oh well","msgtype":"m.text"},"ts":1392938586000,"senderName":"Hixie","senderId":"Hixie@irc"},
{"content":{"body":"i didn't push it much either","msgtype":"m.text"},"ts":1392938591000,"senderName":"Hixie","senderId":"Hixie@irc"}
]
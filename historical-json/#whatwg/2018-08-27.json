[
{"content":{"body":"so, https://bugs.chromium.org/p/chromium/issues/detail?id=763298","msgtype":"m.text"},"ts":1535348815000,"senderName":"ondras","senderId":"ondras@irc"},
{"content":{"body":"does it make sense to adjust the spec so it allows @page { margin: var(--...) } ?","msgtype":"m.text"},"ts":1535348839000,"senderName":"ondras","senderId":"ondras@irc"},
{"content":{"body":"ondras: prolly, but best tracked at https://github.com/w3c/csswg-drafts/issues/new","msgtype":"m.text"},"ts":1535356328000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"annevk: about the <wpt> element, what’s the priority feature of it for you?","msgtype":"m.text"},"ts":1535356928000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"for wattsi I already have a patch for the the display/output part of it ready","msgtype":"m.text"},"ts":1535356984000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"but implementing the checks against the wpt repo is a whole nother things","msgtype":"m.text"},"ts":1535357012000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"MikeSmith: I don't really care for it I think","msgtype":"m.text"},"ts":1535357043000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"annevk: thanks, I wanted to make sure that the idea is not a complete nonsense prior to submitting it to github","msgtype":"m.text"},"ts":1535357049000,"senderName":"ondras","senderId":"ondras@irc"},
{"content":{"body":"MikeSmith: I also think it's somewhat problematic that it creates a strong mutual link between the two repositories","msgtype":"m.text"},"ts":1535357076000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"MikeSmith: someone landing a new HTML test can break the HTML build","msgtype":"m.text"},"ts":1535357085000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"ondras: it seems reasonable, prolly not done to keep things simple","msgtype":"m.text"},"ts":1535357101000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"annevk: ok","msgtype":"m.text"},"ts":1535357111000,"senderName":"ondras","senderId":"ondras@irc"},
{"content":{"body":"annevk: yeah that’s how it seems to me too, as far as HTML","msgtype":"m.text"},"ts":1535357303000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"so unless Simon feels different and has a compelling argument, I guess for HTML we don’t want to do the checkes","msgtype":"m.text"},"ts":1535357351000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"annevk: but you like having the tests-infor display part of it in the spec output?","msgtype":"m.text"},"ts":1535357433000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"or you don’t like that part either?","msgtype":"m.text"},"ts":1535357448000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"MikeSmith: I dunno, I haven't really used the system so I'm not the best judge","msgtype":"m.text"},"ts":1535357512000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"ok","msgtype":"m.text"},"ts":1535357661000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"I guess we really would want to get agreement before really doing it for HTML","msgtype":"m.text"},"ts":1535357723000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"because “really doing it” means somebody going in and adding <wpt> elements for several thousand test files, all throughout the source","msgtype":"m.text"},"ts":1535357788000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"MikeSmith: yeah, we should discuss the tradeoffs there, agreed","msgtype":"m.text"},"ts":1535359148000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"Did Chrome remove FTP support already?","msgtype":"m.text"},"ts":1535359177000,"senderName":"hsivonen","senderId":"hsivonen@irc"},
{"content":{"body":"hsivonen: for subresources I think, not in general, but I might be mistaken","msgtype":"m.text"},"ts":1535359214000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"annevk: ok.","msgtype":"m.text"},"ts":1535359223000,"senderName":"hsivonen","senderId":"hsivonen@irc"},
{"content":{"body":"annevk: ok, will see what Simon has to say","msgtype":"m.text"},"ts":1535359227000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"(I made the mistake of looking at our FTP code. It has comments about VMS.)","msgtype":"m.text"},"ts":1535359255000,"senderName":"hsivonen","senderId":"hsivonen@irc"},
{"content":{"body":"hsivonen: I checked, only found a subresources intent (and one to mark ftp insecure in the address bar)","msgtype":"m.text"},"ts":1535359394000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"annevk: thanks","msgtype":"m.text"},"ts":1535359737000,"senderName":"hsivonen","senderId":"hsivonen@irc"},
{"content":{"body":"JakeA: do you have a pattern for running a test in a service worker controlled page?","msgtype":"m.text"},"ts":1535366702000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"JakeA: seutp a service worker, create an iframe with a URL that contains the test, then post the results to the parent?","msgtype":"m.text"},"ts":1535366724000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"JakeA: is that the best we have?","msgtype":"m.text"},"ts":1535366728000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"annevk: The iframe is same origin, so you don't need to post message, but yes","msgtype":"m.text"},"ts":1535366960000,"senderName":"JakeA","senderId":"JakeA@irc"},
{"content":{"body":"annevk: there's also fetch_tests_from_worker if the tests need to run in the service worker https://github.com/web-platform-tests/wpt/blob/master/fetch/range/sw.https.window.js","msgtype":"m.text"},"ts":1535367067000,"senderName":"JakeA","senderId":"JakeA@irc"},
{"content":{"body":"But otherwise, you just operate on iframe.contentWindow.fetch or whatever, if you want to fetch via a service worker","msgtype":"m.text"},"ts":1535367111000,"senderName":"JakeA","senderId":"JakeA@irc"},
{"content":{"body":"JakeA: iframe.contentWindow.fetch fetches outside the service worker in Fx at least","msgtype":"m.text"},"ts":1535367307000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"JakeA: and I think Fx might be correct, given that we consistently refer to the \"current global object\"","msgtype":"m.text"},"ts":1535367325000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"JakeA: and not \"relevant global object\"","msgtype":"m.text"},"ts":1535367337000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"annevk: oh, really? Ah, well, a lot of my tests rely on the other thing, so I guess I'll need to fix them (although, I'd have expected it to have worked)","msgtype":"m.text"},"ts":1535367424000,"senderName":"JakeA","senderId":"JakeA@irc"},
{"content":{"body":"JakeA: yeah, afaict","msgtype":"m.text"},"ts":1535367582000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"JakeA: maybe something else is wrong though","msgtype":"m.text"},"ts":1535373107000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"wanderview: https://github.com/web-platform-tests/wpt/pull/12680 now uses an <iframe> but I still get the weird result with Firefox returning the request URL","msgtype":"m.text"},"ts":1535373466000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"annevk: huh... I would expect that test to get \"test.txt\" in firefox... the response URL without the fragment","msgtype":"m.text"},"ts":1535374385000,"senderName":"wanderview","senderId":"wanderview@irc"},
{"content":{"body":"annevk: firefox has response URL setting, but it still strips response fragments AFAIK","msgtype":"m.text"},"ts":1535374454000,"senderName":"wanderview","senderId":"wanderview@irc"},
{"content":{"body":"since I think that part is still to be spec'd?","msgtype":"m.text"},"ts":1535374461000,"senderName":"wanderview","senderId":"wanderview@irc"},
{"content":{"body":"wanderview: yeah, without fragment is what I get in Chrome, as expected","msgtype":"m.text"},"ts":1535374491000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"wanderview: but Fx gives /test","msgtype":"m.text"},"ts":1535374497000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"I guess it would be useful to know if your service worker script is actually getting the expected fetch events","msgtype":"m.text"},"ts":1535374508000,"senderName":"wanderview","senderId":"wanderview@irc"},
{"content":{"body":"wanderview: I think it does since it does say that /test was transferred via the service worker","msgtype":"m.text"},"ts":1535374629000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"wanderview: and Fx does return the text contents of test.txt when asked","msgtype":"m.text"},"ts":1535374688000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"annevk: sounds like a bug to me... maybe the fragment on the response URL is making it take an untested path","msgtype":"m.text"},"ts":1535374891000,"senderName":"wanderview","senderId":"wanderview@irc"},
{"content":{"body":"if you put it in a glitch I could play around with it, but I don't have firefox build handy","msgtype":"m.text"},"ts":1535374914000,"senderName":"wanderview","senderId":"wanderview@irc"},
{"content":{"body":"let me see what WPT changes were made with that code change","msgtype":"m.text"},"ts":1535375039000,"senderName":"wanderview","senderId":"wanderview@irc"},
{"content":{"body":"Same without a fragment","msgtype":"m.text"},"ts":1535375093000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"I don't really know how glitch works","msgtype":"m.text"},"ts":1535375102000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"Anyway, I guess I'll file bugs, since this being different is a problem either way","msgtype":"m.text"},"ts":1535375123000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"annevk: for reference, this behavior should have been enabled in firefox in https://bugzilla.mozilla.org/show_bug.cgi?id=1222008","msgtype":"m.text"},"ts":1535375145000,"senderName":"wanderview","senderId":"wanderview@irc"},
{"content":{"body":"I'll put it in a glitch... because I'm curious","msgtype":"m.text"},"ts":1535375239000,"senderName":"wanderview","senderId":"wanderview@irc"},
{"content":{"body":"wanderview: do you think it's reasonable btw if I extend the fragment-frame.html resource with more tests, put all the results in an array, and then use parent.reject/parent.resolve to report the results","msgtype":"m.text"},"ts":1535375644000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"wanderview: it's not great, but I'm not really sure what else is available","msgtype":"m.text"},"ts":1535375664000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"JakeA: ^^","msgtype":"m.text"},"ts":1535375671000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"annevk: I find it easier to use an empty frame and `frame.contentWindow.fetch()` from the parent test","msgtype":"m.text"},"ts":1535375689000,"senderName":"wanderview","senderId":"wanderview@irc"},
{"content":{"body":"but its probably a style thing...","msgtype":"m.text"},"ts":1535375693000,"senderName":"wanderview","senderId":"wanderview@irc"},
{"content":{"body":"wanderview: I wasn't sure whether that's actually correct","msgtype":"m.text"},"ts":1535375711000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"we do it all over the place","msgtype":"m.text"},"ts":1535375723000,"senderName":"wanderview","senderId":"wanderview@irc"},
{"content":{"body":"wanderview: since in that case the \"current global object\" would be the global of the parent, not the frame?","msgtype":"m.text"},"ts":1535375738000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"annevk: the service worker tests use that pattern a lot","msgtype":"m.text"},"ts":1535375753000,"senderName":"wanderview","senderId":"wanderview@irc"},
{"content":{"body":"wanderview: sure, but is it correct?","msgtype":"m.text"},"ts":1535375761000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"wanderview: I don't think it is per spec, unless I missed something","msgtype":"m.text"},"ts":1535375773000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"annevk: I think it is, but I don't have time to look it up right now","msgtype":"m.text"},"ts":1535375789000,"senderName":"wanderview","senderId":"wanderview@irc"},
{"content":{"body":"What do we generally use in terms of fetching? Eg, what does createElement(\"img\") do if you add a src?","msgtype":"m.text"},"ts":1535375823000,"senderName":"JakeA","senderId":"JakeA@irc"},
{"content":{"body":"JakeA: that uses the node document's relevant global object prolly","msgtype":"m.text"},"ts":1535375856000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"https://fetch.spec.whatwg.org/#dom-global-fetch invokes new Request() (unclear from which global, I think there's an issue on that)","msgtype":"m.text"},"ts":1535375924000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"new Request() sets client to the current global object, which would always be parent if you do frame.contentWindow.fetch() I think","msgtype":"m.text"},"ts":1535375944000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"So I think the existing pattern is at odds with the spec","msgtype":"m.text"},"ts":1535375973000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"I'm not trying to defend the spec btw; clearly it wasn't tested properly","msgtype":"m.text"},"ts":1535376048000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"isn't*","msgtype":"m.text"},"ts":1535376051000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"annevk: here is the glitch version: https://sw-fetch-final-response-url.glitch.me/","msgtype":"m.text"},"ts":1535376250000,"senderName":"wanderview","senderId":"wanderview@irc"},
{"content":{"body":"annevk: and yea, it seems like the final URL replacement is not working for some reason","msgtype":"m.text"},"ts":1535376264000,"senderName":"wanderview","senderId":"wanderview@irc"},
{"content":{"body":"wanderview: JakeA: I think https://github.com/whatwg/fetch/issues/777 tracks the realm/global/settings object issue","msgtype":"m.text"},"ts":1535376402000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"wanderview: JakeA: note that even if I could use frame.contentWindow.fetch(), that would still result in overall failure upon the first failure","msgtype":"m.text"},"ts":1535376527000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"wanderview: JakeA: or would you then just make new promise_test wrappers for each scenario?","msgtype":"m.text"},"ts":1535376545000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"annevk: separate promise_test for each case so that browsers can mark them individually expected pass/fail","msgtype":"m.text"},"ts":1535376566000,"senderName":"wanderview","senderId":"wanderview@irc"},
{"content":{"body":"IMO","msgtype":"m.text"},"ts":1535376568000,"senderName":"wanderview","senderId":"wanderview@irc"},
{"content":{"body":"wanderview: but you'd setup the SW in the first test?","msgtype":"m.text"},"ts":1535376611000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"I guess that's okay...","msgtype":"m.text"},"ts":1535376618000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"annevk: I usually setup/teardown the service worker in each test case... but chromium team has been moving new tests to a \"setup\" case at the beginning that setups up the SW registration","msgtype":"m.text"},"ts":1535376656000,"senderName":"wanderview","senderId":"wanderview@irc"},
{"content":{"body":"to make the tests faster","msgtype":"m.text"},"ts":1535376659000,"senderName":"wanderview","senderId":"wanderview@irc"},
{"content":{"body":"Interesting. I'd been setting up per test, but I guess one is fine. Is setup able to be async yet?","msgtype":"m.text"},"ts":1535376770000,"senderName":"JakeA","senderId":"JakeA@irc"},
{"content":{"body":"I remember that being a problem","msgtype":"m.text"},"ts":1535376776000,"senderName":"JakeA","senderId":"JakeA@irc"},
{"content":{"body":"folks seem to prefer promise_test to make things sequential","msgtype":"m.text"},"ts":1535376881000,"senderName":"wanderview","senderId":"wanderview@irc"},
{"content":{"body":"I was thinking just using promise_test and making the title \"setup\"","msgtype":"m.text"},"ts":1535376883000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"annevk: I've done that before too. Works well.","msgtype":"m.text"},"ts":1535376906000,"senderName":"JakeA","senderId":"JakeA@irc"},
{"content":{"body":"and maybe nest the other promise_tests inside so cleanup remains working well...","msgtype":"m.text"},"ts":1535376936000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"annevk: would you like me to file the final response URL bug?","msgtype":"m.text"},"ts":1535377282000,"senderName":"wanderview","senderId":"wanderview@irc"},
{"content":{"body":"wanderview: sure","msgtype":"m.text"},"ts":1535377662000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"annevk: I think this is a problem in fetch() ignoring URL changes for internal redirects","msgtype":"m.text"},"ts":1535378442000,"senderName":"wanderview","senderId":"wanderview@irc"},
{"content":{"body":"annevk: yep, that is the problem: https://searchfox.org/mozilla-central/rev/e126996d9b0a3d7653de205898517f4f5b632e7f/dom/fetch/FetchDriver.cpp#1285","msgtype":"m.text"},"ts":1535378652000,"senderName":"wanderview","senderId":"wanderview@irc"},
{"content":{"body":"annevk: filed here: https://bugzilla.mozilla.org/show_bug.cgi?id=1486445","msgtype":"m.text"},"ts":1535378675000,"senderName":"wanderview","senderId":"wanderview@irc"},
{"content":{"body":"should be an easy fix once you have tests","msgtype":"m.text"},"ts":1535378680000,"senderName":"wanderview","senderId":"wanderview@irc"},
{"content":{"body":"wanderview: sorry for the slow turnaround, but I added a couple more tests at https://github.com/web-platform-tests/wpt/pull/12680 now","msgtype":"m.text"},"ts":1535387619000,"senderName":"annevk","senderId":"annevk@irc"}
]
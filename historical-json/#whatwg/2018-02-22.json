[
{"content":{"body":"TabAtkins: about @charset, is it valid per the relevant CSS specs?","msgtype":"m.text"},"ts":1519259039000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"if not, is there normative statement somewhere about it not being valid?","msgtype":"m.text"},"ts":1519259063000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"I ask because at https://drafts.csswg.org/css-syntax-3/#charset-rule I see the following notes:","msgtype":"m.text"},"ts":1519259082000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"> Note: The algorithm to parse a stylesheet explicitly drops the first @charset rule from the document, before the stylesheet is grammar-checked, so valid rules that must appear first in the stylesheet, such as @import, can still be preceded by an (invalid) @charset rule without making themselves invalid.","msgtype":"m.text"},"ts":1519259098000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"The answer is slightly complex: @charset, the at-rule, is invalid.  But @charset, the ASCII byte sequence, is allowed at the start of the stylesheet, according to some stringent requirements.","msgtype":"m.text"},"ts":1519259102000,"senderName":"TabAtkins","senderId":"TabAtkins@irc"},
{"content":{"body":"OK","msgtype":"m.text"},"ts":1519259110000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"AKA, there's no such thing as a @charset at-rule, but CSS's inline encoding declaration happens to look similar to an at-rule. ^_^","msgtype":"m.text"},"ts":1519259147000,"senderName":"TabAtkins","senderId":"TabAtkins@irc"},
{"content":{"body":"hai","msgtype":"m.text"},"ts":1519259155000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"It probably shouldn't say that it drops the first @charset rule then? but that it drops a sequence resembling such a rule?","msgtype":"m.text"},"ts":1519285406000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"@annevk Nah, it's accurate. This stuff happens, conceptually, before grammar-checking.  Everything at-rule-shaped parses into an at-rule, and then later invalid ones get thrown out.  So we first recognize the byte sequence as an encoding declaration, then parsing runs and turns it into an at-rule, then grammar-checking runs and discards it as invalid (or would, if we didn't first throw it out).","msgtype":"m.text"},"ts":1519327091000,"senderName":"TabAtkins","senderId":"TabAtkins@irc"},
{"content":{"body":"When do you throw it out?","msgtype":"m.text"},"ts":1519331721000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"annevk: https://drafts.csswg.org/css-syntax/#parse-stylesheet","msgtype":"m.text"},"ts":1519334824000,"senderName":"TabAtkins","senderId":"TabAtkins@irc"},
{"content":{"body":"Step 3","msgtype":"m.text"},"ts":1519334833000,"senderName":"TabAtkins","senderId":"TabAtkins@irc"}
]
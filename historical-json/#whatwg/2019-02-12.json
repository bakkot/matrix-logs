[
{"content":{"body":"Domenic: when can you review https://github.com/whatwg/html/pull/4350?","msgtype":"m.text"},"ts":1549960580000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"annevk: Currently doing my style test, will push a bunch of commits soon to wpt.","msgtype":"m.text"},"ts":1549966431000,"senderName":"nox","senderId":"nox@irc"},
{"content":{"body":"annevk: It seems like only Firefox postpones style sheet creation.","msgtype":"m.text"},"ts":1549966899000,"senderName":"nox","senderId":"nox@irc"},
{"content":{"body":"Wait no, it's worse than that.","msgtype":"m.text"},"ts":1549966988000,"senderName":"nox","senderId":"nox@irc"},
{"content":{"body":"nox: be sure to thank it if it doesn't spark joy","msgtype":"m.text"},"ts":1549967157000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"annevk: Wait for it ðŸ˜Ž","msgtype":"m.text"},"ts":1549967188000,"senderName":"nox","senderId":"nox@irc"},
{"content":{"body":"annevk: https://github.com/web-platform-tests/wpt/pull/15264/commits/5082ab66dbe7c24b3a62f86251fc1ba81de79690#diff-e454c28d2f53c313161aa05dbdeca653R36","msgtype":"m.text"},"ts":1549967221000,"senderName":"nox","senderId":"nox@irc"},
{"content":{"body":"This is what my new prose unexpectedly requires, and what Firefox actually does.","msgtype":"m.text"},"ts":1549967254000,"senderName":"nox","senderId":"nox@irc"},
{"content":{"body":"nox: seems reasonable","msgtype":"m.text"},"ts":1549967293000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"annevk: You think so? I literally wrote the opposite assertion at first because I was thinking \"surely browsers don't do that\".","msgtype":"m.text"},"ts":1549967399000,"senderName":"nox","senderId":"nox@irc"},
{"content":{"body":"annevk: Chrome fails at the first assertion because it already created a style sheet when the script starts executing,","msgtype":"m.text"},"ts":1549967461000,"senderName":"nox","senderId":"nox@irc"},
{"content":{"body":"and it does so for both tests, it doesn't matter whether the element are inserted from a div or from a fragment.","msgtype":"m.text"},"ts":1549967497000,"senderName":"nox","senderId":"nox@irc"},
{"content":{"body":"Same for Safari in the case of inserting from a div.","msgtype":"m.text"},"ts":1549967551000,"senderName":"nox","senderId":"nox@irc"},
{"content":{"body":"nox: so they create the style sheet at insertion time?","msgtype":"m.text"},"ts":1549967585000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"annevk: Yes, contrary to Firefox.","msgtype":"m.text"},"ts":1549967594000,"senderName":"nox","senderId":"nox@irc"},
{"content":{"body":"nox: that might also be okay? I don't know if there's a problem with that?","msgtype":"m.text"},"ts":1549967602000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"nox: something to ask bz","msgtype":"m.text"},"ts":1549967607000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"Yeah.","msgtype":"m.text"},"ts":1549967612000,"senderName":"nox","senderId":"nox@irc"},
{"content":{"body":"annevk: I just thought from reading the various issues that it was common behaviour among all browsers. Clearly I misread.","msgtype":"m.text"},"ts":1549967629000,"senderName":"nox","senderId":"nox@irc"},
{"content":{"body":"annevk: https://github.com/whatwg/dom/pull/576#issuecomment-368598457","msgtype":"m.text"},"ts":1549967741000,"senderName":"nox","senderId":"nox@irc"},
{"content":{"body":"That should read \"Except in Edge and in Chrome\" I think :)","msgtype":"m.text"},"ts":1549967757000,"senderName":"nox","senderId":"nox@irc"},
{"content":{"body":"annevk: So I should ping bz on the HTML PR no?","msgtype":"m.text"},"ts":1549967957000,"senderName":"nox","senderId":"nox@irc"},
{"content":{"body":"nox: yeah let's do that","msgtype":"m.text"},"ts":1549967995000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"nox: I've also tried to add some more cross linking, but haven't dug up all the DOM issues yet","msgtype":"m.text"},"ts":1549968025000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"annevk: The postponing itself is why Firefox recreates a stylesheet for no reason in my latest test,","msgtype":"m.text"},"ts":1549968029000,"senderName":"nox","senderId":"nox@irc"},
{"content":{"body":"so if we stop doing that, we also fix that \"problem\".","msgtype":"m.text"},"ts":1549968039000,"senderName":"nox","senderId":"nox@irc"},
{"content":{"body":"annevk: https://github.com/whatwg/html/pull/4354/files#r255897129 Done","msgtype":"m.text"},"ts":1549968279000,"senderName":"nox","senderId":"nox@irc"},
{"content":{"body":"nox: still curious about the multiple script case where s1 modifies s2","msgtype":"m.text"},"ts":1549968292000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"annevk: I added that","msgtype":"m.text"},"ts":1549968301000,"senderName":"nox","senderId":"nox@irc"},
{"content":{"body":"oh","msgtype":"m.text"},"ts":1549968307000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"annevk: https://github.com/web-platform-tests/wpt/pull/15264/commits/ba850650821a4b0d28c1c8b623a262abc346403f","msgtype":"m.text"},"ts":1549968310000,"senderName":"nox","senderId":"nox@irc"},
{"content":{"body":"annevk: I already had a similar one for scripts inserted from a div, the document fragment isn't that much different.","msgtype":"m.text"},"ts":1549968334000,"senderName":"nox","senderId":"nox@irc"},
{"content":{"body":"Mostly differs in Safari given it inserts nodes from fragments one by one.","msgtype":"m.text"},"ts":1549968348000,"senderName":"nox","senderId":"nox@irc"},
{"content":{"body":"nox: I guess this does indicate the modification affects order, but it doesn't demonstrate it affects what gets executed","msgtype":"m.text"},"ts":1549968373000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"annevk: I don't understand what you mean.","msgtype":"m.text"},"ts":1549968385000,"senderName":"nox","senderId":"nox@irc"},
{"content":{"body":"annevk: Oh you mean I shouldn't add an empty string but some more code?","msgtype":"m.text"},"ts":1549968407000,"senderName":"nox","senderId":"nox@irc"},
{"content":{"body":"nox: say the script was first \"y = 1\" and then it got changed to \"y = 2\"","msgtype":"m.text"},"ts":1549968408000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"nox: aya","msgtype":"m.text"},"ts":1549968415000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"uh","msgtype":"m.text"},"ts":1549968419000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"aye","msgtype":"m.text"},"ts":1549968439000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"annevk: I'll append s3Ran = true then.","msgtype":"m.text"},"ts":1549968452000,"senderName":"nox","senderId":"nox@irc"},
{"content":{"body":"sg","msgtype":"m.text"},"ts":1549968468000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"annevk: Done.","msgtype":"m.text"},"ts":1549968580000,"senderName":"nox","senderId":"nox@irc"},
{"content":{"body":"annevk: I forgot one","msgtype":"m.text"},"ts":1549968648000,"senderName":"nox","senderId":"nox@irc"},
{"content":{"body":"annevk: Inserting a script in a script, and make it change its parent script.","msgtype":"m.text"},"ts":1549968758000,"senderName":"nox","senderId":"nox@irc"},
{"content":{"body":"annevk: Ouch, my spec is wrong when it comes to that case.","msgtype":"m.text"},"ts":1549969303000,"senderName":"nox","senderId":"nox@irc"},
{"content":{"body":"aww","msgtype":"m.text"},"ts":1549969406000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"annevk: Ok, indeed we need to split prepare a script in two.","msgtype":"m.text"},"ts":1549969559000,"senderName":"nox","senderId":"nox@irc"},
{"content":{"body":"annevk: Or maybe not!","msgtype":"m.text"},"ts":1549969622000,"senderName":"nox","senderId":"nox@irc"},
{"content":{"body":"Everyone is wrong and all in their own way.","msgtype":"m.text"},"ts":1549969745000,"senderName":"nox","senderId":"nox@irc"},
{"content":{"body":"annevk: https://github.com/web-platform-tests/wpt/pull/15264/commits/f8fef1d7127b7559aa9e19a9ebec07f169f9055e","msgtype":"m.text"},"ts":1549969797000,"senderName":"nox","senderId":"nox@irc"},
{"content":{"body":"[so close.jpg]","msgtype":"m.text"},"ts":1549969801000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"looks","msgtype":"m.emote"},"ts":1549969814000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"So this test shows two things:","msgtype":"m.text"},"ts":1549969816000,"senderName":"nox","senderId":"nox@irc"},
{"content":{"body":"Safari and Chrome start executing the code inserted in s1 and fail at assert_true(s2Started, \"s2 did not start\");","msgtype":"m.text"},"ts":1549969841000,"senderName":"nox","senderId":"nox@irc"},
{"content":{"body":"Firefox starts executing the code in s2 and fail at assert_true(s1Started, \"s1 did not start\");","msgtype":"m.text"},"ts":1549969864000,"senderName":"nox","senderId":"nox@irc"},
{"content":{"body":"So Safari and Chrome don't seem to follow the current spec which states: 'the user agent must immediately prepare the script element: (â€¦) The script element is connected and a node or document fragment is inserted into the script element, *after any script elements inserted at that time.*'","msgtype":"m.text"},"ts":1549969925000,"senderName":"nox","senderId":"nox@irc"},
{"content":{"body":"And Firefox may or may not be following that bit of the spec, depending on how you read it.","msgtype":"m.text"},"ts":1549969976000,"senderName":"nox","senderId":"nox@irc"},
{"content":{"body":"I personally expected s1 to be ran when s2 modifies it.","msgtype":"m.text"},"ts":1549969985000,"senderName":"nox","senderId":"nox@irc"},
{"content":{"body":"Running s1 then s2 does not seem too bad to me","msgtype":"m.text"},"ts":1549970008000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"Now I wonder which order is used for a nested script inside a script inside a div inserted in a document.","msgtype":"m.text"},"ts":1549970033000,"senderName":"nox","senderId":"nox@irc"},
{"content":{"body":"annevk: So making s2 impossible to change s1 then?","msgtype":"m.text"},"ts":1549970055000,"senderName":"nox","senderId":"nox@irc"},
{"content":{"body":"(Given scripts are executed only once)","msgtype":"m.text"},"ts":1549970062000,"senderName":"nox","senderId":"nox@irc"},
{"content":{"body":"annevk: I would prefer running s1 then s2 too, because that keeps evaluation in tree order.","msgtype":"m.text"},"ts":1549970187000,"senderName":"nox","senderId":"nox@irc"},
{"content":{"body":"It is a bit at odds with my test with three scripts where the first one changes the third one, though.","msgtype":"m.text"},"ts":1549970204000,"senderName":"nox","senderId":"nox@irc"},
{"content":{"body":"Ah no it's not at odds never mind.","msgtype":"m.text"},"ts":1549970216000,"senderName":"nox","senderId":"nox@irc"},
{"content":{"body":"s1 then s2 is current Chrome behaviour","msgtype":"m.text"},"ts":1549970286000,"senderName":"nox","senderId":"nox@irc"},
{"content":{"body":"nox: ah, as I thought .mailmap doesn't affect `git log` by default :/","msgtype":"m.text"},"ts":1549972895000,"senderName":"gsnedders","senderId":"gsnedders@irc"},
{"content":{"body":"gsnedders: GH uses it AFAIR","msgtype":"m.text"},"ts":1549972930000,"senderName":"nox","senderId":"nox@irc"},
{"content":{"body":"Ah right I forgot that my local config enables it https://github.com/nox/dotfiles/blob/master/config/git/config#L44","msgtype":"m.text"},"ts":1549972959000,"senderName":"nox","senderId":"nox@irc"},
{"content":{"body":"annevk: Would appreciate your thoughts on https://github.com/w3c/resource-timing/issues/202. Basically, if a user goes to page A.COM which loads a CORS-enabled resource from b.com, and the resource contains `ACAO: a.com\\r\\nTAO: a.com`, what's expected to happen?","msgtype":"m.text"},"ts":1549973524000,"senderName":"yoav","senderId":"yoav@irc"},
{"content":{"body":"would the origin serialization keep the origin as \"A.COM\"?","msgtype":"m.text"},"ts":1549973545000,"senderName":"yoav","senderId":"yoav@irc"},
{"content":{"body":"yoav: assuming that's ASCII, no","msgtype":"m.text"},"ts":1549973709000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"oh, so there's a lowercasing phase that I missed? Can you point me to it?","msgtype":"m.text"},"ts":1549973746000,"senderName":"yoav","senderId":"yoav@irc"},
{"content":{"body":"(assuming ASCII indeed)","msgtype":"m.text"},"ts":1549973755000,"senderName":"yoav","senderId":"yoav@irc"},
{"content":{"body":"yoav: URL parser","msgtype":"m.text"},"ts":1549973810000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"ok. So in the example above, TAO and ACAO will pass checks","msgtype":"m.text"},"ts":1549973890000,"senderName":"yoav","senderId":"yoav@irc"},
{"content":{"body":"OTOH, `ACAO: A.COM` will never pass","msgtype":"m.text"},"ts":1549973903000,"senderName":"yoav","senderId":"yoav@irc"},
{"content":{"body":"is that correct?","msgtype":"m.text"},"ts":1549973907000,"senderName":"yoav","senderId":"yoav@irc"},
{"content":{"body":"yoav: aye","msgtype":"m.text"},"ts":1549973915000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"cool","msgtype":"m.text"},"ts":1549973933000,"senderName":"yoav","senderId":"yoav@irc"},
{"content":{"body":"(you also need a scheme there, but I guess that's clear)","msgtype":"m.text"},"ts":1549973955000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"yeah","msgtype":"m.text"},"ts":1549974058000,"senderName":"yoav","senderId":"yoav@irc"},
{"content":{"body":"annevk: How can a script element be connected and have text contents and still not be executed?","msgtype":"m.text"},"ts":1549982999000,"senderName":"nox","senderId":"nox@irc"},
{"content":{"body":"annevk: Forget that question I misread something.","msgtype":"m.text"},"ts":1549983032000,"senderName":"nox","senderId":"nox@irc"},
{"content":{"body":"annevk: I'll patch my HTML patch to make it always execute the script in which we just added contents be evaluated first, given that's what Chrome seem to do and what I think is the most logical.","msgtype":"m.text"},"ts":1549983069000,"senderName":"nox","senderId":"nox@irc"},
{"content":{"body":"annevk: Shouldn't we ping someone working on Chrome too?","msgtype":"m.text"},"ts":1549983225000,"senderName":"nox","senderId":"nox@irc"},
{"content":{"body":"nox: tkent-google might be able to help here","msgtype":"m.text"},"ts":1549983346000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"annevk: Ok.","msgtype":"m.text"},"ts":1549983364000,"senderName":"nox","senderId":"nox@irc"},
{"content":{"body":"annevk: At least, the DOM changes are solid, and if we end up preparing scripts in tree order (with the one in which we added stuff prepared first), we can even simplify \"children added steps\" to not use deferredStepsQueue.","msgtype":"m.text"},"ts":1549983407000,"senderName":"nox","senderId":"nox@irc"},
{"content":{"body":"wanderview: you might know... any service worker heavy web sites, especially sites which use service workers heavily during page load?","msgtype":"m.text"},"ts":1549984755000,"senderName":"smaug____","senderId":"smaug____@irc"},
{"content":{"body":"smaug____: some large sites using service worker FetchEvent are mobile.twitter.com, photos.google.com, m.uber.com","msgtype":"m.text"},"ts":1549985908000,"senderName":"wanderview","senderId":"wanderview@irc"},
{"content":{"body":"smaug____: for sites that are hitting performance problems, though, they often gate on navigationPreload (not implemented in FF yet) or have not launched their FetchEvent support yet","msgtype":"m.text"},"ts":1549985949000,"senderName":"wanderview","senderId":"wanderview@irc"},
{"content":{"body":"wanderview: anything using fetch()","msgtype":"m.text"},"ts":1549985998000,"senderName":"smaug____","senderId":"smaug____@irc"},
{"content":{"body":"given how SW is implemented in Gecko","msgtype":"m.text"},"ts":1549986008000,"senderName":"smaug____","senderId":"smaug____@irc"},
{"content":{"body":"but aha, photos","msgtype":"m.text"},"ts":1549986028000,"senderName":"smaug____","senderId":"smaug____@irc"},
{"content":{"body":"that could be something for desktop","msgtype":"m.text"},"ts":1549986033000,"senderName":"smaug____","senderId":"smaug____@irc"},
{"content":{"body":"tests","msgtype":"m.emote"},"ts":1549986035000,"senderName":"smaug____","senderId":"smaug____@irc"},
{"content":{"body":"the photos one may be mainly a fallback to network","msgtype":"m.text"},"ts":1549986057000,"senderName":"wanderview","senderId":"wanderview@irc"},
{"content":{"body":"I can't recall","msgtype":"m.text"},"ts":1549986061000,"senderName":"wanderview","senderId":"wanderview@irc"},
{"content":{"body":"smaug____: do you mean a case where the site is doing something like evt.respondWith(fetch(evt.request)) in their service worker?","msgtype":"m.text"},"ts":1549986086000,"senderName":"wanderview","senderId":"wanderview@irc"},
{"content":{"body":"something like that","msgtype":"m.text"},"ts":1549986120000,"senderName":"smaug____","senderId":"smaug____@irc"},
{"content":{"body":"anything where SW controls the network connection","msgtype":"m.text"},"ts":1549986131000,"senderName":"smaug____","senderId":"smaug____@irc"},
{"content":{"body":"ok... \"anything where SW controls the network connection\" does not require fetch() to be used... so not sure what you meant by that","msgtype":"m.text"},"ts":1549986170000,"senderName":"wanderview","senderId":"wanderview@irc"},
{"content":{"body":"or uses Cache","msgtype":"m.text"},"ts":1549986209000,"senderName":"smaug____","senderId":"smaug____@irc"},
{"content":{"body":"wanderview: ok, in practice heavy use of Cache API or fetch()","msgtype":"m.text"},"ts":1549986242000,"senderName":"smaug____","senderId":"smaug____@irc"},
{"content":{"body":"smaug____: this is the URL use of ThrottledTaskQueue you mentioned in that bug?","msgtype":"m.text"},"ts":1549986267000,"senderName":"wanderview","senderId":"wanderview@irc"},
{"content":{"body":"looks like photos.google.com at least uses cache","msgtype":"m.text"},"ts":1549986269000,"senderName":"smaug____","senderId":"smaug____@irc"},
{"content":{"body":"yes","msgtype":"m.text"},"ts":1549986272000,"senderName":"smaug____","senderId":"smaug____@irc"},
{"content":{"body":"I'm doubtful that is significant, but I guess measuring is always a good idea","msgtype":"m.text"},"ts":1549986357000,"senderName":"wanderview","senderId":"wanderview@irc"},
{"content":{"body":"it is definitely very significant","msgtype":"m.text"},"ts":1549986397000,"senderName":"smaug____","senderId":"smaug____@irc"},
{"content":{"body":"there are profiles showing that","msgtype":"m.text"},"ts":1549986406000,"senderName":"smaug____","senderId":"smaug____@irc"},
{"content":{"body":"during page load normal prio queue is very busy","msgtype":"m.text"},"ts":1549986448000,"senderName":"smaug____","senderId":"smaug____@irc"},
{"content":{"body":"but ok thanks, photos.google.com is a good example for desktop","msgtype":"m.text"},"ts":1549986498000,"senderName":"smaug____","senderId":"smaug____@irc"},
{"content":{"body":"I thought MT URL parsing was no longer necessary anyways","msgtype":"m.text"},"ts":1549986533000,"senderName":"wanderview","senderId":"wanderview@irc"},
{"content":{"body":"nox: counter to bz would also be iframe or some such","msgtype":"m.text"},"ts":1549991041000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"nox: I hope this works out as it seems the resulting model is not that complex","msgtype":"m.text"},"ts":1549991122000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"Yeah","msgtype":"m.text"},"ts":1549991185000,"senderName":"nox","senderId":"nox@irc"},
{"content":{"body":"smaug____: btw, if you just want to stress service worker subresource loading paths, then JakeA's site here is good: https://jakearchibald.github.io/service-worker-benchmark/","msgtype":"m.text"},"ts":1549991716000,"senderName":"wanderview","senderId":"wanderview@irc"},
{"content":{"body":"sorry I didn't think of that initially","msgtype":"m.text"},"ts":1549991724000,"senderName":"wanderview","senderId":"wanderview@irc"},
{"content":{"body":"wanderview: great, thanks! I'm so noob with service worker stuff","msgtype":"m.text"},"ts":1549991774000,"senderName":"smaug____","senderId":"smaug____@irc"},
{"content":{"body":"smaug____: word of warning, you have to be careful not to trigger image cache with that site... I find opening in a new tab is better than a reload","msgtype":"m.text"},"ts":1549991869000,"senderName":"wanderview","senderId":"wanderview@irc"},
{"content":{"body":"Hmm, wondering what APIs might be invoking CSS's \"parse a component value\" algorithm. I find that Manifests is, in parsing theme-color, but that's hard to test. Anyone know of another that I can invoke more easily?","msgtype":"m.text"},"ts":1550013154000,"senderName":"TabAtkins","senderId":"TabAtkins@irc"}
]
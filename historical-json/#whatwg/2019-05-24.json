[
{"content":{"body":"annevk: How is the origin on a document generally assigned? I see it only as through document construction, in https://html.spec.whatwg.org/multipage/browsers.html#creating-browsing-contexts. I'm trying to match the spec to Chromium's code. When we create a document we already know the origin and I was trying to enforce that.  I think the problem stems from the fact that Chromium doesn't follow..","msgtype":"m.text"},"ts":1558703914000,"senderName":"dtapuska","senderId":"dtapuska@irc"},
{"content":{"body":"https://html.spec.whatwg.org/multipage/browsing-the-web.html#read-html  and a new document object is created with the origin when a page is loaded so we go into that.    So how is the origin set correctly when using https://html.spec.whatwg.org/multipage/browsing-the-web.html#read-html ?","msgtype":"m.text"},"ts":1558703914000,"senderName":"dtapuska","senderId":"dtapuska@irc"},
{"content":{"body":"dtapuska: the whole document creation process is defined very poorly","msgtype":"m.text"},"ts":1558704015000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"dtapuska: origin is therefore defined with action-at-a-distance: https://html.spec.whatwg.org/#origin:document-2","msgtype":"m.text"},"ts":1558704068000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"annevk: We can't define it in that fashion for agent.. because an agent shouldn't change as the page loads... ie; the agent needs to be fixed at document creation.. So fundamentally we need to adjust the navigation algorithms to force a load of the document with the origin predetermined.","msgtype":"m.text"},"ts":1558704184000,"senderName":"dtapuska","senderId":"dtapuska@irc"},
{"content":{"body":"My process was... determine the origin of the document, create the agent associated, create the execution context, create the document","msgtype":"m.text"},"ts":1558704216000,"senderName":"dtapuska","senderId":"dtapuska@irc"},
{"content":{"body":"determining the origin of the document requires us to determine the sandbox flags first.. as well, but I think that makes it clear how you want feature policy sandbox flags to work","msgtype":"m.text"},"ts":1558704259000,"senderName":"dtapuska","senderId":"dtapuska@irc"},
{"content":{"body":"dtapuska: a document's origin shouldn't change either, but yes, agreed","msgtype":"m.text"},"ts":1558704264000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"I do need to remove that other section about determining if two windows are the same agent.. basically it should be if the realm's execution content's agent is the same then they are the same..","msgtype":"m.text"},"ts":1558704337000,"senderName":"dtapuska","senderId":"dtapuska@irc"},
{"content":{"body":"(I'm also not trying to hold this up as an example of good design; my goal is that eventually we have \"create a document\" that takes various parameters)","msgtype":"m.text"},"ts":1558704344000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"(I guess I'm trying to say, please don't take inspiration from this setup)","msgtype":"m.text"},"ts":1558704398000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"I agree.. I think my latest patch is far better than the last attempt..  Are you really confused by it? I thought it was clearer.","msgtype":"m.text"},"ts":1558704407000,"senderName":"dtapuska","senderId":"dtapuska@irc"},
{"content":{"body":"dtapuska: I am, as I don't quite see how it works when you navigate an existing browsing context","msgtype":"m.text"},"ts":1558704483000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"dtapuska: at that point you might end up in a different agent cluster, but how that works if determining an origin only really works for popups is not very clear to me","msgtype":"m.text"},"ts":1558704512000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"dtapuska: one other nit, you should make \"obtain a\" part of the <dfn> in various places","msgtype":"m.text"},"ts":1558704682000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"Yes so that is certainly broken. Do we have a response in these pieces of code: https://html.spec.whatwg.org/multipage/browsing-the-web.html#read-html","msgtype":"m.text"},"ts":1558704740000,"senderName":"dtapuska","senderId":"dtapuska@irc"},
{"content":{"body":"Because \"create a Document\" really should be passing in the origin.","msgtype":"m.text"},"ts":1558704759000,"senderName":"dtapuska","senderId":"dtapuska@irc"},
{"content":{"body":"It's called from code that has a response and can do the right thing","msgtype":"m.text"},"ts":1558704806000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"Untangling it however is another matter","msgtype":"m.text"},"ts":1558704813000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"ie; can we change https://html.spec.whatwg.org/multipage/browsers.html#creating-a-new-browsing-context to also take an optional resource origin?  And change those spots to pass a resource origin?","msgtype":"m.text"},"ts":1558704913000,"senderName":"dtapuska","senderId":"dtapuska@irc"},
{"content":{"body":"It's on my list of things to do, but email/GitHub/admin/review ends up taking so much time I never really get to it","msgtype":"m.text"},"ts":1558704921000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"dtapuska: creating a browsing context isn't really the complicated piece","msgtype":"m.text"},"ts":1558704946000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"dtapuska: that already has an origin (opaque) or its creator origin (whatever its value)","msgtype":"m.text"},"ts":1558704978000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"dtapuska: that covers about:blank","msgtype":"m.text"},"ts":1558704988000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"dtapuska: then there's navigation","msgtype":"m.text"},"ts":1558704998000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"dtapuska: that keeps the browsing context around, but changes what is displayed","msgtype":"m.text"},"ts":1558705013000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"dtapuska: that's where things get hairy","msgtype":"m.text"},"ts":1558705022000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"(and it might also not be that complicated since in the abstract it's not, but the way the spec is written just ...)","msgtype":"m.text"},"ts":1558705113000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"I guess I'm confused why:  \"the user agent must queue a task to create a Document object, mark it as being an HTML document, set its content type to \"text/html\", initialize the Document object\"..  Could we define new steps for \"initialize a browsing context with a new document\" ? ie; the separate \"create a Document\" and \"initialize the document object\" create this issue that the origin is not defined on document creation.","msgtype":"m.text"},"ts":1558705864000,"senderName":"dtapuska","senderId":"dtapuska@irc"},
{"content":{"body":"or that it transitions from oqaque origin -> actual origin","msgtype":"m.text"},"ts":1558705896000,"senderName":"dtapuska","senderId":"dtapuska@irc"},
{"content":{"body":"which creates issues for defining the agent cluster","msgtype":"m.text"},"ts":1558705903000,"senderName":"dtapuska","senderId":"dtapuska@irc"},
{"content":{"body":"That, and the fact that we create the document before we create the global it's created in","msgtype":"m.text"},"ts":1558706005000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"dtapuska: so the actual change to the browsing context happens later","msgtype":"m.text"},"ts":1558706137000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"dtapuska: there's two callers of \"set the active document\"","msgtype":"m.text"},"ts":1558706157000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"dtapuska: one is during browsing context creation and the other is in history traversal, which is what navigate bottoms out to","msgtype":"m.text"},"ts":1558706190000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"Ok; so perhaps \"initialize a browsing context with a new document\" is a poor name, it could be simply \"create a document and execution context\" algorithm... does that approach make sense?","msgtype":"m.text"},"ts":1558707590000,"senderName":"dtapuska","senderId":"dtapuska@irc"},
{"content":{"body":"dtapuska: ah yeah, I see what you mean, something like that would make sense","msgtype":"m.text"},"ts":1558708463000,"senderName":"annevk","senderId":"annevk@irc"}
]
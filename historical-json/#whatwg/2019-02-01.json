[
{"content":{"body":"https://stackoverflow.com/questions/52791470/how-to-package-or-import-html-templates-without-html-imports","msgtype":"m.text"},"ts":1548982731000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"So I want to add rel=\"\" to <form>","msgtype":"m.text"},"ts":1549030272000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"Should I recast <form> as a hyperlink?","msgtype":"m.text"},"ts":1549030277000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"That seems pretty reasonable from my perspective, but maybe folks think that's nonsense?","msgtype":"m.text"},"ts":1549030299000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"Domenic: MikeSmith: ^^","msgtype":"m.text"},"ts":1549030325000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"annevk: I’m going to push a PR to the insert algo of the DOM spec either later today or next week.","msgtype":"m.text"},"ts":1549030336000,"senderName":"nox","senderId":"nox@irc"},
{"content":{"body":"nox: sounds exciting","msgtype":"m.text"},"ts":1549030364000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"annevk: https://gist.github.com/nox/0bb2a3f5f0223b3ec273d97d586db7eb","msgtype":"m.text"},"ts":1549030391000,"senderName":"nox","senderId":"nox@irc"},
{"content":{"body":"According to a pedantic reading of the spec, that should log null.","msgtype":"m.text"},"ts":1549030403000,"senderName":"nox","senderId":"nox@irc"},
{"content":{"body":"Err, a collection of length 0","msgtype":"m.text"},"ts":1549030418000,"senderName":"nox","senderId":"nox@irc"},
{"content":{"body":"nox: oh, so that's a pretty complicated issue","msgtype":"m.text"},"ts":1549030443000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"annevk: Is there an issue already?","msgtype":"m.text"},"ts":1549030453000,"senderName":"nox","senderId":"nox@irc"},
{"content":{"body":"Safari seems to follow the spec and the others not.","msgtype":"m.text"},"ts":1549030463000,"senderName":"nox","senderId":"nox@irc"},
{"content":{"body":"nox: https://github.com/whatwg/dom/issues/575 and variants","msgtype":"m.text"},"ts":1549030492000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"nox: it basically seems that some browsers have an additional queue to do script things from","msgtype":"m.text"},"ts":1549030514000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"annevk: I see the issue a bit differently.","msgtype":"m.text"},"ts":1549030554000,"senderName":"nox","senderId":"nox@irc"},
{"content":{"body":"annevk: I think even if the rel=\"\" thing hadn’t come up, it could make sense to recast <form> as a hyperlink","msgtype":"m.text"},"ts":1549030555000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"nox: I ran out of time/interest last time I attempted to fix it","msgtype":"m.text"},"ts":1549030558000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"MikeSmith: cool","msgtype":"m.text"},"ts":1549030578000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"annevk: To me it is more about Chrome/Firefox making no difference between two children of a fragment and two children of a div being added to the tree.","msgtype":"m.text"},"ts":1549030591000,"senderName":"nox","senderId":"nox@irc"},
{"content":{"body":"E.g., they don’t run insertion steps etc until every child of the fragment are added to the tree where they belong.","msgtype":"m.text"},"ts":1549030623000,"senderName":"nox","senderId":"nox@irc"},
{"content":{"body":"annevk: It reminds me of a change I did for adopting a node, where a single loop was changed into two separate loops for running the adopting steps.","msgtype":"m.text"},"ts":1549030664000,"senderName":"nox","senderId":"nox@irc"},
{"content":{"body":"annevk: yeah, since <form> navigates, it also makes sense for to associate link types with it","msgtype":"m.text"},"ts":1549030683000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"but as far as noopener and noreferrer too, I think those never should have become link types to begin with","msgtype":"m.text"},"ts":1549030720000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"I realize it’s a lost cause now","msgtype":"m.text"},"ts":1549030731000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"MikeSmith: it did stray a bit from the original relationship angle, indeed","msgtype":"m.text"},"ts":1549030801000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"MikeSmith: I guess the main thing we don't want with <form> is for it to match :link and :visited though","msgtype":"m.text"},"ts":1549030823000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"yeah if you consider that the semantics of putting rel=stylesheet href=foo into a document is that it means the resource at foo is a stylesheet for the document","msgtype":"m.text"},"ts":1549030843000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"It seems those pseudo-classes are pretty clearly defined in terms of those elements","msgtype":"m.text"},"ts":1549030852000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"oh","msgtype":"m.text"},"ts":1549030852000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"right","msgtype":"m.text"},"ts":1549030863000,"senderName":"MikeSmith","senderId":"MikeSmith@irc"},
{"content":{"body":"nox: I don't think that's correct","msgtype":"m.text"},"ts":1549030881000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"nox: the insertion/removal steps are run, but scripts/styles are done later in a separate queue","msgtype":"m.text"},"ts":1549030903000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"nox: I found a way to observe this difference somewhere, I initially also thought the fix was what you're suggesting there","msgtype":"m.text"},"ts":1549030933000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"nox: I might be mistaken, it's been a while, but I'm pretty sure it was not that \"simple\"","msgtype":"m.text"},"ts":1549030976000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"annevk: I think you are mistaken.","msgtype":"m.text"},"ts":1549031375000,"senderName":"nox","senderId":"nox@irc"},
{"content":{"body":"annevk: Let me give you another snippet","msgtype":"m.text"},"ts":1549031407000,"senderName":"nox","senderId":"nox@irc"},
{"content":{"body":"annevk: https://gist.github.com/nox/520dd79ff14023888e6d02f10f800ec2","msgtype":"m.text"},"ts":1549031490000,"senderName":"nox","senderId":"nox@irc"},
{"content":{"body":"annevk: If it just delayed running the script, wouldn't the element not be upgraded?","msgtype":"m.text"},"ts":1549031527000,"senderName":"nox","senderId":"nox@irc"},
{"content":{"body":"nox: imagine you insert a document fragment containing an script followed by an iframe, when the script executes the iframe already needs to have its nested browsing context et al created","msgtype":"m.text"},"ts":1549032150000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"annevk: https://gist.github.com/nox/cb5cd57ac2c07966b6f19767a6e29d4e","msgtype":"m.text"},"ts":1549032174000,"senderName":"nox","senderId":"nox@irc"},
{"content":{"body":"annevk: This prints 0 in Safari and 1 in Firefox.","msgtype":"m.text"},"ts":1549032238000,"senderName":"nox","senderId":"nox@irc"},
{"content":{"body":"annevk: AFAIK, changing selectedness of options and whatnot is part of insertion steps, right?","msgtype":"m.text"},"ts":1549032251000,"senderName":"nox","senderId":"nox@irc"},
{"content":{"body":"I don't know","msgtype":"m.text"},"ts":1549032264000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"https://html.spec.whatwg.org/multipage/form-elements.html#the-select-element:nodes-are-inserted","msgtype":"m.text"},"ts":1549032281000,"senderName":"nox","senderId":"nox@irc"},
{"content":{"body":"annevk: I'll comment with my few snippets.","msgtype":"m.text"},"ts":1549032430000,"senderName":"nox","senderId":"nox@irc"},
{"content":{"body":"nox: it might mean that none of this quite makes sense, but I'm pretty sure Gecko at least has an additional queue of sorts","msgtype":"m.text"},"ts":1549032494000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"annevk: Yes it does.","msgtype":"m.text"},"ts":1549032502000,"senderName":"nox","senderId":"nox@irc"},
{"content":{"body":"nox: perhaps it does selectedness differently","msgtype":"m.text"},"ts":1549032507000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"annevk: No, using a additional queue would definitely make the script run after selectedness was handled.","msgtype":"m.text"},"ts":1549032529000,"senderName":"nox","senderId":"nox@irc"},
{"content":{"body":"(Printing 1 means it printed the index after it was handled)","msgtype":"m.text"},"ts":1549032541000,"senderName":"nox","senderId":"nox@irc"},
{"content":{"body":"annevk: I'm looking into that because I randomly found we introduced a similar concept of delaying the execution of scripts in Servo and it doesn't interact very well with insertion steps.","msgtype":"m.text"},"ts":1549032567000,"senderName":"nox","senderId":"nox@irc"},
{"content":{"body":"I'd be glad if we could sort this out somehow since not having script execution defined is not great of course","msgtype":"m.text"},"ts":1549032599000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"There's similar issues on the whatwg/html side around the parser and scripts","msgtype":"m.text"},"ts":1549032618000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"nox: https://github.com/whatwg/dom/pull/576 does indeed have that iframe/script example as to why running insertion steps later doesn't work","msgtype":"m.text"},"ts":1549033197000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"annevk: It is *so* weird.","msgtype":"m.text"},"ts":1549033304000,"senderName":"nox","senderId":"nox@irc"},
{"content":{"body":"annevk: https://gist.github.com/nox/78b0034279dbdc902e2786ee99fee75c","msgtype":"m.text"},"ts":1549033334000,"senderName":"nox","senderId":"nox@irc"},
{"content":{"body":"This prints 1, according to the spec it should print 0.","msgtype":"m.text"},"ts":1549033344000,"senderName":"nox","senderId":"nox@irc"},
{"content":{"body":"Ah never mind, I'm dumb dumb.","msgtype":"m.text"},"ts":1549033436000,"senderName":"nox","senderId":"nox@irc"},
{"content":{"body":"Forgot how promises get run, hah.","msgtype":"m.text"},"ts":1549033498000,"senderName":"nox","senderId":"nox@irc"},
{"content":{"body":"annevk: https://gist.github.com/nox/78b0034279dbdc902e2786ee99fee75c This prints 0/constructed/connected in Safari and constructed/connected/1 in Firefox, which to me makes absolutely no sense.","msgtype":"m.text"},"ts":1549033579000,"senderName":"nox","senderId":"nox@irc"},
{"content":{"body":"0/constructed/connected, to me, is what the spec currently says to do,","msgtype":"m.text"},"ts":1549033630000,"senderName":"nox","senderId":"nox@irc"},
{"content":{"body":"OTOH constructed/connected/1 sounds really really weird to me.","msgtype":"m.text"},"ts":1549033645000,"senderName":"nox","senderId":"nox@irc"},
{"content":{"body":"nox: I'm not sure why you keep referencing the spec, it's not reliable for these things","msgtype":"m.text"},"ts":1549033661000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"annevk: Sure, let's forget about the spec!","msgtype":"m.text"},"ts":1549033683000,"senderName":"nox","senderId":"nox@irc"},
{"content":{"body":"annevk: Do you have any clue why Firefox and Chrome would construct/connect the custom element before being able to say there is 1 custom-element in the tree?","msgtype":"m.text"},"ts":1549033705000,"senderName":"nox","senderId":"nox@irc"},
{"content":{"body":"annevk: AAAAAH, ignore me.","msgtype":"m.text"},"ts":1549033760000,"senderName":"nox","senderId":"nox@irc"},
{"content":{"body":"annevk: Never realised that defining a custom element would upgrade every existing element which was already in the tree…","msgtype":"m.text"},"ts":1549033779000,"senderName":"nox","senderId":"nox@irc"},
{"content":{"body":"That explains a lot.","msgtype":"m.text"},"ts":1549033782000,"senderName":"nox","senderId":"nox@irc"},
{"content":{"body":"nox: define() runs [CEReactions]","msgtype":"m.text"},"ts":1549033790000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"nox: right","msgtype":"m.text"},"ts":1549033797000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"annevk: I referenced the spec because it doesn't seem to me like Safari isn't aligned with it in any circumstance.","msgtype":"m.text"},"ts":1549033805000,"senderName":"nox","senderId":"nox@irc"},
{"content":{"body":"annevk: But the latest issue you linked with style/script does show that Safari doesn't follow the spec in that case, so thanks.","msgtype":"m.text"},"ts":1549033913000,"senderName":"nox","senderId":"nox@irc"},
{"content":{"body":"nox: it seems to me the spec is broken for several cases, also iframe/script","msgtype":"m.text"},"ts":1549033950000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"nox: hmm, maybe not for iframe","msgtype":"m.text"},"ts":1549033960000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"annevk: https://github.com/whatwg/dom/pull/576","msgtype":"m.text"},"ts":1549034448000,"senderName":"nox","senderId":"nox@irc"},
{"content":{"body":"\"annevk requested a review from nox on 21 Feb 2018\" 😂","msgtype":"m.text"},"ts":1549034463000,"senderName":"nox","senderId":"nox@irc"},
{"content":{"body":"nox: aha, now I don't even have to apologize for leaving this unsolved","msgtype":"m.text"},"ts":1549034562000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"annevk: Hah!","msgtype":"m.text"},"ts":1549034703000,"senderName":"nox","senderId":"nox@irc"},
{"content":{"body":"Domenic: if you could have another look at revising event loops that'd be great","msgtype":"m.text"},"ts":1549036969000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"Domenic: another thing I thought of is that we could require 1:1, but allow user agents (when it's safe) to block one loop on another via a line of prose","msgtype":"m.text"},"ts":1549037001000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"Domenic: that would simplify the spec model and also give us a way out for worklets","msgtype":"m.text"},"ts":1549037024000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"Domenic: and to be clear, the reason I'm working on event loops is primarily to get rid of unit of related browsing contexts and friends","msgtype":"m.text"},"ts":1549037063000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"Domenic: it's effectively the last major dependency on that","msgtype":"m.text"},"ts":1549037075000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"annevk: I'll try to find time before the weekend.","msgtype":"m.text"},"ts":1549037834000,"senderName":"Domenic","senderId":"Domenic@irc"},
{"content":{"body":"I'll be sure to run your new idea past our implementers, but so far they have preferred a spec that reflects implementations, and I think that is the correct priority of constituencies even if one that is more theoretically pure would make our jobs as spec authors simpler.","msgtype":"m.text"},"ts":1549037875000,"senderName":"Domenic","senderId":"Domenic@irc"},
{"content":{"body":"Domenic: thanks, would be nice to be able to get back to it directly after","msgtype":"m.text"},"ts":1549037878000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"Domenic: note that currently we already have different loops for worklets and windows","msgtype":"m.text"},"ts":1549037922000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"Domenic: unless they want to write a patch that fixes that, I think my approach is the only way forward there","msgtype":"m.text"},"ts":1549037939000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"Yeah, lots of confusion caused by that already, unfortunately :(","msgtype":"m.text"},"ts":1549037943000,"senderName":"Domenic","senderId":"Domenic@irc"},
{"content":{"body":"Domenic: unless you want to block the refactoring on me fixing a bug someone else introduced, which seems rather unfair","msgtype":"m.text"},"ts":1549037960000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"Domenic: and at that point I'd like some kind of escalation of talking directly to the people involved","msgtype":"m.text"},"ts":1549037979000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"Heh, isn't it you who always says we should fix our foundations before building on them?","msgtype":"m.text"},"ts":1549037993000,"senderName":"Domenic","senderId":"Domenic@irc"},
{"content":{"body":"Domenic: so yes, but 1) I still don't really see this as being problematic 2) I think unit of related browsing contexts is a far bigger problem and worth fixing sooner","msgtype":"m.text"},"ts":1549038106000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"Sure, we all have different priorities.","msgtype":"m.text"},"ts":1549038136000,"senderName":"Domenic","senderId":"Domenic@irc"},
{"content":{"body":"Domenic: that's rather dismissive","msgtype":"m.text"},"ts":1549038188000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"No, I'm just saying, please try to see both sides.","msgtype":"m.text"},"ts":1549038217000,"senderName":"Domenic","senderId":"Domenic@irc"},
{"content":{"body":"Domenic: so why isn't Google putting resources into fixing the worklet mess?","msgtype":"m.text"},"ts":1549038230000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"Domenic: afaik only Google is shipping worklets...","msgtype":"m.text"},"ts":1549038244000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"Domenic: maybe we should take that out instead?","msgtype":"m.text"},"ts":1549038253000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"I'm finding this conversation unproductive and hard to deal with first thing in the morning, and I have a meeting in 5, so I would ask that we resume it at a later time.","msgtype":"m.text"},"ts":1549038277000,"senderName":"Domenic","senderId":"Domenic@irc"},
{"content":{"body":"Domenic: I basically only have European office hours","msgtype":"m.text"},"ts":1549038309000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"annevk: could you summarize or send pointers to explain \"the worklet mess\"? I haven't been following what's getting messed up there","msgtype":"m.text"},"ts":1549038579000,"senderName":"astearns","senderId":"astearns@irc"},
{"content":{"body":"astearns: basically, must worklets always be concurrent, or not? I think it depends on the type of worklet, but the spec gives them all the same concurrent event loop","msgtype":"m.text"},"ts":1549038628000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"thanks","msgtype":"m.text"},"ts":1549038652000,"senderName":"astearns","senderId":"astearns@irc"},
{"content":{"body":"astearns: however, if they'd sometimes have to share a window event loop, that would undermine a bunch of infrastructure, which makes assumptions about window event loops (currently browsing context event loops)","msgtype":"m.text"},"ts":1549038672000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"astearns: and I think it's more complicated, it's that in principle they're allowed to be concurrent, but some types are also allowed to be interweaved","msgtype":"m.text"},"ts":1549038725000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"(but eg audio is prolly not, at least, that'd seem bad)","msgtype":"m.text"},"ts":1549038746000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"Domenic: so would it work if we kept the existing wording, except replaced it to say similar-origin window agent, and leave the security issue and worklets as a follow-up?","msgtype":"m.text"},"ts":1549039336000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"Domenic: then there wouldn't be a regression","msgtype":"m.text"},"ts":1549039367000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"Domenic: anyway, it would be good to know what exactly would unblock this since I'm not really sure what to do given the current text and the problems I keep running into with it and thus far you haven't really gotten concrete","msgtype":"m.text"},"ts":1549039450000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"Domenic: and despite this apparently being a priority for Google I don't see any issues about it, which is odd?","msgtype":"m.text"},"ts":1549039487000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"annevk: form-as-hyperlink reads well to me. I... *may* have done exactly that to get a POST-ing \"link\" before...","msgtype":"m.text"},"ts":1549055063000,"senderName":"TabAtkins","senderId":"TabAtkins@irc"},
{"content":{"body":"TabAtkins: 🎉","msgtype":"m.text"},"ts":1549056710000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"I’m somewhat surprised this analogy has not been made before","msgtype":"m.text"},"ts":1549056898000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"A <form action=GET><button /></> and an <a /> are basically identical semantically.","msgtype":"m.text"},"ts":1549058330000,"senderName":"TabAtkins","senderId":"TabAtkins@irc"}
]
[
{"content":{"body":"smaug____: hmm I think you might be onto something","msgtype":"m.text"},"ts":1582004485000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"We should store the slot value before setting the attribute to the empty string and then restore it","msgtype":"m.text"},"ts":1582004578000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"smaug____: I'd be happy to help review changes to HTML and/or CSP, and if we need to make changes to Chrome to accommodate, I'll try to find people to do so. Thank you for looking into this!","msgtype":"m.text"},"ts":1582013982000,"senderName":"mkwst","senderId":"mkwst@irc"},
{"content":{"body":"mkwst: I think if we add two steps to the second algorithm itâ€™s all good","msgtype":"m.text"},"ts":1582014131000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"For nonce, that is","msgtype":"m.text"},"ts":1582014148000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"annevk: \"restore\" it?","msgtype":"m.text"},"ts":1582021643000,"senderName":"smaug____","senderId":"smaug____@irc"},
{"content":{"body":"you mean after setting content attribute?","msgtype":"m.text"},"ts":1582021661000,"senderName":"smaug____","senderId":"smaug____@irc"},
{"content":{"body":"smaug____: yeah","msgtype":"m.text"},"ts":1582022000000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"smaug____: I'll write a quick PR to show what I mean","msgtype":"m.text"},"ts":1582022023000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"annevk: why the restore, if setting content attribute doesn't affect to the slot value","msgtype":"m.text"},"ts":1582022379000,"senderName":"smaug____","senderId":"smaug____@irc"},
{"content":{"body":"smaug____: setting the content attribute does affect the slot","msgtype":"m.text"},"ts":1582022442000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"smaug____: otherwise the slot wouldn't be set at all","msgtype":"m.text"},"ts":1582022457000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"well, unless the slot is set just before the setAttribute(nonce, emptystring)","msgtype":"m.text"},"ts":1582022498000,"senderName":"smaug____","senderId":"smaug____@irc"},
{"content":{"body":"maybe that isn't backwards compatible ?","msgtype":"m.text"},"ts":1582022695000,"senderName":"smaug____","senderId":"smaug____@irc"},
{"content":{"body":"so setting attr really needs to affect to the slot","msgtype":"m.text"},"ts":1582022706000,"senderName":"smaug____","senderId":"smaug____@irc"},
{"content":{"body":"smaug____: I'm not sure I understand your proposed setup","msgtype":"m.text"},"ts":1582022836000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"smaug____: it needs to be able to be set through a content attribute as that's how it comes from the parser","msgtype":"m.text"},"ts":1582022874000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"smaug____: https://github.com/whatwg/html/pull/5300 is my patch","msgtype":"m.text"},"ts":1582022884000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"annevk: only update slot when element is connected","msgtype":"m.text"},"ts":1582022906000,"senderName":"smaug____","senderId":"smaug____@irc"},
{"content":{"body":"that would work with parser, since it sets attributes first, then when connecting, we'd take the attr value and store it in a slot and set attr to empty string","msgtype":"m.text"},"ts":1582022956000,"senderName":"smaug____","senderId":"smaug____@irc"},
{"content":{"body":"smaug____: that's an interesting alternative model","msgtype":"m.text"},"ts":1582023086000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"smaug____: ugh","msgtype":"m.text"},"ts":1582023092000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"smaug____: okay let me do some git blame","msgtype":"m.text"},"ts":1582023164000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"or more like git log --grep","msgtype":"m.text"},"ts":1582023173000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"but I guess if one really wants to use setAttribute to change nonce, perhaps it should be possible. Or at least it has worked so far","msgtype":"m.text"},"ts":1582023187000,"senderName":"smaug____","senderId":"smaug____@irc"},
{"content":{"body":"smaug____: this was discussed at https://github.com/whatwg/html/pull/2373 too","msgtype":"m.text"},"ts":1582023577000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"smaug____: a problem with this alternative approach is that .nonce would be awkward (or return either the slot or content attribute or some such)","msgtype":"m.text"},"ts":1582023614000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"well, .nonce is awkward anyhow, since it doesn't map to content attribute","msgtype":"m.text"},"ts":1582023894000,"senderName":"smaug____","senderId":"smaug____@irc"},
{"content":{"body":"but I'm fine with the behavior what your patch gives","msgtype":"m.text"},"ts":1582023921000,"senderName":"smaug____","senderId":"smaug____@irc"},
{"content":{"body":"and thanks :)","msgtype":"m.text"},"ts":1582024400000,"senderName":"smaug____","senderId":"smaug____@irc"},
{"content":{"body":"makes reviewing a patch for Gecko easier.","msgtype":"m.text"},"ts":1582024421000,"senderName":"smaug____","senderId":"smaug____@irc"},
{"content":{"body":"annevk: still one question :) \"Whenever an element including HTMLOrSVGElement has its nonce attribute is set or changed, set this element's [[CryptographicNonce]] to the given value.\" What is supposed to happen when nonce attribute is removed?","msgtype":"m.text"},"ts":1582044916000,"senderName":"smaug____","senderId":"smaug____@irc"},
{"content":{"body":"based on the spec, the nonce slot isn't modified","msgtype":"m.text"},"ts":1582044934000,"senderName":"smaug____","senderId":"smaug____@irc"},
{"content":{"body":"that is somewhat surprising, but perhaps there is some reason for that","msgtype":"m.text"},"ts":1582044947000,"senderName":"smaug____","senderId":"smaug____@irc"},
{"content":{"body":"smaug____: i think that's to allow hiding it yourself","msgtype":"m.text"},"ts":1582045342000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"smaug____: maybe I should add another test for that though","msgtype":"m.text"},"ts":1582045351000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"aha","msgtype":"m.text"},"ts":1582045376000,"senderName":"smaug____","senderId":"smaug____@irc"},
{"content":{"body":"so if one wants to clear the value, setAttribute(\"nonce\", \"\") is needed","msgtype":"m.text"},"ts":1582045394000,"senderName":"smaug____","senderId":"smaug____@irc"},
{"content":{"body":"smaug____: I think the main idea would be to use the IDL attribute","msgtype":"m.text"},"ts":1582045412000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"well, idl + removeAttribute would work too","msgtype":"m.text"},"ts":1582045433000,"senderName":"smaug____","senderId":"smaug____@irc"},
{"content":{"body":"yeah, I guess if there's a good reason for further tweaks we could make them, but I feel like I already put more effort into this than I should ðŸ™‚","msgtype":"m.text"},"ts":1582045523000,"senderName":"annevk","senderId":"annevk@irc"},
{"content":{"body":"sorry :)","msgtype":"m.text"},"ts":1582045923000,"senderName":"smaug____","senderId":"smaug____@irc"},
{"content":{"body":"all of this behavior is just so super unusual","msgtype":"m.text"},"ts":1582045935000,"senderName":"smaug____","senderId":"smaug____@irc"}
]
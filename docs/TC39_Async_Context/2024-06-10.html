<!DOCTYPE html><html><head>
  <title>TC39 Async Context on 2024-06-10</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "TC39 Async Context";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">TC39 Async Context<br>2024-06-10<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2024-06-05" class="nav-link"><span>prev</span></a>
<span style="float:right">next</span>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">
<div class="rhs-header">
<span id="error" style="color: red; display:none">error</span>

<input type="text" id="query" size="25" placeholder="Search TC39 Async Context">
<a id="search-submit" class="button icon-link" title="Search">
  <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"></path></svg>
</a>
</div>

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Sun Jun 09 2024 22:09:14 GMT-0700 (Pacific Daylight Time)">05:09</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@littledan:matrix.org">littledan</span>&gt;</div></td><td class="msg-cell">Can we land this PR? <a href="https://github.com/tc39/proposal-async-context/pull/87#pullrequestreview-2106646155">https://github.com/tc39/proposal-async-context/pull/87#pullrequestreview-2106646155</a></td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Sun Jun 09 2024 22:33:56 GMT-0700 (Pacific Daylight Time)">05:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@abotella:igalia.com">Andreu Botella</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> Can we land this PR? <a href="https://github.com/tc39/proposal-async-context/pull/87#pullrequestreview-2106646155">https://github.com/tc39/proposal-async-context/pull/87#pullrequestreview-2106646155</a></blockquote></mx-reply>I don't know if we decided in the end to have the meetings in the public calendar</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Sun Jun 09 2024 22:34:10 GMT-0700 (Pacific Daylight Time)">05:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@abotella:igalia.com">Andreu Botella</span>&gt;</div></td><td class="msg-cell">if you go to the link in that PR, there are no AsyncContext meetings</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Sun Jun 09 2024 22:36:33 GMT-0700 (Pacific Daylight Time)">05:36</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@abotella:igalia.com">Andreu Botella</span>&gt;</div></td><td class="msg-cell">I guess I haven't considered enough the context of module evaluations</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Sun Jun 09 2024 22:37:21 GMT-0700 (Pacific Daylight Time)">05:37</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@abotella:igalia.com">Andreu Botella</span>&gt;</div></td><td class="msg-cell">I've mostly been looking at APIs in the web integration</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Mon Jun 10 2024 00:22:21 GMT-0700 (Pacific Daylight Time)">07:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@nicolo-ribaudo:matrix.org">nicolo-ribaudo</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> I guess I haven't considered enough the context of module evaluations</blockquote></mx-reply>Is there any option other than "the same as async functions"?</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Mon Jun 10 2024 01:01:57 GMT-0700 (Pacific Daylight Time)">08:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@abotella:igalia.com">Andreu Botella</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> Is there any option other than "the same as async functions"?</blockquote></mx-reply>I suspect not, but haven't looked at it enough</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Mon Jun 10 2024 01:06:45 GMT-0700 (Pacific Daylight Time)">08:06</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@stephenhicks:matrix.org">Steve Hicks</span>&gt;</div></td><td class="msg-cell">I've been researching past discussions and dug up this one (which Qard participated in many years ago): <a href="https://github.com/othiym23/node-continuation-local-storage/issues/64">https://github.com/othiym23/node-continuation-local-storage/issues/64</a>

Some interesting and relevant perspectives.</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Mon Jun 10 2024 02:20:57 GMT-0700 (Pacific Daylight Time)">09:20</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@littledan:matrix.org">littledan</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> if you go to the link in that PR, there are no AsyncContext meetings</blockquote></mx-reply>OK, let‚Äôs land a version of this patch that omits the meetings but includes the other parts</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Mon Jun 10 2024 02:21:17 GMT-0700 (Pacific Daylight Time)">09:21</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@littledan:matrix.org">littledan</span>&gt;</div></td><td class="msg-cell">I think we decided to tell people, there are regular meetings at these times, join the chat to get the zoom link</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Mon Jun 10 2024 02:21:35 GMT-0700 (Pacific Daylight Time)">09:21</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@littledan:matrix.org">littledan</span>&gt;</div></td><td class="msg-cell">So let‚Äôs make that be reflected in both the PR and calendar</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Mon Jun 10 2024 02:21:38 GMT-0700 (Pacific Daylight Time)">09:21</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-7" title="@legendecas:matrix.org">Chengzhong Wu</span>&gt;</div></td><td class="msg-cell">yeah, the calendar item was not added yet. I'll move that part out</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Mon Jun 10 2024 02:23:15 GMT-0700 (Pacific Daylight Time)">09:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@littledan:matrix.org">littledan</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> I guess I haven't considered enough the context of module evaluations</blockquote></mx-reply>You‚Äôre thinking about <a href="https://github.com/tc39/proposal-async-context/issues/93">https://github.com/tc39/proposal-async-context/issues/93</a> ?</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Mon Jun 10 2024 02:31:06 GMT-0700 (Pacific Daylight Time)">09:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@abotella:igalia.com">Andreu Botella</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> You‚Äôre thinking about <a href="https://github.com/tc39/proposal-async-context/issues/93">https://github.com/tc39/proposal-async-context/issues/93</a> ?</blockquote></mx-reply>yeah</td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Mon Jun 10 2024 02:33:13 GMT-0700 (Pacific Daylight Time)">09:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@littledan:matrix.org">littledan</span>&gt;</div></td><td class="msg-cell">What do you think of my suggestion there, that we make modules always run in an ‚Äúoriginal‚Äù (empty) context associated with the realm? (And this should apply for import defer as well)</td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Mon Jun 10 2024 10:14:42 GMT-0700 (Pacific Daylight Time)">17:14</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@stephenbelanger:matrix.org">Stephen Belanger</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> Yeah I don‚Äôt have a better solution. For flow advocates: how bad would it be if we called LexicalVariable ‚ÄúVariable‚Äù and did FlowVariable in a follow-on proposal?</blockquote></mx-reply>I'm fine with through flow being a follow-on, so long as what lands <em>first</em> is very clearly communicated as <em>not</em> providing that flow type. I feel the naming should more clearly communicate the flow type as <code>AsyncContext.Variable</code> alone does not communicate how it flows <em>at all</em>.</td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Mon Jun 10 2024 10:24:18 GMT-0700 (Pacific Daylight Time)">17:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@stephenbelanger:matrix.org">Stephen Belanger</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> Sure but there might not be JS on the stack when rejecting the promise, so at some point earlier you need to save off the context</blockquote></mx-reply>In flow-through semantics you're modelling causality, so you'd just trace back through directly <em>causal</em> code until you reach JS again. In many cases this may just be the construction of an object which emits events or something like that. If you think of it as tracing <em>all</em> execution and not just <em>JS</em> execution then you can always trace a path back through the code to what logically caused it. That could even be something initiated <em>before</em> any JS ran, which would just be a root context.</td></tr>
  <tr class="msg" id="L17"><td class="ts-cell"><a class="ts" href="#L17" alt="Mon Jun 10 2024 10:39:44 GMT-0700 (Pacific Daylight Time)">17:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@stephenbelanger:matrix.org">Stephen Belanger</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> What do you think of my suggestion there, that we make modules always run in an ‚Äúoriginal‚Äù (empty) context associated with the realm? (And this should apply for import defer as well)</blockquote></mx-reply>I find it easiest to think of everything as descending from a root context like that, even if it's empty. OTel does the same thing too with <code>ROOT_CONTEXT</code> being an empty map.</td></tr>
  <tr class="msg" id="L18"><td class="ts-cell"><a class="ts" href="#L18" alt="Mon Jun 10 2024 11:03:59 GMT-0700 (Pacific Daylight Time)">18:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@abotella:igalia.com">Andreu Botella</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> I'm fine with through flow being a follow-on, so long as what lands <em>first</em> is very clearly communicated as <em>not</em> providing that flow type. I feel the naming should more clearly communicate the flow type as <code>AsyncContext.Variable</code> alone does not communicate how it flows <em>at all</em>.</blockquote></mx-reply>I worry that there might be developers that might want <em>any</em> kind of async propagation for their own use cases, and might not understand or care much about the difference between flow-through and flow-around</td></tr>
  <tr class="msg" id="L19"><td class="ts-cell"><a class="ts" href="#L19" alt="Mon Jun 10 2024 11:04:25 GMT-0700 (Pacific Daylight Time)">18:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@abotella:igalia.com">Andreu Botella</span>&gt;</div></td><td class="msg-cell">not sure how realistic that situation is though</td></tr>
  <tr class="msg" id="L20"><td class="ts-cell"><a class="ts" href="#L20" alt="Mon Jun 10 2024 11:05:08 GMT-0700 (Pacific Daylight Time)">18:05</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@abotella:igalia.com">Andreu Botella</span>&gt;</div></td><td class="msg-cell">(and I might be taking worries from the other project I'm working on and applying them to AsyncContext when they don't really apply)</td></tr>
  <tr class="msg" id="L21"><td class="ts-cell"><a class="ts" href="#L21" alt="Mon Jun 10 2024 11:23:23 GMT-0700 (Pacific Daylight Time)">18:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@stephenbelanger:matrix.org">Stephen Belanger</span>&gt;</div></td><td class="msg-cell">I think people generally will have a particular flow in mind for their use case. Likely lacking <em>nuance</em> in the details, but they'll have a general flow in mind, I would think.</td></tr>
  <tr class="msg" id="L22"><td class="ts-cell"><a class="ts" href="#L22" alt="Mon Jun 10 2024 11:24:27 GMT-0700 (Pacific Daylight Time)">18:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@stephenbelanger:matrix.org">Stephen Belanger</span>&gt;</div></td><td class="msg-cell">I <em>do</em> expect people might make mistakes between the two at first due to lack of understanding though.</td></tr>
  <tr class="msg" id="L23"><td class="ts-cell"><a class="ts" href="#L23" alt="Mon Jun 10 2024 11:25:27 GMT-0700 (Pacific Daylight Time)">18:25</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@stephenbelanger:matrix.org">Stephen Belanger</span>&gt;</div></td><td class="msg-cell">The call-only flow <em>does</em> seem like a reasonable starting point though, given the simpler scoping of only flowing <em>into</em> calls and not <em>back out</em>.</td></tr>
  <tr class="msg" id="L24"><td class="ts-cell"><a class="ts" href="#L24" alt="Mon Jun 10 2024 11:26:35 GMT-0700 (Pacific Daylight Time)">18:26</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@stephenbelanger:matrix.org">Stephen Belanger</span>&gt;</div></td><td class="msg-cell">I'm just not sure exactly how to <em>describe</em> that succinctly to users. As always, one of the hardest problems in CS is <em>naming things</em>. üòÖ</td></tr>
  <tr class="msg" id="L25"><td class="ts-cell"><a class="ts" href="#L25" alt="Mon Jun 10 2024 13:44:21 GMT-0700 (Pacific Daylight Time)">20:44</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@stephenhicks:matrix.org">Steve Hicks</span>&gt;</div></td><td class="msg-cell">Just thinking out loud here - it feels a little bit like the difference between <code>const</code> and <code>var</code> w.r.t. for loops.  We all remember the bad old days when you'd write <code>for (var key in obj) { tasks.push(function() { console.log(key); }); }</code> and get ten copies of the same key since they all closed over the same reference.  So that would be the flow-through case (not making the analogy to be pejorative), while the lexical/block-scoped version is flow-around.</td></tr>
  <tr class="msg" id="L26"><td class="ts-cell"><a class="ts" href="#L26" alt="Mon Jun 10 2024 13:44:47 GMT-0700 (Pacific Daylight Time)">20:44</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@stephenhicks:matrix.org">Steve Hicks</span>&gt;</div></td><td class="msg-cell">Does that help at all with naming?  Maybe not.</td></tr>
  <tr class="msg" id="L27"><td class="ts-cell"><a class="ts" href="#L27" alt="Mon Jun 10 2024 13:50:58 GMT-0700 (Pacific Daylight Time)">20:50</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@stephenhicks:matrix.org">Steve Hicks</span>&gt;</div></td><td class="msg-cell">Thinking about people making mistakes or not knowing how to reason about it, or which to pick - I generally expect this to be more of an advanced user feature.  I know Shu and others were concerned about the possibility of detrimental performance due to propagating way too many variables.  This may not be as "here be dragons" as, say, FinalizationRegistry, but a <em>caveat emptor</em> may still be in order for anyone considering introducing a new variable.  I think a bigger concern is cargo-culting snapshot/wrap calls everywhere, and given that even we don't know what the right context is, it seems highly unlikely ordinary users will be able to make heads or tails of it.</td></tr>
  <tr class="msg" id="L28"><td class="ts-cell"><a class="ts" href="#L28" alt="Mon Jun 10 2024 14:03:07 GMT-0700 (Pacific Daylight Time)">21:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@littledan:matrix.org">littledan</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> In flow-through semantics you're modelling causality, so you'd just trace back through directly <em>causal</em> code until you reach JS again. In many cases this may just be the construction of an object which emits events or something like that. If you think of it as tracing <em>all</em> execution and not just <em>JS</em> execution then you can always trace a path back through the code to what logically caused it. That could even be something initiated <em>before</em> any JS ran, which would just be a root context.</blockquote></mx-reply>I get that this is the intuition, but an actual implementation would have to save and propagate the snapshot forward from the last time JS runs, right?</td></tr>
  <tr class="msg" id="L29"><td class="ts-cell"><a class="ts" href="#L29" alt="Mon Jun 10 2024 14:03:53 GMT-0700 (Pacific Daylight Time)">21:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@littledan:matrix.org">littledan</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> I find it easiest to think of everything as descending from a root context like that, even if it's empty. OTel does the same thing too with <code>ROOT_CONTEXT</code> being an empty map.</blockquote></mx-reply>Sounds like we‚Äôre agreeing? (Except I would say that the browser could put stuff in the root context, and different realms could have different root contexts)</td></tr>
  <tr class="msg" id="L30"><td class="ts-cell"><a class="ts" href="#L30" alt="Mon Jun 10 2024 14:07:48 GMT-0700 (Pacific Daylight Time)">21:07</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@stephenbelanger:matrix.org">Stephen Belanger</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> Thinking about people making mistakes or not knowing how to reason about it, or which to pick - I generally expect this to be more of an advanced user feature.  I know Shu and others were concerned about the possibility of detrimental performance due to propagating way too many variables.  This may not be as "here be dragons" as, say, FinalizationRegistry, but a <em>caveat emptor</em> may still be in order for anyone considering introducing a new variable.  I think a bigger concern is cargo-culting snapshot/wrap calls everywhere, and given that even we don't know what the right context is, it seems highly unlikely ordinary users will be able to make heads or tails of it.</blockquote></mx-reply>Propagating too many variables? It propagates exactly as many as flow-around does. It just flows in a different way. ü§∑</td></tr>
  <tr class="msg" id="L31"><td class="ts-cell"><a class="ts" href="#L31" alt="Mon Jun 10 2024 14:08:27 GMT-0700 (Pacific Daylight Time)">21:08</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@stephenbelanger:matrix.org">Stephen Belanger</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> I get that this is the intuition, but an actual implementation would have to save and propagate the snapshot forward from the last time JS runs, right?</blockquote></mx-reply>Yes. You follow the causality back to the last point JS was running and capture <em>there</em>.</td></tr>
  <tr class="msg" id="L32"><td class="ts-cell"><a class="ts" href="#L32" alt="Mon Jun 10 2024 14:08:45 GMT-0700 (Pacific Daylight Time)">21:08</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@stephenhicks:matrix.org">Steve Hicks</span>&gt;</div></td><td class="msg-cell">Sorry, I meant Shu's concern with AsyncContext at all, not with a specific flow type</td></tr>
  <tr class="msg" id="L33"><td class="ts-cell"><a class="ts" href="#L33" alt="Mon Jun 10 2024 14:10:00 GMT-0700 (Pacific Daylight Time)">21:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@stephenbelanger:matrix.org">Stephen Belanger</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> Sounds like we‚Äôre agreeing? (Except I would say that the browser could put stuff in the root context, and different realms could have different root contexts)</blockquote></mx-reply>Yes, generally agreeing. Though I don't feel I'm familiar enough with the intricacies of realms to say if each should get its <em>own</em> context or if it should be considered an <em>additional</em> empty node which <em>descends</em> from the root which initiated the realm?</td></tr>
  <tr class="msg" id="L34"><td class="ts-cell"><a class="ts" href="#L34" alt="Mon Jun 10 2024 14:10:57 GMT-0700 (Pacific Daylight Time)">21:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@stephenbelanger:matrix.org">Stephen Belanger</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> Sorry, I meant Shu's concern with AsyncContext at all, not with a specific flow type</blockquote></mx-reply>Ah, yeah, that's why a few userland implementations had gone for the Context Frame idea so you only need to propagate a single frame which contains a bunch of variable states within.</td></tr>
  <tr class="msg" id="L35"><td class="ts-cell"><a class="ts" href="#L35" alt="Mon Jun 10 2024 14:11:12 GMT-0700 (Pacific Daylight Time)">21:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@stephenbelanger:matrix.org">Stephen Belanger</span>&gt;</div></td><td class="msg-cell">With that it's just a pointer copy.</td></tr>
  <tr class="msg" id="L36"><td class="ts-cell"><a class="ts" href="#L36" alt="Mon Jun 10 2024 14:11:39 GMT-0700 (Pacific Daylight Time)">21:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@stephenbelanger:matrix.org">Stephen Belanger</span>&gt;</div></td><td class="msg-cell">Which, from what I understand, is roughly what AsyncContext is doing too.</td></tr>
  <tr class="msg" id="L37"><td class="ts-cell"><a class="ts" href="#L37" alt="Mon Jun 10 2024 15:59:28 GMT-0700 (Pacific Daylight Time)">22:59</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@stephenhicks:matrix.org">Steve Hicks</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> Which, from what I understand, is roughly what AsyncContext is doing too.</blockquote></mx-reply>Right, I think that's one of the major concerns with anything more involved.  In theory, it would be great if we could define complex merge strategies to get exactly the correct value all the time, but in practice the budget we're working with is very small and if it costs more than a simple pointer copy (regardless of the number of vars) then the budget's already gone.</td></tr>
  <tr class="msg" id="L38"><td class="ts-cell"><a class="ts" href="#L38" alt="Mon Jun 10 2024 16:07:23 GMT-0700 (Pacific Daylight Time)">23:07</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@stephenbelanger:matrix.org">Stephen Belanger</span>&gt;</div></td><td class="msg-cell">Well, through flow only needs a pointer copy too. It's when you want to mix flows where it gets more expensive. That having been said though, I don't really agree with the assertion that it <em>always</em> needs to be that absolute minimum cost as if the flow that produces doesn't match the user need then it's just pushing the cost out to the edges where it typically is <em>even more</em> expensive.</td></tr>
  <tr class="msg" id="L39"><td class="ts-cell"><a class="ts" href="#L39" alt="Mon Jun 10 2024 16:09:00 GMT-0700 (Pacific Daylight Time)">23:09</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@stephenbelanger:matrix.org">Stephen Belanger</span>&gt;</div></td><td class="msg-cell">Literally <em>every</em> Fortune 500 company is doing context management with Node.js at the <em>least</em> via an installed APM product. Optimizing for the cost of those expected flows will <em>significantly</em> reduce cloud costs across the industry.</td></tr>

</tbody></table></div></div></div>
</body></html>
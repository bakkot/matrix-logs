<!DOCTYPE html><html><head>
  <title>TC39 Async Context on 2024-05-30</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "TC39 Async Context";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">TC39 Async Context<br>2024-05-30<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2024-05-29" class="nav-link"><span>prev</span></a>
<span style="float:right">next</span>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">
<div class="rhs-header">
<span id="error" style="color: red; display:none">error</span>

<input type="text" id="query" size="25" placeholder="Search TC39 Async Context">
<a id="search-submit" class="button icon-link" title="Search">
  <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"></path></svg>
</a>
</div>

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Wed May 29 2024 21:31:57 GMT-0700 (Pacific Daylight Time)">04:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@littledan:matrix.org">littledan</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> I think that's tricky due to races - for example, the exact ordering of a promise resolving vs. the promise.then call would make one or the other context more recent.  But I think we probably want to run in the same context (resolution vs registration) regardless of the order.</blockquote></mx-reply>Huh, what do you mean? I wasn’t imagining this kind of case, I was imagining that a particular cause would lead to a particular snapshot context being restored. Could you give an example of the race you are concerned about?</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Thu May 30 2024 09:35:45 GMT-0700 (Pacific Daylight Time)">16:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@stephenhicks:matrix.org">Steve Hicks</span>&gt;</div></td><td class="msg-cell"><p>it's a little pedantic, but if you have something like</p>
<pre><code>const p = v.run(1, () =&gt; Promise.resolve());
await p;
// p is now fully resolved
v.run(2, p.then(() =&gt; console.log(v.get())));
</code></pre>
<p>Then "the most specific (i.e. causally recent) relevant context" would presumably be the 2, since the callback was registered after the promise resolved.  Without the <code>await</code>, it would be 1.</p>
</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Thu May 30 2024 09:42:13 GMT-0700 (Pacific Daylight Time)">16:42</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-7" title="@legendecas:matrix.org">Chengzhong Wu</span>&gt;</div></td><td class="msg-cell">this smells like zalgo -- it depends on how the handlers are called</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Thu May 30 2024 10:49:44 GMT-0700 (Pacific Daylight Time)">17:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-1" title="@jridgewell:matrix.org">Justin Ridgewell</span>&gt;</div></td><td class="msg-cell"><a href="https://matrix.to/#/%40stephenbelanger%3Amatrix.org">@Stephen Belanger</a> pointed out that if we were to have an flows-through <code data-md="`">ExecutionVariable</code> and implement scoped <code data-md="`">using</code> mutations, we’d have a problem with propogating the execution state through the resolve<br><pre data-md="```"><code class="language-js">async function foo() {
  using _ = v.scope(1);
  return 2;
}
</code></pre></td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Thu May 30 2024 10:50:26 GMT-0700 (Pacific Daylight Time)">17:50</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-1" title="@jridgewell:matrix.org">Justin Ridgewell</span>&gt;</div></td><td class="msg-cell">Because the scoped mutation is disposed in the <code data-md="`">FunctionStatementList</code> evaluation of the function, and the outer promise is resolved in the <code data-md="`">AsyncFunctionBody</code> execution <i data-md="_">after</i> <code data-md="`">StatementList</code> is evaluated</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Thu May 30 2024 10:51:51 GMT-0700 (Pacific Daylight Time)">17:51</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-1" title="@jridgewell:matrix.org">Justin Ridgewell</span>&gt;</div></td><td class="msg-cell">Then there’s weird interactions with how you’re supposed to resolve the promise, and what if the disposals caused an exeception</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Thu May 30 2024 10:52:11 GMT-0700 (Pacific Daylight Time)">17:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@stephenhicks:matrix.org">Steve Hicks</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> this smells like zalgo -- it depends on how the handlers are called</blockquote></mx-reply>Right, that's why I'm saying that "using the most specific (i.e. causally recent) relevant context" is probably a bad specification.</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Thu May 30 2024 10:55:03 GMT-0700 (Pacific Daylight Time)">17:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@stephenhicks:matrix.org">Steve Hicks</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> Because the scoped mutation is disposed in the <code data-md="`">FunctionStatementList</code> evaluation of the function, and the outer promise is resolved in the <code data-md="`">AsyncFunctionBody</code> execution <i data-md="_">after</i> <code data-md="`">StatementList</code> is evaluated</blockquote></mx-reply>I asked Tuesday whether scoping mutations would somehow prevent escaping the value and he suggested that there's still ways to extract the data.  But I never got a good sense of what those ways were.</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Thu May 30 2024 10:57:51 GMT-0700 (Pacific Daylight Time)">17:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-1" title="@jridgewell:matrix.org">Justin Ridgewell</span>&gt;</div></td><td class="msg-cell">We’d have to redefine the <code data-md="`">using</code> methods to perform <code data-md="`">DisposeResources</code> in each of the <code data-md="`">*FunctionBody</code> node types</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Thu May 30 2024 10:58:05 GMT-0700 (Pacific Daylight Time)">17:58</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-1" title="@jridgewell:matrix.org">Justin Ridgewell</span>&gt;</div></td><td class="msg-cell">Instead of using the <code data-md="`">FunctionStatementList</code> node</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Thu May 30 2024 10:58:20 GMT-0700 (Pacific Daylight Time)">17:58</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-1" title="@jridgewell:matrix.org">Justin Ridgewell</span>&gt;</div></td><td class="msg-cell">That way we’d dispose the variables after resolving</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Thu May 30 2024 11:30:40 GMT-0700 (Pacific Daylight Time)">18:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@stephenbelanger:matrix.org">Stephen Belanger</span>&gt;</div></td><td class="msg-cell">But <code>using</code> needs to work with block scopes too, right? So it'd need to be conditional on if the block <em>is</em> the function body or if it is nested.</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Thu May 30 2024 11:31:07 GMT-0700 (Pacific Daylight Time)">18:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@stephenbelanger:matrix.org">Stephen Belanger</span>&gt;</div></td><td class="msg-cell">It'd add a bit of complexity.</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Thu May 30 2024 11:31:35 GMT-0700 (Pacific Daylight Time)">18:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@stephenbelanger:matrix.org">Stephen Belanger</span>&gt;</div></td><td class="msg-cell">This is <em>why</em> other languages like .NET went for just doing set/get and persisting until the context would <em>change</em>.</td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Thu May 30 2024 11:32:19 GMT-0700 (Pacific Daylight Time)">18:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@littledan:matrix.org">littledan</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> <p>it's a little pedantic, but if you have something like</p>
<pre><code>const p = v.run(1, () =&gt; Promise.resolve());
await p;
// p is now fully resolved
v.run(2, p.then(() =&gt; console.log(v.get())));
</code></pre>
<p>Then "the most specific (i.e. causally recent) relevant context" would presumably be the 2, since the callback was registered after the promise resolved.  Without the <code>await</code>, it would be 1.</p>
</blockquote></mx-reply>yeah I have been assuming that .then would always use the registration context, and that we were only talking about web APIs.</td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Thu May 30 2024 11:32:31 GMT-0700 (Pacific Daylight Time)">18:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@littledan:matrix.org">littledan</span>&gt;</div></td><td class="msg-cell">(so there is no await vs .then mismatch)</td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Thu May 30 2024 11:34:28 GMT-0700 (Pacific Daylight Time)">18:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@stephenbelanger:matrix.org">Stephen Belanger</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> <p>it's a little pedantic, but if you have something like</p>
<pre><code>const p = v.run(1, () =&gt; Promise.resolve());
await p;
// p is now fully resolved
v.run(2, p.then(() =&gt; console.log(v.get())));
</code></pre>
<p>Then "the most specific (i.e. causally recent) relevant context" would presumably be the 2, since the callback was registered after the promise resolved.  Without the <code>await</code>, it would be 1.</p>
</blockquote></mx-reply>In flow-through model that should <em>always</em> be 1, as that is what was set when the <em>resolve</em> happened. We don't much <em>care</em> about where a continuation is attached.</td></tr>
  <tr class="msg" id="L17"><td class="ts-cell"><a class="ts" href="#L17" alt="Thu May 30 2024 11:34:45 GMT-0700 (Pacific Daylight Time)">18:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@stephenhicks:matrix.org">Steve Hicks</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> This is <em>why</em> other languages like .NET went for just doing set/get and persisting until the context would <em>change</em>.</blockquote></mx-reply>Is there some nuance here between persisting until the context would change vs. persisting until the end of a scope?  Does the former somehow allow escaping a changed value <em>out</em> of a scope where the latter doesn't?  I'm still trying to wrap my mind around how you can actually observe a changed value in a child scope if the change gets reverted before you resume.</td></tr>
  <tr class="msg" id="L18"><td class="ts-cell"><a class="ts" href="#L18" alt="Thu May 30 2024 11:35:44 GMT-0700 (Pacific Daylight Time)">18:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@littledan:matrix.org">littledan</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> Is there some nuance here between persisting until the context would change vs. persisting until the end of a scope?  Does the former somehow allow escaping a changed value <em>out</em> of a scope where the latter doesn't?  I'm still trying to wrap my mind around how you can actually observe a changed value in a child scope if the change gets reverted before you resume.</blockquote></mx-reply>I think this comes up with block scopes <em>within</em> a function, where you'd restore the previous value in the latter case and not the former</td></tr>
  <tr class="msg" id="L19"><td class="ts-cell"><a class="ts" href="#L19" alt="Thu May 30 2024 11:35:52 GMT-0700 (Pacific Daylight Time)">18:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@littledan:matrix.org">littledan</span>&gt;</div></td><td class="msg-cell">so this is the difference between using and .set</td></tr>
  <tr class="msg" id="L20"><td class="ts-cell"><a class="ts" href="#L20" alt="Thu May 30 2024 11:35:54 GMT-0700 (Pacific Daylight Time)">18:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@stephenhicks:matrix.org">Steve Hicks</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> In flow-through model that should <em>always</em> be 1, as that is what was set when the <em>resolve</em> happened. We don't much <em>care</em> about where a continuation is attached.</blockquote></mx-reply>Right, but I'm imagining a world where <code>await</code> is flow-around, but <code>then</code> restores the resolution context, since that would still allow accessing all the flow-through causes as needed.</td></tr>
  <tr class="msg" id="L21"><td class="ts-cell"><a class="ts" href="#L21" alt="Thu May 30 2024 11:36:08 GMT-0700 (Pacific Daylight Time)">18:36</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@stephenbelanger:matrix.org">Stephen Belanger</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> Is there some nuance here between persisting until the context would change vs. persisting until the end of a scope?  Does the former somehow allow escaping a changed value <em>out</em> of a scope where the latter doesn't?  I'm still trying to wrap my mind around how you can actually observe a changed value in a child scope if the change gets reverted before you resume.</blockquote></mx-reply>In flow-through model you capture <em>both</em> at call <em>and</em> at return. So when an async function or a promise resolves you capture and when the continuation of that begins you restore.</td></tr>
  <tr class="msg" id="L22"><td class="ts-cell"><a class="ts" href="#L22" alt="Thu May 30 2024 11:37:12 GMT-0700 (Pacific Daylight Time)">18:37</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@stephenbelanger:matrix.org">Stephen Belanger</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> Right, but I'm imagining a world where <code>await</code> is flow-around, but <code>then</code> restores the resolution context, since that would still allow accessing all the flow-through causes as needed.</blockquote></mx-reply>Yes, restoring the orphaned branch is what I was thinking <code>callingContext</code> would be helpful for there.</td></tr>
  <tr class="msg" id="L23"><td class="ts-cell"><a class="ts" href="#L23" alt="Thu May 30 2024 11:37:16 GMT-0700 (Pacific Daylight Time)">18:37</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@stephenbelanger:matrix.org">Stephen Belanger</span>&gt;</div></td><td class="msg-cell">It's a bit awkward though.</td></tr>
  <tr class="msg" id="L24"><td class="ts-cell"><a class="ts" href="#L24" alt="Thu May 30 2024 11:37:37 GMT-0700 (Pacific Daylight Time)">18:37</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@stephenbelanger:matrix.org">Stephen Belanger</span>&gt;</div></td><td class="msg-cell">And probably would have terrible performance for APMs which would need to be doing that basically <em>always</em>.</td></tr>
  <tr class="msg" id="L25"><td class="ts-cell"><a class="ts" href="#L25" alt="Thu May 30 2024 11:39:56 GMT-0700 (Pacific Daylight Time)">18:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@stephenhicks:matrix.org">Steve Hicks</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> And probably would have terrible performance for APMs which would need to be doing that basically <em>always</em>.</blockquote></mx-reply>Yes, I expected the performance to be bad, but I was wondering if we could spec out the semantics such that it's all self-consistent, and then potentially provide a builtin alternative that exposes that common operation (which can now be emulated inefficiently) in a more efficient way.</td></tr>
  <tr class="msg" id="L26"><td class="ts-cell"><a class="ts" href="#L26" alt="Thu May 30 2024 11:40:41 GMT-0700 (Pacific Daylight Time)">18:40</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@stephenhicks:matrix.org">Steve Hicks</span>&gt;</div></td><td class="msg-cell">Not sure if that made any sense... basically, you could explain the semantics of <code>callingContext</code> as if were a userland implementation, but it could be implemented internally in a more efficient way.</td></tr>
  <tr class="msg" id="L27"><td class="ts-cell"><a class="ts" href="#L27" alt="Thu May 30 2024 11:42:17 GMT-0700 (Pacific Daylight Time)">18:42</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@stephenbelanger:matrix.org">Stephen Belanger</span>&gt;</div></td><td class="msg-cell">If we have to actually do that explicitly on every await though it doesn't matter how much we optimize it, it will <em>always</em> have significant overhead. We need a type that has the appropriate flow by default or we're basically <em>doubling</em> all the context state modifications.</td></tr>
  <tr class="msg" id="L28"><td class="ts-cell"><a class="ts" href="#L28" alt="Thu May 30 2024 11:43:21 GMT-0700 (Pacific Daylight Time)">18:43</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@stephenbelanger:matrix.org">Stephen Belanger</span>&gt;</div></td><td class="msg-cell">This is why I was suggesting either having a separate type for the different flow, or having a per-store configuration to pick the different flow.</td></tr>
  <tr class="msg" id="L29"><td class="ts-cell"><a class="ts" href="#L29" alt="Thu May 30 2024 11:45:58 GMT-0700 (Pacific Daylight Time)">18:45</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@stephenbelanger:matrix.org">Stephen Belanger</span>&gt;</div></td><td class="msg-cell">Requiring that users manually manage snapshots all over the place is going to get expensive fast. This is why I had <em>previously</em> suggested flow-through by default and then a per-store config to <em>additionally</em> snapshot around awaits as the functionality for <em>that</em> binding layer is quite discrete and could be handled fairly performantly by just keeping a separate list of variables which want to snapshot there.</td></tr>
  <tr class="msg" id="L30"><td class="ts-cell"><a class="ts" href="#L30" alt="Thu May 30 2024 11:47:20 GMT-0700 (Pacific Daylight Time)">18:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@stephenbelanger:matrix.org">Stephen Belanger</span>&gt;</div></td><td class="msg-cell">But it seems some are of the opinion that flow-around should be the default, even though it's the more costly option to escape from.</td></tr>
  <tr class="msg" id="L31"><td class="ts-cell"><a class="ts" href="#L31" alt="Thu May 30 2024 11:53:01 GMT-0700 (Pacific Daylight Time)">18:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@stephenhicks:matrix.org">Steve Hicks</span>&gt;</div></td><td class="msg-cell">I think it's a sticky situation.  The default is less relevant - even if flow-around is the user-facing default, I don't see why it couldn't be implemented internally as the option that adds additional processing on top of the flow-through codepath.  What's not clear to me is whether flow-through is viable <em>at all</em>, even as an option.  My understanding is that SES would block it outright, so even if we want it we can't really have it.</td></tr>
  <tr class="msg" id="L32"><td class="ts-cell"><a class="ts" href="#L32" alt="Thu May 30 2024 11:53:54 GMT-0700 (Pacific Daylight Time)">18:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@littledan:matrix.org">littledan</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> yeah I have been assuming that .then would always use the registration context, and that we were only talking about web APIs.</blockquote></mx-reply><span class="nick-2">Steve Hicks</span>: Thoughts on this?</td></tr>
  <tr class="msg" id="L33"><td class="ts-cell"><a class="ts" href="#L33" alt="Thu May 30 2024 11:58:01 GMT-0700 (Pacific Daylight Time)">18:58</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@stephenhicks:matrix.org">Steve Hicks</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> <span class="nick-2">Steve Hicks</span>: Thoughts on this?</blockquote></mx-reply>Assuming we have flow-around for <code>await</code>, there will always be fundamental disagreement between the context propagation of callbacks and async-await.  Promises has to choose one or the other.  Registration aligns it with async-await, resolution aligns it with callbacks.  It's not clear to me that one is fundamentally better than the other, but the latter opens up a possibility to access semantics that are impossible with the former.</td></tr>
  <tr class="msg" id="L34"><td class="ts-cell"><a class="ts" href="#L34" alt="Thu May 30 2024 12:01:09 GMT-0700 (Pacific Daylight Time)">19:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@stephenbelanger:matrix.org">Stephen Belanger</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> I think it's a sticky situation.  The default is less relevant - even if flow-around is the user-facing default, I don't see why it couldn't be implemented internally as the option that adds additional processing on top of the flow-through codepath.  What's not clear to me is whether flow-through is viable <em>at all</em>, even as an option.  My understanding is that SES would block it outright, so even if we want it we can't really have it.</blockquote></mx-reply>I don't see <em>why</em> it'd get blocked. It has the same trait that accessing the value is impossible without having access to the variable store to begin with, so any argument about it influencing other code is no more valid with flow-through than it is with event emitters.</td></tr>
  <tr class="msg" id="L35"><td class="ts-cell"><a class="ts" href="#L35" alt="Thu May 30 2024 12:01:16 GMT-0700 (Pacific Daylight Time)">19:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@stephenhicks:matrix.org">Steve Hicks</span>&gt;</div></td><td class="msg-cell">(of course, maybe that already makes it problematic for SES anyway)</td></tr>
  <tr class="msg" id="L36"><td class="ts-cell"><a class="ts" href="#L36" alt="Thu May 30 2024 12:02:01 GMT-0700 (Pacific Daylight Time)">19:02</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@stephenhicks:matrix.org">Steve Hicks</span>&gt;</div></td><td class="msg-cell">I wasn't part of those earlier conversations, so I don't really understand the reasoning here</td></tr>
  <tr class="msg" id="L37"><td class="ts-cell"><a class="ts" href="#L37" alt="Thu May 30 2024 12:02:54 GMT-0700 (Pacific Daylight Time)">19:02</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@stephenhicks:matrix.org">Steve Hicks</span>&gt;</div></td><td class="msg-cell">They've got some super-theoretical framework where they transformed SyncContext to AsyncContext and transposed the ownership and reasoned that nothing dangerous happened at any step...</td></tr>
  <tr class="msg" id="L38"><td class="ts-cell"><a class="ts" href="#L38" alt="Thu May 30 2024 12:04:33 GMT-0700 (Pacific Daylight Time)">19:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@stephenhicks:matrix.org">Steve Hicks</span>&gt;</div></td><td class="msg-cell">But IIUC the concern was less about passing a value directly and more about causing an observable side effect in a variable (by controlling the <em>global</em> snapshotting) without actually having access to that variable.</td></tr>
  <tr class="msg" id="L39"><td class="ts-cell"><a class="ts" href="#L39" alt="Thu May 30 2024 12:51:51 GMT-0700 (Pacific Daylight Time)">19:51</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@littledan:matrix.org">littledan</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> Assuming we have flow-around for <code>await</code>, there will always be fundamental disagreement between the context propagation of callbacks and async-await.  Promises has to choose one or the other.  Registration aligns it with async-await, resolution aligns it with callbacks.  It's not clear to me that one is fundamentally better than the other, but the latter opens up a possibility to access semantics that are impossible with the former.</blockquote></mx-reply>yes, well, within the registration world, what do you think about the web platform giving some event handlers a "more specific" context? I don't think that's racy, it would just depend on the cause of the event being triggered.</td></tr>
  <tr class="msg" id="L40"><td class="ts-cell"><a class="ts" href="#L40" alt="Thu May 30 2024 12:53:25 GMT-0700 (Pacific Daylight Time)">19:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@littledan:matrix.org">littledan</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> But IIUC the concern was less about passing a value directly and more about causing an observable side effect in a variable (by controlling the <em>global</em> snapshotting) without actually having access to that variable.</blockquote></mx-reply>that was one concern, but I think we're good about variables being a necessary thing to have access to either way, even if we go with flow-through. I think they were also concerned about, <em>once you already have a variable</em>, for dataflow to be "well-behaved" (whatever that means--it's a vibe)</td></tr>
  <tr class="msg" id="L41"><td class="ts-cell"><a class="ts" href="#L41" alt="Thu May 30 2024 12:53:53 GMT-0700 (Pacific Daylight Time)">19:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@littledan:matrix.org">littledan</span>&gt;</div></td><td class="msg-cell">aesthetically, I do like keeping things well-behaved, all else being equal!</td></tr>
  <tr class="msg" id="L42"><td class="ts-cell"><a class="ts" href="#L42" alt="Thu May 30 2024 13:45:31 GMT-0700 (Pacific Daylight Time)">20:45</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@stephenbelanger:matrix.org">Stephen Belanger</span>&gt;</div></td><td class="msg-cell">Being "well-behaved" is deeply dependant on what behaviour is <em>expected</em>. And as I expressed with my examples about confusion in regard to differences between callback and promise flows, flow-through semantic seem to be <em>more</em> well-behaved in this regard that if flow-through is what you <em>expect</em> then there is rarely, if ever, a need to patch things with snapshotting.</td></tr>
  <tr class="msg" id="L43"><td class="ts-cell"><a class="ts" href="#L43" alt="Thu May 30 2024 13:46:59 GMT-0700 (Pacific Daylight Time)">20:46</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@stephenbelanger:matrix.org">Stephen Belanger</span>&gt;</div></td><td class="msg-cell">Once you start trying to carve out sub-graphs it becomes a matter of opinion which sub-graphs are correct.</td></tr>
  <tr class="msg" id="L44"><td class="ts-cell"><a class="ts" href="#L44" alt="Thu May 30 2024 13:49:19 GMT-0700 (Pacific Daylight Time)">20:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@littledan:matrix.org">littledan</span>&gt;</div></td><td class="msg-cell">things "nesting" and "not accidentally escaping" feels well-behaved to someone without background in the domain. We'll need to be able to explain the argument for the other semantics in a clear way to get through to them.</td></tr>
  <tr class="msg" id="L45"><td class="ts-cell"><a class="ts" href="#L45" alt="Thu May 30 2024 13:49:23 GMT-0700 (Pacific Daylight Time)">20:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@stephenbelanger:matrix.org">Stephen Belanger</span>&gt;</div></td><td class="msg-cell">I expressed this in the doc and slides I shared previously, but to repeat that: there are many layers of execution rearrangement occurring in JS. The base level of the microtask scheduler is fairly <em>obvious</em> to bind around, but as you raise further and further out into layers closer to user code it becomes less and less obvious what the "correct" path is when flowing around.</td></tr>
  <tr class="msg" id="L46"><td class="ts-cell"><a class="ts" href="#L46" alt="Thu May 30 2024 13:49:38 GMT-0700 (Pacific Daylight Time)">20:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@littledan:matrix.org">littledan</span>&gt;</div></td><td class="msg-cell">BTW I mentioned in the previous TG3 (SES) meeting that this is under discussion</td></tr>
  <tr class="msg" id="L47"><td class="ts-cell"><a class="ts" href="#L47" alt="Thu May 30 2024 13:50:07 GMT-0700 (Pacific Daylight Time)">20:50</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@stephenbelanger:matrix.org">Stephen Belanger</span>&gt;</div></td><td class="msg-cell">Not <em>accidentally</em> escaping. <em>Intentionally</em> escaping.</td></tr>
  <tr class="msg" id="L48"><td class="ts-cell"><a class="ts" href="#L48" alt="Thu May 30 2024 13:50:07 GMT-0700 (Pacific Daylight Time)">20:50</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@littledan:matrix.org">littledan</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> I expressed this in the doc and slides I shared previously, but to repeat that: there are many layers of execution rearrangement occurring in JS. The base level of the microtask scheduler is fairly <em>obvious</em> to bind around, but as you raise further and further out into layers closer to user code it becomes less and less obvious what the "correct" path is when flowing around.</blockquote></mx-reply>lol I think we're all getting on the same page about how it's less and less obvious what the correct path is!</td></tr>
  <tr class="msg" id="L49"><td class="ts-cell"><a class="ts" href="#L49" alt="Thu May 30 2024 13:50:54 GMT-0700 (Pacific Daylight Time)">20:50</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@littledan:matrix.org">littledan</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> Not <em>accidentally</em> escaping. <em>Intentionally</em> escaping.</blockquote></mx-reply>sure, well, that explanation will have to be clear and explained in a self-contained way. They will be concerned about users who will not be expecting the escaping, even if you're doing it on purpose.</td></tr>
  <tr class="msg" id="L50"><td class="ts-cell"><a class="ts" href="#L50" alt="Thu May 30 2024 13:51:22 GMT-0700 (Pacific Daylight Time)">20:51</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@stephenbelanger:matrix.org">Stephen Belanger</span>&gt;</div></td><td class="msg-cell">Yep, that's why I aimed for through path first in <em>my own</em> RFC and provide tools for reducing the graph as-needed. My experience has been that it's a lot easier to <em>reduce</em> the graph than to <em>expand</em> it.</td></tr>
  <tr class="msg" id="L51"><td class="ts-cell"><a class="ts" href="#L51" alt="Thu May 30 2024 13:51:50 GMT-0700 (Pacific Daylight Time)">20:51</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@littledan:matrix.org">littledan</span>&gt;</div></td><td class="msg-cell">but the through path doesn't provide more information, it just provides different information; it still loses stuff that the around path had</td></tr>
  <tr class="msg" id="L52"><td class="ts-cell"><a class="ts" href="#L52" alt="Thu May 30 2024 13:52:10 GMT-0700 (Pacific Daylight Time)">20:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@stephenbelanger:matrix.org">Stephen Belanger</span>&gt;</div></td><td class="msg-cell">Admittedly though, ALS never <em>had</em> a way to <em>expand</em> the graph, so that experience is <em>possibly</em> incomplete.</td></tr>
  <tr class="msg" id="L53"><td class="ts-cell"><a class="ts" href="#L53" alt="Thu May 30 2024 13:52:43 GMT-0700 (Pacific Daylight Time)">20:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@stephenbelanger:matrix.org">Stephen Belanger</span>&gt;</div></td><td class="msg-cell">The through path can represent the around path if you don't change the value in the branches.</td></tr>
  <tr class="msg" id="L54"><td class="ts-cell"><a class="ts" href="#L54" alt="Thu May 30 2024 13:52:53 GMT-0700 (Pacific Daylight Time)">20:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@stephenbelanger:matrix.org">Stephen Belanger</span>&gt;</div></td><td class="msg-cell">The reverse is <em>not</em> true though.</td></tr>
  <tr class="msg" id="L55"><td class="ts-cell"><a class="ts" href="#L55" alt="Thu May 30 2024 13:53:16 GMT-0700 (Pacific Daylight Time)">20:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@stephenbelanger:matrix.org">Stephen Belanger</span>&gt;</div></td><td class="msg-cell">So you <em>can</em> get the same behaviour as flow-around if you use the variables carefully.</td></tr>
  <tr class="msg" id="L56"><td class="ts-cell"><a class="ts" href="#L56" alt="Thu May 30 2024 13:54:07 GMT-0700 (Pacific Daylight Time)">20:54</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@stephenbelanger:matrix.org">Stephen Belanger</span>&gt;</div></td><td class="msg-cell">And the bind tools let you reduce graphs to flow-around easily to prevent internal branch modifications from flowing out.</td></tr>
  <tr class="msg" id="L57"><td class="ts-cell"><a class="ts" href="#L57" alt="Thu May 30 2024 13:55:08 GMT-0700 (Pacific Daylight Time)">20:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@stephenbelanger:matrix.org">Stephen Belanger</span>&gt;</div></td><td class="msg-cell">Something like <code>await bindPromise(promise)</code> which would just capture context at the point <code>bindPromise(...)</code> is called and restore it when the given promise calls its continuation let you trivially restore around flow.</td></tr>
  <tr class="msg" id="L58"><td class="ts-cell"><a class="ts" href="#L58" alt="Thu May 30 2024 13:55:16 GMT-0700 (Pacific Daylight Time)">20:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@littledan:matrix.org">littledan</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> So you <em>can</em> get the same behaviour as flow-around if you use the variables carefully.</blockquote></mx-reply>could you explain further what you mean? I wonder if we can encourage/enforce "careful" usage, but I don't know what property you want to maintain.</td></tr>

</tbody></table></div></div></div>
</body></html>
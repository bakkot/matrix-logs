<!DOCTYPE html><html><head>
  <title>TC39 Async Context on 2023-09-15</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "TC39 Async Context";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">TC39 Async Context<br>2023-09-15<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2023-09-14" class="nav-link"><span>prev</span></a>
<a href="2023-09-19" class="nav-link"><span style="float:right">next</span></a>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">
<div class="rhs-header">
<span id="error" style="color: red; display:none">error</span>

<input type="text" id="query" size="25" placeholder="Search TC39 Async Context">
<a id="search-submit" class="button icon-link" title="Search">
  <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"></path></svg>
</a>
</div>

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Thu Sep 14 2023 20:24:51 GMT-0700 (Pacific Daylight Time)">03:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@littledan:matrix.org">littledan</span>&gt;</div></td><td class="msg-cell">We had a very good conversation at the end of the day yesterday with Anne VK (Apple), Ollie (smaug from Mozilla), Yoav, Domenic (Google), and Andreu about AsyncContext. Some results:<br>
•	everyone came to understand each other better, eg about what AsyncContext is and why it is useful<br>
•	smaug continues to be concerned about memory usage in an extremely general way. I am pretty convinced that no WeakMap in the mix will just not fix things here, and no one really defended that particular mechanism. I don’t see a way to follow up on this concern as it is very general, just based on experience of websites doing memory leaks. It is important that devtools gives good mechanisms to see what closes over what, including asynccontext snapshots, to help people debug memory leaks.<br>
•	Googlers have repeatedly raised this question of the appropriate venue to do this work. Yoav and I agreed that it could be done in either place and it’d be fine—there just aren’t huge technical differences. No one had a strong argument to push for a change, and Apple and Mozilla didn’t seem opinionated one way or another, so we will just leave things as is for now.<br>
•	Domenic was concerned that task attribution didn’t correspond to AsyncContext because he thought that task attribution would use caller semantics rather than register semantics; Yoav clarified that it actually often needs register semantics. We will need to do a case analysis to confirm, but there continues to be cautious optimism here about how asynccontext and task attribution need the same sort of thing.<br>
•	As far as what the semantics should be for when to use caller vs register semantics: Domenic pushed for a strong default that everything uses register semantics, except for a limited list of exceptions that we will figure out. I like this idea. He tried to get a read from other browsers about whether this makes sense for them, but they weren’t prepared to answer. Yoav isn’t sure whether we can do this at the callback level due to previous evidence of overhead, but that was coupled to creating task attribution nodes and we need to measure this separately. We will need to do this case by case study of which web APIs should use caller vs register semantics to confirm—no one feels like they have a complete picture.</td></tr>

</tbody></table></div></div></div>
</body></html>
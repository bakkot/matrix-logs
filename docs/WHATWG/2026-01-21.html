<!DOCTYPE html><html><head>
  <meta charset="UTF-8">
  <title>WHATWG on 2026-01-21</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "WHATWG";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">WHATWG<br>2026-01-21<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2026-01-20" class="nav-link"><span>prev</span></a>
<span style="float:right">next</span>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">
<div class="rhs-header">
<span id="error" style="color: red; display:none">error</span>

<input type="text" id="query" size="25" placeholder="Search WHATWG">
<a id="search-submit" class="button icon-link" title="Search">
  <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"></path></svg>
</a>
</div>

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Tue Jan 20 2026 22:20:50 GMT-0800 (Pacific Standard Time)">06:20</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@annevk:matrix.org">annevk</span>&gt;</div></td><td class="msg-cell">Anyone know the details about the <code>unload</code> event fire in Gecko? Per <a href="https://software.hixie.ch/utilities/js/live-dom-viewer/saved/14453">https://software.hixie.ch/utilities/js/live-dom-viewer/saved/14453</a> it looks like it fires after removal somehow?</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Tue Jan 20 2026 23:53:04 GMT-0800 (Pacific Standard Time)">07:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@nektro:matrix.org">nektro</span>&gt;</div></td><td class="msg-cell">ended up answering my unicode question and finished my Zig IDNA implementation <a href="https://github.com/nektro/zig-unicode-idna">https://github.com/nektro/zig-unicode-idna</a> :)</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Tue Jan 20 2026 23:53:32 GMT-0800 (Pacific Standard Time)">07:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@nektro:matrix.org">nektro</span>&gt;</div></td><td class="msg-cell">now to get back to url hehe</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Wed Jan 21 2026 00:22:33 GMT-0800 (Pacific Standard Time)">08:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@sideshowbarker:matrix.org">sideshowbarker</span>&gt;</div></td><td class="msg-cell">So everybody else fires it after?</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Wed Jan 21 2026 00:23:30 GMT-0800 (Pacific Standard Time)">08:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@sideshowbarker:matrix.org">sideshowbarker</span>&gt;</div></td><td class="msg-cell">per spec, is the removal sync? And is the firing of the event async?</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Wed Jan 21 2026 00:24:12 GMT-0800 (Pacific Standard Time)">08:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@sideshowbarker:matrix.org">sideshowbarker</span>&gt;</div></td><td class="msg-cell">I‚Äôm trying to do some code inspection, looking at the code locally ‚Äî but‚Ä¶&nbsp;it‚Äôs pretty hairy</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Wed Jan 21 2026 00:24:54 GMT-0800 (Pacific Standard Time)">08:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@sideshowbarker:matrix.org">sideshowbarker</span>&gt;</div></td><td class="msg-cell">I kind of feel like nobody might know what the code is doing ‚Äî except whoever wrote it or last had to touch it</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Wed Jan 21 2026 00:25:04 GMT-0800 (Pacific Standard Time)">08:25</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@sideshowbarker:matrix.org">sideshowbarker</span>&gt;</div></td><td class="msg-cell">and probably they don‚Äôt even remember by now</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Wed Jan 21 2026 00:25:30 GMT-0800 (Pacific Standard Time)">08:25</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@sideshowbarker:matrix.org">sideshowbarker</span>&gt;</div></td><td class="msg-cell">but then I guess there‚Äôs a high change ‚Äúthey‚Äù = smaug anyway</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Wed Jan 21 2026 00:29:05 GMT-0800 (Pacific Standard Time)">08:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@sideshowbarker:matrix.org">sideshowbarker</span>&gt;</div></td><td class="msg-cell">‚Ä¶
anyway, in other news, since I‚Äôm going to be the W3C staff contact for the Web Extensions WG, I figured I should actually try to write a cross-browser extension ‚Äî in order to fully participate in the pain of trying to do that ‚Äî&nbsp;and I managed to come up with an actually-pretty-useful extension:</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Wed Jan 21 2026 00:29:12 GMT-0800 (Pacific Standard Time)">08:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@sideshowbarker:matrix.org">sideshowbarker</span>&gt;</div></td><td class="msg-cell"><a href="https://github.com/sideshowbarker/social-media-cleanser">https://github.com/sideshowbarker/social-media-cleanser</a></td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Wed Jan 21 2026 00:30:21 GMT-0800 (Pacific Standard Time)">08:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@sideshowbarker:matrix.org">sideshowbarker</span>&gt;</div></td><td class="msg-cell">I encourage any and all try to it, and specifically lemme know if you run into any install problems. And otherwise of course, does it actually work for you.</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Wed Jan 21 2026 00:38:38 GMT-0800 (Pacific Standard Time)">08:38</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@annevk:matrix.org">annevk</span>&gt;</div></td><td class="msg-cell">In <a href="https://github.com/whatwg/html/issues/4611#issuecomment-1960779830">https://github.com/whatwg/html/issues/4611#issuecomment-1960779830</a> <span class="nick-1">Dominic Farolino</span> claimed all browsers are aligned, but my trivial example from above shows that's not the case.</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Wed Jan 21 2026 00:42:28 GMT-0800 (Pacific Standard Time)">08:42</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@sideshowbarker:matrix.org">sideshowbarker</span>&gt;</div></td><td class="msg-cell">seems like it‚Äôs actually async in gecko at least</td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Wed Jan 21 2026 00:50:43 GMT-0800 (Pacific Standard Time)">08:50</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@annevk:matrix.org">annevk</span>&gt;</div></td><td class="msg-cell">I don't think so. At least per <a href="https://software.hixie.ch/utilities/js/live-dom-viewer/saved/14454">https://software.hixie.ch/utilities/js/live-dom-viewer/saved/14454</a> it seems like they might just clear <code>frameElement</code> earlier, but if you cache it in some other way you still get to make changes around the same time. But perhaps maybe it's slightly delayed?</td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Wed Jan 21 2026 01:11:37 GMT-0800 (Pacific Standard Time)">09:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@annevk:matrix.org">annevk</span>&gt;</div></td><td class="msg-cell">I'm looking at this since rniwa is saying <code>selectedcontent</code> is unsafe as specified because of the <code>unload</code> event. I'm curious how <span class="nick-12">jarhar</span> dealt with this as I don't really see anything obvious in the Chromium code. I did notice Chromium doesn't appear to clear all non-primary <code>selectedcontent</code> elements when testing.</td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Wed Jan 21 2026 03:09:58 GMT-0800 (Pacific Standard Time)">11:09</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@smaug:mozilla.org">smaug</span>&gt;</div></td><td class="msg-cell">We were looking into something similar very recently on Gecko side and selectedcontent. I thought it was safe after all, but just possibly a bit weird</td></tr>
  <tr class="msg" id="L17"><td class="ts-cell"><a class="ts" href="#L17" alt="Wed Jan 21 2026 03:10:02 GMT-0800 (Pacific Standard Time)">11:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@smaug:mozilla.org">smaug</span>&gt;</div></td><td class="msg-cell"><span class="nick-16">jjaschke</span> might recall</td></tr>
  <tr class="msg" id="L18"><td class="ts-cell"><a class="ts" href="#L18" alt="Wed Jan 21 2026 03:10:23 GMT-0800 (Pacific Standard Time)">11:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@smaug:mozilla.org">smaug</span>&gt;</div></td><td class="msg-cell">Something about remove all the child nodes</td></tr>
  <tr class="msg" id="L19"><td class="ts-cell"><a class="ts" href="#L19" alt="Wed Jan 21 2026 03:13:08 GMT-0800 (Pacific Standard Time)">11:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@smaug:mozilla.org">smaug</span>&gt;</div></td><td class="msg-cell">And yes, I couldn't immediately find the code in Chromium doing what the spec says, but didn't spend much time on that</td></tr>
  <tr class="msg" id="L20"><td class="ts-cell"><a class="ts" href="#L20" alt="Wed Jan 21 2026 03:14:11 GMT-0800 (Pacific Standard Time)">11:14</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@jjaschke:mozilla.org">jjaschke</span>&gt;</div></td><td class="msg-cell">Selectedcontent calls <a href="https://dom.spec.whatwg.org/#concept-node-replace-all">replace all with</a> when cloning stuff into it or removing its contents</td></tr>
  <tr class="msg" id="L21"><td class="ts-cell"><a class="ts" href="#L21" alt="Wed Jan 21 2026 03:31:13 GMT-0800 (Pacific Standard Time)">11:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@smaug:mozilla.org">smaug</span>&gt;</div></td><td class="msg-cell">(and similar-ish weirdness may happen for example when using range.deleteContents(), so nothing new there)</td></tr>
  <tr class="msg" id="L22"><td class="ts-cell"><a class="ts" href="#L22" alt="Wed Jan 21 2026 03:33:34 GMT-0800 (Pacific Standard Time)">11:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@noamr:matrix.org">Noam Rosenthal</span>&gt;</div></td><td class="msg-cell">so the unsafe thing here is that an &lt;iframe&gt; inside a &lt;selectedcontent&gt; can trigger a <code>pagehide</code> that would observe some mid-algorithm state, or some such?</td></tr>
  <tr class="msg" id="L23"><td class="ts-cell"><a class="ts" href="#L23" alt="Wed Jan 21 2026 03:34:22 GMT-0800 (Pacific Standard Time)">11:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@smaug:mozilla.org">smaug</span>&gt;</div></td><td class="msg-cell">yeah, pagehide or unload. That was the worry I had. Not sure if <span class="nick-12">annevk</span> is talking about something else</td></tr>
  <tr class="msg" id="L24"><td class="ts-cell"><a class="ts" href="#L24" alt="Wed Jan 21 2026 03:34:52 GMT-0800 (Pacific Standard Time)">11:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@noamr:matrix.org">Noam Rosenthal</span>&gt;</div></td><td class="msg-cell">(note that while <code>unload</code> is deprecated and has weird cross-browser issues, <code>pagehide</code> is relatively interoperable I think and potentially has the same issue so it's easier to reason about)</td></tr>
  <tr class="msg" id="L25"><td class="ts-cell"><a class="ts" href="#L25" alt="Wed Jan 21 2026 03:35:16 GMT-0800 (Pacific Standard Time)">11:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@smaug:mozilla.org">smaug</span>&gt;</div></td><td class="msg-cell">sure</td></tr>
  <tr class="msg" id="L26"><td class="ts-cell"><a class="ts" href="#L26" alt="Wed Jan 21 2026 05:20:33 GMT-0800 (Pacific Standard Time)">13:20</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@annevk:matrix.org">annevk</span>&gt;</div></td><td class="msg-cell"><span class="nick-8">Noam Rosenthal</span>: is <code>pagehide</code> synchronous as well? If so, yes. I think we need post-removing steps, maybe?</td></tr>
  <tr class="msg" id="L27"><td class="ts-cell"><a class="ts" href="#L27" alt="Wed Jan 21 2026 05:21:33 GMT-0800 (Pacific Standard Time)">13:21</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@noamr:matrix.org">Noam Rosenthal</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> <span class="nick-8">Noam Rosenthal</span>: is <code>pagehide</code> synchronous as well? If so, yes. I think we need post-removing steps, maybe?</blockquote></mx-reply>It is. It is the only synchronous removal step that can run scripts (though blink still has blur events)</td></tr>
  <tr class="msg" id="L28"><td class="ts-cell"><a class="ts" href="#L28" alt="Wed Jan 21 2026 05:23:12 GMT-0800 (Pacific Standard Time)">13:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@annevk:matrix.org">annevk</span>&gt;</div></td><td class="msg-cell">I'll just make the issue about pagehide then.</td></tr>
  <tr class="msg" id="L29"><td class="ts-cell"><a class="ts" href="#L29" alt="Wed Jan 21 2026 05:25:21 GMT-0800 (Pacific Standard Time)">13:25</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@annevk:matrix.org">annevk</span>&gt;</div></td><td class="msg-cell"><a href="https://github.com/whatwg/html/issues/12096">https://github.com/whatwg/html/issues/12096</a></td></tr>
  <tr class="msg" id="L30"><td class="ts-cell"><a class="ts" href="#L30" alt="Wed Jan 21 2026 05:30:21 GMT-0800 (Pacific Standard Time)">13:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@annevk:matrix.org">annevk</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">smaug</span>: yeah rniwa was a bit stricter than you I suppose and just said no. üòä</td></tr>
  <tr class="msg" id="L31"><td class="ts-cell"><a class="ts" href="#L31" alt="Wed Jan 21 2026 05:30:58 GMT-0800 (Pacific Standard Time)">13:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@noamr:matrix.org">Noam Rosenthal</span>&gt;</div></td><td class="msg-cell"><span class="nick-6">@annevk:matrix.org</span>: not sure if post removal steps would help. It's a really tricky one. We explored it when dealing with moveBefore though it ended up not being an issue there because moveBefore surpresses iframe removal. Will comment on the issue </td></tr>
  <tr class="msg" id="L32"><td class="ts-cell"><a class="ts" href="#L32" alt="Wed Jan 21 2026 05:31:29 GMT-0800 (Pacific Standard Time)">13:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@noamr:matrix.org">Noam Rosenthal</span>&gt;</div></td><td class="msg-cell">The safest thing would be to disallow subframes in selectedcontent but I don't know if it breaks use cases or not </td></tr>
  <tr class="msg" id="L33"><td class="ts-cell"><a class="ts" href="#L33" alt="Wed Jan 21 2026 05:33:36 GMT-0800 (Pacific Standard Time)">13:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@annevk:matrix.org">annevk</span>&gt;</div></td><td class="msg-cell">If we remove the nesting by postponing the removal I'm not sure what issue would remain? It does seem possible someone can think of use cases for selecting between nested documents, even if a bit absurd.</td></tr>
  <tr class="msg" id="L34"><td class="ts-cell"><a class="ts" href="#L34" alt="Wed Jan 21 2026 05:34:23 GMT-0800 (Pacific Standard Time)">13:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@noamr:matrix.org">Noam Rosenthal</span>&gt;</div></td><td class="msg-cell">Oh postponing the removal specifically in selectedcontent? That would also work.</td></tr>
  <tr class="msg" id="L35"><td class="ts-cell"><a class="ts" href="#L35" alt="Wed Jan 21 2026 05:34:47 GMT-0800 (Pacific Standard Time)">13:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@annevk:matrix.org">annevk</span>&gt;</div></td><td class="msg-cell">Right, specifically in the case where removal would otherwise end up nesting.</td></tr>
  <tr class="msg" id="L36"><td class="ts-cell"><a class="ts" href="#L36" alt="Wed Jan 21 2026 07:13:26 GMT-0800 (Pacific Standard Time)">15:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-1" title="@domfarolino:matrix.org">Dominic Farolino</span>&gt;</div></td><td class="msg-cell"><span class="nick-12">annevk</span>: I'm not sure what "remove the nesting by postponing the removal" means? Do you mean run the pagehide first, and postpone the actual DOM removal until after that event has fired?</td></tr>
  <tr class="msg" id="L37"><td class="ts-cell"><a class="ts" href="#L37" alt="Wed Jan 21 2026 07:21:51 GMT-0800 (Pacific Standard Time)">15:21</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@annevk:matrix.org">annevk</span>&gt;</div></td><td class="msg-cell"><span class="nick-1">Dominic Farolino</span>: we try to do removal during the removal of the <code>selectedcontent</code> itself. That's nesting. If we postpone that removal we can avoid the nesting. I'd be interested to learn more about <span class="nick-4">smaug</span>'s <code>deleteContents()</code> case as I guess that can do something similar due to it performing multiple tree operations. We might actually have to define some of the mutation event defenses because of <code>pagehide</code>.</td></tr>
  <tr class="msg" id="L38"><td class="ts-cell"><a class="ts" href="#L38" alt="Wed Jan 21 2026 07:48:43 GMT-0800 (Pacific Standard Time)">15:48</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-1" title="@domfarolino:matrix.org">Dominic Farolino</span>&gt;</div></td><td class="msg-cell"><span class="nick-12">annevk</span>: Didn't know what you meant by nesting, gotcha. Is "nesting" removing steps any worse than the general problem with removal steps, namely that iframes fire <code>pagehide</code> syncly on removal when the spec says it doesn't? If a selected content is cleared and an iframe's <code>pagehide</code> fires, can it observe state that's any less consistent than if an ordinary iframe's parent div gets removed? There, the child iframe's removing steps are still called, and observe inconsistent state wrt its siblings' removing steps side-effects.</td></tr>
  <tr class="msg" id="L39"><td class="ts-cell"><a class="ts" href="#L39" alt="Wed Jan 21 2026 07:49:44 GMT-0800 (Pacific Standard Time)">15:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-1" title="@domfarolino:matrix.org">Dominic Farolino</span>&gt;</div></td><td class="msg-cell">Of course, it's unfortunate that selected content APIs bake this in <em>natively</em> which is a shame. I'm annoyed I missed this in review.</td></tr>
  <tr class="msg" id="L40"><td class="ts-cell"><a class="ts" href="#L40" alt="Wed Jan 21 2026 07:57:29 GMT-0800 (Pacific Standard Time)">15:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@annevk:matrix.org">annevk</span>&gt;</div></td><td class="msg-cell">I don't know how this works in other implementations and the specification is definitely wrong on this, but WebKit has a very specific path for "disconnectSubframesIfNeeded" that's called during node removal at a particular point in time. With this nesting it can also be called at other points in time, which is what makes this risky. I'm also not an expert on this. rniwa is, but he has limited bandwidth.</td></tr>
  <tr class="msg" id="L41"><td class="ts-cell"><a class="ts" href="#L41" alt="Wed Jan 21 2026 08:01:07 GMT-0800 (Pacific Standard Time)">16:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@annevk:matrix.org">annevk</span>&gt;</div></td><td class="msg-cell">And come to think of it, maybe that is also why <code>deleteContents()</code> is not problematic, because we complete each removal before starting the next one.</td></tr>
  <tr class="msg" id="L42"><td class="ts-cell"><a class="ts" href="#L42" alt="Wed Jan 21 2026 08:19:07 GMT-0800 (Pacific Standard Time)">16:19</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-1" title="@domfarolino:matrix.org">Dominic Farolino</span>&gt;</div></td><td class="msg-cell">I suppose... Still, when deleteContents() runs the removing steps for a doomed iframe, its <code>pagehide</code> handler can easily remove another iframe&nbsp;elsewhere, thus nesting removing steps. I wonder if that imposes the same risk in WebKit as the native selected content nesting. (Neither is acceptable, FWIW... all of it is bad)</td></tr>
  <tr class="msg" id="L43"><td class="ts-cell"><a class="ts" href="#L43" alt="Wed Jan 21 2026 08:26:19 GMT-0800 (Pacific Standard Time)">16:26</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@annevk:matrix.org">annevk</span>&gt;</div></td><td class="msg-cell">No, <code>pagehide</code> running remove during remove is expected. What is unexpected is an arbitrary element running remove (during remove).</td></tr>
  <tr class="msg" id="L44"><td class="ts-cell"><a class="ts" href="#L44" alt="Wed Jan 21 2026 08:26:57 GMT-0800 (Pacific Standard Time)">16:26</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@annevk:matrix.org">annevk</span>&gt;</div></td><td class="msg-cell">Because the latter means script can now run at a new point in time that is not guarded against whatsoever.</td></tr>
  <tr class="msg" id="L45"><td class="ts-cell"><a class="ts" href="#L45" alt="Wed Jan 21 2026 11:33:39 GMT-0800 (Pacific Standard Time)">19:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-1" title="@domfarolino:matrix.org">Dominic Farolino</span>&gt;</div></td><td class="msg-cell"><span class="nick-12">annevk</span>: We discussed this today and I think we have a path for removing the selected content's removing steps altogether</td></tr>
  <tr class="msg" id="L46"><td class="ts-cell"><a class="ts" href="#L46" alt="Wed Jan 21 2026 12:57:28 GMT-0800 (Pacific Standard Time)">20:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@smaug:mozilla.org">smaug</span>&gt;</div></td><td class="msg-cell"><span class="nick-12">annevk</span>: about deleteContents. I think that algorithm is actually broken. The last <a href="https://dom.spec.whatwg.org/#dom-range-deletecontents:~:text=Set%20start%20and%20end%20to%20%28newNode%2C%20newOffset%29%2E">step</a> may set the start and end boundary points pointing to an invalid place in DOM if remove step above modifies DOM and for example removes all the children from newNode before newOffset. <del>It should likely use "set the start or end" algorithm, not just explicitly set the boundary points. </del> It should find a valid place where to collapse the range. Or collapse before any mutations.</td></tr>

</tbody></table></div></div></div>
</body></html>
<!DOCTYPE html><html><head>
  <title>WHATWG on 2023-11-23</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "WHATWG";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">WHATWG<br>2023-11-23<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2023-11-22" class="nav-link"><span>prev</span></a>
<span style="float:right">next</span>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">
<div class="rhs-header">
<span id="error" style="color: red; display:none">error</span>

<input type="text" id="query" size="25" placeholder="Search WHATWG">
<a id="search-submit" class="button icon-link" title="Search">
  <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"></path></svg>
</a>
</div>

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Wed Nov 22 2023 18:51:10 GMT-0800 (Pacific Standard Time)">02:51</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-1" title="@domenicdenicola:matrix.org">Domenic</span>&gt;</div></td><td class="msg-cell">Definitely not. The simplest way to see this is to consider the iframe case. An iframe will contain a single browsing context for all time. That browsing context can transition between different agents, living in different agent clusters, if you navigate the iframe cross-site.</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Thu Nov 23 2023 01:52:53 GMT-0800 (Pacific Standard Time)">09:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@keithamus:matrix.org">keithamus</span>&gt;</div></td><td class="msg-cell"><a href="https://github.com/whatwg/html/pulls/keithamus">https://github.com/whatwg/html/pulls/keithamus</a> there's a handful of open editorial PRs for the enumerated attributes. It'd be great to get <a href="https://github.com/whatwg/html/pull/9947">https://github.com/whatwg/html/pull/9947</a> reviewed and merged as I get the sense it'll cause merge conflicts down the line.</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Thu Nov 23 2023 02:32:37 GMT-0800 (Pacific Standard Time)">10:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@noamr:matrix.org">Noam Rosenthal</span>&gt;</div></td><td class="msg-cell">As an action item from the last WHATNOT, I created <a href="https://github.com/whatwg/html/issues/9941">https://github.com/whatwg/html/issues/9941</a> (defining what navigation type to give a tab-restore) 
I convinced myself that a tab-restore is actually closer to restoring from history than to a reload, but would love feedback as convincing myself has proven insufficient in the past.</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Thu Nov 23 2023 03:18:38 GMT-0800 (Pacific Standard Time)">11:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@annevk:matrix.org">annevk</span>&gt;</div></td><td class="msg-cell"><span class="nick-6">keithamus</span>: I merged that one and another small one; can take another look after lunch</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Thu Nov 23 2023 03:18:47 GMT-0800 (Pacific Standard Time)">11:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@annevk:matrix.org">annevk</span>&gt;</div></td><td class="msg-cell"><span class="nick-6">keithamus</span>: thanks for all the cleanup!</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Thu Nov 23 2023 03:18:50 GMT-0800 (Pacific Standard Time)">11:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@keithamus:matrix.org">keithamus</span>&gt;</div></td><td class="msg-cell">Amazing thank you!</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Thu Nov 23 2023 04:03:43 GMT-0800 (Pacific Standard Time)">12:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@annevk:matrix.org">annevk</span>&gt;</div></td><td class="msg-cell"><span class="nick-6">keithamus</span>: one thing that helps with reviews is to do fixup commits (which we squash when landing); bit different from how WebKit does things and not possible when you need to rebase, but that generally makes it easier to see if anything besides your review comments got addressed, etc.</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Thu Nov 23 2023 04:04:06 GMT-0800 (Pacific Standard Time)">12:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@keithamus:matrix.org">keithamus</span>&gt;</div></td><td class="msg-cell">Oh right, will do, thanks for calling that out.</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Thu Nov 23 2023 04:04:44 GMT-0800 (Pacific Standard Time)">12:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@keithamus:matrix.org">keithamus</span>&gt;</div></td><td class="msg-cell">In the case of my recent rebase it was only your review comment ;) </td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Thu Nov 23 2023 06:30:28 GMT-0800 (Pacific Standard Time)">14:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@annevk:matrix.org">annevk</span>&gt;</div></td><td class="msg-cell"><span class="nick-16">Ms2ger ðŸ‡©ðŸ‡ª</span>: if you make it to Berlin don't forget to say hi</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Thu Nov 23 2023 06:30:45 GMT-0800 (Pacific Standard Time)">14:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@ms2ger:igalia.com">Ms2ger ðŸ‡©ðŸ‡ª</span>&gt;</div></td><td class="msg-cell">Going in the other direction, sorry :)</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Thu Nov 23 2023 06:30:55 GMT-0800 (Pacific Standard Time)">14:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@ms2ger:igalia.com">Ms2ger ðŸ‡©ðŸ‡ª</span>&gt;</div></td><td class="msg-cell">Deutsche Bahn permitting</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Thu Nov 23 2023 06:31:16 GMT-0800 (Pacific Standard Time)">14:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@annevk:matrix.org">annevk</span>&gt;</div></td><td class="msg-cell">Hah, good luck!</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Thu Nov 23 2023 06:31:35 GMT-0800 (Pacific Standard Time)">14:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@ms2ger:igalia.com">Ms2ger ðŸ‡©ðŸ‡ª</span>&gt;</div></td><td class="msg-cell">(My next train has already been cancelled and uncancelled)</td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Thu Nov 23 2023 06:56:33 GMT-0800 (Pacific Standard Time)">14:56</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@akaster:serenityos.org">akaster</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> Definitely not. The simplest way to see this is to consider the iframe case. An iframe will contain a single browsing context for all time. That browsing context can transition between different agents, living in different agent clusters, if you navigate the iframe cross-site.</blockquote></mx-reply>That doesn't align with my current understanding at all ðŸ˜…. Browsing contexts are expected to move between agents as they navigate? We'll need to refactor them a lot in LibWeb to make that a possibility...</td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Thu Nov 23 2023 07:04:29 GMT-0800 (Pacific Standard Time)">15:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@akaster:serenityos.org">akaster</span>&gt;</div></td><td class="msg-cell">Is there some mechanism in the spec that I missed that talks about when we're supposed to move a browsing context to a new agent?</td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Thu Nov 23 2023 08:30:09 GMT-0800 (Pacific Standard Time)">16:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@annevk:matrix.org">annevk</span>&gt;</div></td><td class="msg-cell"><span class="nick-8">akaster</span>: I assume you've seen how a browsing context group holds an agent cluster map?</td></tr>
  <tr class="msg" id="L17"><td class="ts-cell"><a class="ts" href="#L17" alt="Thu Nov 23 2023 08:31:31 GMT-0800 (Pacific Standard Time)">16:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@annevk:matrix.org">annevk</span>&gt;</div></td><td class="msg-cell"><span class="nick-8">akaster</span>: but basically if you trace the callers of "create an agent" you should be able to find it</td></tr>
  <tr class="msg" id="L18"><td class="ts-cell"><a class="ts" href="#L18" alt="Thu Nov 23 2023 08:31:43 GMT-0800 (Pacific Standard Time)">16:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@annevk:matrix.org">annevk</span>&gt;</div></td><td class="msg-cell"><span class="nick-8">akaster</span>: (clicking on the definition reveals the callers)</td></tr>
  <tr class="msg" id="L19"><td class="ts-cell"><a class="ts" href="#L19" alt="Thu Nov 23 2023 08:31:46 GMT-0800 (Pacific Standard Time)">16:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@akaster:serenityos.org">akaster</span>&gt;</div></td><td class="msg-cell">Oh, that links back to "obtain a similar origin window agent"</td></tr>
  <tr class="msg" id="L20"><td class="ts-cell"><a class="ts" href="#L20" alt="Thu Nov 23 2023 08:32:51 GMT-0800 (Pacific Standard Time)">16:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@annevk:matrix.org">annevk</span>&gt;</div></td><td class="msg-cell"><span class="nick-8">akaster</span>: right so an agent can be reused, but if you navigate a document to a new document of a different not-yet-seen origin, you need a new agent</td></tr>
  <tr class="msg" id="L21"><td class="ts-cell"><a class="ts" href="#L21" alt="Thu Nov 23 2023 08:33:42 GMT-0800 (Pacific Standard Time)">16:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@annevk:matrix.org">annevk</span>&gt;</div></td><td class="msg-cell"><span class="nick-8">akaster</span>: and due to bfcache a single browsing context can end up being responsible for several cross-site documents (and thus agents)</td></tr>
  <tr class="msg" id="L22"><td class="ts-cell"><a class="ts" href="#L22" alt="Thu Nov 23 2023 08:34:27 GMT-0800 (Pacific Standard Time)">16:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@akaster:serenityos.org">akaster</span>&gt;</div></td><td class="msg-cell">Is it expected that when you create a new agent that execution of the current algorithm will jump into the context of that agent? Or rather, onto the execution context stack of that new agent</td></tr>
  <tr class="msg" id="L23"><td class="ts-cell"><a class="ts" href="#L23" alt="Thu Nov 23 2023 08:36:19 GMT-0800 (Pacific Standard Time)">16:36</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@annevk:matrix.org">annevk</span>&gt;</div></td><td class="msg-cell"><span class="nick-8">akaster</span>: the new document/worker will have to execute in the new agent, but the spec algorithm might also do some other bookkeeping things not related to JS code</td></tr>
  <tr class="msg" id="L24"><td class="ts-cell"><a class="ts" href="#L24" alt="Thu Nov 23 2023 08:36:37 GMT-0800 (Pacific Standard Time)">16:36</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@akaster:serenityos.org">akaster</span>&gt;</div></td><td class="msg-cell">Or am I still not thinking about this right. The way that all these concepts relate to threads and processes is still quite confusing.</td></tr>
  <tr class="msg" id="L25"><td class="ts-cell"><a class="ts" href="#L25" alt="Thu Nov 23 2023 08:36:56 GMT-0800 (Pacific Standard Time)">16:36</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@annevk:matrix.org">annevk</span>&gt;</div></td><td class="msg-cell"><span class="nick-8">akaster</span>: an agent cluster is a conceptual process</td></tr>
  <tr class="msg" id="L26"><td class="ts-cell"><a class="ts" href="#L26" alt="Thu Nov 23 2023 08:37:03 GMT-0800 (Pacific Standard Time)">16:37</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@annevk:matrix.org">annevk</span>&gt;</div></td><td class="msg-cell"><span class="nick-8">akaster</span>: an agent is a conceptual thread</td></tr>
  <tr class="msg" id="L27"><td class="ts-cell"><a class="ts" href="#L27" alt="Thu Nov 23 2023 08:38:04 GMT-0800 (Pacific Standard Time)">16:38</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@annevk:matrix.org">annevk</span>&gt;</div></td><td class="msg-cell">In practice user agents coalesce multiple "conceptuals" into a single "physical" to limit resource usage, but the specification allows for more parallelism</td></tr>
  <tr class="msg" id="L28"><td class="ts-cell"><a class="ts" href="#L28" alt="Thu Nov 23 2023 08:38:26 GMT-0800 (Pacific Standard Time)">16:38</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@akaster:serenityos.org">akaster</span>&gt;</div></td><td class="msg-cell">Gotcha... Just need to wrap my head around what things are supposed to happen "to the user agent" (aka some abstract state that someone handles (?)) vs what are useful to model as an actual C++ object in memory of a particular process, whether it be the renderer, UI, or other helper </td></tr>
  <tr class="msg" id="L29"><td class="ts-cell"><a class="ts" href="#L29" alt="Thu Nov 23 2023 08:39:11 GMT-0800 (Pacific Standard Time)">16:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@annevk:matrix.org">annevk</span>&gt;</div></td><td class="msg-cell"><span class="nick-8">akaster</span>: I see, most browsers have a "browser" process that would allocate these "agent cluster" processes</td></tr>
  <tr class="msg" id="L30"><td class="ts-cell"><a class="ts" href="#L30" alt="Thu Nov 23 2023 08:39:31 GMT-0800 (Pacific Standard Time)">16:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@annevk:matrix.org">annevk</span>&gt;</div></td><td class="msg-cell"><span class="nick-8">akaster</span>: and then depending on needs there might be a GPU, network, etc. process</td></tr>
  <tr class="msg" id="L31"><td class="ts-cell"><a class="ts" href="#L31" alt="Thu Nov 23 2023 08:40:46 GMT-0800 (Pacific Standard Time)">16:40</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@akaster:serenityos.org">akaster</span>&gt;</div></td><td class="msg-cell">Right, in Ladybird at the moment we have a more or less standard architecture, I think. We have a browser process, and we have a WebContent process for each Tab, and a set of Network, ImageDecoding processes etc that could easily be shared but aren't at the moment for the WebContent process to use</td></tr>
  <tr class="msg" id="L32"><td class="ts-cell"><a class="ts" href="#L32" alt="Thu Nov 23 2023 08:41:03 GMT-0800 (Pacific Standard Time)">16:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@akaster:serenityos.org">akaster</span>&gt;</div></td><td class="msg-cell">But the way that we handle navigation is still very ad hoc</td></tr>
  <tr class="msg" id="L33"><td class="ts-cell"><a class="ts" href="#L33" alt="Thu Nov 23 2023 08:41:47 GMT-0800 (Pacific Standard Time)">16:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@akaster:serenityos.org">akaster</span>&gt;</div></td><td class="msg-cell">So aligning what the spec expects us to do as far as agents and agent clusters vs the current "just change the URL we load lmao" approach is ... Not straightforward.</td></tr>
  <tr class="msg" id="L34"><td class="ts-cell"><a class="ts" href="#L34" alt="Thu Nov 23 2023 08:43:50 GMT-0800 (Pacific Standard Time)">16:43</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@akaster:serenityos.org">akaster</span>&gt;</div></td><td class="msg-cell">So it sounds like, WebContent (aka the renderer) is supposed to be our agent cluster process. And every time we navigate to a url that needs a new agent cluster, we "should" create a new process. And most browsers at the moment ask the main Browser process (UI?) to create one for them</td></tr>
  <tr class="msg" id="L35"><td class="ts-cell"><a class="ts" href="#L35" alt="Thu Nov 23 2023 08:45:18 GMT-0800 (Pacific Standard Time)">16:45</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@annevk:matrix.org">annevk</span>&gt;</div></td><td class="msg-cell"><span class="nick-8">akaster</span>: yeah, sounds like you have the same state WebKit is in, which is a problem for Spectre. You need different processes for nested documents. That requires quite a number of changes.</td></tr>
  <tr class="msg" id="L36"><td class="ts-cell"><a class="ts" href="#L36" alt="Thu Nov 23 2023 08:45:45 GMT-0800 (Pacific Standard Time)">16:45</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@annevk:matrix.org">annevk</span>&gt;</div></td><td class="msg-cell"><span class="nick-8">akaster</span>: and yeah having the UI/browser process take some responsibility for navigations is needed I think.</td></tr>
  <tr class="msg" id="L37"><td class="ts-cell"><a class="ts" href="#L37" alt="Thu Nov 23 2023 08:48:05 GMT-0800 (Pacific Standard Time)">16:48</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@akaster:serenityos.org">akaster</span>&gt;</div></td><td class="msg-cell">Okay, thanks! I think I'll need to draw a lot of diagrams to wrap my head around how all this is supposed to work. Especially for the set of IPC interactions we need to have, and which spec records need to be shared between the processes, or at least transferred around. When talking to Domenic about my worker prototypes it was clear that we weren't modelling EnvironmentSettingsObjects in the way the spec authors intended</td></tr>
  <tr class="msg" id="L38"><td class="ts-cell"><a class="ts" href="#L38" alt="Thu Nov 23 2023 08:48:11 GMT-0800 (Pacific Standard Time)">16:48</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@annevk:matrix.org">annevk</span>&gt;</div></td><td class="msg-cell"><span class="nick-8">akaster</span>: <a href="https://docs.google.com/presentation/d/1hi4gH7pJPHsg_hnIj77XN_ce54HIaNUnBLenVwohFVo/edit#slide=id.g5641ecbac9_0_131">https://docs.google.com/presentation/d/1hi4gH7pJPHsg_hnIj77XN_ce54HIaNUnBLenVwohFVo/edit#slide=id.g5641ecbac9_0_131</a> might help for the high-level idea.</td></tr>

</tbody></table></div></div></div>
</body></html>
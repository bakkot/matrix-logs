<!DOCTYPE html><html><head>
  <title>WHATWG on 2024-02-28</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "WHATWG";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">WHATWG<br>2024-02-28<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2024-02-27" class="nav-link"><span>prev</span></a>
<span style="float:right">next</span>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">
<div class="rhs-header">
<span id="error" style="color: red; display:none">error</span>

<input type="text" id="query" size="25" placeholder="Search WHATWG">
<a id="search-submit" class="button icon-link" title="Search">
  <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"></path></svg>
</a>
</div>

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Wed Feb 28 2024 02:54:49 GMT-0800 (Pacific Standard Time)">10:54</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@noamr:matrix.org">Noam Rosenthal</span>&gt;</div></td><td class="msg-cell"><span class="nick-8">akaster</span>: might be relevant, but <code>fetch</code> also accepts a <code>reserved client</code> in the cases where you don't have a Realm yet (e.g. you're navigating to a new document, loading a new worker)</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Wed Feb 28 2024 02:55:27 GMT-0800 (Pacific Standard Time)">10:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@noamr:matrix.org">Noam Rosenthal</span>&gt;</div></td><td class="msg-cell"><span class="nick-8">akaster</span>: <a href="https://html.spec.whatwg.org/multipage/workers.html#run-a-worker">https://html.spec.whatwg.org/multipage/workers.html#run-a-worker</a>, search for <code>reserved client</code></td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Wed Feb 28 2024 06:58:16 GMT-0800 (Pacific Standard Time)">14:58</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-1" title="@domfarolino:matrix.org">Dominic Farolino</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> I'm not entirely sure what fields/algorithms from the environment settings object "fetch a classic worker script" and "fetch a module script graph" need, but I'm hoping it's only like, the origin and url and other easily serializable data? But Fetch Request explicitly says that its client must be an environment settings object or null</blockquote></mx-reply>One of the things ESO holds that fetch needs deeply inside of its parallel-ness, is a handle to the global to post tasks to when the response comes in etc.</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Wed Feb 28 2024 07:02:00 GMT-0800 (Pacific Standard Time)">15:02</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@akaster:serenityos.org">akaster</span>&gt;</div></td><td class="msg-cell">Hmm. But in that case we want the inside settings object of the worker. We also set the reserved client to the inside settings. The issue I'm seeing with our implementation right now is down to checks about same origin, about CORS, etc when overriding things set to "client" with those from the outside settings</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Wed Feb 28 2024 07:02:31 GMT-0800 (Pacific Standard Time)">15:02</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@annevk:matrix.org">annevk</span>&gt;</div></td><td class="msg-cell"><span class="nick-8">akaster</span>: that sounds about right. Ideally we'd convert a client to such a concrete struct, but I never really got there and don't want to make the time for it at the moment.</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Wed Feb 28 2024 07:03:45 GMT-0800 (Pacific Standard Time)">15:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@akaster:serenityos.org">akaster</span>&gt;</div></td><td class="msg-cell">And by issues I mean, I called fetch with "inside settings" as the client and it doesn't work well ðŸ˜…</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Wed Feb 28 2024 07:05:33 GMT-0800 (Pacific Standard Time)">15:05</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@annevk:matrix.org">annevk</span>&gt;</div></td><td class="msg-cell">I think ideally we'd rewrite most specs to call fetch from a JS thread (i.e., not from in parallel) and then have fetch snapshot state that it needs early on as well as keep a handle around in order to post tasks back (that may end up going nowhere due to race conditions). And then have a dedicated entry point for calling fetch from in parallel where you are responsible for handing fetch the correct state.</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Wed Feb 28 2024 07:06:28 GMT-0800 (Pacific Standard Time)">15:06</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@annevk:matrix.org">annevk</span>&gt;</div></td><td class="msg-cell">By-and-large things should be like this already, but there's certainly exceptions.</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Wed Feb 28 2024 07:11:48 GMT-0800 (Pacific Standard Time)">15:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@akaster:serenityos.org">akaster</span>&gt;</div></td><td class="msg-cell">So it sounds like there probably wouldn't be an issue with replacing the request's client with some record that has origin, URL, some policy flags, etc, as anything that needs to post tasks or events or generally do callbacks should be using the reserved client? Or should be handled through other hooks that are already in place. </td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Wed Feb 28 2024 07:11:57 GMT-0800 (Pacific Standard Time)">15:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@akaster:serenityos.org">akaster</span>&gt;</div></td><td class="msg-cell">At least, at the implementation level anyway </td></tr>

</tbody></table></div></div></div>
</body></html>
2022-02-01
[13:07:04.0207] <Ian Hickson>
anyone know if we ever defined what headers should not be included in subsequent requests after a cross-origin HTTP redirect?

[14:59:15.0612] <Domenic>
> <@hixie:matrix.org> anyone know if we ever defined what headers should not be included in subsequent requests after a cross-origin HTTP redirect?

I see nothing relevant in https://fetch.spec.whatwg.org/#http-redirect-fetch . This might fall into the still-underspecified https://fetch.spec.whatwg.org/#:~:text=Modify%20httpRequest%E2%80%99s%20header%20list%20per%20HTTP.

[15:27:35.0811] <Ian Hickson>
yeah i couldn't find anything either

[15:28:32.0358] <Ian Hickson>
context is we're trying to figure out how the Dart HttpClient should be updated, but so far it seems the list of headers to skip is just something we copy from Curl or Chrome...


2022-02-02
[02:11:12.0714] <sideshowbarker>
What’s the current best-practice way to programmatically detect if a document is in a frame?

[04:24:40.0876] <Noam Rosenthal>
> <@sideshowbarker:mozilla.org> What’s the current best-practice way to programmatically detect if a document is in a frame?

I guess https://developer.mozilla.org/en-US/docs/Web/API/Window/frameElement ?

[04:52:55.0574] <Noam Rosenthal>
(I usually do something like `window.parent !== window.self` but `frameElement` feels more like a best practice)

[06:23:59.0236] <sideshowbarker>
Noam Rosenthal: thanks much

[07:02:25.0946] <Domenic>
> <@hixie:matrix.org> anyone know if we ever defined what headers should not be included in subsequent requests after a cross-origin HTTP redirect?

Not sure how I missed this yesterday but a coworker pointed me to https://fetch.spec.whatwg.org/#http-redirect-fetch step 11. So basically remove https://fetch.spec.whatwg.org/#request-body-header-name

[08:51:47.0062] <smaug>
jgraham: in wpt, is there a way to test behavior when alert() pops up?

[08:51:55.0421] <smaug>
or basically, is there a way to close it?

[09:31:48.0426] <Noam Rosenthal>
smaug: seems like WebDriver has support for this, but it's not patched through to testdriver and not used in tests. Shouldn't be difficult to accomplish IMO. But maybe jgraham has more context (or others at #wpt:matrix.org)

[11:07:30.0365] <Ian Hickson>
> <@domenicdenicola:matrix.org> Not sure how I missed this yesterday but a coworker pointed me to https://fetch.spec.whatwg.org/#http-redirect-fetch step 11. So basically remove https://fetch.spec.whatwg.org/#request-body-header-name

oh interesting. but that doesn't include things like Set-Cookie and Authorization?

[11:08:10.0127] <Domenic>
Right so removing credentials is conditional on your credentials mode being "same-origin", let's find that...

[11:09:10.0189] <Domenic>
Those two are only conditionally included in step 20 of https://fetch.spec.whatwg.org/#concept-http-network-or-cache-fetch based on several pieces of input

[11:46:08.0641] <jgraham>
smaug, Noam Rosenthal I think the way that the wpt harness uses WebDriver makes it quite hard to test alert behaviour; that probabaly requires WebDriver-BiDi

[12:01:35.0565] <Ian Hickson>
> <@domenicdenicola:matrix.org> Those two are only conditionally included in step 20 of https://fetch.spec.whatwg.org/#concept-http-network-or-cache-fetch based on several pieces of input

i might just be rusty in my spec-fu but i have to say i can't really figure out how to point someone to this spec in a sufficiently clear way to explain what headers they should include when :-(
like, https://curl.se/docs/CVE-2018-1000007.html removes Authorization during a redirect, but is that all we should remove?


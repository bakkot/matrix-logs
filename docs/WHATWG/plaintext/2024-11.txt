2024-11-01
[07:52:48.0378] <smaug>
Anyone understands what "If these attributes are omitted from an element, then the language of this element is the same as the language of its parent element, if any (except for slot elements in a shadow tree)." in the spec means? slot elements are somehow special cased, but it doesn't explain how?


2024-11-03
[23:57:48.0609] <annevk>
That language is not for implementers. Maybe it got out of sync with the implementer requirements?

[23:58:10.0042] <annevk>
As for `moveBefore()` and focus, I thought we decided not to do that? Did something change?

[02:21:13.0457] <Noam Rosenthal>
> <@annevk:matrix.org> As for `moveBefore()` and focus, I thought we decided not to do that? Did something change?

Ryosuke brought this up originally and it was left open, I suggested an additional alternative here that I think satisfies all the cases.


2024-11-04
[00:42:24.0190] <annevk>
Domenic: FYI: https://github.com/whatwg/dom/issues/1321

[00:43:46.0096] <annevk>
Noam Rosenthal: I don't get the impression he feels strongly about it. One point that was raised is that `moveBefore()` won't be state-preserving for accessibility as layout will be impacted.

[00:48:02.0681] <Noam Rosenthal>
> <@annevk:matrix.org> Noam Rosenthal: I don't get the impression he feels strongly about it. One point that was raised is that `moveBefore()` won't be state-preserving for accessibility as layout will be impacted.

I don’t exactly understand the a11y thing. Changing style can affect layout regardless of DOM structure changes

[00:48:53.0136] <Noam Rosenthal>
Re firing the events - sounds good, let’s start without like we said at WHATNOT and we can revise based on community feedback.

[04:40:15.0563] <Andreas Kling>
Anyone with HTML parsing know-how able to tell me if I'm missing something here or if this template/foreignObject interaction indeed leads to bugs? :) https://github.com/whatwg/html/issues/10739

[04:51:39.0438] <freddy>
Question about fetch metadata. It appears that all of the cases where page1.example is a) redirecting to page2.example, b) opening page2.example in a popup, c) navigating to page2.example - They are all done with Fetch Metadata of {sec-fetch-dest: document, sec-fetch-mode: navigate, sec-fetch-site: cross-site}. I wonder if it would be useful to have different or additional metadata for popups as they will include an opener reference (which the other cases don't). -- I am already fully aware that COOP exists which can control the popup case (but not make the browser tell beforehand)

[04:58:58.0011] <annevk>
Noam Rosenthal: well, in that we preserve state in the DOM tree, but for the a11y tree it'll be the same as remove/insert.

[05:00:39.0169] <annevk>
freddy: there's a popup proposal in the Fetch Metadata repo, been there since forever

[05:00:54.0139] <annevk>
Andreas Kling: I'll have a look, but your best bet would be hsivonen or zcorpan I suspect

[05:01:57.0471] <freddy>
annevk: great minds think alike, huh

[05:04:55.0086] <hsivonen>
Andreas Kling: Likely a spec bug

[05:05:26.0991] <Noam Rosenthal>
> <@annevk:matrix.org> Noam Rosenthal: well, in that we preserve state in the DOM tree, but for the a11y tree it'll be the same as remove/insert.

Right. 

[05:09:15.0841] <annevk>
Andreas Kling: given that it checks for a template element on the stack of open elements, I'm inclined to think that's inclusive of a namespace and therefore it wouldn't find any element

[05:09:52.0982] <annevk>
Andreas Kling: as whenever the HTML specification talks about elements that's about a particular identity derived from local name and namespace

[05:10:13.0476] <annevk>
hsivonen: ^^

[05:11:16.0882] <hsivonen>
annevk: I recall there having been a bug on this theme previously. (Part of how the combination of the introduction of SVG on one hand and template on the other resulted in a bunch of bugs.)

[05:11:46.0413] <hsivonen>
annevk: But it's indeed possible that the spec language is defined in a way that implies the HTML namespace on the stack.

[05:34:18.0630] <Andreas Kling>
Ohhh, interesting! We've indeed implemented stack checks as "is this tag name present on the stack", but we're ignoring the namespace

[05:56:52.0356] <annevk>
I wonder if one could put something on the stack with a namespace prefix. I suspect not as the stack is controlled by the HTML parser.

[05:58:49.0446] <zcorpan>
> <@annevk:matrix.org> I wonder if one could put something on the stack with a namespace prefix. I suspect not as the stack is controlled by the HTML parser.

No. Though some attributes can have a namespace prefix

[06:02:05.0989] <zcorpan>
Hmm, the inconsistency in the spec with when namespaces are explicit isn't ideal. See https://html.spec.whatwg.org/#has-an-element-in-scope (and the next few "in foo scope" definitions)

[06:03:47.0804] <zcorpan>
Andreas Kling: https://html.spec.whatwg.org/#xml
> Except where otherwise stated, all elements defined or mentioned in this specification are in the HTML namespace ("http://www.w3.org/1999/xhtml"), and all attributes defined or mentioned in this specification have no namespace.


2024-11-05
[23:16:25.0790] <Sam Sneddon [:gsnedders]>
what in the HTML spec defines that `setTimeout(function(x){ alert(1) }, 10000); window.location = "about:blank"` won't actually create that alert after 10s? is this just step 1 of the in parallel section of https://html.spec.whatwg.org/multipage/timers-and-user-prompts.html#run-steps-after-a-timeout?

[23:17:24.0403] <annevk>
Sam Sneddon [:gsnedders]: I think the task will be associated with a document that's not fully active and thus will be skipped in the event loop processing model

[23:19:00.0712] <annevk>
Perhaps "cannot show simple dialogs" should also have a fully active check though. Not sure what happens if you run `alert()` on a window of a removed nested document.

[23:20:33.0149] <annevk>
https://software.hixie.ch/utilities/js/live-dom-viewer/saved/13247 suggests we should probably add that check.

[23:24:32.0219] <annevk>
Filed https://github.com/whatwg/html/issues/10742

[23:24:48.0775] <Sam Sneddon [:gsnedders]>
My actual context here, FWIW, is figuring out what should happen if you do WebDriver's `session.execute_async_script("setTimeout(arguments[0], 10000); window.location = 'about:blank'")`, and whether that is actually well-defined.

[23:25:23.0302] <Sam Sneddon [:gsnedders]>
Where most of my question is about whether it's well-defined whether setTimeout actually calls its handler.

[23:25:39.0722] <Sam Sneddon [:gsnedders]>
 * Thus my question here is mostly where it's defined where the handler is called.

[23:28:00.0215] <annevk>
Which handler?

[23:37:24.0770] <Sam Sneddon [:gsnedders]>
the TimerHandler (the first argument to `setTimeout`)

[23:39:05.0924] <annevk>
I think that's well-defined along the lines I said above, yes.

[01:20:40.0251] <zcorpan>
annevk: is the iteration order of the inclusive ancestors undefined in https://dom.spec.whatwg.org/#ref-for-concept-tree-inclusive-ancestor%E2%91%A1 ?

[08:48:04.0577] <TabAtkins>
Correct, there's no predefined order for inclusive ancestors, the spec needs to specify whether it's top-down or bottom-up

[10:02:21.0293] <annevk>
Yeah, that should say something about order.


2024-11-06
[04:56:12.0477] <zcorpan>
I filed an issue

[06:05:13.0949] <annevk>
Nice, anyone want to fix it? Good exercise if you're new to standards.


2024-11-07
[00:50:20.0343] <annevk>
Anyone here signed up for bsky.app? I'm @annevk.nl.

[01:29:48.0990] <zcorpan>
:target and text fragments only work for the first page load if the element or text is available before onload. If the content is created from a `fetch()` + script, that can happen after onload. Should we have an explicit API to delay the load event, or to go "try again now to hash-navigate" ?

[01:46:53.0758] <annevk>
Hmm, `fetch()` normally delays the `load` event as well I think, but of course not if you use it after it. Perhaps what you suggest is okay within some timeout, but it doesn't seem generally okay.

[02:19:00.0155] <sideshowbarker>
zcorpan: Given the following WPT test case:

```html
<img title="title" data-expectedlabel="title" alt="" data-testname="img with tooltip label with empty alt" class="ex" src="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==">
```
…and given the spec requirements at https://w3c.github.io/html-aam/#img-element-accessible-name-computation — specifically this requirement:
> *Otherwise use `alt` attribute, even if its value is the empty string.*
…then it seems that the expectation for that test should be the empty string.
But as you case, instead the expectation is `title` (from the `title` attribute value).
And https://wpt.fyi/results/accname/name/comp_tooltip.html shows that all engines pass that test.
So it seems like they’re all violating that _“use `alt` attribute, even if its value is the empty string”_ spec requirement.

[02:19:22.0610] <sideshowbarker>
 * zcorpan: Given the following WPT test case:

```html
<img title="title" data-expectedlabel="title" alt="" data-testname="img with tooltip label with empty alt" class="ex" src="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==">
```

…and given the spec requirements at https://w3c.github.io/html-aam/#img-element-accessible-name-computation — specifically this requirement:

> _Otherwise use `alt` attribute, even if its value is the empty string._

 …then it seems that the expectation for that test should be the empty string.
But as you case, instead the expectation is `title` (from the `title` attribute value).
And https://wpt.fyi/results/accname/name/comp\_tooltip.html shows that all engines pass that test.
So it seems like they’re all violating that _“use `alt` attribute, even if its value is the empty string”_ spec requirement.

[02:19:56.0103] <sideshowbarker>
Or else, is there something I’m misunderstanding?

[02:20:31.0924] <sideshowbarker>
 * zcorpan: Given the following WPT test case:

```html
<img title="title" data-expectedlabel="title" alt="" data-testname="img with tooltip label with empty alt" class="ex" src="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==">
```

…and given the spec requirements at https://w3c.github.io/html-aam/#img-element-accessible-name-computation — specifically this requirement:

> _Otherwise use `alt` attribute, even if its value is the empty string._

…then it seems that the expectation for that test should be the empty string.
But as you can ses, instead the expectation is `title` (from the `title` attribute value).
And https://wpt.fyi/results/accname/name/comp\_tooltip.html shows that all engines pass that test.
So it seems like they’re all violating that _“use `alt` attribute, even if its value is the empty string”_ spec requirement.

[02:20:39.0946] <sideshowbarker>
 * zcorpan: Given the following WPT test case:

```html
<img title="title" data-expectedlabel="title" alt="" data-testname="img with tooltip label with empty alt" class="ex" src="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==">
```

…and given the spec requirements at https://w3c.github.io/html-aam/#img-element-accessible-name-computation — specifically this requirement:

> _Otherwise use `alt` attribute, even if its value is the empty string._

…then it seems that the expectation for that test should be the empty string.
But as you can see, instead the expectation is `title` (from the `title` attribute value).
And https://wpt.fyi/results/accname/name/comp\_tooltip.html shows that all engines pass that test.
So it seems like they’re all violating that _“use `alt` attribute, even if its value is the empty string”_ spec requirement.

[02:31:04.0588] <Noam Rosenthal>
> <@zcorpan:mozilla.org> :target and text fragments only work for the first page load if the element or text is available before onload. If the content is created from a `fetch()` + script, that can happen after onload. Should we have an explicit API to delay the load event, or to go "try again now to hash-navigate" ?

Wouldn't this allow delaying the load event indefinitely and various similar footguns?

[02:57:51.0179] <annevk>
I think that's possible in theory already as the specification doesn't have network timeouts. But yeah, I'm not entirely convinced the load event is the correct primitive to build more upon.

[03:03:20.0892] <zcorpan>
Noam Rosenthal: yes

[03:03:37.0051] <zcorpan>
though the "try now" API doesn't

[03:04:07.0844] <zcorpan>
annevk: await res.json() doesn't delay

[03:05:10.0938] <sideshowbarker>
zcorpan: Ah wait I see: https://w3c.github.io/accname/#step2E says:
> E. Host Language Label: Otherwise, if the current node's native markup provides an attribute (e.g. alt) or element (e.g. HTML label or SVG title) that defines a text alternative, return that alternative in the form of a flat string as defined by the host language, **unless the element is marked as presentational (role="presentation" or role="none").**

…`<img alt="">` is `role="presentation"`

[03:08:02.0323] <zcorpan>
sideshowbarker: somewhat action at a distance

[03:09:17.0679] <zcorpan>
annevk: actually where does the spec say to delay the load event for `fetch()`?

[04:54:46.0592] <annevk>
zcorpan: it's prolly an open issue? At least I was under the impression that most fetches initiated before `load` fires end up delaying the `load` event, but maybe `fetch()` is somehow exempted?

[05:31:52.0110] <zcorpan>
annevk: I think https://searchfox.org/mozilla-central/search?q=symbol:_ZN7mozilla3dom8Document13UnblockOnloadEb&redirect=false is relevant for gecko. Includes e.g. fonts but not `fetch()` afaict

[05:49:49.0799] <Noam Rosenthal>
> <@annevk:matrix.org> zcorpan: it's prolly an open issue? At least I was under the impression that most fetches initiated before `load` fires end up delaying the `load` event, but maybe `fetch()` is somehow exempted?

In HTML this is explicitly specified for each operation that delays the load event, there's nothing general for fetches

[05:59:09.0736] <annevk>
Noam Rosenthal: I know, but I'm pretty sure we discovered holes in that model

[05:59:51.0900] <Noam Rosenthal>
> <@annevk:matrix.org> Noam Rosenthal: I know, but I'm pretty sure we discovered holes in that model

OK gotcha

[12:19:10.0246] <smaug>
jarhar: just looking at the patches... which one defines what select::picker(select) maps to?  

[13:13:46.0804] <jarhar>
are you talking about the chromium implementation? if so, this is it: https://chromium-review.googlesource.com/c/chromium/src/+/5817433

[13:26:26.0795] <Dominic Farolino>
annevk smaug: We didn't get to it on the WHATNOT agenda today, but we were hoping to discuss graduating `moveBefore()` to stage 3 — what do you think? I've marked the DOM PR as ready to review.

[13:27:28.0286] <smaug>
spec prs

[13:28:05.0990] <smaug>
Well, I look at the diff views, and the many prs are split to quite a few diffs 

[13:28:37.0002] <smaug>
From implementation point of view I need to still check session history handling, that is the most worrisome to me

[13:31:22.0920] <smaug>
Like if you have iframes, and you navigate all them multiple times. Now you reorder the iframe elements and load some more pages to them. Then load a new top level page in a way which doesn't put the first top level page to bfcache. Then go back to the first top level page. What gets loaded to which iframe?

[13:45:08.0757] <smaug>
Somewhat related to my ancient testcase http://mozilla.pettay.fi/moztests/history2/Start.html Chrome's behavior there is quite surprising, but at least it doesn't load the url to a wrong iframe anymore

[14:31:35.0807] <smaug>
Dominic Farolino: hmm, I thought removing mutation events would still block moveBefore. Though that shouldn't block moving to stage 3, only shipping.

[14:58:16.0771] <jarhar>
here is the css part https://github.com/w3c/csswg-drafts/pull/10865

[14:58:28.0515] <jarhar>
and here is the html part https://github.com/whatwg/html/pull/10629


2024-11-08
[16:26:40.0372] <Dominic Farolino>
smaug: I think mutation events were already removed: https://github.com/whatwg/html/pull/10573. But yes I agree, shouldn't block stage 3.

[16:27:34.0109] <smaug>
(Implementations haven't removed mutation events)

[16:28:49.0168] <smaug>
 * (Implementations haven't removed mutation events, https://github.com/whatwg/dom/issues/305#issuecomment-2306411923)

[18:58:57.0817] <sideshowbarker>
(for those who care about the document-conformance/authoring parts of the requirements in the spec) https://github.com/whatwg/html/pull/10752

[23:15:46.0286] <annevk>
push-api apparently allows (and enforces in certain cases) wrapping after an equals sign of an attribute. That's a new one.

[00:07:19.0684] <Sacha Greif>
hi all! I'm the main guy who runs the State of JS/CSS/etc. surveys. Always happy to get feedback to help make them more helpful for the community :)

[00:36:54.0430] <annevk>
keithamus: heya, I could make time today for https://github.com/whatwg/html/pull/9841, but I was wondering if you could squash all the commits and rebase on top of main as there are conflicts at the moment

[00:38:07.0035] <annevk>
keithamus: I also see some minor issues such as wrapping before a closing tag (`</code></dfn>`) and indentation beyond the start tag on the preceding line that you might want to tackle while doing that?

[00:40:38.0508] <annevk>
WPT PR is also out-of-date it seems

[00:40:51.0683] <keithamus>
annevk: sure, I’m just about to get on the road but in about an hour I’ll update both spec and wpt pr 

[03:04:25.0020] <annevk>
keithamus: oh I see that in August 27 I also expressed confusion as to how this event could work. That comment was never addressed.

[03:05:39.0168] <annevk>
I'm also once again confused at the compatibility story we ended up with around potentially changing the default of button type. Trying to find the relevant minutes...

[03:12:46.0535] <annevk>
Found it: https://github.com/whatwg/html/issues/10441

[03:13:41.0337] <annevk>
keithamus: so what I think I'm missing is changes to the `button` element `type` attribute reflection that take that into account

[03:14:24.0571] <annevk>
keithamus: in that we want the `type` getter to return `button` when the `button` element has `command` and `commandfor` attributes

[03:18:28.0443] <annevk>
It's a bit subtle as the `type` getter can mismatch with the actual state, but that seems okay-ish.

[03:23:23.0909] <keithamus>
Okay, apologies I thought we resolved the other way around. So we want the button to _not_ be a submit button if it has `command` or `commandfor`? It should be in the `button` state.

[03:25:20.0653] <annevk>
keithamus: I suspect the easiest way to do this is to introduce a Maybe Button state. The type getter would return "button" in that state. When associated with a form the button wouldn't work and when outside a form it would act like a button.

[03:25:46.0940] <annevk>
So I think behavior-wise it's pretty much what you have, except that it doesn't account for the `type` getter.

[03:26:55.0806] <ljharb>
so i could have a type submit that isn't a submit button? O.o that seems bad

[03:27:05.0427] <ljharb>
 * so i could have an explicit type submit that isn't a submit button? O.o that seems bad

[03:27:06.0777] <annevk>
And then I think there's the separate question of what should happen when type is set to submit or reset and you have these command/commandfor attributes. Perhaps in that case the command/commandfor attributes are to be ignored? Luke Warlow was looking at this for popover at some point.

[03:27:33.0567] <ljharb>
 * so i could have an explicit type submit that isn't a submit button? O.o that seems bad (when no `type` is provided, anything that lets it default to `button` is an improvement, defaulting to `submit` is painful)

[03:27:53.0302] <annevk>
ljharb: the problem is that `<button>` defaults to being a submit button, which is not necessarily great for new use cases.

[03:28:15.0935] <ljharb>
right - it's a very bad default, and when `type` is omitted, i think it's totally fine to quietly make it `button` when it has a new attribute

[03:28:34.0169] <ljharb>
but if i explicitly put `type="submit"` then violating that seems bad to me

[03:28:44.0003] <annevk>
Yeah agreed.

[03:29:40.0661] <ljharb>
(i just learned about command/commandFor recently, btw, and it seems very cool - is there a polyfill anywhere for its behavior?)

[03:30:23.0123] <annevk>
(The main reason why we're not defaulting to button inside a form immediately is because of backwards compatibility with browsers where it would submit the form. But five years from now or so we can change that as well.)

[03:30:49.0762] <keithamus>
> <@ljharb:matrix.org> (i just learned about command/commandFor recently, btw, and it seems very cool - is there a polyfill anywhere for its behavior?)

https://github.com/keithamus/invokers-polyfill is what I have so far

[03:34:47.0750] <keithamus>
> <@annevk:matrix.org> And then I think there's the separate question of what should happen when type is set to submit or reset and you have these command/commandfor attributes. Perhaps in that case the command/commandfor attributes are to be ignored? Luke Warlow was looking at this for popover at some point.

So I think if the button is explicit submit and has commandfor/command we should make it submit, ignore the command stuff, and browsers can log a warning to the console telling the user they've made a mistake

[03:35:02.0176] <keithamus>
The other choice is to not do either behaviour (submit nor command/commandfor)

[03:37:40.0600] <annevk>
Agreed, I just wrote that down in https://github.com/whatwg/html/issues/9625#issuecomment-2464496320

[03:45:17.0549] <keithamus>
annevk: how would I type the command attribute state? (Trying to address https://github.com/whatwg/html/pull/9841/files#r1834138912). It's not a string, I presume (it's an enum in the impls).

[03:46:34.0524] <annevk>
keithamus: in HTML it's a string, unless you introduced a concept that only contains the relevant string values, in which case you could use that concept, but I don't think that exists

[03:46:54.0038] <keithamus>
okay great I'll use a string

[03:47:02.0880] <annevk>
Oh wait, the state hmm

[03:47:15.0343] <annevk>
I was thinking the actual value

[03:48:17.0227] <annevk>
keithamus: hmm maybe it's easier to just pass in the element that has the attribute or some such

[03:48:39.0652] <keithamus>
oh yeah okay

[03:49:22.0673] <keithamus>
hmm... but an event is dispatched before the steps are called so referencing the element might be bad, it could change during the event phase...

[03:52:29.0108] <annevk>
keithamus: maybe just do state _state_ for now then. And don't talk about it being in a state, but being a state. "If command is the Close or Show Modal state, then return true."

[05:48:48.0202] <Noam Rosenthal>
Why would reordering them change anything spec-wise?

[05:49:34.0640] <Noam Rosenthal>
This seems like an implementation concern. I couldn't find anything in the spec that would be problematic because of this, and we've added pretty good test coverage for this type of scenario (though there could always be more)

[05:49:47.0863] <Noam Rosenthal>
Dominic Farolino did the iframe work though so perhaps I'm missing something.

[07:28:36.0749] <annevk>
Ms2ger: one thing that needs to be done for https://github.com/whatwg/html/pull/9893 is filling out OP. Having a clear proposed commit message there, ideally outlining some of the design, test strategy, impl bugs, MDN coverage, etc. goes a long way to making reviewing easier.

[07:29:01.0136] <Ms2ger>
Will do, thanks for the reminder

[07:34:17.0436] <annevk>
That also makes it scary, but I'll have another look anyway as it's been a long time.

[07:36:40.0052] <annevk>
Hmm, I remember we had a discussion before about renaming all the "concepts" to "principal concepts" not being great.

[07:52:50.0985] <annevk>
Ms2ger: hopefully I gave you a few things to look into. Overall this still looks good and I guess impl/TC39-wise it's more accepted now so maybe this can be done soonish modulo the massive number of needed PRs that it appears you all have signed up for...

[07:59:06.0334] <Noam Rosenthal>
> <@smaug:mozilla.org> (Implementations haven't removed mutation events)

It should be trivial to not fire them during moveBefore though, and they’re not in the spec  

[08:09:44.0292] <annevk>
(Oh and it seems that Shannon Booth from Ladybird also has some good ShadowRealm feedback.)

[08:14:15.0050] <Ms2ger>
Thanks again, I think :)

[11:30:03.0150] <Dominic Farolino>
There's nothing in the spec that's problematic regarding to this simply because the spec doesn't handle (at all) what we've referred to colloquially as the session history re-parenting issue — i.e., the case where upon going back to a non-bfcached page, the browser tries to reconcile the structure of the DOM with the structure of the nested session history, and load the latest nested session history items into the corresponding iframes.

[11:34:19.0773] <Dominic Farolino>
So first, that's bad in general. But I don't think it intersects too much with moveBefore(). moveBefore() doesn't change the order of the iframes from the perspective of the browser process, session history, or other iframes that can reach these iframes via proxies. That is, it doesn't re-order window.frames: https://source.chromium.org/chromium/chromium/src/+/main:third_party/blink/web_tests/external/wpt/dom/nodes/moveBefore/tentative/iframe-document-preserve.window.js;l=110-116;drc=0ba2bf02d3c2d6bf52c53012cdb5993b50ba82ed

[11:35:35.0564] <Dominic Farolino>
 * So first, that's bad in general. But I don't think it intersects too much with moveBefore(). moveBefore() doesn't change the order of the iframes from the perspective of the browser process, session history, or other iframes that can reach the moved iframes via proxies. That is, it doesn't re-order window.frames: https://source.chromium.org/chromium/chromium/src/+/main:third\_party/blink/web\_tests/external/wpt/dom/nodes/moveBefore/tentative/iframe-document-preserve.window.js;l=110-116;drc=0ba2bf02d3c2d6bf52c53012cdb5993b50ba82ed

[11:36:45.0251] <Dominic Farolino>
So I think navigating backwards to the non-bfcached top-level page should behave the same as it would be if said page did not use moveBefore() before it was navigated away.

[11:38:28.0042] <Dominic Farolino>
> <@smaug:mozilla.org> (Implementations haven't removed mutation events, https://github.com/whatwg/dom/issues/305#issuecomment-2306411923)

smaug: Implementations must disable mutation events when this API runs: https://github.com/web-platform-tests/wpt/blob/master/dom/nodes/moveBefore/tentative/mutation-events.html. We can't spec it because mutation events don't exist in DOM, but we've tested it. either way, yeah I don't think this blocks stage 3 or shipping.

[11:45:34.0781] <Dominic Farolino>
Domenic: I've looked but I can't find a bug tracking the iframe session history reparent/restoration problem. Do you know if one exists? This is the case where you navigate backwards to a top-level non-bfcached page with iframes, and try and reconcile the page's iframe structure with the nested iframe history structure, to load the latest iframe history entries in the page's iframes..

[11:45:36.0261] <smaug>
have you tested session history?

[11:46:02.0664] <smaug>
(you have 🙂 )

[11:46:33.0103] <smaug>
 * (you have 🙂 ,  or at least have thought about it)

[12:49:00.0463] <Noam Rosenthal>
smaug: both session history reparenting and mutation events are important/interesting things to consider for implementation but they're both also not in the HTML standard... given that I'm a bit confused about the level of expectations here in terms of spec/interop, apart from each implementation having internal tests to make sure things stay sane

[12:50:59.0977] <smaug>
session history is in HTML spec, and seems like moveBefore may change its behavior 

[12:52:18.0452] <Noam Rosenthal>
> <@smaug:mozilla.org> session history is in HTML spec, and seems like moveBefore may change its behavior

It doesn't though. As I said earlier, there are no places in the HTML spec that `moveBefore` changes. We have looked at it in pretty deeply... if you find a place where it does please be specific

[12:52:37.0192] <Noam Rosenthal>
> <@smaug:mozilla.org> session history is in HTML spec, and seems like moveBefore may change its behavior

 * It doesn't though. As I said earlier, there are no places in the HTML spec around session history that `moveBefore` changes. We have looked at it in pretty deeply... if you find a place where it does please be specific

[12:52:53.0848] <smaug>
Well, it may break the behavior, let's say so.

[12:54:19.0711] <Noam Rosenthal>
> <@smaug:mozilla.org> Well, it may break the behavior, let's say so.

Again, please be specific. The behavior that it might break that you've mentioned before around session history reparenting is not a standardized part of session history traversal AFAIK

[12:55:11.0964] <smaug>
Well, there hasn't been any need for "reparenting" before

[12:55:18.0375] <Noam Rosenthal>
We've tested that `moveBefore` doesn't reorder `window.frames`, and some of the places in the spec collect `navigables` in tree order

[12:55:20.0033] <smaug>
This is a new thing caused by moveBefore

[12:56:20.0930] <smaug>
Ok, and if you go back to a page which had iframes reordered, what gets restored to iframes?

[12:57:04.0494] <Noam Rosenthal>
No change from before I guess?

[12:58:28.0994] <Noam Rosenthal>
For this kind of bug to occur you need to save the tree order of navigables somehow separate from the tree order of frames and have them out of sync due to `moveBefore`. I can see how a bug like that might occur in implementation but not in the spec

[12:59:50.0599] <Noam Rosenthal>
(Again, this goes back to auto iframe-restore, which is a non-standard part of session history)

[13:01:49.0194] <Noam Rosenthal>
> <@smaug:mozilla.org> Ok, and if you go back to a page which had iframes reordered, what gets restored to iframes?

Basically what Dominic Farolino said here: https://matrix.to/#/!AGetWbsMpFPdSgUrbs:matrix.org/$rHZhhjwPPuncfjugC0qAqEA-krbyzprbnNf6LF7Vk9E?via=matrix.org&via=mozilla.org&via=igalia.com

[13:01:49.0666] <smaug>
ok, I guess if window.frames doesn't change, this might not be as big issue

[13:02:30.0967] <smaug>
oh, Element had hidden those messages well from me

[13:36:58.0332] <Dominic Farolino>
haha no worries. Yeah I understand the concern here, but I think from the perspective of things outside of the local DOM inside of the Document that experienced the moveBefore, nothing changes regarding child frame order, including in session history.

[15:02:11.0660] <sideshowbarker>
PSA: If your environment is macOS and you’re working on an HTML spec PR and when you try to run the `./build.sh` script and the build fails with an *“ld: library 'System' not found”* error (in the Rust part of the build), the run the build script like this:
```
PATH=/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/lib:$PATH \
LIBRARY_PATH="$LIBRARY_PATH:/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/lib \
./build.sh
```
…or else just export those `PATH` and `LIBRARY_PATH` settings to your environment (e.g., in your `~/.bashrc` or wherever).

[15:02:50.0649] <sideshowbarker>
 * PSA: If your environment is macOS and you’re working on an HTML spec PR and when you try to run the `./build.sh` script and the build fails with an _“ld: library 'System' not found”_ error (in the Rust part of the build), the run the build script like this:

```
PATH=/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/lib:$PATH \
LIBRARY_PATH="$LIBRARY_PATH:/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/lib" \
./build.sh
```

…or else just export those `PATH` and `LIBRARY_PATH` settings to your environment (e.g., in your `~/.bashrc` or wherever).


2024-11-09
[19:03:53.0945] <sideshowbarker>
PSA: PR to change all current `data-x="syntax-attributes"` usage (that is, the syntax for attribute declarations in markup) from *“attribute”* to *“attribute declaration”*. 

[19:04:00.0244] <sideshowbarker>
 * PSA: PR to change all current `data-x="syntax-attributes"` usage (that is, the syntax for attribute declarations in markup) from _“attribute”_ to _“attribute declaration”_. https://github.com/whatwg/html/pull/10756

[19:05:07.0911] <sideshowbarker>
 * PSA: If your environment is macOS and you’re working on an HTML spec PR and when you try to run the `./build.sh` script and the build fails with an _“ld: library 'System' not found”_ error (in the Rust part of the build), then (re)run the build script like this:

```
PATH=/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/lib:$PATH \
LIBRARY_PATH="$LIBRARY_PATH:/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/lib" \
./build.sh
```

…or else just export those `PATH` and `LIBRARY_PATH` settings to your environment (e.g., in your `~/.bashrc` or wherever).

[19:05:20.0538] <sideshowbarker>
 * PSA: If your environment is macOS and you’re working on an HTML spec PR and when you try to run the `./build.sh` script and the build fails with an _“ld: library 'System' not found”_ error (in the Rust part of the build), then (re)run the build script like this:

```
PATH=/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/lib:$PATH \
LIBRARY_PATH="$LIBRARY_PATH:/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/lib" \
./build.sh
```

…or else just export those `PATH` and `LIBRARY_PATH` settings to your environment (e.g., in your `~/.bashrc` or such).

[19:05:47.0432] <sideshowbarker>
 * PSA: If your environment is macOS and you’re working on an HTML spec PR and when you try to run the `./build.sh` script and the build fails with an _“ld: library 'System' not found”_ error (in the Rust part of the build), then to fix that problem, (re)run the build script like this:

```
PATH=/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/lib:$PATH \
LIBRARY_PATH="$LIBRARY_PATH:/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/lib" \
./build.sh
```

…or else just export those `PATH` and `LIBRARY_PATH` settings to your environment (e.g., in your `~/.bashrc` or such).

[19:06:03.0187] <sideshowbarker>
 * PSA: If your environment is macOS and you’re working on an HTML spec PR and when you try to run the `./build.sh` script, the build fails with an _“ld: library 'System' not found”_ error (in the Rust part of the build), then to fix that problem, (re)run the build script like this:

```
PATH=/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/lib:$PATH \
LIBRARY_PATH="$LIBRARY_PATH:/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/lib" \
./build.sh
```

…or else just export those `PATH` and `LIBRARY_PATH` settings to your environment (e.g., in your `~/.bashrc` or such).

[19:06:14.0256] <sideshowbarker>
 * PSA: If your environment is macOS and you’re working on an HTML spec PR and when you try to run the `./build.sh` script, the build fails with an _“ld: library 'System' not found”_ error (in the Rust part of the build) — then to fix that problem, (re)run the build script like this:

```
PATH=/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/lib:$PATH \
LIBRARY_PATH="$LIBRARY_PATH:/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/lib" \
./build.sh
```

…or else just export those `PATH` and `LIBRARY_PATH` settings to your environment (e.g., in your `~/.bashrc` or such).


2024-11-11
[01:25:43.0879] <She “Nadya” Nah>
@sideshowbarker:matrix.org 


2024-11-12
[09:06:10.0938] <Dominic Farolino>
Dumb question but `no-cors` requests never trigger preflights, right?

[09:12:34.0418] <Noam Rosenthal>
Right


2024-11-13
[22:36:08.0951] <annevk>
Possibly Private/Local Network Access changes this? Been a while since I looked.

[02:37:45.0891] <Noam Rosenthal>
Yes, there are special preflights for PNA: https://developer.chrome.com/blog/private-network-access-preflight#preflight_requests

[02:59:28.0706] <Jake Archibald>
annevk: Safari blocks http localhost iframes inside https pages. Chrome and Firefox don't. Given that localhost should be treated as secure, this seems like a bug. Am I missing something?

[03:00:58.0730] <Jake Archibald>
https://bumpy-repeated-cover.glitch.me/ - quick test page, but you'll need to run a local server on 8080 that contains `index2.html`

[03:09:33.0702] <annevk>
Jake Archibald: we currently don't enforce that localhost is localhost, that's something we need to fix still

[03:10:36.0598] <Jake Archibald>
annevk: Oh, so is `127.0.0.1` likely to work?

[03:12:30.0797] <Jake Archibald>
ah, no, that doesn't work either

[03:34:04.0527] <annevk>
Hmm, that does seem like something that might be easier to fix. Are you willing to file a bug for just that? (There already are some for localhost.)

[03:52:16.0412] <Jake Archibald>
From https://bugs.webkit.org/show_bug.cgi?id=171934#c96, it seems like it's a difference of opinion with webappsec. I added a couple of comments about our use-case

[05:31:12.0756] <annevk>
Oh right. I had forgotten about P/LNA. Makes sense. Although I wonder if P/LNA still contains localhost protection.

[06:38:03.0514] <Dominic Farolino>
So smaug annevk what do you we think about stage 3 for atomic move? I'm sure there are small things that will fall out during review, but I think generally we agree on the shape of the processing model?

[06:45:59.0143] <smaug>
I think it needs another round of reviews, given that there were some rather obvious issues still couple of days ago.

[06:46:50.0003] <Dominic Farolino>
smaug: One of the comments is waiting on your feedback I believe

[06:46:58.0315] <Dominic Farolino>
(range updates)

[06:48:00.0264] <smaug>
sure, the range/selection part. But things like not handling Shadowroot or having wrong assumptions how ranges work were a bit surprising

[06:48:16.0896] <Dominic Farolino>
How do you feel about https://github.com/whatwg/dom/pull/1307#discussion_r1838738862

[06:48:26.0125] <Dominic Farolino>
Right, I don't think stage 3 is "all bugs are fixed" heh

[06:48:26.0257] <smaug>
...which is why I'd prefer another round of reviews

[06:49:01.0084] <Dominic Farolino>
OK, I'd appreciate your thoughts on https://github.com/whatwg/dom/pull/1307#discussion_r1838738862: keeping the container preservation approach except for when we cross the shadow boundary

[06:49:38.0663] <Dominic Farolino>
Or do you feel pretty set on not doing nothing special for Ranges during moveBefore() (treating them like remove + insert instead)

[06:49:56.0757] <Dominic Farolino>
The downside of that is that we never preserve selection if the selection range's endpoints move around

[06:50:15.0989] <Dominic Farolino>
Not the end of the world, but "better" selection preservation feels nice

[06:51:12.0848] <smaug>
That is a bit tricky one. In case of implementation supporting multiple ranges in selection, or using live ranges for highlights, some ranges might survive the move, and some wouldn't

[06:51:19.0814] <smaug>
it might lead to a it surprising results

[06:53:10.0740] <smaug>
 * it might lead to a bit surprising results

[06:53:47.0094] <Dominic Farolino>
Do any implementations support multiple ranges that contribute to a selection? I don't think that's allowed: https://w3c.github.io/selection-api/#responding-to-dom-mutations:~:text=Each%20selection%20can%20be%20associated%20with%20a%20single%20range

[06:53:59.0058] <smaug>
Gecko supports multiple ranges

[06:54:29.0192] <smaug>
(and other implementers have every now and then said it would be nice to support)

[06:55:45.0154] <Dominic Farolino>
Hmm, that feels like something we could deal with it if were to become standardized. Until then, I guess it's an implementation-specific thing to work around. I'd hate to make a decision about moveBefore() because of non-standardized impl quirks that we can't think through because we don't have a spec.

[06:55:48.0317] <smaug>
But hightlight anyhow supports multiple ranges

[06:56:16.0414] <smaug>
So, whether or not selection supports multiple ranges isn't too relevant here.

[06:59:37.0717] <Dominic Farolino>
OK so your concern is that if we only preserved selection when it is entirely inside a moved container node, then some ranges in a highlight will get reset, and others will survive, right?

[07:00:14.0448] <Dominic Farolino>
 * OK so your concern is that if we only preserved selection when it is entirely inside a moved container node, then some ranges in a highlight will get reset (in the same way they do during `remove()`), and others will completely survive, right?

[07:00:17.0939] <smaug>
Right. And that would be quite surprising, I think.

[07:00:22.0103] <Dominic Farolino>
I.e., that would be surprising

[07:01:13.0139] <Dominic Farolino>
How about the more aggressive preservation tactic where we *always* try and preserve the range (by allowing its start/end containers to move via moveBefore) — unless the start/end get inverted, in which case we collapse the range

[07:01:40.0519] <Dominic Farolino>
I think that could still lead to some cases where some ranges survive and others get collapsed, but it feels a little more predictable since you know your start and end containers, maybe?

[07:02:01.0019] <Dominic Farolino>
(and start/end being inverted -> resulting in collapse feels pretty expected)

[07:02:04.0513] <smaug>
or if we move something across light/shadow trees...

[07:02:32.0373] <Dominic Farolino>
yeah... it does get complicated

[07:03:25.0540] <Dominic Farolino>
We could punt on this (don't handle Ranges specially during moveBefore()) until maybe users decide they care enough...

[07:05:50.0902] <smaug>
That might be easier for now. And if needed, add later some options to moveBefore. 

[07:07:34.0591] <Dominic Farolino>
I'd like to (& framework authors agree) avoid a bag of options for the API in the future if possible. So if we decide to change this in the future, I'd really try and shoot for just changing the behavior inside this API straight-up

[07:17:56.0917] <smaug>
That might be doable. One might be able to also provide some helper APIs for Range to move it around from one subtree to another (or in moveBefore case, re-initialize the old state after move).

[07:28:01.0222] <Noam Rosenthal>
We generally preserve element-specific state (frame window, focus, animation, dialog/fullscreen/popover), I think it makes sense to not automatically preserve state that depends on multiple elements, such as ranges, and design something separate for that, not necessarily as a node-specific API

[07:28:16.0443] <Noam Rosenthal>
 * We generally preserve element-specific state (frame window, focus, animation, dialog/fullscreen/popover), I think it makes sense to not automatically preserve state that depends on multiple elements, such as ranges, and design something separate for that later on if the need arises, not necessarily as a node-specific API

[07:28:45.0721] <annevk>
FWIW, I'm out this week (see Bluesky). I also have the feeling we're still not quite on the same wavelength with regards to when something is eligible for Stage 3. I think that warrants some further meta discussion as it would be good if we were all on the same page.

[07:29:53.0605] <Noam Rosenthal>
> <@noamr:matrix.org> We generally preserve element-specific state (frame window, focus, animation, dialog/fullscreen/popover), I think it makes sense to not automatically preserve state that depends on multiple elements, such as ranges, and design something separate for that later on if the need arises, not necessarily as a node-specific API

... though there is user experience value in doing our best to preserve selection, so I support revisiting this in the future 

[10:57:31.0134] <Andreu Botella>
Hey, the only cases where a custom element's lifecycle callbacks can be called with the reaction stack being empty are involving user editing, right?


2024-11-14
[17:50:40.0141] <Domenic>
That's the major one, but it's just a generic fallback which might be hit in other cases that are harder to remember. Adding some logging and browsing custom element-using sites might reveal more.


2024-11-15
[17:39:52.0581] <Sacha Greif>
Hi all! Just wanted to let you know the 2024 State of JS survey is now open: https://survey.devographics.com/en-US/survey/state-of-js/2024?source=whatwg

Also, I thought I'd ask since this is an issue that comes up every year: I'm always trying to broaden the surveys' audience to include more women, but so far I haven't found any reliable and scalable method. 

if anybody has suggestions (or maybe can recommend the right person or working group to ask about this) I'm all ears!

[23:19:40.0519] <annevk>
Domenic: for https://github.com/whatwg/html/pull/10728 where is the PR to rename the tests from tentative? And were the tests updated to rename invoker to source?

[23:54:41.0889] <Domenic>
> <@annevk:matrix.org> Domenic: for https://github.com/whatwg/html/pull/10728 where is the PR to rename the tests from tentative? And were the tests updated to rename invoker to source?

I don't know, sorry. I assumed the boxes were checked honestly.

[23:57:19.0660] <annevk>
Domenic: since you merged, I hope you'll follow up?

[23:57:40.0988] <Domenic>
Yes, if the tests are not fixed by Intent to Ship time, I'll be sure to stop the shipping.

[01:38:30.0734] <annevk>
I was hoping for a bit more. I think we should also get OP updated. Implementers are likely to look there for any information about the tests.

[05:47:11.0471] <zcorpan>
Hmm, I ran into https://bugs.webkit.org/show_bug.cgi?id=8735 for our new standards-positions page


2024-11-18
[01:36:20.0353] <sideshowbarker>
Wonder what/where’s might be the best place to get in touch with jwatt these days. I mean, some chat/messaging way, without resorting to e-mail. I want to ask him about svgwg.org domain stuff

[01:53:07.0774] <annevk>
Did you try @jwatt:mozilla.org?

[01:55:24.0422] <sideshowbarker>
> <@annevk:matrix.org> Did you try @jwatt:mozilla.org?

Perfect! And nope I hadn’t tried it but have just now DM’ed him there. Thanks much

[05:40:17.0269] <annevk>
Domenic: instead of `navigator.pushManager` should it be `window.pushManager` for https://github.com/w3c/push-api/pull/368? I vaguely recall some desire to deprecate the former, though `Navigator` also currently states

> They also serve as a generic global under which various APIs are located in this and other specifications.

so maybe I misremember?

[12:34:21.0109] <zcorpan>
What is the right action for the participant agreement check in https://github.com/whatwg/html/pull/10547 ? canadahonk was Mozilla employee when he authored it, but is not anymore.


2024-11-19
[16:09:41.0077] <Domenic>
> <@annevk:matrix.org> Domenic: instead of `navigator.pushManager` should it be `window.pushManager` for https://github.com/w3c/push-api/pull/368? I vaguely recall some desire to deprecate the former, though `Navigator` also currently states
> 
> > They also serve as a generic global under which various APIs are located in this and other specifications.
> 
> so maybe I misremember?

My opinion is encapsulated here: https://github.com/w3ctag/design-principles/issues/448#issuecomment-2219295220 . I don't know the full details of pushManager but I would guess it falls under my "Perhaps-borderline examples, but I think Navigator was the wrong choice: [...] OS APIs that are sufficiently abstracted over by a web standard (clipboard, virtualKeyboard)"

[16:10:08.0740] <Domenic>
I didn't realize we had that statement about `Navigator` in the spec. That's a bit unfortunate in my opinion.

[16:11:17.0655] <Domenic>
> <@zcorpan:mozilla.org> What is the right action for the participant agreement check in https://github.com/whatwg/html/pull/10547 ? canadahonk was Mozilla employee when he authored it, but is not anymore.

Umm I think we could technically merge with an override (i.e. a comment, maybe both on the PR and the commit itself, explaining the situation). If canadahonk was willing to sign as an individual though that would be nice.

[18:09:43.0893] <sideshowbarker>
annevk: FYI https://github.com/web-platform-tests/wpt/issues/49249

[02:59:33.0913] <annevk>
Domenic: pushManager is not established precedent just yet (it's only on ServiceWorkerRegistration to date). I can move it to Window for Declarative Web Push.

[03:04:03.0790] <annevk>
sideshowbarker: commented. Test seems correct, albeit confusing and not necessarily testing the intended thing. Although I guess it hit something in Ladybird / Chromium...

[04:21:12.0330] <freddy>
Domenic: What is my hope for https://github.com/whatwg/html/issues/8013 seeing some updates? :)

[06:41:13.0410] <Shannon Booth>
Hello! I have been trying to debug an issue in Ladybird's implementation of https://github.com/web-platform-tests/wpt/blob/master/url/data-uri-fragment.html

The issue in Ladybirds implementation is that the script is running `.matches(':target')` before the document has populated it's target element. I know of a way to 'fix' it, but I'm having trouble figuring out how the spec intends this to be done. From what I can gather, the entry point of this is maybe somewhere around here: https://html.spec.whatwg.org/multipage/browsing-the-web.html#scripts-may-run-for-the-newly-created-document 

But "try to scroll the fragment" won't guarantee that the target element is set before that script can be run. And if I am understanding navigables right, it wouldn't be a navigation to a fragment either which does have "scroll to the fragment" in it. Would anyone be able to point me to the right direction of how the spec achieves updating the target element before the script is able to query it?

[06:48:27.0554] <Shannon Booth>
There look to be some steps which delay the load event for certain stylesheets, but I couldn't spot any criteria which would be relevant there

[15:55:34.0802] <Kayla Beezy>
I need help deleting some storage space off my disk 


2024-11-20
[16:01:06.0434] <sideshowbarker>
Kayla Beezy: not here

[17:09:42.0567] <Domenic>
> <@fbraun:mozilla.org> Domenic: What is my hope for https://github.com/whatwg/html/issues/8013 seeing some updates? :)

Low, it's just a vague to-do documentation issue for someone to take up. Perhaps that someone could be you!

[18:18:05.0751] <Domenic>
I wonder if we should create a new name for "in parallel" (and keep the old one working ~forever): https://github.com/w3c-fedid/FedCM/pull/678#discussion_r1834999800

[23:07:10.0039] <Willane Tenório>
O

[23:19:39.0857] <freddy>
> <@domenicdenicola:matrix.org> Low, it's just a vague to-do documentation issue for someone to take up. Perhaps that someone could be you!

It is my understanding is that this popup change was a unilateral deprecation that remains Chrome-only. I don't this is a "to-do documentation issue", but rather a Chrome bug that may cause compat issues as long as it remains in this state.

[23:22:06.0235] <Domenic>
> <@fbraun:mozilla.org> It is my understanding is that this popup change was a unilateral deprecation that remains Chrome-only. I don't this is a "to-do documentation issue", but rather a Chrome bug that may cause compat issues as long as it remains in this state.

I agree this is a non-standardized Chrome feature. I am telling you nobody in Chrome is working on standardizing it.

[23:23:13.0603] <freddy>
Alright, thank you for the clarification.

[23:23:15.0346] <Domenic>
(or changing the implementation)

[06:29:10.0164] <Ms2ger>
sideshowbarker: do you know where I can catch dontcallmedom?

[09:30:30.0843] <warrenr>
Any Cashapp? Chime? Zelle? Btc? Usdt?Skrill? Apple Pay? Pay pal? Venmo? BOA? Wells Fargo? Join my channel
https://t.me/verifystimm7
https://t.me/verifystimm7
 Got any of these Chase? BOA? Wells Fargo? Navy federal? Capital one? Truist? Att &t? PNC? TD bank? Credit union? M&T bank? Santander bank? Northwest bank? Or any other local Bank JOIN THE CHANNEL NOW TO GET PAID Join the telegram channel✅

[12:55:08.0132] <sideshowbarker>
> <@ms2ger:igalia.com> sideshowbarker: do you know where I can catch dontcallmedom?

@dontcallmedom:matrix.org will work I think
or else on w3.org IRC: `/msg dom` from the #webrtc channel


2024-11-21
[17:12:10.0660] <sideshowbarker>
> <@ms2ger:igalia.com> sideshowbarker: do you know where I can catch dontcallmedom?

 * @dontcallmedom:matrix.org will work I think
or else on w3.org IRC: `/msg dom` from the `#webrtc` channel

[01:26:49.0329] <Ms2ger>
sideshowbarker: thanks - the chat window served as a great rubber duck so I don't even need to bother them now :)

[07:14:08.0030] <nicolo-ribaudo>
Hey question about the WHATWG process. I was trying to normatively reference a WHATWG spec in an Ecma spec, but Ecma is not super happy with the concept of living standards.
I know that there are "review draft snapshots" (e.g. https://fetch.spec.whatwg.org/review-drafts/2024-06/) that I am not expected to reference -- I wonder what happens after the 45 days period that companies have to opt-out from the IPR stuff. Does that snapshot get moved to somewhere as "approved"?

[07:15:54.0802] <sideshowbarker>
No, nothing more happens with those snapshots. No “approval” of them happens, very intentionally

[07:16:22.0526] <sideshowbarker>
Their sole purpose is to get the RF commitments on any substantive changes

[07:17:50.0118] <sideshowbarker>
I’m curious who exactly is not super happy with normatively referencing the actual specs

[07:17:58.0813] <sideshowbarker>
But maybe this is not the place to discuss that

[07:18:48.0911] <nicolo-ribaudo>
Ok thanks

[07:19:21.0560] <nicolo-ribaudo>
> <@sideshowbarker:matrix.org> But maybe this is not the place to discuss that

Yeah, but can get back once I understand exactly why we/they consider normative references to living standards to be a problem :)

[07:19:43.0304] <sideshowbarker>
OK  — but also, actually, I see now that what I wrote isn’t entirely accurate

[07:19:57.0450] <sideshowbarker>
I am certainly not the source of truth on this anyway

[07:20:19.0978] <sideshowbarker>
but you (and they) should read https://whatwg.org/working-mode in its entirety

[07:20:36.0702] <sideshowbarker>
> For cases where another standards organization wishes to ensure an anchor is permanently available in the canonical Living Standard, they may file a new issue requesting a permanent anchor and detailing the anchor(s) they would like preserved. See all current and past requests for anchor permanence. The editor can then discuss this request with the requestor; for example, if the editor was planning on making changes in the near future, maybe they would advise the requestor to hold off on linking to that anchor until the changes go through.

[07:20:53.0975] <sideshowbarker>
> Consumers who need to reference exactly what a Living Standard said at a given point in time, for example to document what they implemented from or to explain the history of the web platform, can use the commit snapshots functionality. Each Living Standard has a "Snapshot as of this commit" link that gives a frozen copy for such historical reference. The WHATWG will keep these snapshots available at their published URLs permanently. However, other standards organizations are discouraged from referencing these snapshots, as they generally contain contain known issues that have been fixed in the Living Standard, and can mislead implementers and web developers.

[07:21:22.0286] <sideshowbarker>
 * > Consumers who need to reference exactly what a Living Standard said at a given point in time, for example to document what they implemented from or to explain the history of the web platform, can use the commit snapshots functionality. Each Living Standard has a "Snapshot as of this commit" link that gives a frozen copy for such historical reference. The WHATWG will keep these snapshots available at their published URLs permanently. **However, other standards organizations are discouraged from referencing these snapshots, as they generally contain contain known issues that have been fixed in the Living Standard, and can mislead implementers and web developers.**

[07:22:02.0134] <nicolo-ribaudo>
Oh thanks, I'll share this :)

[07:25:52.0164] <sideshowbarker>
But one last thing: “snapshots” are a separate thing from “review drafts”. Snapshots are “commit snapshots” that get auto-generated/published for every push to the source repo.

[07:25:57.0055] <sideshowbarker>
for example, https://fetch.spec.whatwg.org/commit-snapshots/bdb452ef7847a6c394e6914ba13675537eea2180/

[07:27:34.0071] <sideshowbarker>
and those are not for RF-commitment/IPR purposes — instead they are what those paragraphs cited above are about

[07:28:02.0813] <sideshowbarker>
whereas “review drafts” are, e.g., https://fetch.spec.whatwg.org/review-drafts/2024-06/ that you cited earlier

[07:28:30.0590] <sideshowbarker>
https://whatwg.org/ipr-policy talks about what “review drafts” are for

[07:35:20.0034] <nicolo-ribaudo>
Thanks again :)

[09:55:38.0860] <Panos Astithas>
annevk: are you coming back?

[10:00:38.0081] <annevk>
Sorry no, I had a brief internet outage and now I have another meeting.


2024-11-22
[21:45:29.0454] <Domenic>
annevk: https://github.com/whatwg/html/pull/10770 is marked as WebKit supportive "based on comments on this PR", but it seems possible you were only wearing your editor hat; would you mind explicitly giving a thumbs-up here or there on behalf of WebKit?

[00:38:34.0335] <annevk>
Noam Rosenthal: Dominic Farolino: the thing I wanted to say during the call yesterday is that the bits that are shared between insert and move, and between remove and move, should be abstracted so we only have to maintain those algorithms in a single place as they are quite involved (especially the range mutations).

[00:40:20.0610] <annevk>
I guess there's now also some web developer feedback where they prefer `moveBefore()` to fallback to `insertBefore()` where it currently throws. I'm not enthusiastic about that idea as it prevents us from making move possible for more scenarios in the future and it also just seems to encapsulate too much magic. I'd be curious to hear what smaug and Domenic think about that idea, but I'd be inclined to say no.

[00:46:30.0370] <Domenic>
I agree, I feel like we settled that during TPAC. It's such a fragile design.

[00:54:38.0465] <annevk>
I'll double check with ntim on the popover PR btw.

[00:54:46.0223] <annevk>
 * I'll double check with ntim on the popover PR btw. (I suspect it's fine.)

[02:15:49.0949] <Noam Rosenthal>
> <@annevk:matrix.org> I guess there's now also some web developer feedback where they prefer `moveBefore()` to fallback to `insertBefore()` where it currently throws. I'm not enthusiastic about that idea as it prevents us from making move possible for more scenarios in the future and it also just seems to encapsulate too much magic. I'd be curious to hear what smaug and Domenic think about that idea, but I'd be inclined to say no.

Can you expand on "prevents us from making move possible for more scenarios in the future"? Is that relying on people putting `moveBefore` inside try/catch? Because that can't be guaranteed, people might make the `isConnected` checks etc. themselves.

[02:16:30.0324] <Noam Rosenthal>
> <@noamr:matrix.org> Can you expand on "prevents us from making move possible for more scenarios in the future"? Is that relying on people putting `moveBefore` inside try/catch? Because that can't be guaranteed, people might make the `isConnected` checks etc. themselves.

Nevertheless, I'm content with the design we went with, I think people got used to higher level APIs so introducing a new API that's low level and throws is a bit confusing. We should consider higher level variants in the future but starting with this seems like the right approach

[02:19:58.0524] <smaug>
I'm not keen on falling back to insertBefore.  

[03:34:21.0086] <annevk>
Noam Rosenthal: It doesn't rely on that. Though potentially it does somewhat rely on people not automatically falling back to insertBefore() and then relying on insertion and removal steps to run. I'm just saying that in the future perhaps we want to take on moves between connected documents and possibly also between connected and disconnected states. And it would be annoying to have to add new API at that point.

[06:29:10.0319] <Dominic Farolino>
I think I might be the only one here that would be OK with falling back to insertBefore(). The argument I find convincing is that if 99% of users of this API are going to be in some generic framework-like context, all they care about is literally getting the node from A -> B, and they see moveBefore() as a way to opportunistically do that atomically when possible. But either way they still want the node to end up "over there" somehow.

[06:29:29.0207] <Dominic Farolino>
I have to imagine the # of users that would actually jump ship and not do anything when moveBefore() currently throws is really small. I haven't heard developers say that's how they would use the API.

[06:29:46.0589] <Dominic Farolino>
That said, I am fine with the current design. I just think I'm more sympathetic to what I'm hearing from devs right now.

[06:32:32.0467] <Dominic Farolino>
Like, I understand the value of introducing a low-level single-purpose primitive. But if developers are definitely going to hold it like the higher-level DOM mutation APIs, maybe making this a low-level single-purpose API is trying to force a market fit that isn't there?

[06:33:36.0339] <Dominic Farolino>
> <@annevk:matrix.org> Noam Rosenthal: Dominic Farolino: the thing I wanted to say during the call yesterday is that the bits that are shared between insert and move, and between remove and move, should be abstracted so we only have to maintain those algorithms in a single place as they are quite involved (especially the range mutations).

(This seems nice! I'm mostly OOO today and will likely forget to do this so maybe this as a review comment would be useful. That, or a follow-up PR after moveBefore() lands)

[06:50:06.0710] <Noam Rosenthal>
> <@domfarolino:matrix.org> I think I might be the only one here that would be OK with falling back to insertBefore(). The argument I find convincing is that if 99% of users of this API are going to be in some generic framework-like context, all they care about is literally getting the node from A -> B, and they see moveBefore() as a way to opportunistically do that atomically when possible. But either way they still want the node to end up "over there" somehow.

I am also OK with falling back to `insertBefore`, ans also with what we've landed with, with a slight preference towards throwing. Though I do see both arguments.

[06:55:33.0567] <Dominic Farolino>
I just want to protect against us trying to land something that feels academically right, but isn't what fits into most practical consumers hands

[06:57:24.0734] <Noam Rosenthal>
I do agree that the argument for throwing are a bit handwavy and need to be somewhat more concrete to be convincing. "encapsulating too much magic", "fragile design", and future proofing are indeed in an academic realm

[06:57:48.0451] <Dominic Farolino>
I'd like to understand the "prevents us from making move possible for more scenarios in the future" argument more too. Maybe some concrete examples of what these future scenarios would be would help me get it. I guess this is just referring to relaxing the conditions in https://whatpr.org/dom/1307.html#concept-node-ensure-pre-move-validity?

[06:59:24.0512] <Dominic Farolino>
And I guess the argument is the future relaxation wouldn't be compatible if we don't throw _now_?

[07:02:31.0402] <annevk>
Did the TPAC discussion not capture this in enough detail? I'm a bit hesitant to elaborate on everything here again as I suspect it won't be the last time and even simple PR feedback was already likely to go missing if I didn't enumerate it elsewhere.

[07:07:38.0198] <Noam Rosenthal>
The TPAC discussion was mostly about retrofitting the existing function. 

[07:08:14.0004] <Noam Rosenthal>
which is a separate discussion, somewhat less controversial

[07:09:26.0475] <Noam Rosenthal>
The argument at TPAC for throwing was that move is inherently different from insert, and by providing a low level primitive we create predictability, allowing us to add higher level APIs in the future. 

[07:10:52.0298] <Noam Rosenthal>
Perhaps if the platform introduces `insertOrMoveBefore` (with a better name) soon enough/later people would be alright with having `moveBefore` the way it is... that's why I'm still inclined to go with the low level primitive first myself, be it not a strong preference


2024-11-23
[18:00:17.0310] <Domenic>
I would be more OK with having variable behavior if the name reflected that, like `insertOrMoveBefore`. I think making `moveBefore` sometimes insert, sometimes move, is bad.

[18:44:24.0021] <njbjm>
@shannonbooth:matrix.org 

[00:21:57.0761] <Noam Rosenthal>
> <@domenicdenicola:matrix.org> I would be more OK with having variable behavior if the name reflected that, like `insertOrMoveBefore`. I think making `moveBefore` sometimes insert, sometimes move, is bad.

Perhaps that's a way forward. That way if in the future we wanted to add some different behavior like moving iframes across documents and wanted `moveBefore` throwing to be a feature detecting mechanism, we could incorporate that into `moveBefore` and leave `insertOrMoveBefore` as something that just works

[02:21:16.0590] <Domenic>
Thoughts about this route:

- We should probably still have the primitive (that throws). I remain skeptical that people really will only use this in generic situations. I suspect some people will require the move behavior and it will be a logic error in their app if they get insert behavior.

- The name should actually be `moveOrInsertBefore` ("move" first) since it's move and falls back to insert.

[02:22:58.0572] <Domenic>
Alternate API surface (maybe already considered?): update all the methods to have a { moveBehavior: "insert"|"move"|"move-if-possible" } argument. (I don't love that name.) The default, unlike TAG suggestion, is "insert".

[03:07:07.0557] <Noam Rosenthal>
> <@domenicdenicola:matrix.org> Alternate API surface (maybe already considered?): update all the methods to have a { moveBehavior: "insert"|"move"|"move-if-possible" } argument. (I don't love that name.) The default, unlike TAG suggestion, is "insert".

I think the only methods that can benefit from this are replaceChild and appendChild

[03:08:11.0048] <Noam Rosenthal>
> <@domenicdenicola:matrix.org> Thoughts about this route:
> 
> - We should probably still have the primitive (that throws). I remain skeptical that people really will only use this in generic situations. I suspect some people will require the move behavior and it will be a logic error in their app if they get insert behavior.
> 
> - The name should actually be `moveOrInsertBefore` ("move" first) since it's move and falls back to insert.

I support this approach. If most of  Userland code is going to do this anyway we might as well have it from the get go. It’s ok to also have the raw function.

[13:24:24.0837] <sideshowbarker>
annevk: Did you see https://matrix.to/#/!AGetWbsMpFPdSgUrbs:matrix.org/$_HiM0poiNHUMxlJHZqWrv0yGL3A72AnWOI3Ntt0JOS8 from Shannon last week? https://matrixlogs.bakkot.com/WHATWG/2024-11-19#L7

[13:24:37.0071] <sideshowbarker>
 * annevk: Did you see https://matrix.to/#/!AGetWbsMpFPdSgUrbs:matrix.org/$\_HiM0poiNHUMxlJHZqWrv0yGL3A72AnWOI3Ntt0JOS8 last week? https://matrixlogs.bakkot.com/WHATWG/2024-11-19#L7

[13:52:27.0839] <sideshowbarker>
FYI for all: https://github.com/beuss-git/wpt-results-analyzer


2024-11-24
[04:35:17.0736] <annevk>
sideshowbarker: I did not. Shannon Booth: maybe scrolling should delay the load event? Not entirely sure, sorry.

[04:38:15.0714] <njbjm>
حسبي الله ونعمه الوكيل في كل هكر


2024-11-25
[02:07:09.0228] <Yoav Weiss>
Is there a room for bikeshed questions? I'm hitting linking errors in my setup and others don't and I'd love some help debugging it..

[02:59:46.0891] <annevk>
Noam Rosenthal: note that moving in and out of a disconnected node now works, right? So the DocumentFragment example seems wrong.

[03:00:04.0527] <Noam Rosenthal>
annevk: only disconnected->disconnected works

[03:00:28.0613] <annevk>
Yoav Weiss: I usually use this room. Tab is here. 😊

[03:00:54.0432] <Noam Rosenthal>
I mean we can fallback to insertion for disconnected->connected / connected->disconnected, but that would not be the "move steps", it would be "falling back to `insertBefore`" which is exactly what they're asking

[03:02:16.0775] <annevk>
Right. I guess we might never be able to support disconnected <> connected. But we might be able to support connected/disconnected <> other document connected/disconnected.

[03:02:56.0655] <Noam Rosenthal>
> <@annevk:matrix.org> Right. I guess we might never be able to support disconnected <> connected. But we might be able to support connected/disconnected <> other document connected/disconnected.

Right, in the future perhaps we'll be able to move cross-origin iframes across documents without reloading them, that would be neat

[03:06:59.0652] <Noam Rosenthal>
annevk: but this shouldn't preclude us from also having a `moveOrInsertBefore` version and/or something like a `canMove` function, don't you think?

[03:08:19.0792] <annevk>
I'm not really convinced by the people in that thread thus far. There's a lot of hyperbole and very little concrete arguments.

[03:13:55.0413] <Noam Rosenthal>
annevk:  I guess we can also fall back to insert when it's something that inherently doesn't have state, like comment nodes or processing instructions etc, then throwing would be just for disconnected<->connected and across documents

[03:17:45.0144] <annevk>
I think this method should treat all nodes the same as much as it can.

[03:19:47.0313] <annevk>
(And as far as I can tell it does.)

[03:19:59.0119] <Noam Rosenthal>
annevk: currently it only allows moving elements & document fragments, perhaps we can remove that restricition

[03:20:20.0582] <Noam Rosenthal>
annevk: since comments etc don't have "insertion steps" anyway it should just work spec-wise I think

[03:23:23.0744] <Noam Rosenthal>
As in we might not need this line: https://github.com/whatwg/dom/pull/1307/files#diff-30f698d9b4650514daf7a04de5e44eebf8feff1a30e0505f8eeaf06703b2777dR2679

[03:23:51.0556] <Noam Rosenthal>
 * As in we might not need this line: https://github.com/whatwg/dom/pull/1307/files#diff-30f698d9b4650514daf7a04de5e44eebf8feff1a30e0505f8eeaf06703b2777dR2685

[03:24:48.0518] <Noam Rosenthal>
Ah sorry, there is no such restriction, I was reading the parent vs. node thing wrong

[04:48:18.0200] <annevk>
Noam Rosenthal: yeah, the only restriction is on DocumentType and that seems reasonable as it's not really something we care to support beyond the bare necessity. And there's a restriction on the root element, but that makes sense. Though maybe the root element restriction should be lifted (by allowing parent to be a Document) so it falls out of other conditions.

[05:05:47.0750] <annevk>
It seems that `insertBefore()` only works if `Document` has no element children currently. So I think behavior-wise it's going to be identical.

[05:09:40.0208] <annevk>
Oh, but for non-elements it's not. Okay, leaving another comment.

[05:17:06.0955] <annevk>
That issue btw has seen 30 new comments in 3 days. That's a good way to get your feedback ignored. :/

[05:30:33.0484] <Noam Rosenthal>
> <@annevk:matrix.org> That issue btw has seen 30 new comments in 3 days. That's a good way to get your feedback ignored. :/

Yea several people trying to chime in to repeat the same point... not very helpful

[06:01:11.0765] <annevk>
Domenic: any latent thoughts on scoped custom element registries? Scoping for `innerHTML` and the like came up and it made me think that maybe decoupling from shadow roots could be nice. Would be interested to hear your thoughts. https://github.com/WICG/webcomponents/issues/1040#issuecomment-2498031090

[06:07:02.0559] <annevk>
Domenic: the other thing that irks me a bit about https://github.com/WICG/webcomponents/blob/gh-pages/proposals/Scoped-Custom-Element-Registries.md is importNode() and createElement[NS] on ShadowRoot. Import does not at all imply clone to me. And createElementNS doesn't seem needed? But maybe these should also be on CustomElementRegistry to begin with.

[06:11:19.0614] <Domenic>
I've been hoping to not have to think too hard about them, heh...

[07:47:15.0971] <annevk>
Ms2ger: nicolo-ribaudo: I think it would be useful if we had a WHATNOT call with a short presentation on ShadowRealm integration to get everyone on the same page. One thing you mentioned is that certain concepts are not applicable inside ShadowRealm, but couldn't someone just make the Image constructor available? I thought that was a thing.

[08:29:30.0193] <Ms2ger>
annevk: what's the schedule for those? 

[08:31:32.0371] <Ms2ger>
annevk: you can only pass functions and primitives, so (unless I've confused myself again), you could pass the Image constructor into the shadow realm, but if you then called (the wrapper for) that constructor, you'd get an exception because it returns an object

[08:48:10.0572] <annevk>
Ms2ger: I think the most useful one to present at is bi-weekly at 6PM Amsterdam/Berlin/Paris on Thursday, next week being the next one of those. There's also a 10AM and 12AM variant the latter of which I only attend when I'm in the US and the former of which sees quite a bit less attendance. The 10AM one is this Thursday and the other one is two weeks from now.

[08:49:22.0981] <annevk>
Ms2ger: so it would call it in the parent global first and then try to proxy the outcome? So there's no way the global could be something else? I guess that makes sense.

[08:51:36.0454] <Ms2ger>
I think so, yes

[08:54:12.0900] <Ms2ger>
annevk: so 5 Dec at 6pm, right? I'll see if someone can make that work

[09:06:35.0542] <annevk>
Ms2ger: yes and please tell Panos Astithas early next week if it's happening so we can reserve time

[11:44:04.0437] <akaster>
In this test case:
```
let xmlString = '<html><head></head><body><div></div><span></span></body></html>';
let root = (new DOMParser()).parseFromString(xmlString, 'text/xml').documentElement
let serialized = (new XMLSerializer()).serializeToString(root.ownerDocument);
// serialized == '<html><head/><body><div/><span/></body></html>'
```
Why is it incorrect to have the XHTML namespace on the html element? (i.e. `<html xmlns=\"http://www.w3.org/1999/xhtml\">`)

[12:13:26.0479] <akaster>
hm. maybe our patch to add that was in error anyway. doesn't fail any of our local tests to remove it 😅

[12:38:20.0821] <Yoav Weiss>
TabAtkins: hey! I'm hitting some weird issues with my local setup and the CSP spec, where I see 400+ linking errors. I think basically all the external refs are borked. Other folks and the GH bots don't see the same, so it's something about my setup. I'd appreciate some help with debugging it.. :D

[12:39:43.0843] <TabAtkins>
> <@yoavweiss:matrix.org> TabAtkins: hey! I'm hitting some weird issues with my local setup and the CSP spec, where I see 400+ linking errors. I think basically all the external refs are borked. Other folks and the GH bots don't see the same, so it's something about my setup. I'd appreciate some help with debugging it.. :D

You're on a (slightly) old Bikeshed - new enough to understand the new datafile file format, but old enough to not know about the change to that file format. (I'm still, uh, not handling datafile versions well.)

[12:52:25.0581] <Yoav Weiss>
TabAtkins: thanks! do I need to reinstall?

[12:52:50.0513] <TabAtkins>
`pip install --upgrade bikeshed` (or `pipx` if you used that, per the current instructions) will do

[12:55:08.0396] <Yoav Weiss>
TabAtkins: upgraded and I'm still seeing the linking errors..

[12:55:33.0456] <TabAtkins>
`bikeshed --version`?

[12:55:41.0319] <Yoav Weiss>
4.1.6

[12:55:52.0372] <Yoav Weiss>
Also, I'm getting this warning `/Users/yoavweiss/Library/Python/3.9/lib/python/site-packages/urllib3/__init__.py:34: NotOpenSSLWarning: urllib3 v2.0 only supports OpenSSL 1.1.1+, currently the 'ssl' module is compiled with 'LibreSSL 2.8.3'. See: https://github.com/urllib3/urllib3/issues/3020
`

[12:56:55.0332] <TabAtkins>
...huh, the most recent Bikeshed version is 4.2.7

[12:57:57.0859] <Yoav Weiss>
I'm trying to upgrade pip first..

[12:58:32.0999] <TabAtkins>
(Looks like 4.1.6 is back from March.)

[12:59:52.0999] <Yoav Weiss>
upgrading pip didn't help, now trying the pipx route

[13:00:02.0169] <TabAtkins>
uninstall from pip first, to be safe

[13:03:34.0415] <Yoav Weiss>
OK, so pip installed 4.2.7, but it's not the one I'm seeing when doing `which bikeshed`

[13:04:43.0306] <TabAtkins>
Then you're past the point I can help, because you've done something weird with your environment. Track down and delete whatever one your command line is using.

[13:05:01.0681] <TabAtkins>
(maybe you installed it from source at some point?)

[13:07:23.0679] <Yoav Weiss>
yeah, I'm trying to venv my way out of this

[13:07:54.0289] <Yoav Weiss>
I dunno what I did - I was young(er) and wanted to get something done

[13:08:00.0833] <Yoav Weiss>
thanks!!

[13:09:16.0109] <Yoav Weiss>
and venv saved the day! Thank you so much, TabAtkins ! :)

[13:10:03.0049] <TabAtkins>
Glad it's fixed. Part of why I recommend installing via pipx now is that it puts it in a venv for you. ^_^


2024-11-26
[19:26:05.0791] <Domenic>
> <@akaster:serenityos.org> hm. maybe our patch to add that was in error anyway. doesn't fail any of our local tests to remove it 😅

Did you see the big red box saying that there are lots of problems with the DOMParser / XMLSerializer specs? This one reminds me of one of them... https://github.com/w3c/DOM-Parsing/issues

[19:29:41.0695] <akaster>
None of the other engines produce a result with the xml ns applied. We just slapped that into our XML document parser while referencing https://html.spec.whatwg.org/multipage/infrastructure.html#xml

[19:30:43.0674] <akaster>
/     To ease migration from HTML to XML, user agents conforming to this specification will place elements in HTML
//     in the http://www.w3.org/1999/xhtml namespace, at least for the purposes of the DOM and CSS.
//     The term "HTML elements" refers to any element in that namespace, even in XML documents.

Basically asserting that the spec is telling us "any element placed in any XML or HTML document shall have the xhtml namespace"

[19:30:50.0688] <akaster>
which seems... unlikely to be the desired effect

[19:34:21.0311] <akaster>
There's a PR reverting that behavior that causes us to now pass https://github.com/web-platform-tests/wpt/blob/24c2e5fb6c/domparsing/XMLSerializer-serializeToString.html#L34 🤷‍♂️

[19:35:37.0424] <akaster>
https://github.com/LadybirdBrowser/ladybird/pull/2579/files#diff-607aaf214af29d5eaa606d04c2e53b4a0e931f713843fd158cf1f47a6f84d2cbL95

[19:50:39.0100] <akaster>
Oh I guess I missed this part on my read-through: "An XML parser, for the purposes of this specification, is a construct that follows the rules given in XML to map a string of bytes or characters into a Document object. NOTE: At the time of writing, no such rules actually exist"

... I guess we're purely in "wing it and run the tests" territory

[20:32:29.0472] <Domenic>
> <@akaster:serenityos.org> /     To ease migration from HTML to XML, user agents conforming to this specification will place elements in HTML
> //     in the http://www.w3.org/1999/xhtml namespace, at least for the purposes of the DOM and CSS.
> //     The term "HTML elements" refers to any element in that namespace, even in XML documents.
> 
> Basically asserting that the spec is telling us "any element placed in any XML or HTML document shall have the xhtml namespace"

Yeah that is not saying what you're thinking. That's just saying "we recognize that XML namespaces are, unfortunately, part of the web. Therefore, instead of completely ignoring them, https://html.spec.whatwg.org/#insert-an-html-element uses the XHTML namespace.

[20:33:14.0253] <Domenic>
You can kind of tell that because it says "will place" instead of "must place", it means "there's a normative requirement somewhere else".

[01:55:02.0293] <annevk>
keithamus: https://github.com/whatwg/html/pull/9841 still has a number of (hidden) unresolved conversations

[02:01:23.0995] <keithamus>
annevk: I've resolved a couple that I believe are outdated (namely one around linking "no state", an outdated one about the table enumeration, and one around event retargeting which I feel I addressed but didn't get a response on).


[02:02:09.0177] <keithamus>
That means a few are left:

 - Two comments from you about the retargeting, which we discussed yesterday (https://github.com/whatwg/html/pull/9841#discussion_r1732959104, https://github.com/whatwg/html/pull/9841#discussion_r1834134022). 
 - A comment about the `--` vs `-` (https://github.com/whatwg/html/pull/9841#discussion_r1834121434).
 - A comment from you about `DOMString` vs `DOMString` (https://github.com/whatwg/html/pull/9841#discussion_r1834130209).

Is that all of them or am I missing some?

[02:06:00.0674] <keithamus>
annevk: I just resolved all but the `--` vs `-` one, as I think they're addressed with the changes from yesterday. I _think_ the `--` vs `-` one is resolved, certainly feedback from OpenUI folks landed on `--` as an ergonomic preference. 

[02:07:06.0176] <keithamus>
In fact I'll resolve that too as you say in the comment you don't feel strongly and that we can relax it later if we see a need. I'd like to go ahead with `--` considering the feedback from OpenUI.

[02:21:53.0584] <annevk>
keithamus: I've seen more. It also seems the latest rebase wasn't proofread. There are concerning rebase artifacts in the commit.

[02:22:03.0735] <keithamus>
:( 

[02:28:41.0763] <nicolo-ribaudo>
I prefer 10AM this thursday because next week it conflicts with TC39, but I can adapt

[02:29:12.0410] <nicolo-ribaudo>
 * annevk Ms2ger 🇧🇪 
I prefer 10AM this Thursday because next week it conflicts with TC39, but I can adapt

[03:54:12.0788] <annevk>
akaster: when you parse XML and there's no namespace, you can't infer a namespace, not during parsing or serialization

[06:56:03.0503] <smaug>
I wonder if there could be some useful APIs to detect memory leaks, or give hints to devs about problematic patterns (like anti-AsyncContext 😉 ). Just debugging a youtube leak where iframe's window adds an event listener to window.top, and then iframe is removed from DOM. 

[06:57:47.0192] <annevk>
We should just make it harder and harder for windows to reach each other without postMessage().

[06:58:01.0575] <smaug>
that might be the best solution yes

[07:00:41.0018] <smaug>
There are also other common leaks, like the one Element has atm, where it accidentally keeps large disconnected subtrees around because of some DOM event kept alive by JS, and event's *target points to that subtree.

[07:11:09.0260] <Noam Rosenthal>
> <@smaug:mozilla.org> I wonder if there could be some useful APIs to detect memory leaks, or give hints to devs about problematic patterns (like anti-AsyncContext 😉 ). Just debugging a youtube leak where iframe's window adds an event listener to window.top, and then iframe is removed from DOM.

The WebPerf WG might be the right place for this; perhaps <brainstorming> marking some interfaces in WebIDL as being "short lived" and having some way to report this to the timeline/reporting API if they're held for a long time

[07:11:33.0840] <Noam Rosenthal>
> <@smaug:mozilla.org> I wonder if there could be some useful APIs to detect memory leaks, or give hints to devs about problematic patterns (like anti-AsyncContext 😉 ). Just debugging a youtube leak where iframe's window adds an event listener to window.top, and then iframe is removed from DOM.

 * The WebPerf WG might be an interesting place to incubate this; perhaps \<brainstorming> marking some interfaces in WebIDL as being "short lived" and having some way to report this to the timeline/reporting API if they're held for a long time

[07:12:55.0186] <smaug>
("short lived" smells like the annotation Gecko has ProbablyShortLivingWrapper 😉 though that is a GC optimization )

[07:13:07.0014] <smaug>
 * ("short lived" smells like the webidl annotation Gecko has ProbablyShortLivingWrapper 😉 though that is a GC optimization )

[07:13:24.0212] <smaug>
 * ("short lived" sounds like the webidl annotation Gecko has ProbablyShortLivingWrapper 😉 though that is a GC optimization )

[07:41:52.0268] <Ms2ger 🇧🇪>
annevk: Panos Astithas would that work as well?

[07:52:08.0815] <Panos Astithas>
I only attend this week's slot when I'm in Europe, so Anne or Domenic will arrange for it to be discussed.

[08:18:02.0172] <annevk>
smaug: for event listeners there was that proposal to have a signal to remove them on disconnect

[08:18:48.0422] <annevk>
Now having such a feature doesn't mean it'll get used, but maybe the larger frameworks can get it right at least

[08:23:29.0385] <Noam Rosenthal>
> <@annevk:matrix.org> Now having such a feature doesn't mean it'll get used, but maybe the larger frameworks can get it right at least

I'm sure some monitoring tools would be happy to provide insights about this given a platform API

[08:25:49.0576] <annevk>
Yeah that seems fine, especially if Domenic can attend as well.

[08:30:48.0715] <smaug>
In this youtube case the listener is added to a target which isn't disconnected.  And the Element case doesn't involve listeners.  In other words, there are lots of ways to leak, and leaks happen often.

[08:56:11.0933] <annevk>
Ah fair. Hard to guard against folks thinking objects are cheaper than they are. (Or perhaps not thinking about it very much at all.)

[09:14:56.0745] <Shannon Booth>
Hey Ms2ger 🇧🇪 (and please let me know if there is a better way I can ask questions about shadow realms!) - the next point which I'm running into with shadow realm integration is for high resolution time. Currently, that takes a global object so that it can access the relevant ESO to determine if cross-origin isolated. Clearly, that doesn't work for shadow realms as there is no ESO unless we go up to the principal.

This is needed by HTML spec for stuff like https://html.spec.whatwg.org/multipage/interaction.html#sticky-activation. Would HTML spec still be passing through global object with shadow realm introduction to solve this case?

[09:18:15.0734] <Shannon Booth>
And also DOM events type things, maybe that specific one isn't exposed, I didn't check

[09:24:55.0484] <annevk>
I hope sticky activation isn't exposed. I do think we might have to pass some kind of time resolution thing in for Temporal stuff.

[09:25:20.0828] <Shannon Booth>
Yeah, I shouldn't have used that example, the actual case I was running into is for DOM events

[09:25:55.0252] <Shannon Booth>
https://dom.spec.whatwg.org/#inner-event-creation-steps

[09:27:44.0546] <annevk>
Shannon Booth: I think we'd pass in the principal global object for this case, FWIW, but I haven't verified if this is actually specified properly in the PR.

[09:29:05.0479] <annevk>
For some of these it would arguably be nice if the ShadowRealm could configure things as well, such as being able to simulate a low resolution environment, but I think the idea is that eventually maybe ShadowRealm would get ways to configure certain host hooks, provided the technology is useful enough and gets enough traction.


2024-11-27
[00:48:41.0698] <Ms2ger 🇧🇪>
Shannon Booth: yeah, here is fine, thank you. I really appreciate all the edge cases you're catching

[00:55:32.0416] <Ms2ger 🇧🇪>
Shannon Booth: https://github.com/whatwg/dom/pull/1329

[00:59:14.0778] <Ms2ger 🇧🇪>
Domenic: could you confirm you can attend tomorrow?

[01:00:19.0400] <Domenic>
I'm planning on it, but I'm not involved in ShadowRealms really...

[02:21:08.0571] <Shannon Booth>
This does raise one question I do have for this  shadow realms.  Will the spec pass pass through a principal realm in _any_ case where it would be needed if that API were to be exposed, or will the spec only do it for cases where it would be exposed for shadow realms?

[02:44:34.0709] <Ms2ger 🇧🇪>
I don't follow the question

[02:48:56.0052] <Noam Rosenthal>
Ms2ger 🇧🇪, Shannon Booth specifically for high resolution time, I'd rather fix https://w3c.github.io/hr-time/#dfn-relative-high-resolution-time to go to the principal realm if this is a shadow realm rather than fix each caller to the timestamp functions

[02:50:17.0100] <Ms2ger 🇧🇪>
That would also be a reasonable approach, yeah

[02:50:34.0174] <Ms2ger 🇧🇪>
Any chance you want to make that PR? 😇

[02:50:52.0424] <Noam Rosenthal>
happy to review such PR

[02:51:25.0932] <Noam Rosenthal>
but taking on `ShadowRealm` PRs myself would fall under the "I'm already spread too thin" bucket

[02:52:56.0229] <Ms2ger 🇧🇪>
Understood

[03:30:55.0411] <Ms2ger 🇧🇪>
https://github.com/w3c/hr-time/pull/168

[05:20:52.0967] <freddy>
annevk: appreciate you doing a bit of triage on the sanitizer repo 🙏

[06:50:01.0191] <freddy>
Dominic Farolino: Noam Rosenthal anne is going to be up to 30 mins late

[07:00:50.0905] <freddy>
(and he apologizes! Sorry message poorly relayed while busy with 3 other things.)

[07:00:56.0252] <freddy>
 * (and he apologizes! Sorry... message poorly relayed while busy with 3 other things.)

[07:03:15.0793] <Dominic Farolino>
Not a problem!


2024-11-28
[00:08:38.0036] <freddy>
annevk: https://nastystereo.com/security/cross-site-post-without-content-type.html -- Uh, why are they posting this instead of reporting a bug with browsers? Is that a standards bug, a browser bug or both?

[00:09:49.0790] <freddy>
zcorpan (OOO 22 Nov): suggested forwarding this here. Copying his take from elsewhere:

https://fetch.spec.whatwg.org/#concept-bodyinit-extract
10. Switch on object:
Blob
Set source to object.
Set length to object’s size.
If object’s type attribute is not the empty byte sequence, set type to its value.
...
14. Return (body, type).
that is called from https://fetch.spec.whatwg.org/#ref-for-concept-bodyinit-extract%E2%91%A1
4. If type is non-null and https://webidl.spec.whatwg.org/#this’s https://fetch.spec.whatwg.org/#request-headers’s https://fetch.spec.whatwg.org/#concept-headers-header-list https://fetch.spec.whatwg.org/#header-list-contains `Content-Type`, then https://fetch.spec.whatwg.org/#concept-headers-append (`Content-Type`, type) to https://webidl.spec.whatwg.org/#this’s https://fetch.spec.whatwg.org/#request-headers.

I suppose that step could throw if type is null and there's no content-type header, and method is POST (or disallow no content-type for all methods?)

[00:10:01.0390] <freddy>
> XMLHttpRequest does the same (per spec). You can also use an ArrayBuffer or ArrayBufferView I think

[00:23:51.0785] <hsivonen>
Why does Chromium have a layer between its URL parser and the ICU4C IDNA code that introduces non-conforming behaviors? Given that Firefox and Safari work well enough without such a layer suggests that it's not absolutely necessary for Web compat for Chromium to second-guess ICU4C. https://wpt.fyi/results/url/IdnaTestV2.window.html?label=master&label=experimental&aligned&q=%2Furl%2FIdnaTestV2.window.html Now that UTS 46 has an IgnoreInvalidPunycode flag, some folks think that Chromium sets that flag and think that behaviors not actually covered by that flag are legitimate. annevk , might be worthwhile to resolve https://github.com/whatwg/url/issues/821 sooner than later. 

[00:45:28.0492] <annevk>
hsivonen: have you been able to verify "recent" UTS46 changes with regards to whether they are a net good? There's https://github.com/web-platform-tests/wpt/pull/48301 and the general Unicode 16.0 issue against URL. I probably need to look into it to see whether all the changes and now failing tests make sense. But we also can't land this now with Interop 2024 almost wrapping up...

With regards to that flag: I think Firefox and Safari are correct, but I also don't understand why it was introduced. I think it would be better if that flag was not there at all. But I guess while it is, we might as well explicitly set it to false and continue to complain to UTS46 authors on the side... (However, updating the URL standard to set it to false would require dealing with the tests situation I suspect or perhaps we could argue that part is covered by existing tests?)

[00:46:48.0948] <hsivonen>
> <@annevk:matrix.org> hsivonen: have you been able to verify "recent" UTS46 changes with regards to whether they are a net good? There's https://github.com/web-platform-tests/wpt/pull/48301 and the general Unicode 16.0 issue against URL. I probably need to look into it to see whether all the changes and now failing tests make sense. But we also can't land this now with Interop 2024 almost wrapping up...
> 
> With regards to that flag: I think Firefox and Safari are correct, but I also don't understand why it was introduced. I think it would be better if that flag was not there at all. But I guess while it is, we might as well explicitly set it to false and continue to complain to UTS46 authors on the side... (However, updating the URL standard to set it to false would require dealing with the tests situation I suspect or perhaps we could argue that part is covered by existing tests?)

I believe the recent changes are good, except IgnoreInvalidPunycode seems unnecessary and I don't understand why it got introduced.

[00:47:21.0025] <annevk>
That is nothing new? You need to check whether you actually got a Content-Type header.

[00:49:17.0976] <hsivonen>
Firefox implements Unicode 16.0 with IgnoreInvalidPunycode=false on the algorithm level but uses Unicode 15.1 data.

[00:49:41.0560] <hsivonen>
(Unicode 16.0 data is blocked on ICU4X 2.0, i.e. Real Soon Now.)

[00:49:47.0816] <annevk>
That's good to hear. So maybe we can just swap this in when the Interop 2024 frenzy is over early February (I suspect) and call it a day.

[00:53:05.0985] <freddy>
The CVEs they are quoting are not an indication that this is something to be fixed but rather something that sites need to watch out for?

[01:38:15.0523] <Maxim Vaarwel>
The custom element specification has [this wording](https://html.spec.whatwg.org/#custom-element-conformance):

> The element's attributes and children must not be inspected, **as in the non-upgrade case none will be present**, and relying on upgrades makes the element less usable.

What is meant by "non-upgrade case"? Can someone explain the sense of written?

[01:40:35.0960] <annevk>
Maxim Vaarwel: if you construct a custom element directly it's not upgraded

[01:42:52.0621] <Simon☀️>
I think he is asking what upgrading is.

[01:43:27.0576] <Simon☀️>
I'm not competent here but https://html.spec.whatwg.org/#custom-elements-upgrades-examples sounds like it is used for progessive enhancements. The definition of the process is here https://html.spec.whatwg.org/#upgrades 

[01:58:26.0613] <Maxim Vaarwel>
@annevk What do you mean by directly? And does customElements.define exist there?

[02:00:52.0062] <Ms2ger>
".. Given an ESO *settings*, get *settings*'s [relevant global object](https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global) .."

[02:01:00.0072] <Ms2ger>
/me mumbles about word salad

[02:01:24.0155] <Maxim Vaarwel>
I'm pretty good at custom elements (I think). My question is about the wording of the sentence, I don't quite get the gist of what "non-upgrade case" means.

[02:02:09.0351] <annevk>
Domenic: if you have time to read/skim through https://github.com/whatwg/html/pull/9841 I'd appreciate it. Very close to r+'ing but would like a second pair of eyes given the number of changes.

[02:02:25.0789] <Domenic>
Will try to get it in tomorrow

[02:05:59.0630] <annevk>
well if you do new MyCustomElement() or document.createElement("custom-element")

[02:06:49.0644] <Maxim Vaarwel>
> <@annevk:matrix.org> well if you do new MyCustomElement() or document.createElement("custom-element")

Is there customElements.define or not?

[02:07:45.0259] <annevk>
I dunno, but I very much doubt this is possible to change. And this has also been known forever.

[02:08:12.0882] <annevk>
I'm not sure what that means, but if you haven't registered your custom element there's no custom element.

[02:08:46.0292] <Luke Warlow>
Idk if Keith has done the aria PR to go along with it yet but if not I'll probably find some time this weekend to chuck something together.

[02:09:37.0119] <annevk>
Sigh, we really need an a11y/i18n checkbox in the PR template I think. I keep forgetting about it.

[02:09:53.0965] <annevk>
keithamus: ^^

[02:10:15.0582] <smaug>
annevk ah,the cors-safelist pr is about ensuring Last-Event-ID gets "CORS-unsafe request-header byte" check. (I wish remembered why "CORS-unsafe request-header byte " does what it does)

[02:10:37.0221] <Luke Warlow>
> <@annevk:matrix.org> Sigh, we really need an a11y/i18n checkbox in the PR template I think. I keep forgetting about it.

Yeah I think that's a good idea. Makes it easier to actively consider those sorts of dependency PRs

[02:15:53.0626] <Maxim Vaarwel>
> <@annevk:matrix.org> I'm not sure what that means, but if you haven't registered your custom element there's no custom element.

You wrote that directly it is document.createElement("custom-element"). I clarified: "is the element definition present via customElements.define"?

Okay, so the definition for the custom element is present.

That is, if I understand correctly, this describes the case when the definition for the custom element is present and we write document.createElement("custom-element") in the code as you specified. That is, this is what the note in "as in the non-upgrade case none will be present" says?

Right?

[02:16:26.0956] <Maxim Vaarwel>
> <@annevk:matrix.org> I'm not sure what that means, but if you haven't registered your custom element there's no custom element.

 * You wrote that directly it is `document.createElement("custom-element")`. I clarified: "is the element definition present via `customElements.define`"?

Okay, so the definition for the custom element is present.

That is, if I understand correctly, this describes the case when the definition for the custom element is present and we write `document.createElement("custom-element")` in the code as you specified. That is, this is what the note in "**as in the non-upgrade case none will be present**" says?

Right?

[02:21:50.0249] <annevk>
smaug: some servers were known to get compromised with certain byte values so we put restrictions on header value bytes without preflight

[02:22:30.0757] <smaug>
ah

[04:48:05.0924] <Dominic Farolino>
FWIW when scanning the commandfor PR, I found that clicking the new table of contents entry in https://whatpr.org/html/9841/dac8ec1...34e7de8/interaction.html seems to navigate you to a broken URL

[04:48:33.0108] <Dominic Farolino>
I guess this is some kind of PR preview issue, unless it's just happening to me

[04:48:57.0142] <Dominic Farolino>
 * FWIW when scanning the commandfor PR, I found that clicking the new table of contents entry in https://whatpr.org/html/9841/dac8ec1...34e7de8/interaction.html seems to navigate you to a broken absolute URL

[04:49:21.0572] <annevk>
It looks like the ToC uses URLs that are a bit too hardcoded for PR preview to work well

[04:49:43.0444] <annevk>
The fragment is correct and once landed it should work, but that's indeed annoying

[04:51:13.0911] <Dominic Farolino>
Right, I'm just trying to recall if this is new or if it's always been broken like this?

[04:51:21.0597] <annevk>
 * It looks like the ToC uses URLs that are a bit too absolute for PR preview to work well

[04:52:42.0989] <annevk>
I actually forgot what software generates multipage, but assuming it's Wattsi I think it's been broken for a while

[04:52:50.0199] <annevk>
 * I actually forgot what software generates multipage, but assuming it's Wattsi I think it's been broken for a while/forever

[04:53:42.0924] <sideshowbarker>
yeah multipage generation is all in Wattsi

[04:53:50.0638] <Domenic>
We really should fix PR preview to run the whole build server now that it exists

[04:53:54.0135] <Domenic>
It should not be hard

[04:54:43.0310] <Domenic>
Now that https://github.com/whatwg/build.whatwg.org?tab=readme-ov-file#html-build exists instead of just the `/wattsi` endpoint

[05:30:20.0998] <Maxim Vaarwel>
> <@annevk:matrix.org> Maxim Vaarwel: if you construct a custom element directly it's not upgraded

Excuse me, but what would be the **upgrade case** then?

[06:43:49.0327] <annevk>
That's what happens when you define after the element is created.

[06:44:45.0684] <annevk>
See also https://html.spec.whatwg.org/#custom-elements-upgrades-examples


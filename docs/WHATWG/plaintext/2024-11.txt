2024-11-01
[07:52:48.0378] <smaug>
Anyone understands what "If these attributes are omitted from an element, then the language of this element is the same as the language of its parent element, if any (except for slot elements in a shadow tree)." in the spec means? slot elements are somehow special cased, but it doesn't explain how?


2024-11-03
[23:57:48.0609] <annevk>
That language is not for implementers. Maybe it got out of sync with the implementer requirements?

[23:58:10.0042] <annevk>
As for `moveBefore()` and focus, I thought we decided not to do that? Did something change?

[02:21:13.0457] <Noam Rosenthal>
> <@annevk:matrix.org> As for `moveBefore()` and focus, I thought we decided not to do that? Did something change?

Ryosuke brought this up originally and it was left open, I suggested an additional alternative here that I think satisfies all the cases.


2024-11-04
[00:42:24.0190] <annevk>
Domenic: FYI: https://github.com/whatwg/dom/issues/1321

[00:43:46.0096] <annevk>
Noam Rosenthal: I don't get the impression he feels strongly about it. One point that was raised is that `moveBefore()` won't be state-preserving for accessibility as layout will be impacted.

[00:48:02.0681] <Noam Rosenthal>
> <@annevk:matrix.org> Noam Rosenthal: I don't get the impression he feels strongly about it. One point that was raised is that `moveBefore()` won't be state-preserving for accessibility as layout will be impacted.

I don’t exactly understand the a11y thing. Changing style can affect layout regardless of DOM structure changes

[00:48:53.0136] <Noam Rosenthal>
Re firing the events - sounds good, let’s start without like we said at WHATNOT and we can revise based on community feedback.

[04:40:15.0563] <Andreas Kling>
Anyone with HTML parsing know-how able to tell me if I'm missing something here or if this template/foreignObject interaction indeed leads to bugs? :) https://github.com/whatwg/html/issues/10739

[04:51:39.0438] <freddy>
Question about fetch metadata. It appears that all of the cases where page1.example is a) redirecting to page2.example, b) opening page2.example in a popup, c) navigating to page2.example - They are all done with Fetch Metadata of {sec-fetch-dest: document, sec-fetch-mode: navigate, sec-fetch-site: cross-site}. I wonder if it would be useful to have different or additional metadata for popups as they will include an opener reference (which the other cases don't). -- I am already fully aware that COOP exists which can control the popup case (but not make the browser tell beforehand)

[04:58:58.0011] <annevk>
Noam Rosenthal: well, in that we preserve state in the DOM tree, but for the a11y tree it'll be the same as remove/insert.

[05:00:39.0169] <annevk>
freddy: there's a popup proposal in the Fetch Metadata repo, been there since forever

[05:00:54.0139] <annevk>
Andreas Kling: I'll have a look, but your best bet would be hsivonen or zcorpan I suspect

[05:01:57.0471] <freddy>
annevk: great minds think alike, huh

[05:04:55.0086] <hsivonen>
Andreas Kling: Likely a spec bug

[05:05:26.0991] <Noam Rosenthal>
> <@annevk:matrix.org> Noam Rosenthal: well, in that we preserve state in the DOM tree, but for the a11y tree it'll be the same as remove/insert.

Right. 

[05:09:15.0841] <annevk>
Andreas Kling: given that it checks for a template element on the stack of open elements, I'm inclined to think that's inclusive of a namespace and therefore it wouldn't find any element

[05:09:52.0982] <annevk>
Andreas Kling: as whenever the HTML specification talks about elements that's about a particular identity derived from local name and namespace

[05:10:13.0476] <annevk>
hsivonen: ^^

[05:11:16.0882] <hsivonen>
annevk: I recall there having been a bug on this theme previously. (Part of how the combination of the introduction of SVG on one hand and template on the other resulted in a bunch of bugs.)

[05:11:46.0413] <hsivonen>
annevk: But it's indeed possible that the spec language is defined in a way that implies the HTML namespace on the stack.

[05:34:18.0630] <Andreas Kling>
Ohhh, interesting! We've indeed implemented stack checks as "is this tag name present on the stack", but we're ignoring the namespace

[05:56:52.0356] <annevk>
I wonder if one could put something on the stack with a namespace prefix. I suspect not as the stack is controlled by the HTML parser.

[05:58:49.0446] <zcorpan>
> <@annevk:matrix.org> I wonder if one could put something on the stack with a namespace prefix. I suspect not as the stack is controlled by the HTML parser.

No. Though some attributes can have a namespace prefix

[06:02:05.0989] <zcorpan>
Hmm, the inconsistency in the spec with when namespaces are explicit isn't ideal. See https://html.spec.whatwg.org/#has-an-element-in-scope (and the next few "in foo scope" definitions)

[06:03:47.0804] <zcorpan>
Andreas Kling: https://html.spec.whatwg.org/#xml
> Except where otherwise stated, all elements defined or mentioned in this specification are in the HTML namespace ("http://www.w3.org/1999/xhtml"), and all attributes defined or mentioned in this specification have no namespace.


2024-11-05
[23:16:25.0790] <Sam Sneddon [:gsnedders]>
what in the HTML spec defines that `setTimeout(function(x){ alert(1) }, 10000); window.location = "about:blank"` won't actually create that alert after 10s? is this just step 1 of the in parallel section of https://html.spec.whatwg.org/multipage/timers-and-user-prompts.html#run-steps-after-a-timeout?

[23:17:24.0403] <annevk>
Sam Sneddon [:gsnedders]: I think the task will be associated with a document that's not fully active and thus will be skipped in the event loop processing model

[23:19:00.0712] <annevk>
Perhaps "cannot show simple dialogs" should also have a fully active check though. Not sure what happens if you run `alert()` on a window of a removed nested document.

[23:20:33.0149] <annevk>
https://software.hixie.ch/utilities/js/live-dom-viewer/saved/13247 suggests we should probably add that check.

[23:24:32.0219] <annevk>
Filed https://github.com/whatwg/html/issues/10742

[23:24:48.0775] <Sam Sneddon [:gsnedders]>
My actual context here, FWIW, is figuring out what should happen if you do WebDriver's `session.execute_async_script("setTimeout(arguments[0], 10000); window.location = 'about:blank'")`, and whether that is actually well-defined.

[23:25:23.0302] <Sam Sneddon [:gsnedders]>
Where most of my question is about whether it's well-defined whether setTimeout actually calls its handler.

[23:25:39.0722] <Sam Sneddon [:gsnedders]>
 * Thus my question here is mostly where it's defined where the handler is called.

[23:28:00.0215] <annevk>
Which handler?

[23:37:24.0770] <Sam Sneddon [:gsnedders]>
the TimerHandler (the first argument to `setTimeout`)

[23:39:05.0924] <annevk>
I think that's well-defined along the lines I said above, yes.

[01:20:40.0251] <zcorpan>
annevk: is the iteration order of the inclusive ancestors undefined in https://dom.spec.whatwg.org/#ref-for-concept-tree-inclusive-ancestor%E2%91%A1 ?

[08:48:04.0577] <TabAtkins>
Correct, there's no predefined order for inclusive ancestors, the spec needs to specify whether it's top-down or bottom-up

[10:02:21.0293] <annevk>
Yeah, that should say something about order.


2024-11-06
[04:56:12.0477] <zcorpan>
I filed an issue

[06:05:13.0949] <annevk>
Nice, anyone want to fix it? Good exercise if you're new to standards.


2024-11-07
[00:50:20.0343] <annevk>
Anyone here signed up for bsky.app? I'm @annevk.nl.

[01:29:48.0990] <zcorpan>
:target and text fragments only work for the first page load if the element or text is available before onload. If the content is created from a `fetch()` + script, that can happen after onload. Should we have an explicit API to delay the load event, or to go "try again now to hash-navigate" ?

[01:46:53.0758] <annevk>
Hmm, `fetch()` normally delays the `load` event as well I think, but of course not if you use it after it. Perhaps what you suggest is okay within some timeout, but it doesn't seem generally okay.

[02:19:00.0155] <sideshowbarker>
zcorpan: Given the following WPT test case:

```html
<img title="title" data-expectedlabel="title" alt="" data-testname="img with tooltip label with empty alt" class="ex" src="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==">
```
…and given the spec requirements at https://w3c.github.io/html-aam/#img-element-accessible-name-computation — specifically this requirement:
> *Otherwise use `alt` attribute, even if its value is the empty string.*
…then it seems that the expectation for that test should be the empty string.
But as you case, instead the expectation is `title` (from the `title` attribute value).
And https://wpt.fyi/results/accname/name/comp_tooltip.html shows that all engines pass that test.
So it seems like they’re all violating that _“use `alt` attribute, even if its value is the empty string”_ spec requirement.

[02:19:22.0610] <sideshowbarker>
 * zcorpan: Given the following WPT test case:

```html
<img title="title" data-expectedlabel="title" alt="" data-testname="img with tooltip label with empty alt" class="ex" src="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==">
```

…and given the spec requirements at https://w3c.github.io/html-aam/#img-element-accessible-name-computation — specifically this requirement:

> _Otherwise use `alt` attribute, even if its value is the empty string._

 …then it seems that the expectation for that test should be the empty string.
But as you case, instead the expectation is `title` (from the `title` attribute value).
And https://wpt.fyi/results/accname/name/comp\_tooltip.html shows that all engines pass that test.
So it seems like they’re all violating that _“use `alt` attribute, even if its value is the empty string”_ spec requirement.

[02:19:56.0103] <sideshowbarker>
Or else, is there something I’m misunderstanding?

[02:20:31.0924] <sideshowbarker>
 * zcorpan: Given the following WPT test case:

```html
<img title="title" data-expectedlabel="title" alt="" data-testname="img with tooltip label with empty alt" class="ex" src="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==">
```

…and given the spec requirements at https://w3c.github.io/html-aam/#img-element-accessible-name-computation — specifically this requirement:

> _Otherwise use `alt` attribute, even if its value is the empty string._

…then it seems that the expectation for that test should be the empty string.
But as you can ses, instead the expectation is `title` (from the `title` attribute value).
And https://wpt.fyi/results/accname/name/comp\_tooltip.html shows that all engines pass that test.
So it seems like they’re all violating that _“use `alt` attribute, even if its value is the empty string”_ spec requirement.

[02:20:39.0946] <sideshowbarker>
 * zcorpan: Given the following WPT test case:

```html
<img title="title" data-expectedlabel="title" alt="" data-testname="img with tooltip label with empty alt" class="ex" src="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==">
```

…and given the spec requirements at https://w3c.github.io/html-aam/#img-element-accessible-name-computation — specifically this requirement:

> _Otherwise use `alt` attribute, even if its value is the empty string._

…then it seems that the expectation for that test should be the empty string.
But as you can see, instead the expectation is `title` (from the `title` attribute value).
And https://wpt.fyi/results/accname/name/comp\_tooltip.html shows that all engines pass that test.
So it seems like they’re all violating that _“use `alt` attribute, even if its value is the empty string”_ spec requirement.

[02:31:04.0588] <Noam Rosenthal>
> <@zcorpan:mozilla.org> :target and text fragments only work for the first page load if the element or text is available before onload. If the content is created from a `fetch()` + script, that can happen after onload. Should we have an explicit API to delay the load event, or to go "try again now to hash-navigate" ?

Wouldn't this allow delaying the load event indefinitely and various similar footguns?

[02:57:51.0179] <annevk>
I think that's possible in theory already as the specification doesn't have network timeouts. But yeah, I'm not entirely convinced the load event is the correct primitive to build more upon.

[03:03:20.0892] <zcorpan>
Noam Rosenthal: yes

[03:03:37.0051] <zcorpan>
though the "try now" API doesn't

[03:04:07.0844] <zcorpan>
annevk: await res.json() doesn't delay

[03:05:10.0938] <sideshowbarker>
zcorpan: Ah wait I see: https://w3c.github.io/accname/#step2E says:
> E. Host Language Label: Otherwise, if the current node's native markup provides an attribute (e.g. alt) or element (e.g. HTML label or SVG title) that defines a text alternative, return that alternative in the form of a flat string as defined by the host language, **unless the element is marked as presentational (role="presentation" or role="none").**

…`<img alt="">` is `role="presentation"`

[03:08:02.0323] <zcorpan>
sideshowbarker: somewhat action at a distance

[03:09:17.0679] <zcorpan>
annevk: actually where does the spec say to delay the load event for `fetch()`?

[04:54:46.0592] <annevk>
zcorpan: it's prolly an open issue? At least I was under the impression that most fetches initiated before `load` fires end up delaying the `load` event, but maybe `fetch()` is somehow exempted?

[05:31:52.0110] <zcorpan>
annevk: I think https://searchfox.org/mozilla-central/search?q=symbol:_ZN7mozilla3dom8Document13UnblockOnloadEb&redirect=false is relevant for gecko. Includes e.g. fonts but not `fetch()` afaict


<!DOCTYPE html><html><head>
  <title>WHATWG on 2024-03-13</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "WHATWG";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">WHATWG<br>2024-03-13<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2024-03-12" class="nav-link"><span>prev</span></a>
<span style="float:right">next</span>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">
<div class="rhs-header">
<span id="error" style="color: red; display:none">error</span>

<input type="text" id="query" size="25" placeholder="Search WHATWG">
<a id="search-submit" class="button icon-link" title="Search">
  <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"></path></svg>
</a>
</div>

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Tue Mar 12 2024 18:24:47 GMT-0700 (Pacific Daylight Time)">01:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-1" title="@domenicdenicola:matrix.org">Domenic</span>&gt;</div></td><td class="msg-cell">Seems like the sort of thing where if your concern was interop, step 1 would be an exhaustive test suite.</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Tue Mar 12 2024 18:29:26 GMT-0700 (Pacific Daylight Time)">01:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@sideshowbarker:matrix.org">sideshowbarker</span>&gt;</div></td><td class="msg-cell">I guess my biggest concern is whether we can maybe prevent other implementors from spending time evaluating that algorithm, if it‘s not actually important or useful for it to be actually be implemented as-is to the letter of the spec.</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Tue Mar 12 2024 18:29:45 GMT-0700 (Pacific Daylight Time)">01:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@sideshowbarker:matrix.org">sideshowbarker</span>&gt;</div></td><td class="msg-cell">It’s not clear to me at least what the algorithm is actually based on</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Tue Mar 12 2024 18:31:26 GMT-0700 (Pacific Daylight Time)">01:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@sideshowbarker:matrix.org">sideshowbarker</span>&gt;</div></td><td class="msg-cell">For example, was is written based on reading the double definition in the IEEE 754 spec and then attempting to put together an algorithm for parsing that? Or else was it written by looking at existing parsing code for double-parsing functions (<code>strtod</code> or whatever)?</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Tue Mar 12 2024 18:35:56 GMT-0700 (Pacific Daylight Time)">01:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@sideshowbarker:matrix.org">sideshowbarker</span>&gt;</div></td><td class="msg-cell"><p>I would personally be happy with us just adding a non-normative Note to the end or that algorithm, saying something like</p>
<blockquote>
<p><em>Note: In practice, rather than handcrafting an implementation of the above algorithm, most existing implementations use double-parsing functions from libraries such as <a href="https://github.com/google/double-conversion">double-conversion</a> and <a href="https://github.com/fastfloat/fast_float">fast_float</a>.</em></p>
</blockquote>
<p>…or whatever similar wording we might be able to get agreement on.</p>
</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Tue Mar 12 2024 18:46:00 GMT-0700 (Pacific Daylight Time)">01:46</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@sideshowbarker:matrix.org">sideshowbarker</span>&gt;</div></td><td class="msg-cell">I think it’s also worth noting that the ES spec doesn’t rely on the HTML floating-point algorithm for double parsing, and I think the CSS spec doesn’t either.

And so also worth noting that because of that, implementations do double-parsing in places in their code other than just for HTML attribute values — notably, in the JavaScript-handling sources, and in the CSS sources.

And so, in the engine sources, implementations have common/shared code for double-parsing that‘s called into from the HTML-attribute parsing code, and the JavaScript parsing code, and the CSS parsing code.

Given all that, it seems very unlikely that any engine over the long run is going to have a specific implementation of the HTML floating-point algorithm that’s separate from their shared double-parsing code. (I realize that Ladybird does now, but I think that’s likely to change eventually — for various reasons, maybe including performance.)</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Tue Mar 12 2024 18:53:39 GMT-0700 (Pacific Daylight Time)">01:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@sideshowbarker:matrix.org">sideshowbarker</span>&gt;</div></td><td class="msg-cell">I’m personally happy with the existing level of WPT coverage that we have for this — with <a href="https://github.com/web-platform-tests/wpt/pull/44355">https://github.com/web-platform-tests/wpt/pull/44355</a> now merged. What I’m less happy about is the effect it may have for causing implementors be unaware that existing engines don’t implement the algorithm as-is, and for causing implementors to potentially waste time.</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Tue Mar 12 2024 18:55:01 GMT-0700 (Pacific Daylight Time)">01:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-1" title="@domenicdenicola:matrix.org">Domenic</span>&gt;</div></td><td class="msg-cell">I mean, in general it's pretty rare to implement spec algorithms as-is, especially for low-level stuff like numbers and strings. <a href="https://infra.spec.whatwg.org/#algorithm-conformance">https://infra.spec.whatwg.org/#algorithm-conformance</a> and all that.</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Tue Mar 12 2024 18:58:04 GMT-0700 (Pacific Daylight Time)">01:58</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@sideshowbarker:matrix.org">sideshowbarker</span>&gt;</div></td><td class="msg-cell">True, but in most cases what’s implemented in engines is an algorithm that’s handcrafted to be a workalike that’s functionally equivalent to the spec algorithm — rather than instead being implemented by just calling some code in a third-party library that you don’t know actually fully conforms to the requirements in the spec as written.</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Tue Mar 12 2024 19:00:14 GMT-0700 (Pacific Daylight Time)">02:00</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@sideshowbarker:matrix.org">sideshowbarker</span>&gt;</div></td><td class="msg-cell">Anyway, I don’t mean to beat this into the ground and I’m not bringing it up to be pedantic about it — instead, I’m just wondering whether it’s a place where we might be able to save implementors some trouble by putting a little more information in the spec, even if just a non-normative note.</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Tue Mar 12 2024 19:00:38 GMT-0700 (Pacific Daylight Time)">02:00</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@sideshowbarker:matrix.org">sideshowbarker</span>&gt;</div></td><td class="msg-cell">And if so, I’d be very happy to raise a PR for it.</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Tue Mar 12 2024 19:01:56 GMT-0700 (Pacific Daylight Time)">02:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-1" title="@domenicdenicola:matrix.org">Domenic</span>&gt;</div></td><td class="msg-cell">I guess I'd personally like to hear if the implementers of the relevant parts of the browser were confused by the spec, or not. I guess we have one testimonial from yourself, but more would be helpful before concluding its a problem.</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Tue Mar 12 2024 19:05:06 GMT-0700 (Pacific Daylight Time)">02:05</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@sideshowbarker:matrix.org">sideshowbarker</span>&gt;</div></td><td class="msg-cell">Fair enough</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Wed Mar 13 2024 01:54:45 GMT-0700 (Pacific Daylight Time)">08:54</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@ms2ger:igalia.com">Ms2ger</span>&gt;</div></td><td class="msg-cell">I assume all the implementations besides Servo and Ladybird long predate the spec</td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Wed Mar 13 2024 01:55:14 GMT-0700 (Pacific Daylight Time)">08:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@sideshowbarker:matrix.org">sideshowbarker</span>&gt;</div></td><td class="msg-cell">yeah I reckon so</td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Wed Mar 13 2024 02:01:53 GMT-0700 (Pacific Daylight Time)">09:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@annevk:matrix.org">annevk</span>&gt;</div></td><td class="msg-cell">I think what is first- and third-party code can shift over time and it's not really the job of the specification to go into the weeds about that. If you find a library or function call that happens to match the requirements in the specification and passes all the tests, and is better in some measurable way over what you had before, more power to you. From what Jeffrey wrote about ISO C that at least doesn't match the spirit of the HTML language as it allows for less precision. HTML in theory also allows for that due to the overarching "limits may apply", but also encourages implementers to push those limits. I'm not sure a note would really help with this as it would have to go into the weeds as I have done here to properly convey all the nuances.</td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Wed Mar 13 2024 02:02:48 GMT-0700 (Pacific Daylight Time)">09:02</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@sideshowbarker:matrix.org">sideshowbarker</span>&gt;</div></td><td class="msg-cell">Yeah, as far as a note, I can imaging that it would be challenging to get the wording right</td></tr>
  <tr class="msg" id="L17"><td class="ts-cell"><a class="ts" href="#L17" alt="Wed Mar 13 2024 02:11:35 GMT-0700 (Pacific Daylight Time)">09:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@sideshowbarker:matrix.org">sideshowbarker</span>&gt;</div></td><td class="msg-cell"><p>Also by the way, I realize I misspoke a bit about something: While it’s true that the Blink and Gecko and WebKit use double-conversion or fast_float — they don’t _just _ use those. Instead they have to do preprocessing to skip ASCII whitespace —&nbsp;not Unicode whitespace, and specifically not U+000B, and <em>maybe</em> to skip/ignore any leading plus sign.</p>
<p>fast_float uses a <code>from_chars</code> implementation rather than <code>strtod</code> — and <code>from_chars</code> on its own per-spec doesn’t skip/ignore leading whitespace. The docs say it also doesn’t skip/ignore a leading plus sign, but it seems to me that maybe the fast_float <code>from_chars</code> at least actually does.</p>
<p>And I’m not sure if the double parser in double-conversion skips leading plus signs and whitespace —&nbsp;but if it <em>does</em> skip whitespace, it would do it for Unicode whitespace, not the ASCII whitespace subset.</p>
<p>So anyway, to conform to the HTML algorithm, engines using any third-party libraries would need to do preprocessing on the strings — to skip/ignore the right kind of whitespace and (possibly) the plus sign.</p>
</td></tr>
  <tr class="msg" id="L18"><td class="ts-cell"><a class="ts" href="#L18" alt="Wed Mar 13 2024 02:13:32 GMT-0700 (Pacific Daylight Time)">09:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@sideshowbarker:matrix.org">sideshowbarker</span>&gt;</div></td><td class="msg-cell">(and with that I’ll be quiet, and go back to trying to figure out how to correctly handle find-in-page for closed <code>details</code> that are nested…)</td></tr>
  <tr class="msg" id="L19"><td class="ts-cell"><a class="ts" href="#L19" alt="Wed Mar 13 2024 06:18:16 GMT-0700 (Pacific Daylight Time)">13:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-1" title="@domfarolino:matrix.org">Dominic Farolino</span>&gt;</div></td><td class="msg-cell">How does one "copy" or "clone" an infra struct? There are several definitions for "clone" in infra, but none specifically for structs. Can we just say "copy" or "clone" manually?</td></tr>
  <tr class="msg" id="L20"><td class="ts-cell"><a class="ts" href="#L20" alt="Wed Mar 13 2024 06:21:31 GMT-0700 (Pacific Daylight Time)">13:21</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@ms2ger:igalia.com">Ms2ger</span>&gt;</div></td><td class="msg-cell">I'd ask infra for a definition</td></tr>
  <tr class="msg" id="L21"><td class="ts-cell"><a class="ts" href="#L21" alt="Wed Mar 13 2024 06:23:43 GMT-0700 (Pacific Daylight Time)">13:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@annevk:matrix.org">annevk</span>&gt;</div></td><td class="msg-cell">Hmm, maybe URL.parse() should be added: <a href="https://twitter.com/kilianvalkhof/status/1765312128188088454">https://twitter.com/kilianvalkhof/status/1765312128188088454</a> (I disagree with the assertion there, but it seems reasonable to have a URL-or-null abstraction)</td></tr>
  <tr class="msg" id="L22"><td class="ts-cell"><a class="ts" href="#L22" alt="Wed Mar 13 2024 08:08:38 GMT-0700 (Pacific Daylight Time)">15:08</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@noamr:matrix.org">Noam Rosenthal</span>&gt;</div></td><td class="msg-cell"><span class="nick-1">Dominic Farolino</span>: usually you clone a struct manually. Often enough some special processing needs to be done on one or more of the items (e.g. if one of the items is a list, do you want to clone the list or pass it by reference?)</td></tr>
  <tr class="msg" id="L23"><td class="ts-cell"><a class="ts" href="#L23" alt="Wed Mar 13 2024 08:11:21 GMT-0700 (Pacific Daylight Time)">15:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@annevk:matrix.org">annevk</span>&gt;</div></td><td class="msg-cell">It seems reasonable to define a shallow clone for structs. We have that for lists and maps. Thus far nobody needed it for structs I guess. Should be a fairly straightforward PR.</td></tr>
  <tr class="msg" id="L24"><td class="ts-cell"><a class="ts" href="#L24" alt="Wed Mar 13 2024 08:36:03 GMT-0700 (Pacific Daylight Time)">15:36</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@tabatkins:matrix.org">TabAtkins</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> Hmm, maybe URL.parse() should be added: <a href="https://twitter.com/kilianvalkhof/status/1765312128188088454">https://twitter.com/kilianvalkhof/status/1765312128188088454</a> (I disagree with the assertion there, but it seems reasonable to have a URL-or-null abstraction)</blockquote></mx-reply>Yes, having to use a try block every time you want to parse a URL is indeed very frustrating. If we had an expression-level way to catch an error and return a value, it wouldn't be as big of an issue, but in the absence of JS having that, we absolutely should have a non-throwing way to parse a URL (returning null on failure, definitely).</td></tr>
  <tr class="msg" id="L25"><td class="ts-cell"><a class="ts" href="#L25" alt="Wed Mar 13 2024 08:41:11 GMT-0700 (Pacific Daylight Time)">15:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@annevk:matrix.org">annevk</span>&gt;</div></td><td class="msg-cell">Reopened <a href="https://github.com/whatwg/url/issues/372">https://github.com/whatwg/url/issues/372</a> cc <span class="nick-16">Adam Rice</span></td></tr>
  <tr class="msg" id="L26"><td class="ts-cell"><a class="ts" href="#L26" alt="Wed Mar 13 2024 08:57:48 GMT-0700 (Pacific Daylight Time)">15:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@jyasskin:matrix.org">Jeffrey Yasskin</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> I think it’s also worth noting that the ES spec doesn’t rely on the HTML floating-point algorithm for double parsing, and I think the CSS spec doesn’t either.<br><br>And so also worth noting that because of that, implementations do double-parsing in places in their code other than just for HTML attribute values — notably, in the JavaScript-handling sources, and in the CSS sources.<br><br>And so, in the engine sources, implementations have common/shared code for double-parsing that‘s called into from the HTML-attribute parsing code, and the JavaScript parsing code, and the CSS parsing code.<br><br>Given all that, it seems very unlikely that any engine over the long run is going to have a specific implementation of the HTML floating-point algorithm that’s separate from their shared double-parsing code. (I realize that Ladybird does now, but I think that’s likely to change eventually — for various reasons, maybe including performance.)</blockquote></mx-reply>FWIW, +1 to having a single double-parsing algorithm that all of ES, CSS, and HTML can use ... if that's web-compatible. See also <a href="https://github.com/whatwg/infra/issues/189">https://github.com/whatwg/infra/issues/189</a>.</td></tr>
  <tr class="msg" id="L27"><td class="ts-cell"><a class="ts" href="#L27" alt="Wed Mar 13 2024 08:59:41 GMT-0700 (Pacific Daylight Time)">15:59</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@annevk:matrix.org">annevk</span>&gt;</div></td><td class="msg-cell">I'm not sure we should share with ES until we know how the long term number types thing plays out. It came up before and the main reason not to do it was to preserve infinite precision, which seems like a worthwhile goal for a high-level language.</td></tr>
  <tr class="msg" id="L28"><td class="ts-cell"><a class="ts" href="#L28" alt="Wed Mar 13 2024 09:00:01 GMT-0700 (Pacific Daylight Time)">16:00</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@annevk:matrix.org">annevk</span>&gt;</div></td><td class="msg-cell">CSS &amp; HTML I can see though.</td></tr>
  <tr class="msg" id="L29"><td class="ts-cell"><a class="ts" href="#L29" alt="Wed Mar 13 2024 09:15:07 GMT-0700 (Pacific Daylight Time)">16:15</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@jyasskin:matrix.org">Jeffrey Yasskin</span>&gt;</div></td><td class="msg-cell">I don't feel strongly about the details, but we could explicitly divide the algorithm into 2 pieces: First we parse the string into an infinite-precision real number, which pins down syntax like whitespace and leading-plus behavior. Then we define the Real-&gt;IEEE 754 conversion, which establishes that 0 ULPs of error are allowed, and the round-to-even behavior. If ES wants to preserve infinite-precision arithmetic for a while after the string is parsed, that's fine; they just only call the first algorithm.</td></tr>
  <tr class="msg" id="L30"><td class="ts-cell"><a class="ts" href="#L30" alt="Wed Mar 13 2024 11:01:49 GMT-0700 (Pacific Daylight Time)">18:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-11" title="@judge_sour_dough_bread:matrix.org">judge_sour_dough_bread</span>&gt;</div></td><td class="msg-cell"><p>Hi all. The HTML spec says, under <a href="https://html.spec.whatwg.org/#custom-elements-api">§4.13.4, "The <code>CustomElementRegistry</code> interface"</a>, for the "Element definition" list of steps, specifically step 18:</p>
<blockquote>
<p>Let upgrade candidates be all elements that are shadow-including descendants of document, whose namespace is the HTML namespace and whose local name is localName, in shadow-including tree order. Additionally, if extends is non-null, only include elements whose is value is equal to name.</p>
</blockquote>
<p>This suggests that e.g. <code>define("foo-bar", class FooBarElement extends HTMLElement { /* ... */ })</code> (autonomous custom element) will <em>not</em> "upgrade" elements like<code>&lt;span is="foo-bar"&gt;&lt;!-- ... --&gt;&lt;/span&gt;</code> (<code>span</code> can be replaced with any other known HTML element for the sake of the example), correct? To explain how I have assumed this: the<code>name</code>for the element is<code>foo-bar</code>, after all (established at the outset of the aforementioned list of steps), while <code>localName</code> is same as<code>name</code> (step 5) since<code>extends</code> is null, and so only<code>&lt;foo-bar&gt;&lt;!-- ... --&gt;&lt;/foo-bar&gt;</code> element(s) in the document will be upgraded. Can someone tell me my reading of the spec is correct?</p>
</td></tr>

</tbody></table></div></div></div>
</body></html>
<!DOCTYPE html><html><head>
  <title>WHATWG on 2022-04-06</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "WHATWG";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">WHATWG<br>2022-04-06<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2022-04-05" class="nav-link"><span>prev</span></a>
<span style="float:right">next</span>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">
<div class="rhs-header">
<span id="error" style="color: red; display:none">error</span>

<input type="text" id="query" size="25" placeholder="Search WHATWG">
<a id="search-submit" class="button icon-link" title="Search">
  <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"></path></svg>
</a>
</div>

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Tue Apr 05 2022 23:35:57 GMT-0700 (Pacific Daylight Time)">06:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@annevk:mozilla.org">annevk</span>&gt;</div></td><td class="msg-cell">Yeah, the plan is to obsolete <code>embed</code>/<code>object</code>. <code>object</code> in particular has some capabilities that are unique to it still, but we're chipping away at those.</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Wed Apr 06 2022 01:02:51 GMT-0700 (Pacific Daylight Time)">08:02</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@annevk:mozilla.org">annevk</span>&gt;</div></td><td class="msg-cell">GitHub's "smart URL paste" continues to trip me up, I keep forgetting it's there and ending up with a result I don't want</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Wed Apr 06 2022 01:03:18 GMT-0700 (Pacific Daylight Time)">08:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@annevk:mozilla.org">annevk</span>&gt;</div></td><td class="msg-cell">And I kinda worry that if I learn it I'll expect it in other places and run into trouble there</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Wed Apr 06 2022 02:23:57 GMT-0700 (Pacific Daylight Time)">09:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@fbraun:mozilla.org">freddy</span>&gt;</div></td><td class="msg-cell">I'm looking for something that resets a whole document, including expando attributes etc. - I suppose I could emulate this by serializing+parsing the whole document or by cloning it. But, ideally, I'm looking for existing patterns for this "reset" or at least individual puzzle pieces. It seems to me that even the puzzle piece that removes "all" event handlers from an element seems to be a "no" already :/</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Wed Apr 06 2022 04:54:03 GMT-0700 (Pacific Daylight Time)">11:54</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@annevk:mozilla.org">annevk</span>&gt;</div></td><td class="msg-cell"><span class="nick-14">freddy</span>: "document open steps" does a bunch of that</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Wed Apr 06 2022 04:55:20 GMT-0700 (Pacific Daylight Time)">11:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@fbraun:mozilla.org">freddy</span>&gt;</div></td><td class="msg-cell">I <em>did</em> see <a href="https://html.spec.whatwg.org/multipage/dynamic-markup-insertion.html#opening-the-input-stream">https://html.spec.whatwg.org/multipage/dynamic-markup-insertion.html#opening-the-input-stream</a>, but it "replace the document with a new object" sounded to me as if the corresponding element-tree would be gone?!</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Wed Apr 06 2022 04:56:03 GMT-0700 (Pacific Daylight Time)">11:56</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@fbraun:mozilla.org">freddy</span>&gt;</div></td><td class="msg-cell">OK, I realize I only read the non-normative stuff (I feel bad now)</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Wed Apr 06 2022 04:57:36 GMT-0700 (Pacific Daylight Time)">11:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@annevk:mozilla.org">annevk</span>&gt;</div></td><td class="msg-cell"><span class="nick-14">freddy</span>: it definitely doesn't do sanitization though; for sanitize() I'm still curious what the actual envisioned usage patterns are</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Wed Apr 06 2022 04:58:13 GMT-0700 (Pacific Daylight Time)">11:58</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@annevk:mozilla.org">annevk</span>&gt;</div></td><td class="msg-cell">But we do have primitives such as "remove all listeners" in the platform, but they're not widely available</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Wed Apr 06 2022 04:59:41 GMT-0700 (Pacific Daylight Time)">11:59</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@fbraun:mozilla.org">freddy</span>&gt;</div></td><td class="msg-cell">Yeah, so the thing is that there's an apparent lack of "inside knowledge" from the sanitizer folks (freddy, otherdaniel, koto) about the potential state that could be attached to the document. The lack of knowledge lead to a security-conservative "we want it all gone" design goal. Similar to the other security-conservative choices we made (can't just a string-to-string API and hope for the best, can't parse a string with implicit/wrong context element, etc.).</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Wed Apr 06 2022 05:00:17 GMT-0700 (Pacific Daylight Time)">12:00</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@fbraun:mozilla.org">freddy</span>&gt;</div></td><td class="msg-cell">So, one ideas is that I'm trying to find out if there's an algorithm that would a) shine some light on the apparent lack of details and b) alleviate the concerns by being an existing thing.</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Wed Apr 06 2022 05:00:54 GMT-0700 (Pacific Daylight Time)">12:00</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@annevk:mozilla.org">annevk</span>&gt;</div></td><td class="msg-cell">Again though, what's the actual input here? If you start with a tree, don't you have to trust that tree already?</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Wed Apr 06 2022 05:01:08 GMT-0700 (Pacific Daylight Time)">12:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@fbraun:mozilla.org">freddy</span>&gt;</div></td><td class="msg-cell">On the other hand, I know that all other sanitizer libraries traverse a DOM tree based on the input (or parse it based on the input) and not even re-use those elements but create completely new ones and copy the bits over selectively. Which is a bit like a clone, but more... iterative</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Wed Apr 06 2022 05:01:56 GMT-0700 (Pacific Daylight Time)">12:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@fbraun:mozilla.org">freddy</span>&gt;</div></td><td class="msg-cell">No. You don't. E.g., <code>&lt;iframe sandbox="allow-same-origin" src="bad stuff&gt;</code> contains attacker-controlled stuff and you want to "promote" it into the current document, but need it to be sanitized first</td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Wed Apr 06 2022 05:02:13 GMT-0700 (Pacific Daylight Time)">12:02</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@fbraun:mozilla.org">freddy</span>&gt;</div></td><td class="msg-cell">so <code>sanitize(iframe.contentDocument)</code></td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Wed Apr 06 2022 05:03:50 GMT-0700 (Pacific Daylight Time)">12:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@fbraun:mozilla.org">freddy</span>&gt;</div></td><td class="msg-cell">OK, admittedly a <code>sandbox</code>ed iframe wouldn't have event listeners (because it doesnt script). But maybe your privilege-separation mechanism is <code>&lt;iframe sandbox="allow-script" src="some-sandbox-domain-for-user-content"&gt;</code> (google, github, mdn, bugzilla use those sandbox-domains <em>A LOT</em>). And if you'd want to promote that into a current document you wouldn't iframe it, but instead <code>XHR()</code> it and sanitize the returned <code>document</code></td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Wed Apr 06 2022 09:13:31 GMT-0700 (Pacific Daylight Time)">16:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@vrafaeli:matrix.org">vrafaeli</span>&gt;</div></td><td class="msg-cell"><p>Let me explain one thing that I'm concerned now. Imagine the following scenario.<br>You list through several PDFs, and in-between (when the loading happens for example) you don't want to show the document.</p>
<p>But I guess we don't want the iframe/embed/object to be removed from the DOM and then added again, cause that might cause performance penalty?<br>We can hide this HTML element using CSS I guess which is probably optimal.<br>One of the alternatives is to put "about:blank" in the "src" attribute. But then "iframe" will lose the type information because it doesn't have the "type" attribute.<br>So I'm concerned that in this alternative the browser's PDF engine will get "remounted" which might cause performance penalty?</p>
<p>(this is perhaps browser specific thing, but I'd appreciate your thoughts on this)</p>
</td></tr>
  <tr class="msg" id="L17"><td class="ts-cell"><a class="ts" href="#L17" alt="Wed Apr 06 2022 09:39:08 GMT-0700 (Pacific Daylight Time)">16:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@annevk:mozilla.org">annevk</span>&gt;</div></td><td class="msg-cell"><span class="nick-5">vrafaeli</span>: the only thing I know about performance is that you want to measure first</td></tr>
  <tr class="msg" id="L18"><td class="ts-cell"><a class="ts" href="#L18" alt="Wed Apr 06 2022 09:40:04 GMT-0700 (Pacific Daylight Time)">16:40</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@annevk:mozilla.org">annevk</span>&gt;</div></td><td class="msg-cell"><span class="nick-14">freddy</span>: how would you get iframe.contentDocument unless it's same-origin?</td></tr>

</tbody></table></div></div></div>
</body></html>
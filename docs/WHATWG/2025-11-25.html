<!DOCTYPE html><html><head>
  <meta charset="UTF-8">
  <title>WHATWG on 2025-11-25</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "WHATWG";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">WHATWG<br>2025-11-25<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2025-11-24" class="nav-link"><span>prev</span></a>
<span style="float:right">next</span>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">
<div class="rhs-header">
<span id="error" style="color: red; display:none">error</span>

<input type="text" id="query" size="25" placeholder="Search WHATWG">
<a id="search-submit" class="button icon-link" title="Search">
  <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"></path></svg>
</a>
</div>

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Tue Nov 25 2025 02:44:25 GMT-0800 (Pacific Standard Time)">10:44</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@jakea:matrix.org">Jake Archibald</span>&gt;</div></td><td class="msg-cell">There's still some discussion over how it should behave with script &amp; preloading <a href="https://github.com/whatwg/html/issues/11669#issuecomment-3550088089">https://github.com/whatwg/html/issues/11669#issuecomment-3550088089</a>. Do you think this blocks moving to stage 2? If not I'm fine with it and we can continue to discuss. <span class="nick-14">zcorpan</span> does this make sense with the stages model?</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Tue Nov 25 2025 03:10:32 GMT-0800 (Pacific Standard Time)">11:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@annevk:matrix.org">annevk</span>&gt;</div></td><td class="msg-cell"><span class="nick-12">foolip</span>: why doesn't it add runScripts to setHTMLUnsafe?</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Tue Nov 25 2025 03:13:35 GMT-0800 (Pacific Standard Time)">11:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@foolip:matrix.org">foolip</span>&gt;</div></td><td class="msg-cell"><span class="nick-12">annevk</span>: That's just an oversight. Do you think we should add <code>runScripts</code> to setHTMLUnsafe() independently (before) streamHTMLUnsafe(), or do it all in one PR?</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Tue Nov 25 2025 03:14:39 GMT-0800 (Pacific Standard Time)">11:14</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@annevk:matrix.org">annevk</span>&gt;</div></td><td class="msg-cell">I don't have a preference, except that <code>setHTMLUnsafe()</code> getting it later doesn't seem good.</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Tue Nov 25 2025 03:21:34 GMT-0800 (Pacific Standard Time)">11:21</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@foolip:matrix.org">foolip</span>&gt;</div></td><td class="msg-cell">Yeah, that wouldn't make sense</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Tue Nov 25 2025 03:21:44 GMT-0800 (Pacific Standard Time)">11:21</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@annevk:matrix.org">annevk</span>&gt;</div></td><td class="msg-cell">I left some other comments on the PR. Forgot to comment on <code>runScripts</code>. ðŸ˜…</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Tue Nov 25 2025 03:21:45 GMT-0800 (Pacific Standard Time)">11:21</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@foolip:matrix.org">foolip</span>&gt;</div></td><td class="msg-cell">I'll add it to the PR so that it's somewhere for now.</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Tue Nov 25 2025 03:27:04 GMT-0800 (Pacific Standard Time)">11:27</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@noamr:matrix.org">Noam Rosenthal</span>&gt;</div></td><td class="msg-cell">I'm not sure there is actually much of an issue there; we can tee those streams to use the speculative parser the same way it's done in the main parser. The mechanism of that is kind of loosely spec'ed to begin with though</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Tue Nov 25 2025 03:28:58 GMT-0800 (Pacific Standard Time)">11:28</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@jakea:matrix.org">Jake Archibald</span>&gt;</div></td><td class="msg-cell"><span class="nick-8">Noam Rosenthal</span>: ohh, I didn't realise that the buffering to allow scripts to run before adding the next element stuff had made it into the spec</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Tue Nov 25 2025 03:30:27 GMT-0800 (Pacific Standard Time)">11:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@noamr:matrix.org">Noam Rosenthal</span>&gt;</div></td><td class="msg-cell">It <em>sort of</em> did. The stream that goes into the parser is teed to the main parser and speculative parser, but a lot of details there are left to implementations. In either case, I checked it in the spec and streaming to an element doesn't have an effective change on this (though of course this needs to be properly tested).</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Tue Nov 25 2025 03:41:37 GMT-0800 (Pacific Standard Time)">11:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@jakea:matrix.org">Jake Archibald</span>&gt;</div></td><td class="msg-cell"><blockquote>
<p>but a lot of details there are left to implementations</p>
</blockquote>
<p>That soundsâ€¦ bad :D</p>
</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Tue Nov 25 2025 03:42:36 GMT-0800 (Pacific Standard Time)">11:42</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@jakea:matrix.org">Jake Archibald</span>&gt;</div></td><td class="msg-cell"><span class="nick-8">Noam Rosenthal</span>: I really think the stuff in <a href="https://github.com/whatwg/html/issues/11669#issuecomment-3537477657">https://github.com/whatwg/html/issues/11669#issuecomment-3537477657</a> should be interoperable</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Tue Nov 25 2025 03:47:15 GMT-0800 (Pacific Standard Time)">11:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@noamr:matrix.org">Noam Rosenthal</span>&gt;</div></td><td class="msg-cell"><em>That</em> stuff is interoperable. I meant that the speculative parsing behaviour might not be entirely interoperable.</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Tue Nov 25 2025 03:55:13 GMT-0800 (Pacific Standard Time)">11:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@jakea:matrix.org">Jake Archibald</span>&gt;</div></td><td class="msg-cell">oh yeah that's fine</td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Tue Nov 25 2025 04:03:46 GMT-0800 (Pacific Standard Time)">12:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@jakea:matrix.org">Jake Archibald</span>&gt;</div></td><td class="msg-cell"><span class="nick-8">Noam Rosenthal</span>: someone's asking "why contentname and not id", and I couldn't find the relevant discussion</td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Tue Nov 25 2025 04:03:52 GMT-0800 (Pacific Standard Time)">12:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@jakea:matrix.org">Jake Archibald</span>&gt;</div></td><td class="msg-cell"><a href="https://x.com/royalicing/status/1991714869012582584">https://x.com/royalicing/status/1991714869012582584</a></td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Tue Nov 25 2025 04:06:30 GMT-0800 (Pacific Standard Time)">12:06</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@foolip:matrix.org">foolip</span>&gt;</div></td><td class="msg-cell">Thanks for the feedback! I've addressed the simple stuff now. For the HTML fragment parsing algorithm refactor I'm concerned that the diff will be unreadable if I just do it. In the end there should be one algorithm, so maybe as a middle ground I could add "(streaming case)" markers to some steps to show exactly where the changes are instead of waving at them from the outside?</td></tr>
  <tr class="msg" id="L17"><td class="ts-cell"><a class="ts" href="#L17" alt="Tue Nov 25 2025 04:08:07 GMT-0800 (Pacific Standard Time)">12:08</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@annevk:matrix.org">annevk</span>&gt;</div></td><td class="msg-cell">I think you need to modify the core HTML parser as well, at least for some of the things we discussed. And ideally some of that is tidied up as it's all rather hand-wavy currently and adding this on top will make it even more fragile. So yeah, maybe do some refactoring first.</td></tr>
  <tr class="msg" id="L18"><td class="ts-cell"><a class="ts" href="#L18" alt="Tue Nov 25 2025 04:10:31 GMT-0800 (Pacific Standard Time)">12:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@noamr:matrix.org">Noam Rosenthal</span>&gt;</div></td><td class="msg-cell">It's an XSS mitigation, to avoid new streaming modifying markup that doesn't expect it. It was raised in the first WHATNOT about this and also by our security folks.
It was discussed here <a href="https://docs.google.com/document/d/1iaarr4Ho715CUULrvi_LD3TwshAcN2odDLBBEK0FjH0/edit?tab=t.0#heading=h.oh1h778cnny">https://docs.google.com/document/d/1iaarr4Ho715CUULrvi_LD3TwshAcN2odDLBBEK0FjH0/edit?tab=t.0#heading=h.oh1h778cnny</a> but the minutes are lacking/missing
</td></tr>
  <tr class="msg" id="L19"><td class="ts-cell"><a class="ts" href="#L19" alt="Tue Nov 25 2025 04:12:05 GMT-0800 (Pacific Standard Time)">12:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@noamr:matrix.org">Noam Rosenthal</span>&gt;</div></td><td class="msg-cell">... also, contentname is not meant to be document-unique like ID. it is resolved from the template's parent downwards (or for the whole document if the template is a direct child of the body)</td></tr>
  <tr class="msg" id="L20"><td class="ts-cell"><a class="ts" href="#L20" alt="Tue Nov 25 2025 05:53:15 GMT-0800 (Pacific Standard Time)">13:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@sb3nder:matrix.org">sb3nder</span>&gt;</div></td><td class="msg-cell"><span class="nick-8">bkardell</span>: Do you have any insight?</td></tr>
  <tr class="msg" id="L21"><td class="ts-cell"><a class="ts" href="#L21" alt="Tue Nov 25 2025 06:45:54 GMT-0800 (Pacific Standard Time)">14:45</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@foolip:matrix.org">foolip</span>&gt;</div></td><td class="msg-cell">For Sanitizer definitely, although I think that has to be a different PR. But also for <code>runScripts</code>, at least <a href="https://html.spec.whatwg.org/#parsing-main-inhead:already-started">https://html.spec.whatwg.org/#parsing-main-inhead:already-started</a> should be modified.</td></tr>
  <tr class="msg" id="L22"><td class="ts-cell"><a class="ts" href="#L22" alt="Tue Nov 25 2025 06:47:16 GMT-0800 (Pacific Standard Time)">14:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@foolip:matrix.org">foolip</span>&gt;</div></td><td class="msg-cell"><span class="nick-12">annevk</span>: but this really seems more like stage 3 ("Complete specification text") than stage 2 ("draft specification") to me, don't you think so?</td></tr>

</tbody></table></div></div></div>
</body></html>
<!DOCTYPE html><html><head>
  <meta charset="UTF-8">
  <title>WHATWG on 2025-09-24</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "WHATWG";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">WHATWG<br>2025-09-24<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2025-09-23" class="nav-link"><span>prev</span></a>
<span style="float:right">next</span>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">
<div class="rhs-header">
<span id="error" style="color: red; display:none">error</span>

<input type="text" id="query" size="25" placeholder="Search WHATWG">
<a id="search-submit" class="button icon-link" title="Search">
  <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"></path></svg>
</a>
</div>

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Tue Sep 23 2025 18:42:12 GMT-0700 (Pacific Daylight Time)">01:42</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-1" title="@domenicdenicola:matrix.org">Domenic</span>&gt;</div></td><td class="msg-cell">I tend to feel multiple methods is nicer. Minimizing the number of methods doesn't seem like an important goal to me.</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Wed Sep 24 2025 00:13:02 GMT-0700 (Pacific Daylight Time)">07:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@noamr:matrix.org">Noam Rosenthal</span>&gt;</div></td><td class="msg-cell">If we go all the way with multiple methods, it would be something like this:

setHTML
setHTMLUnsafe
streamHTML
streamHTMLUnsafe
htmlBefore
htmlBeforeUnsafe
streamHTMLBefore
streamHTMLBeforeUnsafe
appendHTML
appendHTMLUnsafe
streamAppendHTML
streamAppendHTMLUnsafe</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Wed Sep 24 2025 00:13:13 GMT-0700 (Pacific Daylight Time)">07:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@noamr:matrix.org">Noam Rosenthal</span>&gt;</div></td><td class="msg-cell">(not saying it as something good vs bad)</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Wed Sep 24 2025 00:46:13 GMT-0700 (Pacific Daylight Time)">07:46</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@noamr:matrix.org">Noam Rosenthal</span>&gt;</div></td><td class="msg-cell">Added this as an alternative in the OP</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Wed Sep 24 2025 02:41:26 GMT-0700 (Pacific Daylight Time)">09:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@lwarlow:igalia.com">Luke Warlow</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> I tend to feel multiple methods is nicer. Minimizing the number of methods doesn't seem like an important goal to me.</blockquote></mx-reply><p>I think minimising the number of legacy methods we create should be taken into account. .innerHTML had to be replaced for setHTMLUnsafe so it could take arguments. But if we have existing functions upgrading them rather than replacing would seem good.</p>
<p>Else we'll have a lot of widely used but at least partially duplicated methods.</p></td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Wed Sep 24 2025 02:48:08 GMT-0700 (Pacific Daylight Time)">09:48</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@lwarlow:igalia.com">Luke Warlow</span>&gt;</div></td><td class="msg-cell">Is it also worth considering stuff like <a href="https://developer.mozilla.org/en-US/docs/Web/API/HTMLIFrameElement/srcdoc">https://developer.mozilla.org/en-US/docs/Web/API/HTMLIFrameElement/srcdoc</a> that can't be sanitized yet.

There's also <a href="https://w3c.github.io/editing/docs/execCommand/#the-inserthtml-command">https://w3c.github.io/editing/docs/execCommand/#the-inserthtml-command</a> which can do a partial replacement.</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Wed Sep 24 2025 02:56:20 GMT-0700 (Pacific Daylight Time)">09:56</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-1" title="@domenicdenicola:matrix.org">Domenic</span>&gt;</div></td><td class="msg-cell">Why would we create legacy methods at all? Just create new non-legacy methods.</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Wed Sep 24 2025 03:03:10 GMT-0700 (Pacific Daylight Time)">10:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@lwarlow:igalia.com">Luke Warlow</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> Why would we create legacy methods at all? Just create new non-legacy methods.</blockquote></mx-reply>That's what I mean, if we create a new non-legacy method we're making the existing method legacy effectively.</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Wed Sep 24 2025 03:03:51 GMT-0700 (Pacific Daylight Time)">10:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@noamr:matrix.org">Noam Rosenthal</span>&gt;</div></td><td class="msg-cell">That would happen regardless of how many methods we're adding though</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Wed Sep 24 2025 03:04:28 GMT-0700 (Pacific Daylight Time)">10:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-1" title="@domenicdenicola:matrix.org">Domenic</span>&gt;</div></td><td class="msg-cell">Oh I see. I don't personally think that's a great idea, since the existing functions are pretty messy.</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Wed Sep 24 2025 03:04:31 GMT-0700 (Pacific Daylight Time)">10:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@lwarlow:igalia.com">Luke Warlow</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> That would happen regardless of how many methods we're adding though</blockquote></mx-reply>Well it depends, if we could make insertAdjacentHTML behave better that would be less new ones right?</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Wed Sep 24 2025 03:05:18 GMT-0700 (Pacific Daylight Time)">10:05</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@lwarlow:igalia.com">Luke Warlow</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> Oh I see. I don't personally think that's a great idea, since the existing functions are pretty messy.</blockquote></mx-reply><p>Yeah that is fair, it might be that it just isn't doable.</p>
<p>Just think it's worth considering and maybe noting that as a deliberate decision</p></td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Wed Sep 24 2025 03:06:55 GMT-0700 (Pacific Daylight Time)">10:06</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@noamr:matrix.org">Noam Rosenthal</span>&gt;</div></td><td class="msg-cell">There's a lot of discussio nabout this in <a href="https://github.com/whatwg/html/issues/10122">https://github.com/whatwg/html/issues/10122</a></td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Wed Sep 24 2025 03:07:19 GMT-0700 (Pacific Daylight Time)">10:07</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@noamr:matrix.org">Noam Rosenthal</span>&gt;</div></td><td class="msg-cell">(insertAdjacentHTML is the only thing that's being "deprecated", as innerHTML is already kind of deprecated by setHTML and setHTMLUnsafe)</td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Wed Sep 24 2025 03:07:52 GMT-0700 (Pacific Daylight Time)">10:07</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@lwarlow:igalia.com">Luke Warlow</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> <p>Is it also worth considering stuff like <a href="https://developer.mozilla.org/en-US/docs/Web/API/HTMLIFrameElement/srcdoc">https://developer.mozilla.org/en-US/docs/Web/API/HTMLIFrameElement/srcdoc</a> that can't be sanitized yet.</p>
<p>There's also <a href="https://w3c.github.io/editing/docs/execCommand/#the-inserthtml-command">https://w3c.github.io/editing/docs/execCommand/#the-inserthtml-command</a> which can do a partial replacement.</p></blockquote></mx-reply>And I guess execCommand is already the wild west.</td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Wed Sep 24 2025 03:08:14 GMT-0700 (Pacific Daylight Time)">10:08</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@noamr:matrix.org">Noam Rosenthal</span>&gt;</div></td><td class="msg-cell">execCommand hooks into createContextualFragment</td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Wed Sep 24 2025 03:09:06 GMT-0700 (Pacific Daylight Time)">10:09</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@noamr:matrix.org">Noam Rosenthal</span>&gt;</div></td><td class="msg-cell">which I guess is also <em>kind of</em> deprecated by setHTML</td></tr>
  <tr class="msg" id="L17"><td class="ts-cell"><a class="ts" href="#L17" alt="Wed Sep 24 2025 03:09:24 GMT-0700 (Pacific Daylight Time)">10:09</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@lwarlow:igalia.com">Luke Warlow</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> execCommand hooks into createContextualFragment</blockquote></mx-reply>Spec wise yes but that's quite wrong iirc. It definitely causes an issue with trusted types as specced.</td></tr>
  <tr class="msg" id="L18"><td class="ts-cell"><a class="ts" href="#L18" alt="Wed Sep 24 2025 03:10:07 GMT-0700 (Pacific Daylight Time)">10:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@lwarlow:igalia.com">Luke Warlow</span>&gt;</div></td><td class="msg-cell">It'll be similar regardless I guess </td></tr>
  <tr class="msg" id="L19"><td class="ts-cell"><a class="ts" href="#L19" alt="Wed Sep 24 2025 03:10:48 GMT-0700 (Pacific Daylight Time)">10:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@noamr:matrix.org">Noam Rosenthal</span>&gt;</div></td><td class="msg-cell">I guess having multiple methods with different APIs <em>feels</em> like it might get messy again, and might feel messy for developers in terms of discovery and linting.</td></tr>
  <tr class="msg" id="L20"><td class="ts-cell"><a class="ts" href="#L20" alt="Wed Sep 24 2025 03:12:01 GMT-0700 (Pacific Daylight Time)">10:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@noamr:matrix.org">Noam Rosenthal</span>&gt;</div></td><td class="msg-cell">They're built in a way where they all receive the same options dictionary for sanitation etc. so it <em>should</em> be OK, but I'm ambivalent about whether it feels nicer</td></tr>
  <tr class="msg" id="L21"><td class="ts-cell"><a class="ts" href="#L21" alt="Wed Sep 24 2025 03:13:31 GMT-0700 (Pacific Daylight Time)">10:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@noamr:matrix.org">Noam Rosenthal</span>&gt;</div></td><td class="msg-cell">It is nice that for the simple case we don't have to create a dictionary in terms of overhead</td></tr>
  <tr class="msg" id="L22"><td class="ts-cell"><a class="ts" href="#L22" alt="Wed Sep 24 2025 04:47:31 GMT-0700 (Pacific Daylight Time)">11:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@noamr:matrix.org">Noam Rosenthal</span>&gt;</div></td><td class="msg-cell">OTOH devs mostly dislike catch-alls like <code>splice</code> and <code>reduce</code> and the 4-method version is a bit like those</td></tr>
  <tr class="msg" id="L23"><td class="ts-cell"><a class="ts" href="#L23" alt="Wed Sep 24 2025 04:50:12 GMT-0700 (Pacific Daylight Time)">11:50</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@noamr:matrix.org">Noam Rosenthal</span>&gt;</div></td><td class="msg-cell">btw it might end up being 20 methods:
(prepend/append/before/after/replace) * (stream/set) * (safe/unsafe)

setHTML
htmlBefore
htmlAfter
appendHTML
prependHTML
streamHTML
streamHTMLBefore
streamHTMLAfter
appendHTMLStream
prependHTMLStream

(each with a *Unsafe version)</td></tr>
  <tr class="msg" id="L24"><td class="ts-cell"><a class="ts" href="#L24" alt="Wed Sep 24 2025 04:54:02 GMT-0700 (Pacific Daylight Time)">11:54</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@fbraun:mozilla.org">freddy</span>&gt;</div></td><td class="msg-cell">Question about streaming HTML parsing and edge cases. Right now, when you parse something like <code>&lt;table&gt;&lt;b&gt;&lt;tr&gt;&lt;td&gt;aaa&lt;/td&gt;&lt;/tr&gt;bbb&lt;/table&gt;ccc</code> , the parser moves the <code>&lt;b&gt;</code> <em>before</em> the table element. (<a href="https://html.spec.whatwg.org/multipage/parsing.html#unexpected-markup-in-tables">https://html.spec.whatwg.org/multipage/parsing.html#unexpected-markup-in-tables</a>). How would that behave? If the "table" is already created, could that cause issues if the parser later on creates another element that is placed before it?</td></tr>
  <tr class="msg" id="L25"><td class="ts-cell"><a class="ts" href="#L25" alt="Wed Sep 24 2025 04:55:13 GMT-0700 (Pacific Daylight Time)">11:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@fbraun:mozilla.org">freddy</span>&gt;</div></td><td class="msg-cell">I think the more general question is: how much interactivity can we allow with the elements that have been received piece-by-piece over streaming? It seems to me that interacting with the context element (eg. <code>body</code>) or the <code>table</code> and <code>b</code> elements might be rather dangerous, as long as we are uncertain of the resulting tree structure</td></tr>
  <tr class="msg" id="L26"><td class="ts-cell"><a class="ts" href="#L26" alt="Wed Sep 24 2025 05:00:38 GMT-0700 (Pacific Daylight Time)">12:00</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@annevk:matrix.org">annevk</span>&gt;</div></td><td class="msg-cell">I don't think 20 methods would be a big deal, but the positional arguments enable use cases that the 20 methods would not, which make me a bit torn. But maybe they can be addressed by multiple method calls instead.</td></tr>
  <tr class="msg" id="L27"><td class="ts-cell"><a class="ts" href="#L27" alt="Wed Sep 24 2025 05:03:47 GMT-0700 (Pacific Daylight Time)">12:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@noamr:matrix.org">Noam Rosenthal</span>&gt;</div></td><td class="msg-cell">We can have additional 4 for splicing a range, with 2 arguments outside the dictionary (but it might not be that necessary/popular)</td></tr>
  <tr class="msg" id="L28"><td class="ts-cell"><a class="ts" href="#L28" alt="Wed Sep 24 2025 05:06:56 GMT-0700 (Pacific Daylight Time)">12:06</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@noamr:matrix.org">Noam Rosenthal</span>&gt;</div></td><td class="msg-cell">you mean if we allow streaming into an element? It would behave like setting <code>innerHTML</code> directly ("fragment-mode")</td></tr>
  <tr class="msg" id="L29"><td class="ts-cell"><a class="ts" href="#L29" alt="Wed Sep 24 2025 05:07:10 GMT-0700 (Pacific Daylight Time)">12:07</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@noamr:matrix.org">Noam Rosenthal</span>&gt;</div></td><td class="msg-cell">I think in this case it allows &lt;table&gt;&lt;b&gt;...&lt;/b&gt;&lt;/table&gt;</td></tr>
  <tr class="msg" id="L30"><td class="ts-cell"><a class="ts" href="#L30" alt="Wed Sep 24 2025 05:08:38 GMT-0700 (Pacific Daylight Time)">12:08</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@noamr:matrix.org">Noam Rosenthal</span>&gt;</div></td><td class="msg-cell">... or expose those 4 in <code>Range</code></td></tr>
  <tr class="msg" id="L31"><td class="ts-cell"><a class="ts" href="#L31" alt="Wed Sep 24 2025 05:10:30 GMT-0700 (Pacific Daylight Time)">12:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@annevk:matrix.org">annevk</span>&gt;</div></td><td class="msg-cell">Do you have an idea for how you're going to deal with the stack of open elements and the insertion point and such?</td></tr>
  <tr class="msg" id="L32"><td class="ts-cell"><a class="ts" href="#L32" alt="Wed Sep 24 2025 05:13:06 GMT-0700 (Pacific Daylight Time)">12:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@noamr:matrix.org">Noam Rosenthal</span>&gt;</div></td><td class="msg-cell">yea, we've prototyped this and it's not so different from how the fragment-mode parser works today, except the tokenizer is fed incrementally</td></tr>
  <tr class="msg" id="L33"><td class="ts-cell"><a class="ts" href="#L33" alt="Wed Sep 24 2025 05:13:18 GMT-0700 (Pacific Daylight Time)">12:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@noamr:matrix.org">Noam Rosenthal</span>&gt;</div></td><td class="msg-cell">(if this was addressed to me about stream-to-element)</td></tr>
  <tr class="msg" id="L34"><td class="ts-cell"><a class="ts" href="#L34" alt="Wed Sep 24 2025 05:13:44 GMT-0700 (Pacific Daylight Time)">12:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@noamr:matrix.org">Noam Rosenthal</span>&gt;</div></td><td class="msg-cell">... and the result goes directly to the element and not to an intermediate <code>DocumentFragment</code></td></tr>
  <tr class="msg" id="L35"><td class="ts-cell"><a class="ts" href="#L35" alt="Wed Sep 24 2025 05:17:41 GMT-0700 (Pacific Daylight Time)">12:17</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@annevk:matrix.org">annevk</span>&gt;</div></td><td class="msg-cell"><span class="nick-8">Noam Rosenthal</span>: the fragment-mode parser very much relies on the parsing happening in an isolated environment which is then copied over. The details of how this is done do matter quite a bit so when you can share more that'd be great.</td></tr>
  <tr class="msg" id="L36"><td class="ts-cell"><a class="ts" href="#L36" alt="Wed Sep 24 2025 05:18:52 GMT-0700 (Pacific Daylight Time)">12:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@noamr:matrix.org">Noam Rosenthal</span>&gt;</div></td><td class="msg-cell"><span class="nick-12">foolip</span> ^^</td></tr>
  <tr class="msg" id="L37"><td class="ts-cell"><a class="ts" href="#L37" alt="Wed Sep 24 2025 05:27:52 GMT-0700 (Pacific Daylight Time)">12:27</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@foolip:matrix.org">foolip</span>&gt;</div></td><td class="msg-cell">Yes, it was not a big change at all in terms of implementation, but we'll have to see if this maps to the spec.</td></tr>
  <tr class="msg" id="L38"><td class="ts-cell"><a class="ts" href="#L38" alt="Wed Sep 24 2025 05:28:11 GMT-0700 (Pacific Daylight Time)">12:28</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@foolip:matrix.org">foolip</span>&gt;</div></td><td class="msg-cell">The main thing is the addition of the place to insert nodes, of course.</td></tr>
  <tr class="msg" id="L39"><td class="ts-cell"><a class="ts" href="#L39" alt="Wed Sep 24 2025 05:29:31 GMT-0700 (Pacific Daylight Time)">12:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@foolip:matrix.org">foolip</span>&gt;</div></td><td class="msg-cell">But I'm also not sure if <a href="https://html.spec.whatwg.org/#the-stack-of-open-elements">https://html.spec.whatwg.org/#the-stack-of-open-elements</a> and <a href="https://html.spec.whatwg.org/#the-list-of-active-formatting-elements">https://html.spec.whatwg.org/#the-list-of-active-formatting-elements</a> should start out empty, or if we should make an effort to make it just as if the content was parsed at the insertion point.</td></tr>
  <tr class="msg" id="L40"><td class="ts-cell"><a class="ts" href="#L40" alt="Wed Sep 24 2025 05:30:02 GMT-0700 (Pacific Daylight Time)">12:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@annevk:matrix.org">annevk</span>&gt;</div></td><td class="msg-cell">Has it been fuzzed? Especially with script execution the main parser is extremely tricky.</td></tr>
  <tr class="msg" id="L41"><td class="ts-cell"><a class="ts" href="#L41" alt="Wed Sep 24 2025 05:30:24 GMT-0700 (Pacific Daylight Time)">12:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@noamr:matrix.org">Noam Rosenthal</span>&gt;</div></td><td class="msg-cell">One thing we didn't do in the prototype is streaming "before" something. When there is a "before" the stream is buffered</td></tr>
  <tr class="msg" id="L42"><td class="ts-cell"><a class="ts" href="#L42" alt="Wed Sep 24 2025 05:30:49 GMT-0700 (Pacific Daylight Time)">12:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@noamr:matrix.org">Noam Rosenthal</span>&gt;</div></td><td class="msg-cell">... and it currently runs with script execution turned off</td></tr>
  <tr class="msg" id="L43"><td class="ts-cell"><a class="ts" href="#L43" alt="Wed Sep 24 2025 05:31:32 GMT-0700 (Pacific Daylight Time)">12:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@annevk:matrix.org">annevk</span>&gt;</div></td><td class="msg-cell">Sure a <code>&lt;script&gt;</code> inserted through this won't run, but scripts can still run presumably as they also called the API?</td></tr>
  <tr class="msg" id="L44"><td class="ts-cell"><a class="ts" href="#L44" alt="Wed Sep 24 2025 05:31:44 GMT-0700 (Pacific Daylight Time)">12:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@fbraun:mozilla.org">freddy</span>&gt;</div></td><td class="msg-cell">"script execution turned off" meaning that an inline script wouldn't run (similar to innerHTML=). But I would be concerned about existing scripts in the document observing/holding on to an element that is received via streaming</td></tr>
  <tr class="msg" id="L45"><td class="ts-cell"><a class="ts" href="#L45" alt="Wed Sep 24 2025 05:32:14 GMT-0700 (Pacific Daylight Time)">12:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@fbraun:mozilla.org">freddy</span>&gt;</div></td><td class="msg-cell">I should let anne talk. He's clearly typing faster :)</td></tr>
  <tr class="msg" id="L46"><td class="ts-cell"><a class="ts" href="#L46" alt="Wed Sep 24 2025 05:32:21 GMT-0700 (Pacific Daylight Time)">12:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@noamr:matrix.org">Noam Rosenthal</span>&gt;</div></td><td class="msg-cell">how is that different from inserting those elements separately, or using detached document streaming</td></tr>
  <tr class="msg" id="L47"><td class="ts-cell"><a class="ts" href="#L47" alt="Wed Sep 24 2025 05:33:00 GMT-0700 (Pacific Daylight Time)">12:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@annevk:matrix.org">annevk</span>&gt;</div></td><td class="msg-cell">Because the insertion point and stack of elements can get out-of-sync and such.</td></tr>
  <tr class="msg" id="L48"><td class="ts-cell"><a class="ts" href="#L48" alt="Wed Sep 24 2025 05:33:08 GMT-0700 (Pacific Daylight Time)">12:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@lwarlow:igalia.com">Luke Warlow</span>&gt;</div></td><td class="msg-cell">I would be worried about the script element protection provided by trusted types too. That has some wonkiness related to scripts that are amended during parse time, which this might run into?</td></tr>
  <tr class="msg" id="L49"><td class="ts-cell"><a class="ts" href="#L49" alt="Wed Sep 24 2025 05:33:38 GMT-0700 (Pacific Daylight Time)">12:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@noamr:matrix.org">Noam Rosenthal</span>&gt;</div></td><td class="msg-cell">yea but that can happen in the main parser as well, right?</td></tr>
  <tr class="msg" id="L50"><td class="ts-cell"><a class="ts" href="#L50" alt="Wed Sep 24 2025 05:33:48 GMT-0700 (Pacific Daylight Time)">12:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@noamr:matrix.org">Noam Rosenthal</span>&gt;</div></td><td class="msg-cell">or when you use detached document streaming or whatever</td></tr>
  <tr class="msg" id="L51"><td class="ts-cell"><a class="ts" href="#L51" alt="Wed Sep 24 2025 05:34:20 GMT-0700 (Pacific Daylight Time)">12:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@noamr:matrix.org">Noam Rosenthal</span>&gt;</div></td><td class="msg-cell">I don't see what fragment parsing has to do with it or what makes this new</td></tr>
  <tr class="msg" id="L52"><td class="ts-cell"><a class="ts" href="#L52" alt="Wed Sep 24 2025 05:35:24 GMT-0700 (Pacific Daylight Time)">12:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@annevk:matrix.org">annevk</span>&gt;</div></td><td class="msg-cell">That's a rather worrisome statement. I guess I'll just wait.</td></tr>
  <tr class="msg" id="L53"><td class="ts-cell"><a class="ts" href="#L53" alt="Wed Sep 24 2025 05:57:05 GMT-0700 (Pacific Daylight Time)">12:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@noamr:matrix.org">Noam Rosenthal</span>&gt;</div></td><td class="msg-cell"><span class="nick-12">annevk</span>: sure; we will share once we have something more concrete</td></tr>
  <tr class="msg" id="L54"><td class="ts-cell"><a class="ts" href="#L54" alt="Wed Sep 24 2025 06:02:57 GMT-0700 (Pacific Daylight Time)">13:02</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@noamr:matrix.org">Noam Rosenthal</span>&gt;</div></td><td class="msg-cell">Specifically to answer this, the streaming API in chromium (behind a flag) is being fuzzed in the last 2 months or so. We had a couple of crashes early on but nothing "tricky" so far. Of course things could come up down the line.</td></tr>
  <tr class="msg" id="L55"><td class="ts-cell"><a class="ts" href="#L55" alt="Wed Sep 24 2025 06:09:59 GMT-0700 (Pacific Daylight Time)">13:09</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@annevk:matrix.org">annevk</span>&gt;</div></td><td class="msg-cell">Part of the difficulty here is that the HTML parser is currently rather poorly specified as reusable component. I'm also not entirely sure what happens if you move insertion points between documents today. <span class="nick-15">hsivonen</span> and maybe <span class="nick-6">Jake Archibald</span> prolly do.</td></tr>
  <tr class="msg" id="L56"><td class="ts-cell"><a class="ts" href="#L56" alt="Wed Sep 24 2025 06:10:52 GMT-0700 (Pacific Daylight Time)">13:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@jakea:matrix.org">Jake Archibald</span>&gt;</div></td><td class="msg-cell">I think it executes script, but let me check</td></tr>
  <tr class="msg" id="L57"><td class="ts-cell"><a class="ts" href="#L57" alt="Wed Sep 24 2025 06:18:07 GMT-0700 (Pacific Daylight Time)">13:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@annevk:matrix.org">annevk</span>&gt;</div></td><td class="msg-cell">And you can end up with multiple streams for a single document I guess? I haven't seen that much test coverage for those cases though.</td></tr>
  <tr class="msg" id="L58"><td class="ts-cell"><a class="ts" href="#L58" alt="Wed Sep 24 2025 06:19:23 GMT-0700 (Pacific Daylight Time)">13:19</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@jakea:matrix.org">Jake Archibald</span>&gt;</div></td><td class="msg-cell"><a href="https://developer.mozilla.org/en-US/play?id=QfShUNJ1gJqC4kgSoSDNV%2FsT724NONcZ3SXOv6QogT2hGATvZ2lQtS2hJK7p3MTCy0OeLSAl72JYRZxy">https://developer.mozilla.org/en-US/play?id=QfShUNJ1gJqC4kgSoSDNV%2FsT724NONcZ3SXOv6QogT2hGATvZ2lQtS2hJK7p3MTCy0OeLSAl72JYRZxy</a> - it doesn't execute script. I'm pretty sure it did in Chrome at some point.</td></tr>
  <tr class="msg" id="L59"><td class="ts-cell"><a class="ts" href="#L59" alt="Wed Sep 24 2025 06:19:40 GMT-0700 (Pacific Daylight Time)">13:19</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@jakea:matrix.org">Jake Archibald</span>&gt;</div></td><td class="msg-cell">Oh, it does execute script in Safari</td></tr>
  <tr class="msg" id="L60"><td class="ts-cell"><a class="ts" href="#L60" alt="Wed Sep 24 2025 06:20:08 GMT-0700 (Pacific Daylight Time)">13:20</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@noamr:matrix.org">Noam Rosenthal</span>&gt;</div></td><td class="msg-cell">For a single context element you can have one stream at a time, and the next one will abort the old one</td></tr>

</tbody></table></div></div></div>
</body></html>
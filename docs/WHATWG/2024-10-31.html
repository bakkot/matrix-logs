<!DOCTYPE html><html><head>
  <title>WHATWG on 2024-10-31</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "WHATWG";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">WHATWG<br>2024-10-31<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2024-10-30" class="nav-link"><span>prev</span></a>
<a href="2024-11-01" class="nav-link"><span style="float:right">next</span></a>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">
<div class="rhs-header">
<span id="error" style="color: red; display:none">error</span>

<input type="text" id="query" size="25" placeholder="Search WHATWG">
<a id="search-submit" class="button icon-link" title="Search">
  <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"></path></svg>
</a>
</div>

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Thu Oct 31 2024 01:37:35 GMT-0700 (Pacific Daylight Time)">08:37</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@dmaxim:matrix.org">Maxim Vaarwel</span>&gt;</div></td><td class="msg-cell">Good evening. Can anyone give some examples of <a href="https://url.spec.whatwg.org/#url-opaque-path">opaque path</a>? The URL spec is stingy on this.</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Thu Oct 31 2024 01:39:54 GMT-0700 (Pacific Daylight Time)">08:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-1" title="@domenicdenicola:matrix.org">Domenic</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> Good evening. Can anyone give some examples of <a href="https://url.spec.whatwg.org/#url-opaque-path">opaque path</a>? The URL spec is stingy on this.</blockquote></mx-reply><a href="https://url.spec.whatwg.org/#example-url-components">https://url.spec.whatwg.org/#example-url-components</a> 3rd example</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Thu Oct 31 2024 01:43:57 GMT-0700 (Pacific Daylight Time)">08:43</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@dmaxim:matrix.org">Maxim Vaarwel</span>&gt;</div></td><td class="msg-cell"><p>Thanks, but I have extra question.</p>
<p>Is it possible to use the <code>new URL</code> constructor to create a url that will have opaque path in the first argument and base URL in the second?</p>
</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Thu Oct 31 2024 01:45:52 GMT-0700 (Pacific Daylight Time)">08:45</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-1" title="@domenicdenicola:matrix.org">Domenic</span>&gt;</div></td><td class="msg-cell">Sure. <code>new URL("urn:isbn:9780307476463", "<a href="https://example.com/">https://example.com/</a>")</code>.</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Thu Oct 31 2024 01:49:40 GMT-0700 (Pacific Daylight Time)">08:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@dmaxim:matrix.org">Maxim Vaarwel</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> Sure. <code>new URL("urn:isbn:9780307476463", "<a href="https://example.com/">https://example.com/</a>")</code>.</blockquote></mx-reply><p>The result of the URL structure is funny, there is nothing left from the base URL.</p>
<p>In any case, thank you very much for such a quick response.</p>
</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Thu Oct 31 2024 06:00:34 GMT-0700 (Pacific Daylight Time)">13:00</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@noamr:matrix.org">Noam Rosenthal</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> (and just having consistency is good in general)</blockquote></mx-reply>Perhaps a cleaner take on this would be to wait to fire this event till the next focusing steps, which would be at the next frame (latest). That way we don't bombard with events during DOM ops</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Thu Oct 31 2024 06:02:01 GMT-0700 (Pacific Daylight Time)">13:02</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@noamr:matrix.org">Noam Rosenthal</span>&gt;</div></td><td class="msg-cell">Basically we mark the element as "moved while focused" and in the next focusing steps we use this flag to determine whether the event needs to be fired.</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Thu Oct 31 2024 07:31:35 GMT-0700 (Pacific Daylight Time)">14:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@noamr:matrix.org">Noam Rosenthal</span>&gt;</div></td><td class="msg-cell">we don't even have to mark the element, just mark a boolean on the document and read it in the focus fixup</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Thu Oct 31 2024 07:31:50 GMT-0700 (Pacific Daylight Time)">14:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@smaug:mozilla.org">smaug</span>&gt;</div></td><td class="msg-cell">Not sure which one is easier to understand. Firing asap would be easier to implement, I think (and would be closer to the model focus() has). <span class="nick-6">keithamus</span> might have an opinion. (I don't have a strong opinion)</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Thu Oct 31 2024 07:32:35 GMT-0700 (Pacific Daylight Time)">14:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@noamr:matrix.org">Noam Rosenthal</span>&gt;</div></td><td class="msg-cell">I think both would be easy to implement, or at least spec... my worry was having a batch of DOM operations with <code>moveBefore</code> inside that end up firing lots of events</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Thu Oct 31 2024 07:32:42 GMT-0700 (Pacific Daylight Time)">14:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@smaug:mozilla.org">smaug</span>&gt;</div></td><td class="msg-cell">oh, you'd clear the boolean if some other focusing is happening?</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Thu Oct 31 2024 07:32:46 GMT-0700 (Pacific Daylight Time)">14:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@noamr:matrix.org">Noam Rosenthal</span>&gt;</div></td><td class="msg-cell">yea</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Thu Oct 31 2024 07:33:05 GMT-0700 (Pacific Daylight Time)">14:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@noamr:matrix.org">Noam Rosenthal</span>&gt;</div></td><td class="msg-cell">well, if some other focusing is happening, the new element would get the focus and you'll get a blur</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Thu Oct 31 2024 07:33:33 GMT-0700 (Pacific Daylight Time)">14:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@smaug:mozilla.org">smaug</span>&gt;</div></td><td class="msg-cell">Are there cases when you do want to know asap if activeElement has changed?</td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Thu Oct 31 2024 07:33:46 GMT-0700 (Pacific Daylight Time)">14:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@noamr:matrix.org">Noam Rosenthal</span>&gt;</div></td><td class="msg-cell">you can check <code>activeElement</code></td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Thu Oct 31 2024 07:34:10 GMT-0700 (Pacific Daylight Time)">14:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@smaug:mozilla.org">smaug</span>&gt;</div></td><td class="msg-cell">but you don't get any notification it being changed</td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Thu Oct 31 2024 07:34:11 GMT-0700 (Pacific Daylight Time)">14:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@noamr:matrix.org">Noam Rosenthal</span>&gt;</div></td><td class="msg-cell">I think you can't really rely on this ASAP thing because focus fixup might change things</td></tr>
  <tr class="msg" id="L17"><td class="ts-cell"><a class="ts" href="#L17" alt="Thu Oct 31 2024 07:34:46 GMT-0700 (Pacific Daylight Time)">14:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@noamr:matrix.org">Noam Rosenthal</span>&gt;</div></td><td class="msg-cell">and one thing we reallly don't want to do is add forced style calculations</td></tr>
  <tr class="msg" id="L18"><td class="ts-cell"><a class="ts" href="#L18" alt="Thu Oct 31 2024 07:35:53 GMT-0700 (Pacific Daylight Time)">14:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@noamr:matrix.org">Noam Rosenthal</span>&gt;</div></td><td class="msg-cell">if you're in frameworks etc, you most likely are doing a batch of DOM operations and then the rendering step would come, you don't need multiple events during the batch</td></tr>
  <tr class="msg" id="L19"><td class="ts-cell"><a class="ts" href="#L19" alt="Thu Oct 31 2024 07:37:16 GMT-0700 (Pacific Daylight Time)">14:37</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@noamr:matrix.org">Noam Rosenthal</span>&gt;</div></td><td class="msg-cell">so I am pretty confident that "eventually" (as in, by the next frame or earlier) having your focus events catch up with your active element is good enough for people relying on these events. But happy to hear <span class="nick-6">keithamus</span> and others of course!</td></tr>
  <tr class="msg" id="L20"><td class="ts-cell"><a class="ts" href="#L20" alt="Thu Oct 31 2024 07:39:06 GMT-0700 (Pacific Daylight Time)">14:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@smaug:mozilla.org">smaug</span>&gt;</div></td><td class="msg-cell">So document.querySelectorAll(":focus-within") would temporarily be broken?</td></tr>
  <tr class="msg" id="L21"><td class="ts-cell"><a class="ts" href="#L21" alt="Thu Oct 31 2024 07:39:26 GMT-0700 (Pacific Daylight Time)">14:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@noamr:matrix.org">Noam Rosenthal</span>&gt;</div></td><td class="msg-cell">yea, but it's temporarily broken today in many cases</td></tr>
  <tr class="msg" id="L22"><td class="ts-cell"><a class="ts" href="#L22" alt="Thu Oct 31 2024 07:39:52 GMT-0700 (Pacific Daylight Time)">14:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@noamr:matrix.org">Noam Rosenthal</span>&gt;</div></td><td class="msg-cell">though we can move the <code>:focus-within</code> flag synchronously, it's kind of a separate question</td></tr>
  <tr class="msg" id="L23"><td class="ts-cell"><a class="ts" href="#L23" alt="Thu Oct 31 2024 07:40:20 GMT-0700 (Pacific Daylight Time)">14:40</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@smaug:mozilla.org">smaug</span>&gt;</div></td><td class="msg-cell">true</td></tr>
  <tr class="msg" id="L24"><td class="ts-cell"><a class="ts" href="#L24" alt="Thu Oct 31 2024 07:46:14 GMT-0700 (Pacific Daylight Time)">14:46</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@smaug:mozilla.org">smaug</span>&gt;</div></td><td class="msg-cell">would it be weird to get key events for subtree which hasn't ever gotten focus event? (That might be an issue already in the spec, I need to check in which case the focus stuff runs around rendering update)</td></tr>
  <tr class="msg" id="L25"><td class="ts-cell"><a class="ts" href="#L25" alt="Thu Oct 31 2024 07:52:17 GMT-0700 (Pacific Daylight Time)">14:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@noamr:matrix.org">Noam Rosenthal</span>&gt;</div></td><td class="msg-cell">I think you'd need a focus fixup before you can determine who gets the keys anyway</td></tr>
  <tr class="msg" id="L26"><td class="ts-cell"><a class="ts" href="#L26" alt="Thu Oct 31 2024 07:52:53 GMT-0700 (Pacific Daylight Time)">14:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@noamr:matrix.org">Noam Rosenthal</span>&gt;</div></td><td class="msg-cell">it would be weird if an element got <code>display: none</code> due to a DOM change but you received key events before calculating its style</td></tr>
  <tr class="msg" id="L27"><td class="ts-cell"><a class="ts" href="#L27" alt="Thu Oct 31 2024 07:54:11 GMT-0700 (Pacific Daylight Time)">14:54</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@noamr:matrix.org">Noam Rosenthal</span>&gt;</div></td><td class="msg-cell">the intermediate unfixed focus state is really only for javascript introspection</td></tr>
  <tr class="msg" id="L28"><td class="ts-cell"><a class="ts" href="#L28" alt="Thu Oct 31 2024 07:54:27 GMT-0700 (Pacific Daylight Time)">14:54</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@smaug:mozilla.org">smaug</span>&gt;</div></td><td class="msg-cell">But that update doesn't need to happen during rendering update steps </td></tr>
  <tr class="msg" id="L29"><td class="ts-cell"><a class="ts" href="#L29" alt="Thu Oct 31 2024 07:54:47 GMT-0700 (Pacific Daylight Time)">14:54</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@noamr:matrix.org">Noam Rosenthal</span>&gt;</div></td><td class="msg-cell">it can also happen due to calling <code>focus()</code></td></tr>
  <tr class="msg" id="L30"><td class="ts-cell"><a class="ts" href="#L30" alt="Thu Oct 31 2024 07:55:17 GMT-0700 (Pacific Daylight Time)">14:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@noamr:matrix.org">Noam Rosenthal</span>&gt;</div></td><td class="msg-cell">but that forces a style calculation and would trigger the focusing steps</td></tr>
  <tr class="msg" id="L31"><td class="ts-cell"><a class="ts" href="#L31" alt="Thu Oct 31 2024 07:55:18 GMT-0700 (Pacific Daylight Time)">14:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@smaug:mozilla.org">smaug</span>&gt;</div></td><td class="msg-cell">browsers try to dispatch key events before rendering update (or I'm not sure about webkit's scheduling)</td></tr>
  <tr class="msg" id="L32"><td class="ts-cell"><a class="ts" href="#L32" alt="Thu Oct 31 2024 07:55:52 GMT-0700 (Pacific Daylight Time)">14:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@noamr:matrix.org">Noam Rosenthal</span>&gt;</div></td><td class="msg-cell">so that would probably need a forced style calc and focus fixup like the one done inside update the rendering</td></tr>
  <tr class="msg" id="L33"><td class="ts-cell"><a class="ts" href="#L33" alt="Thu Oct 31 2024 07:56:16 GMT-0700 (Pacific Daylight Time)">14:56</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@noamr:matrix.org">Noam Rosenthal</span>&gt;</div></td><td class="msg-cell">(we're not adding anything new to that)</td></tr>
  <tr class="msg" id="L34"><td class="ts-cell"><a class="ts" href="#L34" alt="Thu Oct 31 2024 07:56:21 GMT-0700 (Pacific Daylight Time)">14:56</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@smaug:mozilla.org">smaug</span>&gt;</div></td><td class="msg-cell">and we'd dispatch focus at that point?</td></tr>
  <tr class="msg" id="L35"><td class="ts-cell"><a class="ts" href="#L35" alt="Thu Oct 31 2024 07:56:26 GMT-0700 (Pacific Daylight Time)">14:56</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@noamr:matrix.org">Noam Rosenthal</span>&gt;</div></td><td class="msg-cell">yea</td></tr>
  <tr class="msg" id="L36"><td class="ts-cell"><a class="ts" href="#L36" alt="Thu Oct 31 2024 07:56:30 GMT-0700 (Pacific Daylight Time)">14:56</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@smaug:mozilla.org">smaug</span>&gt;</div></td><td class="msg-cell">that might work</td></tr>
  <tr class="msg" id="L37"><td class="ts-cell"><a class="ts" href="#L37" alt="Thu Oct 31 2024 08:00:08 GMT-0700 (Pacific Daylight Time)">15:00</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@noamr:matrix.org">Noam Rosenthal</span>&gt;</div></td><td class="msg-cell">In HTML spec land, the change would be that when we run the focusing steps, if the target focus element is the current one and we haven't focused since moving the focused element, we first reset the current focused element to the viewport (as if that element was removed). This is simple enough and should cover all the weird cases I think</td></tr>
  <tr class="msg" id="L38"><td class="ts-cell"><a class="ts" href="#L38" alt="Thu Oct 31 2024 08:28:57 GMT-0700 (Pacific Daylight Time)">15:28</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@keithamus:matrix.org">keithamus</span>&gt;</div></td><td class="msg-cell">Firing the event some time later seems okay to me. I think practical cases might be for eg wanting to hide UI if focus moves out. That kind of UI change isn’t really impacted by even microtask timing IMO. But not firing at all might break it.</td></tr>

</tbody></table></div></div></div>
</body></html>
<!DOCTYPE html><html><head>
  <title>WHATWG on 2024-04-17</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "WHATWG";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">WHATWG<br>2024-04-17<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2024-04-16" class="nav-link"><span>prev</span></a>
<a href="2024-04-18" class="nav-link"><span style="float:right">next</span></a>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">
<div class="rhs-header">
<span id="error" style="color: red; display:none">error</span>

<input type="text" id="query" size="25" placeholder="Search WHATWG">
<a id="search-submit" class="button icon-link" title="Search">
  <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"></path></svg>
</a>
</div>

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Tue Apr 16 2024 17:15:08 GMT-0700 (Pacific Daylight Time)">00:15</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@lwarlow:igalia.com">Luke Warlow</span>&gt;</div></td><td class="msg-cell">Do we need a getHTML function on the document interface? We can parse to a document but can't currently serialise from one (not preserving shadow Dom anyway). You can call getHTML on the documentElement but that loses the html element in the output (because that's effectively innerHTML and we'd need outerHTML). A getHTML on the document object itself could also serialise the compat mode back to the doctype? Which feels like it could be useful if you're trying to ensure lossless round tripping of parsing and serialisation?</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Tue Apr 16 2024 18:31:52 GMT-0700 (Pacific Daylight Time)">01:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-1" title="@domenicdenicola:matrix.org">Domenic</span>&gt;</div></td><td class="msg-cell">That issue just feels like an area where the community needs to go off and get a widely-used custom element (or React component, I'm not picky) before spending all this time in standards space...</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Tue Apr 16 2024 18:32:41 GMT-0700 (Pacific Daylight Time)">01:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-1" title="@domenicdenicola:matrix.org">Domenic</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> Do we need a getHTML function on the document interface? We can parse to a document but can't currently serialise from one (not preserving shadow Dom anyway). You can call getHTML on the documentElement but that loses the html element in the output (because that's effectively innerHTML and we'd need outerHTML). A getHTML on the document object itself could also serialise the compat mode back to the doctype? Which feels like it could be useful if you're trying to ensure lossless round tripping of parsing and serialisation?</blockquote></mx-reply>I would like that. Serializing the DOCTYPE in particular is nice. jsdom has its own serialization function just for that, because documentElement.outerHTML misses it.</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Wed Apr 17 2024 00:08:46 GMT-0700 (Pacific Daylight Time)">07:08</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@annevk:matrix.org">annevk</span>&gt;</div></td><td class="msg-cell">It might be a little weird that <code>parseHTMLUnsafe()</code> is a static method then and not just <code>document.setHTMLUnsafe()</code>.</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Wed Apr 17 2024 00:10:06 GMT-0700 (Pacific Daylight Time)">07:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@annevk:matrix.org">annevk</span>&gt;</div></td><td class="msg-cell">But I guess it's fine. Serializing the doctype seems good, but we should be opinionated about it and not support all inputs as-is.</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Wed Apr 17 2024 00:22:55 GMT-0700 (Pacific Daylight Time)">07:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@lwarlow:igalia.com">Luke Warlow</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> But I guess it's fine. Serializing the doctype seems good, but we should be opinionated about it and not support all inputs as-is.</blockquote></mx-reply>Yeah okay maybe lossless was the wrong choice of word. I think the compatMode should serialise to the presence or lack of a standard Doctype</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Wed Apr 17 2024 00:24:47 GMT-0700 (Pacific Daylight Time)">07:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@lwarlow:igalia.com">Luke Warlow</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> It might be a little weird that <code>parseHTMLUnsafe()</code> is a static method then and not just <code>document.setHTMLUnsafe()</code>.</blockquote></mx-reply>I guess that's fine though because it ensures the state of the document object is consistent when parsing?</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Wed Apr 17 2024 00:29:53 GMT-0700 (Pacific Daylight Time)">07:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@annevk:matrix.org">annevk</span>&gt;</div></td><td class="msg-cell">Hmm, the state for non-document nodes is not. But in theory we could also add <code>setHTMLUnsafe()</code> to document if we ever wanted to parse without allocation. Prolly not worth it for the foreseeable future though.</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Wed Apr 17 2024 00:33:44 GMT-0700 (Pacific Daylight Time)">07:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@lwarlow:igalia.com">Luke Warlow</span>&gt;</div></td><td class="msg-cell">I got thinking on this because if we had document getHTML, you could use trusted types and the sanitizer APIs to always safely set the srcdoc attribute on an iframe without needing any dependencies (unless there's some missing issues I've not thought of).

mXSS is what I was missing.

And also just because it does feel like a missing piece to the serialization puzzle.</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Wed Apr 17 2024 00:41:50 GMT-0700 (Pacific Daylight Time)">07:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-1" title="@domenicdenicola:matrix.org">Domenic</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> Yeah okay maybe lossless was the wrong choice of word. I think the compatMode should serialise to the presence or lack of a standard Doctype</blockquote></mx-reply>I don't think compatmode should impact it. It should be whether the Document has a DocumentType node. And then it should serialize according to <a href="https://html.spec.whatwg.org/#html-fragment-serialisation-algorithm">https://html.spec.whatwg.org/#html-fragment-serialisation-algorithm</a> .</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Wed Apr 17 2024 00:43:29 GMT-0700 (Pacific Daylight Time)">07:43</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@lwarlow:igalia.com">Luke Warlow</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> I don't think compatmode should impact it. It should be whether the Document has a DocumentType node. And then it should serialize according to <a href="https://html.spec.whatwg.org/#html-fragment-serialisation-algorithm">https://html.spec.whatwg.org/#html-fragment-serialisation-algorithm</a> .</blockquote></mx-reply>I was thinking back to how we used to do it where I worked before but maybe we were doing it badly ðŸ˜…</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Wed Apr 17 2024 00:44:15 GMT-0700 (Pacific Daylight Time)">07:44</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-1" title="@domenicdenicola:matrix.org">Domenic</span>&gt;</div></td><td class="msg-cell">Interesting that the parser preserves name, system ID, and public ID, but the serializer only keeps the name.</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Wed Apr 17 2024 00:45:28 GMT-0700 (Pacific Daylight Time)">07:45</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@lwarlow:igalia.com">Luke Warlow</span>&gt;</div></td><td class="msg-cell">I'll open an issue on the html spec proposing this idea and we can discuss further the details there. Just wanted to guage if we thought it was any good or not.</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Wed Apr 17 2024 00:52:00 GMT-0700 (Pacific Daylight Time)">07:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-1" title="@domenicdenicola:matrix.org">Domenic</span>&gt;</div></td><td class="msg-cell">I can't find any way to trigger the HTML fragment serializing algorithm with a doctype, sad.</td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Wed Apr 17 2024 00:53:29 GMT-0700 (Pacific Daylight Time)">07:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-1" title="@domenicdenicola:matrix.org">Domenic</span>&gt;</div></td><td class="msg-cell">I also either found a bug or am blind <a href="https://github.com/whatwg/dom/issues/1278">https://github.com/whatwg/dom/issues/1278</a></td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Wed Apr 17 2024 00:54:18 GMT-0700 (Pacific Daylight Time)">07:54</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@fbraun:mozilla.org">freddy</span>&gt;</div></td><td class="msg-cell">Huh, I learned there is <code>document.doctype</code> but it doesn't serialize to a doctype string?</td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Wed Apr 17 2024 00:54:23 GMT-0700 (Pacific Daylight Time)">07:54</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@fbraun:mozilla.org">freddy</span>&gt;</div></td><td class="msg-cell">(testing in Firefox)</td></tr>
  <tr class="msg" id="L17"><td class="ts-cell"><a class="ts" href="#L17" alt="Wed Apr 17 2024 00:55:02 GMT-0700 (Pacific Daylight Time)">07:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@fbraun:mozilla.org">freddy</span>&gt;</div></td><td class="msg-cell">I've used <code>document.body.parentElement.outerHTML</code> in the past, but you'd have to guess and attach the right doctype. Either way. I think there's value in a getter for the document.</td></tr>
  <tr class="msg" id="L18"><td class="ts-cell"><a class="ts" href="#L18" alt="Wed Apr 17 2024 00:55:04 GMT-0700 (Pacific Daylight Time)">07:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-1" title="@domenicdenicola:matrix.org">Domenic</span>&gt;</div></td><td class="msg-cell">It doesn't have any serializing methods or properties</td></tr>
  <tr class="msg" id="L19"><td class="ts-cell"><a class="ts" href="#L19" alt="Wed Apr 17 2024 01:39:13 GMT-0700 (Pacific Daylight Time)">08:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@ms2ger:igalia.com">Ms2ger</span>&gt;</div></td><td class="msg-cell">Did we manage to remove the getters on doctype?</td></tr>
  <tr class="msg" id="L20"><td class="ts-cell"><a class="ts" href="#L20" alt="Wed Apr 17 2024 01:57:33 GMT-0700 (Pacific Daylight Time)">08:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@fbraun:mozilla.org">freddy</span>&gt;</div></td><td class="msg-cell">There were some? Well, then apparently...yes? :)</td></tr>
  <tr class="msg" id="L21"><td class="ts-cell"><a class="ts" href="#L21" alt="Wed Apr 17 2024 02:16:22 GMT-0700 (Pacific Daylight Time)">09:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@annevk:matrix.org">annevk</span>&gt;</div></td><td class="msg-cell">I guess I disagree with <span class="nick-1">Domenic</span>. I like the idea of serializing based on quirks mode a lot better. That way we either have no doctype, an almost doctype, or the doctype in the output.</td></tr>
  <tr class="msg" id="L22"><td class="ts-cell"><a class="ts" href="#L22" alt="Wed Apr 17 2024 02:25:02 GMT-0700 (Pacific Daylight Time)">09:25</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@lwarlow:igalia.com">Luke Warlow</span>&gt;</div></td><td class="msg-cell">I raised <a href="https://github.com/whatwg/html/issues/10280">https://github.com/whatwg/html/issues/10280</a> </td></tr>
  <tr class="msg" id="L23"><td class="ts-cell"><a class="ts" href="#L23" alt="Wed Apr 17 2024 02:26:31 GMT-0700 (Pacific Daylight Time)">09:26</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@fbraun:mozilla.org">freddy</span>&gt;</div></td><td class="msg-cell">We also discussed this in our Sanitizer issue triage and thought that a <code>document.setHTML</code> might be neat, such that one could do <code>iframe.contentDocument.setHTML()</code> and without doing a parsing/serialization roundtrip between for that specific use case. <a href="https://github.com/WICG/sanitizer-api/issues/117#issuecomment-2060735167">https://github.com/WICG/sanitizer-api/issues/117#issuecomment-2060735167</a> has more.</td></tr>
  <tr class="msg" id="L24"><td class="ts-cell"><a class="ts" href="#L24" alt="Wed Apr 17 2024 04:55:42 GMT-0700 (Pacific Daylight Time)">11:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@annevk:matrix.org">annevk</span>&gt;</div></td><td class="msg-cell"><span class="nick-14">freddy</span>: note that it would require quite a number of downstream changes (none too hard I suspect) as we currently only consider possible element children</td></tr>
  <tr class="msg" id="L25"><td class="ts-cell"><a class="ts" href="#L25" alt="Wed Apr 17 2024 07:42:52 GMT-0700 (Pacific Daylight Time)">14:42</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@lwarlow:igalia.com">Luke Warlow</span>&gt;</div></td><td class="msg-cell"><code>new XMLSerializer().serializeToString(document.doctype)</code> this will give you a string representation back. But to your point this obviously goes via XML serialisation rather than HTML.</td></tr>
  <tr class="msg" id="L26"><td class="ts-cell"><a class="ts" href="#L26" alt="Wed Apr 17 2024 16:23:47 GMT-0700 (Pacific Daylight Time)">23:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@zcorpan:mozilla.org">zcorpan</span>&gt;</div></td><td class="msg-cell">Why did we use labels and not milestones for Stages?</td></tr>

</tbody></table></div></div></div>
</body></html>
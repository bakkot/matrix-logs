<!DOCTYPE html><html><head>
  <meta charset="UTF-8">
  <title>WHATWG on 2025-10-13</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "WHATWG";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">WHATWG<br>2025-10-13<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2025-10-10" class="nav-link"><span>prev</span></a>
<span style="float:right">next</span>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">
<div class="rhs-header">
<span id="error" style="color: red; display:none">error</span>

<input type="text" id="query" size="25" placeholder="Search WHATWG">
<a id="search-submit" class="button icon-link" title="Search">
  <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"></path></svg>
</a>
</div>

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Mon Oct 13 2025 03:52:42 GMT-0700 (Pacific Daylight Time)">10:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@zcorpan:mozilla.org">zcorpan</span>&gt;</div></td><td class="msg-cell"><span class="nick-8">Noam Rosenthal</span>: why does <a href="https://html.spec.whatwg.org/#prepare-an-image-for-presentation">https://html.spec.whatwg.org/#prepare-an-image-for-presentation</a> return early in several steps, without getting to one of step 14 or 15? Also step 16 is only run if no other step returns.</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Mon Oct 13 2025 03:53:47 GMT-0700 (Pacific Daylight Time)">10:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@noamr:matrix.org">Noam Rosenthal</span>&gt;</div></td><td class="msg-cell">will take a look. Haven't touched that since 2020.</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Mon Oct 13 2025 03:57:21 GMT-0700 (Pacific Daylight Time)">10:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@noamr:matrix.org">Noam Rosenthal</span>&gt;</div></td><td class="msg-cell">Regarding step 16 - it's perhaps ambiguous from reading but this step is optional... it's not like the image is not going to be presented without it. Step 16 is like saying "adjust the image presentation, now that the preferred density-correction dimensions are set"</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Mon Oct 13 2025 03:59:24 GMT-0700 (Pacific Daylight Time)">10:59</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@noamr:matrix.org">Noam Rosenthal</span>&gt;</div></td><td class="msg-cell">Steps 8, 9, 10: it was a mitigation to having the density set accidentally due to e.g. EXIF information being copied around.
Requiring the dimensions to have positive numbers and only use inches narrows the spectrum for accidental density setting.
We can reason about making it more lax, it was a bit of a judgement call at the time</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Mon Oct 13 2025 04:01:06 GMT-0700 (Pacific Daylight Time)">11:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@zcorpan:mozilla.org">zcorpan</span>&gt;</div></td><td class="msg-cell"><span class="nick-8">Noam Rosenthal</span>: so then PixelXDimension and PixelYDimension are also ignored for the early return cases</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Mon Oct 13 2025 04:01:20 GMT-0700 (Pacific Daylight Time)">11:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@noamr:matrix.org">Noam Rosenthal</span>&gt;</div></td><td class="msg-cell">yea they are</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Mon Oct 13 2025 04:01:34 GMT-0700 (Pacific Daylight Time)">11:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@noamr:matrix.org">Noam Rosenthal</span>&gt;</div></td><td class="msg-cell">it's like "this is accidental EXIF information"</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Mon Oct 13 2025 04:03:17 GMT-0700 (Pacific Daylight Time)">11:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@zcorpan:mozilla.org">zcorpan</span>&gt;</div></td><td class="msg-cell">I see, thanks. It's still not clear to me that step 16 is not important, as it was the text in place of this algorithm before. It can be read as "don't render cross-origin images" or "don't render images with bogus EXIF"</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Mon Oct 13 2025 04:04:27 GMT-0700 (Pacific Daylight Time)">11:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@zcorpan:mozilla.org">zcorpan</span>&gt;</div></td><td class="msg-cell">I'll file an issue</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Mon Oct 13 2025 04:05:39 GMT-0700 (Pacific Daylight Time)">11:05</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@noamr:matrix.org">Noam Rosenthal</span>&gt;</div></td><td class="msg-cell">Agreed, it can&amp;should be made clearer. If you file an issue I'm happy to file a PR</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Mon Oct 13 2025 04:08:23 GMT-0700 (Pacific Daylight Time)">11:08</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@zcorpan:mozilla.org">zcorpan</span>&gt;</div></td><td class="msg-cell"><span class="nick-8">Noam Rosenthal</span>: <a href="https://github.com/whatwg/html/issues/11777">https://github.com/whatwg/html/issues/11777</a></td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Mon Oct 13 2025 05:26:41 GMT-0700 (Pacific Daylight Time)">12:26</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@jjaschke:mozilla.org">jjaschke</span>&gt;</div></td><td class="msg-cell"><span class="nick-8">Noam Rosenthal</span>: Reviewing <a href="https://github.com/whatwg/html/pull/11762">#11762</a> right now, thanks for working on this! I like the idea of passing the upcoming tracker into the event firing mechanism, but now I wonder if we need to keep the upcoming trackers in the global state at all, or if we can get away with just passing them around. That way we're less prone to accidentally breaking global state.<br>The only reason I see currently (I may be wrong though) why we need the <code>upcoming non-traverse API method tracker</code> would be to signal that navigation has aborted (<a href="https://html.spec.whatwg.org/#dom-navigation-navigate:~:text=If%20this%27s%20upcoming%20non%2Dtraverse%20API%20method%20tracker%20is%20apiMethodTracker%2C%20then">this step in <code>navigate()</code></a>), but I bet we can transport this information in another fashion (which may even be easier to understand).<br>WDYT?</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Mon Oct 13 2025 05:32:51 GMT-0700 (Pacific Daylight Time)">12:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@noamr:matrix.org">Noam Rosenthal</span>&gt;</div></td><td class="msg-cell">Yea it would be great not to have those tidbits of global state... let me scan it a few times :)</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Mon Oct 13 2025 05:33:58 GMT-0700 (Pacific Daylight Time)">12:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@jjaschke:mozilla.org">jjaschke</span>&gt;</div></td><td class="msg-cell">Oh, also just noticed, the promote upcoming to ongoing algorithm that you inlined is also used in <a href="https://html.spec.whatwg.org/#navigation-api-initiating-navigations:reload-2:~:text=Let%20apiMethodTracker%20be%20the%20result%20of%20maybe%20setting%20the%20upcoming%20non%2Dtraverse%20API%20method%20tracker%20for%20this%20given%20info%20and%20serializedState%2E,-Reload">reload()</a>.</td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Mon Oct 13 2025 05:39:29 GMT-0700 (Pacific Daylight Time)">12:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@noamr:matrix.org">Noam Rosenthal</span>&gt;</div></td><td class="msg-cell">THat's not that algo, it's "maybe setting", not "promote". There was only one use of "promote"</td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Mon Oct 13 2025 05:40:06 GMT-0700 (Pacific Daylight Time)">12:40</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@noamr:matrix.org">Noam Rosenthal</span>&gt;</div></td><td class="msg-cell">I think <code>navigate</code> can have a return value of whether the navigation was aborted prior to the promotion step</td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Mon Oct 13 2025 05:45:05 GMT-0700 (Pacific Daylight Time)">12:45</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@jjaschke:mozilla.org">jjaschke</span>&gt;</div></td><td class="msg-cell">Ugh, of course. 
But, shouldn't we do the same we do for navigate (extract the upcoming tracker, then run the abort loop, then pass it back in) for reload? </td></tr>
  <tr class="msg" id="L17"><td class="ts-cell"><a class="ts" href="#L17" alt="Mon Oct 13 2025 05:47:15 GMT-0700 (Pacific Daylight Time)">12:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@noamr:matrix.org">Noam Rosenthal</span>&gt;</div></td><td class="msg-cell">No need. Because we do that at the beginning of <a href="https://html.spec.whatwg.org/#fire-a-push/replace/reload-navigate-event">https://html.spec.whatwg.org/#fire-a-push/replace/reload-navigate-event</a> before we abort the previous one. It's only needed in the regular <code>navigate()</code> because it's also aborted earlier</td></tr>
  <tr class="msg" id="L18"><td class="ts-cell"><a class="ts" href="#L18" alt="Mon Oct 13 2025 05:47:50 GMT-0700 (Pacific Daylight Time)">12:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@noamr:matrix.org">Noam Rosenthal</span>&gt;</div></td><td class="msg-cell">Oh sorry we don't. will update</td></tr>
  <tr class="msg" id="L19"><td class="ts-cell"><a class="ts" href="#L19" alt="Mon Oct 13 2025 05:53:16 GMT-0700 (Pacific Daylight Time)">12:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@jjaschke:mozilla.org">jjaschke</span>&gt;</div></td><td class="msg-cell"><span class="nick-8">Noam Rosenthal</span> : I see two ways we could follow. One would be to remove <code>upcoming non-traverse API method tracker</code> altogether and just pass it around (if that works, I'd prefer that). Or we keep it, but then I think it should be enough to move it out of the global state <a href="https://whatpr.org/html/11762/305f5a1...3f2f0bc/nav-history-apis.html#:~:text=If%20upcomingMethodTracker%20is%20null%2C%20then%20set%20upcomingMethodTracker%20to%20the%20upcoming%20non%2Dtraverse%20API%20method%20tracker%20%2E">here</a>, then I don't think we need the change in the navigate algorithm (and pass the upcoming non-traverse tracker into the event firing algorithm)</td></tr>
  <tr class="msg" id="L20"><td class="ts-cell"><a class="ts" href="#L20" alt="Mon Oct 13 2025 05:55:28 GMT-0700 (Pacific Daylight Time)">12:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@noamr:matrix.org">Noam Rosenthal</span>&gt;</div></td><td class="msg-cell">That's not enough because <code>navigateerror</code> can also be called from <a href="https://html.spec.whatwg.org/#beginning-navigation:set-the-ongoing-navigation">https://html.spec.whatwg.org/#beginning-navigation:set-the-ongoing-navigation</a></td></tr>
  <tr class="msg" id="L21"><td class="ts-cell"><a class="ts" href="#L21" alt="Mon Oct 13 2025 05:56:52 GMT-0700 (Pacific Daylight Time)">12:56</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@jjaschke:mozilla.org">jjaschke</span>&gt;</div></td><td class="msg-cell">Thanks. Then I'd hope we can go for variant one and remove it from the global state whatsoever.</td></tr>
  <tr class="msg" id="L22"><td class="ts-cell"><a class="ts" href="#L22" alt="Mon Oct 13 2025 06:02:31 GMT-0700 (Pacific Daylight Time)">13:02</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@noamr:matrix.org">Noam Rosenthal</span>&gt;</div></td><td class="msg-cell"><a href="https://github.com/whatwg/html/pull/11779">https://github.com/whatwg/html/pull/11779</a></td></tr>
  <tr class="msg" id="L23"><td class="ts-cell"><a class="ts" href="#L23" alt="Mon Oct 13 2025 06:44:06 GMT-0700 (Pacific Daylight Time)">13:44</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@noamr:matrix.org">Noam Rosenthal</span>&gt;</div></td><td class="msg-cell">OK I think I got it (in the new PR). I moved that state to be a boolean "has been promoted" on the method tracker. then we don't have to mess so much with <code>navigate</code></td></tr>
  <tr class="msg" id="L24"><td class="ts-cell"><a class="ts" href="#L24" alt="Mon Oct 13 2025 06:46:37 GMT-0700 (Pacific Daylight Time)">13:46</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@noamr:matrix.org">Noam Rosenthal</span>&gt;</div></td><td class="msg-cell">this "upcoming method tracker" bit is only for <code>navigate()</code> and <code>reload()</code> calls to ensure that those calls return value is in sync with <code>navigation.transition</code> etc. so I think this new design is cleaner... it's either created early in those calls and passed as an argument, or later on for use of <code>navigation.transition</code> and the rest.</td></tr>

</tbody></table></div></div></div>
</body></html>
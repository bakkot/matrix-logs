<!DOCTYPE html><html><head>
  <title>WHATWG on 2022-07-04</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "WHATWG";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">WHATWG<br>2022-07-04<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2022-07-01" class="nav-link"><span>prev</span></a>
<span style="float:right">next</span>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">
<div class="rhs-header">
<span id="error" style="color: red; display:none">error</span>

<input type="text" id="query" size="25" placeholder="Search WHATWG">
<a id="search-submit" class="button icon-link" title="Search">
  <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"></path></svg>
</a>
</div>

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Sun Jul 03 2022 17:29:18 GMT-0700 (Pacific Daylight Time)">00:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@abkforever:matrix.org">Nikola Abkniky</span>&gt;</div></td><td class="msg-cell">LOGO </td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Mon Jul 04 2022 05:20:48 GMT-0700 (Pacific Daylight Time)">12:20</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@nicolo-ribaudo:matrix.org">nicolo-ribaudo</span>&gt;</div></td><td class="msg-cell">Hi! I recently joined a company that already signed the participation agreement - How do I make <a href="https://participate.whatwg.org/agreement-status?user=nicolo-ribaudo&amp;repo=html">https://participate.whatwg.org/agreement-status?user=nicolo-ribaudo&amp;repo=html</a> pick it up, rather than being stuck on a non-verified signature I submitted last year?</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Mon Jul 04 2022 05:21:48 GMT-0700 (Pacific Daylight Time)">12:21</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@lucacasonato:matrix.org">Luca Casonato</span>&gt;</div></td><td class="msg-cell"><span class="nick-9">nicolo-ribaudo</span>: the reviewer of your first PR should verify it</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Mon Jul 04 2022 05:22:37 GMT-0700 (Pacific Daylight Time)">12:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@nicolo-ribaudo:matrix.org">nicolo-ribaudo</span>&gt;</div></td><td class="msg-cell">Ok thanks! I'll wait until my PR is non-draft before worrying about it</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Mon Jul 04 2022 07:53:34 GMT-0700 (Pacific Daylight Time)">14:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@zcorpan_:matrix.org">zcorpan</span>&gt;</div></td><td class="msg-cell"><span class="nick-12">annevk</span>: is there anything in the websocket spec that still requires what this test is testing? <a href="http://wpt.live/websockets/constructor/014.html">http://wpt.live/websockets/constructor/014.html</a> (i.e. to wait with establishing another websocket connection to the same host while the previous is still connecting, as a DOS prevention mechanism)</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Mon Jul 04 2022 07:57:05 GMT-0700 (Pacific Daylight Time)">14:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@yhirano:matrix.org">Yutaka Hirano</span>&gt;</div></td><td class="msg-cell"><span class="nick-14">zcorpan</span>: <a href="https://datatracker.ietf.org/doc/html/rfc6455#section-4.1">https://datatracker.ietf.org/doc/html/rfc6455#section-4.1</a></td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Mon Jul 04 2022 07:57:40 GMT-0700 (Pacific Daylight Time)">14:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@yhirano:matrix.org">Yutaka Hirano</span>&gt;</div></td><td class="msg-cell">If the client already has a WebSocket connection to the remote
host (IP address) identified by /host/ and port /port/ pair, even
if the remote host is known by another name, the client MUST wait
until that connection has been established or for that connection
to have failed.  There MUST be no more than one connection in a
CONNECTING state.</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Mon Jul 04 2022 07:57:44 GMT-0700 (Pacific Daylight Time)">14:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@yhirano:matrix.org">Yutaka Hirano</span>&gt;</div></td><td class="msg-cell">Maybe this?</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Mon Jul 04 2022 07:58:20 GMT-0700 (Pacific Daylight Time)">14:58</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@zcorpan_:matrix.org">zcorpan</span>&gt;</div></td><td class="msg-cell"><span class="nick-14">Yutaka Hirano</span>: Thanks! Yes. I thought it was defined in the API rather than the protocol</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Mon Jul 04 2022 07:59:25 GMT-0700 (Pacific Daylight Time)">14:59</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@zcorpan_:matrix.org">zcorpan</span>&gt;</div></td><td class="msg-cell">It shouldn't delay the first connection though, but maybe browsers have to wait a microtask or a task to avoid race conditions?</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Mon Jul 04 2022 07:59:40 GMT-0700 (Pacific Daylight Time)">14:59</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@zcorpan_:matrix.org">zcorpan</span>&gt;</div></td><td class="msg-cell">Context: <a href="https://github.com/whatwg/html/issues/8037">https://github.com/whatwg/html/issues/8037</a></td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Mon Jul 04 2022 08:05:20 GMT-0700 (Pacific Daylight Time)">15:05</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@yhirano:matrix.org">Yutaka Hirano</span>&gt;</div></td><td class="msg-cell"><span class="nick-14">zcorpan</span>: Interesting! As long as the connection establishment is fast enough, subsequent WebSocket connections will not be suffered, right?</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Mon Jul 04 2022 08:07:34 GMT-0700 (Pacific Daylight Time)">15:07</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@zcorpan_:matrix.org">zcorpan</span>&gt;</div></td><td class="msg-cell"><span class="nick-14">Yutaka Hirano</span>: The delaying while connecting applies equally for all subsequent connections</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Mon Jul 04 2022 08:09:05 GMT-0700 (Pacific Daylight Time)">15:09</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@zcorpan_:matrix.org">zcorpan</span>&gt;</div></td><td class="msg-cell"><span class="nick-14">Yutaka Hirano</span>: but I mean, for the first connection, there is no prior connection, so no reason for the browser to wait. But how does the browser know for sure that a connection is the first one, without incurring any delay for the first connection? The "establish a WebSocket connection" steps are defined to be in parallel</td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Mon Jul 04 2022 08:09:48 GMT-0700 (Pacific Daylight Time)">15:09</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@zcorpan_:matrix.org">zcorpan</span>&gt;</div></td><td class="msg-cell">Also with the guarantee to never violate the requirement</td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Mon Jul 04 2022 08:12:04 GMT-0700 (Pacific Daylight Time)">15:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@yhirano:matrix.org">Yutaka Hirano</span>&gt;</div></td><td class="msg-cell">@zcorpan: Our implementation runs all the websocket network activities on the same sequence, though It is different from the scripting sequence.</td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Mon Jul 04 2022 08:13:08 GMT-0700 (Pacific Daylight Time)">15:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@yhirano:matrix.org">Yutaka Hirano</span>&gt;</div></td><td class="msg-cell"><span class="nick-14">zcorpan</span>: Thus it is easy for us to distinguish the "first" request (for a server).</td></tr>
  <tr class="msg" id="L17"><td class="ts-cell"><a class="ts" href="#L17" alt="Mon Jul 04 2022 08:15:48 GMT-0700 (Pacific Daylight Time)">15:15</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@zcorpan_:matrix.org">zcorpan</span>&gt;</div></td><td class="msg-cell"><span class="nick-14">Yutaka Hirano</span>: is strelec's claim "I think that the remainder of the main thread execution delays the connection to the socket (if not according to the spec, then by browser implementations)" true in chromium? That is, does the script that calls the WebSocket constructor need to complete before the network connection is started?</td></tr>
  <tr class="msg" id="L18"><td class="ts-cell"><a class="ts" href="#L18" alt="Mon Jul 04 2022 08:18:54 GMT-0700 (Pacific Daylight Time)">15:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@yhirano:matrix.org">Yutaka Hirano</span>&gt;</div></td><td class="msg-cell"><span class="nick-14">zcorpan</span>: Sorry, what do you mean by "complete"?</td></tr>
  <tr class="msg" id="L19"><td class="ts-cell"><a class="ts" href="#L19" alt="Mon Jul 04 2022 08:19:53 GMT-0700 (Pacific Daylight Time)">15:19</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@yhirano:matrix.org">Yutaka Hirano</span>&gt;</div></td><td class="msg-cell">Due to "in parallel", <code>new WebSocket(...)</code> returns immediately. The network connection will be done later.</td></tr>
  <tr class="msg" id="L20"><td class="ts-cell"><a class="ts" href="#L20" alt="Mon Jul 04 2022 08:22:39 GMT-0700 (Pacific Daylight Time)">15:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@zcorpan_:matrix.org">zcorpan</span>&gt;</div></td><td class="msg-cell"><span class="nick-14">Yutaka Hirano</span>: the sync part of the script is run, e.g. in <code>&lt;script&gt;const ws = new WebSocket(url); ws.onopen = handleOpen; await new Promise(resolve =&gt; resolve())&lt;/script&gt;</code> after the onopen handler is registered but before the promise has resolved</td></tr>
  <tr class="msg" id="L21"><td class="ts-cell"><a class="ts" href="#L21" alt="Mon Jul 04 2022 08:23:47 GMT-0700 (Pacific Daylight Time)">15:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@zcorpan_:matrix.org">zcorpan</span>&gt;</div></td><td class="msg-cell">The question is how much later, and does it depend on when the "script" is done?</td></tr>
  <tr class="msg" id="L22"><td class="ts-cell"><a class="ts" href="#L22" alt="Mon Jul 04 2022 08:25:48 GMT-0700 (Pacific Daylight Time)">15:25</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@yhirano:matrix.org">Yutaka Hirano</span>&gt;</div></td><td class="msg-cell"><span class="nick-14">zcorpan</span>: In our implentation, the script completes immediately. The WebSocket constructor kicks the connection procedure in another sequence ("the network thread"). The waiting behavior is implemented in the network thread. Does this answer your question?</td></tr>
  <tr class="msg" id="L23"><td class="ts-cell"><a class="ts" href="#L23" alt="Mon Jul 04 2022 08:27:57 GMT-0700 (Pacific Daylight Time)">15:27</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@zcorpan_:matrix.org">zcorpan</span>&gt;</div></td><td class="msg-cell"><span class="nick-14">Yutaka Hirano</span>: I think so. It sounds like strelec's claim is then not correct (for chromium). To verify, I could do <code>alert(true) {}</code> right after the WebSocket constructor, and the browser would still open a connection from the network thread while the main thread is busy running the infinite loop?</td></tr>
  <tr class="msg" id="L24"><td class="ts-cell"><a class="ts" href="#L24" alt="Mon Jul 04 2022 08:29:24 GMT-0700 (Pacific Daylight Time)">15:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@yhirano:matrix.org">Yutaka Hirano</span>&gt;</div></td><td class="msg-cell"><span class="nick-14">zcorpan</span>: Yes, the connection will be established, but the script wouldn't be able to know that because the <code>onopen</code> handler is blocked by the busy loop.</td></tr>
  <tr class="msg" id="L25"><td class="ts-cell"><a class="ts" href="#L25" alt="Mon Jul 04 2022 08:29:55 GMT-0700 (Pacific Daylight Time)">15:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@zcorpan_:matrix.org">zcorpan</span>&gt;</div></td><td class="msg-cell"><span class="nick-14">Yutaka Hirano</span>: right. Thanks!</td></tr>
  <tr class="msg" id="L26"><td class="ts-cell"><a class="ts" href="#L26" alt="Mon Jul 04 2022 08:30:33 GMT-0700 (Pacific Daylight Time)">15:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@yhirano:matrix.org">Yutaka Hirano</span>&gt;</div></td><td class="msg-cell"><span class="nick-14">zcorpan</span>: You're welcome!</td></tr>
  <tr class="msg" id="L27"><td class="ts-cell"><a class="ts" href="#L27" alt="Mon Jul 04 2022 11:08:31 GMT-0700 (Pacific Daylight Time)">18:08</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@bro2000:matrix.org">The Freelancer</span>&gt;</div></td><td class="msg-cell"><span class="nick-14">zcorpan</span>: Hello, once again.</td></tr>
  <tr class="msg" id="L28"><td class="ts-cell"><a class="ts" href="#L28" alt="Mon Jul 04 2022 11:11:40 GMT-0700 (Pacific Daylight Time)">18:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@bro2000:matrix.org">The Freelancer</span>&gt;</div></td><td class="msg-cell">I wanted to ask one question regarding the DOM, which has been confusing me for a while...</td></tr>
  <tr class="msg" id="L29"><td class="ts-cell"><a class="ts" href="#L29" alt="Mon Jul 04 2022 11:15:50 GMT-0700 (Pacific Daylight Time)">18:15</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@bro2000:matrix.org">The Freelancer</span>&gt;</div></td><td class="msg-cell">Why does querySelectorAll() return a NodeList and not an HTMLCollection instance?</td></tr>
  <tr class="msg" id="L30"><td class="ts-cell"><a class="ts" href="#L30" alt="Mon Jul 04 2022 11:16:48 GMT-0700 (Pacific Daylight Time)">18:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@bro2000:matrix.org">The Freelancer</span>&gt;</div></td><td class="msg-cell">The reasoning I have here is that querySelectorAll() is meant to select elements only, and the HTMLCollection interface suits this notion more than NodeList...</td></tr>
  <tr class="msg" id="L31"><td class="ts-cell"><a class="ts" href="#L31" alt="Mon Jul 04 2022 11:17:28 GMT-0700 (Pacific Daylight Time)">18:17</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@bro2000:matrix.org">The Freelancer</span>&gt;</div></td><td class="msg-cell">NodeList, as the documentation says, is a collection of nodes. For example, for the childNodes property of an element, it makes perfect sense, as it will contain element nodes, text nodes, maybe even comment nodes.</td></tr>
  <tr class="msg" id="L32"><td class="ts-cell"><a class="ts" href="#L32" alt="Mon Jul 04 2022 11:18:30 GMT-0700 (Pacific Daylight Time)">18:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@bro2000:matrix.org">The Freelancer</span>&gt;</div></td><td class="msg-cell">But for querySelectorAll(), using NodeList doesn't make sense, as far as I see it. Clearly, there is some story related to using NodeList for querySelectorAll()...</td></tr>
  <tr class="msg" id="L33"><td class="ts-cell"><a class="ts" href="#L33" alt="Mon Jul 04 2022 14:40:10 GMT-0700 (Pacific Daylight Time)">21:40</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@zcorpan_:matrix.org">zcorpan</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> <span class="nick-14">zcorpan</span>: Hello, once again.</blockquote></mx-reply>Hi! I found this thread from a decade ago where this was discussed. <a href="https://lists.w3.org/Archives/Public/www-dom/2012JanMar/thread.html#msg7">https://lists.w3.org/Archives/Public/www-dom/2012JanMar/thread.html#msg7</a> Back then some browsers returned HTMLCollection and some returned NodeList. HTMLCollection was not yet part of the DOM spec (so the spec layering  concern applied). Also, HTMLCollection has a  named getter which NodeList does not, and nobody likes  these "magic" named getters (but web  compat might  depend on them).</td></tr>
  <tr class="msg" id="L34"><td class="ts-cell"><a class="ts" href="#L34" alt="Mon Jul 04 2022 14:40:46 GMT-0700 (Pacific Daylight Time)">21:40</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@zcorpan_:matrix.org">zcorpan</span>&gt;</div></td><td class="msg-cell">As for making sense, please  see the topic :)</td></tr>
  <tr class="msg" id="L35"><td class="ts-cell"><a class="ts" href="#L35" alt="Mon Jul 04 2022 14:41:51 GMT-0700 (Pacific Daylight Time)">21:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@zcorpan_:matrix.org">zcorpan</span>&gt;</div></td><td class="msg-cell">Both kinds of collections are legacy now, see <a href="https://dom.spec.whatwg.org/#old-style-collections">https://dom.spec.whatwg.org/#old-style-collections</a></td></tr>
  <tr class="msg" id="L36"><td class="ts-cell"><a class="ts" href="#L36" alt="Mon Jul 04 2022 14:43:19 GMT-0700 (Pacific Daylight Time)">21:43</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@zcorpan_:matrix.org">zcorpan</span>&gt;</div></td><td class="msg-cell">and the note in <a href="https://dom.spec.whatwg.org/#interface-htmlcollection">https://dom.spec.whatwg.org/#interface-htmlcollection</a></td></tr>

</tbody></table></div></div></div>
</body></html>
<!DOCTYPE html><html><head>
  <title>WHATWG on 2022-11-18</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "WHATWG";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">WHATWG<br>2022-11-18<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2022-11-17" class="nav-link"><span>prev</span></a>
<span style="float:right">next</span>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">
<div class="rhs-header">
<span id="error" style="color: red; display:none">error</span>

<input type="text" id="query" size="25" placeholder="Search WHATWG">
<a id="search-submit" class="button icon-link" title="Search">
  <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"></path></svg>
</a>
</div>

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Fri Nov 18 2022 01:17:49 GMT-0800 (Pacific Standard Time)">09:17</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@jub0bs:matrix.org">jub0bs</span>&gt;</div></td><td class="msg-cell"> * <p>There's more. Further down, we're encouraged to responds with <code>Vary: Cookie</code> in some circumstances. But isn't that terrible (in terms of cache segmentation) for CDNs / Web caches, since cookie values tend to differ from one user to the next? To quote <a href="https://fastly.com/blog/best-practices-using-vary-header#vary-cookie">https://fastly.com/blog/best-practices-using-vary-header#vary-cookie</a>:</p>
<blockquote>
<p><code>Vary: Cookie</code></p>
<p><code>Cookie</code> is probably one of the most unique request headers, and is therefore very bad.</p>
</blockquote>
</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Fri Nov 18 2022 01:19:12 GMT-0800 (Pacific Standard Time)">09:19</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@annevk:matrix.org">annevk</span>&gt;</div></td><td class="msg-cell"><span class="nick-12">jub0bs</span>: you have to know that Set-Cookie is never used for the response, whether middleware has that information depends</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Fri Nov 18 2022 01:20:41 GMT-0800 (Pacific Standard Time)">09:20</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@annevk:matrix.org">annevk</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">Alice</span>: happy to meet next week, I'm usually available 9-5 Berlin time. Could probably make 8:30 work. Earlier would be tricky, but maybe doable for a one-off.</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Fri Nov 18 2022 02:33:14 GMT-0800 (Pacific Standard Time)">10:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@jub0bs:matrix.org">jub0bs</span>&gt;</div></td><td class="msg-cell"><span class="nick-12">annevk</span>: I guess what I'm trying to figure out is, under the assumption that there are legitimate cases to add <code>Vary: Cookie</code> to a response, should it be the responsibility of CORS middleware? Jake's answer (according to that section of his post) seems to be "yes". But that means CORS middleware must inspect the response to the actual request to decide what to do. None of the existing CORS middleware I've reviewed currently do that; they inspect the actual request, but not the response to it. That's why I'm surprised by Jake's post.</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Fri Nov 18 2022 02:46:02 GMT-0800 (Pacific Standard Time)">10:46</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@jub0bs:matrix.org">jub0bs</span>&gt;</div></td><td class="msg-cell"><p><span class="nick-12">annevk</span>: Unless I missed something, the Fetch standard doesn't provide any guidance about that. The only relevant passage I found only mentions tuning the CORS headers according to the CORS request, not its response:</p>
<blockquote>
<p>Ultimately server developers have a lot of freedom in how they handle HTTP responses [...] They can provide a dynamic response, <em>tuned to CORS request</em>.</p>
</blockquote>
<p>My emphasis.</p>
</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Fri Nov 18 2022 03:04:55 GMT-0800 (Pacific Standard Time)">11:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@annevk:matrix.org">annevk</span>&gt;</div></td><td class="msg-cell">I don't think that sentence considers middleware as separate software from the server.</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Fri Nov 18 2022 04:46:02 GMT-0800 (Pacific Standard Time)">12:46</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@jub0bs:matrix.org">jub0bs</span>&gt;</div></td><td class="msg-cell"><span class="nick-12">annevk</span>: I see, but I'm afraid I need more guidance ðŸ˜€</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Fri Nov 18 2022 04:47:16 GMT-0800 (Pacific Standard Time)">12:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@jub0bs:matrix.org">jub0bs</span>&gt;</div></td><td class="msg-cell"><p>Another element, which contradicts Jake's view, is this SO response by <span class="nick-16">sideshowbarker</span> : <a href="https://stackoverflow.com/a/53248240/2541573">https://stackoverflow.com/a/53248240/2541573</a></p>
<blockquote>
<p>as far as the CORS protocol goes, the receiving server doesnâ€™t change its behavior based on whether the request includes credentials or not.</p>
</blockquote>
</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Fri Nov 18 2022 05:32:59 GMT-0800 (Pacific Standard Time)">13:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@annevk:matrix.org">annevk</span>&gt;</div></td><td class="msg-cell"><span class="nick-12">jub0bs</span>: I don't think there's a contradiction there; again, that's assuming the entire non-client-side knows what it's doing</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Fri Nov 18 2022 05:33:46 GMT-0800 (Pacific Standard Time)">13:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@annevk:matrix.org">annevk</span>&gt;</div></td><td class="msg-cell"><span class="nick-12">jub0bs</span>: the middleware situation is somewhat unique in that the middleware doesn't know whether a response flagged as * would also sometimes use Set-Cookie</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Fri Nov 18 2022 05:34:50 GMT-0800 (Pacific Standard Time)">13:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@annevk:matrix.org">annevk</span>&gt;</div></td><td class="msg-cell"><span class="nick-12">jub0bs</span>: or even if it didn't use Set-Cookie itself, that it would take Cookie request headers into account somehow</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Fri Nov 18 2022 06:07:57 GMT-0800 (Pacific Standard Time)">14:07</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@jub0bs:matrix.org">jub0bs</span>&gt;</div></td><td class="msg-cell"><span class="nick-12">annevk</span>: Now I'm no longer sure that a CORS middleware library can exist. ðŸ˜Ÿ It seems to require a lot of information about how the request is handled and the response composed.</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Fri Nov 18 2022 06:54:14 GMT-0800 (Pacific Standard Time)">14:54</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@annevk:matrix.org">annevk</span>&gt;</div></td><td class="msg-cell"><span class="nick-12">jub0bs</span>: I think you can implement some kind of defaults and perhaps log a warning if they didn't explicitly declare they're not varying on Cookie headers</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Fri Nov 18 2022 06:54:36 GMT-0800 (Pacific Standard Time)">14:54</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@annevk:matrix.org">annevk</span>&gt;</div></td><td class="msg-cell"><span class="nick-12">jub0bs</span>: cause in principle the origin server would have to use Vary: Cookie if they did indeed vary on Cookie, right?</td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Fri Nov 18 2022 06:59:57 GMT-0800 (Pacific Standard Time)">14:59</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@dlrobertson:mozilla.org">dlrobertson</span>&gt;</div></td><td class="msg-cell"><span class="nick-1">Domenic</span>: I have questions about <a href="https://github.com/web-platform-tests/wpt/pull/37018#discussion_r1025934637">https://github.com/web-platform-tests/wpt/pull/37018#discussion_r1025934637</a></td></tr>

</tbody></table></div></div></div>
</body></html>
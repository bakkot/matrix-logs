<!DOCTYPE html><html><head>
  <title>WHATWG on 2023-01-09</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "WHATWG";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">WHATWG<br>2023-01-09<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2023-01-08" class="nav-link"><span>prev</span></a>
<span style="float:right">next</span>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">
<div class="rhs-header">
<span id="error" style="color: red; display:none">error</span>

<input type="text" id="query" size="25" placeholder="Search WHATWG">
<a id="search-submit" class="button icon-link" title="Search">
  <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"></path></svg>
</a>
</div>

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Sun Jan 08 2023 22:29:58 GMT-0800 (Pacific Standard Time)">06:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@annevk:matrix.org">annevk</span>&gt;</div></td><td class="msg-cell"><span class="nick-12">jub0bs</span>: there is <a href="https://fetch.spec.whatwg.org/#http-cors-protocol">https://fetch.spec.whatwg.org/#http-cors-protocol</a> still</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Sun Jan 08 2023 22:31:44 GMT-0800 (Pacific Standard Time)">06:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@annevk:matrix.org">annevk</span>&gt;</div></td><td class="msg-cell"><span class="nick-12">jub0bs</span>: I think I wrote it anew because the old approach wasn't really liked by server developers, but I'm not entirely sure</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Mon Jan 09 2023 01:02:27 GMT-0800 (Pacific Standard Time)">09:02</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@jub0bs:matrix.org">jub0bs</span>&gt;</div></td><td class="msg-cell">Thanks <span class="nick-12">annevk</span>; that actually helps.</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Mon Jan 09 2023 05:21:17 GMT-0800 (Pacific Standard Time)">13:21</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@smaug:mozilla.org">smaug</span>&gt;</div></td><td class="msg-cell"><span class="nick-12">annevk</span>: wasn't your test correct and then someone broke it? <a href="https://searchfox.org/mozilla-central/source/testing/web-platform/tests/html/infrastructure/safe-passing-of-structured-data/shared-array-buffers/blob-data.https.html#109">https://searchfox.org/mozilla-central/source/testing/web-platform/tests/html/infrastructure/safe-passing-of-structured-data/shared-array-buffers/blob-data.https.html#109</a></td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Mon Jan 09 2023 05:30:56 GMT-0800 (Pacific Standard Time)">13:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@smaug:mozilla.org">smaug</span>&gt;</div></td><td class="msg-cell">or perhaps I'm missing something? Chrome has had issues with data: urls elsewhere, like <a href="https://github.com/w3c/webappsec-secure-contexts/issues/69#issuecomment-585780599">https://github.com/w3c/webappsec-secure-contexts/issues/69#issuecomment-585780599</a> </td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Mon Jan 09 2023 05:32:01 GMT-0800 (Pacific Standard Time)">13:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@annevk:matrix.org">annevk</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">smaug</span>: the most significant change I can find is <a href="https://github.com/web-platform-tests/wpt/commit/ce281cc3f32d8e93ecbb33a51321d846ee2aae37">https://github.com/web-platform-tests/wpt/commit/ce281cc3f32d8e93ecbb33a51321d846ee2aae37</a></td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Mon Jan 09 2023 05:32:40 GMT-0800 (Pacific Standard Time)">13:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@smaug:mozilla.org">smaug</span>&gt;</div></td><td class="msg-cell">right. The question is how data: workers should behave</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Mon Jan 09 2023 05:34:19 GMT-0800 (Pacific Standard Time)">13:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@smaug:mozilla.org">smaug</span>&gt;</div></td><td class="msg-cell">er, I was missing something</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Mon Jan 09 2023 05:34:29 GMT-0800 (Pacific Standard Time)">13:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@smaug:mozilla.org">smaug</span>&gt;</div></td><td class="msg-cell">"If is shared is false and response's url's scheme is "data", then set worker global scope's cross-origin isolated capability to false."</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Mon Jan 09 2023 05:35:20 GMT-0800 (Pacific Standard Time)">13:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@annevk:matrix.org">annevk</span>&gt;</div></td><td class="msg-cell">I'm not sure if Firefox has the "capability" feature, that got added a bit later</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Mon Jan 09 2023 05:35:55 GMT-0800 (Pacific Standard Time)">13:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@annevk:matrix.org">annevk</span>&gt;</div></td><td class="msg-cell">It also had some wrinkles around shared/service workers that might not be sorted yet spec-wise</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Mon Jan 09 2023 07:14:28 GMT-0800 (Pacific Standard Time)">15:14</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@jub0bs:matrix.org">jub0bs</span>&gt;</div></td><td class="msg-cell"><span class="nick-12">annevk</span>: In connection with my earlier question: I think one reason why many people find debugging CORS issues frustrating is that CORS-middleware developers followed that resource-processing model to the letter, and never relaxed their implementation when the spec moved to the Fetch standard.</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Mon Jan 09 2023 07:19:20 GMT-0800 (Pacific Standard Time)">15:19</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@jub0bs:matrix.org">jub0bs</span>&gt;</div></td><td class="msg-cell"><p>One example: Alice configures CORS on <code><a href="https://alice.com">https://alice.com</a></code> to allow <code><a href="https://example.com">https://example.com</a></code> with request headers <code>Authorization</code>. However, in her client (running on <code><a href="https://example.com">https://example.com</a></code>), she also sends some <code>Foo</code> request header: <code>fetch('//<a href="http://alice.com">alice.com</a>', {headers: {'Foo': 'Foo'}})</code>. Obviously, CORS preflight then fails because the <code>Foo</code> header isn't allowed in Alice's CORS config. But most middleware libraries, according to the resource-processing model (as I understand it) would omit the ACAO header altogether from the response. When debugging the CORS error in the browser, Alice would be confronted with an error message like</p>
<blockquote>
<p>Response to preflight request doesn't pass access control check: No 'Access-Control-Allow-Origin' header is present on the requested resource.</p>
</blockquote>
<p>which is true but a bit misleading about the actual reason why the server didn't respond with the required CORS headers (i.e. that request header <code>Foo</code> is not allowed).</p>
</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Mon Jan 09 2023 07:23:36 GMT-0800 (Pacific Standard Time)">15:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@jub0bs:matrix.org">jub0bs</span>&gt;</div></td><td class="msg-cell"><p>In my experience, many CORS-related questions asked on Stack Overflow stem from this design decision. But that's not inevitable. A CORS middleware library could reply with <code>ACAO: <a href="https://example.com">https://example.com</a></code> and no ACAH header (or simply <code>ACAH: authorization</code>). Then the browser's error message would be more useful for debugging purposes:</p>
<blockquote>
<p>Request header field Foo is not allowed by Access-Control-Allow-Headers in preflight response.</p>
</blockquote>
</td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Mon Jan 09 2023 07:23:44 GMT-0800 (Pacific Standard Time)">15:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@annevk:matrix.org">annevk</span>&gt;</div></td><td class="msg-cell">From a theoretical perspective it does seem better to not reveal any information though in such a scenario.</td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Mon Jan 09 2023 07:24:22 GMT-0800 (Pacific Standard Time)">15:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@jub0bs:matrix.org">jub0bs</span>&gt;</div></td><td class="msg-cell">What are you concerned about, specifically? Some side channel?</td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Mon Jan 09 2023 07:25:42 GMT-0800 (Pacific Standard Time)">15:25</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@annevk:matrix.org">annevk</span>&gt;</div></td><td class="msg-cell">Yeah. But you're right that it would make specialized error messages harder. Either way browsers could do more than they are doing and list all the required headers. And middleware could probably offer debug and strict modes.</td></tr>
  <tr class="msg" id="L17"><td class="ts-cell"><a class="ts" href="#L17" alt="Mon Jan 09 2023 07:27:36 GMT-0800 (Pacific Standard Time)">15:27</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@jub0bs:matrix.org">jub0bs</span>&gt;</div></td><td class="msg-cell">I've thought about offering debug/strict modes in my CORS middleware, but I'm not 100% convinced. My users would have to know the option exists, activate it, redeploy, test, then deactivate it and redeploy once more. And I'm not sure whether (or how quickly) browser vendors could be convinced to produce more informative error messages, to be honest...</td></tr>
  <tr class="msg" id="L18"><td class="ts-cell"><a class="ts" href="#L18" alt="Mon Jan 09 2023 07:29:06 GMT-0800 (Pacific Standard Time)">15:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@jub0bs:matrix.org">jub0bs</span>&gt;</div></td><td class="msg-cell"><p>Since nothing much happens during preflight on the server side (as the CORS middleware should handle the preflight request rather than passing it on to the next handler in the chain), I'm wondering whether worrying about side-channel attacks during preflight is justified. Do you know of such attacks? I know the Fetch standard mentions that possibility:</p>
<blockquote>
<p>Any other kind of HTTP response is not successful and will either end up not being shared or fail the CORS-preflight request. Be aware that any work the server performs might nonetheless leak through side channels, such as timing. If server developers wish to denote this explicitly, the 403 status can be used, coupled with omitting the relevant headers.</p>
</blockquote>
<p>But has it ever been an issue in practice?</p>
</td></tr>

</tbody></table></div></div></div>
</body></html>
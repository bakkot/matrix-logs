<!DOCTYPE html><html><head>
  <title>WHATWG on 2022-09-27</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "WHATWG";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">WHATWG<br>2022-09-27<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2022-09-26" class="nav-link"><span>prev</span></a>
<span style="float:right">next</span>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">
<div class="rhs-header">
<span id="error" style="color: red; display:none">error</span>

<input type="text" id="query" size="25" placeholder="Search WHATWG">
<a id="search-submit" class="button icon-link" title="Search">
  <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"></path></svg>
</a>
</div>

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Mon Sep 26 2022 18:08:19 GMT-0700 (Pacific Daylight Time)">01:08</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@khafra:matrix.org">khafra</span>&gt;</div></td><td class="msg-cell"><p>With fetch, an implementation is supposed to throw an AbortError DOMException when consuming the body if the signal passed to fetch is aborted, however I'm unsure which part of the spec covers this. Does anyone know where this comes from? Thanks, would be super helpful</p>
<pre><code class="language-js">const ac = new AbortController()
const { signal } = ac

const response = await fetch('https://example.com', {
	signal: signal
})

ac.abort()

await response.text()
</code></pre>
</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Mon Sep 26 2022 18:16:56 GMT-0700 (Pacific Daylight Time)">01:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-1" title="@domenicdenicola:matrix.org">Domenic</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> <p>With fetch, an implementation is supposed to throw an AbortError DOMException when consuming the body if the signal passed to fetch is aborted, however I'm unsure which part of the spec covers this. Does anyone know where this comes from? Thanks, would be super helpful</p>
<pre><code class="language-js">const ac = new AbortController()
const { signal } = ac

const response = await fetch('https://example.com', {
	signal: signal
})

ac.abort()

await response.text()
</code></pre>
</blockquote></mx-reply><a href="https://fetch.spec.whatwg.org/#abort-fetch">https://fetch.spec.whatwg.org/#abort-fetch</a></td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Mon Sep 26 2022 18:18:28 GMT-0700 (Pacific Daylight Time)">01:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-1" title="@domenicdenicola:matrix.org">Domenic</span>&gt;</div></td><td class="msg-cell">step 6</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Mon Sep 26 2022 20:20:37 GMT-0700 (Pacific Daylight Time)">03:20</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@khafra:matrix.org">khafra</span>&gt;</div></td><td class="msg-cell">thanks, had an issue where the error was getting swallowed. Got it sorted out now :)</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Mon Sep 26 2022 22:58:23 GMT-0700 (Pacific Daylight Time)">05:58</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@hsivonen:mozilla.org">hsivonen</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> Filed as <a href="https://github.com/microsoft/vscode/issues/161764">https://github.com/microsoft/vscode/issues/161764</a></blockquote></mx-reply>Well, that wasn't particularly successful.</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Tue Sep 27 2022 01:36:07 GMT-0700 (Pacific Daylight Time)">08:36</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@johannhof:matrix.org">johannhof</span>&gt;</div></td><td class="msg-cell">It really feels like specs are extremely inconsistent in which error to throw when some common condition such as not "allowed to use", non-fully active document or missing user activation is checked.</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Tue Sep 27 2022 01:38:23 GMT-0700 (Pacific Daylight Time)">08:38</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@annevk:matrix.org">annevk</span>&gt;</div></td><td class="msg-cell">In part it's because web developers don't branch on exception types and JavaScript doesn't really encourage that kind of programming either.</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Tue Sep 27 2022 01:39:39 GMT-0700 (Pacific Daylight Time)">08:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@annevk:matrix.org">annevk</span>&gt;</div></td><td class="msg-cell">So my recommendation is to just <code>TypeError</code> most things. Now, <code>AbortSignal</code> has changed things a bit so if the API takes a signal perhaps some non-"<code>AbortError</code>" <code>DOMException</code> makes sense.</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Tue Sep 27 2022 01:41:04 GMT-0700 (Pacific Daylight Time)">08:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@johannhof:matrix.org">johannhof</span>&gt;</div></td><td class="msg-cell">So, if, say, ~70% of precedent is "NotAllowedError" and 30% are something else including TypeError, should we still use TypeError?</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Tue Sep 27 2022 01:41:11 GMT-0700 (Pacific Daylight Time)">08:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@annevk:matrix.org">annevk</span>&gt;</div></td><td class="msg-cell">(Also, nobody would fault you for making this consistent. You might even get some applause.)</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Tue Sep 27 2022 01:41:23 GMT-0700 (Pacific Daylight Time)">08:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@johannhof:matrix.org">johannhof</span>&gt;</div></td><td class="msg-cell">Or does precedent with other specs matter at all here?</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Tue Sep 27 2022 01:42:19 GMT-0700 (Pacific Daylight Time)">08:42</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@johannhof:matrix.org">johannhof</span>&gt;</div></td><td class="msg-cell">Yeah I was thinking of just going around sending PRs to make things consistent but really don't want to deal with the compat fallout :D Are you saying there's likely not that much breakage as developers don't branch on types anyway?</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Tue Sep 27 2022 01:43:32 GMT-0700 (Pacific Daylight Time)">08:43</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@annevk:matrix.org">annevk</span>&gt;</div></td><td class="msg-cell">Historically it's been pretty easy to change exceptions around, yeah. I think you're right that simpler advice would be welcome here, but I'm not immediately sure where it would go. Web IDL or the TAG's document on APIs I suppose.</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Tue Sep 27 2022 01:45:31 GMT-0700 (Pacific Daylight Time)">08:45</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@annevk:matrix.org">annevk</span>&gt;</div></td><td class="msg-cell">E.g., <a href="https://www.w3.org/TR/DOM-Level-2/range.html#RangeException">https://www.w3.org/TR/DOM-Level-2/range.html#RangeException</a> was a thing.</td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Tue Sep 27 2022 01:47:42 GMT-0700 (Pacific Daylight Time)">08:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@sideshowbarker:matrix.org">sideshowbarker</span>&gt;</div></td><td class="msg-cell"><p><span class="nick-15">hsivonen</span>: <a href="https://lists.w3.org/Archives/Public/www-validator/2022Sep/0012.html">https://lists.w3.org/Archives/Public/www-validator/2022Sep/0012.html</a></p>
<p>I have the self-closing-tag check in the Tokenizer code but I guess I should have it in the TreeBuilder code instead — so I can make it namespace-aware, and so that the warning doesn’t get reported for SVG elements.</p>
</td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Tue Sep 27 2022 02:06:03 GMT-0700 (Pacific Daylight Time)">09:06</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@hsivonen:mozilla.org">hsivonen</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> <p><span class="nick-15">hsivonen</span>: <a href="https://lists.w3.org/Archives/Public/www-validator/2022Sep/0012.html">https://lists.w3.org/Archives/Public/www-validator/2022Sep/0012.html</a></p>
<p>I have the self-closing-tag check in the Tokenizer code but I guess I should have it in the TreeBuilder code instead — so I can make it namespace-aware, and so that the warning doesn’t get reported for SVG elements.</p>
</blockquote></mx-reply>Sorry. Bad review on my part. Yeah, it should go in the tree builder where the slash is acknowledged.</td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Tue Sep 27 2022 02:12:08 GMT-0700 (Pacific Daylight Time)">09:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@annevk:matrix.org">annevk</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">hsivonen</span>: I don't really see negative tests for old IBM encoding labels; do you remember creating those?</td></tr>
  <tr class="msg" id="L17"><td class="ts-cell"><a class="ts" href="#L17" alt="Tue Sep 27 2022 02:12:51 GMT-0700 (Pacific Daylight Time)">09:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@annevk:matrix.org">annevk</span>&gt;</div></td><td class="msg-cell">We could maybe add some to <code>unsupported-encodings.any.js</code> though I'm not sure as we'd have to assume some kind of default I guess. We do for UTF-7 and UTF-32 though so maybe that's okay?</td></tr>
  <tr class="msg" id="L18"><td class="ts-cell"><a class="ts" href="#L18" alt="Tue Sep 27 2022 02:12:54 GMT-0700 (Pacific Daylight Time)">09:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@hsivonen:mozilla.org">hsivonen</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> <span class="nick-15">hsivonen</span>: I don't really see negative tests for old IBM encoding labels; do you remember creating those?</blockquote></mx-reply>I don't remember creating negative tests for those.</td></tr>
  <tr class="msg" id="L19"><td class="ts-cell"><a class="ts" href="#L19" alt="Tue Sep 27 2022 02:14:10 GMT-0700 (Pacific Daylight Time)">09:14</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@hsivonen:mozilla.org">hsivonen</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> We could maybe add some to <code>unsupported-encodings.any.js</code> though I'm not sure as we'd have to assume some kind of default I guess. We do for UTF-7 and UTF-32 though so maybe that's okay?</blockquote></mx-reply>Should be safe to assume a windows-1252 default if the content is ASCII. If in the future we do the work to change that case to result in UTF-8, we can change the tests at that time.</td></tr>
  <tr class="msg" id="L20"><td class="ts-cell"><a class="ts" href="#L20" alt="Tue Sep 27 2022 02:15:19 GMT-0700 (Pacific Daylight Time)">09:15</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@annevk:matrix.org">annevk</span>&gt;</div></td><td class="msg-cell">I wonder why I waited, perhaps because we also had this idea of using the replacement encoding for some.</td></tr>
  <tr class="msg" id="L21"><td class="ts-cell"><a class="ts" href="#L21" alt="Tue Sep 27 2022 02:44:25 GMT-0700 (Pacific Daylight Time)">09:44</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@sideshowbarker:matrix.org">sideshowbarker</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">hsivonen</span>: r? <a href="https://github.com/validator/htmlparser/pull/74">https://github.com/validator/htmlparser/pull/74</a></td></tr>
  <tr class="msg" id="L22"><td class="ts-cell"><a class="ts" href="#L22" alt="Tue Sep 27 2022 03:09:39 GMT-0700 (Pacific Daylight Time)">10:09</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-1" title="@domenicdenicola:matrix.org">Domenic</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> So, if, say, ~70% of precedent is "NotAllowedError" and 30% are something else including TypeError, should we still use TypeError?</blockquote></mx-reply>I'd be more in favor of consistent, separate error types. I agree with Anne that it doesn't matter much, but my takeaway isn't to convert everything to TypeError, personally.</td></tr>
  <tr class="msg" id="L23"><td class="ts-cell"><a class="ts" href="#L23" alt="Tue Sep 27 2022 03:10:03 GMT-0700 (Pacific Daylight Time)">10:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-1" title="@domenicdenicola:matrix.org">Domenic</span>&gt;</div></td><td class="msg-cell">I've ended up on "NotAllowedError" for allowed to use, "InvalidStateError" for non-fully active document... not sure about user activation.</td></tr>
  <tr class="msg" id="L24"><td class="ts-cell"><a class="ts" href="#L24" alt="Tue Sep 27 2022 03:12:18 GMT-0700 (Pacific Daylight Time)">10:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@johannhof:matrix.org">johannhof</span>&gt;</div></td><td class="msg-cell">I think that would be "SecurityError" by majority vote</td></tr>
  <tr class="msg" id="L25"><td class="ts-cell"><a class="ts" href="#L25" alt="Tue Sep 27 2022 03:14:12 GMT-0700 (Pacific Daylight Time)">10:14</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@johannhof:matrix.org">johannhof</span>&gt;</div></td><td class="msg-cell">Yeah intuitively I agree with you <span class="nick-1">Domenic</span> that just flattening all errors to one type seems a little oversimplistic?</td></tr>
  <tr class="msg" id="L26"><td class="ts-cell"><a class="ts" href="#L26" alt="Tue Sep 27 2022 03:15:21 GMT-0700 (Pacific Daylight Time)">10:15</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@annevk:matrix.org">annevk</span>&gt;</div></td><td class="msg-cell">I don't feel strongly, but I also rather not reveal more information than strictly necessary. The states alluded to above end up exposed in other ways as well so they are probably fine though.</td></tr>
  <tr class="msg" id="L27"><td class="ts-cell"><a class="ts" href="#L27" alt="Tue Sep 27 2022 03:16:45 GMT-0700 (Pacific Daylight Time)">10:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@johannhof:matrix.org">johannhof</span>&gt;</div></td><td class="msg-cell">(also don't fully understand "NotAllowedError" vs. "SecurityError" use cases, and looking at specs I suspect most people don't)</td></tr>
  <tr class="msg" id="L28"><td class="ts-cell"><a class="ts" href="#L28" alt="Tue Sep 27 2022 03:16:59 GMT-0700 (Pacific Daylight Time)">10:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@johannhof:matrix.org">johannhof</span>&gt;</div></td><td class="msg-cell">I guess there are things that aren't allowed for non-security reasons</td></tr>
  <tr class="msg" id="L29"><td class="ts-cell"><a class="ts" href="#L29" alt="Tue Sep 27 2022 03:17:54 GMT-0700 (Pacific Daylight Time)">10:17</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-1" title="@domenicdenicola:matrix.org">Domenic</span>&gt;</div></td><td class="msg-cell">Right, although I can't imagine we've been very clear about what's a security reason vs. not, and I'm not sure I'd classify either permissions policy or user activation as a security reason :)</td></tr>
  <tr class="msg" id="L30"><td class="ts-cell"><a class="ts" href="#L30" alt="Tue Sep 27 2022 03:18:10 GMT-0700 (Pacific Daylight Time)">10:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-1" title="@domenicdenicola:matrix.org">Domenic</span>&gt;</div></td><td class="msg-cell">I guess the most clear-cut "SecurityError" cases are cross-origin access stuff</td></tr>
  <tr class="msg" id="L31"><td class="ts-cell"><a class="ts" href="#L31" alt="Tue Sep 27 2022 03:19:46 GMT-0700 (Pacific Daylight Time)">10:19</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@johannhof:matrix.org">johannhof</span>&gt;</div></td><td class="msg-cell">Yeah looking at <a href="https://webidl.spec.whatwg.org/#notallowederror">https://webidl.spec.whatwg.org/#notallowederror</a> those two actually seem clear cut for NotAllowedError</td></tr>

</tbody></table></div></div></div>
</body></html>
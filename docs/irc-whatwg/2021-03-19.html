<!doctype html>
<head>
  <title>#whatwg on 2021-03-19</title>
  <link rel="stylesheet" href="../style.css">
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">#whatwg<br>2021-03-19<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2021-03-18" class="nav-link"><span>prev</span></a>
<a href="2021-03-20" class="nav-link"><span style="float:right">next</span></a>
</div>
    
<div class="room-list-wrapper">Active:<br>
<ul class="room-list">
<li><a href="../TC39_Delegates/">TC39 Delegates</a></li>
<li><a href="../TC39_Editors/">TC39 Editors</a></li>
<li><a href="../TC39_General/">TC39 General</a></li>
<li><a href="../WHATWG/">WHATWG</a></li>
</ul>
</div>
<br>
<div class="room-list-wrapper">Historical:<br>
<ul class="room-list">
<li><a href="../irc-tc39/">#tc39</a></li>
<li><a href="../irc-tc39-delegates/">#tc39-delegates</a></li>
<li><a href="../irc-tc39-editor-group/">#tc39-editor-group</a></li>
<li><a href="../irc-whatwg/" class="current-room">#whatwg</a></li>
</ul>
</div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">
<div class="rhs-header">
<span id="error" style="color: red; display:none">error</span>
<input type="text" id="query" size=25 placeholder="Search #whatwg">
<a id="search-submit" class="button icon-link" title="Search">
  <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"></path></svg>
</a>
</div>

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Fri Mar 19 2021 03:28:48 GMT-0700 (Pacific Daylight Time)">10:28</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title=noamr@irc>noamr</span>&gt;</div></td><td class="msg-cell">annevk: with FETCH/RT, I&#039;m contemplating between the current approach (responseDone -&gt; the caller calls <a href="http://FETCH.report">FETCH.report</a>) and an approach of passing initiatorType as a param to FETCH , and having FETCH report it instead of passing it as a param... this way in the HTML spec all we have to do is &quot;Fetch the request with initiatorType set to link&quot; and FETCH can report with that param and the request&#039;s client&#039;s global object</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Fri Mar 19 2021 03:31:06 GMT-0700 (Pacific Daylight Time)">10:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title=annevk@irc>annevk</span>&gt;</div></td><td class="msg-cell">noamr: I think it&#039;s okay to add initiator type to request, though maybe we should call it legacy destination or some such to avoid more folks taking a dependency</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Fri Mar 19 2021 03:31:44 GMT-0700 (Pacific Daylight Time)">10:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title=noamr@irc>noamr</span>&gt;</div></td><td class="msg-cell">annevk: it&#039;s not really a legacy destination, it&#039;s the &quot;resource initiator type&quot; for Resource Timing</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Fri Mar 19 2021 03:32:39 GMT-0700 (Pacific Daylight Time)">10:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title=noamr@irc>noamr</span>&gt;</div></td><td class="msg-cell">annevk: that would mean FETCH does all the reporting, and perhaps queues the task on the global object so that RT doesn&#039;t have to deal with that. Sounds good?</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Fri Mar 19 2021 03:40:09 GMT-0700 (Pacific Daylight Time)">10:40</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title=annevk@irc>annevk</span>&gt;</div></td><td class="msg-cell">noamr: well, it is, but if RT was done today that wouldn&#039;t have been a thing is what I&#039;m saying</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Fri Mar 19 2021 03:40:35 GMT-0700 (Pacific Daylight Time)">10:40</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title=annevk@irc>annevk</span>&gt;</div></td><td class="msg-cell">noamr: yeah, I think that makes sense for all main thread callers of fetch</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Fri Mar 19 2021 03:41:22 GMT-0700 (Pacific Daylight Time)">10:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title=annevk@irc>annevk</span>&gt;</div></td><td class="msg-cell">noamr: well, hmm, it depends a bit on the specifics of how we integrate all this, as e.g. I still think it makes sense that if the caller dispatches a load event, that happens in the same task</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Fri Mar 19 2021 03:41:50 GMT-0700 (Pacific Daylight Time)">10:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title=annevk@irc>annevk</span>&gt;</div></td><td class="msg-cell">that is possible, to be clear, but it requires processResponseEndOfBody to be a superset of processResponseDone</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Fri Mar 19 2021 03:44:27 GMT-0700 (Pacific Daylight Time)">10:44</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title=noamr@irc>noamr</span>&gt;</div></td><td class="msg-cell">annevk: I&#039;m thinking to do this outside the whole streams thing, and do it when there are no more bytes in the response. That way, it&#039;s done before those bytes are fed to the stream and processResponseEndOfBody is called</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Fri Mar 19 2021 03:46:09 GMT-0700 (Pacific Daylight Time)">10:46</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title=noamr@irc>noamr</span>&gt;</div></td><td class="msg-cell">where I do reporting in my current PR, there is not really a real connection with processResponseEndOfBody, not sure why it needs to be a superset</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Fri Mar 19 2021 03:46:46 GMT-0700 (Pacific Daylight Time)">10:46</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title=noamr@irc>noamr</span>&gt;</div></td><td class="msg-cell">can be HTTP receives bytes -&gt; if no more bytes, report to RT and mark &quot;request done&quot; -&gt; pass bytes to stream that the body consumer is reading</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Fri Mar 19 2021 03:50:16 GMT-0700 (Pacific Daylight Time)">10:50</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title=noamr@irc>noamr</span>&gt;</div></td><td class="msg-cell">annevk: otherwise, I&#039;d rather keep the current setup where the processResponseDone event is separate from streams</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Fri Mar 19 2021 03:58:12 GMT-0700 (Pacific Daylight Time)">10:58</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title=annevk@irc>annevk</span>&gt;</div></td><td class="msg-cell">noamr: the way I was thinking about it is that if someone passes processResponseEndOfBody, and processResponseDone happens, we&#039;d fully read and pass on the data as well as do the RT steps, and the caller would fire the load event from there; or are RT objects consistently created way before the load event?</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Fri Mar 19 2021 03:59:22 GMT-0700 (Pacific Daylight Time)">10:59</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title=annevk@irc>annevk</span>&gt;</div></td><td class="msg-cell">noamr: it seems likely that implementations do things incrementally and once all bytes are in they&#039;d create the RT object, update state, and fire the load event all at once</td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Fri Mar 19 2021 04:03:28 GMT-0700 (Pacific Daylight Time)">11:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title=noamr@irc>noamr</span>&gt;</div></td><td class="msg-cell">annevk: implementations set the response_end right when all the bytes come from the HTTP source, and report it at some unspecified time in the future, sometimes after a timer</td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Fri Mar 19 2021 04:05:30 GMT-0700 (Pacific Daylight Time)">11:05</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title=noamr@irc>noamr</span>&gt;</div></td><td class="msg-cell">ah `processResponseEndOfBody`, got confused with `processEndOfBody`. does any spec use that one?</td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Fri Mar 19 2021 04:05:51 GMT-0700 (Pacific Daylight Time)">11:05</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title=annevk@irc>annevk</span>&gt;</div></td><td class="msg-cell">noamr: I think it would be good to align the reporting with the load event</td></tr>
  <tr class="msg" id="L17"><td class="ts-cell"><a class="ts" href="#L17" alt="Fri Mar 19 2021 04:06:58 GMT-0700 (Pacific Daylight Time)">11:06</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title=annevk@irc>annevk</span>&gt;</div></td><td class="msg-cell">noamr: processEndOfBody is for body read algorithms only, right? XHR prolly does</td></tr>
  <tr class="msg" id="L18"><td class="ts-cell"><a class="ts" href="#L18" alt="Fri Mar 19 2021 04:07:25 GMT-0700 (Pacific Daylight Time)">11:07</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title=annevk@irc>annevk</span>&gt;</div></td><td class="msg-cell">(I was talking about the fetch algorithm itself)</td></tr>
  <tr class="msg" id="L19"><td class="ts-cell"><a class="ts" href="#L19" alt="Fri Mar 19 2021 04:11:02 GMT-0700 (Pacific Daylight Time)">11:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title=noamr@irc>noamr</span>&gt;</div></td><td class="msg-cell">annevk: XHR callse processEndOfBody</td></tr>
  <tr class="msg" id="L20"><td class="ts-cell"><a class="ts" href="#L20" alt="Fri Mar 19 2021 04:11:07 GMT-0700 (Pacific Daylight Time)">11:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title=noamr@irc>noamr</span>&gt;</div></td><td class="msg-cell">not processResponseEndOfBody</td></tr>
  <tr class="msg" id="L21"><td class="ts-cell"><a class="ts" href="#L21" alt="Fri Mar 19 2021 04:11:52 GMT-0700 (Pacific Daylight Time)">11:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title=noamr@irc>noamr</span>&gt;</div></td><td class="msg-cell">ah it uses processResponseEndOfBody for sync responses</td></tr>
  <tr class="msg" id="L22"><td class="ts-cell"><a class="ts" href="#L22" alt="Fri Mar 19 2021 04:11:56 GMT-0700 (Pacific Daylight Time)">11:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title=annevk@irc>annevk</span>&gt;</div></td><td class="msg-cell">noamr: right, I thought that&#039;s what you were asking. processResponseEndOfBody isn&#039;t used at the moment, but I would expect HTML to use that as HTML typically wants all the bytes in one go</td></tr>
  <tr class="msg" id="L23"><td class="ts-cell"><a class="ts" href="#L23" alt="Fri Mar 19 2021 04:12:04 GMT-0700 (Pacific Daylight Time)">11:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title=annevk@irc>annevk</span>&gt;</div></td><td class="msg-cell">oh right, XHR uses it too</td></tr>
  <tr class="msg" id="L24"><td class="ts-cell"><a class="ts" href="#L24" alt="Fri Mar 19 2021 04:13:44 GMT-0700 (Pacific Daylight Time)">11:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title=noamr@irc>noamr</span>&gt;</div></td><td class="msg-cell">annevk: so you&#039;re proposing the caller would report RT in its processResponseEndOfBody, or that FETCH would report RT right before calling processResponseEndOfBody if that exists? I&#039;m a bit confused</td></tr>
  <tr class="msg" id="L25"><td class="ts-cell"><a class="ts" href="#L25" alt="Fri Mar 19 2021 04:16:02 GMT-0700 (Pacific Daylight Time)">11:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title=noamr@irc>noamr</span>&gt;</div></td><td class="msg-cell">annevk: we can do a thing where FETCH reports RT right before calling processResponseEndOfBody, otherwise report it at EOF, and in either case only if it has a &quot;resource initiator type&quot; as a FETCH param. but maybe instead we can keep the current design where the caller reports RT, and some callers can report in their  processResponseEndOfBody, leaviing processResponseDone for callers like fetch()</td></tr>
  <tr class="msg" id="L26"><td class="ts-cell"><a class="ts" href="#L26" alt="Fri Mar 19 2021 04:16:54 GMT-0700 (Pacific Daylight Time)">11:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title=noamr@irc>noamr</span>&gt;</div></td><td class="msg-cell">since from what you&#039;re saying seems like we might want to have callers do slightly different things so that reporting is synchornized with load events, maybe the latter would be best (keep current design and align with processResponseBodyEnd for some callers)</td></tr>
  <tr class="msg" id="L27"><td class="ts-cell"><a class="ts" href="#L27" alt="Fri Mar 19 2021 04:18:17 GMT-0700 (Pacific Daylight Time)">11:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title=annevk@irc>annevk</span>&gt;</div></td><td class="msg-cell">noamr: I think you got the idea, but I tend to agree that we should maybe only do this once we have a better understanding of the callers</td></tr>
  <tr class="msg" id="L28"><td class="ts-cell"><a class="ts" href="#L28" alt="Fri Mar 19 2021 04:20:00 GMT-0700 (Pacific Daylight Time)">11:20</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title=noamr@irc>noamr</span>&gt;</div></td><td class="msg-cell">annevk: yea, so for now the PR uses processResponseDone for fetch(), and XHR knows by itself when to report. Can we try to move forward with this, and iterate on the following callers?</td></tr>
  <tr class="msg" id="L29"><td class="ts-cell"><a class="ts" href="#L29" alt="Fri Mar 19 2021 04:21:06 GMT-0700 (Pacific Daylight Time)">11:21</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title=noamr@irc>noamr</span>&gt;</div></td><td class="msg-cell">most of the rest of the callers are not properly integrated with fetch</td></tr>
  <tr class="msg" id="L30"><td class="ts-cell"><a class="ts" href="#L30" alt="Fri Mar 19 2021 04:25:49 GMT-0700 (Pacific Daylight Time)">11:25</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title=annevk@irc>annevk</span>&gt;</div></td><td class="msg-cell">noamr: yeah I think so, I&#039;m not sure I&#039;ll get to review today, I do have the hr-time proposal ready</td></tr>
  <tr class="msg" id="L31"><td class="ts-cell"><a class="ts" href="#L31" alt="Fri Mar 19 2021 04:26:51 GMT-0700 (Pacific Daylight Time)">11:26</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title=noamr@irc>noamr</span>&gt;</div></td><td class="msg-cell">annevk: cool. looking forward!</td></tr>
  <tr class="msg" id="L32"><td class="ts-cell"><a class="ts" href="#L32" alt="Fri Mar 19 2021 04:32:03 GMT-0700 (Pacific Daylight Time)">11:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title=annevk@irc>annevk</span>&gt;</div></td><td class="msg-cell">noamr: yoav: <a href="https://github.com/w3c/hr-time/pull/112">https://github.com/w3c/hr-time/pull/112</a></td></tr>
  <tr class="msg" id="L33"><td class="ts-cell"><a class="ts" href="#L33" alt="Fri Mar 19 2021 04:45:00 GMT-0700 (Pacific Daylight Time)">11:45</a></td><td class="nick-cell"><div class="m-ov"><span class="nick nick-9" title=yoav@irc>yoav</span></div></td><td class="msg-cell">Will look after lunch</td></tr>
  <tr class="msg" id="L34"><td class="ts-cell"><a class="ts" href="#L34" alt="Fri Mar 19 2021 05:15:06 GMT-0700 (Pacific Daylight Time)">12:15</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title=yoav@irc>yoav</span>&gt;</div></td><td class="msg-cell">Merged!</td></tr>
  <tr class="msg" id="L35"><td class="ts-cell"><a class="ts" href="#L35" alt="Fri Mar 19 2021 05:15:32 GMT-0700 (Pacific Daylight Time)">12:15</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title=yoav@irc>yoav</span>&gt;</div></td><td class="msg-cell">I&#039;ll ping folks to get it published, so that it will get picked up by the bots</td></tr>
  <tr class="msg" id="L36"><td class="ts-cell"><a class="ts" href="#L36" alt="Fri Mar 19 2021 06:58:19 GMT-0700 (Pacific Daylight Time)">13:58</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title=annevk@irc>annevk</span>&gt;</div></td><td class="msg-cell">yoav: thanks, I guess I somehow convinced you of this approach since yesterday then? 🙂</td></tr>
  <tr class="msg" id="L37"><td class="ts-cell"><a class="ts" href="#L37" alt="Fri Mar 19 2021 06:58:52 GMT-0700 (Pacific Daylight Time)">13:58</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title=yoav@irc>yoav</span>&gt;</div></td><td class="msg-cell">yeah, you did :)</td></tr>
  <tr class="msg" id="L38"><td class="ts-cell"><a class="ts" href="#L38" alt="Fri Mar 19 2021 07:01:34 GMT-0700 (Pacific Daylight Time)">14:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title=yoav@irc>yoav</span>&gt;</div></td><td class="msg-cell">I&#039;m not convinced there&#039;s a real risk in storing timestamps in renderers, but seems fair to enable browsers to do so if they disagree</td></tr>
  <tr class="msg" id="L39"><td class="ts-cell"><a class="ts" href="#L39" alt="Fri Mar 19 2021 07:36:16 GMT-0700 (Pacific Daylight Time)">14:36</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title=nox@irc>nox</span>&gt;</div></td><td class="msg-cell"><a href="https://github.com/hyperium/hyper/issues/2470">https://github.com/hyperium/hyper/issues/2470</a> Fascinating, I didn&#039;t think of that.</td></tr>
  <tr class="msg" id="L40"><td class="ts-cell"><a class="ts" href="#L40" alt="Fri Mar 19 2021 08:01:33 GMT-0700 (Pacific Daylight Time)">15:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title=annevk@irc>annevk</span>&gt;</div></td><td class="msg-cell">nox: heh, I wrote those tests very recently 🙂</td></tr>
  <tr class="msg" id="L41"><td class="ts-cell"><a class="ts" href="#L41" alt="Fri Mar 19 2021 08:01:49 GMT-0700 (Pacific Daylight Time)">15:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title=nox@irc>nox</span>&gt;</div></td><td class="msg-cell">I assumed it was you :D</td></tr>
  <tr class="msg" id="L42"><td class="ts-cell"><a class="ts" href="#L42" alt="Fri Mar 19 2021 08:01:52 GMT-0700 (Pacific Daylight Time)">15:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title=annevk@irc>annevk</span>&gt;</div></td><td class="msg-cell">well, actually, I wrote a lot of them in 2018 and then recently got around to getting them merged</td></tr>
  <tr class="msg" id="L43"><td class="ts-cell"><a class="ts" href="#L43" alt="Fri Mar 19 2021 15:41:02 GMT-0700 (Pacific Daylight Time)">22:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title=howdoi@irc>howdoi</span>&gt;</div></td><td class="msg-cell">any browser that has implemented Sanitizer API under a flag as of now?</td></tr>
  <tr class="msg" id="L44"><td class="ts-cell"><a class="ts" href="#L44" alt="Fri Mar 19 2021 15:41:27 GMT-0700 (Pacific Daylight Time)">22:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title=howdoi@irc>howdoi</span>&gt;</div></td><td class="msg-cell">Also, there is no way to print the version on javascriptcore REPL?</td></tr>

</tbody></table></div></div></div></body>

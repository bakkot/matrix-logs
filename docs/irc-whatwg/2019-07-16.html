<!doctype html>
<head>
  <title>#whatwg on 2019-07-16</title>
  <link rel="stylesheet" href="../style.css">
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">#whatwg<br>2019-07-16<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2019-07-15" class="nav-link"><span>prev</span></a>
<a href="2019-07-17" class="nav-link"><span style="float:right">next</span></a>
</div>
    
<div class="room-list-wrapper">Active:<br>
<ul class="room-list">
<li><a href="../TC39_Delegates/">TC39 Delegates</a></li>
<li><a href="../TC39_Editors/">TC39 Editors</a></li>
<li><a href="../TC39_General/">TC39 General</a></li>
<li><a href="../WHATWG/">WHATWG</a></li>
</ul>
</div>
<br>
<div class="room-list-wrapper">Historical:<br>
<ul class="room-list">
<li><a href="../irc-tc39/">#tc39</a></li>
<li><a href="../irc-tc39-delegates/">#tc39-delegates</a></li>
<li><a href="../irc-tc39-editor-group/">#tc39-editor-group</a></li>
<li><a href="../irc-whatwg/" class="current-room">#whatwg</a></li>
</ul>
</div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">
<div class="rhs-header">
<span id="error" style="color: red; display:none">error</span>
<input type="text" id="query" size=25 placeholder="Search #whatwg">
<a id="search-submit" class="button icon-link" title="Search">
  <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"></path></svg>
</a>
</div>

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Mon Jul 15 2019 23:23:14 GMT-0700 (Pacific Daylight Time)">06:23</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=domfarolino@irc>domfarolino</span>&gt;</td><td class="msg-cell">annevk: Need to sanity check something. Imagine the following code `image = new Image(); image.src = &quot;<a href="https://example.com&quot">https://example.com&quot</a>; image.referrerPolicy = &quot;no-referrer&quot;`. This should send a request with no referrer header right?</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Mon Jul 15 2019 23:25:02 GMT-0700 (Pacific Daylight Time)">06:25</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=domfarolino@irc>domfarolino</span>&gt;</td><td class="msg-cell">Currently Firefox does not apply a Referer header, while Chrome has a full Referer. I believe Chrome is broken here?</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Mon Jul 15 2019 23:26:12 GMT-0700 (Pacific Daylight Time)">06:26</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=domfarolino@irc>domfarolino</span>&gt;</td><td class="msg-cell">I think the flow is like this, per spec: 1) Src is set, and #updating-the-image-data is invoked, queueing a microtask to finish the algo and fetch the image 2) Image&#039;s referrer policy is updated 3) The microtask is eventually run, referencing the latest `referrerPolicy` value of the image, fetching the resource</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Mon Jul 15 2019 23:31:15 GMT-0700 (Pacific Daylight Time)">06:31</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=domfarolino@irc>domfarolino</span>&gt;</td><td class="msg-cell">(eh, pretend my example is not missing a semicolon)</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Mon Jul 15 2019 23:33:54 GMT-0700 (Pacific Daylight Time)">06:33</a></td><td class="nick-cell">&lt;<span class="nick nick-12" title=annevk@irc>annevk</span>&gt;</td><td class="msg-cell">domfarolino: yeah seems like a bug in Chrome</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Mon Jul 15 2019 23:51:40 GMT-0700 (Pacific Daylight Time)">06:51</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=domfarolino@irc>domfarolino</span>&gt;</td><td class="msg-cell">annevk: So I think by that logic, the following would send a full referrer: `image = new Image(); image.src = &quot;<a href="https://example.com&quot">https://example.com&quot</a>;; queueMicrotask(() =&gt; { image.referrerPolicy = &quot;no-referrer&quot; })`</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Tue Jul 16 2019 00:24:46 GMT-0700 (Pacific Daylight Time)">07:24</a></td><td class="nick-cell">&lt;<span class="nick nick-12" title=annevk@irc>annevk</span>&gt;</td><td class="msg-cell">domfarolino: yeah, if the spec matches reality</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Tue Jul 16 2019 00:25:23 GMT-0700 (Pacific Daylight Time)">07:25</a></td><td class="nick-cell">&lt;<span class="nick nick-12" title=annevk@irc>annevk</span>&gt;</td><td class="msg-cell">The image spec hasnâ€™t been maintained well unfortunately</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Tue Jul 16 2019 00:25:31 GMT-0700 (Pacific Daylight Time)">07:25</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=domfarolino@irc>domfarolino</span>&gt;</td><td class="msg-cell">Yeah :(</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Tue Jul 16 2019 00:27:20 GMT-0700 (Pacific Daylight Time)">07:27</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=domfarolino@irc>domfarolino</span>&gt;</td><td class="msg-cell">The above is correct in Chrome, but only because the first example fails (aka Chrome sends Referer more than it should)</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Tue Jul 16 2019 00:27:43 GMT-0700 (Pacific Daylight Time)">07:27</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=domfarolino@irc>domfarolino</span>&gt;</td><td class="msg-cell">But fails in Firefox (use Promise.resolve().then() instead of queueMicrotask)</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Tue Jul 16 2019 00:28:39 GMT-0700 (Pacific Daylight Time)">07:28</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=domfarolino@irc>domfarolino</span>&gt;</td><td class="msg-cell">oddly enoguh, even if you use setTimeout in Firefox (instead of Promise.resolve().then()) it still fails.</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Tue Jul 16 2019 00:28:54 GMT-0700 (Pacific Daylight Time)">07:28</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=domfarolino@irc>domfarolino</span>&gt;</td><td class="msg-cell">as in, the referrer is not sent when I think it should be. But oh well</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Tue Jul 16 2019 00:32:57 GMT-0700 (Pacific Daylight Time)">07:32</a></td><td class="nick-cell">&lt;<span class="nick nick-12" title=annevk@irc>annevk</span>&gt;</td><td class="msg-cell">domfarolino: does Fx support queueMicrotask? Also when does Fx include it?</td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Tue Jul 16 2019 00:35:52 GMT-0700 (Pacific Daylight Time)">07:35</a></td><td class="nick-cell">&lt;<span class="nick nick-12" title=annevk@irc>annevk</span>&gt;</td><td class="msg-cell">domfarolino: oh, you&#039;re using Promise.resolve() because of lack of queueMicrotask support?</td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Tue Jul 16 2019 00:36:06 GMT-0700 (Pacific Daylight Time)">07:36</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=domfarolino@irc>domfarolino</span>&gt;</td><td class="msg-cell">Yes</td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Tue Jul 16 2019 00:36:14 GMT-0700 (Pacific Daylight Time)">07:36</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=domfarolino@irc>domfarolino</span>&gt;</td><td class="msg-cell">to your second question</td></tr>
  <tr class="msg" id="L17"><td class="ts-cell"><a class="ts" href="#L17" alt="Tue Jul 16 2019 00:36:38 GMT-0700 (Pacific Daylight Time)">07:36</a></td><td class="nick-cell">&lt;<span class="nick nick-12" title=annevk@irc>annevk</span>&gt;</td><td class="msg-cell">domfarolino: it still failing with setTimeout is rather peculiar then, I guess that means it queues a task instead</td></tr>
  <tr class="msg" id="L18"><td class="ts-cell"><a class="ts" href="#L18" alt="Tue Jul 16 2019 00:36:51 GMT-0700 (Pacific Daylight Time)">07:36</a></td><td class="nick-cell">&lt;<span class="nick nick-12" title=annevk@irc>annevk</span>&gt;</td><td class="msg-cell">domfarolino: and timers have higher priority</td></tr>
  <tr class="msg" id="L19"><td class="ts-cell"><a class="ts" href="#L19" alt="Tue Jul 16 2019 00:36:55 GMT-0700 (Pacific Daylight Time)">07:36</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=domfarolino@irc>domfarolino</span>&gt;</td><td class="msg-cell">yeah I guess it must</td></tr>
  <tr class="msg" id="L20"><td class="ts-cell"><a class="ts" href="#L20" alt="Tue Jul 16 2019 00:37:03 GMT-0700 (Pacific Daylight Time)">07:37</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=domfarolino@irc>domfarolino</span>&gt;</td><td class="msg-cell">ahh</td></tr>
  <tr class="msg" id="L21"><td class="ts-cell"><a class="ts" href="#L21" alt="Tue Jul 16 2019 00:37:12 GMT-0700 (Pacific Daylight Time)">07:37</a></td><td class="nick-cell">&lt;<span class="nick nick-12" title=annevk@irc>annevk</span>&gt;</td><td class="msg-cell">domfarolino: if you queue a timeout from a timeout, does that change it? Or versus postMessage()?</td></tr>
  <tr class="msg" id="L22"><td class="ts-cell"><a class="ts" href="#L22" alt="Tue Jul 16 2019 00:37:47 GMT-0700 (Pacific Daylight Time)">07:37</a></td><td class="nick-cell">&lt;<span class="nick nick-12" title=annevk@irc>annevk</span>&gt;</td><td class="msg-cell">domfarolino: to be fair, queue a task for &quot;await a stable state&quot; as I mentioned in the PR would make more sense and is required for when you invoke that from &quot;in parallel&quot;</td></tr>
  <tr class="msg" id="L23"><td class="ts-cell"><a class="ts" href="#L23" alt="Tue Jul 16 2019 00:40:17 GMT-0700 (Pacific Daylight Time)">07:40</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=domfarolino@irc>domfarolino</span>&gt;</td><td class="msg-cell">annevk: queueing a timeout from a timeout does not change it at least, request is still sent w/o a Referer.</td></tr>
  <tr class="msg" id="L24"><td class="ts-cell"><a class="ts" href="#L24" alt="Tue Jul 16 2019 00:41:37 GMT-0700 (Pacific Daylight Time)">07:41</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=domfarolino@irc>domfarolino</span>&gt;</td><td class="msg-cell">annevk: Hmm, queue a task just to queue microtask, and finally continue in parallel?</td></tr>
  <tr class="msg" id="L25"><td class="ts-cell"><a class="ts" href="#L25" alt="Tue Jul 16 2019 00:42:01 GMT-0700 (Pacific Daylight Time)">07:42</a></td><td class="nick-cell">&lt;<span class="nick nick-12" title=annevk@irc>annevk</span>&gt;</td><td class="msg-cell">domfarolino: it cannot be random which task a microtask ends up in</td></tr>
  <tr class="msg" id="L26"><td class="ts-cell"><a class="ts" href="#L26" alt="Tue Jul 16 2019 00:42:09 GMT-0700 (Pacific Daylight Time)">07:42</a></td><td class="nick-cell">&lt;<span class="nick nick-12" title=annevk@irc>annevk</span>&gt;</td><td class="msg-cell">domfarolino: that&#039;s bad</td></tr>
  <tr class="msg" id="L27"><td class="ts-cell"><a class="ts" href="#L27" alt="Tue Jul 16 2019 00:43:39 GMT-0700 (Pacific Daylight Time)">07:43</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=domfarolino@irc>domfarolino</span>&gt;</td><td class="msg-cell">annevk: True. At the same time, queueing a task I don&#039;t think is safe from a compat perspective, right I think it breaks existing behavior (my latest comment in response to yours in the PR thread)</td></tr>
  <tr class="msg" id="L28"><td class="ts-cell"><a class="ts" href="#L28" alt="Tue Jul 16 2019 00:44:48 GMT-0700 (Pacific Daylight Time)">07:44</a></td><td class="nick-cell">&lt;<span class="nick nick-12" title=annevk@irc>annevk</span>&gt;</td><td class="msg-cell">domfarolino: haven&#039;t read that yet, but it seems from these results it&#039;s rather unclear what the processing model is</td></tr>
  <tr class="msg" id="L29"><td class="ts-cell"><a class="ts" href="#L29" alt="Tue Jul 16 2019 00:45:39 GMT-0700 (Pacific Daylight Time)">07:45</a></td><td class="nick-cell"><span class="nick nick-12" title=annevk@irc>annevk</span></td><td class="msg-cell">goes to the PR</td></tr>
  <tr class="msg" id="L30"><td class="ts-cell"><a class="ts" href="#L30" alt="Tue Jul 16 2019 00:46:09 GMT-0700 (Pacific Daylight Time)">07:46</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=domfarolino@irc>domfarolino</span>&gt;</td><td class="msg-cell">annevk: My assumption is that the only issue with #updating-the-image-data is that it calls &quot;await a stable state&quot;, when it should instead be manually queueing a microtask.</td></tr>
  <tr class="msg" id="L31"><td class="ts-cell"><a class="ts" href="#L31" alt="Tue Jul 16 2019 00:46:37 GMT-0700 (Pacific Daylight Time)">07:46</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=domfarolino@irc>domfarolino</span>&gt;</td><td class="msg-cell">That assumption (and the corresponding spec change) would not change current behavior, it is just sort of semantic</td></tr>
  <tr class="msg" id="L32"><td class="ts-cell"><a class="ts" href="#L32" alt="Tue Jul 16 2019 00:47:13 GMT-0700 (Pacific Daylight Time)">07:47</a></td><td class="nick-cell">&lt;<span class="nick nick-12" title=annevk@irc>annevk</span>&gt;</td><td class="msg-cell">domfarolino: it would mean that the algorithm can only ever be invoked from the main thread, which does seem like a good thing to enforce really</td></tr>
  <tr class="msg" id="L33"><td class="ts-cell"><a class="ts" href="#L33" alt="Tue Jul 16 2019 00:47:39 GMT-0700 (Pacific Daylight Time)">07:47</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=domfarolino@irc>domfarolino</span>&gt;</td><td class="msg-cell">But assuming the intention is to have #updating-the-image-data to queue a microtask to continue the rest of the algorithm (which is basically what it currently does, just by using &quot;await a ...&quot; incorrectly), I do not think we can change that to a task w/o compat fallout</td></tr>
  <tr class="msg" id="L34"><td class="ts-cell"><a class="ts" href="#L34" alt="Tue Jul 16 2019 00:47:41 GMT-0700 (Pacific Daylight Time)">07:47</a></td><td class="nick-cell">&lt;<span class="nick nick-12" title=annevk@irc>annevk</span>&gt;</td><td class="msg-cell">domfarolino: maybe we should note that for the ambiguous caller case that it would have to queue a task if it wasn&#039;t same thread</td></tr>
  <tr class="msg" id="L35"><td class="ts-cell"><a class="ts" href="#L35" alt="Tue Jul 16 2019 00:48:15 GMT-0700 (Pacific Daylight Time)">07:48</a></td><td class="nick-cell">&lt;<span class="nick nick-12" title=annevk@irc>annevk</span>&gt;</td><td class="msg-cell">domfarolino: fair, but it seems that browsers don&#039;t queue a microtask? At least Firefox does something else</td></tr>
  <tr class="msg" id="L36"><td class="ts-cell"><a class="ts" href="#L36" alt="Tue Jul 16 2019 00:49:43 GMT-0700 (Pacific Daylight Time)">07:49</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=domfarolino@irc>domfarolino</span>&gt;</td><td class="msg-cell">annevk: But do we have to cater to ambiguous caller cases, if there are none in the spec? (Aka, no invocations of #updating-the-... actually happen from an in-parallel context)</td></tr>
  <tr class="msg" id="L37"><td class="ts-cell"><a class="ts" href="#L37" alt="Tue Jul 16 2019 00:50:23 GMT-0700 (Pacific Daylight Time)">07:50</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=domfarolino@irc>domfarolino</span>&gt;</td><td class="msg-cell">annevk: Ok true, browsers are obviously not doing this correctly, hence my two examples above :(</td></tr>
  <tr class="msg" id="L38"><td class="ts-cell"><a class="ts" href="#L38" alt="Tue Jul 16 2019 00:51:39 GMT-0700 (Pacific Daylight Time)">07:51</a></td><td class="nick-cell">&lt;<span class="nick nick-12" title=annevk@irc>annevk</span>&gt;</td><td class="msg-cell">domfarolino: doesn&#039;t the spec have an ambiguous caller case?</td></tr>
  <tr class="msg" id="L39"><td class="ts-cell"><a class="ts" href="#L39" alt="Tue Jul 16 2019 00:52:02 GMT-0700 (Pacific Daylight Time)">07:52</a></td><td class="nick-cell">&lt;<span class="nick nick-12" title=annevk@irc>annevk</span>&gt;</td><td class="msg-cell">&quot;A user agent that obtains images on demand must update the image data of an img element whenever it needs the image data&quot;</td></tr>
  <tr class="msg" id="L40"><td class="ts-cell"><a class="ts" href="#L40" alt="Tue Jul 16 2019 00:52:18 GMT-0700 (Pacific Daylight Time)">07:52</a></td><td class="nick-cell">&lt;<span class="nick nick-12" title=annevk@irc>annevk</span>&gt;</td><td class="msg-cell">That&#039;s extremely vague</td></tr>
  <tr class="msg" id="L41"><td class="ts-cell"><a class="ts" href="#L41" alt="Tue Jul 16 2019 00:52:37 GMT-0700 (Pacific Daylight Time)">07:52</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=domfarolino@irc>domfarolino</span>&gt;</td><td class="msg-cell">annevk: lol true I suppose, that&#039;s pretty bogus</td></tr>
  <tr class="msg" id="L42"><td class="ts-cell"><a class="ts" href="#L42" alt="Tue Jul 16 2019 01:08:22 GMT-0700 (Pacific Daylight Time)">08:08</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=domfarolino@irc>domfarolino</span>&gt;</td><td class="msg-cell">annevk: Also, if we were to &quot;wait&quot; for some viewport condition to happen before we create the #concept-request, we&#039;re defer the URL parsing relative to the node (...) as late as possible. Are you not OK with that?</td></tr>
  <tr class="msg" id="L43"><td class="ts-cell"><a class="ts" href="#L43" alt="Tue Jul 16 2019 01:08:44 GMT-0700 (Pacific Daylight Time)">08:08</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=domfarolino@irc>domfarolino</span>&gt;</td><td class="msg-cell">(same with the state of some of the attributes, i.e., crossOrigin, referrerPolicy)</td></tr>
  <tr class="msg" id="L44"><td class="ts-cell"><a class="ts" href="#L44" alt="Tue Jul 16 2019 01:10:10 GMT-0700 (Pacific Daylight Time)">08:10</a></td><td class="nick-cell">&lt;<span class="nick nick-12" title=annevk@irc>annevk</span>&gt;</td><td class="msg-cell">domfarolino: yeah, URL parsing has side effects</td></tr>
  <tr class="msg" id="L45"><td class="ts-cell"><a class="ts" href="#L45" alt="Tue Jul 16 2019 01:10:16 GMT-0700 (Pacific Daylight Time)">08:10</a></td><td class="nick-cell">&lt;<span class="nick nick-12" title=annevk@irc>annevk</span>&gt;</td><td class="msg-cell">domfarolino: this would be bad for blob URLs for instance</td></tr>
  <tr class="msg" id="L46"><td class="ts-cell"><a class="ts" href="#L46" alt="Tue Jul 16 2019 01:11:28 GMT-0700 (Pacific Daylight Time)">08:11</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=domfarolino@irc>domfarolino</span>&gt;</td><td class="msg-cell">annevk: sorry, really don&#039;t know much about blob URLs. Could you elaborate?</td></tr>
  <tr class="msg" id="L47"><td class="ts-cell"><a class="ts" href="#L47" alt="Tue Jul 16 2019 01:12:24 GMT-0700 (Pacific Daylight Time)">08:12</a></td><td class="nick-cell">&lt;<span class="nick nick-12" title=annevk@irc>annevk</span>&gt;</td><td class="msg-cell">domfarolino: the moment you parse a blob URL the returned URL record takes ownership of the underlying Blob object (so if the blob URL were to be revoked, fetching that URL record later would not fail)</td></tr>
  <tr class="msg" id="L48"><td class="ts-cell"><a class="ts" href="#L48" alt="Tue Jul 16 2019 01:12:34 GMT-0700 (Pacific Daylight Time)">08:12</a></td><td class="nick-cell">&lt;<span class="nick nick-12" title=annevk@irc>annevk</span>&gt;</td><td class="msg-cell">domfarolino: (implementations have bugs here)</td></tr>
  <tr class="msg" id="L49"><td class="ts-cell"><a class="ts" href="#L49" alt="Tue Jul 16 2019 01:16:05 GMT-0700 (Pacific Daylight Time)">08:16</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=domfarolino@irc>domfarolino</span>&gt;</td><td class="msg-cell">annevk: Ah, so if we defer parsing, the blob URL could be revoked before parsing, and therefore fetching would fail in that case?</td></tr>
  <tr class="msg" id="L50"><td class="ts-cell"><a class="ts" href="#L50" alt="Tue Jul 16 2019 01:16:37 GMT-0700 (Pacific Daylight Time)">08:16</a></td><td class="nick-cell">&lt;<span class="nick nick-12" title=annevk@irc>annevk</span>&gt;</td><td class="msg-cell">domfarolino: yeah</td></tr>
  <tr class="msg" id="L51"><td class="ts-cell"><a class="ts" href="#L51" alt="Tue Jul 16 2019 06:26:52 GMT-0700 (Pacific Daylight Time)">13:26</a></td><td class="nick-cell">&lt;<span class="nick nick-6" title=dtapuska@irc>dtapuska</span>&gt;</td><td class="msg-cell">annevk: On <a href="https://github.com/whatwg/html/pull/4617">https://github.com/whatwg/html/pull/4617</a>  I wanted to define window agent not pulling in &quot;similar-origin&quot; because I want to be able to define some feature policy that forces separate agent allocations</td></tr>
  <tr class="msg" id="L52"><td class="ts-cell"><a class="ts" href="#L52" alt="Tue Jul 16 2019 06:27:53 GMT-0700 (Pacific Daylight Time)">13:27</a></td><td class="nick-cell">&lt;<span class="nick nick-6" title=dtapuska@irc>dtapuska</span>&gt;</td><td class="msg-cell">So I tried to not have the &quot;similar-origin&quot; name in it.. And I wondered if all the references in the spec should be to the window agent, and however that is allocated is up to the similar-origin window agent algorithm</td></tr>
  <tr class="msg" id="L53"><td class="ts-cell"><a class="ts" href="#L53" alt="Tue Jul 16 2019 06:29:09 GMT-0700 (Pacific Daylight Time)">13:29</a></td><td class="nick-cell">&lt;<span class="nick nick-6" title=dtapuska@irc>dtapuska</span>&gt;</td><td class="msg-cell">In terms of the &quot;has an associated agent&quot; that was my definition of a strong reference. Perhaps I&#039;m not understanding how you mean a strong reference.</td></tr>
  <tr class="msg" id="L54"><td class="ts-cell"><a class="ts" href="#L54" alt="Tue Jul 16 2019 06:32:38 GMT-0700 (Pacific Daylight Time)">13:32</a></td><td class="nick-cell">&lt;<span class="nick nick-12" title=annevk@irc>annevk</span>&gt;</td><td class="msg-cell">dtapuska: I don&#039;t think we need two types of window agents and I&#039;d rather not rename the one we have for this refactoring</td></tr>
  <tr class="msg" id="L55"><td class="ts-cell"><a class="ts" href="#L55" alt="Tue Jul 16 2019 06:33:25 GMT-0700 (Pacific Daylight Time)">13:33</a></td><td class="nick-cell">&lt;<span class="nick nick-12" title=annevk@irc>annevk</span>&gt;</td><td class="msg-cell">dtapuska: furthermore, an Agent Cluster holds a set of Agents, giving one of those Agents a special pointer seems inappropriate even if the window one is somewhat special</td></tr>
  <tr class="msg" id="L56"><td class="ts-cell"><a class="ts" href="#L56" alt="Tue Jul 16 2019 06:33:44 GMT-0700 (Pacific Daylight Time)">13:33</a></td><td class="nick-cell">&lt;<span class="nick nick-12" title=annevk@irc>annevk</span>&gt;</td><td class="msg-cell">dtapuska: given how often we need to retrieve it simply retrieving the window type from the set seems fine</td></tr>
  <tr class="msg" id="L57"><td class="ts-cell"><a class="ts" href="#L57" alt="Tue Jul 16 2019 06:34:27 GMT-0700 (Pacific Daylight Time)">13:34</a></td><td class="nick-cell">&lt;<span class="nick nick-6" title=dtapuska@irc>dtapuska</span>&gt;</td><td class="msg-cell">Huh which Agent has a special pointer?</td></tr>
  <tr class="msg" id="L58"><td class="ts-cell"><a class="ts" href="#L58" alt="Tue Jul 16 2019 06:34:43 GMT-0700 (Pacific Daylight Time)">13:34</a></td><td class="nick-cell">&lt;<span class="nick nick-12" title=annevk@irc>annevk</span>&gt;</td><td class="msg-cell">dtapuska: your agent cluster has a special pointer to the window agent</td></tr>
  <tr class="msg" id="L59"><td class="ts-cell"><a class="ts" href="#L59" alt="Tue Jul 16 2019 06:35:18 GMT-0700 (Pacific Daylight Time)">13:35</a></td><td class="nick-cell">&lt;<span class="nick nick-6" title=dtapuska@irc>dtapuska</span>&gt;</td><td class="msg-cell">Yes it has a pointer to the &quot;one&quot; window agent</td></tr>
  <tr class="msg" id="L60"><td class="ts-cell"><a class="ts" href="#L60" alt="Tue Jul 16 2019 06:35:22 GMT-0700 (Pacific Daylight Time)">13:35</a></td><td class="nick-cell">&lt;<span class="nick nick-12" title=annevk@irc>annevk</span>&gt;</td><td class="msg-cell">dtapuska: and it&#039;s also somewhat wrong as there are quite a few agent clusters that don&#039;t</td></tr>
  <tr class="msg" id="L61"><td class="ts-cell"><a class="ts" href="#L61" alt="Tue Jul 16 2019 06:35:29 GMT-0700 (Pacific Daylight Time)">13:35</a></td><td class="nick-cell">&lt;<span class="nick nick-6" title=dtapuska@irc>dtapuska</span>&gt;</td><td class="msg-cell">The rest of agents in the agent cluster are all unique</td></tr>
  <tr class="msg" id="L62"><td class="ts-cell"><a class="ts" href="#L62" alt="Tue Jul 16 2019 06:35:59 GMT-0700 (Pacific Daylight Time)">13:35</a></td><td class="nick-cell">&lt;<span class="nick nick-6" title=dtapuska@irc>dtapuska</span>&gt;</td><td class="msg-cell">So how do you get the window agent of the window cluster for the algorithm to return it?</td></tr>
  <tr class="msg" id="L63"><td class="ts-cell"><a class="ts" href="#L63" alt="Tue Jul 16 2019 06:36:21 GMT-0700 (Pacific Daylight Time)">13:36</a></td><td class="nick-cell">&lt;<span class="nick nick-12" title=annevk@irc>annevk</span>&gt;</td><td class="msg-cell">I&#039;d write it the way I wrote it in the original issue I think</td></tr>
  <tr class="msg" id="L64"><td class="ts-cell"><a class="ts" href="#L64" alt="Tue Jul 16 2019 06:36:41 GMT-0700 (Pacific Daylight Time)">13:36</a></td><td class="nick-cell">&lt;<span class="nick nick-12" title=annevk@irc>annevk</span>&gt;</td><td class="msg-cell">At least, I remember it saying something like &quot;Return the similar-origin window agent of the agent cluster&quot;</td></tr>
  <tr class="msg" id="L65"><td class="ts-cell"><a class="ts" href="#L65" alt="Tue Jul 16 2019 06:36:59 GMT-0700 (Pacific Daylight Time)">13:36</a></td><td class="nick-cell">&lt;<span class="nick nick-12" title=annevk@irc>annevk</span>&gt;</td><td class="msg-cell">Which seems accurate enough until TC39 has created more precise language</td></tr>
  <tr class="msg" id="L66"><td class="ts-cell"><a class="ts" href="#L66" alt="Tue Jul 16 2019 06:37:34 GMT-0700 (Pacific Daylight Time)">13:37</a></td><td class="nick-cell">&lt;<span class="nick nick-6" title=dtapuska@irc>dtapuska</span>&gt;</td><td class="msg-cell">Ok so generally leaving it a little undefined</td></tr>
  <tr class="msg" id="L67"><td class="ts-cell"><a class="ts" href="#L67" alt="Tue Jul 16 2019 06:38:10 GMT-0700 (Pacific Daylight Time)">13:38</a></td><td class="nick-cell">&lt;<span class="nick nick-6" title=dtapuska@irc>dtapuska</span>&gt;</td><td class="msg-cell">I think that is fine.. because my feature policy thing was going to early out in obtaining an agent cluster</td></tr>
  <tr class="msg" id="L68"><td class="ts-cell"><a class="ts" href="#L68" alt="Tue Jul 16 2019 06:38:21 GMT-0700 (Pacific Daylight Time)">13:38</a></td><td class="nick-cell">&lt;<span class="nick nick-12" title=annevk@irc>annevk</span>&gt;</td><td class="msg-cell">dtapuska: well, there&#039;s ever one agent of that type so it&#039;s not quite undefined I&#039;d say</td></tr>
  <tr class="msg" id="L69"><td class="ts-cell"><a class="ts" href="#L69" alt="Tue Jul 16 2019 06:38:39 GMT-0700 (Pacific Daylight Time)">13:38</a></td><td class="nick-cell">&lt;<span class="nick nick-12" title=annevk@irc>annevk</span>&gt;</td><td class="msg-cell">only ever*</td></tr>
  <tr class="msg" id="L70"><td class="ts-cell"><a class="ts" href="#L70" alt="Tue Jul 16 2019 06:39:17 GMT-0700 (Pacific Daylight Time)">13:39</a></td><td class="nick-cell">&lt;<span class="nick nick-12" title=annevk@irc>annevk</span>&gt;</td><td class="msg-cell">And yeah, any kind of isolation would be at the agent cluster level</td></tr>
  <tr class="msg" id="L71"><td class="ts-cell"><a class="ts" href="#L71" alt="Tue Jul 16 2019 06:39:45 GMT-0700 (Pacific Daylight Time)">13:39</a></td><td class="nick-cell">&lt;<span class="nick nick-6" title=dtapuska@irc>dtapuska</span>&gt;</td><td class="msg-cell">What about the definition of &quot;similar-origin window agent&quot; what do you think that would be like?</td></tr>
  <tr class="msg" id="L72"><td class="ts-cell"><a class="ts" href="#L72" alt="Tue Jul 16 2019 06:40:45 GMT-0700 (Pacific Daylight Time)">13:40</a></td><td class="nick-cell">&lt;<span class="nick nick-12" title=annevk@irc>annevk</span>&gt;</td><td class="msg-cell">dtapuska: I guess I haven&#039;t quite thought through yet whether an Agent Cluster holding strong references makes sense, but I guess it does given how termination is supposed to work</td></tr>
  <tr class="msg" id="L73"><td class="ts-cell"><a class="ts" href="#L73" alt="Tue Jul 16 2019 06:41:40 GMT-0700 (Pacific Daylight Time)">13:41</a></td><td class="nick-cell">&lt;<span class="nick nick-12" title=annevk@irc>annevk</span>&gt;</td><td class="msg-cell">dtapuska: I think ideally it doesn&#039;t hold realms and instead whenever we create a realm we add a pointer to the agent, as per the TC39 discussion</td></tr>
  <tr class="msg" id="L74"><td class="ts-cell"><a class="ts" href="#L74" alt="Tue Jul 16 2019 06:42:25 GMT-0700 (Pacific Daylight Time)">13:42</a></td><td class="nick-cell">&lt;<span class="nick nick-12" title=annevk@irc>annevk</span>&gt;</td><td class="msg-cell">dtapuska: if we don&#039;t do that we&#039;d need to start out with the empty set of realms and add the realms as they are created (and remove them at unclear times?)</td></tr>
  <tr class="msg" id="L75"><td class="ts-cell"><a class="ts" href="#L75" alt="Tue Jul 16 2019 06:42:31 GMT-0700 (Pacific Daylight Time)">13:42</a></td><td class="nick-cell">&lt;<span class="nick nick-6" title=dtapuska@irc>dtapuska</span>&gt;</td><td class="msg-cell">Right.. so it is just an Agent that can block is false. That really is it</td></tr>
  <tr class="msg" id="L76"><td class="ts-cell"><a class="ts" href="#L76" alt="Tue Jul 16 2019 06:43:24 GMT-0700 (Pacific Daylight Time)">13:43</a></td><td class="nick-cell">&lt;<span class="nick nick-12" title=annevk@irc>annevk</span>&gt;</td><td class="msg-cell">Yeah, I don&#039;t think we have an opinion on the other fields</td></tr>
  <tr class="msg" id="L77"><td class="ts-cell"><a class="ts" href="#L77" alt="Tue Jul 16 2019 06:44:54 GMT-0700 (Pacific Daylight Time)">13:44</a></td><td class="nick-cell">&lt;<span class="nick nick-12" title=annevk@irc>annevk</span>&gt;</td><td class="msg-cell">(Well, and we enforce the set of realms to be Window objects with certain origins, but that&#039;s not really tied to creation.)</td></tr>
  <tr class="msg" id="L78"><td class="ts-cell"><a class="ts" href="#L78" alt="Tue Jul 16 2019 06:45:15 GMT-0700 (Pacific Daylight Time)">13:45</a></td><td class="nick-cell">&lt;<span class="nick nick-6" title=dtapuska@irc>dtapuska</span>&gt;</td><td class="msg-cell">Can we write some non-normative text around it, maybe a note indicating that the Realms that use this agent should all have the same origin and should be allocated via the obtain-similar-origin-window-agent algorithm?</td></tr>
  <tr class="msg" id="L79"><td class="ts-cell"><a class="ts" href="#L79" alt="Tue Jul 16 2019 06:45:44 GMT-0700 (Pacific Daylight Time)">13:45</a></td><td class="nick-cell">&lt;<span class="nick nick-6" title=dtapuska@irc>dtapuska</span>&gt;</td><td class="msg-cell">s/same/similar</td></tr>
  <tr class="msg" id="L80"><td class="ts-cell"><a class="ts" href="#L80" alt="Tue Jul 16 2019 06:46:03 GMT-0700 (Pacific Daylight Time)">13:46</a></td><td class="nick-cell">&lt;<span class="nick nick-12" title=annevk@irc>annevk</span>&gt;</td><td class="msg-cell">dtapuska: as a statement of fact without &quot;should&quot; that&#039;d be fine</td></tr>
  <tr class="msg" id="L81"><td class="ts-cell"><a class="ts" href="#L81" alt="Tue Jul 16 2019 06:46:40 GMT-0700 (Pacific Daylight Time)">13:46</a></td><td class="nick-cell">&lt;<span class="nick nick-12" title=annevk@irc>annevk</span>&gt;</td><td class="msg-cell">dtapuska: it&#039;s enforced elsewhere (primarily agent cluster selection I guess)</td></tr>
  <tr class="msg" id="L82"><td class="ts-cell"><a class="ts" href="#L82" alt="Tue Jul 16 2019 06:47:45 GMT-0700 (Pacific Daylight Time)">13:47</a></td><td class="nick-cell">&lt;<span class="nick nick-6" title=dtapuska@irc>dtapuska</span>&gt;</td><td class="msg-cell">Ok; so I&#039;ll use &quot;will&quot; instead</td></tr>
  <tr class="msg" id="L83"><td class="ts-cell"><a class="ts" href="#L83" alt="Tue Jul 16 2019 06:49:05 GMT-0700 (Pacific Daylight Time)">13:49</a></td><td class="nick-cell">&lt;<span class="nick nick-12" title=annevk@irc>annevk</span>&gt;</td><td class="msg-cell">dtapuska: &quot;all have ... and are allocated via ...&quot; would also work and is slightly nicer</td></tr>
  <tr class="msg" id="L84"><td class="ts-cell"><a class="ts" href="#L84" alt="Tue Jul 16 2019 07:10:34 GMT-0700 (Pacific Daylight Time)">14:10</a></td><td class="nick-cell">&lt;<span class="nick nick-6" title=dtapuska@irc>dtapuska</span>&gt;</td><td class="msg-cell">annevk: One other thing related to &quot;shared agent clusters&quot;.. I named it this way because when I allocate agent clusters based on a feature policy they won&#039;t end up in the &quot;agent cluster map&quot;.</td></tr>
  <tr class="msg" id="L85"><td class="ts-cell"><a class="ts" href="#L85" alt="Tue Jul 16 2019 07:10:52 GMT-0700 (Pacific Daylight Time)">14:10</a></td><td class="nick-cell">&lt;<span class="nick nick-6" title=dtapuska@irc>dtapuska</span>&gt;</td><td class="msg-cell">The agent cluster map seemed to indicate with the name that it would have all agent clusters</td></tr>
  <tr class="msg" id="L86"><td class="ts-cell"><a class="ts" href="#L86" alt="Tue Jul 16 2019 07:10:56 GMT-0700 (Pacific Daylight Time)">14:10</a></td><td class="nick-cell">&lt;<span class="nick nick-6" title=dtapuska@irc>dtapuska</span>&gt;</td><td class="msg-cell">but perhaps that is just me</td></tr>
  <tr class="msg" id="L87"><td class="ts-cell"><a class="ts" href="#L87" alt="Tue Jul 16 2019 07:14:57 GMT-0700 (Pacific Daylight Time)">14:14</a></td><td class="nick-cell">&lt;<span class="nick nick-12" title=annevk@irc>annevk</span>&gt;</td><td class="msg-cell">dtapuska: so where do you store them instead?</td></tr>
  <tr class="msg" id="L88"><td class="ts-cell"><a class="ts" href="#L88" alt="Tue Jul 16 2019 07:15:40 GMT-0700 (Pacific Daylight Time)">14:15</a></td><td class="nick-cell">&lt;<span class="nick nick-12" title=annevk@irc>annevk</span>&gt;</td><td class="msg-cell">dtapuska: the key abstraction was meant to allow for storing all things there so they&#039;re also easy to find during teardown</td></tr>
  <tr class="msg" id="L89"><td class="ts-cell"><a class="ts" href="#L89" alt="Tue Jul 16 2019 07:16:14 GMT-0700 (Pacific Daylight Time)">14:16</a></td><td class="nick-cell">&lt;<span class="nick nick-6" title=dtapuska@irc>dtapuska</span>&gt;</td><td class="msg-cell">They aren&#039;t stored for those documents that have the policy, they can&#039;t share data with anyone else.. so the strong reference from the global to the agent is the main thing that is holding onto the agent</td></tr>
  <tr class="msg" id="L90"><td class="ts-cell"><a class="ts" href="#L90" alt="Tue Jul 16 2019 07:16:16 GMT-0700 (Pacific Daylight Time)">14:16</a></td><td class="nick-cell">&lt;<span class="nick nick-12" title=annevk@irc>annevk</span>&gt;</td><td class="msg-cell">dtapuska: at least all things that have similar-origin window agents</td></tr>
  <tr class="msg" id="L91"><td class="ts-cell"><a class="ts" href="#L91" alt="Tue Jul 16 2019 07:19:06 GMT-0700 (Pacific Daylight Time)">14:19</a></td><td class="nick-cell">&lt;<span class="nick nick-12" title=annevk@irc>annevk</span>&gt;</td><td class="msg-cell">dtapuska: we might still have to let them go through the browsing context group though in some way so when they are created they get the appropriate COOP/COEP state</td></tr>
  <tr class="msg" id="L92"><td class="ts-cell"><a class="ts" href="#L92" alt="Tue Jul 16 2019 07:20:28 GMT-0700 (Pacific Daylight Time)">14:20</a></td><td class="nick-cell">&lt;<span class="nick nick-12" title=annevk@irc>annevk</span>&gt;</td><td class="msg-cell">dtapuska: but maybe it&#039;s correct that nothing but the document needs to keep a reference (we&#039;ll have to be careful about defining the lookup for dedicated worker agent creation)</td></tr>
  <tr class="msg" id="L93"><td class="ts-cell"><a class="ts" href="#L93" alt="Tue Jul 16 2019 07:20:35 GMT-0700 (Pacific Daylight Time)">14:20</a></td><td class="nick-cell">&lt;<span class="nick nick-1" title=Domenic@irc>Domenic</span>&gt;</td><td class="msg-cell">I&#039;m not as deep into this as you two but it seems to me in an ideal world there should be a single &quot;reference root&quot;, probably the UA, which then keeps things alive. With a general ownership structure of UA -&gt; agent cluster -&gt; agent -&gt; realm &lt;-&gt; global. Not sure where BC groups/BCs fit in there though.</td></tr>
  <tr class="msg" id="L94"><td class="ts-cell"><a class="ts" href="#L94" alt="Tue Jul 16 2019 07:21:12 GMT-0700 (Pacific Daylight Time)">14:21</a></td><td class="nick-cell">&lt;<span class="nick nick-1" title=Domenic@irc>Domenic</span>&gt;</td><td class="msg-cell">To be clear though I think having a perfect reference graph is pretty far down on the list of important things to formalize</td></tr>
  <tr class="msg" id="L95"><td class="ts-cell"><a class="ts" href="#L95" alt="Tue Jul 16 2019 07:21:30 GMT-0700 (Pacific Daylight Time)">14:21</a></td><td class="nick-cell">&lt;<span class="nick nick-12" title=annevk@irc>annevk</span>&gt;</td><td class="msg-cell">domfarolino: BCG holds &quot;window&quot; agent clusters; UA holds shared/service worker agent clusters and BCGs</td></tr>
  <tr class="msg" id="L96"><td class="ts-cell"><a class="ts" href="#L96" alt="Tue Jul 16 2019 07:21:35 GMT-0700 (Pacific Daylight Time)">14:21</a></td><td class="nick-cell">&lt;<span class="nick nick-12" title=annevk@irc>annevk</span>&gt;</td><td class="msg-cell">Domenic: ^^</td></tr>
  <tr class="msg" id="L97"><td class="ts-cell"><a class="ts" href="#L97" alt="Tue Jul 16 2019 07:22:32 GMT-0700 (Pacific Daylight Time)">14:22</a></td><td class="nick-cell">&lt;<span class="nick nick-12" title=annevk@irc>annevk</span>&gt;</td><td class="msg-cell">Domenic: although there was a suggestion that a UA holds session history which holds TLBCs which are part of a BCG, which might be better once we get to session history</td></tr>
  <tr class="msg" id="L98"><td class="ts-cell"><a class="ts" href="#L98" alt="Tue Jul 16 2019 07:23:44 GMT-0700 (Pacific Daylight Time)">14:23</a></td><td class="nick-cell">&lt;<span class="nick nick-12" title=annevk@irc>annevk</span>&gt;</td><td class="msg-cell">And yeah, it&#039;s not entirely clear to me how in dtapuska&#039;s model we&#039;d tear down the agent cluster easily when the tab is closed, it seems we&#039;d have to go hunt for it</td></tr>
  <tr class="msg" id="L99"><td class="ts-cell"><a class="ts" href="#L99" alt="Tue Jul 16 2019 07:24:22 GMT-0700 (Pacific Daylight Time)">14:24</a></td><td class="nick-cell">&lt;<span class="nick nick-12" title=annevk@irc>annevk</span>&gt;</td><td class="msg-cell">So I do think it&#039;s somewhat important to think this through, with the exception of session history although we should keep that in the back of our minds as well</td></tr>
  <tr class="msg" id="L100"><td class="ts-cell"><a class="ts" href="#L100" alt="Tue Jul 16 2019 07:24:33 GMT-0700 (Pacific Daylight Time)">14:24</a></td><td class="nick-cell">&lt;<span class="nick nick-6" title=dtapuska@irc>dtapuska</span>&gt;</td><td class="msg-cell">So can we have a list of all agent clusters, and a separate map of shared agent clusters?</td></tr>
  <tr class="msg" id="L101"><td class="ts-cell"><a class="ts" href="#L101" alt="Tue Jul 16 2019 07:26:39 GMT-0700 (Pacific Daylight Time)">14:26</a></td><td class="nick-cell">&lt;<span class="nick nick-6" title=dtapuska@irc>dtapuska</span>&gt;</td><td class="msg-cell">I don&#039;t think we need that immediately in this PR, but leads to the &quot;shared agent cluster&quot; naming over &quot;agent cluster map&quot;</td></tr>
  <tr class="msg" id="L102"><td class="ts-cell"><a class="ts" href="#L102" alt="Tue Jul 16 2019 07:27:53 GMT-0700 (Pacific Daylight Time)">14:27</a></td><td class="nick-cell">&lt;<span class="nick nick-12" title=annevk@irc>annevk</span>&gt;</td><td class="msg-cell">dtapuska: what did you think about my earlier idea? That we only have a map and the document with a feature policy ends up with a special agent cluster key</td></tr>
  <tr class="msg" id="L103"><td class="ts-cell"><a class="ts" href="#L103" alt="Tue Jul 16 2019 07:32:21 GMT-0700 (Pacific Daylight Time)">14:32</a></td><td class="nick-cell">&lt;<span class="nick nick-6" title=dtapuska@irc>dtapuska</span>&gt;</td><td class="msg-cell">annevk: Ya I thought about that too. But the question is what keying material you&#039;d use that would be consistent for the document. You&#039;d need to allocate some type of &#039;opaque origin&#039; for agent cluster lookup that then the document could maintain I guess</td></tr>
  <tr class="msg" id="L104"><td class="ts-cell"><a class="ts" href="#L104" alt="Tue Jul 16 2019 07:33:32 GMT-0700 (Pacific Daylight Time)">14:33</a></td><td class="nick-cell">&lt;<span class="nick nick-12" title=annevk@irc>annevk</span>&gt;</td><td class="msg-cell">dtapuska: key can be anything, so UUID or opaque origin or whatever would be fine</td></tr>
  <tr class="msg" id="L105"><td class="ts-cell"><a class="ts" href="#L105" alt="Tue Jul 16 2019 07:33:46 GMT-0700 (Pacific Daylight Time)">14:33</a></td><td class="nick-cell">&lt;<span class="nick nick-12" title=annevk@irc>annevk</span>&gt;</td><td class="msg-cell">dtapuska: we could even use the Document object</td></tr>
  <tr class="msg" id="L106"><td class="ts-cell"><a class="ts" href="#L106" alt="Tue Jul 16 2019 07:34:06 GMT-0700 (Pacific Daylight Time)">14:34</a></td><td class="nick-cell">&lt;<span class="nick nick-6" title=dtapuska@irc>dtapuska</span>&gt;</td><td class="msg-cell">No you can&#039;t use the Document object... the Agent is allocated *before* the document is created</td></tr>
  <tr class="msg" id="L107"><td class="ts-cell"><a class="ts" href="#L107" alt="Tue Jul 16 2019 07:34:47 GMT-0700 (Pacific Daylight Time)">14:34</a></td><td class="nick-cell">&lt;<span class="nick nick-12" title=annevk@irc>annevk</span>&gt;</td><td class="msg-cell">dtapuska: oops, yeah, we&#039;d have to generate a unique identifier</td></tr>
  <tr class="msg" id="L108"><td class="ts-cell"><a class="ts" href="#L108" alt="Tue Jul 16 2019 07:35:39 GMT-0700 (Pacific Daylight Time)">14:35</a></td><td class="nick-cell">&lt;<span class="nick nick-6" title=dtapuska@irc>dtapuska</span>&gt;</td><td class="msg-cell">But ya a &quot;agent cluster origin&quot;  could be defined as origin and if policy is set it becomes a opaque origin, and that is passed to the obtain similar-origin window agent algorithm.</td></tr>
  <tr class="msg" id="L109"><td class="ts-cell"><a class="ts" href="#L109" alt="Tue Jul 16 2019 07:36:51 GMT-0700 (Pacific Daylight Time)">14:36</a></td><td class="nick-cell">&lt;<span class="nick nick-12" title=annevk@irc>annevk</span>&gt;</td><td class="msg-cell">To be clear, &quot;agent cluster key is an origin or a scheme-and-site&quot; is meant to be extensible if we have a need, it doesn&#039;t have to fit into this mold necessarily</td></tr>
  <tr class="msg" id="L110"><td class="ts-cell"><a class="ts" href="#L110" alt="Tue Jul 16 2019 07:37:48 GMT-0700 (Pacific Daylight Time)">14:37</a></td><td class="nick-cell">&lt;<span class="nick nick-12" title=annevk@irc>annevk</span>&gt;</td><td class="msg-cell">But opaque origin as key even though the agent does not have an opaque origin would certainly work, but we might wanna carefully explain what&#039;s going on there if we go down that route</td></tr>
  <tr class="msg" id="L111"><td class="ts-cell"><a class="ts" href="#L111" alt="Tue Jul 16 2019 07:37:52 GMT-0700 (Pacific Daylight Time)">14:37</a></td><td class="nick-cell">&lt;<span class="nick nick-6" title=dtapuska@irc>dtapuska</span>&gt;</td><td class="msg-cell">Yup ok.. I don&#039;t disagree.. so I can change it back to &quot;agent cluster map&quot; then</td></tr>
  <tr class="msg" id="L112"><td class="ts-cell"><a class="ts" href="#L112" alt="Tue Jul 16 2019 11:59:16 GMT-0700 (Pacific Daylight Time)">18:59</a></td><td class="nick-cell">&lt;<span class="nick nick-12" title=annevk@irc>annevk</span>&gt;</td><td class="msg-cell">dtapuska: maybe there should be some kind of lookup on a TLBC that falls back to a BCG so you can more eagerly collect when a TLBC is closed, but not observable so maybe not worth it, although maybe it is until we have remote WindowProxy; yeah it is observable that wayâ€¦</td></tr>
  <tr class="msg" id="L113"><td class="ts-cell"><a class="ts" href="#L113" alt="Tue Jul 16 2019 14:16:29 GMT-0700 (Pacific Daylight Time)">21:16</a></td><td class="nick-cell">&lt;<span class="nick nick-4" title=lgrahl@irc>lgrahl</span>&gt;</td><td class="msg-cell">o/ There was a cool web API overview page with links to all the specs but I forgot the URL. Maybe someone of you knows what I mean?</td></tr>
  <tr class="msg" id="L114"><td class="ts-cell"><a class="ts" href="#L114" alt="Tue Jul 16 2019 14:17:10 GMT-0700 (Pacific Daylight Time)">21:17</a></td><td class="nick-cell">&lt;<span class="nick nick-4" title=lgrahl@irc>lgrahl</span>&gt;</td><td class="msg-cell">Found it: <a href="https://platform.html5.org/">https://platform.html5.org/</a></td></tr>

</tbody></table></div></div></div></body>

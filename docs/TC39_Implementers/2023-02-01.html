<!DOCTYPE html><html><head>
  <title>TC39 Implementers on 2023-02-01</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "TC39 Implementers";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">TC39 Implementers<br>2023-02-01<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2023-01-09" class="nav-link"><span>prev</span></a>
<a href="2023-02-02" class="nav-link"><span style="float:right">next</span></a>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">
<div class="rhs-header">
<span id="error" style="color: red; display:none">error</span>

<input type="text" id="query" size="25" placeholder="Search TC39 Implementers">
<a id="search-submit" class="button icon-link" title="Search">
  <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"></path></svg>
</a>
</div>

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Tue Jan 31 2023 18:17:41 GMT-0800 (Pacific Standard Time)">02:17</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@rkirsling:matrix.org">rkirsling</span>&gt;</div></td><td class="msg-cell">so uh</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Tue Jan 31 2023 18:17:55 GMT-0800 (Pacific Standard Time)">02:17</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@rkirsling:matrix.org">rkirsling</span>&gt;</div></td><td class="msg-cell">the note in <a href="https://tc39.es/proposal-set-methods/#sec-set.prototype.intersection">https://tc39.es/proposal-set-methods/#sec-set.prototype.intersection</a> seems kind of surprising, upon attempting implementation</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Tue Jan 31 2023 18:18:44 GMT-0800 (Pacific Standard Time)">02:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@rkirsling:matrix.org">rkirsling</span>&gt;</div></td><td class="msg-cell">because it seems like it's literally saying "hey V8 and JSC, why don't you redo your existing Set impls to match SM"</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Tue Jan 31 2023 18:19:48 GMT-0800 (Pacific Standard Time)">02:19</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@rkirsling:matrix.org">rkirsling</span>&gt;</div></td><td class="msg-cell">given that copying a Set into a new data structure in order to perform an operation on it is not going to constitute a perf win</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Tue Jan 31 2023 18:24:21 GMT-0800 (Pacific Standard Time)">02:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">I looked into V8's and believed it would work</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Tue Jan 31 2023 18:24:24 GMT-0800 (Pacific Standard Time)">02:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@rkirsling:matrix.org">rkirsling</span>&gt;</div></td><td class="msg-cell">ah damn, or maybe not V8</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Tue Jan 31 2023 18:24:25 GMT-0800 (Pacific Standard Time)">02:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@rkirsling:matrix.org">rkirsling</span>&gt;</div></td><td class="msg-cell"><a href="https://github.com/v8/v8/blob/main/src/objects/ordered-hash-table.h#L30-L32">https://github.com/v8/v8/blob/main/src/objects/ordered-hash-table.h#L30-L32</a></td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Tue Jan 31 2023 18:24:27 GMT-0800 (Pacific Standard Time)">02:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">in the same way described there</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Tue Jan 31 2023 18:24:37 GMT-0800 (Pacific Standard Time)">02:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">if JSC's doesn't, that's a good data point and we could consider a different sorting option</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Tue Jan 31 2023 18:24:47 GMT-0800 (Pacific Standard Time)">02:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@rkirsling:matrix.org">rkirsling</span>&gt;</div></td><td class="msg-cell">in JSC a Set is a hashmap with a linked list</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Tue Jan 31 2023 18:25:44 GMT-0800 (Pacific Standard Time)">02:25</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">hm, how does that... work</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Tue Jan 31 2023 18:26:16 GMT-0800 (Pacific Standard Time)">02:26</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@rkirsling:matrix.org">rkirsling</span>&gt;</div></td><td class="msg-cell">ah I mean that like, the buckets have a <code>next()</code> (and incidentally <code>prev()</code>)</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Tue Jan 31 2023 18:26:38 GMT-0800 (Pacific Standard Time)">02:26</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">hm</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Tue Jan 31 2023 18:26:45 GMT-0800 (Pacific Standard Time)">02:26</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">but are not contiguous in memory?</td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Tue Jan 31 2023 18:28:52 GMT-0800 (Pacific Standard Time)">02:28</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@rkirsling:matrix.org">rkirsling</span>&gt;</div></td><td class="msg-cell">yeah exactly</td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Tue Jan 31 2023 18:29:42 GMT-0800 (Pacific Standard Time)">02:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">so how does iterator invalidation work? I guess chasing down all the iterators and updating them?</td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Tue Jan 31 2023 18:29:56 GMT-0800 (Pacific Standard Time)">02:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">or not invalidation <em>per se</em> but if you delete an item that an iterator is pointing to</td></tr>
  <tr class="msg" id="L17"><td class="ts-cell"><a class="ts" href="#L17" alt="Tue Jan 31 2023 18:32:07 GMT-0800 (Pacific Standard Time)">02:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">hm. so this is fixable without redoing the entire implementation by e.g. adding uint64_t to each bucket to keep track of when items were added, but that does cost an extra word per item, which is a little unfortunate (and I guess requires you to re-scan the whole list once a total of 2^64 items have been added to a set over its lifetime)</td></tr>
  <tr class="msg" id="L18"><td class="ts-cell"><a class="ts" href="#L18" alt="Tue Jan 31 2023 18:32:14 GMT-0800 (Pacific Standard Time)">02:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">but the extra word per item is maybe not worth it</td></tr>
  <tr class="msg" id="L19"><td class="ts-cell"><a class="ts" href="#L19" alt="Tue Jan 31 2023 18:32:24 GMT-0800 (Pacific Standard Time)">02:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">I was really hoping this would be easy in all the engines, darn</td></tr>
  <tr class="msg" id="L20"><td class="ts-cell"><a class="ts" href="#L20" alt="Tue Jan 31 2023 18:33:38 GMT-0800 (Pacific Standard Time)">02:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@rkirsling:matrix.org">rkirsling</span>&gt;</div></td><td class="msg-cell"><a href="https://github.com/WebKit/WebKit/blob/main/Source/JavaScriptCore/runtime/HashMapImplInlines.h#L279-L304">https://github.com/WebKit/WebKit/blob/main/Source/JavaScriptCore/runtime/HashMapImplInlines.h#L279-L304</a> is what happens upon delete(item)</td></tr>
  <tr class="msg" id="L21"><td class="ts-cell"><a class="ts" href="#L21" alt="Tue Jan 31 2023 18:34:09 GMT-0800 (Pacific Standard Time)">02:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">(that is: with each Set add a uint64_t, which is incremented whenever you add an item to the set, and never decremented; whenever you make a bucket put the value from that uint64_t in a field on the bucket. then you can sort buckets based on that field.)</td></tr>
  <tr class="msg" id="L22"><td class="ts-cell"><a class="ts" href="#L22" alt="Tue Jan 31 2023 18:34:10 GMT-0800 (Pacific Standard Time)">02:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@rkirsling:matrix.org">rkirsling</span>&gt;</div></td><td class="msg-cell">yeah, sorry for the bubble bursting 😓</td></tr>
  <tr class="msg" id="L23"><td class="ts-cell"><a class="ts" href="#L23" alt="Tue Jan 31 2023 18:34:35 GMT-0800 (Pacific Standard Time)">02:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@rkirsling:matrix.org">rkirsling</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> (that is: with each Set add a uint64_t, which is incremented whenever you add an item to the set, and never decremented; whenever you make a bucket put the value from that uint64_t in a field on the bucket. then you can sort buckets based on that field.)</blockquote></mx-reply>oh I see, yeah</td></tr>
  <tr class="msg" id="L24"><td class="ts-cell"><a class="ts" href="#L24" alt="Tue Jan 31 2023 18:36:20 GMT-0800 (Pacific Standard Time)">02:36</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">do you happen to know where HashMapImpl is instantiated with a concrete HashMapBucketType, so I can look at the buckets?</td></tr>
  <tr class="msg" id="L25"><td class="ts-cell"><a class="ts" href="#L25" alt="Tue Jan 31 2023 18:37:12 GMT-0800 (Pacific Standard Time)">02:37</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">nvm, found it/one</td></tr>
  <tr class="msg" id="L26"><td class="ts-cell"><a class="ts" href="#L26" alt="Tue Jan 31 2023 18:38:56 GMT-0800 (Pacific Standard Time)">02:38</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@rkirsling:matrix.org">rkirsling</span>&gt;</div></td><td class="msg-cell">yeah, for Set it's HashMapBucket&lt;HashMapBucketDataKey&gt;</td></tr>
  <tr class="msg" id="L27"><td class="ts-cell"><a class="ts" href="#L27" alt="Tue Jan 31 2023 18:40:23 GMT-0800 (Pacific Standard Time)">02:40</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">so I see there is a <code>offsetOfNext</code> method</td></tr>
  <tr class="msg" id="L28"><td class="ts-cell"><a class="ts" href="#L28" alt="Tue Jan 31 2023 18:40:25 GMT-0800 (Pacific Standard Time)">02:40</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">no idea what that's for</td></tr>
  <tr class="msg" id="L29"><td class="ts-cell"><a class="ts" href="#L29" alt="Tue Jan 31 2023 18:41:26 GMT-0800 (Pacific Standard Time)">02:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">oh, it's the offset <em>of the field</em>, not the offset of the next bucket, so not the thing you'd need</td></tr>
  <tr class="msg" id="L30"><td class="ts-cell"><a class="ts" href="#L30" alt="Tue Jan 31 2023 18:42:06 GMT-0800 (Pacific Standard Time)">02:42</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@rkirsling:matrix.org">rkirsling</span>&gt;</div></td><td class="msg-cell">right exactly</td></tr>
  <tr class="msg" id="L31"><td class="ts-cell"><a class="ts" href="#L31" alt="Tue Jan 31 2023 18:42:14 GMT-0800 (Pacific Standard Time)">02:42</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@rkirsling:matrix.org">rkirsling</span>&gt;</div></td><td class="msg-cell">I got excited about that for a second at first too</td></tr>
  <tr class="msg" id="L32"><td class="ts-cell"><a class="ts" href="#L32" alt="Tue Jan 31 2023 18:42:35 GMT-0800 (Pacific Standard Time)">02:42</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@rkirsling:matrix.org">rkirsling</span>&gt;</div></td><td class="msg-cell">but unfortunately those are just helpers for JIT to find exact locations in memory</td></tr>
  <tr class="msg" id="L33"><td class="ts-cell"><a class="ts" href="#L33" alt="Tue Jan 31 2023 18:55:38 GMT-0800 (Pacific Standard Time)">02:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">yeah, I don't see a way to get constant-time sort order with this implementation as it is :(</td></tr>
  <tr class="msg" id="L34"><td class="ts-cell"><a class="ts" href="#L34" alt="Tue Jan 31 2023 18:56:04 GMT-0800 (Pacific Standard Time)">02:56</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">guess I will bring an item to plenary about choosing some other, worse ordering, vs asking JSC to do a bunch of work</td></tr>
  <tr class="msg" id="L35"><td class="ts-cell"><a class="ts" href="#L35" alt="Tue Jan 31 2023 18:57:05 GMT-0800 (Pacific Standard Time)">02:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@rkirsling:matrix.org">rkirsling</span>&gt;</div></td><td class="msg-cell">thank you sir 🙇</td></tr>
  <tr class="msg" id="L36"><td class="ts-cell"><a class="ts" href="#L36" alt="Tue Jan 31 2023 18:57:23 GMT-0800 (Pacific Standard Time)">02:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">(or the third option of iterating both sets, at the cost of twice as many observable <code>.has()</code> calls, I guess)</td></tr>
  <tr class="msg" id="L37"><td class="ts-cell"><a class="ts" href="#L37" alt="Tue Jan 31 2023 19:01:08 GMT-0800 (Pacific Standard Time)">03:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@rkirsling:matrix.org">rkirsling</span>&gt;</div></td><td class="msg-cell">it does seem like you'd want to preserve the "this" set's ordering, but</td></tr>
  <tr class="msg" id="L38"><td class="ts-cell"><a class="ts" href="#L38" alt="Tue Jan 31 2023 19:01:36 GMT-0800 (Pacific Standard Time)">03:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@rkirsling:matrix.org">rkirsling</span>&gt;</div></td><td class="msg-cell">it seems that the assumption that's hard to uphold is that one should iterate over the smaller set</td></tr>
  <tr class="msg" id="L39"><td class="ts-cell"><a class="ts" href="#L39" alt="Tue Jan 31 2023 19:01:55 GMT-0800 (Pacific Standard Time)">03:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">that assumption is more important than the order of the result IMO</td></tr>
  <tr class="msg" id="L40"><td class="ts-cell"><a class="ts" href="#L40" alt="Tue Jan 31 2023 19:02:15 GMT-0800 (Pacific Standard Time)">03:02</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@rkirsling:matrix.org">rkirsling</span>&gt;</div></td><td class="msg-cell">ah okay</td></tr>
  <tr class="msg" id="L41"><td class="ts-cell"><a class="ts" href="#L41" alt="Tue Jan 31 2023 19:02:30 GMT-0800 (Pacific Standard Time)">03:02</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">(since it affects big-o performance - consider intersecting a singleton with a massive set)</td></tr>
  <tr class="msg" id="L42"><td class="ts-cell"><a class="ts" href="#L42" alt="Tue Jan 31 2023 19:02:43 GMT-0800 (Pacific Standard Time)">03:02</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@rkirsling:matrix.org">rkirsling</span>&gt;</div></td><td class="msg-cell">right, I do get you there</td></tr>
  <tr class="msg" id="L43"><td class="ts-cell"><a class="ts" href="#L43" alt="Tue Jan 31 2023 19:03:10 GMT-0800 (Pacific Standard Time)">03:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@rkirsling:matrix.org">rkirsling</span>&gt;</div></td><td class="msg-cell">I guess I wonder how hard people lean on the ordering of Sets</td></tr>
  <tr class="msg" id="L44"><td class="ts-cell"><a class="ts" href="#L44" alt="Tue Jan 31 2023 19:03:20 GMT-0800 (Pacific Standard Time)">03:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@rkirsling:matrix.org">rkirsling</span>&gt;</div></td><td class="msg-cell">obviously they should not</td></tr>
  <tr class="msg" id="L45"><td class="ts-cell"><a class="ts" href="#L45" alt="Tue Jan 31 2023 19:03:58 GMT-0800 (Pacific Standard Time)">03:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@rkirsling:matrix.org">rkirsling</span>&gt;</div></td><td class="msg-cell">but we do provide guarantees, hence people surely do make use of those guarantees in certain ways</td></tr>
  <tr class="msg" id="L46"><td class="ts-cell"><a class="ts" href="#L46" alt="Tue Jan 31 2023 19:04:02 GMT-0800 (Pacific Standard Time)">03:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">oh I lean on it all the time</td></tr>
  <tr class="msg" id="L47"><td class="ts-cell"><a class="ts" href="#L47" alt="Tue Jan 31 2023 19:04:04 GMT-0800 (Pacific Standard Time)">03:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">it's very useful</td></tr>
  <tr class="msg" id="L48"><td class="ts-cell"><a class="ts" href="#L48" alt="Tue Jan 31 2023 19:04:13 GMT-0800 (Pacific Standard Time)">03:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">no reason not to</td></tr>
  <tr class="msg" id="L49"><td class="ts-cell"><a class="ts" href="#L49" alt="Tue Jan 31 2023 19:04:56 GMT-0800 (Pacific Standard Time)">03:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@rkirsling:matrix.org">rkirsling</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> obviously they should not</blockquote></mx-reply>er yeah this was a bit too strong</td></tr>
  <tr class="msg" id="L50"><td class="ts-cell"><a class="ts" href="#L50" alt="Tue Jan 31 2023 19:05:19 GMT-0800 (Pacific Standard Time)">03:05</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@rkirsling:matrix.org">rkirsling</span>&gt;</div></td><td class="msg-cell">I just mean like, definition of what a set is, but</td></tr>
  <tr class="msg" id="L51"><td class="ts-cell"><a class="ts" href="#L51" alt="Tue Jan 31 2023 19:05:32 GMT-0800 (Pacific Standard Time)">03:05</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">yeah our Sets are stronger than mathematic sets</td></tr>
  <tr class="msg" id="L52"><td class="ts-cell"><a class="ts" href="#L52" alt="Tue Jan 31 2023 19:06:05 GMT-0800 (Pacific Standard Time)">03:06</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">(the most obvious way to rely on it, of course, is the dedup trick of <code>x = [...new Set(x)]</code>)</td></tr>
  <tr class="msg" id="L53"><td class="ts-cell"><a class="ts" href="#L53" alt="Tue Jan 31 2023 19:06:43 GMT-0800 (Pacific Standard Time)">03:06</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@rkirsling:matrix.org">rkirsling</span>&gt;</div></td><td class="msg-cell">anyway what I'm trying to say is that depending on how important that is to the mental model of a set in JS, I could see people taking issue with intersection going in two different directions based on which of two similarly-sized sets was the receiver and which was the argument</td></tr>
  <tr class="msg" id="L54"><td class="ts-cell"><a class="ts" href="#L54" alt="Tue Jan 31 2023 19:06:56 GMT-0800 (Pacific Standard Time)">03:06</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@ljharb:matrix.org">ljharb</span>&gt;</div></td><td class="msg-cell">I’d bet that’s something that’s done probably more often than any other set usage tbh (deduping i mean)</td></tr>
  <tr class="msg" id="L55"><td class="ts-cell"><a class="ts" href="#L55" alt="Tue Jan 31 2023 19:07:07 GMT-0800 (Pacific Standard Time)">03:07</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@rkirsling:matrix.org">rkirsling</span>&gt;</div></td><td class="msg-cell">ahhh right yeah</td></tr>
  <tr class="msg" id="L56"><td class="ts-cell"><a class="ts" href="#L56" alt="Tue Jan 31 2023 19:10:52 GMT-0800 (Pacific Standard Time)">03:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> anyway what I'm trying to say is that depending on how important that is to the mental model of a set in JS, I could see people taking issue with intersection going in two different directions based on which of two similarly-sized sets was the receiver and which was the argument</blockquote></mx-reply>hm, well, all of the other things also do that</td></tr>
  <tr class="msg" id="L57"><td class="ts-cell"><a class="ts" href="#L57" alt="Tue Jan 31 2023 19:10:57 GMT-0800 (Pacific Standard Time)">03:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">union does this-then-arg, etc</td></tr>
  <tr class="msg" id="L58"><td class="ts-cell"><a class="ts" href="#L58" alt="Tue Jan 31 2023 19:12:04 GMT-0800 (Pacific Standard Time)">03:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@rkirsling:matrix.org">rkirsling</span>&gt;</div></td><td class="msg-cell">err</td></tr>
  <tr class="msg" id="L59"><td class="ts-cell"><a class="ts" href="#L59" alt="Tue Jan 31 2023 19:12:07 GMT-0800 (Pacific Standard Time)">03:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">that is: every set-producing operation in this proposal produces Sets consisting of, in order, things that were in the receiver, followed by things that were in the argument (if any are to be emitted that were not in the receiver)</td></tr>
  <tr class="msg" id="L60"><td class="ts-cell"><a class="ts" href="#L60" alt="Tue Jan 31 2023 19:12:17 GMT-0800 (Pacific Standard Time)">03:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@rkirsling:matrix.org">rkirsling</span>&gt;</div></td><td class="msg-cell">sigh, I literally said the opposite thing of what I meant to 🤦</td></tr>
  <tr class="msg" id="L61"><td class="ts-cell"><a class="ts" href="#L61" alt="Tue Jan 31 2023 19:12:21 GMT-0800 (Pacific Standard Time)">03:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">intersection is the only one where it is not totally obvious how to do that</td></tr>
  <tr class="msg" id="L62"><td class="ts-cell"><a class="ts" href="#L62" alt="Tue Jan 31 2023 19:14:07 GMT-0800 (Pacific Standard Time)">03:14</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@rkirsling:matrix.org">rkirsling</span>&gt;</div></td><td class="msg-cell">I meant to say that "hey take this set and intersect it with that one" could be pretty surprising if the ordering is based on "that one" part of the time, particularly if the two are close in size</td></tr>
  <tr class="msg" id="L63"><td class="ts-cell"><a class="ts" href="#L63" alt="Tue Jan 31 2023 19:15:37 GMT-0800 (Pacific Standard Time)">03:15</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@rkirsling:matrix.org">rkirsling</span>&gt;</div></td><td class="msg-cell">I feel like it's pretty easy to come up with a scenario where you'd want the receiver to be the one in control (take your de-dupe example above and add a filter set to it)</td></tr>
  <tr class="msg" id="L64"><td class="ts-cell"><a class="ts" href="#L64" alt="Tue Jan 31 2023 19:16:03 GMT-0800 (Pacific Standard Time)">03:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@rkirsling:matrix.org">rkirsling</span>&gt;</div></td><td class="msg-cell">obviously these are originally commutative operations but well, so are AND and OR</td></tr>
  <tr class="msg" id="L65"><td class="ts-cell"><a class="ts" href="#L65" alt="Tue Jan 31 2023 19:18:37 GMT-0800 (Pacific Standard Time)">03:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell"><p>for intersection, the options I see are:</p>
<ul>
<li>rely on engines being able to sort results as they were in the receiver efficiently (current option)</li>
<li>order of the result changes depending on the relative sizes of the two sets (gross)</li>
<li>regardless of sizes, iterate <em>both</em> sets up to the minimum size, checking membership in the other and keeping items which pass (this gives you an order which is not particularly easy to explain but is deterministic and O(smaller) performance, just with an extra factor of 2 overhead)</li>
<li>literally randomize the order of the result (I refuse this one)</li>
<li>give up on being big-O efficient and always iterate the receiver (I also refuse this one)</li>
</ul>
</td></tr>
  <tr class="msg" id="L66"><td class="ts-cell"><a class="ts" href="#L66" alt="Tue Jan 31 2023 19:22:30 GMT-0800 (Pacific Standard Time)">03:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@rkirsling:matrix.org">rkirsling</span>&gt;</div></td><td class="msg-cell">so I kind of want to dig into the big-O thing a bit more</td></tr>
  <tr class="msg" id="L67"><td class="ts-cell"><a class="ts" href="#L67" alt="Tue Jan 31 2023 19:22:41 GMT-0800 (Pacific Standard Time)">03:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@rkirsling:matrix.org">rkirsling</span>&gt;</div></td><td class="msg-cell">this is only an issue if it's a footgun</td></tr>
  <tr class="msg" id="L68"><td class="ts-cell"><a class="ts" href="#L68" alt="Tue Jan 31 2023 19:22:54 GMT-0800 (Pacific Standard Time)">03:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">for which option?</td></tr>
  <tr class="msg" id="L69"><td class="ts-cell"><a class="ts" href="#L69" alt="Tue Jan 31 2023 19:23:04 GMT-0800 (Pacific Standard Time)">03:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@rkirsling:matrix.org">rkirsling</span>&gt;</div></td><td class="msg-cell">"always iterate the receiver"</td></tr>
  <tr class="msg" id="L70"><td class="ts-cell"><a class="ts" href="#L70" alt="Tue Jan 31 2023 19:23:35 GMT-0800 (Pacific Standard Time)">03:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">intersecting a very large set with a very small set should be fast. this I am committed to in my heart of hearts</td></tr>
  <tr class="msg" id="L71"><td class="ts-cell"><a class="ts" href="#L71" alt="Tue Jan 31 2023 19:23:39 GMT-0800 (Pacific Standard Time)">03:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@rkirsling:matrix.org">rkirsling</span>&gt;</div></td><td class="msg-cell">I'm not saying for sure that it <em>isn't</em> a footgun, but</td></tr>
  <tr class="msg" id="L72"><td class="ts-cell"><a class="ts" href="#L72" alt="Tue Jan 31 2023 19:24:29 GMT-0800 (Pacific Standard Time)">03:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@rkirsling:matrix.org">rkirsling</span>&gt;</div></td><td class="msg-cell">I'm just saying that in a JS world where sets have deterministic ordering, then setting aside commutativity in favor of receiver control makes sense</td></tr>
  <tr class="msg" id="L73"><td class="ts-cell"><a class="ts" href="#L73" alt="Tue Jan 31 2023 19:24:47 GMT-0800 (Pacific Standard Time)">03:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">I'm not sure what you mean by "receiver control"</td></tr>
  <tr class="msg" id="L74"><td class="ts-cell"><a class="ts" href="#L74" alt="Tue Jan 31 2023 19:25:10 GMT-0800 (Pacific Standard Time)">03:25</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@rkirsling:matrix.org">rkirsling</span>&gt;</div></td><td class="msg-cell">and <em>if</em> that were understood (without assuming how large of an "if" this is), then it would not be so hard to do a size check in userland</td></tr>
  <tr class="msg" id="L75"><td class="ts-cell"><a class="ts" href="#L75" alt="Tue Jan 31 2023 19:26:00 GMT-0800 (Pacific Standard Time)">03:26</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@rkirsling:matrix.org">rkirsling</span>&gt;</div></td><td class="msg-cell">I'm saying it's not A ∩ B, it's "take A and intersect it <em>against</em> B"</td></tr>
  <tr class="msg" id="L76"><td class="ts-cell"><a class="ts" href="#L76" alt="Tue Jan 31 2023 19:27:13 GMT-0800 (Pacific Standard Time)">03:27</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">I think that "take A and intersect it against B" implies the result should be ordered as in the receiver, but does not imply anything about performance</td></tr>
  <tr class="msg" id="L77"><td class="ts-cell"><a class="ts" href="#L77" alt="Tue Jan 31 2023 19:27:29 GMT-0800 (Pacific Standard Time)">03:27</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">the current option does achieve ordering of the result as in the receiver</td></tr>
  <tr class="msg" id="L78"><td class="ts-cell"><a class="ts" href="#L78" alt="Tue Jan 31 2023 19:29:49 GMT-0800 (Pacific Standard Time)">03:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">even in JSC the current option has the same theoretical big-O performance as iterating the receiver directly (to within a log factor, anyway), but fewer user-observable calls, so it seems like it dominates</td></tr>
  <tr class="msg" id="L79"><td class="ts-cell"><a class="ts" href="#L79" alt="Tue Jan 31 2023 19:31:29 GMT-0800 (Pacific Standard Time)">03:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">(iterating the receiver requires doing a user-observable <code>arg.has</code> check for every item in the receiver, which could be arbitrarily many more calls than would be required to iterate the argument instead if the receiver is much larger than the argument)</td></tr>
  <tr class="msg" id="L80"><td class="ts-cell"><a class="ts" href="#L80" alt="Tue Jan 31 2023 19:32:53 GMT-0800 (Pacific Standard Time)">03:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@rkirsling:matrix.org">rkirsling</span>&gt;</div></td><td class="msg-cell">ahhh</td></tr>
  <tr class="msg" id="L81"><td class="ts-cell"><a class="ts" href="#L81" alt="Tue Jan 31 2023 19:33:09 GMT-0800 (Pacific Standard Time)">03:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@rkirsling:matrix.org">rkirsling</span>&gt;</div></td><td class="msg-cell">I was overlooking that bit</td></tr>

</tbody></table></div></div></div>
</body></html>
<!doctype html>
<head>
  <title>#tc39 on 2021-05-03</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "#tc39";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">#tc39<br>2021-05-03<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2021-05-02" class="nav-link"><span>prev</span></a>
<a href="2021-05-04" class="nav-link"><span style="float:right">next</span></a>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">
<div class="rhs-header">
<span id="error" style="color: red; display:none">error</span>
<input type="text" id="query" size=25 placeholder="Search #tc39">
<a id="search-submit" class="button icon-link" title="Search">
  <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"></path></svg>
</a>
</div>

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Mon May 03 2021 08:56:15 GMT-0700 (Pacific Daylight Time)">15:56</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title=Bakkot@irc>Bakkot</span>&gt;</div></td><td class="msg-cell">jmdyck: re the weird Return in GeneratorYield (and etc), what&#039;s the basic idea of the PR you have in mind?</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Mon May 03 2021 08:56:57 GMT-0700 (Pacific Daylight Time)">15:56</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title=jmdyck@irc>jmdyck</span>&gt;</div></td><td class="msg-cell">restructure them to use a Resume step</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Mon May 03 2021 08:58:03 GMT-0700 (Pacific Daylight Time)">15:58</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title=Bakkot@irc>Bakkot</span>&gt;</div></td><td class="msg-cell">as in &quot;resume the context which is now the top of the stack providing X as the value&quot;?</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Mon May 03 2021 08:58:11 GMT-0700 (Pacific Daylight Time)">15:58</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title=Bakkot@irc>Bakkot</span>&gt;</div></td><td class="msg-cell">(or some better phrasing than that)</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Mon May 03 2021 08:58:54 GMT-0700 (Pacific Daylight Time)">15:58</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title=jmdyck@irc>jmdyck</span>&gt;</div></td><td class="msg-cell">yup</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Mon May 03 2021 08:59:04 GMT-0700 (Pacific Daylight Time)">15:59</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title=Bakkot@irc>Bakkot</span>&gt;</div></td><td class="msg-cell">cool, sounds good</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Mon May 03 2021 08:59:42 GMT-0700 (Pacific Daylight Time)">15:59</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title=jmdyck@irc>jmdyck</span>&gt;</div></td><td class="msg-cell">currently, we only use &quot;Resume&quot; steps on the one &#039;side&#039;. Seems like it would be useful to use them on the other side too.</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Mon May 03 2021 08:59:59 GMT-0700 (Pacific Daylight Time)">15:59</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title=jmdyck@irc>jmdyck</span>&gt;</div></td><td class="msg-cell">Don&#039;t have good names for the &#039;sides&#039; though.</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Mon May 03 2021 09:01:05 GMT-0700 (Pacific Daylight Time)">16:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title=jmdyck@irc>jmdyck</span>&gt;</div></td><td class="msg-cell">(just for the discussion, I don&#039;t think it&#039;ll come up in spec-text)</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Mon May 03 2021 09:04:25 GMT-0700 (Pacific Daylight Time)">16:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title=Bakkot@irc>Bakkot</span>&gt;</div></td><td class="msg-cell">I would say &quot;we only use Resume when pushing a context, not when popping a context&quot;, probably</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Mon May 03 2021 10:42:48 GMT-0700 (Pacific Daylight Time)">17:42</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title=jmdyck@irc>jmdyck</span>&gt;</div></td><td class="msg-cell">Bakkot: In AsyncGeneratorYield, the call to AsyncGeneratorResolve is causing me headaches. It&#039;s just so weird.</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Mon May 03 2021 10:57:00 GMT-0700 (Pacific Daylight Time)">17:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title=jmdyck@irc>jmdyck</span>&gt;</div></td><td class="msg-cell">(I&#039;m using &#039;setup&#039; and &#039;generative&#039; to name the two sides.) AsyncGeneratorResolve executes *after* the stack-pop, so the &#039;setup&#039; EC is the running EC, but it executes *before* the Return that will transfer control back to the setup side.</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Mon May 03 2021 10:58:59 GMT-0700 (Pacific Daylight Time)">17:58</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title=jmdyck@irc>jmdyck</span>&gt;</div></td><td class="msg-cell">So I thought, just move it from pre-transfer to post-transfer (i.e., call it after the Resume step in AsyncGeneratorResumeNext). But then the other transfers to that point aren&#039;t going to be happy.</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Mon May 03 2021 11:03:58 GMT-0700 (Pacific Daylight Time)">18:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title=jmdyck@irc>jmdyck</span>&gt;</div></td><td class="msg-cell">So then I thought, well, in the &quot;use Resume&quot; world, you can still execute AsyncGeneratorResumeNext between the pop and the resume, so do that. But in the &quot;use Resume&quot; world, the steps in the &quot;set the code evaluation state&quot; become post-Resume steps (at AsyncGeneratorYield&#039;s top level) (so that they Return to the natural place).</td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Mon May 03 2021 11:05:36 GMT-0700 (Pacific Daylight Time)">18:05</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title=jmdyck@irc>jmdyck</span>&gt;</div></td><td class="msg-cell">Which means they&#039;d happen *after* the call to AsyncGeneratorResolve, but in the status quo they&#039;re set up *before* the call to AsyncGeneratorResolve. Which *does* make a difference, it seems.</td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Mon May 03 2021 11:06:43 GMT-0700 (Pacific Daylight Time)">18:06</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title=Bakkot@irc>Bakkot</span>&gt;</div></td><td class="msg-cell">hmmmmm</td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Mon May 03 2021 11:08:33 GMT-0700 (Pacific Daylight Time)">18:08</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title=jmdyck@irc>jmdyck</span>&gt;</div></td><td class="msg-cell">AsyncGeneratorYield calls AsyncGeneratorResolve calls Â AsyncGeneratorResumeNext which Resumes _genContext_</td></tr>
  <tr class="msg" id="L17"><td class="ts-cell"><a class="ts" href="#L17" alt="Mon May 03 2021 11:08:39 GMT-0700 (Pacific Daylight Time)">18:08</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title=Bakkot@irc>Bakkot</span>&gt;</div></td><td class="msg-cell">if I&#039;m reading these algorithms correctly, `AsyncGeneratorYield` suspends the generator context, and then does AsyncGeneratorResolve, which does AsyncGeneratorResumeNext, which... un-resumes gencontext?</td></tr>
  <tr class="msg" id="L18"><td class="ts-cell"><a class="ts" href="#L18" alt="Mon May 03 2021 11:08:41 GMT-0700 (Pacific Daylight Time)">18:08</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title=Bakkot@irc>Bakkot</span>&gt;</div></td><td class="msg-cell">yeah, that</td></tr>
  <tr class="msg" id="L19"><td class="ts-cell"><a class="ts" href="#L19" alt="Mon May 03 2021 11:08:46 GMT-0700 (Pacific Daylight Time)">18:08</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title=Bakkot@irc>Bakkot</span>&gt;</div></td><td class="msg-cell">er, *un-suspends</td></tr>
  <tr class="msg" id="L20"><td class="ts-cell"><a class="ts" href="#L20" alt="Mon May 03 2021 11:09:25 GMT-0700 (Pacific Daylight Time)">18:09</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title=Bakkot@irc>Bakkot</span>&gt;</div></td><td class="msg-cell">I will need to read up on this part of the spec in more detail</td></tr>
  <tr class="msg" id="L21"><td class="ts-cell"><a class="ts" href="#L21" alt="Mon May 03 2021 11:09:32 GMT-0700 (Pacific Daylight Time)">18:09</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title=Bakkot@irc>Bakkot</span>&gt;</div></td><td class="msg-cell">haven&#039;t dug into async generators in the spec before</td></tr>
  <tr class="msg" id="L22"><td class="ts-cell"><a class="ts" href="#L22" alt="Mon May 03 2021 11:10:41 GMT-0700 (Pacific Daylight Time)">18:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title=jmdyck@irc>jmdyck</span>&gt;</div></td><td class="msg-cell">so there can be two executions of AsyncGenYield for the same context that are &#039;live&#039; at the same time?</td></tr>
  <tr class="msg" id="L23"><td class="ts-cell"><a class="ts" href="#L23" alt="Mon May 03 2021 11:11:18 GMT-0700 (Pacific Daylight Time)">18:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title=jmdyck@irc>jmdyck</span>&gt;</div></td><td class="msg-cell">well, not &#039;live&#039;, but... i don&#039;t know.</td></tr>
  <tr class="msg" id="L24"><td class="ts-cell"><a class="ts" href="#L24" alt="Mon May 03 2021 11:12:05 GMT-0700 (Pacific Daylight Time)">18:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title=Bakkot@irc>Bakkot</span>&gt;</div></td><td class="msg-cell">I don&#039;t think they&#039;re both live</td></tr>
  <tr class="msg" id="L25"><td class="ts-cell"><a class="ts" href="#L25" alt="Mon May 03 2021 11:12:14 GMT-0700 (Pacific Daylight Time)">18:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title=Bakkot@irc>Bakkot</span>&gt;</div></td><td class="msg-cell">it suspends, and then resumes, but it&#039;s the same context</td></tr>
  <tr class="msg" id="L26"><td class="ts-cell"><a class="ts" href="#L26" alt="Mon May 03 2021 11:12:54 GMT-0700 (Pacific Daylight Time)">18:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title=Bakkot@irc>Bakkot</span>&gt;</div></td><td class="msg-cell">I guess the immediate-resumption behavior makes sense if you have multiple calls to `.next` which happen while it&#039;s busy `await`ing something</td></tr>
  <tr class="msg" id="L27"><td class="ts-cell"><a class="ts" href="#L27" alt="Mon May 03 2021 11:13:07 GMT-0700 (Pacific Daylight Time)">18:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title=Bakkot@irc>Bakkot</span>&gt;</div></td><td class="msg-cell">but I will need to trace through more carefully</td></tr>
  <tr class="msg" id="L28"><td class="ts-cell"><a class="ts" href="#L28" alt="Mon May 03 2021 11:13:11 GMT-0700 (Pacific Daylight Time)">18:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title=jmdyck@irc>jmdyck</span>&gt;</div></td><td class="msg-cell">does control ever get back to the first one?</td></tr>
  <tr class="msg" id="L29"><td class="ts-cell"><a class="ts" href="#L29" alt="Mon May 03 2021 11:18:16 GMT-0700 (Pacific Daylight Time)">18:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title=Bakkot@irc>Bakkot</span>&gt;</div></td><td class="msg-cell">I think yes - step 9 of the second AsyncGeneratorYield returns to the first one</td></tr>
  <tr class="msg" id="L30"><td class="ts-cell"><a class="ts" href="#L30" alt="Mon May 03 2021 11:18:28 GMT-0700 (Pacific Daylight Time)">18:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title=Bakkot@irc>Bakkot</span>&gt;</div></td><td class="msg-cell">if I&#039;m following it correctly</td></tr>
  <tr class="msg" id="L31"><td class="ts-cell"><a class="ts" href="#L31" alt="Mon May 03 2021 11:23:16 GMT-0700 (Pacific Daylight Time)">18:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title=jmdyck@irc>jmdyck</span>&gt;</div></td><td class="msg-cell">But AsyncGeneratorResumeNext would be the op that most recently resumed genContext.</td></tr>
  <tr class="msg" id="L32"><td class="ts-cell"><a class="ts" href="#L32" alt="Mon May 03 2021 11:24:08 GMT-0700 (Pacific Daylight Time)">18:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title=jmdyck@irc>jmdyck</span>&gt;</div></td><td class="msg-cell">(when the second AGY executes step 9 Return)</td></tr>
  <tr class="msg" id="L33"><td class="ts-cell"><a class="ts" href="#L33" alt="Mon May 03 2021 11:26:02 GMT-0700 (Pacific Daylight Time)">18:26</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title=Bakkot@irc>Bakkot</span>&gt;</div></td><td class="msg-cell">right, so, to be precise control moves to step 19 of the first AsyncGeneratorResumeNext call, and then at step 21 it returns to the end of step 9 of the first AsyncGeneratorResolve call, and then in step 10 of that AO returns to the end of step 9 of the first AsyncGeneratorYield call</td></tr>
  <tr class="msg" id="L34"><td class="ts-cell"><a class="ts" href="#L34" alt="Mon May 03 2021 11:26:55 GMT-0700 (Pacific Daylight Time)">18:26</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title=Bakkot@irc>Bakkot</span>&gt;</div></td><td class="msg-cell">(previous messages should begin with &quot;upon executing step 9 of the second AsyncGeneratorYield call&quot;)</td></tr>
  <tr class="msg" id="L35"><td class="ts-cell"><a class="ts" href="#L35" alt="Mon May 03 2021 11:26:59 GMT-0700 (Pacific Daylight Time)">18:26</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title=Bakkot@irc>Bakkot</span>&gt;</div></td><td class="msg-cell">*message</td></tr>
  <tr class="msg" id="L36"><td class="ts-cell"><a class="ts" href="#L36" alt="Mon May 03 2021 11:30:32 GMT-0700 (Pacific Daylight Time)">18:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title=jmdyck@irc>jmdyck</span>&gt;</div></td><td class="msg-cell">but before step 19 of AGRN, there was a transfer to and a transfer back from genContext</td></tr>
  <tr class="msg" id="L37"><td class="ts-cell"><a class="ts" href="#L37" alt="Mon May 03 2021 11:31:25 GMT-0700 (Pacific Daylight Time)">18:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title=Bakkot@irc>Bakkot</span>&gt;</div></td><td class="msg-cell">agreed, but why is that a problem?</td></tr>
  <tr class="msg" id="L38"><td class="ts-cell"><a class="ts" href="#L38" alt="Mon May 03 2021 11:32:14 GMT-0700 (Pacific Daylight Time)">18:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title=Bakkot@irc>Bakkot</span>&gt;</div></td><td class="msg-cell">I guess because it makes the &quot;had most previously resumed evaluation&quot; part inaccurate?</td></tr>
  <tr class="msg" id="L39"><td class="ts-cell"><a class="ts" href="#L39" alt="Mon May 03 2021 11:32:52 GMT-0700 (Pacific Daylight Time)">18:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title=jmdyck@irc>jmdyck</span>&gt;</div></td><td class="msg-cell">well, that&#039;s one thing.</td></tr>
  <tr class="msg" id="L40"><td class="ts-cell"><a class="ts" href="#L40" alt="Mon May 03 2021 11:33:53 GMT-0700 (Pacific Daylight Time)">18:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title=jmdyck@irc>jmdyck</span>&gt;</div></td><td class="msg-cell">it&#039;s weird to me that AsyncGeneratorYield can invoke AsyncGeneratorResolve without transferring control to the setup side.</td></tr>
  <tr class="msg" id="L41"><td class="ts-cell"><a class="ts" href="#L41" alt="Mon May 03 2021 11:36:00 GMT-0700 (Pacific Daylight Time)">18:36</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title=jmdyck@irc>jmdyck</span>&gt;</div></td><td class="msg-cell">So the whole AGR -&gt; AGRN -&gt; Resume step is happening on the generative side?</td></tr>
  <tr class="msg" id="L42"><td class="ts-cell"><a class="ts" href="#L42" alt="Mon May 03 2021 11:36:08 GMT-0700 (Pacific Daylight Time)">18:36</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title=Bakkot@irc>Bakkot</span>&gt;</div></td><td class="msg-cell">yeah</td></tr>
  <tr class="msg" id="L43"><td class="ts-cell"><a class="ts" href="#L43" alt="Mon May 03 2021 11:36:13 GMT-0700 (Pacific Daylight Time)">18:36</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title=Bakkot@irc>Bakkot</span>&gt;</div></td><td class="msg-cell">consider `g = (async function*f(){ await new Promise(res =&gt; setTimeout(res, 10)); console.log(&#039;a&#039;); yield 0; console.log(&#039;b&#039;); yield 1; console.log(&#039;c&#039;); })(); <a href="http://g.next">g.next</a>(); <a href="http://g.next">g.next</a>(); console.log(&#039;start&#039;);`</td></tr>
  <tr class="msg" id="L44"><td class="ts-cell"><a class="ts" href="#L44" alt="Mon May 03 2021 11:36:32 GMT-0700 (Pacific Daylight Time)">18:36</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title=Bakkot@irc>Bakkot</span>&gt;</div></td><td class="msg-cell">this example prints `start`, and then `a, b`</td></tr>
  <tr class="msg" id="L45"><td class="ts-cell"><a class="ts" href="#L45" alt="Mon May 03 2021 11:36:58 GMT-0700 (Pacific Daylight Time)">18:36</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title=Bakkot@irc>Bakkot</span>&gt;</div></td><td class="msg-cell">because the generator had a queued `next` after the `await` completed</td></tr>
  <tr class="msg" id="L46"><td class="ts-cell"><a class="ts" href="#L46" alt="Mon May 03 2021 11:37:15 GMT-0700 (Pacific Daylight Time)">18:37</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title=Bakkot@irc>Bakkot</span>&gt;</div></td><td class="msg-cell">so it does both at the same time, without transferring control back</td></tr>
  <tr class="msg" id="L47"><td class="ts-cell"><a class="ts" href="#L47" alt="Mon May 03 2021 11:38:23 GMT-0700 (Pacific Daylight Time)">18:38</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title=Bakkot@irc>Bakkot</span>&gt;</div></td><td class="msg-cell">that is, it does both the initialization and the first `yield` without transferring control back</td></tr>
  <tr class="msg" id="L48"><td class="ts-cell"><a class="ts" href="#L48" alt="Mon May 03 2021 11:50:50 GMT-0700 (Pacific Daylight Time)">18:50</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title=jmdyck@irc>jmdyck</span>&gt;</div></td><td class="msg-cell"><a href="http://g.next">g.next</a> resolve to <a href="http://AsyncGenerator.prototype.next">AsyncGenerator.prototype.next</a>, right?</td></tr>
  <tr class="msg" id="L49"><td class="ts-cell"><a class="ts" href="#L49" alt="Mon May 03 2021 11:51:03 GMT-0700 (Pacific Daylight Time)">18:51</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title=Bakkot@irc>Bakkot</span>&gt;</div></td><td class="msg-cell">yes</td></tr>
  <tr class="msg" id="L50"><td class="ts-cell"><a class="ts" href="#L50" alt="Mon May 03 2021 11:56:28 GMT-0700 (Pacific Daylight Time)">18:56</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title=jmdyck@irc>jmdyck</span>&gt;</div></td><td class="msg-cell">each calls AsyncGenEnqueue, which appends a request to generator.[[AsyncGeneratorQueue]].</td></tr>
  <tr class="msg" id="L51"><td class="ts-cell"><a class="ts" href="#L51" alt="Mon May 03 2021 11:56:56 GMT-0700 (Pacific Daylight Time)">18:56</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title=jmdyck@irc>jmdyck</span>&gt;</div></td><td class="msg-cell">The first time, generator.[[AsyncGeneratorState]] is suspendedStart, so it calls AsyncGeneratorResumeNext</td></tr>
  <tr class="msg" id="L52"><td class="ts-cell"><a class="ts" href="#L52" alt="Mon May 03 2021 11:57:47 GMT-0700 (Pacific Daylight Time)">18:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title=jmdyck@irc>jmdyck</span>&gt;</div></td><td class="msg-cell">which pops a request of the queue</td></tr>
  <tr class="msg" id="L53"><td class="ts-cell"><a class="ts" href="#L53" alt="Mon May 03 2021 11:57:52 GMT-0700 (Pacific Daylight Time)">18:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title=jmdyck@irc>jmdyck</span>&gt;</div></td><td class="msg-cell">off</td></tr>
  <tr class="msg" id="L54"><td class="ts-cell"><a class="ts" href="#L54" alt="Mon May 03 2021 12:00:20 GMT-0700 (Pacific Daylight Time)">19:00</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title=jmdyck@irc>jmdyck</span>&gt;</div></td><td class="msg-cell">and then pushes genContext onto the stack and resumes it</td></tr>
  <tr class="msg" id="L55"><td class="ts-cell"><a class="ts" href="#L55" alt="Mon May 03 2021 12:01:22 GMT-0700 (Pacific Daylight Time)">19:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title=jmdyck@irc>jmdyck</span>&gt;</div></td><td class="msg-cell">so it starts to execute at step 5.a in AsyncGeneratorStart</td></tr>
  <tr class="msg" id="L56"><td class="ts-cell"><a class="ts" href="#L56" alt="Mon May 03 2021 12:03:08 GMT-0700 (Pacific Daylight Time)">19:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title=jmdyck@irc>jmdyck</span>&gt;</div></td><td class="msg-cell">which goes straight into 5.a.i, evaluating the function-body</td></tr>
  <tr class="msg" id="L57"><td class="ts-cell"><a class="ts" href="#L57" alt="Mon May 03 2021 12:04:46 GMT-0700 (Pacific Daylight Time)">19:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title=jmdyck@irc>jmdyck</span>&gt;</div></td><td class="msg-cell">the firs thing is to evaluate the AwaitExpression</td></tr>
  <tr class="msg" id="L58"><td class="ts-cell"><a class="ts" href="#L58" alt="Mon May 03 2021 12:07:05 GMT-0700 (Pacific Daylight Time)">19:07</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title=Bakkot@irc>Bakkot</span>&gt;</div></td><td class="msg-cell">this matches my interpretation so far; do you want me to jump in with (what I understand to be) the next few steps or would you prefer to walk through it yourself?</td></tr>
  <tr class="msg" id="L59"><td class="ts-cell"><a class="ts" href="#L59" alt="Mon May 03 2021 12:08:10 GMT-0700 (Pacific Daylight Time)">19:08</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title=jmdyck@irc>jmdyck</span>&gt;</div></td><td class="msg-cell">i think i need to take a break.</td></tr>
  <tr class="msg" id="L60"><td class="ts-cell"><a class="ts" href="#L60" alt="Mon May 03 2021 12:08:53 GMT-0700 (Pacific Daylight Time)">19:08</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title=jmdyck@irc>jmdyck</span>&gt;</div></td><td class="msg-cell">so yeah, jump in with the next few steps, and I&#039;ll get back to it later</td></tr>
  <tr class="msg" id="L61"><td class="ts-cell"><a class="ts" href="#L61" alt="Mon May 03 2021 12:12:54 GMT-0700 (Pacific Daylight Time)">19:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title=Bakkot@irc>Bakkot</span>&gt;</div></td><td class="msg-cell">so, the AwaitExpression evaluates, which invokes the Await macro, which suspends the generator&#039;s execution context, transferring control back to <a href="http://AsyncGenerator.prototype.next">AsyncGenerator.prototype.next</a></td></tr>
  <tr class="msg" id="L62"><td class="ts-cell"><a class="ts" href="#L62" alt="Mon May 03 2021 12:13:39 GMT-0700 (Pacific Daylight Time)">19:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title=Bakkot@irc>Bakkot</span>&gt;</div></td><td class="msg-cell">control proceeds in evaluating the script itself, meaning it then does `<a href="http://g.next">g.next</a>()` again, which calls AsyncGeneratorEnqueue</td></tr>
  <tr class="msg" id="L63"><td class="ts-cell"><a class="ts" href="#L63" alt="Mon May 03 2021 12:16:05 GMT-0700 (Pacific Daylight Time)">19:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title=Bakkot@irc>Bakkot</span>&gt;</div></td><td class="msg-cell">this appends a request to the AsyncGeneratorQueue, but this time state is ~executing~, so it does not call AsyncGeneratorResumeNext, and just finishes the call without doing any execution context stack juggling</td></tr>
  <tr class="msg" id="L64"><td class="ts-cell"><a class="ts" href="#L64" alt="Mon May 03 2021 12:16:20 GMT-0700 (Pacific Daylight Time)">19:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title=Bakkot@irc>Bakkot</span>&gt;</div></td><td class="msg-cell">then we do the `console.log(&#039;start&#039;)`</td></tr>
  <tr class="msg" id="L65"><td class="ts-cell"><a class="ts" href="#L65" alt="Mon May 03 2021 12:16:45 GMT-0700 (Pacific Daylight Time)">19:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title=Bakkot@irc>Bakkot</span>&gt;</div></td><td class="msg-cell">at some later point, the timeout completes, and the `new Promise` resolves</td></tr>
  <tr class="msg" id="L66"><td class="ts-cell"><a class="ts" href="#L66" alt="Mon May 03 2021 12:17:39 GMT-0700 (Pacific Daylight Time)">19:17</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title=Bakkot@irc>Bakkot</span>&gt;</div></td><td class="msg-cell">eliding a bit of tracing through the promise machinery, this leads to the algorithm steps in `Await Fulfilled Functions` being executed</td></tr>
  <tr class="msg" id="L67"><td class="ts-cell"><a class="ts" href="#L67" alt="Mon May 03 2021 12:20:05 GMT-0700 (Pacific Daylight Time)">19:20</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title=Bakkot@irc>Bakkot</span>&gt;</div></td><td class="msg-cell">this suspends the running execution context (which is, here, the context created to evaluate the &quot;resolve&quot; handler for the promise), and pushes and resumes the generator&#039;s context</td></tr>
  <tr class="msg" id="L68"><td class="ts-cell"><a class="ts" href="#L68" alt="Mon May 03 2021 12:20:47 GMT-0700 (Pacific Daylight Time)">19:20</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title=Bakkot@irc>Bakkot</span>&gt;</div></td><td class="msg-cell">control proceeds in the evaluation of the generator body until the `yield 0`, which does our first call to AsyncGeneratorYield</td></tr>
  <tr class="msg" id="L69"><td class="ts-cell"><a class="ts" href="#L69" alt="Mon May 03 2021 12:32:48 GMT-0700 (Pacific Daylight Time)">19:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title=Bakkot@irc>Bakkot</span>&gt;</div></td><td class="msg-cell">actually I get lost here I think</td></tr>
  <tr class="msg" id="L70"><td class="ts-cell"><a class="ts" href="#L70" alt="Mon May 03 2021 12:34:08 GMT-0700 (Pacific Daylight Time)">19:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title=Bakkot@irc>Bakkot</span>&gt;</div></td><td class="msg-cell">the first AsyncGeneratorYield suspends the generator context and sets up its evaluation state, then does AsyncGeneratorResolve, which pops the `AsyncGeneratorQueue` (so it is now empty) then does AsyncGeneratorResumeNext, which, since the queue is empty, immediately returns, which seems wrong</td></tr>
  <tr class="msg" id="L71"><td class="ts-cell"><a class="ts" href="#L71" alt="Mon May 03 2021 12:35:46 GMT-0700 (Pacific Daylight Time)">19:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title=Bakkot@irc>Bakkot</span>&gt;</div></td><td class="msg-cell">oh, the queue is not empty, nvm</td></tr>
  <tr class="msg" id="L72"><td class="ts-cell"><a class="ts" href="#L72" alt="Mon May 03 2021 12:36:16 GMT-0700 (Pacific Daylight Time)">19:36</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title=Bakkot@irc>Bakkot</span>&gt;</div></td><td class="msg-cell">the first call to `.next` added to the queue and did not remove it</td></tr>
  <tr class="msg" id="L73"><td class="ts-cell"><a class="ts" href="#L73" alt="Mon May 03 2021 12:36:41 GMT-0700 (Pacific Daylight Time)">19:36</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title=Bakkot@irc>Bakkot</span>&gt;</div></td><td class="msg-cell">the first AsyncGeneratorYield suspends the generator context and sets up its evaluation state, then does AsyncGeneratorResolve, which pops the `AsyncGeneratorQueue` (so it now has *one item*) then does AsyncGeneratorResumeNext</td></tr>
  <tr class="msg" id="L74"><td class="ts-cell"><a class="ts" href="#L74" alt="Mon May 03 2021 12:37:30 GMT-0700 (Pacific Daylight Time)">19:37</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title=Bakkot@irc>Bakkot</span>&gt;</div></td><td class="msg-cell">at this point, the queue is not empty, and the completion from the record in the queue queue is not abrupt, and the state is ~ suspendedYield~</td></tr>
  <tr class="msg" id="L75"><td class="ts-cell"><a class="ts" href="#L75" alt="Mon May 03 2021 12:38:32 GMT-0700 (Pacific Daylight Time)">19:38</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title=Bakkot@irc>Bakkot</span>&gt;</div></td><td class="msg-cell">so AsyncGeneratorResumeNext suspends the caller context - which, as before, is the context created to evaluate the &quot;resolve&quot; handler for the promise - and then pushes and resumes the generator context</td></tr>
  <tr class="msg" id="L76"><td class="ts-cell"><a class="ts" href="#L76" alt="Mon May 03 2021 12:39:52 GMT-0700 (Pacific Daylight Time)">19:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title=Bakkot@irc>Bakkot</span>&gt;</div></td><td class="msg-cell">this moves control to step 8.a of AsyncGeneratorYield</td></tr>
  <tr class="msg" id="L77"><td class="ts-cell"><a class="ts" href="#L77" alt="Mon May 03 2021 12:41:33 GMT-0700 (Pacific Daylight Time)">19:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title=Bakkot@irc>Bakkot</span>&gt;</div></td><td class="msg-cell">now we do another Await, where we are awaiting `undefined` (which was the argument to the second call to `.next`), which I&#039;m going to skip over because it&#039;s tedious and is not the interesting part</td></tr>
  <tr class="msg" id="L78"><td class="ts-cell"><a class="ts" href="#L78" alt="Mon May 03 2021 12:42:00 GMT-0700 (Pacific Daylight Time)">19:42</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title=Bakkot@irc>Bakkot</span>&gt;</div></td><td class="msg-cell">and we get to 8.e of AsyncGeneratorYield, which returns control to the evaluation of the generator body</td></tr>
  <tr class="msg" id="L79"><td class="ts-cell"><a class="ts" href="#L79" alt="Mon May 03 2021 12:42:15 GMT-0700 (Pacific Daylight Time)">19:42</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title=Bakkot@irc>Bakkot</span>&gt;</div></td><td class="msg-cell">so we console.log(&#039;b&#039;) and proceed to the second `yield`, which does our second AsyncGeneratorYield</td></tr>
  <tr class="msg" id="L80"><td class="ts-cell"><a class="ts" href="#L80" alt="Mon May 03 2021 12:42:44 GMT-0700 (Pacific Daylight Time)">19:42</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title=Bakkot@irc>Bakkot</span>&gt;</div></td><td class="msg-cell">this, again, suspends the execution context stack and sets up its evaluation state, then does AsyncGeneratorResolve</td></tr>
  <tr class="msg" id="L81"><td class="ts-cell"><a class="ts" href="#L81" alt="Mon May 03 2021 12:43:01 GMT-0700 (Pacific Daylight Time)">19:43</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title=Bakkot@irc>Bakkot</span>&gt;</div></td><td class="msg-cell">which pops the queue - so *now* it is empty - then does AsyncGeneratorResumeNext</td></tr>
  <tr class="msg" id="L82"><td class="ts-cell"><a class="ts" href="#L82" alt="Mon May 03 2021 12:43:21 GMT-0700 (Pacific Daylight Time)">19:43</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title=Bakkot@irc>Bakkot</span>&gt;</div></td><td class="msg-cell">but here the queue is empty, so AsyncGeneratorResumeNext returns without touching the execution context stack</td></tr>
  <tr class="msg" id="L83"><td class="ts-cell"><a class="ts" href="#L83" alt="Mon May 03 2021 12:43:57 GMT-0700 (Pacific Daylight Time)">19:43</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title=Bakkot@irc>Bakkot</span>&gt;</div></td><td class="msg-cell">so we go back to the AsyncGeneratorResumeNext call we were just doing, which then goes back to the AsyncGeneratorYield call we were just doing</td></tr>
  <tr class="msg" id="L84"><td class="ts-cell"><a class="ts" href="#L84" alt="Mon May 03 2021 12:45:03 GMT-0700 (Pacific Daylight Time)">19:45</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title=Bakkot@irc>Bakkot</span>&gt;</div></td><td class="msg-cell">and then, in step 9 of this second AsyncGeneratorYield call, we finally go back to the last step of the _first_ call to AsyncGeneratorYield,</td></tr>
  <tr class="msg" id="L85"><td class="ts-cell"><a class="ts" href="#L85" alt="Mon May 03 2021 12:45:58 GMT-0700 (Pacific Daylight Time)">19:45</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title=Bakkot@irc>Bakkot</span>&gt;</div></td><td class="msg-cell">which finishes, and finally returns control to the context created to evaluate the &quot;resolve&quot; handler for the promise, which goes about doing whatever it was doing</td></tr>
  <tr class="msg" id="L86"><td class="ts-cell"><a class="ts" href="#L86" alt="Mon May 03 2021 12:46:20 GMT-0700 (Pacific Daylight Time)">19:46</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title=Bakkot@irc>Bakkot</span>&gt;</div></td><td class="msg-cell">the end</td></tr>
  <tr class="msg" id="L87"><td class="ts-cell"><a class="ts" href="#L87" alt="Mon May 03 2021 12:48:21 GMT-0700 (Pacific Daylight Time)">19:48</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title=Bakkot@irc>Bakkot</span>&gt;</div></td><td class="msg-cell">to be precise, I should say: &quot;in step 9 of this second AsyncGeneratorYield call, we finally go back to step 19 of the first call to AsyncGeneratorResumeNext, which returns to AsyncGeneratorResolve, which returns to the first AsyncGeneratorYield, which finishes and returns to the resolve handler</td></tr>
  <tr class="msg" id="L88"><td class="ts-cell"><a class="ts" href="#L88" alt="Mon May 03 2021 12:48:22 GMT-0700 (Pacific Daylight Time)">19:48</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title=Bakkot@irc>Bakkot</span>&gt;</div></td><td class="msg-cell">&quot;</td></tr>
  <tr class="msg" id="L89"><td class="ts-cell"><a class="ts" href="#L89" alt="Mon May 03 2021 15:38:19 GMT-0700 (Pacific Daylight Time)">22:38</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title=aebabis@irc>aebabis</span>&gt;</div></td><td class="msg-cell">Hi, I have an idea for a proposal for ES. Is there anyone here I could bounce it off of?</td></tr>
  <tr class="msg" id="L90"><td class="ts-cell"><a class="ts" href="#L90" alt="Mon May 03 2021 15:39:44 GMT-0700 (Pacific Daylight Time)">22:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title=Bakkot@irc>Bakkot</span>&gt;</div></td><td class="msg-cell">aebabis <a href="https://es.discourse.group/c/ideas/7">https://es.discourse.group/c/ideas/7</a> is probably the ideal place</td></tr>
  <tr class="msg" id="L91"><td class="ts-cell"><a class="ts" href="#L91" alt="Mon May 03 2021 15:39:56 GMT-0700 (Pacific Daylight Time)">22:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title=aebabis@irc>aebabis</span>&gt;</div></td><td class="msg-cell">Thank you</td></tr>
  <tr class="msg" id="L92"><td class="ts-cell"><a class="ts" href="#L92" alt="Mon May 03 2021 16:11:17 GMT-0700 (Pacific Daylight Time)">23:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title=shu@irc>shu</span>&gt;</div></td><td class="msg-cell">Bakkot: so i have a contributor patch for v8 that allows escape async in for-of, e.g. `for (\u{61}sync of`. this seems... super gross to me?</td></tr>
  <tr class="msg" id="L93"><td class="ts-cell"><a class="ts" href="#L93" alt="Mon May 03 2021 16:11:41 GMT-0700 (Pacific Daylight Time)">23:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title=shu@irc>shu</span>&gt;</div></td><td class="msg-cell">Bakkot: is this how all lookaheads restrictions work, since the tokens are pre-StringValue?</td></tr>
  <tr class="msg" id="L94"><td class="ts-cell"><a class="ts" href="#L94" alt="Mon May 03 2021 16:39:32 GMT-0700 (Pacific Daylight Time)">23:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title=shu@irc>shu</span>&gt;</div></td><td class="msg-cell">i guess we already allow `for (l\u{65}t() of ...)`</td></tr>

</tbody></table></div></div></div></body>

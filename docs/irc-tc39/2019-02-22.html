<!doctype html>
<head>
  <title>#tc39 on 2019-02-22</title>
  <link rel="stylesheet" href="../style.css">
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">#tc39<br>2019-02-22<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2019-02-21" class="nav-link"><span>prev</span></a>
<a href="2019-02-25" class="nav-link"><span style="float:right">next</span></a>
</div>
    
<div class="room-list-wrapper">Active:<br>
<ul class="room-list">
<li><a href="../TC39_Delegates/">TC39 Delegates</a></li>
<li><a href="../TC39_Editors/">TC39 Editors</a></li>
<li><a href="../TC39_General/">TC39 General</a></li>
<li><a href="../WHATWG/">WHATWG</a></li>
</ul>
</div>
<br>
<div class="room-list-wrapper">Historical:<br>
<ul class="room-list">
<li><a href="../irc-tc39/" class="current-room">#tc39</a></li>
<li><a href="../irc-tc39-delegates/">#tc39-delegates</a></li>
<li><a href="../irc-tc39-editor-group/">#tc39-editor-group</a></li>
<li><a href="../irc-whatwg/">#whatwg</a></li>
</ul>
</div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs"><div class="log">
<table><tbody id="log-tbody">
  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Thu Feb 21 2019 18:02:13 GMT-0800 (Pacific Standard Time)">02:02</a></td><td class="nick-cell">&lt;<span class="nick nick-2" title=bradleymeck@irc>bradleymeck</span>&gt;</td><td class="msg-cell">the cookie 1 year challenge is always fun. Buy a box, wait a year buy a 2nd box and then try to guess which of the cookies are new vs old</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Thu Feb 21 2019 18:12:12 GMT-0800 (Pacific Standard Time)">02:12</a></td><td class="nick-cell">&lt;<span class="nick nick-6" title=rkirsling@irc>rkirsling</span>&gt;</td><td class="msg-cell">lol fascinating</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Thu Feb 21 2019 19:50:57 GMT-0800 (Pacific Standard Time)">03:50</a></td><td class="nick-cell">&lt;<span class="nick nick-6" title=ljharb@irc>ljharb</span>&gt;</td><td class="msg-cell">bradleymeck: not even frozen?</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Thu Feb 21 2019 19:51:00 GMT-0800 (Pacific Standard Time)">03:51</a></td><td class="nick-cell">&lt;<span class="nick nick-6" title=ljharb@irc>ljharb</span>&gt;</td><td class="msg-cell">interesting</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Thu Feb 21 2019 19:51:24 GMT-0800 (Pacific Standard Time)">03:51</a></td><td class="nick-cell">&lt;<span class="nick nick-6" title=ljharb@irc>ljharb</span>&gt;</td><td class="msg-cell">i know that tagalong chocolate gets relatively stale after 4-6 months, so that one&#039;d be easy</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Thu Feb 21 2019 19:51:34 GMT-0800 (Pacific Standard Time)">03:51</a></td><td class="nick-cell">&lt;<span class="nick nick-6" title=ljharb@irc>ljharb</span>&gt;</td><td class="msg-cell">(when unfrozen)</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Fri Feb 22 2019 06:22:17 GMT-0800 (Pacific Standard Time)">14:22</a></td><td class="nick-cell">&lt;<span class="nick nick-2" title=bradleymeck@irc>bradleymeck</span>&gt;</td><td class="msg-cell">ljharb: in the refrigerator is my game</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Fri Feb 22 2019 08:55:50 GMT-0800 (Pacific Standard Time)">16:55</a></td><td class="nick-cell">&lt;<span class="nick nick-5" title=devsnek@irc>devsnek</span>&gt;</td><td class="msg-cell">what are people&#039;s opinions on a js runtime that crashes when a promise rejects without a rejection handler</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Fri Feb 22 2019 09:04:28 GMT-0800 (Pacific Standard Time)">17:04</a></td><td class="nick-cell">&lt;<span class="nick nick-1" title=Domenic@irc>Domenic</span>&gt;</td><td class="msg-cell">littledan: I don&#039;t understand why an explicit RunJobs is needed</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Fri Feb 22 2019 09:04:51 GMT-0800 (Pacific Standard Time)">17:04</a></td><td class="nick-cell">&lt;<span class="nick nick-1" title=Domenic@irc>Domenic</span>&gt;</td><td class="msg-cell">After each job, the job queue will be emptied automatically, at least in HTML.</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Fri Feb 22 2019 09:04:58 GMT-0800 (Pacific Standard Time)">17:04</a></td><td class="nick-cell">&lt;<span class="nick nick-1" title=Domenic@irc>Domenic</span>&gt;</td><td class="msg-cell">Are you running script without using a job?</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Fri Feb 22 2019 09:05:05 GMT-0800 (Pacific Standard Time)">17:05</a></td><td class="nick-cell">&lt;<span class="nick nick-10" title=littledan@irc>littledan</span>&gt;</td><td class="msg-cell">hey, thanks for the quick review, Domenic</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Fri Feb 22 2019 09:05:22 GMT-0800 (Pacific Standard Time)">17:05</a></td><td class="nick-cell">&lt;<span class="nick nick-10" title=littledan@irc>littledan</span>&gt;</td><td class="msg-cell">I guess I&#039;m missing the part where HTML gets involved here, in InnerModuleEvaluation</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Fri Feb 22 2019 09:05:42 GMT-0800 (Pacific Standard Time)">17:05</a></td><td class="nick-cell">&lt;<span class="nick nick-10" title=littledan@irc>littledan</span>&gt;</td><td class="msg-cell">I thought that spun around in JS a bunch without HTML coming into play, once the module graph was all pulled down and executing</td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Fri Feb 22 2019 09:06:03 GMT-0800 (Pacific Standard Time)">17:06</a></td><td class="nick-cell">&lt;<span class="nick nick-1" title=Domenic@irc>Domenic</span>&gt;</td><td class="msg-cell">Step 13.g.i does PerformPromiseThen()</td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Fri Feb 22 2019 09:06:07 GMT-0800 (Pacific Standard Time)">17:06</a></td><td class="nick-cell">&lt;<span class="nick nick-1" title=Domenic@irc>Domenic</span>&gt;</td><td class="msg-cell">Which will enqueue a job</td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Fri Feb 22 2019 09:06:18 GMT-0800 (Pacific Standard Time)">17:06</a></td><td class="nick-cell">&lt;<span class="nick nick-1" title=Domenic@irc>Domenic</span>&gt;</td><td class="msg-cell">Which, when that job finishes, will perform a microtask checkpoint</td></tr>
  <tr class="msg" id="L17"><td class="ts-cell"><a class="ts" href="#L17" alt="Fri Feb 22 2019 09:06:39 GMT-0800 (Pacific Standard Time)">17:06</a></td><td class="nick-cell">&lt;<span class="nick nick-1" title=Domenic@irc>Domenic</span>&gt;</td><td class="msg-cell">It currently does do that. But with the changes in top-level await, evaluating a module now does promise things, so HTML gets back into the loop</td></tr>
  <tr class="msg" id="L18"><td class="ts-cell"><a class="ts" href="#L18" alt="Fri Feb 22 2019 09:06:53 GMT-0800 (Pacific Standard Time)">17:06</a></td><td class="nick-cell">&lt;<span class="nick nick-1" title=Domenic@irc>Domenic</span>&gt;</td><td class="msg-cell">s/13.g.i/13.g.iv/</td></tr>
  <tr class="msg" id="L19"><td class="ts-cell"><a class="ts" href="#L19" alt="Fri Feb 22 2019 09:08:05 GMT-0800 (Pacific Standard Time)">17:08</a></td><td class="nick-cell">&lt;<span class="nick nick-10" title=littledan@irc>littledan</span>&gt;</td><td class="msg-cell">sorry, 13.g.iv of which algorithm?</td></tr>
  <tr class="msg" id="L20"><td class="ts-cell"><a class="ts" href="#L20" alt="Fri Feb 22 2019 09:08:15 GMT-0800 (Pacific Standard Time)">17:08</a></td><td class="nick-cell">&lt;<span class="nick nick-1" title=Domenic@irc>Domenic</span>&gt;</td><td class="msg-cell"><a href="https://tc39.github.io/proposal-top-level-await/#sec-innermoduleevaluation">https://tc39.github.io/proposal-top-level-await/#sec-innermoduleevaluation</a></td></tr>
  <tr class="msg" id="L21"><td class="ts-cell"><a class="ts" href="#L21" alt="Fri Feb 22 2019 09:08:50 GMT-0800 (Pacific Standard Time)">17:08</a></td><td class="nick-cell">&lt;<span class="nick nick-5" title=devsnek@irc>devsnek</span>&gt;</td><td class="msg-cell">how can queuing a job run the job queue</td></tr>
  <tr class="msg" id="L22"><td class="ts-cell"><a class="ts" href="#L22" alt="Fri Feb 22 2019 09:09:00 GMT-0800 (Pacific Standard Time)">17:09</a></td><td class="nick-cell">&lt;<span class="nick nick-10" title=littledan@irc>littledan</span>&gt;</td><td class="msg-cell">so, yeah, when all the microtask queue items are done, there&#039;s a checkpoint. But I don&#039;t see why we&#039;d get to a checkpoint if we have a big glob of modules running</td></tr>
  <tr class="msg" id="L23"><td class="ts-cell"><a class="ts" href="#L23" alt="Fri Feb 22 2019 09:09:18 GMT-0800 (Pacific Standard Time)">17:09</a></td><td class="nick-cell">&lt;<span class="nick nick-10" title=littledan@irc>littledan</span>&gt;</td><td class="msg-cell">I mean, a bunch of things will get queued, due to stuff happening in launching the evaluation of different modules</td></tr>
  <tr class="msg" id="L24"><td class="ts-cell"><a class="ts" href="#L24" alt="Fri Feb 22 2019 09:09:41 GMT-0800 (Pacific Standard Time)">17:09</a></td><td class="nick-cell">&lt;<span class="nick nick-10" title=littledan@irc>littledan</span>&gt;</td><td class="msg-cell">the insertion of a microtask queue checkpoint (via the willful violation by HTML noted in FlushJobs) would sort these out</td></tr>
  <tr class="msg" id="L25"><td class="ts-cell"><a class="ts" href="#L25" alt="Fri Feb 22 2019 09:10:04 GMT-0800 (Pacific Standard Time)">17:10</a></td><td class="nick-cell">&lt;<span class="nick nick-1" title=Domenic@irc>Domenic</span>&gt;</td><td class="msg-cell">Hmm</td></tr>
  <tr class="msg" id="L26"><td class="ts-cell"><a class="ts" href="#L26" alt="Fri Feb 22 2019 09:10:09 GMT-0800 (Pacific Standard Time)">17:10</a></td><td class="nick-cell">&lt;<span class="nick nick-10" title=littledan@irc>littledan</span>&gt;</td><td class="msg-cell">there&#039;s a standing disagreement between HTML and JS on layering; I&#039;m not trying to say things are resolved in one way or the other, just explain it with both mechanisms at once</td></tr>
  <tr class="msg" id="L27"><td class="ts-cell"><a class="ts" href="#L27" alt="Fri Feb 22 2019 09:10:28 GMT-0800 (Pacific Standard Time)">17:10</a></td><td class="nick-cell">&lt;<span class="nick nick-1" title=Domenic@irc>Domenic</span>&gt;</td><td class="msg-cell">So the problem is that you are queuing A, B, C, D, E but you want to run things in... what order?</td></tr>
  <tr class="msg" id="L28"><td class="ts-cell"><a class="ts" href="#L28" alt="Fri Feb 22 2019 09:10:45 GMT-0800 (Pacific Standard Time)">17:10</a></td><td class="nick-cell">&lt;<span class="nick nick-1" title=Domenic@irc>Domenic</span>&gt;</td><td class="msg-cell">Let me do better letters</td></tr>
  <tr class="msg" id="L29"><td class="ts-cell"><a class="ts" href="#L29" alt="Fri Feb 22 2019 09:11:20 GMT-0800 (Pacific Standard Time)">17:11</a></td><td class="nick-cell">&lt;<span class="nick nick-1" title=Domenic@irc>Domenic</span>&gt;</td><td class="msg-cell">Given <a href="https://github.com/tc39/proposal-top-level-await/issues/47#issuecomment-464488593">https://github.com/tc39/proposal-top-level-await/issues/47#issuecomment-464488593</a></td></tr>
  <tr class="msg" id="L30"><td class="ts-cell"><a class="ts" href="#L30" alt="Fri Feb 22 2019 09:11:23 GMT-0800 (Pacific Standard Time)">17:11</a></td><td class="nick-cell">&lt;<span class="nick nick-1" title=Domenic@irc>Domenic</span>&gt;</td><td class="msg-cell">Are you not queuing jobs in order a1-1, a-2, a, b, main?</td></tr>
  <tr class="msg" id="L31"><td class="ts-cell"><a class="ts" href="#L31" alt="Fri Feb 22 2019 09:11:28 GMT-0800 (Pacific Standard Time)">17:11</a></td><td class="nick-cell">&lt;<span class="nick nick-1" title=Domenic@irc>Domenic</span>&gt;</td><td class="msg-cell">What order are you queuing the jobs in?</td></tr>
  <tr class="msg" id="L32"><td class="ts-cell"><a class="ts" href="#L32" alt="Fri Feb 22 2019 09:11:48 GMT-0800 (Pacific Standard Time)">17:11</a></td><td class="nick-cell">&lt;<span class="nick nick-10" title=littledan@irc>littledan</span>&gt;</td><td class="msg-cell">the microtask queue congestion issue comes up because of the Promise.all at the beginning of modules that import things</td></tr>
  <tr class="msg" id="L33"><td class="ts-cell"><a class="ts" href="#L33" alt="Fri Feb 22 2019 09:12:05 GMT-0800 (Pacific Standard Time)">17:12</a></td><td class="nick-cell">&lt;<span class="nick nick-10" title=littledan@irc>littledan</span>&gt;</td><td class="msg-cell">the &quot;right&quot; tree might end up being run before the &quot;left&quot; tree if it&#039;s less deep</td></tr>
  <tr class="msg" id="L34"><td class="ts-cell"><a class="ts" href="#L34" alt="Fri Feb 22 2019 09:12:39 GMT-0800 (Pacific Standard Time)">17:12</a></td><td class="nick-cell">&lt;<span class="nick nick-10" title=littledan@irc>littledan</span>&gt;</td><td class="msg-cell">so, that&#039;s why a ends up running after b</td></tr>
  <tr class="msg" id="L35"><td class="ts-cell"><a class="ts" href="#L35" alt="Fri Feb 22 2019 09:12:46 GMT-0800 (Pacific Standard Time)">17:12</a></td><td class="nick-cell">&lt;<span class="nick nick-1" title=Domenic@irc>Domenic</span>&gt;</td><td class="msg-cell">Right, I got that. But I&#039;m trying to root cause. Is the issue you are queuing jobs in a different order than a-1, a-2, a, b, main?</td></tr>
  <tr class="msg" id="L36"><td class="ts-cell"><a class="ts" href="#L36" alt="Fri Feb 22 2019 09:13:06 GMT-0800 (Pacific Standard Time)">17:13</a></td><td class="nick-cell">&lt;<span class="nick nick-10" title=littledan@irc>littledan</span>&gt;</td><td class="msg-cell">well, we&#039;re telling the modules to start in the right order</td></tr>
  <tr class="msg" id="L37"><td class="ts-cell"><a class="ts" href="#L37" alt="Fri Feb 22 2019 09:13:25 GMT-0800 (Pacific Standard Time)">17:13</a></td><td class="nick-cell">&lt;<span class="nick nick-10" title=littledan@irc>littledan</span>&gt;</td><td class="msg-cell">it&#039;s just, when we tell a to start, it has to work through a bunch of Promise reactions first</td></tr>
  <tr class="msg" id="L38"><td class="ts-cell"><a class="ts" href="#L38" alt="Fri Feb 22 2019 09:14:04 GMT-0800 (Pacific Standard Time)">17:14</a></td><td class="nick-cell">&lt;<span class="nick nick-1" title=Domenic@irc>Domenic</span>&gt;</td><td class="msg-cell">It seems like you could add an a-1.then(a-2) chain to do this</td></tr>
  <tr class="msg" id="L39"><td class="ts-cell"><a class="ts" href="#L39" alt="Fri Feb 22 2019 09:14:18 GMT-0800 (Pacific Standard Time)">17:14</a></td><td class="nick-cell">&lt;<span class="nick nick-1" title=Domenic@irc>Domenic</span>&gt;</td><td class="msg-cell">Like, add a-1 to a-2&#039;s promise.all</td></tr>
  <tr class="msg" id="L40"><td class="ts-cell"><a class="ts" href="#L40" alt="Fri Feb 22 2019 09:15:54 GMT-0800 (Pacific Standard Time)">17:15</a></td><td class="nick-cell">&lt;<span class="nick nick-1" title=Domenic@irc>Domenic</span>&gt;</td><td class="msg-cell">I&#039;m just leery of essentially inserting a &quot;rearrange the job queue here&quot; step.</td></tr>
  <tr class="msg" id="L41"><td class="ts-cell"><a class="ts" href="#L41" alt="Fri Feb 22 2019 09:16:13 GMT-0800 (Pacific Standard Time)">17:16</a></td><td class="nick-cell">&lt;<span class="nick nick-1" title=Domenic@irc>Domenic</span>&gt;</td><td class="msg-cell">Instead of ensuring the evaluation jobs get queued in the right order in the first place.</td></tr>
  <tr class="msg" id="L42"><td class="ts-cell"><a class="ts" href="#L42" alt="Fri Feb 22 2019 09:16:35 GMT-0800 (Pacific Standard Time)">17:16</a></td><td class="nick-cell">&lt;<span class="nick nick-10" title=littledan@irc>littledan</span>&gt;</td><td class="msg-cell">isn&#039;t that going back to &quot;variant A&quot;?</td></tr>
  <tr class="msg" id="L43"><td class="ts-cell"><a class="ts" href="#L43" alt="Fri Feb 22 2019 09:16:45 GMT-0800 (Pacific Standard Time)">17:16</a></td><td class="nick-cell">&lt;<span class="nick nick-10" title=littledan@irc>littledan</span>&gt;</td><td class="msg-cell">I think that would be adding more synchronous behavior than what I&#039;m doing here</td></tr>
  <tr class="msg" id="L44"><td class="ts-cell"><a class="ts" href="#L44" alt="Fri Feb 22 2019 09:16:49 GMT-0800 (Pacific Standard Time)">17:16</a></td><td class="nick-cell">&lt;<span class="nick nick-1" title=Domenic@irc>Domenic</span>&gt;</td><td class="msg-cell">Hmm</td></tr>
  <tr class="msg" id="L45"><td class="ts-cell"><a class="ts" href="#L45" alt="Fri Feb 22 2019 09:17:02 GMT-0800 (Pacific Standard Time)">17:17</a></td><td class="nick-cell">&lt;<span class="nick nick-10" title=littledan@irc>littledan</span>&gt;</td><td class="msg-cell">flushing the microtask queue is only about the parts that run synchronously, so it&#039;s a lot lighter weight</td></tr>
  <tr class="msg" id="L46"><td class="ts-cell"><a class="ts" href="#L46" alt="Fri Feb 22 2019 09:17:14 GMT-0800 (Pacific Standard Time)">17:17</a></td><td class="nick-cell">&lt;<span class="nick nick-1" title=Domenic@irc>Domenic</span>&gt;</td><td class="msg-cell">Yeah, that would be variant A, bad.</td></tr>
  <tr class="msg" id="L47"><td class="ts-cell"><a class="ts" href="#L47" alt="Fri Feb 22 2019 09:17:22 GMT-0800 (Pacific Standard Time)">17:17</a></td><td class="nick-cell">&lt;<span class="nick nick-1" title=Domenic@irc>Domenic</span>&gt;</td><td class="msg-cell">I&#039;m just having a fundamental confusion:</td></tr>
  <tr class="msg" id="L48"><td class="ts-cell"><a class="ts" href="#L48" alt="Fri Feb 22 2019 09:17:34 GMT-0800 (Pacific Standard Time)">17:17</a></td><td class="nick-cell">&lt;<span class="nick nick-1" title=Domenic@irc>Domenic</span>&gt;</td><td class="msg-cell">HTML ensures that whenever the stack is empty, the job queue is drained</td></tr>
  <tr class="msg" id="L49"><td class="ts-cell"><a class="ts" href="#L49" alt="Fri Feb 22 2019 09:17:35 GMT-0800 (Pacific Standard Time)">17:17</a></td><td class="nick-cell">&lt;<span class="nick nick-10" title=littledan@irc>littledan</span>&gt;</td><td class="msg-cell">but, a lot of people have had this kind of reaction, that it doesn&#039;t smell right to flush the microtask queue</td></tr>
  <tr class="msg" id="L50"><td class="ts-cell"><a class="ts" href="#L50" alt="Fri Feb 22 2019 09:17:50 GMT-0800 (Pacific Standard Time)">17:17</a></td><td class="nick-cell">&lt;<span class="nick nick-1" title=Domenic@irc>Domenic</span>&gt;</td><td class="msg-cell">If you have to manually flush the job queue, then that means you are doing so when the stack is not empty</td></tr>
  <tr class="msg" id="L51"><td class="ts-cell"><a class="ts" href="#L51" alt="Fri Feb 22 2019 09:17:56 GMT-0800 (Pacific Standard Time)">17:17</a></td><td class="nick-cell">&lt;<span class="nick nick-1" title=Domenic@irc>Domenic</span>&gt;</td><td class="msg-cell">I don&#039;t understand why that would be necessary.</td></tr>
  <tr class="msg" id="L52"><td class="ts-cell"><a class="ts" href="#L52" alt="Fri Feb 22 2019 09:18:16 GMT-0800 (Pacific Standard Time)">17:18</a></td><td class="nick-cell">&lt;<span class="nick nick-10" title=littledan@irc>littledan</span>&gt;</td><td class="msg-cell">when you say stack, do you mean that there&#039;s no JS running?</td></tr>
  <tr class="msg" id="L53"><td class="ts-cell"><a class="ts" href="#L53" alt="Fri Feb 22 2019 09:18:23 GMT-0800 (Pacific Standard Time)">17:18</a></td><td class="nick-cell">&lt;<span class="nick nick-1" title=Domenic@irc>Domenic</span>&gt;</td><td class="msg-cell">Right.</td></tr>
  <tr class="msg" id="L54"><td class="ts-cell"><a class="ts" href="#L54" alt="Fri Feb 22 2019 09:18:33 GMT-0800 (Pacific Standard Time)">17:18</a></td><td class="nick-cell">&lt;<span class="nick nick-1" title=Domenic@irc>Domenic</span>&gt;</td><td class="msg-cell">E.g. when we&#039;re waiting on a promise reaction</td></tr>
  <tr class="msg" id="L55"><td class="ts-cell"><a class="ts" href="#L55" alt="Fri Feb 22 2019 09:18:45 GMT-0800 (Pacific Standard Time)">17:18</a></td><td class="nick-cell">&lt;<span class="nick nick-10" title=littledan@irc>littledan</span>&gt;</td><td class="msg-cell">well, this algorithm is being driven by something that&#039;s not JS; there&#039;s no JS running</td></tr>
  <tr class="msg" id="L56"><td class="ts-cell"><a class="ts" href="#L56" alt="Fri Feb 22 2019 09:19:08 GMT-0800 (Pacific Standard Time)">17:19</a></td><td class="nick-cell">&lt;<span class="nick nick-10" title=littledan@irc>littledan</span>&gt;</td><td class="msg-cell">maybe we can do something at the JS level that explains that, duh, the job queue is clearly drained, no need for FlushJobs</td></tr>
  <tr class="msg" id="L57"><td class="ts-cell"><a class="ts" href="#L57" alt="Fri Feb 22 2019 09:19:11 GMT-0800 (Pacific Standard Time)">17:19</a></td><td class="nick-cell">&lt;<span class="nick nick-1" title=Domenic@irc>Domenic</span>&gt;</td><td class="msg-cell">Hmm</td></tr>
  <tr class="msg" id="L58"><td class="ts-cell"><a class="ts" href="#L58" alt="Fri Feb 22 2019 09:19:23 GMT-0800 (Pacific Standard Time)">17:19</a></td><td class="nick-cell">&lt;<span class="nick nick-1" title=Domenic@irc>Domenic</span>&gt;</td><td class="msg-cell">Maybe that is what I&#039;m missing</td></tr>
  <tr class="msg" id="L59"><td class="ts-cell"><a class="ts" href="#L59" alt="Fri Feb 22 2019 09:20:45 GMT-0800 (Pacific Standard Time)">17:20</a></td><td class="nick-cell">&lt;<span class="nick nick-1" title=Domenic@irc>Domenic</span>&gt;</td><td class="msg-cell">We are using jobs and promises, but there is no JS execution context stack, where emptying it triggers the microtask checkpoint... hmmm...</td></tr>
  <tr class="msg" id="L60"><td class="ts-cell"><a class="ts" href="#L60" alt="Fri Feb 22 2019 09:21:12 GMT-0800 (Pacific Standard Time)">17:21</a></td><td class="nick-cell">&lt;<span class="nick nick-10" title=littledan@irc>littledan</span>&gt;</td><td class="msg-cell">yeah, when you say HTML ensures this, do you mean in <a href="https://html.spec.whatwg.org/#event-loop-processing-model">https://html.spec.whatwg.org/#event-loop-processing-model</a> ?</td></tr>
  <tr class="msg" id="L61"><td class="ts-cell"><a class="ts" href="#L61" alt="Fri Feb 22 2019 09:21:28 GMT-0800 (Pacific Standard Time)">17:21</a></td><td class="nick-cell">&lt;<span class="nick nick-10" title=littledan@irc>littledan</span>&gt;</td><td class="msg-cell">I guess the issue is (again) that JS doesn&#039;t really have a &quot;processing model&quot;</td></tr>
  <tr class="msg" id="L62"><td class="ts-cell"><a class="ts" href="#L62" alt="Fri Feb 22 2019 09:21:49 GMT-0800 (Pacific Standard Time)">17:21</a></td><td class="nick-cell">&lt;<span class="nick nick-10" title=littledan@irc>littledan</span>&gt;</td><td class="msg-cell">and this algorithm is one of the few that runs when there&#039;s no JS active</td></tr>
  <tr class="msg" id="L63"><td class="ts-cell"><a class="ts" href="#L63" alt="Fri Feb 22 2019 09:22:06 GMT-0800 (Pacific Standard Time)">17:22</a></td><td class="nick-cell">&lt;<span class="nick nick-1" title=Domenic@irc>Domenic</span>&gt;</td><td class="msg-cell">No, I mean in <a href="https://html.spec.whatwg.org/#clean-up-after-running-script">https://html.spec.whatwg.org/#clean-up-after-running-script</a></td></tr>
  <tr class="msg" id="L64"><td class="ts-cell"><a class="ts" href="#L64" alt="Fri Feb 22 2019 09:23:52 GMT-0800 (Pacific Standard Time)">17:23</a></td><td class="nick-cell">&lt;<span class="nick nick-10" title=littledan@irc>littledan</span>&gt;</td><td class="msg-cell">hmm, so an interesting thing about this algorithm is that we might not actually invoke JavaScript, we might just work our way through some Then reactions and find ourselves still blocked</td></tr>
  <tr class="msg" id="L65"><td class="ts-cell"><a class="ts" href="#L65" alt="Fri Feb 22 2019 09:24:55 GMT-0800 (Pacific Standard Time)">17:24</a></td><td class="nick-cell">&lt;<span class="nick nick-10" title=littledan@irc>littledan</span>&gt;</td><td class="msg-cell">oh, I guess that will still run the &quot;clean up after running script&quot; algorithnm</td></tr>
  <tr class="msg" id="L66"><td class="ts-cell"><a class="ts" href="#L66" alt="Fri Feb 22 2019 09:25:21 GMT-0800 (Pacific Standard Time)">17:25</a></td><td class="nick-cell">&lt;<span class="nick nick-10" title=littledan@irc>littledan</span>&gt;</td><td class="msg-cell">right, since that algorithm is run after each microtask</td></tr>
  <tr class="msg" id="L67"><td class="ts-cell"><a class="ts" href="#L67" alt="Fri Feb 22 2019 09:25:24 GMT-0800 (Pacific Standard Time)">17:25</a></td><td class="nick-cell">&lt;<span class="nick nick-1" title=Domenic@irc>Domenic</span>&gt;</td><td class="msg-cell">Wait a minute</td></tr>
  <tr class="msg" id="L68"><td class="ts-cell"><a class="ts" href="#L68" alt="Fri Feb 22 2019 09:25:34 GMT-0800 (Pacific Standard Time)">17:25</a></td><td class="nick-cell">&lt;<span class="nick nick-1" title=Domenic@irc>Domenic</span>&gt;</td><td class="msg-cell">Are all calls to InnerModuleEvaluation() synchronous?</td></tr>
  <tr class="msg" id="L69"><td class="ts-cell"><a class="ts" href="#L69" alt="Fri Feb 22 2019 09:25:38 GMT-0800 (Pacific Standard Time)">17:25</a></td><td class="nick-cell">&lt;<span class="nick nick-10" title=littledan@irc>littledan</span>&gt;</td><td class="msg-cell">yes</td></tr>
  <tr class="msg" id="L70"><td class="ts-cell"><a class="ts" href="#L70" alt="Fri Feb 22 2019 09:25:47 GMT-0800 (Pacific Standard Time)">17:25</a></td><td class="nick-cell">&lt;<span class="nick nick-1" title=Domenic@irc>Domenic</span>&gt;</td><td class="msg-cell">Oh then it seems this is already aligned with HTML</td></tr>
  <tr class="msg" id="L71"><td class="ts-cell"><a class="ts" href="#L71" alt="Fri Feb 22 2019 09:25:55 GMT-0800 (Pacific Standard Time)">17:25</a></td><td class="nick-cell">&lt;<span class="nick nick-1" title=Domenic@irc>Domenic</span>&gt;</td><td class="msg-cell">HTML already calls &quot;clean up after running script&quot; after it calls Evalaute()</td></tr>
  <tr class="msg" id="L72"><td class="ts-cell"><a class="ts" href="#L72" alt="Fri Feb 22 2019 09:26:10 GMT-0800 (Pacific Standard Time)">17:26</a></td><td class="nick-cell">&lt;<span class="nick nick-10" title=littledan@irc>littledan</span>&gt;</td><td class="msg-cell">that&#039;s not the right time, since Evaluate() is only called once, and we need it called after loading each module</td></tr>
  <tr class="msg" id="L73"><td class="ts-cell"><a class="ts" href="#L73" alt="Fri Feb 22 2019 09:26:18 GMT-0800 (Pacific Standard Time)">17:26</a></td><td class="nick-cell">&lt;<span class="nick nick-1" title=Domenic@irc>Domenic</span>&gt;</td><td class="msg-cell">No, nevermind, yeah</td></tr>
  <tr class="msg" id="L74"><td class="ts-cell"><a class="ts" href="#L74" alt="Fri Feb 22 2019 09:26:50 GMT-0800 (Pacific Standard Time)">17:26</a></td><td class="nick-cell">&lt;<span class="nick nick-1" title=Domenic@irc>Domenic</span>&gt;</td><td class="msg-cell">Right because you are using the job queue for things that could be synchronous, hmm</td></tr>
  <tr class="msg" id="L75"><td class="ts-cell"><a class="ts" href="#L75" alt="Fri Feb 22 2019 09:27:01 GMT-0800 (Pacific Standard Time)">17:27</a></td><td class="nick-cell">&lt;<span class="nick nick-1" title=Domenic@irc>Domenic</span>&gt;</td><td class="msg-cell">OK I have to run to a meeting but I am coming around to draining the job queue</td></tr>
  <tr class="msg" id="L76"><td class="ts-cell"><a class="ts" href="#L76" alt="Fri Feb 22 2019 09:27:16 GMT-0800 (Pacific Standard Time)">17:27</a></td><td class="nick-cell">&lt;<span class="nick nick-1" title=Domenic@irc>Domenic</span>&gt;</td><td class="msg-cell">I am hopeful my resolution will be to draft a lengthy non-normative note explaining why it makes sense</td></tr>
  <tr class="msg" id="L77"><td class="ts-cell"><a class="ts" href="#L77" alt="Fri Feb 22 2019 09:27:40 GMT-0800 (Pacific Standard Time)">17:27</a></td><td class="nick-cell">&lt;<span class="nick nick-10" title=littledan@irc>littledan</span>&gt;</td><td class="msg-cell">why FlushJobs makes sense, or why it&#039;s not necessary?</td></tr>
  <tr class="msg" id="L78"><td class="ts-cell"><a class="ts" href="#L78" alt="Fri Feb 22 2019 09:27:44 GMT-0800 (Pacific Standard Time)">17:27</a></td><td class="nick-cell">&lt;<span class="nick nick-1" title=Domenic@irc>Domenic</span>&gt;</td><td class="msg-cell">Why it makes sense</td></tr>
  <tr class="msg" id="L79"><td class="ts-cell"><a class="ts" href="#L79" alt="Fri Feb 22 2019 09:27:51 GMT-0800 (Pacific Standard Time)">17:27</a></td><td class="nick-cell">&lt;<span class="nick nick-10" title=littledan@irc>littledan</span>&gt;</td><td class="msg-cell">OK, great</td></tr>
  <tr class="msg" id="L80"><td class="ts-cell"><a class="ts" href="#L80" alt="Fri Feb 22 2019 09:28:24 GMT-0800 (Pacific Standard Time)">17:28</a></td><td class="nick-cell">&lt;<span class="nick nick-1" title=Domenic@irc>Domenic</span>&gt;</td><td class="msg-cell">We may want to tweak things a bit so we can do host setup, not just host teardown, before/after each chunk of graph work</td></tr>
  <tr class="msg" id="L81"><td class="ts-cell"><a class="ts" href="#L81" alt="Fri Feb 22 2019 09:32:39 GMT-0800 (Pacific Standard Time)">17:32</a></td><td class="nick-cell">&lt;<span class="nick nick-10" title=littledan@irc>littledan</span>&gt;</td><td class="msg-cell">that makes sense; I imagine that there could be other kinds of settings to put in place. The big question to answer at this point is whether we&#039;re doing a microtask checkpoint or going for all-synchronous execution.</td></tr>
  <tr class="msg" id="L82"><td class="ts-cell"><a class="ts" href="#L82" alt="Fri Feb 22 2019 09:33:05 GMT-0800 (Pacific Standard Time)">17:33</a></td><td class="nick-cell">&lt;<span class="nick nick-10" title=littledan@irc>littledan</span>&gt;</td><td class="msg-cell">and, if this seems reasonable to you, I&#039;m leaning microtask checkpoint as well</td></tr>
  <tr class="msg" id="L83"><td class="ts-cell"><a class="ts" href="#L83" alt="Fri Feb 22 2019 09:35:21 GMT-0800 (Pacific Standard Time)">17:35</a></td><td class="nick-cell">&lt;<span class="nick nick-1" title=Domenic@irc>Domenic</span>&gt;</td><td class="msg-cell">(turns out my meeting was a half-hour later, but now I need to get lunch in 25 minutes, whee)</td></tr>
  <tr class="msg" id="L84"><td class="ts-cell"><a class="ts" href="#L84" alt="Fri Feb 22 2019 09:36:11 GMT-0800 (Pacific Standard Time)">17:36</a></td><td class="nick-cell">&lt;<span class="nick nick-1" title=Domenic@irc>Domenic</span>&gt;</td><td class="msg-cell">On the other hand it&#039;s a bit weird to anticipate every host adding very similar hooks just so that ES can use the job queue to do sync work</td></tr>
  <tr class="msg" id="L85"><td class="ts-cell"><a class="ts" href="#L85" alt="Fri Feb 22 2019 10:41:00 GMT-0800 (Pacific Standard Time)">18:41</a></td><td class="nick-cell">&lt;<span class="nick nick-1" title=Domenic@irc>Domenic</span>&gt;</td><td class="msg-cell"><a href="https://github.com/whatwg/html/issues/4175#issuecomment-466047231">https://github.com/whatwg/html/issues/4175#issuecomment-466047231</a> about a no-credentials mode instead of CORS is so weird to me.</td></tr>
  <tr class="msg" id="L86"><td class="ts-cell"><a class="ts" href="#L86" alt="Fri Feb 22 2019 10:41:22 GMT-0800 (Pacific Standard Time)">18:41</a></td><td class="nick-cell">&lt;<span class="nick nick-1" title=Domenic@irc>Domenic</span>&gt;</td><td class="msg-cell">If we thought intranets didn&#039;t matter, we would&#039;ve just made no-credentials a requirement for outgoing requests long ago and never had to do the CORS business.</td></tr>
  <tr class="msg" id="L87"><td class="ts-cell"><a class="ts" href="#L87" alt="Fri Feb 22 2019 10:41:33 GMT-0800 (Pacific Standard Time)">18:41</a></td><td class="nick-cell">&lt;<span class="nick nick-1" title=Domenic@irc>Domenic</span>&gt;</td><td class="msg-cell">Oops, wrong channel</td></tr>
  <tr class="msg" id="L88"><td class="ts-cell"><a class="ts" href="#L88" alt="Fri Feb 22 2019 11:19:03 GMT-0800 (Pacific Standard Time)">19:19</a></td><td class="nick-cell">&lt;<span class="nick nick-6" title=rkirsling@irc>rkirsling</span>&gt;</td><td class="msg-cell">I just learned that `new Date(undefined)` is not the same thing as `new Date()` and I totally want to flip a table right now ðŸ¤¯</td></tr>
  <tr class="msg" id="L89"><td class="ts-cell"><a class="ts" href="#L89" alt="Fri Feb 22 2019 11:19:22 GMT-0800 (Pacific Standard Time)">19:19</a></td><td class="nick-cell">&lt;<span class="nick nick-6" title=rkirsling@irc>rkirsling</span>&gt;</td><td class="msg-cell">...especially given that `new Date(null)` is treated as `new Date(0)`</td></tr>
  <tr class="msg" id="L90"><td class="ts-cell"><a class="ts" href="#L90" alt="Fri Feb 22 2019 11:19:27 GMT-0800 (Pacific Standard Time)">19:19</a></td><td class="nick-cell">&lt;<span class="nick nick-10" title=TabAtkins@irc>TabAtkins</span>&gt;</td><td class="msg-cell">:shakes fist at legacy apis:</td></tr>
  <tr class="msg" id="L91"><td class="ts-cell"><a class="ts" href="#L91" alt="Fri Feb 22 2019 11:19:36 GMT-0800 (Pacific Standard Time)">19:19</a></td><td class="nick-cell">&lt;<span class="nick nick-6" title=ljharb@irc>ljharb</span>&gt;</td><td class="msg-cell">â”¬Temporalâ”¬ãƒŽ( Âº _ ÂºãƒŽ)</td></tr>
  <tr class="msg" id="L92"><td class="ts-cell"><a class="ts" href="#L92" alt="Fri Feb 22 2019 11:19:46 GMT-0800 (Pacific Standard Time)">19:19</a></td><td class="nick-cell">&lt;<span class="nick nick-6" title=rkirsling@irc>rkirsling</span>&gt;</td><td class="msg-cell">ljharb: good answer lol</td></tr>
  <tr class="msg" id="L93"><td class="ts-cell"><a class="ts" href="#L93" alt="Fri Feb 22 2019 11:31:09 GMT-0800 (Pacific Standard Time)">19:31</a></td><td class="nick-cell">&lt;<span class="nick nick-6" title=rkirsling@irc>rkirsling</span>&gt;</td><td class="msg-cell">in other news... mathiasbynens: that &quot;shapes get orphaned on field type change after preventExtensions&quot; bug the React folks discovered is really fascinating</td></tr>
  <tr class="msg" id="L94"><td class="ts-cell"><a class="ts" href="#L94" alt="Fri Feb 22 2019 11:31:35 GMT-0800 (Pacific Standard Time)">19:31</a></td><td class="nick-cell">&lt;<span class="nick nick-6" title=rkirsling@irc>rkirsling</span>&gt;</td><td class="msg-cell">I was trying to poke at exactly why the bug doesn&#039;t apply to JSC</td></tr>
  <tr class="msg" id="L95"><td class="ts-cell"><a class="ts" href="#L95" alt="Fri Feb 22 2019 11:31:45 GMT-0800 (Pacific Standard Time)">19:31</a></td><td class="nick-cell">&lt;<span class="nick nick-6" title=ljharb@irc>ljharb</span>&gt;</td><td class="msg-cell">what bug?</td></tr>
  <tr class="msg" id="L96"><td class="ts-cell"><a class="ts" href="#L96" alt="Fri Feb 22 2019 11:32:20 GMT-0800 (Pacific Standard Time)">19:32</a></td><td class="nick-cell">&lt;<span class="nick nick-6" title=rkirsling@irc>rkirsling</span>&gt;</td><td class="msg-cell">read from here: <a href="https://slidr.io/bmeurer/javascript-engine-fundamentals-the-good-the-bad-and-the-ugly#151">https://slidr.io/bmeurer/javascript-engine-fundamentals-the-good-the-bad-and-the-ugly#151</a></td></tr>
  <tr class="msg" id="L97"><td class="ts-cell"><a class="ts" href="#L97" alt="Fri Feb 22 2019 11:34:04 GMT-0800 (Pacific Standard Time)">19:34</a></td><td class="nick-cell">&lt;<span class="nick nick-6" title=rkirsling@irc>rkirsling</span>&gt;</td><td class="msg-cell">seems like JSC structures don&#039;t have the same &quot;new shape that extends from the existing one&quot; pattern that V8 maps have, maybe that&#039;s the crux</td></tr>
  <tr class="msg" id="L98"><td class="ts-cell"><a class="ts" href="#L98" alt="Fri Feb 22 2019 11:34:17 GMT-0800 (Pacific Standard Time)">19:34</a></td><td class="nick-cell">&lt;<span class="nick nick-6" title=ljharb@irc>ljharb</span>&gt;</td><td class="msg-cell">not sure if i get it without narration</td></tr>
  <tr class="msg" id="L99"><td class="ts-cell"><a class="ts" href="#L99" alt="Fri Feb 22 2019 11:42:57 GMT-0800 (Pacific Standard Time)">19:42</a></td><td class="nick-cell">&lt;<span class="nick nick-6" title=rkirsling@irc>rkirsling</span>&gt;</td><td class="msg-cell">ljharb: so JSObjects have shapes (on-the-fly interfaces kept by the runtime, called &quot;maps&quot; in V8 and &quot;structures&quot; in JSC), and when you add a new property, a new shape gets extended from the old one (in V8 at least, as I understand it), and preventExtensions (or seal or freeze) makes sort of a final extension on top of that. The bug is that if you initialize a field to a small integer, prevent extensions, and then set it to a</td></tr>
  <tr class="msg" id="L100"><td class="ts-cell"><a class="ts" href="#L100" alt="Fri Feb 22 2019 11:42:57 GMT-0800 (Pacific Standard Time)">19:42</a></td><td class="nick-cell">&lt;<span class="nick nick-6" title=rkirsling@irc>rkirsling</span>&gt;</td><td class="msg-cell">double, you&#039;d end up with a new orphaned shape for *every such object*: <a href="https://bugs.chromium.org/p/v8/issues/detail?id=8538">https://bugs.chromium.org/p/v8/issues/detail?id=8538</a></td></tr>
  <tr class="msg" id="L101"><td class="ts-cell"><a class="ts" href="#L101" alt="Fri Feb 22 2019 11:44:23 GMT-0800 (Pacific Standard Time)">19:44</a></td><td class="nick-cell">&lt;<span class="nick nick-6" title=rkirsling@irc>rkirsling</span>&gt;</td><td class="msg-cell">so they realized that to work around you could initialize the field with NaN or Number.MIN_VALUE (so that it&#039;s a double to start with) and then set it to whatever value you wanted (like 0, say) -- <a href="https://github.com/facebook/react/pull/14383">https://github.com/facebook/react/pull/14383</a></td></tr>
  <tr class="msg" id="L102"><td class="ts-cell"><a class="ts" href="#L102" alt="Fri Feb 22 2019 11:44:33 GMT-0800 (Pacific Standard Time)">19:44</a></td><td class="nick-cell">&lt;<span class="nick nick-6" title=rkirsling@irc>rkirsling</span>&gt;</td><td class="msg-cell">really comical and interesting situation</td></tr>
  <tr class="msg" id="L103"><td class="ts-cell"><a class="ts" href="#L103" alt="Fri Feb 22 2019 11:45:42 GMT-0800 (Pacific Standard Time)">19:45</a></td><td class="nick-cell">&lt;<span class="nick nick-6" title=rkirsling@irc>rkirsling</span>&gt;</td><td class="msg-cell">(note that &quot;smi&quot; is evidently the V8ism for &quot;small int&quot;)</td></tr>
  <tr class="msg" id="L104"><td class="ts-cell"><a class="ts" href="#L104" alt="Fri Feb 22 2019 14:58:43 GMT-0800 (Pacific Standard Time)">22:58</a></td><td class="nick-cell">&lt;<span class="nick nick-5" title=devsnek@irc>devsnek</span>&gt;</td><td class="msg-cell">that&#039;s a fun diff</td></tr>
</tbody></table>
</div></div></div></body>

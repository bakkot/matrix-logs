<!DOCTYPE html><html><head>
  <title>Pattern Matching Champions on 2024-01-26</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "Pattern Matching Champions";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">Pattern Matching Champions<br>2024-01-26<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2024-01-25" class="nav-link"><span>prev</span></a>
<span style="float:right">next</span>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">
<div class="rhs-header">
<span id="error" style="color: red; display:none">error</span>

<input type="text" id="query" size="25" placeholder="Search Pattern Matching Champions">
<a id="search-submit" class="button icon-link" title="Search">
  <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"></path></svg>
</a>
</div>

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Thu Jan 25 2024 16:05:44 GMT-0800 (Pacific Standard Time)">00:05</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@tabatkins:matrix.org">TabAtkins</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">Jack Works</span>: I also don't think we actually need the note about <code>document.all</code> there in InvokeCustomMatcher; it's a bizarre legacy piece of the web platform that produces weird behavior <em>everywhere</em>. We're not particularly special here. ^_^</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Thu Jan 25 2024 16:06:49 GMT-0800 (Pacific Standard Time)">00:06</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@tabatkins:matrix.org">TabAtkins</span>&gt;</div></td><td class="msg-cell">(Tho also, in that example the second <code>if()</code> will only match if you write <code>null is f(let html, ...)</code>, since there will be more elements in the iterator than just the html element.)</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Thu Jan 25 2024 18:07:17 GMT-0800 (Pacific Standard Time)">02:07</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jackworks:matrix.org">Jack Works</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> What is the purpose of <code>receiver</code> in a custom matcher?</blockquote></mx-reply>this is required to make dotted custom matchers working correctly.</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Thu Jan 25 2024 18:09:42 GMT-0800 (Pacific Standard Time)">02:09</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jackworks:matrix.org">Jack Works</span>&gt;</div></td><td class="msg-cell">for code <code>when A.B(let c):</code>, we do <code>let receiver = A.B; let matcher = Get(receiver, Symbol.customMatcher)</code>, then <code>Call(matcher, receiver, args)</code>. If we don't have receiver, all custom matchers will be called without <code>this</code>.</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Thu Jan 25 2024 18:10:08 GMT-0800 (Pacific Standard Time)">02:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> this is required to make dotted custom matchers working correctly.</blockquote></mx-reply><p>I'm not sure I agree that's correct. If you equate this to <code>Symbol.iterator</code>, we don't forward a receiver if you do</p>
<pre><code class="language-js">for (const x of foo.bar) {
}
</code></pre>
<p>so why would we do that here? Carrying over the receiver isn't something you'll normally need, and if you need to preserve the receiver, you would make <code>[Symbol.customMatcher]</code> into a getter that returns a bound function.</p>
</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Thu Jan 25 2024 18:10:59 GMT-0800 (Pacific Standard Time)">02:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell">I wouldn't expect <code>when A.B(let c)</code> to preserve the receiver unless maybe <code>A.B</code> is just a plain function.</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Thu Jan 25 2024 18:11:06 GMT-0800 (Pacific Standard Time)">02:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jackworks:matrix.org">Jack Works</span>&gt;</div></td><td class="msg-cell">this is not in the initial spec, it was found as a bug to fix</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Thu Jan 25 2024 18:11:16 GMT-0800 (Pacific Standard Time)">02:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jackworks:matrix.org">Jack Works</span>&gt;</div></td><td class="msg-cell">if you don't like it, we can discuss to remove receiver</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Thu Jan 25 2024 18:11:22 GMT-0800 (Pacific Standard Time)">02:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell">I'm not certain I agree its a bug?</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Thu Jan 25 2024 18:12:17 GMT-0800 (Pacific Standard Time)">02:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell">You normally only pass around a receiver if you're working with proxies/reflect. I don't think I've seen that anywhere else in the spec.</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Thu Jan 25 2024 18:13:07 GMT-0800 (Pacific Standard Time)">02:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell">That's just the nature of JS. I wouldn't want to do something specific here that would be incompatible with some other proposal like bind-this</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Thu Jan 25 2024 18:13:28 GMT-0800 (Pacific Standard Time)">02:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell">A one-off fix here could hurt us more down the line</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Thu Jan 25 2024 18:14:26 GMT-0800 (Pacific Standard Time)">02:14</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell">it may be annoying, but changing it is inconsistent with the rest of the language.</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Thu Jan 25 2024 18:14:39 GMT-0800 (Pacific Standard Time)">02:14</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jackworks:matrix.org">Jack Works</span>&gt;</div></td><td class="msg-cell">Oh, seeing the notes reminds me the use case. If you want to use a boolean tester like <code>something.equal</code> (which means <code>something.equal(matchTopic)</code>), it will be impossible if receiver is not passed, but we can discuss it on the design meeting anyway.</td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Thu Jan 25 2024 18:15:51 GMT-0800 (Pacific Standard Time)">02:15</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jackworks:matrix.org">Jack Works</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> it may be annoying, but changing it is inconsistent with the rest of the language.</blockquote></mx-reply>And I guess this reflects what function calls do. <code>a.b(c)</code> brings <code>a</code> as receiver, so extractors do the same.</td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Thu Jan 25 2024 18:17:23 GMT-0800 (Pacific Standard Time)">02:17</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell">I can <em>maybe</em> see carrying the receiver as <code>this</code> for <code>something.equal</code> when it's just a predicate function and not a custom matcher. The inconsistency is that we chose to have this weird case where we allow either one. Then again, if you equate this to DOM event handlers, there's no <code>this</code> preservation when you pass it a function and not a <code>{ handleEvent(evt) {} }</code> object.</td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Thu Jan 25 2024 18:18:20 GMT-0800 (Pacific Standard Time)">02:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell">Extractors aren't 100% like functions. They appear to be the inverse of function application, but they're actually more like the inverse of construction, and <code>new <a href="http://Foo.Bar">Foo.Bar</a>()</code> doesn't preserve <code>Foo</code> as the receiver.</td></tr>
  <tr class="msg" id="L17"><td class="ts-cell"><a class="ts" href="#L17" alt="Thu Jan 25 2024 18:19:52 GMT-0800 (Pacific Standard Time)">02:19</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell">If, for example, we had a bind-this proposal, i.e. <code>::<a href="http://foo.bar">foo.bar</a></code>, then I would say we would use the bound <code>this</code> via that syntax, i.e. <code>when ::obj.equals</code>.</td></tr>
  <tr class="msg" id="L18"><td class="ts-cell"><a class="ts" href="#L18" alt="Thu Jan 25 2024 18:23:26 GMT-0800 (Pacific Standard Time)">02:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell"><a href="https://github.com/tc39/proposal-call-this">https://github.com/tc39/proposal-call-this</a> hit Stage 1, but hasn't had much movement in awhile. <a href="https://github.com/tc39/proposal-bind-operator">https://github.com/tc39/proposal-bind-operator</a> is sitting at Stage 0.</td></tr>
  <tr class="msg" id="L19"><td class="ts-cell"><a class="ts" href="#L19" alt="Thu Jan 25 2024 18:24:41 GMT-0800 (Pacific Standard Time)">02:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jackworks:matrix.org">Jack Works</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> In the slide you point to, I have to add a number of extra conditions around return values to align with <code>InvokeCustomMatcher</code> just doing a ToBoolean on the result when the hint is boolean, and I'm not a huge fan of return type inconsistency.</blockquote></mx-reply>sorry can you rephrase this part?</td></tr>
  <tr class="msg" id="L20"><td class="ts-cell"><a class="ts" href="#L20" alt="Thu Jan 25 2024 18:25:07 GMT-0800 (Pacific Standard Time)">02:25</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> sorry can you rephrase this part?</blockquote></mx-reply>Ignore that. A few messages later I realized I was in error.</td></tr>
  <tr class="msg" id="L21"><td class="ts-cell"><a class="ts" href="#L21" alt="Thu Jan 25 2024 18:26:16 GMT-0800 (Pacific Standard Time)">02:26</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell">I was trying to reconcile <code>hint === "boolean"</code> with returning a <code>{matched: false }</code> that would coerce to <code>true</code>, but had missed the part where MatchResult was dropped in favor of just returning an iterable object.</td></tr>
  <tr class="msg" id="L22"><td class="ts-cell"><a class="ts" href="#L22" alt="Thu Jan 25 2024 18:32:08 GMT-0800 (Pacific Standard Time)">02:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell">But the <code>receiver</code> thing makes me a little more uncomfortable with the decision to support predicates by default.</td></tr>
  <tr class="msg" id="L23"><td class="ts-cell"><a class="ts" href="#L23" alt="Thu Jan 25 2024 18:33:00 GMT-0800 (Pacific Standard Time)">02:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell"><code>instanceof</code> fits better with how the actual runtime semantics play out.</td></tr>
  <tr class="msg" id="L24"><td class="ts-cell"><a class="ts" href="#L24" alt="Thu Jan 25 2024 18:34:09 GMT-0800 (Pacific Standard Time)">02:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell"><code>obj instanceof x.y</code> doesn't preserve <code>x</code> as a receiver when calling <code>[Symbol.hasInstance]</code>, much like how <code>obj is x.y</code> doesn't preserve <code>x</code> as the receiver when calling <code>[Symbol.customMatcher]</code>.</td></tr>
  <tr class="msg" id="L25"><td class="ts-cell"><a class="ts" href="#L25" alt="Thu Jan 25 2024 18:36:09 GMT-0800 (Pacific Standard Time)">02:36</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jackworks:matrix.org">Jack Works</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> <span class="nick-4">Jack Works</span>: I don't understand how InvokeCustomMatcher works. You check for kind==BOOLEAN in step 8, and return the bool-ized result immediately, but then you check for kind==BOOLEAN <em>again</em> in step 11.</blockquote></mx-reply>yes you're right this is a bug. I'm fixing this right now.</td></tr>
  <tr class="msg" id="L26"><td class="ts-cell"><a class="ts" href="#L26" alt="Thu Jan 25 2024 18:36:38 GMT-0800 (Pacific Standard Time)">02:36</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell">To me that argues for having a <em>different</em> syntax for predicates: either a <code>match</code>-specific disambiguator or just not passing the receiver and adopting some future bind-this syntax to enable that when it becomes available.</td></tr>
  <tr class="msg" id="L27"><td class="ts-cell"><a class="ts" href="#L27" alt="Thu Jan 25 2024 18:37:15 GMT-0800 (Pacific Standard Time)">02:37</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jackworks:matrix.org">Jack Works</span>&gt;</div></td><td class="msg-cell">I'll also add a note that <code>receiver</code> is not a consensus yet.</td></tr>
  <tr class="msg" id="L28"><td class="ts-cell"><a class="ts" href="#L28" alt="Thu Jan 25 2024 18:40:13 GMT-0800 (Pacific Standard Time)">02:40</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell"><p>And in the mean time, user's can always just pull out <code>obj.equal</code> into a temp variable before the pattern, e.g.</p>
<pre><code class="language-js">const equal = x =&gt; obj.equal(x);
match (value) {
  when equal: ...;
}
</code></pre>
</td></tr>
  <tr class="msg" id="L29"><td class="ts-cell"><a class="ts" href="#L29" alt="Thu Jan 25 2024 18:47:17 GMT-0800 (Pacific Standard Time)">02:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jackworks:matrix.org">Jack Works</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> After further reflection, <em>hint</em> here isn't so bad since I don't need to differentiate between a <code>{ matched: false }</code> and a <code>{ matched: true }</code> anymore. I still think it would be nice to be able to optimize for the unary-extractor case in some way.</blockquote></mx-reply>Yes, it's possible (via MatchResult object), but we need to think if we really gonna do that in the specification. For example, we can make Arrays destructing not calling iterator protocol but with <code>length</code> and index access directly, but we do that for mental model simplicity (I guess) (which means everything go by iterator protocol, there is no special cases)</td></tr>
  <tr class="msg" id="L30"><td class="ts-cell"><a class="ts" href="#L30" alt="Thu Jan 25 2024 18:49:40 GMT-0800 (Pacific Standard Time)">02:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> Yes, it's possible (via MatchResult object), but we need to think if we really gonna do that in the specification. For example, we can make Arrays destructing not calling iterator protocol but with <code>length</code> and index access directly, but we do that for mental model simplicity (I guess) (which means everything go by iterator protocol, there is no special cases)</blockquote></mx-reply>I don't think a one-off break from iterator destructuring makes sense. It would just be surprising to some users. The ADT enum result suggestion continues to leverage iterator destructuring, but has well-defined branches for the unary extractor case.</td></tr>
  <tr class="msg" id="L31"><td class="ts-cell"><a class="ts" href="#L31" alt="Thu Jan 25 2024 18:51:23 GMT-0800 (Pacific Standard Time)">02:51</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jackworks:matrix.org">Jack Works</span>&gt;</div></td><td class="msg-cell">if we want to support unary or multiple, we need to bring MatchResult object back (otherwise a test around iterator protocol looks like a footgun). do you want to add a note about this?</td></tr>
  <tr class="msg" id="L32"><td class="ts-cell"><a class="ts" href="#L32" alt="Thu Jan 25 2024 18:53:38 GMT-0800 (Pacific Standard Time)">02:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell">Possibly, or at least we should discuss it at the next meeting. To be clear, it's not that I'm advocating for the entire <code>MatchResult</code> ADT enum thing, but more that I'm wondering if there is an optimization we can make for the unary-extractor case.</td></tr>
  <tr class="msg" id="L33"><td class="ts-cell"><a class="ts" href="#L33" alt="Thu Jan 25 2024 19:01:15 GMT-0800 (Pacific Standard Time)">03:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jackworks:matrix.org">Jack Works</span>&gt;</div></td><td class="msg-cell"><p><a href="https://raw.githack.com/tc39/proposal-pattern-matching/new-spec/index.html#sec-invoke-custom-matcher">https://raw.githack.com/tc39/proposal-pattern-matching/new-spec/index.html#sec-invoke-custom-matcher</a></p>
<p>bug fixed (you may need clear browser cache) cc <span class="nick-10">TabAtkins</span></p>
</td></tr>
  <tr class="msg" id="L34"><td class="ts-cell"><a class="ts" href="#L34" alt="Thu Jan 25 2024 19:01:51 GMT-0800 (Pacific Standard Time)">03:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell"><p>For example, we could have a rule for return values such that:</p>
<ul>
<li>A successful n-ary match has the shape <code>{ kind: "list", value: Iterable }</code></li>
<li>A successful unary match has the shape <code>{ kind: "value", value: any }</code></li>
<li>A successful nullary match has the shape <code>{ kind: "pass" }</code>. Such a result cannot be extracted.</li>
<li>A failed match has the shape <code>{ kind: "fail" }</code>.</li>
<li>If the result is an Object and has a <code>kind</code>, but it is not one of <code>"list"</code>, <code>"value"</code>, <code>"pass"</code>, or <code>"fail"</code>, throw a TypeError.</li>
<li>If the result is an Object but does not have a <code>kind</code>, it is lifted to <code>{ kind: "list", value: result }</code>. As such, any Object that does not have a <code>kind</code> must be iterable.</li>
<li>Otherwise, the result is lifted to <code>ToBoolean(result)</code>:
<ul>
<li>If the new result is <code>true</code>, it is lifted to <code>{ kind: "pass" }</code>.</li>
<li>If the new result is <code>false</code>, it is lifted to <code>{ kind: "fail" }</code>.</li>
</ul>
</li>
</ul>
</td></tr>
  <tr class="msg" id="L35"><td class="ts-cell"><a class="ts" href="#L35" alt="Thu Jan 25 2024 19:04:35 GMT-0800 (Pacific Standard Time)">03:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell"><p>essentially, it's an ADT union of:</p>
<pre><code>type MatchResult = 
  | { kind: "list", value: Iterable }
  | { kind: "value", value: any }
  | { kind: "pass" }
  | { kind: "fail" }
  | Iterable // coerced to { kind: "list", value: Iterable }
  | true // coerced to { kind: "pass" }
  | false // coerced to { kind: "fail" }
  | undefined // coerced to { kind: "fail" }
</code></pre>
</td></tr>
  <tr class="msg" id="L36"><td class="ts-cell"><a class="ts" href="#L36" alt="Thu Jan 25 2024 19:05:47 GMT-0800 (Pacific Standard Time)">03:05</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell">I'm not hung up on how it looks or is implemented, I'm just more interested in the idea of an optimization that reduces overhead for the <code>when Point({ x, y })</code> case.</td></tr>
  <tr class="msg" id="L37"><td class="ts-cell"><a class="ts" href="#L37" alt="Thu Jan 25 2024 19:06:07 GMT-0800 (Pacific Standard Time)">03:06</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jackworks:matrix.org">Jack Works</span>&gt;</div></td><td class="msg-cell">it's possible and performance good, but I think the protocol looks too complicated now</td></tr>
  <tr class="msg" id="L38"><td class="ts-cell"><a class="ts" href="#L38" alt="Thu Jan 25 2024 19:06:10 GMT-0800 (Pacific Standard Time)">03:06</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell">I'd have wanted something similar if we had <code>when Point{ x, y }</code></td></tr>
  <tr class="msg" id="L39"><td class="ts-cell"><a class="ts" href="#L39" alt="Thu Jan 25 2024 19:06:53 GMT-0800 (Pacific Standard Time)">03:06</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jackworks:matrix.org">Jack Works</span>&gt;</div></td><td class="msg-cell"><p>current protocol:</p>
<pre><code>type MatchBooleanResult = any // ToBoolean semantics
type MatchListResult = false | Iterable&lt;any&gt;
</code></pre>
</td></tr>
  <tr class="msg" id="L40"><td class="ts-cell"><a class="ts" href="#L40" alt="Thu Jan 25 2024 19:08:45 GMT-0800 (Pacific Standard Time)">03:08</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell"><p>It doesn't seem complex to me. The actual protocol could be simplified:</p>
<pre><code class="language-ts">type MatchResult = { kind: "list" | "value" | "pass" | "fail", value?: any };
</code></pre>
<p>And the coercion rules just indicate how anything that is not an object with a <code>kind</code> is converted to an object with a <code>kind</code> (or errors)</p>
</td></tr>
  <tr class="msg" id="L41"><td class="ts-cell"><a class="ts" href="#L41" alt="Thu Jan 25 2024 19:17:55 GMT-0800 (Pacific Standard Time)">03:17</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell">But I agree, <code>Iterable | boolean</code> is simpler.</td></tr>
  <tr class="msg" id="L42"><td class="ts-cell"><a class="ts" href="#L42" alt="Thu Jan 25 2024 19:20:16 GMT-0800 (Pacific Standard Time)">03:20</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell">Maybe if we add an <code>Iterator.once(value)</code> static method we could add optimizations for it directly in the spec like we do for native <code>Promise</code>.</td></tr>
  <tr class="msg" id="L43"><td class="ts-cell"><a class="ts" href="#L43" alt="Thu Jan 25 2024 19:24:55 GMT-0800 (Pacific Standard Time)">03:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell">On the other hand, runtimes could chose to internally optimize a match result of <code>[value]</code> to avoid iterator destructuring and just reach for the value, though I imagine there'd need to be a lot of heavy usage of unary extractors before it would be worth writing up an optimization for that case.</td></tr>
  <tr class="msg" id="L44"><td class="ts-cell"><a class="ts" href="#L44" alt="Thu Jan 25 2024 20:16:14 GMT-0800 (Pacific Standard Time)">04:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jackworks:matrix.org">Jack Works</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> On the other hand, runtimes could chose to internally optimize a match result of <code>[value]</code> to avoid iterator destructuring and just reach for the value, though I imagine there'd need to be a lot of heavy usage of unary extractors before it would be worth writing up an optimization for that case.</blockquote></mx-reply>do they optimize for <code>const [state, setState] = useState()</code>?</td></tr>
  <tr class="msg" id="L45"><td class="ts-cell"><a class="ts" href="#L45" alt="Thu Jan 25 2024 20:16:37 GMT-0800 (Pacific Standard Time)">04:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell">I'm not sure, offhand. </td></tr>

</tbody></table></div></div></div>
</body></html>
<!DOCTYPE html><html><head>
  <title>Pattern Matching Champions on 2022-07-26</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "Pattern Matching Champions";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">Pattern Matching Champions<br>2022-07-26<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2022-07-23" class="nav-link"><span>prev</span></a>
<a href="2022-07-27" class="nav-link"><span style="float:right">next</span></a>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">
<div class="rhs-header">
<span id="error" style="color: red; display:none">error</span>

<input type="text" id="query" size="25" placeholder="Search Pattern Matching Champions">
<a id="search-submit" class="button icon-link" title="Search">
  <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"></path></svg>
</a>
</div>

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Tue Jul 26 2022 14:39:16 GMT-0700 (Pacific Daylight Time)">21:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@tabatkins:matrix.org">TabAtkins</span>&gt;</div></td><td class="msg-cell">I'm also <em>very</em> surprised to see a completely different approach dropped immediately prior to the meeting.</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Tue Jul 26 2022 14:40:29 GMT-0700 (Pacific Daylight Time)">21:40</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@tabatkins:matrix.org">TabAtkins</span>&gt;</div></td><td class="msg-cell">I'm also <em>consistently</em> bewildered at all these comments about this being strange and unfamiliar, when the majority of the proposal's syntax is pretty much exactly in line with how every pattern matching syntax I'm aware of works. (Haskell and Python, at minimum.)</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Tue Jul 26 2022 14:42:10 GMT-0700 (Pacific Daylight Time)">21:42</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@tabatkins:matrix.org">TabAtkins</span>&gt;</div></td><td class="msg-cell">It's fairly similar to Rust's, as well (tho Rust focuses more on Enum unapplication rather than having a default "list" and "object" to rely on, but it's otherwise very similar)</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Tue Jul 26 2022 14:48:13 GMT-0700 (Pacific Daylight Time)">21:48</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@tabatkins:matrix.org">TabAtkins</span>&gt;</div></td><td class="msg-cell">I've given Yulia's proposal two readthrus now, and I have some feedback.</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Tue Jul 26 2022 15:05:40 GMT-0700 (Pacific Daylight Time)">22:05</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@tabatkins:matrix.org">TabAtkins</span>&gt;</div></td><td class="msg-cell">Okay, having reread Yulia's proposal a few times, some feedback:</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Tue Jul 26 2022 15:06:45 GMT-0700 (Pacific Daylight Time)">22:06</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@tabatkins:matrix.org">TabAtkins</span>&gt;</div></td><td class="msg-cell"><ol>
<li>The let-when form is pretty cool! A bit problematic in that if the check fails it returns an empty object, which can't be destructured past the first layer unless you go to town with default in the destucturing blob, tho.</li>
</ol>
</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Tue Jul 26 2022 15:08:28 GMT-0700 (Pacific Daylight Time)">22:08</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@tabatkins:matrix.org">TabAtkins</span>&gt;</div></td><td class="msg-cell">If this is something we want (and it sounds nice, especially in the additional forms like integrating into for-of, etc), we could also do this backwards, starting from the current proposal and allowing a let-when to use the proposal's pattern syntax; it just wouldn't establish any bindings (unless you did <code>let when</code>, as in your 4th stage).</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Tue Jul 26 2022 15:12:39 GMT-0700 (Pacific Daylight Time)">22:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@tabatkins:matrix.org">TabAtkins</span>&gt;</div></td><td class="msg-cell"><ol start="2">
<li>Because bare idents in the pattern syntax are taken as functions and/or custom matchable objects, there's some <em>very</em> unfortunate shenanigans needed to match against variables. We argued over this <em>exact</em> topic for quite a while, and the result was our custom matcher syntax <code>${}</code>. I think this is very important, honestly - requiring weird prototype hacks to just match a value against something in a variable seems very bad.</li>
</ol>
</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Tue Jul 26 2022 15:16:43 GMT-0700 (Pacific Daylight Time)">22:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@tabatkins:matrix.org">TabAtkins</span>&gt;</div></td><td class="msg-cell">Note that your proposal's treatment of bare idents means that the <code>let {...} when {...};</code> and <code>let when {...}</code> forms are actually <em>completely different matcher syntaxes</em>. The former treats bare idents as functions/custom matchers, and <em>never</em> as bindings; the latter treats bare idents as bindings, and <em>never</em> as functions/custom matchers. Unless I'm completely misunderstanding this?</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Tue Jul 26 2022 15:20:14 GMT-0700 (Pacific Daylight Time)">22:20</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@tabatkins:matrix.org">TabAtkins</span>&gt;</div></td><td class="msg-cell">Or, wait, maybe I <em>am</em> misunderstanding things. Is it the case that a <code>when &lt;ident&gt;</code> calls the function/custom matcher, but a <code>when &lt;object literal&gt;</code>/etc does a destructure (without actually creating any bindings) and all the names are useless except to mark other bits, like array length in <code>when [foo, bar]</code>?</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Tue Jul 26 2022 15:21:10 GMT-0700 (Pacific Daylight Time)">22:21</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@tabatkins:matrix.org">TabAtkins</span>&gt;</div></td><td class="msg-cell">Looking over the examples it does look like that's the case, which means you can't ever run a matcher on a subvalue, only ever the top-most value. This is a huge problem - <em>every</em> pattern-matching syntax I've ever seen that allows custom matching logic <em>at all</em> allows the logic to be run on values at any level of the pattern.</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Tue Jul 26 2022 15:22:48 GMT-0700 (Pacific Daylight Time)">22:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@tabatkins:matrix.org">TabAtkins</span>&gt;</div></td><td class="msg-cell">Well, hm, still confused, because several other examples have matching beyond destructuring (comparison against literal values, or against an or-pattern of literals) nested deeper within a pattern.</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Tue Jul 26 2022 15:24:33 GMT-0700 (Pacific Daylight Time)">22:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@tabatkins:matrix.org">TabAtkins</span>&gt;</div></td><td class="msg-cell">So I simply can't tell what nested patterns are allowed to do or what syntax they're meant to use.</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Tue Jul 26 2022 15:28:11 GMT-0700 (Pacific Daylight Time)">22:28</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@tabatkins:matrix.org">TabAtkins</span>&gt;</div></td><td class="msg-cell">My conclusion is that your proposal runs directly into problems we ran into early in the design, and talked over with you and others in design meetings, and then fixed in our proposal in, afaict, a consistent and predictable way. It brings up a useful bit of new functionality - the let-when statement and associated constructs - which could be appended to the current proposal with minimal tweaking, but sets it up instead as a competitor. It does not meaningfully reduce the "size" of the proposal, as the pattern syntax is just as large as in the current proposal.</td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Tue Jul 26 2022 15:29:29 GMT-0700 (Pacific Daylight Time)">22:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@tabatkins:matrix.org">TabAtkins</span>&gt;</div></td><td class="msg-cell">I do like your emphasis on making the pattern-matching part an extractable bit of syntax that we can apply elsewhere - that's very cool. I think that can be done within the current proposal, and suggest pursuing that.</td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Tue Jul 26 2022 15:30:29 GMT-0700 (Pacific Daylight Time)">22:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@tabatkins:matrix.org">TabAtkins</span>&gt;</div></td><td class="msg-cell">However, the specifics of your proposal are flawed in ways we already encountered and fixed; once they're corrected, your proposal will end up more or less identical to the current proposal, + the new let-when/etc constructs.</td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Tue Jul 26 2022 15:31:04 GMT-0700 (Pacific Daylight Time)">22:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@tabatkins:matrix.org">TabAtkins</span>&gt;</div></td><td class="msg-cell"><span class="nick-10">yulia</span>: ^^^</td></tr>
  <tr class="msg" id="L17"><td class="ts-cell"><a class="ts" href="#L17" alt="Tue Jul 26 2022 15:33:21 GMT-0700 (Pacific Daylight Time)">22:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@tabatkins:matrix.org">TabAtkins</span>&gt;</div></td><td class="msg-cell">(Note that we've recently added the ability to use plain functions as custom matchers that pass-thru the value unchanged, so <code>when(${isSomething}): ...;</code> works exactly as expected if <code>isSomething</code> is a boolean function; no need for the author to do the custom-matcher hoop-jumping we'd shown off in previous meetings. I think the README still needs updating in this regard, which is on me.)</td></tr>
  <tr class="msg" id="L18"><td class="ts-cell"><a class="ts" href="#L18" alt="Tue Jul 26 2022 15:57:52 GMT-0700 (Pacific Daylight Time)">22:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@rkirsling:matrix.org">rkirsling</span>&gt;</div></td><td class="msg-cell">I think even if we changed nothing about the feature though, framing things in layers helps for digestibility such that champions, committee, and community alike can clearly see the value in each piece of the proposal</td></tr>
  <tr class="msg" id="L19"><td class="ts-cell"><a class="ts" href="#L19" alt="Tue Jul 26 2022 15:59:23 GMT-0700 (Pacific Daylight Time)">22:59</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@rkirsling:matrix.org">rkirsling</span>&gt;</div></td><td class="msg-cell">like, the Friday before plenary, I ended up feeling like "actually I don't really find much objectionable here at all" but that was a surprise to me because it took careful re-examination of all the parts of the proposal while repeatedly asking myself "can we jettison this?"</td></tr>
  <tr class="msg" id="L20"><td class="ts-cell"><a class="ts" href="#L20" alt="Tue Jul 26 2022 16:57:11 GMT-0700 (Pacific Daylight Time)">23:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@tabatkins:matrix.org">TabAtkins</span>&gt;</div></td><td class="msg-cell">Oh sure, that's always true. And if we do want to accommodate let-when in the future, it might make sense to rearrange somewhat to talk just about the pattern syntax before we talked about the uses of it (match, other future things).</td></tr>
  <tr class="msg" id="L21"><td class="ts-cell"><a class="ts" href="#L21" alt="Tue Jul 26 2022 16:58:02 GMT-0700 (Pacific Daylight Time)">23:58</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@tabatkins:matrix.org">TabAtkins</span>&gt;</div></td><td class="msg-cell">It does just keep boggling me that our proposal is more or less equivalent to the first three other pattern-matching features I could think of first but something about how we present it, I guess, keeps making people think it's uber-complicated.</td></tr>

</tbody></table></div></div></div>
</body></html>
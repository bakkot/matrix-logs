2022-06-15
[02:43:18.0023] <Jack Works>
working on RS, having a problem

[02:43:55.0495] <Jack Works>
for array/object patterns, should we check the length/key first, or check them one by one?

[02:44:02.0444] <Jack Works>
```js
match ([ 0, { get a() { } }, 1]) {
    when ([a, b, ""]): void 0
    // 3rd item check failed
    
    when ([, { a }]): void 0
    // will a triggered?
    // There're already 3 items cached for the iterator.
}
```

[02:44:29.0800] <Jack Works>
https://github.com/tc39/proposal-pattern-matching/pull/258

[05:20:48.0528] <Jack Works>
For object patterns, it is currently one-by-one because it is easier to specify

```js
match ({ get a() {} }) {
    when ({ a, b }): void 0
    // getter a _will_ be triggered, even "b" is missing.
    // because I access them by order
}
```

[06:03:54.0912] <ljharb>
It’s iterable not Array, so you can’t check the length first

[06:19:42.0873] <Jack Works>
> <@ljharb:matrix.org> It’s iterable not Array, so you can’t check the length first

You can. If the pattern has 4 items in it, you can try to take 4 items from the iterator and one more call to check if it is done. 

[06:22:09.0503] <Jack Works>
The problem is in which order we should use.

A: Take the 1st element, check if the 1st element matches (if not, go to the next match clause), then do this to the 2nd element, ....

B: Take the 1st element, take the 2nd element, ...
If it has less/more elements than expected, go to the next match clause.
If length matches, check if the 1st element matches, check if the 2nd element matches...... 

[06:22:22.0609] <Jack Works>
There are two approaches. 

[06:24:39.0163] <Jack Works>
Same question for objects. Check all required keys first, or one-by-one.

[07:50:20.0306] <ljharb>
ah. You check each element at a time

[07:50:42.0519] <ljharb>
So that we consume as little of an iterator as possible, and also need to cache as little as possible

[07:53:29.0778] <ljharb>
For objects, I’d say the same - just check each property in pattern order

[08:17:23.0523] <Jack Works>
Now all runtime semantics except ArrayMatchPattern is specified

[08:17:56.0095] <Jack Works>
Iterator caching stuff is too complicated and I need some days to clean up my mind


<!DOCTYPE html><html><head>
  <title>Pattern Matching Champions on 2023-09-13</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "Pattern Matching Champions";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">Pattern Matching Champions<br>2023-09-13<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2023-09-12" class="nav-link"><span>prev</span></a>
<a href="2023-09-14" class="nav-link"><span style="float:right">next</span></a>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">
<div class="rhs-header">
<span id="error" style="color: red; display:none">error</span>

<input type="text" id="query" size="25" placeholder="Search Pattern Matching Champions">
<a id="search-submit" class="button icon-link" title="Search">
  <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"></path></svg>
</a>
</div>

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Tue Sep 12 2023 18:11:35 GMT-0700 (Pacific Daylight Time)">01:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jackworks:matrix.org">Jack Works</span>&gt;</div></td><td class="msg-cell">Eh</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Tue Sep 12 2023 18:11:52 GMT-0700 (Pacific Daylight Time)">01:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jackworks:matrix.org">Jack Works</span>&gt;</div></td><td class="msg-cell">I forgot the separator</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Tue Sep 12 2023 18:12:05 GMT-0700 (Pacific Daylight Time)">01:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jackworks:matrix.org">Jack Works</span>&gt;</div></td><td class="msg-cell">how do we do this? using <code>,</code> or <code>;</code>?</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Tue Sep 12 2023 18:45:54 GMT-0700 (Pacific Daylight Time)">01:45</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell">I'd be tempted to suggest <code>,</code>, since <code>;</code> might run afoul of ASI so we'd have to add restrictions to ASI interpretation such as the one for <code>for</code> in <a href="https://tc39.es/ecma262/#sec-rules-of-automatic-semicolon-insertion">https://tc39.es/ecma262/#sec-rules-of-automatic-semicolon-insertion</a></td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Tue Sep 12 2023 18:47:36 GMT-0700 (Pacific Daylight Time)">01:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell">But I'd rather get feedback from everyone else on that one. If its <code>,</code>, then you would need to use <em>AssignmentExpression</em> rather than <em>Expression</em>  in each leg since <em>Expression</em> also consumes <code>,</code>.</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Tue Sep 12 2023 23:13:08 GMT-0700 (Pacific Daylight Time)">06:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@ljharb:matrix.org">ljharb</span>&gt;</div></td><td class="msg-cell">i'm confused, which separator</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Tue Sep 12 2023 23:13:17 GMT-0700 (Pacific Daylight Time)">06:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@ljharb:matrix.org">ljharb</span>&gt;</div></td><td class="msg-cell">after a RHS expression? 1000% semicolon</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Tue Sep 12 2023 23:13:51 GMT-0700 (Pacific Daylight Time)">06:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@ljharb:matrix.org">ljharb</span>&gt;</div></td><td class="msg-cell">we don't need to cater to ASI people at all as long as we leave the "style" possible, they can stick semicolons in the front of lines where it conflicts</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Tue Sep 12 2023 23:14:18 GMT-0700 (Pacific Daylight Time)">06:14</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@ljharb:matrix.org">ljharb</span>&gt;</div></td><td class="msg-cell">the committee already has consensus on that (it's ok to add new ASI restrictions) even tho we couldn't quite get consensus on telling people to just use semicolons</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Wed Sep 13 2023 03:40:37 GMT-0700 (Pacific Daylight Time)">10:40</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@tabatkins:matrix.org">TabAtkins</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> <p>in other words:</p>
<pre><code>if (x is [let y and if (y &gt; 1)]) {
  y; // ok, 'y' is initialized
} else {
  y; // expected to error as 'y' in TDZ/uninitialized, but won't because 'y' was initialized immediately.
}
</code></pre>
<p>Though, we could possibly do both by having both outer bindings and per-pattern bindings, such that the outer bindings are initialized with the per-pattern bindings from the success path of the match, not unlike per-iteration bindings in <code>for</code> statements.</p>
</blockquote></mx-reply>Why would you expect y to be TDZ there? The binding was established, even if the pattern eventually failed. <code>if( x is [let y] &amp;&amp; y &gt; 1)</code> wouldn't TDZ, for instance.</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Wed Sep 13 2023 03:49:17 GMT-0700 (Pacific Daylight Time)">10:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> Why would you expect y to be TDZ there? The binding was established, even if the pattern eventually failed. <code>if( x is [let y] &amp;&amp; y &gt; 1)</code> wouldn't TDZ, for instance.</blockquote></mx-reply>When we discussed this before, the <code>y</code> would be uninitialized if the pattern failed to match.</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Wed Sep 13 2023 08:33:28 GMT-0700 (Pacific Daylight Time)">15:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jackworks:matrix.org">Jack Works</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> But I'd rather get feedback from everyone else on that one. If its <code>,</code>, then you would need to use <em>AssignmentExpression</em> rather than <em>Expression</em>  in each leg since <em>Expression</em> also consumes <code>,</code>.</blockquote></mx-reply>Ah, I'm not familiar with that. There are so many expressions and I can't tell difference from their name. <code>Assignment...</code> <code>Member...</code></td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Wed Sep 13 2023 09:14:20 GMT-0700 (Pacific Daylight Time)">16:14</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell"><code>Expression</code> is just <code>AssignmentExpression</code> or comma</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Wed Sep 13 2023 09:16:19 GMT-0700 (Pacific Daylight Time)">16:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> When we discussed this before, the <code>y</code> would be uninitialized if the pattern failed to match.</blockquote></mx-reply>My intent was that we could leverage TDZ to ensure you can only use successfully matched variables rather than having to introduce some kind of control flow analysis mechanism into ECMAScript, and instead let linters and type systems give you early warnings like they can do currently for use-before-init class errors.</td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Wed Sep 13 2023 09:18:45 GMT-0700 (Pacific Daylight Time)">16:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell">If there is pushback I'm happy to relax the TDZ restriction, since TypeScript will still do CFA anyways, but I don't want JS devs to feel like they have to rely solely on a type system or other external static analysis tool to catch this kind of error.</td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Wed Sep 13 2023 09:26:30 GMT-0700 (Pacific Daylight Time)">16:26</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> Why would you expect y to be TDZ there? The binding was established, even if the pattern eventually failed. <code>if( x is [let y] &amp;&amp; y &gt; 1)</code> wouldn't TDZ, for instance.</blockquote></mx-reply><p>My point to that comment was that if we want to preserve the TDZ semantics we've discussed <em>outside</em> of the pattern, then we would need an additional pattern-local binding <em>inside</em> of the pattern for <code>if</code>-patterns to work correctly. I don't think that would be terribly complex though:</p>
<ul>
<li>All <code>let</code>/<code>const</code> patterns in an <code>is</code> would be added to the <code>BoundNames</code> of the outer block scope, and thus are declared in that block scope's Environment Record.</li>
<li>As you evaluate each <em>MatchPattern</em> you push a new Environment Record with the names declared in that pattern, and initialize them as the pattern evaluates, and hold onto the environment records for the successful branches of that pattern.</li>
<li>When matching completes you initialize the bindings in the outer block scope that match the initialized bindings from the successful branches of the pattern.</li>
</ul>
</td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Wed Sep 13 2023 09:27:22 GMT-0700 (Pacific Daylight Time)">16:27</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell">Basically, take what <code>for</code> does for per-iteration bindings and expand on it a bit.</td></tr>

</tbody></table></div></div></div>
</body></html>
<!DOCTYPE html><html><head>
  <title>Pattern Matching Champions on 2022-08-01</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "Pattern Matching Champions";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">Pattern Matching Champions<br>2022-08-01<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2022-07-29" class="nav-link"><span>prev</span></a>
<span style="float:right">next</span>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">
<div class="rhs-header">
<span id="error" style="color: red; display:none">error</span>

<input type="text" id="query" size="25" placeholder="Search Pattern Matching Champions">
<a id="search-submit" class="button icon-link" title="Search">
  <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"></path></svg>
</a>
</div>

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Mon Aug 01 2022 06:50:58 GMT-0700 (Pacific Daylight Time)">13:50</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@yulia:mozilla.org">yulia</span>&gt;</div></td><td class="msg-cell">why is this potentially a bad path? I am not sure I understand your example with <code>f.toString</code> ? Is it an issue if we do something custom here? It can include multiple definitions. That is the case for other languages such as idris iirc</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Mon Aug 01 2022 06:51:49 GMT-0700 (Pacific Daylight Time)">13:51</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@yulia:mozilla.org">yulia</span>&gt;</div></td><td class="msg-cell">I am also not sure that this will be a problem with decorators on parameters. This is the same as having internal functions</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Mon Aug 01 2022 08:46:14 GMT-0700 (Pacific Daylight Time)">15:46</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell"><p>I am concerned we could be jumping the gun introducing overloads purely for pattern matching purposes, with Type Annotations on the table. True static typing may not be on the table now, but designing overloads purely for pattern matching could put us in a poor position in the future. There are a number of questions we could ask now whose answers could change dramatically in 3-5 years:</p>
<ul>
<li>Would each overload be an independent function reference, or are they somehow nested inside the function?</li>
<li>How would this apply to <code>F.p.bind</code>? Do we match during <code>.bind</code> or when the final function is invoked?</li>
<li>How would this apply to <code>Proxy</code>?</li>
<li>How would this affect <code>new F()</code> and the resulting <code><a href="http://new.target">new.target</a></code>, prototypes, etc.</li>
<li>If a function decorator is applied to only one overload, what function does it get? If they're all the same function, how would we differentiate overloads in the decorator?</li>
<li>If a parameter decorator is applied to only one overload, what function does it get? If they're all the same function, how would we differentiate overloads in the decorator?</li>
<li>How would this be impacted by a potential future including type annotations, metadata, reflection, binary AST, etc?</li>
</ul>
<p>Given that its easy enough to write <code>(x) =&gt; match(x) { ... }</code> or <code>function f(x) { return match(x) { ... } }</code>, I don't think introducing overloads this early in the game would be advisable. At the very least, it shouldn't be tied to a v1 of pattern matching as I believe that would result in the feature sitting in limbo for a decade while we try to sort out cross-cutting concerns.</p>
</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Mon Aug 01 2022 08:49:10 GMT-0700 (Pacific Daylight Time)">15:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> I am also not sure that this will be a problem with decorators on parameters. This is the same as having internal functions</blockquote></mx-reply>In my list above I reference function and parameter decorators as needing to have <em>some</em> knowledge of overloads, which is a further complication especially in regards to proposals such as Decorator Metadata.</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Mon Aug 01 2022 08:50:51 GMT-0700 (Pacific Daylight Time)">15:50</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell">Method decorators are already stage 3 and have no concept of overloads. Introducing overloads that point to the same function reference would cause issues if decorator libraries aren't written to handle that case, and most won't be. </td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Mon Aug 01 2022 08:56:31 GMT-0700 (Pacific Daylight Time)">15:56</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell"><p>Consider a class built to handle server-side HTTP routes:</p>
<pre><code class="language-js">class HttpRoutes {
  @route("GET", "/products")
  getProducts(req) { ... }

  @route("GET", "/products/{id}")
  getProduct(req) { ... }
}
</code></pre>
<p>The route might attach metadata to the method that would be used to pick the method to execute when a request is handled. Then we introduce overloads for pattern matching and someone else decides to write:</p>
<pre><code class="language-js">class HttpRoutes {
  @route("GET", "/products")
  get(req when { url: "/products" }) { ...}

  @route("GET", "/products/{id}")
  get(req when { url: /\/products\/\d+/ }) { ... }
}
</code></pre>
<p>Without updating the decorator library, the metadata for <code>get</code> might be overwritten, or might be potentially unreachable if each method is nested internally.</p>
</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Mon Aug 01 2022 08:56:52 GMT-0700 (Pacific Daylight Time)">15:56</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell">So you then run into a versioning and/or documentation problem.</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Mon Aug 01 2022 09:02:05 GMT-0700 (Pacific Daylight Time)">16:02</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell">Also, let me know if there's a better way to handle this discussion given the issues with your wrist. I had a comminuted fracture in my left wrist about 15 years ago, and daily pain ever since (worse on some days than others), so I can at least partially relate to how difficult typing can be at times.</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Mon Aug 01 2022 09:09:47 GMT-0700 (Pacific Daylight Time)">16:09</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@yulia:mozilla.org">yulia</span>&gt;</div></td><td class="msg-cell">ahaha yeah it would be better to have a call</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Mon Aug 01 2022 09:09:56 GMT-0700 (Pacific Daylight Time)">16:09</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@yulia:mozilla.org">yulia</span>&gt;</div></td><td class="msg-cell">but, i already typed this up so</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Mon Aug 01 2022 09:13:23 GMT-0700 (Pacific Daylight Time)">16:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@yulia:mozilla.org">yulia</span>&gt;</div></td><td class="msg-cell"><blockquote>
<p>with Type Annotations on the table</p>
</blockquote>
<p>(you also mentioned bin ast, and other things here so ill try to answer everything... but i lost it) I believe this is an <em>very interesting</em> companion to type annotations. In fact, I was thinking that it may be interesting to have matchers written via the interface keyword. This may allow us to share both runtime behavior (that, due to being able to throw, can have interesting implications for both safety and optimization) and static information. I don't see this as in opposition and have been chatting with the typescript folks. They don't hate it so far. These may work very well together in fact.</p>
<p>bin-ast doesn't have much support at the moment. I am not sure why this would be in opposition to metadata or reflection. Maybe you have an example i can consider.</p>
<blockquote>
<p>True static typing may not be on the table now, but designing overloads purely for pattern matching could put us in a poor position in the future</p>
</blockquote>
<p>I rather strongly disagree. In fact i think the opposite. This has been described to me as one of the weaknesses of typescript -- that they have no impact at run time. What guards and typed objects were proposed to be were runtime checks that can also be used as static information.</p>
<blockquote>
<p>Would each overload be an independent function reference, or are they somehow nested inside the function?</p>
</blockquote>
<p>This is open for discussion. A reasonable implementation would to have a match inside of an intermediate function. Effectively pointing to a table that then routes you to the correct functionality.</p>
<blockquote>
<p>How would this apply to F.p.bind? Do we match during .bind or when the final function is invoked?</p>
</blockquote>
<p>yes, if we take the table approach, then</p>
<pre><code class="language-js">function foo(x when a) { /*...*/} 

function foo( x when b) { /*...*/}

function foo( x) { /*...*/ }


// under the hood, so to speak

function foo (x) {
  match(x) {
    when a: _internal_shapedFoo_1(x)
    when b: _internal_shapedFoo_2(x)
    default : _internal_Foo_default(x)
  }
}
</code></pre>
<p>(but really, the interesting thing is when you <em>dont</em> have the default case.)</p>
<p>From the engine perspective, if we see that everything is shaped, we might be able to remove the intermediary function. This can possibly result in more assumptions being made (similar to what was being attempted by the guard proposal). This shares a lot of features with guards.</p>
<blockquote>
<p>How would this apply to Proxy?</p>
</blockquote>
<p>what precisely do you mean? can you give an example? Proxies is kind of a big region for me so I am not immediately grasping the issue you are pointing out.</p>
<blockquote>
<p>How would this affect new F() and the resulting <a href="http://new.target">new.target</a>, prototypes, etc.</p>
</blockquote>
<p>One way to answer this might be: What happens when you have a match statement in the constructor of F? another way to answer it (though I am still absorbing it) is your comment here: <a href="https://github.com/tc39/proposal-pattern-matching/issues/281#issuecomment-1199706022">https://github.com/tc39/proposal-pattern-matching/issues/281#issuecomment-1199706022</a> for the new Book example.</p>
<blockquote>
<p>If a function decorator is applied to only one overload, what function does it get? If they're all the same function, how would we differentiate overloads in the decorator?</p>
</blockquote>
<p>An decorator would apply to its direct shaped function. So, for example:</p>
<pre><code class="language-js">class HttpRoutes {

  @route("GET", "/products")
  get(req when { url: "/products" }) { ...}

  @route("GET", "/products/{id}")
  get(req when { url: /\/products\/\d+/ }) { ... }

  // internal engine functions
  @route("GET", "/products")
  _internal_shapedget_1(req when { url: "/products" }) { ...}

    @route("GET", "/products/{id}")
  _internal_shapedget_2(req when { url: /\/products\/\d+/ }) { ... }

  implementation_get(req) { 
    match(req) {
       when { url: "/products" }: // ...
       when { url: /\/products\/\d+/ }: // ... 
       default : // throw no such function
    }
  }
}

</code></pre>
<p>and, you can likely imagine what would happen if the default behavior had a decorator</p>
<blockquote>
<p>If a parameter decorator is applied to only one overload, what function does it get? If they're all the same function, how would we differentiate overloads in the decorator?</p>
</blockquote>
<p>Hopefully the above answers this question?</p>
</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Mon Aug 01 2022 09:17:56 GMT-0700 (Pacific Daylight Time)">16:17</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@yulia:mozilla.org">yulia</span>&gt;</div></td><td class="msg-cell">i joyfully have an inflamed tendon sheath and a popped ganglion cyst so its not bone, its tissue. Will take a long time to heal but i also can't stop myself from talking because i am so darn chatty. I had no idea i was this chatty until i couldn't type for 5 days at all</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Mon Aug 01 2022 09:20:10 GMT-0700 (Pacific Daylight Time)">16:20</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@yulia:mozilla.org">yulia</span>&gt;</div></td><td class="msg-cell">calling is... preferred, but then we lose the history here and people can't engage async</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Mon Aug 01 2022 09:23:46 GMT-0700 (Pacific Daylight Time)">16:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@yulia:mozilla.org">yulia</span>&gt;</div></td><td class="msg-cell">(this all said -- it doesn't have to happen before or as a part of pattern matching. I think it could be, and it could be really nice. I also think leaving the door open is important)</td></tr>

</tbody></table></div></div></div>
</body></html>
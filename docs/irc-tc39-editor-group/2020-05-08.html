<!doctype html>
<head>
  <title>#tc39-editor-group on 2020-05-08</title>
  <link rel="stylesheet" href="../style.css">
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">#tc39-editor-group<br>2020-05-08<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2020-05-06" class="nav-link"><span>prev</span></a>
<a href="2020-05-09" class="nav-link"><span style="float:right">next</span></a>
</div>
    
<div class="room-list-wrapper">Active:<br>
<ul class="room-list">
<li><a href="../TC39_Delegates/">TC39 Delegates</a></li>
<li><a href="../TC39_Editors/">TC39 Editors</a></li>
<li><a href="../TC39_General/">TC39 General</a></li>
<li><a href="../WHATWG/">WHATWG</a></li>
</ul>
</div>
<br>
<div class="room-list-wrapper">Historical:<br>
<ul class="room-list">
<li><a href="../irc-tc39/">#tc39</a></li>
<li><a href="../irc-tc39-delegates/">#tc39-delegates</a></li>
<li><a href="../irc-tc39-editor-group/" class="current-room">#tc39-editor-group</a></li>
<li><a href="../irc-whatwg/">#whatwg</a></li>
</ul>
</div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs"><div class="log">
<table><tbody id="log-tbody">
  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Thu May 07 2020 18:12:37 GMT-0700 (Pacific Daylight Time)">01:12</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=shu@irc>shu</span>&gt;</td><td class="msg-cell">philosophical question</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Thu May 07 2020 18:13:01 GMT-0700 (Pacific Daylight Time)">01:13</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=shu@irc>shu</span>&gt;</td><td class="msg-cell">if you have a set of steps that become entirely unobservable based on some input</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Thu May 07 2020 18:13:30 GMT-0700 (Pacific Daylight Time)">01:13</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=shu@irc>shu</span>&gt;</td><td class="msg-cell">would you consider that asserts inside those steps to have to hold?</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Thu May 07 2020 18:14:20 GMT-0700 (Pacific Daylight Time)">01:14</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=shu@irc>shu</span>&gt;</td><td class="msg-cell">that is, if you have some steps that can be removed by an optimizer because their result aren&#039;t observable, does the spec still require you to satisfy their preconditions as captured by assertions?</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Thu May 07 2020 18:14:26 GMT-0700 (Pacific Daylight Time)">01:14</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=shu@irc>shu</span>&gt;</td><td class="msg-cell">with my compiler engineer hat on, the answer is no</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Thu May 07 2020 18:14:46 GMT-0700 (Pacific Daylight Time)">01:14</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=shu@irc>shu</span>&gt;</td><td class="msg-cell">but i can anticipate disagreement here</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Thu May 07 2020 18:16:28 GMT-0700 (Pacific Daylight Time)">01:16</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=Bakkot@irc>Bakkot</span>&gt;</td><td class="msg-cell">assertions are just comments, so I guess no, but I don&#039;t really understand the question</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Thu May 07 2020 18:16:38 GMT-0700 (Pacific Daylight Time)">01:16</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=shu@irc>shu</span>&gt;</td><td class="msg-cell">i&#039;ll be concrete</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Thu May 07 2020 18:16:55 GMT-0700 (Pacific Daylight Time)">01:16</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=shu@irc>shu</span>&gt;</td><td class="msg-cell">consider <a href="https://tc39.es/ecma262/#sec-newpromiseresolvethenablejob">https://tc39.es/ecma262/#sec-newpromiseresolvethenablejob</a></td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Thu May 07 2020 18:17:11 GMT-0700 (Pacific Daylight Time)">01:17</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=Bakkot@irc>Bakkot</span>&gt;</td><td class="msg-cell">is the observable behavior the same as if the engine had just executed the steps naively? yes? then it is all ok. no? then it is not ok.</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Thu May 07 2020 18:17:44 GMT-0700 (Pacific Daylight Time)">01:17</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=shu@irc>shu</span>&gt;</td><td class="msg-cell">consider the case when _then_ is a revoked proxy</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Thu May 07 2020 18:18:04 GMT-0700 (Pacific Daylight Time)">01:18</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=shu@irc>shu</span>&gt;</td><td class="msg-cell">(keep in mind: a revoked proxy throws in step 2 here: <a href="https://tc39.es/ecma262/#sec-proxy-object-internal-methods-and-internal-slots-call-thisargument-argumentslist">https://tc39.es/ecma262/#sec-proxy-object-internal-methods-and-internal-slots-call-thisargument-argumentslist</a>)</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Thu May 07 2020 18:18:21 GMT-0700 (Pacific Daylight Time)">01:18</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=shu@irc>shu</span>&gt;</td><td class="msg-cell">notably, step 2 happens before the argumentsList is ever observed</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Thu May 07 2020 18:18:32 GMT-0700 (Pacific Daylight Time)">01:18</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=shu@irc>shu</span>&gt;</td><td class="msg-cell">going back to NewPromiseResolveThenableJob,</td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Thu May 07 2020 18:19:15 GMT-0700 (Pacific Daylight Time)">01:19</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=shu@irc>shu</span>&gt;</td><td class="msg-cell">the concrete question is: suppose, at the point of evaluation step 1.a, the execution context stack is empty and _then_ is a revoked Proxy</td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Thu May 07 2020 18:20:00 GMT-0700 (Pacific Daylight Time)">01:20</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=shu@irc>shu</span>&gt;</td><td class="msg-cell">since _then_ is a revoked Proxy, step 1.b will unconditionally throw without user code observing the resolving functions</td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Thu May 07 2020 18:20:29 GMT-0700 (Pacific Daylight Time)">01:20</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=shu@irc>shu</span>&gt;</td><td class="msg-cell">however, CreateResolvingFunctions calls CreateBuiltinFunction: <a href="https://tc39.es/ecma262/#sec-createbuiltinfunction">https://tc39.es/ecma262/#sec-createbuiltinfunction</a></td></tr>
  <tr class="msg" id="L17"><td class="ts-cell"><a class="ts" href="#L17" alt="Thu May 07 2020 18:20:53 GMT-0700 (Pacific Daylight Time)">01:20</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=shu@irc>shu</span>&gt;</td><td class="msg-cell">step 2 of CreateBuiltinFunction looks at the execution context stack, and assumes it&#039;s non-empty</td></tr>
  <tr class="msg" id="L18"><td class="ts-cell"><a class="ts" href="#L18" alt="Thu May 07 2020 18:21:48 GMT-0700 (Pacific Daylight Time)">01:21</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=shu@irc>shu</span>&gt;</td><td class="msg-cell">in my hypothetical scenario, would you consider that Assert to require the exec ctx stack to be non-empty, even though the invocation itself can be eliminated because it&#039;s not observable</td></tr>
  <tr class="msg" id="L19"><td class="ts-cell"><a class="ts" href="#L19" alt="Thu May 07 2020 18:22:38 GMT-0700 (Pacific Daylight Time)">01:22</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=Bakkot@irc>Bakkot</span>&gt;</td><td class="msg-cell">two answers:</td></tr>
  <tr class="msg" id="L20"><td class="ts-cell"><a class="ts" href="#L20" alt="Thu May 07 2020 18:23:42 GMT-0700 (Pacific Daylight Time)">01:23</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=Bakkot@irc>Bakkot</span>&gt;</td><td class="msg-cell">1. I don&#039;t think it is observable to users whether the exec context stack is _in fact_ empty, so engines can choose to implement it such a way that it is empty (whatever that means, since &quot;exec context stack&quot; is not a real thing)</td></tr>
  <tr class="msg" id="L21"><td class="ts-cell"><a class="ts" href="#L21" alt="Thu May 07 2020 18:24:23 GMT-0700 (Pacific Daylight Time)">01:24</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=shu@irc>shu</span>&gt;</td><td class="msg-cell">it&#039;s a real thing in determining the current Realm, and in turn the Function.prototype to use for the created (but never observed) builtin function</td></tr>
  <tr class="msg" id="L22"><td class="ts-cell"><a class="ts" href="#L22" alt="Thu May 07 2020 18:24:55 GMT-0700 (Pacific Daylight Time)">01:24</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=shu@irc>shu</span>&gt;</td><td class="msg-cell">step 4 here: <a href="https://tc39.es/ecma262/#sec-createbuiltinfunction">https://tc39.es/ecma262/#sec-createbuiltinfunction</a></td></tr>
  <tr class="msg" id="L23"><td class="ts-cell"><a class="ts" href="#L23" alt="Thu May 07 2020 18:25:31 GMT-0700 (Pacific Daylight Time)">01:25</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=shu@irc>shu</span>&gt;</td><td class="msg-cell">(though my opinion is, as you might expect, that that doesn&#039;t make it any more real, since none of these steps have &quot;force&quot; until user code actually observes anything&quot;</td></tr>
  <tr class="msg" id="L24"><td class="ts-cell"><a class="ts" href="#L24" alt="Thu May 07 2020 18:25:33 GMT-0700 (Pacific Daylight Time)">01:25</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=Bakkot@irc>Bakkot</span>&gt;</td><td class="msg-cell">2. assertions are comments for the benefits of readers of the specification. they have no normative implications. we should arrange that they be true by virtue of the way the spec is written. if they don&#039;t follow as logical consequences of the rest of the spec, we should either modify/eliminate them or add new constraints to other parts of the spec so that they do follow as logical consequences of the rest of the spec</td></tr>
  <tr class="msg" id="L25"><td class="ts-cell"><a class="ts" href="#L25" alt="Thu May 07 2020 18:26:06 GMT-0700 (Pacific Daylight Time)">01:26</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=shu@irc>shu</span>&gt;</td><td class="msg-cell">agreed on 2</td></tr>
  <tr class="msg" id="L26"><td class="ts-cell"><a class="ts" href="#L26" alt="Thu May 07 2020 18:26:46 GMT-0700 (Pacific Daylight Time)">01:26</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=Bakkot@irc>Bakkot</span>&gt;</td><td class="msg-cell">&quot;it&#039;s a real thing in determining the current Realm, and in turn the Function.prototype to use for the created (but never observed) builtin function&quot; - I would not regard this as being observable to users</td></tr>
  <tr class="msg" id="L27"><td class="ts-cell"><a class="ts" href="#L27" alt="Thu May 07 2020 18:27:12 GMT-0700 (Pacific Daylight Time)">01:27</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=shu@irc>shu</span>&gt;</td><td class="msg-cell">if the builtin function escapes to user code, then it is, but in this case, it doesn&#039;t escape to user code</td></tr>
  <tr class="msg" id="L28"><td class="ts-cell"><a class="ts" href="#L28" alt="Thu May 07 2020 18:27:17 GMT-0700 (Pacific Daylight Time)">01:27</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=Bakkot@irc>Bakkot</span>&gt;</td><td class="msg-cell">right</td></tr>
  <tr class="msg" id="L29"><td class="ts-cell"><a class="ts" href="#L29" alt="Thu May 07 2020 18:27:25 GMT-0700 (Pacific Daylight Time)">01:27</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=Bakkot@irc>Bakkot</span>&gt;</td><td class="msg-cell">since it does not escape to user code, it is not observable</td></tr>
  <tr class="msg" id="L30"><td class="ts-cell"><a class="ts" href="#L30" alt="Thu May 07 2020 18:27:45 GMT-0700 (Pacific Daylight Time)">01:27</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=Bakkot@irc>Bakkot</span>&gt;</td><td class="msg-cell">which means that the engine could have implemented the spec exactly as written, for all the user knows</td></tr>
  <tr class="msg" id="L31"><td class="ts-cell"><a class="ts" href="#L31" alt="Thu May 07 2020 18:28:06 GMT-0700 (Pacific Daylight Time)">01:28</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=Bakkot@irc>Bakkot</span>&gt;</td><td class="msg-cell">it is not observable to the user that the engine does not just blindly implement the spec exactly as written = it is OK</td></tr>
  <tr class="msg" id="L32"><td class="ts-cell"><a class="ts" href="#L32" alt="Thu May 07 2020 18:30:54 GMT-0700 (Pacific Daylight Time)">01:30</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=Bakkot@irc>Bakkot</span>&gt;</td><td class="msg-cell">(sidebar: the previous sentence leads to one of my favorite facts about the spec, which is that, since the spec does not actually specify any IO at all, a program which takes UTF16 in and then immediately hangs forever is a valid implementation of the spec)</td></tr>
  <tr class="msg" id="L33"><td class="ts-cell"><a class="ts" href="#L33" alt="Thu May 07 2020 18:36:30 GMT-0700 (Pacific Daylight Time)">01:36</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=shu@irc>shu</span>&gt;</td><td class="msg-cell">haha</td></tr>
  <tr class="msg" id="L34"><td class="ts-cell"><a class="ts" href="#L34" alt="Thu May 07 2020 18:36:32 GMT-0700 (Pacific Daylight Time)">01:36</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=shu@irc>shu</span>&gt;</td><td class="msg-cell">indeed</td></tr>
  <tr class="msg" id="L35"><td class="ts-cell"><a class="ts" href="#L35" alt="Thu May 07 2020 18:36:54 GMT-0700 (Pacific Daylight Time)">01:36</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=shu@irc>shu</span>&gt;</td><td class="msg-cell">okay, good, we are in agreement</td></tr>
  <tr class="msg" id="L36"><td class="ts-cell"><a class="ts" href="#L36" alt="Thu May 07 2020 18:43:36 GMT-0700 (Pacific Daylight Time)">01:43</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=shu@irc>shu</span>&gt;</td><td class="msg-cell">i&#039;d appreciate <a href="https://github.com/tc39/ecma262/pull/1984">https://github.com/tc39/ecma262/pull/1984</a> a read in context of this convo whenever you have time</td></tr>
  <tr class="msg" id="L37"><td class="ts-cell"><a class="ts" href="#L37" alt="Thu May 07 2020 18:44:00 GMT-0700 (Pacific Daylight Time)">01:44</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=shu@irc>shu</span>&gt;</td><td class="msg-cell">i find debating devsnek on it exasperating, so in case he&#039;s making valid points i&#039;d like a reframing from other folks who are less exasperating</td></tr>
  <tr class="msg" id="L38"><td class="ts-cell"><a class="ts" href="#L38" alt="Thu May 07 2020 19:05:48 GMT-0700 (Pacific Daylight Time)">02:05</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=Bakkot@irc>Bakkot</span>&gt;</td><td class="msg-cell">hm - given the foregoing, I don&#039;t understand your point about &quot;the corner case that&#039;s made easier by giving hosts this latitude about Realms for scheduled jobs: revoked proxies&quot;</td></tr>
  <tr class="msg" id="L39"><td class="ts-cell"><a class="ts" href="#L39" alt="Thu May 07 2020 19:06:28 GMT-0700 (Pacific Daylight Time)">02:06</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=Bakkot@irc>Bakkot</span>&gt;</td><td class="msg-cell">since it sounds to me like we have just established that hosts are free to omit the realm from the context stack in the actual implementation, because it is not observable whether or not they do so</td></tr>
  <tr class="msg" id="L40"><td class="ts-cell"><a class="ts" href="#L40" alt="Thu May 07 2020 19:07:17 GMT-0700 (Pacific Daylight Time)">02:07</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=Bakkot@irc>Bakkot</span>&gt;</td><td class="msg-cell">that is to say, I don&#039;t understand why hosts need latitude for that case</td></tr>
  <tr class="msg" id="L41"><td class="ts-cell"><a class="ts" href="#L41" alt="Thu May 07 2020 19:08:05 GMT-0700 (Pacific Daylight Time)">02:08</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=Bakkot@irc>Bakkot</span>&gt;</td><td class="msg-cell">further latitude than they already get from the &quot;as-if&quot; nature of the specification, that is</td></tr>
  <tr class="msg" id="L42"><td class="ts-cell"><a class="ts" href="#L42" alt="Thu May 07 2020 19:13:13 GMT-0700 (Pacific Daylight Time)">02:13</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=shu@irc>shu</span>&gt;</td><td class="msg-cell">that&#039;s a good point, latitude here doesn&#039;t help the revoked proxy here given the &quot;as-if&quot; understanding</td></tr>
  <tr class="msg" id="L43"><td class="ts-cell"><a class="ts" href="#L43" alt="Thu May 07 2020 19:13:40 GMT-0700 (Pacific Daylight Time)">02:13</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=shu@irc>shu</span>&gt;</td><td class="msg-cell">the revoked proxy case*</td></tr>
  <tr class="msg" id="L44"><td class="ts-cell"><a class="ts" href="#L44" alt="Thu May 07 2020 19:14:41 GMT-0700 (Pacific Daylight Time)">02:14</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=shu@irc>shu</span>&gt;</td><td class="msg-cell">at least not strictly</td></tr>
  <tr class="msg" id="L45"><td class="ts-cell"><a class="ts" href="#L45" alt="Thu May 07 2020 19:15:26 GMT-0700 (Pacific Daylight Time)">02:15</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=shu@irc>shu</span>&gt;</td><td class="msg-cell">editorially, lack of latitude here would mean upstream specs need to understand the &quot;as-if&quot; cases</td></tr>
  <tr class="msg" id="L46"><td class="ts-cell"><a class="ts" href="#L46" alt="Thu May 07 2020 19:15:39 GMT-0700 (Pacific Daylight Time)">02:15</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=shu@irc>shu</span>&gt;</td><td class="msg-cell">and if not, they&#039;d need to write extra spec text that might be nonsensical</td></tr>
  <tr class="msg" id="L47"><td class="ts-cell"><a class="ts" href="#L47" alt="Thu May 07 2020 19:15:47 GMT-0700 (Pacific Daylight Time)">02:15</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=shu@irc>shu</span>&gt;</td><td class="msg-cell">not sure how to balance</td></tr>
  <tr class="msg" id="L48"><td class="ts-cell"><a class="ts" href="#L48" alt="Thu May 07 2020 19:16:11 GMT-0700 (Pacific Daylight Time)">02:16</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=Bakkot@irc>Bakkot</span>&gt;</td><td class="msg-cell">I think that&#039;s probably solvable with a NOTE</td></tr>
  <tr class="msg" id="L49"><td class="ts-cell"><a class="ts" href="#L49" alt="Thu May 07 2020 19:16:49 GMT-0700 (Pacific Daylight Time)">02:16</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=shu@irc>shu</span>&gt;</td><td class="msg-cell">hmm</td></tr>
  <tr class="msg" id="L50"><td class="ts-cell"><a class="ts" href="#L50" alt="Thu May 07 2020 19:16:52 GMT-0700 (Pacific Daylight Time)">02:16</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=Bakkot@irc>Bakkot</span>&gt;</td><td class="msg-cell">I am more worried about the non-null case here: for cases where it is not null, do we want a normative requirement on which realm it is?</td></tr>
  <tr class="msg" id="L51"><td class="ts-cell"><a class="ts" href="#L51" alt="Thu May 07 2020 19:17:06 GMT-0700 (Pacific Daylight Time)">02:17</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=shu@irc>shu</span>&gt;</td><td class="msg-cell">no, i don&#039;t</td></tr>
  <tr class="msg" id="L52"><td class="ts-cell"><a class="ts" href="#L52" alt="Thu May 07 2020 19:17:48 GMT-0700 (Pacific Daylight Time)">02:17</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=shu@irc>shu</span>&gt;</td><td class="msg-cell">i guess it wasn&#039;t very clear before because it did say it required the same realm as at the time of queuing</td></tr>
  <tr class="msg" id="L53"><td class="ts-cell"><a class="ts" href="#L53" alt="Thu May 07 2020 19:18:01 GMT-0700 (Pacific Daylight Time)">02:18</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=shu@irc>shu</span>&gt;</td><td class="msg-cell">but it was also a part of the spec that was willfully violated and people didn&#039;t implement</td></tr>
  <tr class="msg" id="L54"><td class="ts-cell"><a class="ts" href="#L54" alt="Thu May 07 2020 19:18:03 GMT-0700 (Pacific Daylight Time)">02:18</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=shu@irc>shu</span>&gt;</td><td class="msg-cell">so... shrug</td></tr>
  <tr class="msg" id="L55"><td class="ts-cell"><a class="ts" href="#L55" alt="Thu May 07 2020 19:22:03 GMT-0700 (Pacific Daylight Time)">02:22</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=Bakkot@irc>Bakkot</span>&gt;</td><td class="msg-cell">also there&#039;s two realms in question here, yes?</td></tr>
  <tr class="msg" id="L56"><td class="ts-cell"><a class="ts" href="#L56" alt="Thu May 07 2020 19:22:09 GMT-0700 (Pacific Daylight Time)">02:22</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=shu@irc>shu</span>&gt;</td><td class="msg-cell">yes</td></tr>
  <tr class="msg" id="L57"><td class="ts-cell"><a class="ts" href="#L57" alt="Thu May 07 2020 19:22:23 GMT-0700 (Pacific Daylight Time)">02:22</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=shu@irc>shu</span>&gt;</td><td class="msg-cell">there&#039;s the current Realm at the time of queuing, and there&#039;s the realm of the relevant handler callbacks</td></tr>
  <tr class="msg" id="L58"><td class="ts-cell"><a class="ts" href="#L58" alt="Thu May 07 2020 19:22:31 GMT-0700 (Pacific Daylight Time)">02:22</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=shu@irc>shu</span>&gt;</td><td class="msg-cell">the _realm_ passed to the host hook is the latter</td></tr>
  <tr class="msg" id="L59"><td class="ts-cell"><a class="ts" href="#L59" alt="Thu May 07 2020 19:23:23 GMT-0700 (Pacific Daylight Time)">02:23</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=Bakkot@irc>Bakkot</span>&gt;</td><td class="msg-cell">the two I meant were &quot;The Realm component of the topmost execution context on the execution context stack is a Realm Record.&quot; and the _realm_ passed to the host hook</td></tr>
  <tr class="msg" id="L60"><td class="ts-cell"><a class="ts" href="#L60" alt="Thu May 07 2020 19:23:33 GMT-0700 (Pacific Daylight Time)">02:23</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=Bakkot@irc>Bakkot</span>&gt;</td><td class="msg-cell">there are currently no normative requirements on either, that I can see</td></tr>
  <tr class="msg" id="L61"><td class="ts-cell"><a class="ts" href="#L61" alt="Thu May 07 2020 19:23:51 GMT-0700 (Pacific Daylight Time)">02:23</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=Bakkot@irc>Bakkot</span>&gt;</td><td class="msg-cell">the first is the realm at the time _the callback runs_, not the one at the time of queuing, I believee</td></tr>
  <tr class="msg" id="L62"><td class="ts-cell"><a class="ts" href="#L62" alt="Thu May 07 2020 19:24:13 GMT-0700 (Pacific Daylight Time)">02:24</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=shu@irc>shu</span>&gt;</td><td class="msg-cell">in our current draft there are no normative requirements</td></tr>
  <tr class="msg" id="L63"><td class="ts-cell"><a class="ts" href="#L63" alt="Thu May 07 2020 19:24:24 GMT-0700 (Pacific Daylight Time)">02:24</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=shu@irc>shu</span>&gt;</td><td class="msg-cell">there were (dubious) normative requirements before the promise layering PR landed</td></tr>
  <tr class="msg" id="L64"><td class="ts-cell"><a class="ts" href="#L64" alt="Thu May 07 2020 19:24:34 GMT-0700 (Pacific Daylight Time)">02:24</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=shu@irc>shu</span>&gt;</td><td class="msg-cell">with the whole jobs machinery that wasn&#039;t used</td></tr>
  <tr class="msg" id="L65"><td class="ts-cell"><a class="ts" href="#L65" alt="Thu May 07 2020 19:24:37 GMT-0700 (Pacific Daylight Time)">02:24</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=Bakkot@irc>Bakkot</span>&gt;</td><td class="msg-cell">right, ok</td></tr>
  <tr class="msg" id="L66"><td class="ts-cell"><a class="ts" href="#L66" alt="Thu May 07 2020 19:24:50 GMT-0700 (Pacific Daylight Time)">02:24</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=Bakkot@irc>Bakkot</span>&gt;</td><td class="msg-cell">and your position is, you don&#039;t want there to be any requirements on either of them?</td></tr>
  <tr class="msg" id="L67"><td class="ts-cell"><a class="ts" href="#L67" alt="Thu May 07 2020 19:25:04 GMT-0700 (Pacific Daylight Time)">02:25</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=shu@irc>shu</span>&gt;</td><td class="msg-cell">pretty much</td></tr>
  <tr class="msg" id="L68"><td class="ts-cell"><a class="ts" href="#L68" alt="Thu May 07 2020 19:29:19 GMT-0700 (Pacific Daylight Time)">02:29</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=Bakkot@irc>Bakkot</span>&gt;</td><td class="msg-cell">if so, I would propose that we add a non-normative note to the HostEnqueuePromiseJob requirements  which says&quot; bit which says &quot;Note: typically this results in the execution context stack having as its topmost item an execution context whose Realm component was the Realm component of the topmost item on the execution stack when HostEnqueuePromiseJob was invoked, although this is not a normative requirement&quot;, and devsnek</td></tr>
  <tr class="msg" id="L69"><td class="ts-cell"><a class="ts" href="#L69" alt="Thu May 07 2020 19:29:19 GMT-0700 (Pacific Daylight Time)">02:29</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=Bakkot@irc>Bakkot</span>&gt;</td><td class="msg-cell"> can argue a normative requirement through committee if he wants</td></tr>
  <tr class="msg" id="L70"><td class="ts-cell"><a class="ts" href="#L70" alt="Thu May 07 2020 19:29:37 GMT-0700 (Pacific Daylight Time)">02:29</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=shu@irc>shu</span>&gt;</td><td class="msg-cell">sgtm</td></tr>
  <tr class="msg" id="L71"><td class="ts-cell"><a class="ts" href="#L71" alt="Thu May 07 2020 19:29:55 GMT-0700 (Pacific Daylight Time)">02:29</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=Bakkot@irc>Bakkot</span>&gt;</td><td class="msg-cell">though I am not super clear on why we would not want that to be a normative requirement, if the only benefit of leaving it unspecified is the revoked proxy thing</td></tr>
  <tr class="msg" id="L72"><td class="ts-cell"><a class="ts" href="#L72" alt="Thu May 07 2020 19:30:09 GMT-0700 (Pacific Daylight Time)">02:30</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=shu@irc>shu</span>&gt;</td><td class="msg-cell">he might be right about the error that gets created in resolvethenable jobs</td></tr>
  <tr class="msg" id="L73"><td class="ts-cell"><a class="ts" href="#L73" alt="Thu May 07 2020 19:31:04 GMT-0700 (Pacific Daylight Time)">02:31</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=Bakkot@irc>Bakkot</span>&gt;</td><td class="msg-cell">and would therefore mildly prefer we make it normative and instead have a NOTE which says that it may not be observable what the realm is, e.g. if the _then_ is a revoked proxy, and reminds the reader of the as-if requirement</td></tr>
  <tr class="msg" id="L74"><td class="ts-cell"><a class="ts" href="#L74" alt="Thu May 07 2020 19:31:38 GMT-0700 (Pacific Daylight Time)">02:31</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=shu@irc>shu</span>&gt;</td><td class="msg-cell">we could make it a normative requirement, though it&#039;s slightly annoying on the upstream side</td></tr>
  <tr class="msg" id="L75"><td class="ts-cell"><a class="ts" href="#L75" alt="Thu May 07 2020 19:32:48 GMT-0700 (Pacific Daylight Time)">02:32</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=Bakkot@irc>Bakkot</span>&gt;</td><td class="msg-cell">we could also just be explicit and say that the Realm requirement only applies if it is observable</td></tr>
  <tr class="msg" id="L76"><td class="ts-cell"><a class="ts" href="#L76" alt="Thu May 07 2020 19:33:03 GMT-0700 (Pacific Daylight Time)">02:33</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=Bakkot@irc>Bakkot</span>&gt;</td><td class="msg-cell">this is always true but if that makes upstream integration I have no problem repeating it</td></tr>
  <tr class="msg" id="L77"><td class="ts-cell"><a class="ts" href="#L77" alt="Thu May 07 2020 19:33:33 GMT-0700 (Pacific Daylight Time)">02:33</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=shu@irc>shu</span>&gt;</td><td class="msg-cell">i am not sure if it should be the normative requirement because the host has always been allowed to push other execution contexts on top, and this incumbents nonsense maybe figures into it</td></tr>
  <tr class="msg" id="L78"><td class="ts-cell"><a class="ts" href="#L78" alt="Thu May 07 2020 19:33:52 GMT-0700 (Pacific Daylight Time)">02:33</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=Bakkot@irc>Bakkot</span>&gt;</td><td class="msg-cell">ahh</td></tr>
  <tr class="msg" id="L79"><td class="ts-cell"><a class="ts" href="#L79" alt="Thu May 07 2020 19:34:10 GMT-0700 (Pacific Daylight Time)">02:34</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=Bakkot@irc>Bakkot</span>&gt;</td><td class="msg-cell">ok, I will say the thing about the non-normative note then</td></tr>
  <tr class="msg" id="L80"><td class="ts-cell"><a class="ts" href="#L80" alt="Thu May 07 2020 19:34:13 GMT-0700 (Pacific Daylight Time)">02:34</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=shu@irc>shu</span>&gt;</td><td class="msg-cell">though i am not yet confident whether it does or does not</td></tr>
  <tr class="msg" id="L81"><td class="ts-cell"><a class="ts" href="#L81" alt="Thu May 07 2020 19:35:00 GMT-0700 (Pacific Daylight Time)">02:35</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=shu@irc>shu</span>&gt;</td><td class="msg-cell">like, should HTML enqueue a new promise job using the same hook from its own machinery, when there is no active script (you can imagine web apis doing this)</td></tr>
  <tr class="msg" id="L82"><td class="ts-cell"><a class="ts" href="#L82" alt="Thu May 07 2020 19:35:11 GMT-0700 (Pacific Daylight Time)">02:35</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=shu@irc>shu</span>&gt;</td><td class="msg-cell">what do our requirements here even mean then?</td></tr>
  <tr class="msg" id="L83"><td class="ts-cell"><a class="ts" href="#L83" alt="Thu May 07 2020 19:35:44 GMT-0700 (Pacific Daylight Time)">02:35</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=Bakkot@irc>Bakkot</span>&gt;</td><td class="msg-cell">they explicitly do not apply in that case, no?</td></tr>
  <tr class="msg" id="L84"><td class="ts-cell"><a class="ts" href="#L84" alt="Thu May 07 2020 19:35:57 GMT-0700 (Pacific Daylight Time)">02:35</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=Bakkot@irc>Bakkot</span>&gt;</td><td class="msg-cell">oh, no, I misread</td></tr>
  <tr class="msg" id="L85"><td class="ts-cell"><a class="ts" href="#L85" alt="Thu May 07 2020 19:36:07 GMT-0700 (Pacific Daylight Time)">02:36</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=shu@irc>shu</span>&gt;</td><td class="msg-cell">well i don&#039;t actually know if they apply or not</td></tr>
  <tr class="msg" id="L86"><td class="ts-cell"><a class="ts" href="#L86" alt="Thu May 07 2020 19:36:21 GMT-0700 (Pacific Daylight Time)">02:36</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=shu@irc>shu</span>&gt;</td><td class="msg-cell">if upstream specs implement our host hooks, it seems fair game to let it call those themselves</td></tr>
  <tr class="msg" id="L87"><td class="ts-cell"><a class="ts" href="#L87" alt="Thu May 07 2020 19:36:27 GMT-0700 (Pacific Daylight Time)">02:36</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=shu@irc>shu</span>&gt;</td><td class="msg-cell">and some kind of invariants should still hold</td></tr>
  <tr class="msg" id="L88"><td class="ts-cell"><a class="ts" href="#L88" alt="Thu May 07 2020 19:36:48 GMT-0700 (Pacific Daylight Time)">02:36</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=Bakkot@irc>Bakkot</span>&gt;</td><td class="msg-cell">yes, that is an unrelated issue which should be fixed - if GetActiveScriptOrModule returns `null`, the &quot;prepared to execute code&quot; bit should not apply I think</td></tr>
  <tr class="msg" id="L89"><td class="ts-cell"><a class="ts" href="#L89" alt="Thu May 07 2020 19:37:00 GMT-0700 (Pacific Daylight Time)">02:37</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=shu@irc>shu</span>&gt;</td><td class="msg-cell">spec layering is a mess</td></tr>
  <tr class="msg" id="L90"><td class="ts-cell"><a class="ts" href="#L90" alt="Thu May 07 2020 19:37:04 GMT-0700 (Pacific Daylight Time)">02:37</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=shu@irc>shu</span>&gt;</td><td class="msg-cell">i need to think this through more carefully</td></tr>
  <tr class="msg" id="L91"><td class="ts-cell"><a class="ts" href="#L91" alt="Thu May 07 2020 19:37:06 GMT-0700 (Pacific Daylight Time)">02:37</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=Bakkot@irc>Bakkot</span>&gt;</td><td class="msg-cell">trufax</td></tr>
  <tr class="msg" id="L92"><td class="ts-cell"><a class="ts" href="#L92" alt="Thu May 07 2020 19:44:43 GMT-0700 (Pacific Daylight Time)">02:44</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=Bakkot@irc>Bakkot</span>&gt;</td><td class="msg-cell">&gt; if upstream specs implement our host hooks, it seems fair game to let it call those themselves</td></tr>
  <tr class="msg" id="L93"><td class="ts-cell"><a class="ts" href="#L93" alt="Thu May 07 2020 19:45:19 GMT-0700 (Pacific Daylight Time)">02:45</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=Bakkot@irc>Bakkot</span>&gt;</td><td class="msg-cell">having thought a little more about this, my position is, we are not required to arrange that these are written in a way which make sense for hosts to call at all times</td></tr>
  <tr class="msg" id="L94"><td class="ts-cell"><a class="ts" href="#L94" alt="Thu May 07 2020 19:45:45 GMT-0700 (Pacific Daylight Time)">02:45</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=Bakkot@irc>Bakkot</span>&gt;</td><td class="msg-cell">hosts can in principle determine for themselves if they make sense as written</td></tr>
  <tr class="msg" id="L95"><td class="ts-cell"><a class="ts" href="#L95" alt="Thu May 07 2020 19:46:16 GMT-0700 (Pacific Daylight Time)">02:46</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=Bakkot@irc>Bakkot</span>&gt;</td><td class="msg-cell">and if there&#039;s a particular reason to do the work to make them callable in the situation the host wants, we can do the work at that point, with the concrete use case in mind</td></tr>
  <tr class="msg" id="L96"><td class="ts-cell"><a class="ts" href="#L96" alt="Thu May 07 2020 19:47:26 GMT-0700 (Pacific Daylight Time)">02:47</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=Bakkot@irc>Bakkot</span>&gt;</td><td class="msg-cell">I left my comment about the NOTE on the PR</td></tr>
  <tr class="msg" id="L97"><td class="ts-cell"><a class="ts" href="#L97" alt="Thu May 07 2020 20:36:43 GMT-0700 (Pacific Daylight Time)">03:36</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=shu@irc>shu</span>&gt;</td><td class="msg-cell">that position also seems fine to me</td></tr>
  <tr class="msg" id="L98"><td class="ts-cell"><a class="ts" href="#L98" alt="Thu May 07 2020 20:36:56 GMT-0700 (Pacific Daylight Time)">03:36</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=shu@irc>shu</span>&gt;</td><td class="msg-cell">and that concern probably doesn&#039;t generalize beyond promises</td></tr>
  <tr class="msg" id="L99"><td class="ts-cell"><a class="ts" href="#L99" alt="Thu May 07 2020 20:37:11 GMT-0700 (Pacific Daylight Time)">03:37</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=shu@irc>shu</span>&gt;</td><td class="msg-cell">promises is the only thing that might be widely used enough that rando web apis might want to call hooks to enqueue stuff</td></tr>
  <tr class="msg" id="L100"><td class="ts-cell"><a class="ts" href="#L100" alt="Fri May 08 2020 16:20:50 GMT-0700 (Pacific Daylight Time)">23:20</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=Bakkot@irc>Bakkot</span>&gt;</td><td class="msg-cell">shu: i see your update, will review when I get a chance</td></tr>
  <tr class="msg" id="L101"><td class="ts-cell"><a class="ts" href="#L101" alt="Fri May 08 2020 16:21:04 GMT-0700 (Pacific Daylight Time)">23:21</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=Bakkot@irc>Bakkot</span>&gt;</td><td class="msg-cell">gonna need to be at a point I can set aside a solid block of time for paging stuff in, I see</td></tr>
  <tr class="msg" id="L102"><td class="ts-cell"><a class="ts" href="#L102" alt="Fri May 08 2020 16:22:18 GMT-0700 (Pacific Daylight Time)">23:22</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=shu@irc>shu</span>&gt;</td><td class="msg-cell">it&#039;s not urgent</td></tr>
  <tr class="msg" id="L103"><td class="ts-cell"><a class="ts" href="#L103" alt="Fri May 08 2020 16:22:34 GMT-0700 (Pacific Daylight Time)">23:22</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=shu@irc>shu</span>&gt;</td><td class="msg-cell">hard deadline is like, before we merge weak refs</td></tr>
  <tr class="msg" id="L104"><td class="ts-cell"><a class="ts" href="#L104" alt="Fri May 08 2020 16:22:37 GMT-0700 (Pacific Daylight Time)">23:22</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=shu@irc>shu</span>&gt;</td><td class="msg-cell">no soft deadline really</td></tr>
  <tr class="msg" id="L105"><td class="ts-cell"><a class="ts" href="#L105" alt="Fri May 08 2020 16:22:47 GMT-0700 (Pacific Daylight Time)">23:22</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=shu@irc>shu</span>&gt;</td><td class="msg-cell">though the faster we review as a group the better chance i still remember my intentions :)</td></tr>
  <tr class="msg" id="L106"><td class="ts-cell"><a class="ts" href="#L106" alt="Fri May 08 2020 16:24:08 GMT-0700 (Pacific Daylight Time)">23:24</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=Bakkot@irc>Bakkot</span>&gt;</td><td class="msg-cell">yeah, for big stuff like this it is nice to deal with it relatively synchronously</td></tr>
  <tr class="msg" id="L107"><td class="ts-cell"><a class="ts" href="#L107" alt="Fri May 08 2020 16:36:33 GMT-0700 (Pacific Daylight Time)">23:36</a></td><td class="nick-cell">&lt;<span class="nick nick-6" title=ljharb@irc>ljharb</span>&gt;</td><td class="msg-cell">we are definitely going to have to talk about this in the editor call, i&#039;m so confused</td></tr>
  <tr class="msg" id="L108"><td class="ts-cell"><a class="ts" href="#L108" alt="Fri May 08 2020 16:46:13 GMT-0700 (Pacific Daylight Time)">23:46</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title=shu@irc>shu</span>&gt;</td><td class="msg-cell">haha sure</td></tr>
</tbody></table>
</div></div></div></body>

2022-07-03
[07:19:46.0357] <Jack Works>
> <@littledan:matrix.org> I don't think it's relaxed in practice. HTML may do two fetches but definitely not evaluate the same JS code twice

Do you mean, the first import without assertion, and the second import with assertion so the browser needs to fetch the source again to check if  assertion succeed? 

[07:30:19.0879] <Jack Works>
> <@lucacasonato:matrix.org> I know for a fact that Chrome only fetched each specifier once per realm.

üëÄ What if import("/a") then import("/b") but /b redirects to /a? does "/a" execute twice?

[07:33:02.0168] <Luca Casonato>
> <@jackworks:matrix.org> üëÄ What if import("/a") then import("/b") but /b redirects to /a? does "/a" execute twice?

No

[14:28:42.0994] <guybedford>
That case very much does execute twice in browsers, even if it only fetches /a once

[15:37:38.0846] <Luca Casonato>
Huh, I am confused now... I remember this working differently

[15:38:12.0148] <Luca Casonato>
I dug through this all a year or two ago for the Deno module loader.

[15:42:02.0519] <Luca Casonato>
Deno definitely does something else here. I'll go dig through this again this week, before the Tuesday meeting

[15:48:09.0364] <Luca Casonato>
This means you can have two module instances with identical source text, and an identical `import.meta.url` (that is referencing a real JS file) in the same realm in browsers right now... I was not aware of this.


2022-07-04
[17:08:18.0758] <nicolo-ribaudo>
> <@lucacasonato:matrix.org> Deno definitely does something else here. I'll go dig through this again this week, before the Tuesday meeting

Heads up: this week's meeting has been moved to Wednesday 

[17:43:53.0347] <guybedford>
Luca Casonato: on the web, the response URL and request URL are different things

[17:43:59.0409] <guybedford>
`import.meta.url` corresponds to the response URL

[17:44:04.0959] <guybedford>
while the module map corresponds to the request URL

[17:44:21.0115] <guybedford>
for all intensive purposes redirects on the web are largely useless due to the double execution hazard

[17:47:32.0294] <guybedford>
from the perspective of ECMA-262, there is no inconsistency - there are two separate modules in the registry, that have the same source text

[17:47:46.0588] <guybedford>
and the same `import.meta.url` - `import.meta.url` has no correspondence to the cache key

[08:24:05.0507] <Kris Kowal>
And we‚Äôre obliged to make it possible to faithfully emulate both behaviors (single execution, multi execution) with loaders. ‚ò†Ô∏è


<!DOCTYPE html><html><head>
  <title>TC39 Delegates on 2024-04-09</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "TC39 Delegates";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">TC39 Delegates<br>2024-04-09<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2024-04-08" class="nav-link"><span>prev</span></a>
<span style="float:right">next</span>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">
<div class="rhs-header">
<span id="error" style="color: red; display:none">error</span>

<input type="text" id="query" size="25" placeholder="Search TC39 Delegates">
<a id="search-submit" class="button icon-link" title="Search">
  <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"></path></svg>
</a>
</div>

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Tue Apr 09 2024 06:52:32 GMT-0700 (Pacific Daylight Time)">13:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@usharma:igalia.com">ryzokuken</span>&gt;</div></td><td class="msg-cell">good morning/evening/night everyone!</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Tue Apr 09 2024 06:52:36 GMT-0700 (Pacific Daylight Time)">13:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@usharma:igalia.com">ryzokuken</span>&gt;</div></td><td class="msg-cell">meeting starts in ~7</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Tue Apr 09 2024 07:29:19 GMT-0700 (Pacific Daylight Time)">14:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@littledan:matrix.org">littledan</span>&gt;</div></td><td class="msg-cell">I have trouble understanding the motivation for this null change, but also it doesn't seem harmful</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Tue Apr 09 2024 07:29:55 GMT-0700 (Pacific Daylight Time)">14:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@littledan:matrix.org">littledan</span>&gt;</div></td><td class="msg-cell">(or rather, I have trouble understanding the motivation for the null skipping in the first place)</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Tue Apr 09 2024 07:30:39 GMT-0700 (Pacific Daylight Time)">14:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@nicolo-ribaudo:matrix.org">nicolo-ribaudo</span>&gt;</div></td><td class="msg-cell">Random fact: Babel accidentally ignores <code>null</code>s while guaranteeing at least one <code>await</code> -- we have a PR open to match the behavior of the current (pre-this-change) proposal</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Tue Apr 09 2024 07:35:07 GMT-0700 (Pacific Daylight Time)">14:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@haxjs:matrix.org">hax (HE Shi-Jun)</span>&gt;</div></td><td class="msg-cell">It seems this PR try to avoid nulls introducing extra awaits, am I understanding this correctly?</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Tue Apr 09 2024 07:35:17 GMT-0700 (Pacific Daylight Time)">14:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@nicolo-ribaudo:matrix.org">nicolo-ribaudo</span>&gt;</div></td><td class="msg-cell">Yes</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Tue Apr 09 2024 07:37:51 GMT-0700 (Pacific Daylight Time)">14:37</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</div></td><td class="msg-cell">this is a small thing, but i'd be interested in people's thoughts on banning <code>using</code> inside base switch cases: <a href="https://github.com/tc39/proposal-explicit-resource-management/issues/215#issuecomment-2040486653">https://github.com/tc39/proposal-explicit-resource-management/issues/215#issuecomment-2040486653</a></td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Tue Apr 09 2024 07:39:23 GMT-0700 (Pacific Daylight Time)">14:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@nicolo-ribaudo:matrix.org">nicolo-ribaudo</span>&gt;</div></td><td class="msg-cell">Babel's <code>using</code> support in <code>switch</code> is currently completely broken</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Tue Apr 09 2024 07:39:42 GMT-0700 (Pacific Daylight Time)">14:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@nicolo-ribaudo:matrix.org">nicolo-ribaudo</span>&gt;</div></td><td class="msg-cell">Because everything in <code>switch</code> is incredibly annoying to compile</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Tue Apr 09 2024 07:39:57 GMT-0700 (Pacific Daylight Time)">14:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</div></td><td class="msg-cell">i wanna ban it but recognize that'll break symmetry with let/const</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Tue Apr 09 2024 07:40:52 GMT-0700 (Pacific Daylight Time)">14:40</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@nicolo-ribaudo:matrix.org">nicolo-ribaudo</span>&gt;</div></td><td class="msg-cell">Is it for implementation reasons?</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Tue Apr 09 2024 07:41:54 GMT-0700 (Pacific Daylight Time)">14:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</div></td><td class="msg-cell">it's laid out in the comment -- saves some codegen complexity</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Tue Apr 09 2024 07:42:36 GMT-0700 (Pacific Daylight Time)">14:42</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</div></td><td class="msg-cell">we can unroll the dispose loop in all cases except switch cases</td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Tue Apr 09 2024 07:44:25 GMT-0700 (Pacific Daylight Time)">14:44</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@nicolo-ribaudo:matrix.org">nicolo-ribaudo</span>&gt;</div></td><td class="msg-cell">I'm trying to think of any usecase for <code>using</code> in switch, but I cannot think of any where I would want <code>using</code>'s scope to fall through multiple cases</td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Tue Apr 09 2024 07:46:00 GMT-0700 (Pacific Daylight Time)">14:46</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@nicolo-ribaudo:matrix.org">nicolo-ribaudo</span>&gt;</div></td><td class="msg-cell">(Babel doesn't unroll the loop anymore, so for us it wouldn't actually be difficult to fix <code>using</code> in <code>switch</code>)</td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Tue Apr 09 2024 07:46:39 GMT-0700 (Pacific Daylight Time)">14:46</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</div></td><td class="msg-cell">we don't unroll currently, but would like to</td></tr>
  <tr class="msg" id="L17"><td class="ts-cell"><a class="ts" href="#L17" alt="Tue Apr 09 2024 07:50:26 GMT-0700 (Pacific Daylight Time)">14:50</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> I'm trying to think of any usecase for <code>using</code> in switch, but I cannot think of any where I would want <code>using</code>'s scope to fall through multiple cases</blockquote></mx-reply>The most relevant case I can see would be something like manual loop unrolling, where you skip over the <code>using</code> for a chunk of operations when it isn't needed, such as if a lock was needed for a 16k chunk of data that isn't needed for a smaller chunk of data. The point of manual loop unrolling is to avoid a bunch of comparisons and branches based on a single condition such as input size, so a smaller chunk of data skips over the <code>using</code> (and avoids the extraneous <code>null</code>/<code>undefined</code> check), while a larger chunk of data enforces the <code>using</code> and holds the lock until the current iteration of the loop ends.</td></tr>
  <tr class="msg" id="L18"><td class="ts-cell"><a class="ts" href="#L18" alt="Tue Apr 09 2024 07:52:52 GMT-0700 (Pacific Daylight Time)">14:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@nicolo-ribaudo:matrix.org">nicolo-ribaudo</span>&gt;</div></td><td class="msg-cell">Oh I see, like for transpiling generators</td></tr>
  <tr class="msg" id="L19"><td class="ts-cell"><a class="ts" href="#L19" alt="Tue Apr 09 2024 07:53:13 GMT-0700 (Pacific Daylight Time)">14:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@nicolo-ribaudo:matrix.org">nicolo-ribaudo</span>&gt;</div></td><td class="msg-cell">(in a world where generators are transpiled and <code>using</code> is not I guess)</td></tr>
  <tr class="msg" id="L20"><td class="ts-cell"><a class="ts" href="#L20" alt="Tue Apr 09 2024 07:53:51 GMT-0700 (Pacific Daylight Time)">14:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell"><pre><code class="language-js">for (let start = 0; start &lt; len; start += 8) {
    switch (start % 8) {
        case 0:
          // full chunk, perform lock
          using lck = new UniqueLock(mut);
          readByte();
        case 1: readByte();
        case 2: readByte();
        case 3: readByte();
        case 4: readByte();
        case 5: readByte();
        case 6: readByte();
        case 7: readByte();
    } // lock released if taken
}
</code></pre>
</td></tr>
  <tr class="msg" id="L21"><td class="ts-cell"><a class="ts" href="#L21" alt="Tue Apr 09 2024 07:56:40 GMT-0700 (Pacific Daylight Time)">14:56</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell">not for transpiling generators, no. that would be using a <code>switch</code> as a finite state machine, but an FSM would result in the <code>using</code> terminating early. Loop unrolling in this case is to handle chunks of data without continuously spinning and checking in the <code>for</code> to process one element at a time and cut down the number of comparisons/branching from n to 1/n for a given chunk size of n.</td></tr>
  <tr class="msg" id="L22"><td class="ts-cell"><a class="ts" href="#L22" alt="Tue Apr 09 2024 08:25:18 GMT-0700 (Pacific Daylight Time)">15:25</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@littledan:matrix.org">littledan</span>&gt;</div></td><td class="msg-cell">If we could get to Ashley's point, he can explain why TLA running eagerly is useful within Bloomberg</td></tr>
  <tr class="msg" id="L23"><td class="ts-cell"><a class="ts" href="#L23" alt="Tue Apr 09 2024 08:26:40 GMT-0700 (Pacific Daylight Time)">15:26</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@haxjs:matrix.org">hax (HE Shi-Jun)</span>&gt;</div></td><td class="msg-cell">tla already can break expectations...</td></tr>
  <tr class="msg" id="L24"><td class="ts-cell"><a class="ts" href="#L24" alt="Tue Apr 09 2024 08:29:10 GMT-0700 (Pacific Daylight Time)">15:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@ljharb:matrix.org">ljharb</span>&gt;</div></td><td class="msg-cell">certainly a TLA being added anywhere in your graph (that's not an entrpoint) is a breaking change</td></tr>
  <tr class="msg" id="L25"><td class="ts-cell"><a class="ts" href="#L25" alt="Tue Apr 09 2024 08:29:20 GMT-0700 (Pacific Daylight Time)">15:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@littledan:matrix.org">littledan</span>&gt;</div></td><td class="msg-cell">The thing is: in practice, you really shouldn't use JSON or CSS modules either, due to the lack of built-in bundling. The limited utility of built-in modules is not at all limited to this feature</td></tr>
  <tr class="msg" id="L26"><td class="ts-cell"><a class="ts" href="#L26" alt="Tue Apr 09 2024 08:29:46 GMT-0700 (Pacific Daylight Time)">15:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">this strongly suggests to me that we need a path to standardize bundler-only syntax</td></tr>
  <tr class="msg" id="L27"><td class="ts-cell"><a class="ts" href="#L27" alt="Tue Apr 09 2024 08:29:48 GMT-0700 (Pacific Daylight Time)">15:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@littledan:matrix.org">littledan</span>&gt;</div></td><td class="msg-cell">until then, we'll be talking about features that are mostly useful for bundlers and non-web environments</td></tr>
  <tr class="msg" id="L28"><td class="ts-cell"><a class="ts" href="#L28" alt="Tue Apr 09 2024 08:30:13 GMT-0700 (Pacific Daylight Time)">15:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@littledan:matrix.org">littledan</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> this strongly suggests to me that we need a path to standardize bundler-only syntax</blockquote></mx-reply>I disagree; I think we should fix the issues to allow native modules to be usable in browsers</td></tr>
  <tr class="msg" id="L29"><td class="ts-cell"><a class="ts" href="#L29" alt="Tue Apr 09 2024 08:30:27 GMT-0700 (Pacific Daylight Time)">15:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</div></td><td class="msg-cell">i disagree with that disagree</td></tr>
  <tr class="msg" id="L30"><td class="ts-cell"><a class="ts" href="#L30" alt="Tue Apr 09 2024 08:30:32 GMT-0700 (Pacific Daylight Time)">15:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</div></td><td class="msg-cell">doesn't seem a good use of resources tbh</td></tr>
  <tr class="msg" id="L31"><td class="ts-cell"><a class="ts" href="#L31" alt="Tue Apr 09 2024 08:31:06 GMT-0700 (Pacific Daylight Time)">15:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> I disagree; I think we should fix the issues to allow native modules to be usable in browsers</blockquote></mx-reply>That is also good! And then, after that, standardizing things like this everywhere instead of bundler-only. But not before that.</td></tr>
  <tr class="msg" id="L32"><td class="ts-cell"><a class="ts" href="#L32" alt="Tue Apr 09 2024 08:31:13 GMT-0700 (Pacific Daylight Time)">15:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@littledan:matrix.org">littledan</span>&gt;</div></td><td class="msg-cell">these are all arguments against ES6 modules in the first place</td></tr>
  <tr class="msg" id="L33"><td class="ts-cell"><a class="ts" href="#L33" alt="Tue Apr 09 2024 08:31:22 GMT-0700 (Pacific Daylight Time)">15:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell"><em>cough</em></td></tr>
  <tr class="msg" id="L34"><td class="ts-cell"><a class="ts" href="#L34" alt="Tue Apr 09 2024 08:31:31 GMT-0700 (Pacific Daylight Time)">15:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">I mean, yes.</td></tr>
  <tr class="msg" id="L35"><td class="ts-cell"><a class="ts" href="#L35" alt="Tue Apr 09 2024 08:31:36 GMT-0700 (Pacific Daylight Time)">15:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">But that ship has sailed.</td></tr>
  <tr class="msg" id="L36"><td class="ts-cell"><a class="ts" href="#L36" alt="Tue Apr 09 2024 08:31:45 GMT-0700 (Pacific Daylight Time)">15:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@ljharb:matrix.org">ljharb</span>&gt;</div></td><td class="msg-cell">you're soooo close</td></tr>
  <tr class="msg" id="L37"><td class="ts-cell"><a class="ts" href="#L37" alt="Tue Apr 09 2024 08:31:53 GMT-0700 (Pacific Daylight Time)">15:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell">bundler-related, but could <code>import defer</code> potentially avoid fetch and parse as well if we could serialize the import graph on the server side ahead of time?</td></tr>
  <tr class="msg" id="L38"><td class="ts-cell"><a class="ts" href="#L38" alt="Tue Apr 09 2024 08:32:03 GMT-0700 (Pacific Daylight Time)">15:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@haxjs:matrix.org">hax (HE Shi-Jun)</span>&gt;</div></td><td class="msg-cell">In Jack's "assert sync" proposal I suggest we can also add "use async" directive which might help to make TLA explicit. Maybe it also help this issue.</td></tr>
  <tr class="msg" id="L39"><td class="ts-cell"><a class="ts" href="#L39" alt="Tue Apr 09 2024 08:32:16 GMT-0700 (Pacific Daylight Time)">15:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@littledan:matrix.org">littledan</span>&gt;</div></td><td class="msg-cell">well, yeah, so this would be good input to the module harmony group, if we don't like modules features anymore...</td></tr>
  <tr class="msg" id="L40"><td class="ts-cell"><a class="ts" href="#L40" alt="Tue Apr 09 2024 08:32:19 GMT-0700 (Pacific Daylight Time)">15:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">I think standardizing ES6 modules as bundler-only syntax would have been better than the current world</td></tr>
  <tr class="msg" id="L41"><td class="ts-cell"><a class="ts" href="#L41" alt="Tue Apr 09 2024 08:32:33 GMT-0700 (Pacific Daylight Time)">15:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell">or is that not an option because fetch is async</td></tr>
  <tr class="msg" id="L42"><td class="ts-cell"><a class="ts" href="#L42" alt="Tue Apr 09 2024 08:33:28 GMT-0700 (Pacific Daylight Time)">15:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> well, yeah, so this would be good input to the module harmony group, if we don't like modules features anymore...</blockquote></mx-reply><code>import source</code> is useful on the web!</td></tr>
  <tr class="msg" id="L43"><td class="ts-cell"><a class="ts" href="#L43" alt="Tue Apr 09 2024 08:33:45 GMT-0700 (Pacific Daylight Time)">15:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">so it's not "module features" in general, just those specific ones which aren't useful on the web</td></tr>
  <tr class="msg" id="L44"><td class="ts-cell"><a class="ts" href="#L44" alt="Tue Apr 09 2024 08:34:11 GMT-0700 (Pacific Daylight Time)">15:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-1" title="@jridgewell:matrix.org">Justin Ridgewell</span>&gt;</div></td><td class="msg-cell">/me Taking over Chair responsibilities for a bit</td></tr>
  <tr class="msg" id="L45"><td class="ts-cell"><a class="ts" href="#L45" alt="Tue Apr 09 2024 08:34:12 GMT-0700 (Pacific Daylight Time)">15:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">(possibly "[...] aren't useful on the web <em>yet</em>")</td></tr>
  <tr class="msg" id="L46"><td class="ts-cell"><a class="ts" href="#L46" alt="Tue Apr 09 2024 08:34:29 GMT-0700 (Pacific Daylight Time)">15:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@littledan:matrix.org">littledan</span>&gt;</div></td><td class="msg-cell">I think the Matrix results show that it's useful on the web <em>in practice</em></td></tr>
  <tr class="msg" id="L47"><td class="ts-cell"><a class="ts" href="#L47" alt="Tue Apr 09 2024 08:34:53 GMT-0700 (Pacific Daylight Time)">15:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@littledan:matrix.org">littledan</span>&gt;</div></td><td class="msg-cell">It's a good thing that bundlers are aligned to TC39 and browsers in their syntax and semantics. It will be good for us to preserve that.</td></tr>
  <tr class="msg" id="L48"><td class="ts-cell"><a class="ts" href="#L48" alt="Tue Apr 09 2024 08:35:07 GMT-0700 (Pacific Daylight Time)">15:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@aclaymore:matrix.org">Ashley Claymore</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> bundler-related, but could <code>import defer</code> potentially avoid fetch and parse as well if we could serialize the import graph on the server side ahead of time?</blockquote></mx-reply>yep. That's what we do at Bloomberg. We find the TLA at build time. And add a simplified module graph of which imports have TLA deps to our equivalent of 'package.json'</td></tr>
  <tr class="msg" id="L49"><td class="ts-cell"><a class="ts" href="#L49" alt="Tue Apr 09 2024 08:35:09 GMT-0700 (Pacific Daylight Time)">15:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">IIUC the Matrix results show that it's useful on the web to have bundler-level syntax for this, but not that it's useful to have in browsers, right?</td></tr>
  <tr class="msg" id="L50"><td class="ts-cell"><a class="ts" href="#L50" alt="Tue Apr 09 2024 08:35:22 GMT-0700 (Pacific Daylight Time)">15:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@littledan:matrix.org">littledan</span>&gt;</div></td><td class="msg-cell">we've made tons of progress by actually building things into JS; the code splitting situation was a mess before import(), and it resulted in code splitting not occurring.</td></tr>
  <tr class="msg" id="L51"><td class="ts-cell"><a class="ts" href="#L51" alt="Tue Apr 09 2024 08:35:30 GMT-0700 (Pacific Daylight Time)">15:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">I am not proposing "give up on this"; I am proposing "have a path to standardize bundler-level syntax that isn't actually in browsers"</td></tr>
  <tr class="msg" id="L52"><td class="ts-cell"><a class="ts" href="#L52" alt="Tue Apr 09 2024 08:35:40 GMT-0700 (Pacific Daylight Time)">15:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@littledan:matrix.org">littledan</span>&gt;</div></td><td class="msg-cell">TC39 is the JavaScript standards committee--our role is to find this common syntax</td></tr>
  <tr class="msg" id="L53"><td class="ts-cell"><a class="ts" href="#L53" alt="Tue Apr 09 2024 08:36:27 GMT-0700 (Pacific Daylight Time)">15:36</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@littledan:matrix.org">littledan</span>&gt;</div></td><td class="msg-cell">once we find common syntax, it's OK if some implementations fall behind and don't implement everything, but it'd be a big cost to split the language in two</td></tr>
  <tr class="msg" id="L54"><td class="ts-cell"><a class="ts" href="#L54" alt="Tue Apr 09 2024 08:36:33 GMT-0700 (Pacific Daylight Time)">15:36</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">my response is the thing Shu is saying out loud right now</td></tr>
  <tr class="msg" id="L55"><td class="ts-cell"><a class="ts" href="#L55" alt="Tue Apr 09 2024 08:36:54 GMT-0700 (Pacific Daylight Time)">15:36</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@littledan:matrix.org">littledan</span>&gt;</div></td><td class="msg-cell">we should have this as an actual agenda item; that'd make it easier to discuss</td></tr>
  <tr class="msg" id="L56"><td class="ts-cell"><a class="ts" href="#L56" alt="Tue Apr 09 2024 08:39:05 GMT-0700 (Pacific Daylight Time)">15:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@littledan:matrix.org">littledan</span>&gt;</div></td><td class="msg-cell">IMO Stage 3 serves this purpose of "it's in tools and not necessarily in browsers". Maybe we just want to leave things in Stage 3 for longer.</td></tr>
  <tr class="msg" id="L57"><td class="ts-cell"><a class="ts" href="#L57" alt="Tue Apr 09 2024 08:39:36 GMT-0700 (Pacific Daylight Time)">15:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">fwiw eslint refuses to implement features prior to stage 4, though that's maybe a them problem</td></tr>
  <tr class="msg" id="L58"><td class="ts-cell"><a class="ts" href="#L58" alt="Tue Apr 09 2024 08:41:07 GMT-0700 (Pacific Daylight Time)">15:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@ljharb:matrix.org">ljharb</span>&gt;</div></td><td class="msg-cell">stage 3 is when it gets shipped in (most) browsers tho</td></tr>
  <tr class="msg" id="L59"><td class="ts-cell"><a class="ts" href="#L59" alt="Tue Apr 09 2024 08:42:48 GMT-0700 (Pacific Daylight Time)">15:42</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</div></td><td class="msg-cell"><span class="nick-7">John-David Dalton</span>: why is it disingenuous? this is arguably <em>better</em> handled by tools. tools have a different view (they can see the whole app) and optimization opportunities than a VM</td></tr>
  <tr class="msg" id="L60"><td class="ts-cell"><a class="ts" href="#L60" alt="Tue Apr 09 2024 08:43:14 GMT-0700 (Pacific Daylight Time)">15:43</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</div></td><td class="msg-cell">we designed a super static module system. it is not surprising to me that it has been leveraged to success with ahead-of-time tooling</td></tr>
  <tr class="msg" id="L61"><td class="ts-cell"><a class="ts" href="#L61" alt="Tue Apr 09 2024 08:44:10 GMT-0700 (Pacific Daylight Time)">15:44</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@littledan:matrix.org">littledan</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> fwiw eslint refuses to implement features prior to stage 4, though that's maybe a them problem</blockquote></mx-reply>well, there's babel-eslint</td></tr>
  <tr class="msg" id="L62"><td class="ts-cell"><a class="ts" href="#L62" alt="Tue Apr 09 2024 08:46:23 GMT-0700 (Pacific Daylight Time)">15:46</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@ljharb:matrix.org">ljharb</span>&gt;</div></td><td class="msg-cell">(<code>@babel/eslint-parser</code> as of babel 7)</td></tr>
  <tr class="msg" id="L63"><td class="ts-cell"><a class="ts" href="#L63" alt="Tue Apr 09 2024 08:47:03 GMT-0700 (Pacific Daylight Time)">15:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@littledan:matrix.org">littledan</span>&gt;</div></td><td class="msg-cell">I'd be happiest if browsers ship features like this at that point, but if they want to leave some features out of browsers for now (but we still assess that the feature is solid enough for Stage 3), maybe they can just let them sit in that bucket. Doesn't require holding back 2.7 or 3.</td></tr>
  <tr class="msg" id="L64"><td class="ts-cell"><a class="ts" href="#L64" alt="Tue Apr 09 2024 08:47:33 GMT-0700 (Pacific Daylight Time)">15:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@ljharb:matrix.org">ljharb</span>&gt;</div></td><td class="msg-cell">3 is a pretty clear signal, that's the big purpose of 2.7. i agree it wouldn't require holding back 2.7</td></tr>
  <tr class="msg" id="L65"><td class="ts-cell"><a class="ts" href="#L65" alt="Tue Apr 09 2024 08:48:23 GMT-0700 (Pacific Daylight Time)">15:48</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@michaelficarra:matrix.org">Michael Ficarra</span>&gt;</div></td><td class="msg-cell">so is this feature going to encourage the dreaded "barrel" module pattern?</td></tr>
  <tr class="msg" id="L66"><td class="ts-cell"><a class="ts" href="#L66" alt="Tue Apr 09 2024 08:48:36 GMT-0700 (Pacific Daylight Time)">15:48</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@littledan:matrix.org">littledan</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> so is this feature going to encourage the dreaded "barrel" module pattern?</blockquote></mx-reply>it's about optimizing the feature--no encouragement is needed</td></tr>
  <tr class="msg" id="L67"><td class="ts-cell"><a class="ts" href="#L67" alt="Tue Apr 09 2024 08:48:44 GMT-0700 (Pacific Daylight Time)">15:48</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">While that's technically true, I would be happier revising our process if we want to do that - I would prefer that stage 2.7/3 be taken as a commitment from browsers to implement a feature at some point. I don't want to get to a point where browsers allow features to reach 2.7 that they intend to never implement.</td></tr>
  <tr class="msg" id="L68"><td class="ts-cell"><a class="ts" href="#L68" alt="Tue Apr 09 2024 08:49:04 GMT-0700 (Pacific Daylight Time)">15:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</div></td><td class="msg-cell">agree</td></tr>
  <tr class="msg" id="L69"><td class="ts-cell"><a class="ts" href="#L69" alt="Tue Apr 09 2024 08:49:09 GMT-0700 (Pacific Daylight Time)">15:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</div></td><td class="msg-cell">the two design spaces are honestly different</td></tr>
  <tr class="msg" id="L70"><td class="ts-cell"><a class="ts" href="#L70" alt="Tue Apr 09 2024 08:49:14 GMT-0700 (Pacific Daylight Time)">15:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</div></td><td class="msg-cell">the constraints are different</td></tr>
  <tr class="msg" id="L71"><td class="ts-cell"><a class="ts" href="#L71" alt="Tue Apr 09 2024 08:49:17 GMT-0700 (Pacific Daylight Time)">15:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@ljharb:matrix.org">ljharb</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> so is this feature going to encourage the dreaded "barrel" module pattern?</blockquote></mx-reply>oof, i hadn't thought about that.</td></tr>
  <tr class="msg" id="L72"><td class="ts-cell"><a class="ts" href="#L72" alt="Tue Apr 09 2024 08:49:29 GMT-0700 (Pacific Daylight Time)">15:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@littledan:matrix.org">littledan</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> While that's technically true, I would be happier revising our process if we want to do that - I would prefer that stage 2.7/3 be taken as a commitment from browsers to implement a feature at some point. I don't want to get to a point where browsers allow features to reach 2.7 that they intend to never implement.</blockquote></mx-reply>ah OK well I'm happy to get browser commitments like that; I don't want to discourage that. I haven't thought this through enough.</td></tr>
  <tr class="msg" id="L73"><td class="ts-cell"><a class="ts" href="#L73" alt="Tue Apr 09 2024 08:49:54 GMT-0700 (Pacific Daylight Time)">15:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@michaelficarra:matrix.org">Michael Ficarra</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote>it's about optimizing the feature--no encouragement is needed</blockquote></mx-reply>well it doesn't provide any benefit to those not using the pattern, so it seems like encouragement to use it</td></tr>
  <tr class="msg" id="L74"><td class="ts-cell"><a class="ts" href="#L74" alt="Tue Apr 09 2024 08:50:06 GMT-0700 (Pacific Daylight Time)">15:50</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</div></td><td class="msg-cell"><span class="nick-10">littledan</span>: i have been thinking about for most of this year, i'll give you something more thought out soon</td></tr>
  <tr class="msg" id="L75"><td class="ts-cell"><a class="ts" href="#L75" alt="Tue Apr 09 2024 08:51:05 GMT-0700 (Pacific Daylight Time)">15:51</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@littledan:matrix.org">littledan</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> well it doesn't provide any benefit to those not using the pattern, so it seems like encouragement to use it</blockquote></mx-reply>I think you're overthinking it... there's a lot of existing usages of this pattern, and it's slow, and it is hard to migrate away from (a lot of effort has gone into this migration)</td></tr>
  <tr class="msg" id="L76"><td class="ts-cell"><a class="ts" href="#L76" alt="Tue Apr 09 2024 08:51:20 GMT-0700 (Pacific Daylight Time)">15:51</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@littledan:matrix.org">littledan</span>&gt;</div></td><td class="msg-cell">it's not about newly incentivizing usage</td></tr>
  <tr class="msg" id="L77"><td class="ts-cell"><a class="ts" href="#L77" alt="Tue Apr 09 2024 08:51:54 GMT-0700 (Pacific Daylight Time)">15:51</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@michaelficarra:matrix.org">Michael Ficarra</span>&gt;</div></td><td class="msg-cell">so someone who wants to get similar tree-shakeability can just dump this pattern?</td></tr>
  <tr class="msg" id="L78"><td class="ts-cell"><a class="ts" href="#L78" alt="Tue Apr 09 2024 08:52:24 GMT-0700 (Pacific Daylight Time)">15:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@littledan:matrix.org">littledan</span>&gt;</div></td><td class="msg-cell">sure, if you can get all your dependencies to dump this pattern, then you'll have no reason to use this feature in your dependency tree</td></tr>
  <tr class="msg" id="L79"><td class="ts-cell"><a class="ts" href="#L79" alt="Tue Apr 09 2024 08:52:59 GMT-0700 (Pacific Daylight Time)">15:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@ljharb:matrix.org">ljharb</span>&gt;</div></td><td class="msg-cell">there's a growing group of vocal folks in the ecosystem telling people to get rid of barrel modules, fwiw</td></tr>
  <tr class="msg" id="L80"><td class="ts-cell"><a class="ts" href="#L80" alt="Tue Apr 09 2024 08:53:18 GMT-0700 (Pacific Daylight Time)">15:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@ljharb:matrix.org">ljharb</span>&gt;</div></td><td class="msg-cell">(coinbase's RN app's binary size dropped 71% when we/they banned barrel exports back in 2021)</td></tr>
  <tr class="msg" id="L81"><td class="ts-cell"><a class="ts" href="#L81" alt="Tue Apr 09 2024 08:53:52 GMT-0700 (Pacific Daylight Time)">15:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@littledan:matrix.org">littledan</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> there's a growing group of vocal folks in the ecosystem telling people to get rid of barrel modules, fwiw</blockquote></mx-reply>yes, they're doing good work; I think those two groups (the ecosystem effort and this proposal) should be understood to be supporting each other</td></tr>
  <tr class="msg" id="L82"><td class="ts-cell"><a class="ts" href="#L82" alt="Tue Apr 09 2024 08:54:42 GMT-0700 (Pacific Daylight Time)">15:54</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@ljharb:matrix.org">ljharb</span>&gt;</div></td><td class="msg-cell">even with import defer, barrel exports will still result in a larger app than "just import what you need directly", no?</td></tr>
  <tr class="msg" id="L83"><td class="ts-cell"><a class="ts" href="#L83" alt="Tue Apr 09 2024 08:54:53 GMT-0700 (Pacific Daylight Time)">15:54</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">I don't think "this feature is not useful in browsers" is a new category of objection?</td></tr>
  <tr class="msg" id="L84"><td class="ts-cell"><a class="ts" href="#L84" alt="Tue Apr 09 2024 08:54:57 GMT-0700 (Pacific Daylight Time)">15:54</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">that's like... the main objection</td></tr>
  <tr class="msg" id="L85"><td class="ts-cell"><a class="ts" href="#L85" alt="Tue Apr 09 2024 08:55:03 GMT-0700 (Pacific Daylight Time)">15:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@michaelficarra:matrix.org">Michael Ficarra</span>&gt;</div></td><td class="msg-cell">can someone remind me why people ever did that in the first place?</td></tr>
  <tr class="msg" id="L86"><td class="ts-cell"><a class="ts" href="#L86" alt="Tue Apr 09 2024 08:55:23 GMT-0700 (Pacific Daylight Time)">15:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@ljharb:matrix.org">ljharb</span>&gt;</div></td><td class="msg-cell">i don't know why people tend to like "god objects", deep imports is The Way. but they do tend to like them.</td></tr>
  <tr class="msg" id="L87"><td class="ts-cell"><a class="ts" href="#L87" alt="Tue Apr 09 2024 08:56:02 GMT-0700 (Pacific Daylight Time)">15:56</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@pchimento:igalia.com">ptomato</span>&gt;</div></td><td class="msg-cell">maybe the pattern was copied from python modules and <code>__init__.py</code>?</td></tr>
  <tr class="msg" id="L88"><td class="ts-cell"><a class="ts" href="#L88" alt="Tue Apr 09 2024 08:56:08 GMT-0700 (Pacific Daylight Time)">15:56</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@littledan:matrix.org">littledan</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> can someone remind me why people ever did that in the first place?</blockquote></mx-reply>I always understood it to be a response to named exports being a thing, making use of that syntactic space, whereas require returning a single function was more natural</td></tr>
  <tr class="msg" id="L89"><td class="ts-cell"><a class="ts" href="#L89" alt="Tue Apr 09 2024 08:56:16 GMT-0700 (Pacific Daylight Time)">15:56</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@ljharb:matrix.org">ljharb</span>&gt;</div></td><td class="msg-cell">i've seen people have a visceral preference for one <code>import</code> keyword that has N identifiers, instead of N <code>import</code> keywords</td></tr>
  <tr class="msg" id="L90"><td class="ts-cell"><a class="ts" href="#L90" alt="Tue Apr 09 2024 08:56:44 GMT-0700 (Pacific Daylight Time)">15:56</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> that's like... the main objection</blockquote></mx-reply>yeah i feel like most of our concerns that have caused feature compromises and redesigns boil down to this. sometimes it's couched in more specific terms, like "performance footgun" etc</td></tr>
  <tr class="msg" id="L91"><td class="ts-cell"><a class="ts" href="#L91" alt="Tue Apr 09 2024 08:56:59 GMT-0700 (Pacific Daylight Time)">15:56</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@michaelficarra:matrix.org">Michael Ficarra</span>&gt;</div></td><td class="msg-cell">I'm finding it very hard to find sympathy for these people...</td></tr>
  <tr class="msg" id="L92"><td class="ts-cell"><a class="ts" href="#L92" alt="Tue Apr 09 2024 08:57:00 GMT-0700 (Pacific Daylight Time)">15:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@ljharb:matrix.org">ljharb</span>&gt;</div></td><td class="msg-cell">also i think that a number of major IDEs implemented auto-refactoring features for named exports but ignored default exports (for no technical reason) which drove increased usage of named exports</td></tr>
  <tr class="msg" id="L93"><td class="ts-cell"><a class="ts" href="#L93" alt="Tue Apr 09 2024 08:57:26 GMT-0700 (Pacific Daylight Time)">15:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@littledan:matrix.org">littledan</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> I'm finding it very hard to find sympathy for these people...</blockquote></mx-reply>why does it matter whose fault this is? it's currently a performance issue, and this is a solution.</td></tr>
  <tr class="msg" id="L94"><td class="ts-cell"><a class="ts" href="#L94" alt="Tue Apr 09 2024 08:58:01 GMT-0700 (Pacific Daylight Time)">15:58</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@ljharb:matrix.org">ljharb</span>&gt;</div></td><td class="msg-cell">but is "don't use barrel files" perhaps a better solution? (genuine question)</td></tr>
  <tr class="msg" id="L95"><td class="ts-cell"><a class="ts" href="#L95" alt="Tue Apr 09 2024 08:58:53 GMT-0700 (Pacific Daylight Time)">15:58</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-1" title="@jridgewell:matrix.org">Justin Ridgewell</span>&gt;</div></td><td class="msg-cell">Barrels are so convenient, and so awful for performance (both browsers and bundlers)</td></tr>
  <tr class="msg" id="L96"><td class="ts-cell"><a class="ts" href="#L96" alt="Tue Apr 09 2024 08:58:56 GMT-0700 (Pacific Daylight Time)">15:58</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@littledan:matrix.org">littledan</span>&gt;</div></td><td class="msg-cell">I dunno, there's a lot of recommendations about performance that people aren't taking up...</td></tr>
  <tr class="msg" id="L97"><td class="ts-cell"><a class="ts" href="#L97" alt="Tue Apr 09 2024 08:59:24 GMT-0700 (Pacific Daylight Time)">15:59</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-1" title="@jridgewell:matrix.org">Justin Ridgewell</span>&gt;</div></td><td class="msg-cell"><a href="https://matrix.to/#/%40guybedford%3Amatrix.org">@guybedford</a> Your mic is echoing</td></tr>
  <tr class="msg" id="L98"><td class="ts-cell"><a class="ts" href="#L98" alt="Tue Apr 09 2024 08:59:47 GMT-0700 (Pacific Daylight Time)">15:59</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">but wouldn't this be a recommendation for performance in exactly the same way? it requires work to adopt; it doesn't just give you performance for free</td></tr>
  <tr class="msg" id="L99"><td class="ts-cell"><a class="ts" href="#L99" alt="Tue Apr 09 2024 08:59:59 GMT-0700 (Pacific Daylight Time)">15:59</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@usharma:igalia.com">ryzokuken</span>&gt;</div></td><td class="msg-cell">sorry <span class="nick-2">guybedford</span> bad timing</td></tr>
  <tr class="msg" id="L100"><td class="ts-cell"><a class="ts" href="#L100" alt="Tue Apr 09 2024 09:00:06 GMT-0700 (Pacific Daylight Time)">16:00</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-1" title="@jridgewell:matrix.org">Justin Ridgewell</span>&gt;</div></td><td class="msg-cell">Timebox!</td></tr>
  <tr class="msg" id="L101"><td class="ts-cell"><a class="ts" href="#L101" alt="Tue Apr 09 2024 09:00:09 GMT-0700 (Pacific Daylight Time)">16:00</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">and if the people in question were willing to do work to get performance they already can already do so, right?</td></tr>
  <tr class="msg" id="L102"><td class="ts-cell"><a class="ts" href="#L102" alt="Tue Apr 09 2024 09:01:13 GMT-0700 (Pacific Daylight Time)">16:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@michaelficarra:matrix.org">Michael Ficarra</span>&gt;</div></td><td class="msg-cell"><a href="https://matrix.to/#/%40nicolo-ribaudo%3Amatrix.org">@nicolo-ribaudo</a> your async feedback from me is that, for now, I'm unconvinced by the motivation</td></tr>
  <tr class="msg" id="L103"><td class="ts-cell"><a class="ts" href="#L103" alt="Tue Apr 09 2024 09:01:30 GMT-0700 (Pacific Daylight Time)">16:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@ljharb:matrix.org">ljharb</span>&gt;</div></td><td class="msg-cell">convenience often makes for better road-paving than good intentions</td></tr>
  <tr class="msg" id="L104"><td class="ts-cell"><a class="ts" href="#L104" alt="Tue Apr 09 2024 09:01:48 GMT-0700 (Pacific Daylight Time)">16:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@littledan:matrix.org">littledan</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> but wouldn't this be a recommendation for performance in exactly the same way? it requires work to adopt; it doesn't just give you performance for free</blockquote></mx-reply>The uptake is a "semver-minor" change--it doesn't require that importers update</td></tr>
  <tr class="msg" id="L105"><td class="ts-cell"><a class="ts" href="#L105" alt="Tue Apr 09 2024 09:03:04 GMT-0700 (Pacific Daylight Time)">16:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@ljharb:matrix.org">ljharb</span>&gt;</div></td><td class="msg-cell">so importers keep thinking they're doing a fine thing, when they're doing a horrible thing, and the entire ecosystem has to move to <code>import defer</code> to avoid the education problem?</td></tr>
  <tr class="msg" id="L106"><td class="ts-cell"><a class="ts" href="#L106" alt="Tue Apr 09 2024 09:03:41 GMT-0700 (Pacific Daylight Time)">16:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@ljharb:matrix.org">ljharb</span>&gt;</div></td><td class="msg-cell">education's super hard so maybe that's the right tradeoff to make, tbf</td></tr>
  <tr class="msg" id="L107"><td class="ts-cell"><a class="ts" href="#L107" alt="Tue Apr 09 2024 09:10:02 GMT-0700 (Pacific Daylight Time)">16:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@nicolo-ribaudo:matrix.org">nicolo-ribaudo</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> but wouldn't this be a recommendation for performance in exactly the same way? it requires work to adopt; it doesn't just give you performance for free</blockquote></mx-reply>It moves the changes from the consumers to the library itself</td></tr>
  <tr class="msg" id="L108"><td class="ts-cell"><a class="ts" href="#L108" alt="Tue Apr 09 2024 09:10:08 GMT-0700 (Pacific Daylight Time)">16:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@nicolo-ribaudo:matrix.org">nicolo-ribaudo</span>&gt;</div></td><td class="msg-cell">So 1 instead of N</td></tr>
  <tr class="msg" id="L109"><td class="ts-cell"><a class="ts" href="#L109" alt="Tue Apr 09 2024 09:10:47 GMT-0700 (Pacific Daylight Time)">16:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@nicolo-ribaudo:matrix.org">nicolo-ribaudo</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> so importers keep thinking they're doing a fine thing, when they're doing a horrible thing, and the entire ecosystem has to move to <code>import defer</code> to avoid the education problem?</blockquote></mx-reply>There is currently a choice to make between convenience and performance, and the goal here is to not make them exclusive</td></tr>
  <tr class="msg" id="L110"><td class="ts-cell"><a class="ts" href="#L110" alt="Tue Apr 09 2024 09:43:07 GMT-0700 (Pacific Daylight Time)">16:43</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@ljharb:matrix.org">ljharb</span>&gt;</div></td><td class="msg-cell">does using <code>import defer</code> on a barrel file with a bundler that supports it give the ~same results as using deep imports in the first place? because treeshaking so far still doesn't fully achieve "only importing what you need in the first place" afaik.</td></tr>
  <tr class="msg" id="L111"><td class="ts-cell"><a class="ts" href="#L111" alt="Tue Apr 09 2024 09:46:05 GMT-0700 (Pacific Daylight Time)">16:46</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@michaelficarra:matrix.org">Michael Ficarra</span>&gt;</div></td><td class="msg-cell">in a language without so many hidden effects all over the place, it would be</td></tr>
  <tr class="msg" id="L112"><td class="ts-cell"><a class="ts" href="#L112" alt="Tue Apr 09 2024 09:49:25 GMT-0700 (Pacific Daylight Time)">16:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@nicolo-ribaudo:matrix.org">nicolo-ribaudo</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> does using <code>import defer</code> on a barrel file with a bundler that supports it give the ~same results as using deep imports in the first place? because treeshaking so far still doesn't fully achieve "only importing what you need in the first place" afaik.</blockquote></mx-reply>Sorry no, it's <code>export defer</code>/<code>export optional</code> that helps with barrel files</td></tr>
  <tr class="msg" id="L113"><td class="ts-cell"><a class="ts" href="#L113" alt="Tue Apr 09 2024 09:49:50 GMT-0700 (Pacific Daylight Time)">16:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@nicolo-ribaudo:matrix.org">nicolo-ribaudo</span>&gt;</div></td><td class="msg-cell">And <code>export defer</code> would have the same result as using deep imports</td></tr>
  <tr class="msg" id="L114"><td class="ts-cell"><a class="ts" href="#L114" alt="Tue Apr 09 2024 09:50:02 GMT-0700 (Pacific Daylight Time)">16:50</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@ljharb:matrix.org">ljharb</span>&gt;</div></td><td class="msg-cell">ok, so that's a compelling argument in favor of that one</td></tr>
  <tr class="msg" id="L115"><td class="ts-cell"><a class="ts" href="#L115" alt="Tue Apr 09 2024 09:51:34 GMT-0700 (Pacific Daylight Time)">16:51</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@ljharb:matrix.org">ljharb</span>&gt;</div></td><td class="msg-cell">so <code>import defer</code> would be to lessen the downside of importing a barrel file that did not use <code>export defer</code>?</td></tr>
  <tr class="msg" id="L116"><td class="ts-cell"><a class="ts" href="#L116" alt="Tue Apr 09 2024 09:52:04 GMT-0700 (Pacific Daylight Time)">16:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@nicolo-ribaudo:matrix.org">nicolo-ribaudo</span>&gt;</div></td><td class="msg-cell"><p>And the boundary is still at the <code>export defer</code> level, so if you do</p>
<pre><code class="language-js">// main.js
import { x } from "library";

// library
export defer { x, y } from "./x-and-y";
export defer { z } from "./z";

// library/x-and-y
export const x = 1;
export const y = 2;
</code></pre>
<p>it will also load/run the code for <code>const y = 2</code> (so it's not complete dead code elimination), but gives the building block to remove code if you put unrelated code in separate modules</p>
</td></tr>
  <tr class="msg" id="L117"><td class="ts-cell"><a class="ts" href="#L117" alt="Tue Apr 09 2024 09:52:55 GMT-0700 (Pacific Daylight Time)">16:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@nicolo-ribaudo:matrix.org">nicolo-ribaudo</span>&gt;</div></td><td class="msg-cell">Exactly like deep imports</td></tr>
  <tr class="msg" id="L118"><td class="ts-cell"><a class="ts" href="#L118" alt="Tue Apr 09 2024 09:53:14 GMT-0700 (Pacific Daylight Time)">16:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@nicolo-ribaudo:matrix.org">nicolo-ribaudo</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> so <code>import defer</code> would be to lessen the downside of importing a barrel file that did not use <code>export defer</code>?</blockquote></mx-reply><code>import defer</code> is not really related to barrel file</td></tr>
  <tr class="msg" id="L119"><td class="ts-cell"><a class="ts" href="#L119" alt="Tue Apr 09 2024 09:53:28 GMT-0700 (Pacific Daylight Time)">16:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@nicolo-ribaudo:matrix.org">nicolo-ribaudo</span>&gt;</div></td><td class="msg-cell">It's in general for "big modules subgraphs"</td></tr>
  <tr class="msg" id="L120"><td class="ts-cell"><a class="ts" href="#L120" alt="Tue Apr 09 2024 09:53:40 GMT-0700 (Pacific Daylight Time)">16:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@nicolo-ribaudo:matrix.org">nicolo-ribaudo</span>&gt;</div></td><td class="msg-cell">Even if you have a file with a single export but many dependencies, <code>import defer</code> is useful there</td></tr>
  <tr class="msg" id="L121"><td class="ts-cell"><a class="ts" href="#L121" alt="Tue Apr 09 2024 09:54:00 GMT-0700 (Pacific Daylight Time)">16:54</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@littledan:matrix.org">littledan</span>&gt;</div></td><td class="msg-cell">One thing that's important to understand is, the barrel file stuff doesn't relate to the motivation for <code>import defer</code>--they solve for totally unrelated issues, just both about loading less code</td></tr>
  <tr class="msg" id="L122"><td class="ts-cell"><a class="ts" href="#L122" alt="Tue Apr 09 2024 10:14:46 GMT-0700 (Pacific Daylight Time)">17:14</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@littledan:matrix.org">littledan</span>&gt;</div></td><td class="msg-cell"><del>Agree with the various arguments for minimalism here, we just don't have any reason to go into this fractional stuff or BigInts, and IsSafeInteger is a good test.</del> I don't have a strong opinion about any of this and am just happy for range to happen</td></tr>
  <tr class="msg" id="L123"><td class="ts-cell"><a class="ts" href="#L123" alt="Tue Apr 09 2024 10:16:38 GMT-0700 (Pacific Daylight Time)">17:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@michaelficarra:matrix.org">Michael Ficarra</span>&gt;</div></td><td class="msg-cell">I agree with Kevin that this isn't especially confusing</td></tr>
  <tr class="msg" id="L124"><td class="ts-cell"><a class="ts" href="#L124" alt="Tue Apr 09 2024 10:18:06 GMT-0700 (Pacific Daylight Time)">17:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@michaelficarra:matrix.org">Michael Ficarra</span>&gt;</div></td><td class="msg-cell">is there maybe justification to have this produce its own iterator subclass that can have optimised helpers implemented on it?</td></tr>
  <tr class="msg" id="L125"><td class="ts-cell"><a class="ts" href="#L125" alt="Tue Apr 09 2024 10:18:33 GMT-0700 (Pacific Daylight Time)">17:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@michaelficarra:matrix.org">Michael Ficarra</span>&gt;</div></td><td class="msg-cell">like <code data-md="`">.drop(1e300)</code> could be implemented very efficiently for this special iterator</td></tr>
  <tr class="msg" id="L126"><td class="ts-cell"><a class="ts" href="#L126" alt="Tue Apr 09 2024 10:19:07 GMT-0700 (Pacific Daylight Time)">17:19</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">I think <code>drop</code> and <code>take</code> are the only things which could have better implementations and I don't think it's worth doing just for those</td></tr>
  <tr class="msg" id="L127"><td class="ts-cell"><a class="ts" href="#L127" alt="Tue Apr 09 2024 10:19:38 GMT-0700 (Pacific Daylight Time)">17:19</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">and engines could do this optimization anyway</td></tr>
  <tr class="msg" id="L128"><td class="ts-cell"><a class="ts" href="#L128" alt="Tue Apr 09 2024 10:20:16 GMT-0700 (Pacific Daylight Time)">17:20</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@haxjs:matrix.org">hax (HE Shi-Jun)</span>&gt;</div></td><td class="msg-cell">The original proposal includes <code>BigInt.range()</code>, don't remember why it is added in first place</td></tr>
  <tr class="msg" id="L129"><td class="ts-cell"><a class="ts" href="#L129" alt="Tue Apr 09 2024 10:20:25 GMT-0700 (Pacific Daylight Time)">17:20</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@bradfordcsmith:matrix.org">Bradford Smith</span>&gt;</div></td><td class="msg-cell">I might expect to be able to use <code>Iterator.range()</code> to generate unique identifiers, in which case possibly a BigInt type is desirable.</td></tr>
  <tr class="msg" id="L130"><td class="ts-cell"><a class="ts" href="#L130" alt="Tue Apr 09 2024 10:21:10 GMT-0700 (Pacific Daylight Time)">17:21</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@haxjs:matrix.org">hax (HE Shi-Jun)</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> I might expect to be able to use <code>Iterator.range()</code> to generate unique identifiers, in which case possibly a BigInt type is desirable.</blockquote></mx-reply>seems a valid use case :P</td></tr>
  <tr class="msg" id="L131"><td class="ts-cell"><a class="ts" href="#L131" alt="Tue Apr 09 2024 10:21:11 GMT-0700 (Pacific Daylight Time)">17:21</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@michaelficarra:matrix.org">Michael Ficarra</span>&gt;</div></td><td class="msg-cell">to waldemar's point, yes, there are some editorial bugs, but nothing that's not fixable</td></tr>
  <tr class="msg" id="L132"><td class="ts-cell"><a class="ts" href="#L132" alt="Tue Apr 09 2024 10:21:21 GMT-0700 (Pacific Daylight Time)">17:21</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@michaelficarra:matrix.org">Michael Ficarra</span>&gt;</div></td><td class="msg-cell">it hasn't passed editorial review yet</td></tr>
  <tr class="msg" id="L133"><td class="ts-cell"><a class="ts" href="#L133" alt="Tue Apr 09 2024 10:21:35 GMT-0700 (Pacific Daylight Time)">17:21</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> I might expect to be able to use <code>Iterator.range()</code> to generate unique identifiers, in which case possibly a BigInt type is desirable.</blockquote></mx-reply>oh yeah?</td></tr>
  <tr class="msg" id="L134"><td class="ts-cell"><a class="ts" href="#L134" alt="Tue Apr 09 2024 10:21:56 GMT-0700 (Pacific Daylight Time)">17:21</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</div></td><td class="msg-cell">like, give me monotonic ids starting with &lt;large number&gt; or something?</td></tr>
  <tr class="msg" id="L135"><td class="ts-cell"><a class="ts" href="#L135" alt="Tue Apr 09 2024 10:22:19 GMT-0700 (Pacific Daylight Time)">17:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@ljharb:matrix.org">ljharb</span>&gt;</div></td><td class="msg-cell">i have no bigint range use cases, but "works for one kind of numeric primitive and not the others" seems like a big problem</td></tr>
  <tr class="msg" id="L136"><td class="ts-cell"><a class="ts" href="#L136" alt="Tue Apr 09 2024 10:22:55 GMT-0700 (Pacific Daylight Time)">17:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@bradfordcsmith:matrix.org">Bradford Smith</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> like, give me monotonic ids starting with &lt;large number&gt; or something?</blockquote></mx-reply>yes, something like that</td></tr>
  <tr class="msg" id="L137"><td class="ts-cell"><a class="ts" href="#L137" alt="Tue Apr 09 2024 10:23:28 GMT-0700 (Pacific Daylight Time)">17:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-1" title="@jridgewell:matrix.org">Justin Ridgewell</span>&gt;</div></td><td class="msg-cell">Are bigints still massively slower than numbers?</td></tr>
  <tr class="msg" id="L138"><td class="ts-cell"><a class="ts" href="#L138" alt="Tue Apr 09 2024 10:23:31 GMT-0700 (Pacific Daylight Time)">17:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell">I'd prefer it work for bigint just so I'm not having to coerce using <code>BigInt()</code> when I need to do math with other bigints.</td></tr>
  <tr class="msg" id="L139"><td class="ts-cell"><a class="ts" href="#L139" alt="Tue Apr 09 2024 10:23:31 GMT-0700 (Pacific Daylight Time)">17:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> i have no bigint range use cases, but "works for one kind of numeric primitive and not the others" seems like a big problem</blockquote></mx-reply>why is that a big problem?</td></tr>
  <tr class="msg" id="L140"><td class="ts-cell"><a class="ts" href="#L140" alt="Tue Apr 09 2024 10:23:36 GMT-0700 (Pacific Daylight Time)">17:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> Are bigints still massively slower than numbers?</blockquote></mx-reply>haha yes</td></tr>
  <tr class="msg" id="L141"><td class="ts-cell"><a class="ts" href="#L141" alt="Tue Apr 09 2024 10:23:51 GMT-0700 (Pacific Daylight Time)">17:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@danielrosenwasser:matrix.org">danielrosenwasser</span>&gt;</div></td><td class="msg-cell"><span class="nick-2">Mathieu Hofman</span>: can you add yourself to the notes?</td></tr>
  <tr class="msg" id="L142"><td class="ts-cell"><a class="ts" href="#L142" alt="Tue Apr 09 2024 10:23:57 GMT-0700 (Pacific Daylight Time)">17:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@ljharb:matrix.org">ljharb</span>&gt;</div></td><td class="msg-cell">it's an inconsistency. one of those warts we'd inevitably have to make a "fill in the table" proposal for in a few years.</td></tr>
  <tr class="msg" id="L143"><td class="ts-cell"><a class="ts" href="#L143" alt="Tue Apr 09 2024 10:23:59 GMT-0700 (Pacific Daylight Time)">17:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@eemeli:mozilla.org">eemeli</span>&gt;</div></td><td class="msg-cell">Timestamps in microseconds as a use case?</td></tr>
  <tr class="msg" id="L144"><td class="ts-cell"><a class="ts" href="#L144" alt="Tue Apr 09 2024 10:24:26 GMT-0700 (Pacific Daylight Time)">17:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@ljharb:matrix.org">ljharb</span>&gt;</div></td><td class="msg-cell">it's fine if we want to wait for that, but is there a reason why it's beneficial to defer it?</td></tr>
  <tr class="msg" id="L145"><td class="ts-cell"><a class="ts" href="#L145" alt="Tue Apr 09 2024 10:24:28 GMT-0700 (Pacific Daylight Time)">17:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> it's an inconsistency. one of those warts we'd inevitably have to make a "fill in the table" proposal for in a few years.</blockquote></mx-reply>not everyone shares that goal though</td></tr>
  <tr class="msg" id="L146"><td class="ts-cell"><a class="ts" href="#L146" alt="Tue Apr 09 2024 10:24:53 GMT-0700 (Pacific Daylight Time)">17:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@ljharb:matrix.org">ljharb</span>&gt;</div></td><td class="msg-cell">that is true of most of the goals we all have :-)</td></tr>
  <tr class="msg" id="L147"><td class="ts-cell"><a class="ts" href="#L147" alt="Tue Apr 09 2024 10:25:09 GMT-0700 (Pacific Daylight Time)">17:25</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</div></td><td class="msg-cell">right, which is why i pushed back on "seems like a big problem"</td></tr>
  <tr class="msg" id="L148"><td class="ts-cell"><a class="ts" href="#L148" alt="Tue Apr 09 2024 10:25:19 GMT-0700 (Pacific Daylight Time)">17:25</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">it's not that inconsistent - the Math methods do not and never will take BigInts</td></tr>
  <tr class="msg" id="L149"><td class="ts-cell"><a class="ts" href="#L149" alt="Tue Apr 09 2024 10:25:35 GMT-0700 (Pacific Daylight Time)">17:25</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</div></td><td class="msg-cell">in any case i was given a concrete use case i found plausible</td></tr>
  <tr class="msg" id="L150"><td class="ts-cell"><a class="ts" href="#L150" alt="Tue Apr 09 2024 10:25:38 GMT-0700 (Pacific Daylight Time)">17:25</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">in fact I don't think we have <em>anything</em> that takes only Number of BigInt?</td></tr>
  <tr class="msg" id="L151"><td class="ts-cell"><a class="ts" href="#L151" alt="Tue Apr 09 2024 10:25:39 GMT-0700 (Pacific Daylight Time)">17:25</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</div></td><td class="msg-cell">so i'm happy with bigints being accepted here</td></tr>
  <tr class="msg" id="L152"><td class="ts-cell"><a class="ts" href="#L152" alt="Tue Apr 09 2024 10:25:53 GMT-0700 (Pacific Daylight Time)">17:25</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">but yeah I also prefer accepting BigInt here</td></tr>
  <tr class="msg" id="L153"><td class="ts-cell"><a class="ts" href="#L153" alt="Tue Apr 09 2024 10:26:13 GMT-0700 (Pacific Daylight Time)">17:26</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@pchimento:igalia.com">ptomato</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> Timestamps in microseconds as a use case?</blockquote></mx-reply>I think the idea was to introduce Temporal.Instant ranges for this use case in the future</td></tr>
  <tr class="msg" id="L154"><td class="ts-cell"><a class="ts" href="#L154" alt="Tue Apr 09 2024 10:28:10 GMT-0700 (Pacific Daylight Time)">17:28</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@nicolo-ribaudo:matrix.org">nicolo-ribaudo</span>&gt;</div></td><td class="msg-cell">Maybe <code>Iterator.range(instant1, instant2, duration)</code> if <code>range</code> is overloaded anyway?</td></tr>
  <tr class="msg" id="L155"><td class="ts-cell"><a class="ts" href="#L155" alt="Tue Apr 09 2024 10:28:41 GMT-0700 (Pacific Daylight Time)">17:28</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jackworks:matrix.org">Jack Works</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> I might expect to be able to use <code>Iterator.range()</code> to generate unique identifiers, in which case possibly a BigInt type is desirable.</blockquote></mx-reply>can you explain this use case more? I think unique id should be something like crypto.getRandomUUID()</td></tr>
  <tr class="msg" id="L156"><td class="ts-cell"><a class="ts" href="#L156" alt="Tue Apr 09 2024 10:29:17 GMT-0700 (Pacific Daylight Time)">17:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</div></td><td class="msg-cell">might not need to be unique</td></tr>
  <tr class="msg" id="L157"><td class="ts-cell"><a class="ts" href="#L157" alt="Tue Apr 09 2024 10:29:36 GMT-0700 (Pacific Daylight Time)">17:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@ljharb:matrix.org">ljharb</span>&gt;</div></td><td class="msg-cell">also autoincrementing is fine sometimes, not everything has the german tank problem</td></tr>
  <tr class="msg" id="L158"><td class="ts-cell"><a class="ts" href="#L158" alt="Tue Apr 09 2024 10:30:00 GMT-0700 (Pacific Daylight Time)">17:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@nicolo-ribaudo:matrix.org">nicolo-ribaudo</span>&gt;</div></td><td class="msg-cell">Python bans floats in range() right?</td></tr>
  <tr class="msg" id="L159"><td class="ts-cell"><a class="ts" href="#L159" alt="Tue Apr 09 2024 10:30:46 GMT-0700 (Pacific Daylight Time)">17:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@pchimento:igalia.com">ptomato</span>&gt;</div></td><td class="msg-cell">right</td></tr>
  <tr class="msg" id="L160"><td class="ts-cell"><a class="ts" href="#L160" alt="Tue Apr 09 2024 10:32:40 GMT-0700 (Pacific Daylight Time)">17:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@pchimento:igalia.com">ptomato</span>&gt;</div></td><td class="msg-cell">python's popular computing library has <code>numpy.arange()</code> which does suffer from unexpected iterations due to floating point errors, and <code>numpy.linspace()</code> which does not</td></tr>
  <tr class="msg" id="L161"><td class="ts-cell"><a class="ts" href="#L161" alt="Tue Apr 09 2024 10:33:08 GMT-0700 (Pacific Daylight Time)">17:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@jesse:igalia.com">Jesse</span>&gt;</div></td><td class="msg-cell">...decimal.</td></tr>
  <tr class="msg" id="L162"><td class="ts-cell"><a class="ts" href="#L162" alt="Tue Apr 09 2024 10:33:58 GMT-0700 (Pacific Daylight Time)">17:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">I do like linspace </td></tr>
  <tr class="msg" id="L163"><td class="ts-cell"><a class="ts" href="#L163" alt="Tue Apr 09 2024 10:34:13 GMT-0700 (Pacific Daylight Time)">17:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">the options object does leave room for it</td></tr>
  <tr class="msg" id="L164"><td class="ts-cell"><a class="ts" href="#L164" alt="Tue Apr 09 2024 10:34:57 GMT-0700 (Pacific Daylight Time)">17:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@nicolo-ribaudo:matrix.org">nicolo-ribaudo</span>&gt;</div></td><td class="msg-cell">You can just use a range of integers and .map for what Matthew is proposing, right?</td></tr>
  <tr class="msg" id="L165"><td class="ts-cell"><a class="ts" href="#L165" alt="Tue Apr 09 2024 10:35:02 GMT-0700 (Pacific Daylight Time)">17:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@michaelficarra:matrix.org">Michael Ficarra</span>&gt;</div></td><td class="msg-cell">FWIW it would be nice to have extra time to iron out all the editorial issues as well</td></tr>
  <tr class="msg" id="L166"><td class="ts-cell"><a class="ts" href="#L166" alt="Tue Apr 09 2024 10:35:09 GMT-0700 (Pacific Daylight Time)">17:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@michaelficarra:matrix.org">Michael Ficarra</span>&gt;</div></td><td class="msg-cell">then we can have a really solid 2.7 advancement</td></tr>
  <tr class="msg" id="L167"><td class="ts-cell"><a class="ts" href="#L167" alt="Tue Apr 09 2024 10:36:23 GMT-0700 (Pacific Daylight Time)">17:36</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@bradfordcsmith:matrix.org">Bradford Smith</span>&gt;</div></td><td class="msg-cell">I'll definitely +1 this feature either with or without fractional values.</td></tr>
  <tr class="msg" id="L168"><td class="ts-cell"><a class="ts" href="#L168" alt="Tue Apr 09 2024 10:36:39 GMT-0700 (Pacific Daylight Time)">17:36</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">same though I do prefer accepting fractional values</td></tr>
  <tr class="msg" id="L169"><td class="ts-cell"><a class="ts" href="#L169" alt="Tue Apr 09 2024 10:36:52 GMT-0700 (Pacific Daylight Time)">17:36</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">but if left out it's not the end of the world</td></tr>
  <tr class="msg" id="L170"><td class="ts-cell"><a class="ts" href="#L170" alt="Tue Apr 09 2024 10:41:01 GMT-0700 (Pacific Daylight Time)">17:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@haxjs:matrix.org">hax (HE Shi-Jun)</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> the options object does leave room for it</blockquote></mx-reply>I think linspace should be a separate method?</td></tr>
  <tr class="msg" id="L171"><td class="ts-cell"><a class="ts" href="#L171" alt="Tue Apr 09 2024 10:41:30 GMT-0700 (Pacific Daylight Time)">17:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@michaelficarra:matrix.org">Michael Ficarra</span>&gt;</div></td><td class="msg-cell">even 2-4x slower must still be faster than <code data-md="`">.reduce((a, b) =&gt; a + b, -0)</code></td></tr>
  <tr class="msg" id="L172"><td class="ts-cell"><a class="ts" href="#L172" alt="Tue Apr 09 2024 10:43:58 GMT-0700 (Pacific Daylight Time)">17:43</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@haxjs:matrix.org">hax (HE Shi-Jun)</span>&gt;</div></td><td class="msg-cell">As the original author of range floating issue, I prefer not accepting franctional values , and change the name from<code>Iterator.range</code> to <code>Iterator.integers</code> which make it even more clear to developers </td></tr>
  <tr class="msg" id="L173"><td class="ts-cell"><a class="ts" href="#L173" alt="Tue Apr 09 2024 10:44:38 GMT-0700 (Pacific Daylight Time)">17:44</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@michaelficarra:matrix.org">Michael Ficarra</span>&gt;</div></td><td class="msg-cell"><code data-md="`">intRange</code></td></tr>
  <tr class="msg" id="L174"><td class="ts-cell"><a class="ts" href="#L174" alt="Tue Apr 09 2024 10:46:34 GMT-0700 (Pacific Daylight Time)">17:46</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@haxjs:matrix.org">hax (HE Shi-Jun)</span>&gt;</div></td><td class="msg-cell">Do people also need <code>ProductExact()</code> ?</td></tr>
  <tr class="msg" id="L175"><td class="ts-cell"><a class="ts" href="#L175" alt="Tue Apr 09 2024 10:46:51 GMT-0700 (Pacific Daylight Time)">17:46</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@littledan:matrix.org">littledan</span>&gt;</div></td><td class="msg-cell">I can't understand the difference in precision/exactitude between precise and exact in this case... can anyone else?</td></tr>
  <tr class="msg" id="L176"><td class="ts-cell"><a class="ts" href="#L176" alt="Tue Apr 09 2024 10:47:42 GMT-0700 (Pacific Daylight Time)">17:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@eemeli:mozilla.org">eemeli</span>&gt;</div></td><td class="msg-cell">I think "precise" applies to all numbers. So <code>0.1 + 0.2</code> has a precise value, it's just not exactly <code>0.3</code>.</td></tr>
  <tr class="msg" id="L177"><td class="ts-cell"><a class="ts" href="#L177" alt="Tue Apr 09 2024 10:47:45 GMT-0700 (Pacific Daylight Time)">17:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</div></td><td class="msg-cell">kinda, i guess there is a notion of "low precision" vs "high precision" that's more commonly used than "low exactitude" vs "high exactitude"</td></tr>
  <tr class="msg" id="L178"><td class="ts-cell"><a class="ts" href="#L178" alt="Tue Apr 09 2024 10:47:56 GMT-0700 (Pacific Daylight Time)">17:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</div></td><td class="msg-cell">but in this particular case i don't really understand</td></tr>
  <tr class="msg" id="L179"><td class="ts-cell"><a class="ts" href="#L179" alt="Tue Apr 09 2024 10:47:59 GMT-0700 (Pacific Daylight Time)">17:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@eemeli:mozilla.org">eemeli</span>&gt;</div></td><td class="msg-cell">"Accurate" would be more... accurate.</td></tr>
  <tr class="msg" id="L180"><td class="ts-cell"><a class="ts" href="#L180" alt="Tue Apr 09 2024 10:48:21 GMT-0700 (Pacific Daylight Time)">17:48</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@haxjs:matrix.org">hax (HE Shi-Jun)</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> I can't understand the difference in precision/exactitude between precise and exact in this case... can anyone else?</blockquote></mx-reply>It just avoid some loss and more close to exact number?</td></tr>
  <tr class="msg" id="L181"><td class="ts-cell"><a class="ts" href="#L181" alt="Tue Apr 09 2024 10:48:23 GMT-0700 (Pacific Daylight Time)">17:48</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@littledan:matrix.org">littledan</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> I think "precise" applies to all numbers. So <code>0.1 + 0.2</code> has a precise value, it's just not exactly <code>0.3</code>.</blockquote></mx-reply>huh? but we're starting with Numbers, not those funny things that we don't have a representation of in JS</td></tr>
  <tr class="msg" id="L182"><td class="ts-cell"><a class="ts" href="#L182" alt="Tue Apr 09 2024 10:49:04 GMT-0700 (Pacific Daylight Time)">17:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@littledan:matrix.org">littledan</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> kinda, i guess there is a notion of "low precision" vs "high precision" that's more commonly used than "low exactitude" vs "high exactitude"</blockquote></mx-reply>OK but it's not like we have a precision arg here... it's just supposed to get the right answer</td></tr>
  <tr class="msg" id="L183"><td class="ts-cell"><a class="ts" href="#L183" alt="Tue Apr 09 2024 10:49:12 GMT-0700 (Pacific Daylight Time)">17:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@littledan:matrix.org">littledan</span>&gt;</div></td><td class="msg-cell">right?</td></tr>
  <tr class="msg" id="L184"><td class="ts-cell"><a class="ts" href="#L184" alt="Tue Apr 09 2024 10:49:22 GMT-0700 (Pacific Daylight Time)">17:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</div></td><td class="msg-cell">right, in this particular case i don't understand the difference</td></tr>
  <tr class="msg" id="L185"><td class="ts-cell"><a class="ts" href="#L185" alt="Tue Apr 09 2024 10:49:41 GMT-0700 (Pacific Daylight Time)">17:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</div></td><td class="msg-cell">if it were up to me i'd name it sumSlow</td></tr>
  <tr class="msg" id="L186"><td class="ts-cell"><a class="ts" href="#L186" alt="Tue Apr 09 2024 10:50:13 GMT-0700 (Pacific Daylight Time)">17:50</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</div></td><td class="msg-cell">like i would totally believe that if kevin's slides said "this is named sumPrecise, but it may give the wrong impression", someone will then say "sumExact is better"</td></tr>
  <tr class="msg" id="L187"><td class="ts-cell"><a class="ts" href="#L187" alt="Tue Apr 09 2024 10:50:15 GMT-0700 (Pacific Daylight Time)">17:50</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@eemeli:mozilla.org">eemeli</span>&gt;</div></td><td class="msg-cell">To be clear, I'm fine with sumExact as a least worst option.</td></tr>
  <tr class="msg" id="L188"><td class="ts-cell"><a class="ts" href="#L188" alt="Tue Apr 09 2024 10:50:53 GMT-0700 (Pacific Daylight Time)">17:50</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jackworks:matrix.org">Jack Works</span>&gt;</div></td><td class="msg-cell">Yes, next follow on proposal might be adding a new Symbol.rangeTo, and then range(a, b, options) where a is an object will do the following: <code>yield* a[Symbol.rangeTo](b, options)</code>, then you can add it on Temporal, Decimal (they're not primitive now) and your own class.</td></tr>
  <tr class="msg" id="L189"><td class="ts-cell"><a class="ts" href="#L189" alt="Tue Apr 09 2024 10:51:01 GMT-0700 (Pacific Daylight Time)">17:51</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell">Doesn't temporal use <code>from</code> ?</td></tr>
  <tr class="msg" id="L190"><td class="ts-cell"><a class="ts" href="#L190" alt="Tue Apr 09 2024 10:51:12 GMT-0700 (Pacific Daylight Time)">17:51</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@littledan:matrix.org">littledan</span>&gt;</div></td><td class="msg-cell">what name are we considering?</td></tr>
  <tr class="msg" id="L191"><td class="ts-cell"><a class="ts" href="#L191" alt="Tue Apr 09 2024 10:52:16 GMT-0700 (Pacific Daylight Time)">17:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@bradfordcsmith:matrix.org">Bradford Smith</span>&gt;</div></td><td class="msg-cell">So, I guess we should go with <code>Math.sumPreciseFrom()</code>?</td></tr>
  <tr class="msg" id="L192"><td class="ts-cell"><a class="ts" href="#L192" alt="Tue Apr 09 2024 10:52:33 GMT-0700 (Pacific Daylight Time)">17:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@bradfordcsmith:matrix.org">Bradford Smith</span>&gt;</div></td><td class="msg-cell">or not...</td></tr>
  <tr class="msg" id="L193"><td class="ts-cell"><a class="ts" href="#L193" alt="Tue Apr 09 2024 10:52:37 GMT-0700 (Pacific Daylight Time)">17:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">it sounds like we are not doing <code>From</code> based on everyone else doesn't like it</td></tr>
  <tr class="msg" id="L194"><td class="ts-cell"><a class="ts" href="#L194" alt="Tue Apr 09 2024 10:52:41 GMT-0700 (Pacific Daylight Time)">17:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">so <code>sumExact</code> or <code>sumPrecise</code></td></tr>
  <tr class="msg" id="L195"><td class="ts-cell"><a class="ts" href="#L195" alt="Tue Apr 09 2024 10:54:29 GMT-0700 (Pacific Daylight Time)">17:54</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@haxjs:matrix.org">hax (HE Shi-Jun)</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> if it were up to me i'd name it sumSlow</blockquote></mx-reply>As I understand, it is not necessarily slow.</td></tr>
  <tr class="msg" id="L196"><td class="ts-cell"><a class="ts" href="#L196" alt="Tue Apr 09 2024 10:54:42 GMT-0700 (Pacific Daylight Time)">17:54</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@danielrosenwasser:matrix.org">danielrosenwasser</span>&gt;</div></td><td class="msg-cell"><span class="nick-9">dminor</span>: can you clarify your last point in the notes?</td></tr>
  <tr class="msg" id="L197"><td class="ts-cell"><a class="ts" href="#L197" alt="Tue Apr 09 2024 10:54:43 GMT-0700 (Pacific Daylight Time)">17:54</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</div></td><td class="msg-cell">yeah it is?</td></tr>
  <tr class="msg" id="L198"><td class="ts-cell"><a class="ts" href="#L198" alt="Tue Apr 09 2024 10:54:48 GMT-0700 (Pacific Daylight Time)">17:54</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</div></td><td class="msg-cell">it's necessarily slow_er_</td></tr>
  <tr class="msg" id="L199"><td class="ts-cell"><a class="ts" href="#L199" alt="Tue Apr 09 2024 10:54:50 GMT-0700 (Pacific Daylight Time)">17:54</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@nicolo-ribaudo:matrix.org">nicolo-ribaudo</span>&gt;</div></td><td class="msg-cell">I was going to say that I dislike <code>From</code> because it currently means "I'm creating something of this type from these other values". <code>Iterator.from</code> creates an iterator, <code>Array.from</code> an array, <code>Object.fromEntries</code> an object. If we wanted this to contain from it should be on number (<code>Number.fromSum</code>), but also Number is not a collection</td></tr>
  <tr class="msg" id="L200"><td class="ts-cell"><a class="ts" href="#L200" alt="Tue Apr 09 2024 10:55:23 GMT-0700 (Pacific Daylight Time)">17:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell">Temporal uses <code>from</code> in many places and those functions do not take iterables, so I disagree with the <span class="nick-14">Michael Ficarra</span> 's statement that "everything named from takes an iterable"</td></tr>
  <tr class="msg" id="L201"><td class="ts-cell"><a class="ts" href="#L201" alt="Tue Apr 09 2024 10:56:03 GMT-0700 (Pacific Daylight Time)">17:56</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mhofman:matrix.org">Mathieu Hofman</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> You can just use a range of integers and .map for what Matthew is proposing, right?</blockquote></mx-reply>It's not ergonomic at all: <code>range(start * stepDivider, end * stepDivider, stepMultipler) | map(x =&gt; x / stepDivider)</code></td></tr>
  <tr class="msg" id="L202"><td class="ts-cell"><a class="ts" href="#L202" alt="Tue Apr 09 2024 10:56:20 GMT-0700 (Pacific Daylight Time)">17:56</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell">Agreed. "Foo.from" does not imply "takes an iterable", it imples "make a <code>Foo</code> from these inputs"</td></tr>
  <tr class="msg" id="L203"><td class="ts-cell"><a class="ts" href="#L203" alt="Tue Apr 09 2024 10:57:42 GMT-0700 (Pacific Daylight Time)">17:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@littledan:matrix.org">littledan</span>&gt;</div></td><td class="msg-cell">I'm having trouble understanding why we're bothering with an optimization for an error case</td></tr>
  <tr class="msg" id="L204"><td class="ts-cell"><a class="ts" href="#L204" alt="Tue Apr 09 2024 10:57:46 GMT-0700 (Pacific Daylight Time)">17:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@michaelficarra:matrix.org">Michael Ficarra</span>&gt;</div></td><td class="msg-cell">I don't think arithmetic commutativity comes into play when we're talking about throwing, which is inherently not arithmetic</td></tr>
  <tr class="msg" id="L205"><td class="ts-cell"><a class="ts" href="#L205" alt="Tue Apr 09 2024 10:58:10 GMT-0700 (Pacific Daylight Time)">17:58</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@michaelficarra:matrix.org">Michael Ficarra</span>&gt;</div></td><td class="msg-cell"><a href="https://matrix.to/#/%40littledan%3Amatrix.org">@littledan</a> an iterable of Number producing a NaN is not an error case?</td></tr>
  <tr class="msg" id="L206"><td class="ts-cell"><a class="ts" href="#L206" alt="Tue Apr 09 2024 10:58:45 GMT-0700 (Pacific Daylight Time)">17:58</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@littledan:matrix.org">littledan</span>&gt;</div></td><td class="msg-cell">I think NaN is kinda usually for error cases?</td></tr>
  <tr class="msg" id="L207"><td class="ts-cell"><a class="ts" href="#L207" alt="Tue Apr 09 2024 10:59:05 GMT-0700 (Pacific Daylight Time)">17:59</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@littledan:matrix.org">littledan</span>&gt;</div></td><td class="msg-cell">I get that it's within the domain of Numbers but.... when was the last time you wanted NaN to come up for you?</td></tr>
  <tr class="msg" id="L208"><td class="ts-cell"><a class="ts" href="#L208" alt="Tue Apr 09 2024 10:59:08 GMT-0700 (Pacific Daylight Time)">17:59</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@michaelficarra:matrix.org">Michael Ficarra</span>&gt;</div></td><td class="msg-cell">at the business logic layer, maybe, but at this data processing layer, no</td></tr>
  <tr class="msg" id="L209"><td class="ts-cell"><a class="ts" href="#L209" alt="Tue Apr 09 2024 10:59:38 GMT-0700 (Pacific Daylight Time)">17:59</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@dminor:mozilla.org">dminor</span>&gt;</div></td><td class="msg-cell">I have to drop, Eemeli and Matthew Gaudet will represent SpiderMonkey for the rest of the day.</td></tr>
  <tr class="msg" id="L210"><td class="ts-cell"><a class="ts" href="#L210" alt="Tue Apr 09 2024 11:00:18 GMT-0700 (Pacific Daylight Time)">18:00</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@littledan:matrix.org">littledan</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> at the business logic layer, maybe, but at this data processing layer, no</blockquote></mx-reply>obviously we need a well-defined answer, but is this going to provide a meaningful speedup meaningfully often?</td></tr>
  <tr class="msg" id="L211"><td class="ts-cell"><a class="ts" href="#L211" alt="Tue Apr 09 2024 11:00:38 GMT-0700 (Pacific Daylight Time)">18:00</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@michaelficarra:matrix.org">Michael Ficarra</span>&gt;</div></td><td class="msg-cell">yes, iterators can yield very many values</td></tr>
  <tr class="msg" id="L212"><td class="ts-cell"><a class="ts" href="#L212" alt="Tue Apr 09 2024 11:01:04 GMT-0700 (Pacific Daylight Time)">18:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@michaelficarra:matrix.org">Michael Ficarra</span>&gt;</div></td><td class="msg-cell">a multi-hours' batch could be short-circuited immediately after starting instead of waiting until the end</td></tr>
  <tr class="msg" id="L213"><td class="ts-cell"><a class="ts" href="#L213" alt="Tue Apr 09 2024 11:03:16 GMT-0700 (Pacific Daylight Time)">18:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@haxjs:matrix.org">hax (HE Shi-Jun)</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> it's necessarily slow_er_</blockquote></mx-reply>As <a href="https://en.wikipedia.org/wiki/Pairwise_summation">https://en.wikipedia.org/wiki/Pairwise_summation</a> "Pairwise summation is the default summation algorithm in NumPy[8] and the Julia technical-computing language,[9] where in both cases it was found to have comparable speed to naive summation"</td></tr>
  <tr class="msg" id="L214"><td class="ts-cell"><a class="ts" href="#L214" alt="Tue Apr 09 2024 11:04:22 GMT-0700 (Pacific Daylight Time)">18:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@danielrosenwasser:matrix.org">danielrosenwasser</span>&gt;</div></td><td class="msg-cell"><span class="nick-6">eemeli</span>: can you add yourself to the notes doc?</td></tr>
  <tr class="msg" id="L215"><td class="ts-cell"><a class="ts" href="#L215" alt="Tue Apr 09 2024 11:09:51 GMT-0700 (Pacific Daylight Time)">18:09</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-1" title="@jridgewell:matrix.org">Justin Ridgewell</span>&gt;</div></td><td class="msg-cell">I had to miss the presentation, but why is empty list <code data-md="`">-0</code>? (no opinion, just curious)</td></tr>
  <tr class="msg" id="L216"><td class="ts-cell"><a class="ts" href="#L216" alt="Tue Apr 09 2024 11:10:11 GMT-0700 (Pacific Daylight Time)">18:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</div></td><td class="msg-cell">it is the identity of floating point addition</td></tr>
  <tr class="msg" id="L217"><td class="ts-cell"><a class="ts" href="#L217" alt="Tue Apr 09 2024 11:10:36 GMT-0700 (Pacific Daylight Time)">18:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@michaelficarra:matrix.org">Michael Ficarra</span>&gt;</div></td><td class="msg-cell"><a href="https://matrix.to/#/%40jridgewell%3Amatrix.org">@Justin Ridgewell</a> <code data-md="`"><a href="http://Object.is">Object.is</a>(-0 + -0, -0)</code></td></tr>
  <tr class="msg" id="L218"><td class="ts-cell"><a class="ts" href="#L218" alt="Tue Apr 09 2024 11:10:58 GMT-0700 (Pacific Daylight Time)">18:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</div></td><td class="msg-cell">(while +0 + -0 = +0)</td></tr>
  <tr class="msg" id="L219"><td class="ts-cell"><a class="ts" href="#L219" alt="Tue Apr 09 2024 11:11:20 GMT-0700 (Pacific Daylight Time)">18:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-1" title="@jridgewell:matrix.org">Justin Ridgewell</span>&gt;</div></td><td class="msg-cell">Why is <code data-md="`">-0</code> the starting point?</td></tr>
  <tr class="msg" id="L220"><td class="ts-cell"><a class="ts" href="#L220" alt="Tue Apr 09 2024 11:11:32 GMT-0700 (Pacific Daylight Time)">18:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-1" title="@jridgewell:matrix.org">Justin Ridgewell</span>&gt;</div></td><td class="msg-cell">If Im interpreting those correctly....</td></tr>
  <tr class="msg" id="L221"><td class="ts-cell"><a class="ts" href="#L221" alt="Tue Apr 09 2024 11:11:32 GMT-0700 (Pacific Daylight Time)">18:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</div></td><td class="msg-cell">what does starting point mean?</td></tr>
  <tr class="msg" id="L222"><td class="ts-cell"><a class="ts" href="#L222" alt="Tue Apr 09 2024 11:11:57 GMT-0700 (Pacific Daylight Time)">18:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-1" title="@jridgewell:matrix.org">Justin Ridgewell</span>&gt;</div></td><td class="msg-cell"><code data-md="`">let sum = -0; for (const i of array) sum += i</code></td></tr>
  <tr class="msg" id="L223"><td class="ts-cell"><a class="ts" href="#L223" alt="Tue Apr 09 2024 11:12:22 GMT-0700 (Pacific Daylight Time)">18:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@michaelficarra:matrix.org">Michael Ficarra</span>&gt;</div></td><td class="msg-cell">so that when <code data-md="`">array</code> is <code data-md="`">[-0]</code> you get the correct answer</td></tr>
  <tr class="msg" id="L224"><td class="ts-cell"><a class="ts" href="#L224" alt="Tue Apr 09 2024 11:17:46 GMT-0700 (Pacific Daylight Time)">18:17</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@aardvark179:matrix.org">Duncan MacGregor</span>&gt;</div></td><td class="msg-cell">The equality question feels very like the question of <code>==</code> on value types in Java.</td></tr>
  <tr class="msg" id="L225"><td class="ts-cell"><a class="ts" href="#L225" alt="Tue Apr 09 2024 11:19:32 GMT-0700 (Pacific Daylight Time)">18:19</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">the slides will reference project Valhalla IIRC</td></tr>
  <tr class="msg" id="L226"><td class="ts-cell"><a class="ts" href="#L226" alt="Tue Apr 09 2024 11:19:38 GMT-0700 (Pacific Daylight Time)">18:19</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@michaelficarra:matrix.org">Michael Ficarra</span>&gt;</div></td><td class="msg-cell">value types being the ones with lowercase names?</td></tr>
  <tr class="msg" id="L227"><td class="ts-cell"><a class="ts" href="#L227" alt="Tue Apr 09 2024 11:19:43 GMT-0700 (Pacific Daylight Time)">18:19</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">(i.e. value objects for java)</td></tr>
  <tr class="msg" id="L228"><td class="ts-cell"><a class="ts" href="#L228" alt="Tue Apr 09 2024 11:19:59 GMT-0700 (Pacific Daylight Time)">18:19</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell"><a href="https://openjdk.org/projects/valhalla/">https://openjdk.org/projects/valhalla/</a></td></tr>
  <tr class="msg" id="L229"><td class="ts-cell"><a class="ts" href="#L229" alt="Tue Apr 09 2024 11:24:22 GMT-0700 (Pacific Daylight Time)">18:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@michaelficarra:matrix.org">Michael Ficarra</span>&gt;</div></td><td class="msg-cell">this presentation is so well structured </td></tr>
  <tr class="msg" id="L230"><td class="ts-cell"><a class="ts" href="#L230" alt="Tue Apr 09 2024 11:25:58 GMT-0700 (Pacific Daylight Time)">18:25</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">I really like the composite object approach though I would not call them "CompositeKey"</td></tr>
  <tr class="msg" id="L231"><td class="ts-cell"><a class="ts" href="#L231" alt="Tue Apr 09 2024 11:27:42 GMT-0700 (Pacific Daylight Time)">18:27</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">I linked a few userland implementations here: <a href="https://github.com/tc39/proposal-record-tuple/issues/387#issuecomment-2033531920">https://github.com/tc39/proposal-record-tuple/issues/387#issuecomment-2033531920</a> though I am sure there are others</td></tr>
  <tr class="msg" id="L232"><td class="ts-cell"><a class="ts" href="#L232" alt="Tue Apr 09 2024 11:29:02 GMT-0700 (Pacific Daylight Time)">18:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell">Composite keys don't seem like a solution to case-insensitive Maps. I still strongly favor equals/hash.</td></tr>
  <tr class="msg" id="L233"><td class="ts-cell"><a class="ts" href="#L233" alt="Tue Apr 09 2024 11:29:56 GMT-0700 (Pacific Daylight Time)">18:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">I think they solve a different problem - equals/hash doesn't let me write <code>groupBy</code> with the result of my comparator being a composite key (without doing a bunch of work)</td></tr>
  <tr class="msg" id="L234"><td class="ts-cell"><a class="ts" href="#L234" alt="Tue Apr 09 2024 11:29:57 GMT-0700 (Pacific Daylight Time)">18:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@pchimento:igalia.com">ptomato</span>&gt;</div></td><td class="msg-cell">but uniqBy without CompositeKey would cover that use case, no?</td></tr>
  <tr class="msg" id="L235"><td class="ts-cell"><a class="ts" href="#L235" alt="Tue Apr 09 2024 11:30:11 GMT-0700 (Pacific Daylight Time)">18:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell">i.e., <code>new Map([], { comparer: caseInsensitiveStringComparer }</code></td></tr>
  <tr class="msg" id="L236"><td class="ts-cell"><a class="ts" href="#L236" alt="Tue Apr 09 2024 11:30:28 GMT-0700 (Pacific Daylight Time)">18:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@michaelficarra:matrix.org">Michael Ficarra</span>&gt;</div></td><td class="msg-cell"><a href="https://matrix.to/#/%40rbuckton%3Amatrix.org">@rbuckton</a> it works fine, Unicode has case folding for tht</td></tr>
  <tr class="msg" id="L237"><td class="ts-cell"><a class="ts" href="#L237" alt="Tue Apr 09 2024 11:30:51 GMT-0700 (Pacific Daylight Time)">18:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> I think they solve a different problem - equals/hash doesn't let me write <code>groupBy</code> with the result of my comparator being a composite key (without doing a bunch of work)</blockquote></mx-reply>Wouldn't you just do groupBy over anything you want?</td></tr>
  <tr class="msg" id="L238"><td class="ts-cell"><a class="ts" href="#L238" alt="Tue Apr 09 2024 11:31:46 GMT-0700 (Pacific Daylight Time)">18:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> <a href="https://matrix.to/#/%40rbuckton%3Amatrix.org">@rbuckton</a> it works fine, Unicode has case folding for tht</blockquote></mx-reply>It's an extra allocation, likely thrown away, for any given key comparison. equals/hash is defined once and reused</td></tr>
  <tr class="msg" id="L239"><td class="ts-cell"><a class="ts" href="#L239" alt="Tue Apr 09 2024 11:32:30 GMT-0700 (Pacific Daylight Time)">18:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">I don't know what that means? I am asking about, for example, I have a list of { name, employer, city } objects, and I want to collect them by <code>{ employer, city }</code>. with composite key that's just <code>Map.groupBy(vals, x =&gt; Tuple(x.employer, <a href="http://x.city">x.city</a>))</code>. with equals/hash there's a bunch more ceremony</td></tr>
  <tr class="msg" id="L240"><td class="ts-cell"><a class="ts" href="#L240" alt="Tue Apr 09 2024 11:33:48 GMT-0700 (Pacific Daylight Time)">18:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell">I have already written a <code>groupBy</code> that uses <code>equals</code>/hash`, and an equaler that already does tuple structural equality.</td></tr>
  <tr class="msg" id="L241"><td class="ts-cell"><a class="ts" href="#L241" alt="Tue Apr 09 2024 11:34:57 GMT-0700 (Pacific Daylight Time)">18:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell">That library also supports <code>[Equatable.equals](obj)</code> and <code>[Equatable.hash]()</code> that can be used if an equaler is not provided, so a given composite key just builds on top of that.</td></tr>
  <tr class="msg" id="L242"><td class="ts-cell"><a class="ts" href="#L242" alt="Tue Apr 09 2024 11:35:54 GMT-0700 (Pacific Daylight Time)">18:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">sure, it can certainly be done, there's just a bunch more ceremony</td></tr>
  <tr class="msg" id="L243"><td class="ts-cell"><a class="ts" href="#L243" alt="Tue Apr 09 2024 11:36:11 GMT-0700 (Pacific Daylight Time)">18:36</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell">It is far more flexible, IMO. </td></tr>
  <tr class="msg" id="L244"><td class="ts-cell"><a class="ts" href="#L244" alt="Tue Apr 09 2024 11:36:35 GMT-0700 (Pacific Daylight Time)">18:36</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">it's just different</td></tr>
  <tr class="msg" id="L245"><td class="ts-cell"><a class="ts" href="#L245" alt="Tue Apr 09 2024 11:36:39 GMT-0700 (Pacific Daylight Time)">18:36</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">it solves different problems</td></tr>
  <tr class="msg" id="L246"><td class="ts-cell"><a class="ts" href="#L246" alt="Tue Apr 09 2024 11:36:50 GMT-0700 (Pacific Daylight Time)">18:36</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell">Having to turn everything into a <code>CompositeKey</code> seems like a lot more ceremony to me.</td></tr>
  <tr class="msg" id="L247"><td class="ts-cell"><a class="ts" href="#L247" alt="Tue Apr 09 2024 11:37:01 GMT-0700 (Pacific Daylight Time)">18:37</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@eemeli:mozilla.org">eemeli</span>&gt;</div></td><td class="msg-cell">Map.p.getImprecise, anyone?</td></tr>
  <tr class="msg" id="L248"><td class="ts-cell"><a class="ts" href="#L248" alt="Tue Apr 09 2024 11:37:06 GMT-0700 (Pacific Daylight Time)">18:37</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell"><code>CompositeKey</code> can be built on equals/hash, the other is not true.</td></tr>
  <tr class="msg" id="L249"><td class="ts-cell"><a class="ts" href="#L249" alt="Tue Apr 09 2024 11:37:43 GMT-0700 (Pacific Daylight Time)">18:37</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell"><code>Map.groupBy(vals, x =&gt; Tuple(x.employer, <a href="http://x.city">x.city</a>))</code> is very close to zero ceremony</td></tr>
  <tr class="msg" id="L250"><td class="ts-cell"><a class="ts" href="#L250" alt="Tue Apr 09 2024 11:37:47 GMT-0700 (Pacific Daylight Time)">18:37</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">that's exactly how I think about the problem</td></tr>
  <tr class="msg" id="L251"><td class="ts-cell"><a class="ts" href="#L251" alt="Tue Apr 09 2024 11:38:02 GMT-0700 (Pacific Daylight Time)">18:38</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell">Plus, AFAIK equals/hash is how every implementation implements maps natively, it's just not exposed to user code.</td></tr>
  <tr class="msg" id="L252"><td class="ts-cell"><a class="ts" href="#L252" alt="Tue Apr 09 2024 11:40:25 GMT-0700 (Pacific Daylight Time)">18:40</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell">For that case, maybe. What about <code>map.set(key, value)</code> though? You have to write <code>map.set(new CompositeKey(foo.a, foo.b), value)</code> or <code>map.get(new CompositeKey(foo.a, foo.b))</code>. With equals/hash, you can set it up once and just do <code>map.set(foo, value)</code> or <code>map.get(foo)</code>.</td></tr>
  <tr class="msg" id="L253"><td class="ts-cell"><a class="ts" href="#L253" alt="Tue Apr 09 2024 11:40:54 GMT-0700 (Pacific Daylight Time)">18:40</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">but if my map is not keyed by <code>foo</code>, I don't want it to behave that way?</td></tr>
  <tr class="msg" id="L254"><td class="ts-cell"><a class="ts" href="#L254" alt="Tue Apr 09 2024 11:41:01 GMT-0700 (Pacific Daylight Time)">18:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">I want to use a composite key for that case</td></tr>
  <tr class="msg" id="L255"><td class="ts-cell"><a class="ts" href="#L255" alt="Tue Apr 09 2024 11:41:02 GMT-0700 (Pacific Daylight Time)">18:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@ljharb:matrix.org">ljharb</span>&gt;</div></td><td class="msg-cell">with a Map constructor hook, you could set it up once too with composite keys</td></tr>
  <tr class="msg" id="L256"><td class="ts-cell"><a class="ts" href="#L256" alt="Tue Apr 09 2024 11:41:19 GMT-0700 (Pacific Daylight Time)">18:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell">You can use a composite key for that case, I'd like to <em>not</em> have to use composite key for all of the other cases.</td></tr>
  <tr class="msg" id="L257"><td class="ts-cell"><a class="ts" href="#L257" alt="Tue Apr 09 2024 11:41:31 GMT-0700 (Pacific Daylight Time)">18:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mhofman:matrix.org">Mathieu Hofman</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> It is far more flexible, IMO. </blockquote></mx-reply>it's a lot more risk prone</td></tr>
  <tr class="msg" id="L258"><td class="ts-cell"><a class="ts" href="#L258" alt="Tue Apr 09 2024 11:41:35 GMT-0700 (Pacific Daylight Time)">18:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> with a Map constructor hook, you could set it up once too with composite keys</blockquote></mx-reply>The same is true for equals/hash.</td></tr>
  <tr class="msg" id="L259"><td class="ts-cell"><a class="ts" href="#L259" alt="Tue Apr 09 2024 11:41:58 GMT-0700 (Pacific Daylight Time)">18:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@ljharb:matrix.org">ljharb</span>&gt;</div></td><td class="msg-cell">right. which is why it's not an argument in favor of either one.</td></tr>
  <tr class="msg" id="L260"><td class="ts-cell"><a class="ts" href="#L260" alt="Tue Apr 09 2024 11:42:12 GMT-0700 (Pacific Daylight Time)">18:42</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> it's a lot more risk prone</blockquote></mx-reply>It's far more efficient. If I want to write a custom collection that employs a hashtable, I'd rather have it easier to compute a hash.</td></tr>
  <tr class="msg" id="L261"><td class="ts-cell"><a class="ts" href="#L261" alt="Tue Apr 09 2024 11:43:02 GMT-0700 (Pacific Daylight Time)">18:43</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@sffc:mozilla.org">sffc</span>&gt;</div></td><td class="msg-cell">For the set comparator, it seems like a prototype method <code>[Symbol.setCompare]</code> would work, and if Record/Tuple implement that function, then R&amp;T Set/Map semantics should just work</td></tr>
  <tr class="msg" id="L262"><td class="ts-cell"><a class="ts" href="#L262" alt="Tue Apr 09 2024 11:43:09 GMT-0700 (Pacific Daylight Time)">18:43</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> You can use a composite key for that case, I'd like to <em>not</em> have to use composite key for all of the other cases.</blockquote></mx-reply>right that's what I mean by "they are different"</td></tr>
  <tr class="msg" id="L263"><td class="ts-cell"><a class="ts" href="#L263" alt="Tue Apr 09 2024 11:43:14 GMT-0700 (Pacific Daylight Time)">18:43</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mhofman:matrix.org">Mathieu Hofman</span>&gt;</div></td><td class="msg-cell">JS is a high level language, I don't want low level concept like computing hashes exposed to programmer, especially if they can cause erroneous executions if mishandled</td></tr>
  <tr class="msg" id="L264"><td class="ts-cell"><a class="ts" href="#L264" alt="Tue Apr 09 2024 11:43:25 GMT-0700 (Pacific Daylight Time)">18:43</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">I'm not saying that we should have composite keys <em>instead of</em> hash/equals, just that they solve different problems</td></tr>
  <tr class="msg" id="L265"><td class="ts-cell"><a class="ts" href="#L265" alt="Tue Apr 09 2024 11:45:30 GMT-0700 (Pacific Daylight Time)">18:45</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">(I am <em>separately</em> somewhat skeptical of hash/equals because of the concerns about inconsistency, especially since that seems like it might be a bug farm in engines themselves and not just programs. but that concern is unrelated to this.)</td></tr>
  <tr class="msg" id="L266"><td class="ts-cell"><a class="ts" href="#L266" alt="Tue Apr 09 2024 11:50:02 GMT-0700 (Pacific Daylight Time)">18:50</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mhofman:matrix.org">Mathieu Hofman</span>&gt;</div></td><td class="msg-cell">That means the collection correctness is dependent on the stable behavior of its values. I want the ability to create a collection that is resilient against misbehaving values</td></tr>
  <tr class="msg" id="L267"><td class="ts-cell"><a class="ts" href="#L267" alt="Tue Apr 09 2024 11:55:03 GMT-0700 (Pacific Daylight Time)">18:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@aardvark179:matrix.org">Duncan MacGregor</span>&gt;</div></td><td class="msg-cell">+1 on pretty much everything <span class="nick-15">rbuckton</span> said.</td></tr>
  <tr class="msg" id="L268"><td class="ts-cell"><a class="ts" href="#L268" alt="Tue Apr 09 2024 11:58:16 GMT-0700 (Pacific Daylight Time)">18:58</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> That means the collection correctness is dependent on the stable behavior of its values. I want the ability to create a collection that is resilient against misbehaving values</blockquote></mx-reply>If you do not trust the stability of your keys, then you could use a <code>CompositeKey</code> and pay the overhead for every get/set. If you do trust the stability of your keys, equals/hash lets you avoid that overhead.</td></tr>
  <tr class="msg" id="L269"><td class="ts-cell"><a class="ts" href="#L269" alt="Tue Apr 09 2024 12:00:45 GMT-0700 (Pacific Daylight Time)">19:00</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell">I have a strong preference for fast, efficient JS. <code>CompositeKey</code> overhead does not seem fast/efficient.</td></tr>
  <tr class="msg" id="L270"><td class="ts-cell"><a class="ts" href="#L270" alt="Tue Apr 09 2024 12:01:19 GMT-0700 (Pacific Daylight Time)">19:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mhofman:matrix.org">Mathieu Hofman</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> If you do not trust the stability of your keys, then you could use a <code>CompositeKey</code> and pay the overhead for every get/set. If you do trust the stability of your keys, equals/hash lets you avoid that overhead.</blockquote></mx-reply>Not if the only way is for the collection to ask the value. My answer was to <span class="nick-16">sffc</span> who was proposing that</td></tr>
  <tr class="msg" id="L271"><td class="ts-cell"><a class="ts" href="#L271" alt="Tue Apr 09 2024 12:01:51 GMT-0700 (Pacific Daylight Time)">19:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell">equals/hash does not preclude <code>CompositeKey</code>, but rather is the building block a <code>CompositeKey</code> could be built on. It's also the building block using a <code>Uri</code> as a key could be built on too.</td></tr>
  <tr class="msg" id="L272"><td class="ts-cell"><a class="ts" href="#L272" alt="Tue Apr 09 2024 12:02:37 GMT-0700 (Pacific Daylight Time)">19:02</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">It's not something you could build <code>CompositeKey</code> on because <code>CompositeKey</code> has <code>===</code> equality</td></tr>
  <tr class="msg" id="L273"><td class="ts-cell"><a class="ts" href="#L273" alt="Tue Apr 09 2024 12:02:46 GMT-0700 (Pacific Daylight Time)">19:02</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">and <code>===</code> will never invoke a userland <code>equals</code></td></tr>
  <tr class="msg" id="L274"><td class="ts-cell"><a class="ts" href="#L274" alt="Tue Apr 09 2024 12:03:22 GMT-0700 (Pacific Daylight Time)">19:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</div></td><td class="msg-cell">i missed that there was a configuration of the new direction that has new objects that have special ===?</td></tr>
  <tr class="msg" id="L275"><td class="ts-cell"><a class="ts" href="#L275" alt="Tue Apr 09 2024 12:03:28 GMT-0700 (Pacific Daylight Time)">19:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell">If we could have <code>CompositeKey</code> have <code>===</code> equality, why would we not have R&amp;T have <code>===</code> equality?</td></tr>
  <tr class="msg" id="L276"><td class="ts-cell"><a class="ts" href="#L276" alt="Tue Apr 09 2024 12:03:31 GMT-0700 (Pacific Daylight Time)">19:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</div></td><td class="msg-cell">that isn't any more acceptable than the R&amp;T's overloading of ===</td></tr>
  <tr class="msg" id="L277"><td class="ts-cell"><a class="ts" href="#L277" alt="Tue Apr 09 2024 12:03:51 GMT-0700 (Pacific Daylight Time)">19:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> i missed that there was a configuration of the new direction that has new objects that have special ===?</blockquote></mx-reply>the CompositeKey thing he presented, with interning, which is already being done in userland</td></tr>
  <tr class="msg" id="L278"><td class="ts-cell"><a class="ts" href="#L278" alt="Tue Apr 09 2024 12:03:53 GMT-0700 (Pacific Daylight Time)">19:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@littledan:matrix.org">littledan</span>&gt;</div></td><td class="msg-cell">can we change indexOf just for these new objects?</td></tr>
  <tr class="msg" id="L279"><td class="ts-cell"><a class="ts" href="#L279" alt="Tue Apr 09 2024 12:04:00 GMT-0700 (Pacific Daylight Time)">19:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">it was not one ACE advocated for</td></tr>
  <tr class="msg" id="L280"><td class="ts-cell"><a class="ts" href="#L280" alt="Tue Apr 09 2024 12:04:20 GMT-0700 (Pacific Daylight Time)">19:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> the CompositeKey thing he presented, with interning, which is already being done in userland</blockquote></mx-reply>tools compile away === or something?</td></tr>
  <tr class="msg" id="L281"><td class="ts-cell"><a class="ts" href="#L281" alt="Tue Apr 09 2024 12:04:34 GMT-0700 (Pacific Daylight Time)">19:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">no I mean they do interning</td></tr>
  <tr class="msg" id="L282"><td class="ts-cell"><a class="ts" href="#L282" alt="Tue Apr 09 2024 12:05:03 GMT-0700 (Pacific Daylight Time)">19:05</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@aclaymore:matrix.org">Ashley Claymore</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> can we change indexOf just for these new objects?</blockquote></mx-reply>I assumed 'no', but never asked</td></tr>
  <tr class="msg" id="L283"><td class="ts-cell"><a class="ts" href="#L283" alt="Tue Apr 09 2024 12:05:16 GMT-0700 (Pacific Daylight Time)">19:05</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> no I mean they do interning</blockquote></mx-reply>oh by "===" you mean they do interning?</td></tr>
  <tr class="msg" id="L284"><td class="ts-cell"><a class="ts" href="#L284" alt="Tue Apr 09 2024 12:05:40 GMT-0700 (Pacific Daylight Time)">19:05</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</div></td><td class="msg-cell">i see, ok</td></tr>
  <tr class="msg" id="L285"><td class="ts-cell"><a class="ts" href="#L285" alt="Tue Apr 09 2024 12:05:43 GMT-0700 (Pacific Daylight Time)">19:05</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell"><a href="https://github.com/benjamn/immutable-tuple/blob/485b32326349cb0329c749090cebf43f8359fa12/src/tuple.js#L12-L19">https://github.com/benjamn/immutable-tuple/blob/485b32326349cb0329c749090cebf43f8359fa12/src/tuple.js#L12-L19</a></td></tr>
  <tr class="msg" id="L286"><td class="ts-cell"><a class="ts" href="#L286" alt="Tue Apr 09 2024 12:06:01 GMT-0700 (Pacific Daylight Time)">19:06</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell">Isn't the discussion around <code>CompositeKey</code> predicated on R&amp;T <em>not</em> having <code>===</code> equality? I have concerns about the GC overhead associated with <code>CompositeKey</code> using something like weakmaps/maps as either <code>CompositeKey("a")</code> leaks forever, or it requires a FinalizationRegistry and the GC overhead for tracking/collection the object.</td></tr>
  <tr class="msg" id="L287"><td class="ts-cell"><a class="ts" href="#L287" alt="Tue Apr 09 2024 12:06:22 GMT-0700 (Pacific Daylight Time)">19:06</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@littledan:matrix.org">littledan</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> Isn't the discussion around <code>CompositeKey</code> predicated on R&amp;T <em>not</em> having <code>===</code> equality? I have concerns about the GC overhead associated with <code>CompositeKey</code> using something like weakmaps/maps as either <code>CompositeKey("a")</code> leaks forever, or it requires a FinalizationRegistry and the GC overhead for tracking/collection the object.</blockquote></mx-reply>yes, it's all predicated on === not being supported for R&amp;T</td></tr>
  <tr class="msg" id="L288"><td class="ts-cell"><a class="ts" href="#L288" alt="Tue Apr 09 2024 12:06:31 GMT-0700 (Pacific Daylight Time)">19:06</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">rbuckton</span>: that was also my confusion. the resolution is that CompositeKeys have interning semantics built in, they return deduplicated objects such that === just works like object ===, because it's literally deduplicated</td></tr>
  <tr class="msg" id="L289"><td class="ts-cell"><a class="ts" href="#L289" alt="Tue Apr 09 2024 12:06:39 GMT-0700 (Pacific Daylight Time)">19:06</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">or you forbid having a <code>CompositeKey</code> that doesn't contain an object, which is what userland does</td></tr>
  <tr class="msg" id="L290"><td class="ts-cell"><a class="ts" href="#L290" alt="Tue Apr 09 2024 12:06:50 GMT-0700 (Pacific Daylight Time)">19:06</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell">Interning semantics will have GC overhead</td></tr>
  <tr class="msg" id="L291"><td class="ts-cell"><a class="ts" href="#L291" alt="Tue Apr 09 2024 12:06:55 GMT-0700 (Pacific Daylight Time)">19:06</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</div></td><td class="msg-cell">yes indeedy</td></tr>
  <tr class="msg" id="L292"><td class="ts-cell"><a class="ts" href="#L292" alt="Tue Apr 09 2024 12:07:35 GMT-0700 (Pacific Daylight Time)">19:07</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</div></td><td class="msg-cell">but it's like, deterministic overhead that's always there, instead of non-deterministic overhead that engines have to tune for and hope they get it right for the largest swath of the code that runs</td></tr>
  <tr class="msg" id="L293"><td class="ts-cell"><a class="ts" href="#L293" alt="Tue Apr 09 2024 12:07:35 GMT-0700 (Pacific Daylight Time)">19:07</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> or you forbid having a <code>CompositeKey</code> that doesn't contain an object, which is what userland does</blockquote></mx-reply><code>CompsiteKey(obj, "a")</code> works, but <code>CompositeKey("a", "b")</code> does not? That seems like a very unstable design.</td></tr>
  <tr class="msg" id="L294"><td class="ts-cell"><a class="ts" href="#L294" alt="Tue Apr 09 2024 12:07:45 GMT-0700 (Pacific Daylight Time)">19:07</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</div></td><td class="msg-cell">which is a better place to be in, but... definitely still overhead, yes</td></tr>
  <tr class="msg" id="L295"><td class="ts-cell"><a class="ts" href="#L295" alt="Tue Apr 09 2024 12:07:54 GMT-0700 (Pacific Daylight Time)">19:07</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@aclaymore:matrix.org">Ashley Claymore</span>&gt;</div></td><td class="msg-cell">I dropped it after presenting the slides to some other people, they felt it complicated the question I was asking</td></tr>
  <tr class="msg" id="L296"><td class="ts-cell"><a class="ts" href="#L296" alt="Tue Apr 09 2024 12:08:04 GMT-0700 (Pacific Daylight Time)">19:08</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mhofman:matrix.org">Mathieu Hofman</span>&gt;</div></td><td class="msg-cell">I believe that is NOT was was presented. <code>#[1] !== #[1] </code></td></tr>
  <tr class="msg" id="L297"><td class="ts-cell"><a class="ts" href="#L297" alt="Tue Apr 09 2024 12:08:22 GMT-0700 (Pacific Daylight Time)">19:08</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell">I'm concerned about the overhead of 1000s of <code>map.get(CompositeKey(a, b))</code> in a loop.</td></tr>
  <tr class="msg" id="L298"><td class="ts-cell"><a class="ts" href="#L298" alt="Tue Apr 09 2024 12:08:34 GMT-0700 (Pacific Daylight Time)">19:08</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@eemeli:mozilla.org">eemeli</span>&gt;</div></td><td class="msg-cell">I kinda like the idea of being able to do something like 
```
new Map([], { compare: 'duck' })
```
and have that "just work".</td></tr>
  <tr class="msg" id="L299"><td class="ts-cell"><a class="ts" href="#L299" alt="Tue Apr 09 2024 12:08:34 GMT-0700 (Pacific Daylight Time)">19:08</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mhofman:matrix.org">Mathieu Hofman</span>&gt;</div></td><td class="msg-cell">but when used in collections, the equality used is the one supporting R&amp;T equality</td></tr>
  <tr class="msg" id="L300"><td class="ts-cell"><a class="ts" href="#L300" alt="Tue Apr 09 2024 12:08:34 GMT-0700 (Pacific Daylight Time)">19:08</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> I believe that is NOT was was presented. <code>#[1] !== #[1] </code></blockquote></mx-reply>CompositeKey was presented, it's just not what was proposed</td></tr>
  <tr class="msg" id="L301"><td class="ts-cell"><a class="ts" href="#L301" alt="Tue Apr 09 2024 12:10:49 GMT-0700 (Pacific Daylight Time)">19:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> I kinda like the idea of being able to do something like <br>```<br>new Map([], { compare: 'duck' })<br>```<br>and have that "just work".</blockquote></mx-reply><p><code>@esfx/collections-hashmap</code> and <code>@esfx/equatable</code> does this. You can do, say:</p>
<pre><code class="language-js">import { HashMap } from "@esfx/collections-hashmap";
import { Uri } from "./uri.js";

const map = new HashMap(undefined, { equaler: Uri.equaler });
</code></pre>
<p>where <code>Uri.equaler</code> is just an object with <code>{ equals(a, b), hash(obj) }</code>.</p>
</td></tr>
  <tr class="msg" id="L302"><td class="ts-cell"><a class="ts" href="#L302" alt="Tue Apr 09 2024 12:11:35 GMT-0700 (Pacific Daylight Time)">19:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mhofman:matrix.org">Mathieu Hofman</span>&gt;</div></td><td class="msg-cell">I'm confused about the discussion about <code>CompositeKey</code> here as it's not what was proposed, but presented as background / historical context. A R/T would, unlike CompositeKey, not have <code>===</code> equality.</td></tr>
  <tr class="msg" id="L303"><td class="ts-cell"><a class="ts" href="#L303" alt="Tue Apr 09 2024 12:13:14 GMT-0700 (Pacific Daylight Time)">19:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell">I was under the impression these were discussed as possible directions to consider, with historical context as to prior discussions within TC39.</td></tr>
  <tr class="msg" id="L304"><td class="ts-cell"><a class="ts" href="#L304" alt="Tue Apr 09 2024 12:14:38 GMT-0700 (Pacific Daylight Time)">19:14</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mhofman:matrix.org">Mathieu Hofman</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">rbuckton</span>: I don't want to build R&amp;T on top of a equals / hash mechanism IF there is any way that values can influence the hashing mechanism or any part of the program at the time they're added to a collection I created. I am fine if the collection defers to a construction time provided config.</td></tr>
  <tr class="msg" id="L305"><td class="ts-cell"><a class="ts" href="#L305" alt="Tue Apr 09 2024 12:14:45 GMT-0700 (Pacific Daylight Time)">19:14</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@aclaymore:matrix.org">Ashley Claymore</span>&gt;</div></td><td class="msg-cell">I should have been more clear. I was trying to say <code>Key(v1, v2) === Key(v1, v2)</code> is good in that it doesn't introduce a new form of equality. But from what I have heard from engines re R&amp;T and from my own research it seems difficult to make them perform well at scale, the whole app has contention on one global interning table that requires GC hooks to clean up the unused keys.</td></tr>
  <tr class="msg" id="L306"><td class="ts-cell"><a class="ts" href="#L306" alt="Tue Apr 09 2024 12:16:23 GMT-0700 (Pacific Daylight Time)">19:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell">The upside of equals/hash is that it is a known quantity. Numerous languages and runtimes use this, thus the caveats are known. </td></tr>
  <tr class="msg" id="L307"><td class="ts-cell"><a class="ts" href="#L307" alt="Tue Apr 09 2024 12:16:41 GMT-0700 (Pacific Daylight Time)">19:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell">A <code>CompositeKey</code> based on equals/hash doesn't require complex GC semantics.</td></tr>
  <tr class="msg" id="L308"><td class="ts-cell"><a class="ts" href="#L308" alt="Tue Apr 09 2024 12:19:01 GMT-0700 (Pacific Daylight Time)">19:19</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell">If you have a native <code>CompositeKey</code> with equals/hash, you just make the "default equaler" behavior used by a <code>Map</code> have a specific case for <code>CompositeKey</code> vs <code>===</code>. But then you can make that "default equaler" an actual object from which to build other equalers from.</td></tr>
  <tr class="msg" id="L309"><td class="ts-cell"><a class="ts" href="#L309" alt="Tue Apr 09 2024 12:19:04 GMT-0700 (Pacific Daylight Time)">19:19</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mhofman:matrix.org">Mathieu Hofman</span>&gt;</div></td><td class="msg-cell">To be more clear:<br><code>new Map([], {compare: Record.equals})</code> is fine, and so is <code>new Map([], {compare: customHashCodeThing}</code>, but not <code>new Map([], compareWithHashCode: true)</code> which would be assuming looking up a <code>Records.prototype[Symbol.hashCode]</code></td></tr>
  <tr class="msg" id="L310"><td class="ts-cell"><a class="ts" href="#L310" alt="Tue Apr 09 2024 12:21:46 GMT-0700 (Pacific Daylight Time)">19:21</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@aclaymore:matrix.org">Ashley Claymore</span>&gt;</div></td><td class="msg-cell">In other plenary sessions it has come up that the language should be as close to fully deterministic as we can. e.g. not exposing a browser-sniffing API. <code>Object.hash</code> feels like it would need to be fully deterministic across engines to meet these goals.<br>Perhaps I have mis-read committee comments with this goal.</td></tr>
  <tr class="msg" id="L311"><td class="ts-cell"><a class="ts" href="#L311" alt="Tue Apr 09 2024 12:22:56 GMT-0700 (Pacific Daylight Time)">19:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> To be more clear:<br><code>new Map([], {compare: Record.equals})</code> is fine, and so is <code>new Map([], {compare: customHashCodeThing}</code>, but not <code>new Map([], compareWithHashCode: true)</code> which would be assuming looking up a <code>Records.prototype[Symbol.hashCode]</code></blockquote></mx-reply>I've experimented with something like <code>[Symbol.hashCode]</code>. In well written applications its perfectly fine and would serve most users well. If you don't trust your inputs, you could opt-out with a custom equaler that doesn't call an <code>@@hashCode</code>. That said, I'm more interested in a general purpose <code>{ equals, hash }</code> mechanism for <code>Map</code>/<code>Set</code> and various other methods that do equality checks, than i am with instance-overrideable hash codes.</td></tr>
  <tr class="msg" id="L312"><td class="ts-cell"><a class="ts" href="#L312" alt="Tue Apr 09 2024 12:23:12 GMT-0700 (Pacific Daylight Time)">19:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@aclaymore:matrix.org">Ashley Claymore</span>&gt;</div></td><td class="msg-cell">I also wonder if even string hashing is not as easy to standardize in 262 due to the spec being in wtf-16 and runtimes potentially using different encodings?</td></tr>
  <tr class="msg" id="L313"><td class="ts-cell"><a class="ts" href="#L313" alt="Tue Apr 09 2024 12:32:50 GMT-0700 (Pacific Daylight Time)">19:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mhofman:matrix.org">Mathieu Hofman</span>&gt;</div></td><td class="msg-cell">We don't automatically need to expose the result of the internal hashing. We could have special values for <code>compare</code></td></tr>
  <tr class="msg" id="L314"><td class="ts-cell"><a class="ts" href="#L314" alt="Tue Apr 09 2024 12:33:50 GMT-0700 (Pacific Daylight Time)">19:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> In other plenary sessions it has come up that the language should be as close to fully deterministic as we can. e.g. not exposing a browser-sniffing API. <code>Object.hash</code> feels like it would need to be fully deterministic across engines to meet these goals.<br>Perhaps I have mis-read committee comments with this goal.</blockquote></mx-reply><p><code>Object.hash()</code> <em>shouldn't</em> be fully deterministic, at least not for strings. String hash code generators benefit from randomness as it evens out clumping due to collisions over the course of various app restarts. An implementation would also want to be able to swap from one hash algorithm to another from version to version as hash algorithms improve.</p>
<p>In .NET, you can control whether to use a randomized string hashing algorithm via configuration: <a href="https://learn.microsoft.com/en-us/dotnet/framework/configure-apps/file-schema/runtime/userandomizedstringhashalgorithm-element">https://learn.microsoft.com/en-us/dotnet/framework/configure-apps/file-schema/runtime/userandomizedstringhashalgorithm-element</a>.</p>
</td></tr>
  <tr class="msg" id="L315"><td class="ts-cell"><a class="ts" href="#L315" alt="Tue Apr 09 2024 12:34:20 GMT-0700 (Pacific Daylight Time)">19:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> We don't automatically need to expose the result of the internal hashing. We could have special values for <code>compare</code></blockquote></mx-reply>I considered describing it as an opaque value, but you need to be able to do math on it.</td></tr>
  <tr class="msg" id="L316"><td class="ts-cell"><a class="ts" href="#L316" alt="Tue Apr 09 2024 12:35:16 GMT-0700 (Pacific Daylight Time)">19:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mhofman:matrix.org">Mathieu Hofman</span>&gt;</div></td><td class="msg-cell">To follow up on <span class="nick-4">Ashley Claymore</span> 's comment, I would be opposed to any new APIs to expose non determinism to the program. It's fine for these things to remain internal to the engine, but I don't want them to be observable</td></tr>
  <tr class="msg" id="L317"><td class="ts-cell"><a class="ts" href="#L317" alt="Tue Apr 09 2024 12:37:46 GMT-0700 (Pacific Daylight Time)">19:37</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mhofman:matrix.org">Mathieu Hofman</span>&gt;</div></td><td class="msg-cell">Or should I say, the new API would have to be extremely well motivated and fairly self contained, like FR/WeakRef, but I don't think hashcode would clear that line</td></tr>
  <tr class="msg" id="L318"><td class="ts-cell"><a class="ts" href="#L318" alt="Tue Apr 09 2024 12:38:12 GMT-0700 (Pacific Daylight Time)">19:38</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell"><p>For example</p>
<pre><code class="language-js">class Point {
  #x;
  #y;
  constructor(x, y) {
    this.#x = x;
    this.#y = y;
  }
  get x() { return this.#x; }
  get y() { return this.#y; }
  static equaler = {
    equals(a, b) {
      return #x in a &amp;&amp; #x in b &amp;&amp; a.#x === b.#x &amp;&amp; a.#y === b.#y;
    },
    hash(obj) {
      let hc = Object.hash(obj.#x);
      hc = ((hc &lt;&lt; 7) | (hc &gt;&gt;&gt; 25)) ^ Object.hash(obj.#y);
      return hc;
    }
  }
}
</code></pre>
</td></tr>
  <tr class="msg" id="L319"><td class="ts-cell"><a class="ts" href="#L319" alt="Tue Apr 09 2024 12:40:02 GMT-0700 (Pacific Daylight Time)">19:40</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mhofman:matrix.org">Mathieu Hofman</span>&gt;</div></td><td class="msg-cell">I honestly don't understand why <code>hashLike(obj) { return #[Point, obj.#x, obj.#y]; }</code> is not an acceptable approach. Engines are definitely capable of optimizing this</td></tr>
  <tr class="msg" id="L320"><td class="ts-cell"><a class="ts" href="#L320" alt="Tue Apr 09 2024 12:41:52 GMT-0700 (Pacific Daylight Time)">19:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell">Capable does not mean willing or likely to do so.</td></tr>
  <tr class="msg" id="L321"><td class="ts-cell"><a class="ts" href="#L321" alt="Tue Apr 09 2024 12:43:20 GMT-0700 (Pacific Daylight Time)">19:43</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell">And that still doesn't let me write a hashtable. I need something I can use as a numeric index with good avalanche properties. Maybe 95% of users don't need this, but its a headache for the small percent that do need it for a good reason.</td></tr>
  <tr class="msg" id="L322"><td class="ts-cell"><a class="ts" href="#L322" alt="Tue Apr 09 2024 12:48:02 GMT-0700 (Pacific Daylight Time)">19:48</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell"><p>For example, I had to do quite a bit to workaround this limitation when experimenting with the shared structs dev trial. I had a very strong need for a concurrent Map, which required implementing a hash table. It would have been far easier if I could actually generate a hash for a string or an object: <a href="https://github.com/microsoft/TypeScript/blob/shared-struct-test/src/compiler/sharing/collections/concurrentMap.ts">https://github.com/microsoft/TypeScript/blob/shared-struct-test/src/compiler/sharing/collections/concurrentMap.ts</a></p>
<p>Yes, maybe we would want to add a <code>ConcurrentMap</code> after we add shared structs, but that's certainly not going to be in the MVP.</p>
</td></tr>
  <tr class="msg" id="L323"><td class="ts-cell"><a class="ts" href="#L323" alt="Tue Apr 09 2024 12:55:51 GMT-0700 (Pacific Daylight Time)">19:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mhofman:matrix.org">Mathieu Hofman</span>&gt;</div></td><td class="msg-cell">generating a non-deterministic value from a basic value like and object or a string feels like a non starter for me. I'd claim it's not needed by 99.9999% of JS authors</td></tr>
  <tr class="msg" id="L324"><td class="ts-cell"><a class="ts" href="#L324" alt="Tue Apr 09 2024 12:56:24 GMT-0700 (Pacific Daylight Time)">19:56</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell">Hash bucket lookup is approximately O(1), while a user-built collection relying on manually comparing tuples is O(n), and if you can't compare tuples using <code>===</code>, it's O(n*m) where <code>m</code> is the number of keys in the tuple.</td></tr>
  <tr class="msg" id="L325"><td class="ts-cell"><a class="ts" href="#L325" alt="Tue Apr 09 2024 13:01:49 GMT-0700 (Pacific Daylight Time)">20:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell">Then call the method <code>Object.nondeterministicHash(obj)</code> or <code>Object.randomHash(obj)</code> or document the non-deterministic nature on MDN. If you were an implementer that internally used murmur3 for string hashing and found you could speed up all applications by a significant percentage by switching to xxhash64, wouldn't you do so? <code>Object.hash()</code> must be explicitly "non-deterministic" from the get-go just so anyone consuming it could reap the same benefits if a better hash algorithm comes along.</td></tr>
  <tr class="msg" id="L326"><td class="ts-cell"><a class="ts" href="#L326" alt="Tue Apr 09 2024 13:03:20 GMT-0700 (Pacific Daylight Time)">20:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell">Case in point, even if you're using the non-random string hash algorithm in .NET, <code>Object.GetHashCode()</code> is still considered to be non-deterministic as upgrading the version can change the hash algorithm to one that is more efficient.</td></tr>
  <tr class="msg" id="L327"><td class="ts-cell"><a class="ts" href="#L327" alt="Tue Apr 09 2024 13:03:27 GMT-0700 (Pacific Daylight Time)">20:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mhofman:matrix.org">Mathieu Hofman</span>&gt;</div></td><td class="msg-cell">I just don't think there is sufficient motivation to expose this in the language</td></tr>
  <tr class="msg" id="L328"><td class="ts-cell"><a class="ts" href="#L328" alt="Tue Apr 09 2024 13:09:22 GMT-0700 (Pacific Daylight Time)">20:09</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell">I'd argue that the number of times we've discussed mechanisms for customizing equality indicates it <em>is</em> sufficient motivation. The main reason I want custom equality for Map/Set at all is related to performance. You can use them as-is as long as you're willing to sacrifice performance and memory at the cost of the overhead introduced by alternatives. I want custom <code>Map</code> equality so that I <em>don't</em> have to <code>.toString()</code> every Uri I use as a key in a <code>map.get()</code>. Forcing custom collections to operate at O(n) while native collections can have O(1) because they can cheat and do the hashtable lookup is not the answer when your algorithms are performance-critical.</td></tr>
  <tr class="msg" id="L329"><td class="ts-cell"><a class="ts" href="#L329" alt="Tue Apr 09 2024 13:18:40 GMT-0700 (Pacific Daylight Time)">20:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell"><p>I'm not saying that <code>Object.hash()</code> must return a number, but that you could conceivably do all the things you would need to do to implement a hash table for an alternative to be a reasonable compromise. For example, let's say we had an API like this:</p>
<pre><code class="language-ts">interface Equaler&lt;T&gt; {
  equals(a: T, b: T): boolean;
  hash(a: T): opaque;
}
</code></pre>
<p>where <code>hash</code> returns an opaque value. I'd need, at a minimum, something like this as well:</p>
<pre><code class="language-ts">declare const defaultEqualer: Equaler&lt;unknown&gt;;
declare function combineHash(a: opaque, b: opaque): opaque;
interface HashArray&lt;T&gt; {
  length: number;
  [hash: opaque]: T;
  ...
}
interface SharedHashArray&lt;T&gt; {
  length: number;
  [hash: opaque]: T;
  ...
}
</code></pre>
<p>to have any possibility of achieving similar perf to it being a number.</p>
</td></tr>
  <tr class="msg" id="L330"><td class="ts-cell"><a class="ts" href="#L330" alt="Tue Apr 09 2024 13:18:47 GMT-0700 (Pacific Daylight Time)">20:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mhofman:matrix.org">Mathieu Hofman</span>&gt;</div></td><td class="msg-cell">You can customize equality using the <code>hashLike</code> approach I suggested above. It is also optimizable by engines.</td></tr>
  <tr class="msg" id="L331"><td class="ts-cell"><a class="ts" href="#L331" alt="Tue Apr 09 2024 13:19:46 GMT-0700 (Pacific Daylight Time)">20:19</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mhofman:matrix.org">Mathieu Hofman</span>&gt;</div></td><td class="msg-cell">The combine hash is exactly what creating a R/T with your components does</td></tr>
  <tr class="msg" id="L332"><td class="ts-cell"><a class="ts" href="#L332" alt="Tue Apr 09 2024 13:20:13 GMT-0700 (Pacific Daylight Time)">20:20</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell">But not for a custom collection. As I said, native <code>Map</code>/<code>Set</code> could cheat and unwrap a composite key to do a hashtable lookup for O(1), but a custom collection would be O(n) at best.</td></tr>
  <tr class="msg" id="L333"><td class="ts-cell"><a class="ts" href="#L333" alt="Tue Apr 09 2024 13:21:27 GMT-0700 (Pacific Daylight Time)">20:21</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell">I think a design that ignores custom collections is too short sighted. </td></tr>
  <tr class="msg" id="L334"><td class="ts-cell"><a class="ts" href="#L334" alt="Tue Apr 09 2024 13:22:09 GMT-0700 (Pacific Daylight Time)">20:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mhofman:matrix.org">Mathieu Hofman</span>&gt;</div></td><td class="msg-cell">Sorry I don't understand how your opaque hash is any different than a R/T</td></tr>
  <tr class="msg" id="L335"><td class="ts-cell"><a class="ts" href="#L335" alt="Tue Apr 09 2024 13:22:39 GMT-0700 (Pacific Daylight Time)">20:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell">The opaque hash is just a number you can't actually see into.</td></tr>
  <tr class="msg" id="L336"><td class="ts-cell"><a class="ts" href="#L336" alt="Tue Apr 09 2024 13:23:21 GMT-0700 (Pacific Daylight Time)">20:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell">The only reason it would be opaque is so that users can't depend on the actual value.</td></tr>
  <tr class="msg" id="L337"><td class="ts-cell"><a class="ts" href="#L337" alt="Tue Apr 09 2024 13:23:40 GMT-0700 (Pacific Daylight Time)">20:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell">If it were a tuple, you couldn't use it as an index into an array of hash buckets.</td></tr>
  <tr class="msg" id="L338"><td class="ts-cell"><a class="ts" href="#L338" alt="Tue Apr 09 2024 13:24:03 GMT-0700 (Pacific Daylight Time)">20:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell">If it were a number, or an opaque value that's actually just a number, then you conceivably could.</td></tr>
  <tr class="msg" id="L339"><td class="ts-cell"><a class="ts" href="#L339" alt="Tue Apr 09 2024 13:24:33 GMT-0700 (Pacific Daylight Time)">20:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell">Numbers are just far easier to reason over since we already have <code>Array</code> and shared structs would have <code>SharedArray</code>.</td></tr>
  <tr class="msg" id="L340"><td class="ts-cell"><a class="ts" href="#L340" alt="Tue Apr 09 2024 13:25:42 GMT-0700 (Pacific Daylight Time)">20:25</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell">To use a hash code efficiently, I need to be able to compare it using <code>===</code>, shift it using <code>&lt;&lt;</code> and <code>&gt;&gt;&gt;</code>, combine it using <code>^</code>, and use it as the index into an array. All of these operations are extremely fast using 32-bit integers.</td></tr>
  <tr class="msg" id="L341"><td class="ts-cell"><a class="ts" href="#L341" alt="Tue Apr 09 2024 13:28:16 GMT-0700 (Pacific Daylight Time)">20:28</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell"><code>#[a, b, c]</code> has no avalanche properties I can use to ensure proper distribution in a hashtable, and cannot be used as an index, so comparing keys using <code>#[a, b, c]</code> in a custom collection is at least O(n*3), since I must compare the elements of every key in the map to the elements in the provided key. It's terribly inefficient.</td></tr>
  <tr class="msg" id="L342"><td class="ts-cell"><a class="ts" href="#L342" alt="Tue Apr 09 2024 13:32:43 GMT-0700 (Pacific Daylight Time)">20:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mhofman:matrix.org">Mathieu Hofman</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> If it were a tuple, you couldn't use it as an index into an array of hash buckets.</blockquote></mx-reply>You could use it as a key in a Map, how is it different?</td></tr>
  <tr class="msg" id="L343"><td class="ts-cell"><a class="ts" href="#L343" alt="Tue Apr 09 2024 13:33:00 GMT-0700 (Pacific Daylight Time)">20:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell">not across threads</td></tr>
  <tr class="msg" id="L344"><td class="ts-cell"><a class="ts" href="#L344" alt="Tue Apr 09 2024 13:33:29 GMT-0700 (Pacific Daylight Time)">20:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mhofman:matrix.org">Mathieu Hofman</span>&gt;</div></td><td class="msg-cell">if the "opaque" number value is actually observable by the program, even indirectly, it defeats the purpose of being opaque</td></tr>
  <tr class="msg" id="L345"><td class="ts-cell"><a class="ts" href="#L345" alt="Tue Apr 09 2024 13:34:29 GMT-0700 (Pacific Daylight Time)">20:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell">And that assumes that all JS devs will only ever need <code>Map</code> and <code>Set</code>, and that there are no other collection classes JS does not implement that will ever be needed.</td></tr>
  <tr class="msg" id="L346"><td class="ts-cell"><a class="ts" href="#L346" alt="Tue Apr 09 2024 13:34:47 GMT-0700 (Pacific Daylight Time)">20:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mhofman:matrix.org">Mathieu Hofman</span>&gt;</div></td><td class="msg-cell">when you said opaque, I had assumed actually opaque, like a unique symbol, or empty object</td></tr>
  <tr class="msg" id="L347"><td class="ts-cell"><a class="ts" href="#L347" alt="Tue Apr 09 2024 13:35:05 GMT-0700 (Pacific Daylight Time)">20:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mhofman:matrix.org">Mathieu Hofman</span>&gt;</div></td><td class="msg-cell">anything else is not opaque by my definition</td></tr>
  <tr class="msg" id="L348"><td class="ts-cell"><a class="ts" href="#L348" alt="Tue Apr 09 2024 13:35:39 GMT-0700 (Pacific Daylight Time)">20:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell">I don't need it to be opaque. I'm saying the only way an opaque value would work for me is if it could have the same properties I would need from an integer hash code.</td></tr>
  <tr class="msg" id="L349"><td class="ts-cell"><a class="ts" href="#L349" alt="Tue Apr 09 2024 13:36:38 GMT-0700 (Pacific Daylight Time)">20:36</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell">The problem is that if it's not a 32-bit integer, it becomes a boxed value in most implementations, and those are going to be slower.</td></tr>
  <tr class="msg" id="L350"><td class="ts-cell"><a class="ts" href="#L350" alt="Tue Apr 09 2024 13:49:09 GMT-0700 (Pacific Daylight Time)">20:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell"><p>Let me summarize my thoughts:</p>
<ul>
<li>Any mechanism to customize equality for <code>Map</code> and <code>Set</code> should be done in a way that could be leveraged by a custom collection. Anything less is too short sighted.</li>
<li>Using a composite key/tuple will not give me the performance characteristics I would need in a custom collection, as it would result in O(n*m) lookup time.</li>
<li>Equals/hash can be employed by a hashtable in a custom collection for O(1) lookup time.</li>
<li>Using a composite key/tuple would not be compatible with custom collections under shared memory multithreading, which are likely to be necessary since concurrent/synchronized collections are not part of the shared structs MVP.</li>
<li>Composite keys require an allocation that is likely to be repeated for every call to <code>map.get</code>. Engines <em>could</em> optimize, but likely won't do so immediately, if ever.</li>
<li>A composite key mechanism can be implemented on top of equals/hash such that a WeakMap/Map-based registry is unnecessary. equals/hash cannot be implemented on top of a composite key.</li>
<li>Equals/hash can use 32-bit integers, <code>&lt;&lt;</code>, <code>&gt;&gt;&gt;</code> and <code>^</code>, which are all already fast and optimized. Opaque values require boxing, making them slow (see bigint performance as an example)</li>
</ul>
</td></tr>
  <tr class="msg" id="L351"><td class="ts-cell"><a class="ts" href="#L351" alt="Tue Apr 09 2024 13:52:37 GMT-0700 (Pacific Daylight Time)">20:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mhofman:matrix.org">Mathieu Hofman</span>&gt;</div></td><td class="msg-cell">I'm saying that any value that is a source of observable non determinism does not seem sufficiently motivated for a "keying" mechanism when there are alternatives that cover most of the use cases except performance, which can be optimized, or shared memory, which is a hypothetical future, and could have its own collections API. JS is a high level language that does not expose low level / internal details of its objects or memory layout. exposing hash code would change that</td></tr>
  <tr class="msg" id="L352"><td class="ts-cell"><a class="ts" href="#L352" alt="Tue Apr 09 2024 13:54:48 GMT-0700 (Pacific Daylight Time)">20:54</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@aclaymore:matrix.org">Ashley Claymore</span>&gt;</div></td><td class="msg-cell"><blockquote>
<p>Composite keys require an allocation that is likely to be repeated for every call to map.get. Engines could optimize, but likely won't do so immediately, if ever.</p>
</blockquote>
<p>The idea with R&amp;T is that, being objects and arrays. In many cases they are the data structure, so there is no extra allocation for these cases</p>
</td></tr>
  <tr class="msg" id="L353"><td class="ts-cell"><a class="ts" href="#L353" alt="Tue Apr 09 2024 13:56:17 GMT-0700 (Pacific Daylight Time)">20:56</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell">As I've discovered while discussing array iterator performance, "can be optimized" isn't a useful metric. Implementations won't optimize unless they have very good reason to. Array destructuring has been around for ~9 years and still isn't optimized.</td></tr>
  <tr class="msg" id="L354"><td class="ts-cell"><a class="ts" href="#L354" alt="Tue Apr 09 2024 13:59:13 GMT-0700 (Pacific Daylight Time)">20:59</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> <blockquote>
<p>Composite keys require an allocation that is likely to be repeated for every call to map.get. Engines could optimize, but likely won't do so immediately, if ever.</p>
</blockquote>
<p>The idea with R&amp;T is that, being objects and arrays. In many cases they are the data structure, so there is no extra allocation for these cases</p>
</blockquote></mx-reply>@bakkot's example in matrix earlier shows this to not be true. The keys are often a subset of the data structure, and will very likely be generated on the fly.</td></tr>
  <tr class="msg" id="L355"><td class="ts-cell"><a class="ts" href="#L355" alt="Tue Apr 09 2024 13:59:17 GMT-0700 (Pacific Daylight Time)">20:59</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@aclaymore:matrix.org">Ashley Claymore</span>&gt;</div></td><td class="msg-cell">If the data model of the application is already using R&amp;T. Inserting these into a map could be the fastest case. Because all the hashing and equality operations are entirely native, with zero entry into userland minimizing guards and allowing JIT.</td></tr>
  <tr class="msg" id="L356"><td class="ts-cell"><a class="ts" href="#L356" alt="Tue Apr 09 2024 13:59:52 GMT-0700 (Pacific Daylight Time)">20:59</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@aclaymore:matrix.org">Ashley Claymore</span>&gt;</div></td><td class="msg-cell"><blockquote>
<p>The keys are often a subset of the data structure</p>
</blockquote>
<p>If this really is common, then apps could keep those parts of the data structure seperate</p>
</td></tr>
  <tr class="msg" id="L357"><td class="ts-cell"><a class="ts" href="#L357" alt="Tue Apr 09 2024 14:00:10 GMT-0700 (Pacific Daylight Time)">21:00</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> If the data model of the application is already using R&amp;T. Inserting these into a map could be the fastest case. Because all the hashing and equality operations are entirely native, with zero entry into userland minimizing guards and allowing JIT.</blockquote></mx-reply>You're only proving my point. <code>Map</code> and <code>Set</code> can only have O(1) performance for a tuple as a composite key if they use equals/hash internally. Custom collections cannot do the same.</td></tr>
  <tr class="msg" id="L358"><td class="ts-cell"><a class="ts" href="#L358" alt="Tue Apr 09 2024 14:00:36 GMT-0700 (Pacific Daylight Time)">21:00</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mhofman:matrix.org">Mathieu Hofman</span>&gt;</div></td><td class="msg-cell">Custom collections can use Map/Set internally for the vast majority of custom use cases</td></tr>
  <tr class="msg" id="L359"><td class="ts-cell"><a class="ts" href="#L359" alt="Tue Apr 09 2024 14:00:58 GMT-0700 (Pacific Daylight Time)">21:00</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@aclaymore:matrix.org">Ashley Claymore</span>&gt;</div></td><td class="msg-cell">Yes. I said earlier. The implementations must use hash + equals at some layer. I 100% agree that the pattern is efficent</td></tr>
  <tr class="msg" id="L360"><td class="ts-cell"><a class="ts" href="#L360" alt="Tue Apr 09 2024 14:01:01 GMT-0700 (Pacific Daylight Time)">21:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell">custom collections aren't an ephemeral thing, there is production code that uses them. The perf hit is likely the only reason they aren't used more.</td></tr>
  <tr class="msg" id="L361"><td class="ts-cell"><a class="ts" href="#L361" alt="Tue Apr 09 2024 14:01:38 GMT-0700 (Pacific Daylight Time)">21:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@aclaymore:matrix.org">Ashley Claymore</span>&gt;</div></td><td class="msg-cell">The custom collections I've needed were wrappers around Maps</td></tr>
  <tr class="msg" id="L362"><td class="ts-cell"><a class="ts" href="#L362" alt="Tue Apr 09 2024 14:01:56 GMT-0700 (Pacific Daylight Time)">21:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@aclaymore:matrix.org">Ashley Claymore</span>&gt;</div></td><td class="msg-cell">I'd be interested in hearing about other cases. I'm familiar with the ConcurrentMap one.</td></tr>
  <tr class="msg" id="L363"><td class="ts-cell"><a class="ts" href="#L363" alt="Tue Apr 09 2024 14:07:58 GMT-0700 (Pacific Daylight Time)">21:07</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> The custom collections I've needed were wrappers around Maps</blockquote></mx-reply>This is often the case, but these are often still inefficient. You often have to do some type of conversion for every <code>get</code>/<code>set</code>, which can result in unnecessary allocations. You could build a custom map that does case insensitive string comparisons on keys by passing them through a case folding algorithm, but that's terribly inefficient. For a case insensitive comparison, you might use case folding on the string to compare, but then you're also producing another string in memory. If you want to preserve the input key as written, you have to store both the original key and value as the map entry, resulting in another allocation and duplication, plus the need to wrap <code>keys()</code>, <code>values()</code>, etc. This is all unnecessary overhead.</td></tr>
  <tr class="msg" id="L364"><td class="ts-cell"><a class="ts" href="#L364" alt="Tue Apr 09 2024 14:09:47 GMT-0700 (Pacific Daylight Time)">21:09</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@aclaymore:matrix.org">Ashley Claymore</span>&gt;</div></td><td class="msg-cell">Gotcha. That matches my understanding. It's not that lots of custom collections can't be built, but they will need to do more allocations.</td></tr>
  <tr class="msg" id="L365"><td class="ts-cell"><a class="ts" href="#L365" alt="Tue Apr 09 2024 14:11:48 GMT-0700 (Pacific Daylight Time)">21:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell">Map/Set wrappers can be built with allocation overhead, but only if their keys are easily translated to something that works as an existing key. Complex objects end up requiring O(n)</td></tr>
  <tr class="msg" id="L366"><td class="ts-cell"><a class="ts" href="#L366" alt="Tue Apr 09 2024 14:12:51 GMT-0700 (Pacific Daylight Time)">21:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell">Even if you are using weakmap/map registries to ensure a composite key has the same identity, that's <em>still</em> O(n) if you're writing <code>map.get(CompositeKey(a, b))</code>. You're just paying the O(n) cost walking the registry.</td></tr>
  <tr class="msg" id="L367"><td class="ts-cell"><a class="ts" href="#L367" alt="Tue Apr 09 2024 14:13:34 GMT-0700 (Pacific Daylight Time)">21:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell">i.e., for n steps, you're doing an O(1) operation for each step.</td></tr>
  <tr class="msg" id="L368"><td class="ts-cell"><a class="ts" href="#L368" alt="Tue Apr 09 2024 14:13:44 GMT-0700 (Pacific Daylight Time)">21:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@aclaymore:matrix.org">Ashley Claymore</span>&gt;</div></td><td class="msg-cell">what is n here?</td></tr>
  <tr class="msg" id="L369"><td class="ts-cell"><a class="ts" href="#L369" alt="Tue Apr 09 2024 14:13:52 GMT-0700 (Pacific Daylight Time)">21:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell">n is the number of elements in the composite key.</td></tr>
  <tr class="msg" id="L370"><td class="ts-cell"><a class="ts" href="#L370" alt="Tue Apr 09 2024 14:14:12 GMT-0700 (Pacific Daylight Time)">21:14</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@aclaymore:matrix.org">Ashley Claymore</span>&gt;</div></td><td class="msg-cell">ok. I thought you were referring to collection size and got confused</td></tr>
  <tr class="msg" id="L371"><td class="ts-cell"><a class="ts" href="#L371" alt="Tue Apr 09 2024 14:14:17 GMT-0700 (Pacific Daylight Time)">21:14</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell"><a href="https://docs.google.com/presentation/d/1JfChmW8tQ2_mrFDynosNqa1tjJ2j-qX6WoKm8vc_tkY/edit#slide=id.g2c6eebea946_0_40">https://docs.google.com/presentation/d/1JfChmW8tQ2_mrFDynosNqa1tjJ2j-qX6WoKm8vc_tkY/edit#slide=id.g2c6eebea946_0_40</a></td></tr>
  <tr class="msg" id="L372"><td class="ts-cell"><a class="ts" href="#L372" alt="Tue Apr 09 2024 14:14:38 GMT-0700 (Pacific Daylight Time)">21:14</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell">Sorry, I should have said m instead of n for that case.</td></tr>
  <tr class="msg" id="L373"><td class="ts-cell"><a class="ts" href="#L373" alt="Tue Apr 09 2024 14:17:37 GMT-0700 (Pacific Daylight Time)">21:17</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@littledan:matrix.org">littledan</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> <p>Let me summarize my thoughts:</p>
<ul>
<li>Any mechanism to customize equality for <code>Map</code> and <code>Set</code> should be done in a way that could be leveraged by a custom collection. Anything less is too short sighted.</li>
<li>Using a composite key/tuple will not give me the performance characteristics I would need in a custom collection, as it would result in O(n*m) lookup time.</li>
<li>Equals/hash can be employed by a hashtable in a custom collection for O(1) lookup time.</li>
<li>Using a composite key/tuple would not be compatible with custom collections under shared memory multithreading, which are likely to be necessary since concurrent/synchronized collections are not part of the shared structs MVP.</li>
<li>Composite keys require an allocation that is likely to be repeated for every call to <code>map.get</code>. Engines <em>could</em> optimize, but likely won't do so immediately, if ever.</li>
<li>A composite key mechanism can be implemented on top of equals/hash such that a WeakMap/Map-based registry is unnecessary. equals/hash cannot be implemented on top of a composite key.</li>
<li>Equals/hash can use 32-bit integers, <code>&lt;&lt;</code>, <code>&gt;&gt;&gt;</code> and <code>^</code>, which are all already fast and optimized. Opaque values require boxing, making them slow (see bigint performance as an example)</li>
</ul>
</blockquote></mx-reply>we actually added Map and Set as built-ins without having a way that what they do could be done in a custom collection. Of course it would be nice to support efficient maps defined in JS if possible given all of the other goals and constraints, but I don't see why it makes sense to say that no advances should be made for Map and Set without managing to support this other goal.</td></tr>
  <tr class="msg" id="L374"><td class="ts-cell"><a class="ts" href="#L374" alt="Tue Apr 09 2024 14:18:40 GMT-0700 (Pacific Daylight Time)">21:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@littledan:matrix.org">littledan</span>&gt;</div></td><td class="msg-cell">the composite-ness of composite keys or R&amp;T doesn't actually depend on any new built-in thing, but identity hashcodes continue to not be exposed</td></tr>

</tbody></table></div></div></div>
</body></html>
<!DOCTYPE html><html><head>
  <title>TC39 Delegates on 2023-03-23</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "TC39 Delegates";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">TC39 Delegates<br>2023-03-23<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2023-03-22" class="nav-link"><span>prev</span></a>
<span style="float:right">next</span>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">
<div class="rhs-header">
<span id="error" style="color: red; display:none">error</span>

<input type="text" id="query" size="25" placeholder="Search TC39 Delegates">
<a id="search-submit" class="button icon-link" title="Search">
  <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"></path></svg>
</a>
</div>

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Wed Mar 22 2023 17:00:50 GMT-0700 (Pacific Daylight Time)">00:00</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">re: <span class="nick-10">waldemar</span>'s point, I agree that more general async dataflow would be great, and is something we should explore, though I think I'd still want this proposal for simple case</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Wed Mar 22 2023 17:02:28 GMT-0700 (Pacific Daylight Time)">00:02</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@justinfagnani:matrix.org">justinfagnani</span>&gt;</div></td><td class="msg-cell">re: Mark's comments now... when you see a ton of code that's accidentally serial instead of parallel, you really wish for a better syntax for all of this that doesn't encourage bad behavior</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Wed Mar 22 2023 17:06:53 GMT-0700 (Pacific Daylight Time)">00:06</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@haxjs:matrix.org">HE Shi-Jun</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> re: <span class="nick-10">waldemar</span>'s point, I agree that more general async dataflow would be great, and is something we should explore, though I think I'd still want this proposal for simple case</blockquote></mx-reply>but it seems not have big benefit for simple case :)</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Wed Mar 22 2023 17:09:19 GMT-0700 (Pacific Daylight Time)">00:09</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell">I'm fairly certain a cover grammar is feasible for <code>await using</code>, the big question is whether what I have put together is correct. Given the NLT restrictions, an <code>await using</code> declaration must have the first identifier in the binding list on the same line as <code>await using</code>, and that is always a syntax error in the expression case. Binding patterns aren't permitted in <code>using</code>, so there is no ambiguity with <code>await using [x]</code>.</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Wed Mar 22 2023 17:10:06 GMT-0700 (Pacific Daylight Time)">00:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</div></td><td class="msg-cell">i'm gonna level with you <span class="nick-15">rbuckton</span>, i do not have enough brainpower left today to vet that cover grammar</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Wed Mar 22 2023 17:10:19 GMT-0700 (Pacific Daylight Time)">00:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</div></td><td class="msg-cell">though i'm more interested in how hard it is to implement in a recursive-descent parser anyhow</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Wed Mar 22 2023 17:10:44 GMT-0700 (Pacific Daylight Time)">00:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</div></td><td class="msg-cell">i'll try to put time aside before plenary tomorrow to look, but... i also have a presentation tomorrow first thing so also no promises</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Wed Mar 22 2023 17:14:04 GMT-0700 (Pacific Daylight Time)">00:14</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell">The gist of it is, the cover is identical to AwaitExpression, but UnaryExpression would fail to parse <code>await using x</code> when <code>x</code> is on the same line.  AwaitUsingDeclaration however would be able to consume the cover along with a trailing <code>[no LineTerminator here] BindingList</code>, which seems pretty much equivalent to CoverParenthesizedExpressionAndArrowParameterList and CoverCallExpressionAndAsyncArrowHead</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Wed Mar 22 2023 17:16:20 GMT-0700 (Pacific Daylight Time)">00:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</div></td><td class="msg-cell">that... sounds reasonable</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Wed Mar 22 2023 17:16:27 GMT-0700 (Pacific Daylight Time)">00:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell">Though I'll admit, cover grammars in the spec today sometimes seem a bit hand-wavy in a couple places.</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Wed Mar 22 2023 17:16:53 GMT-0700 (Pacific Daylight Time)">00:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</div></td><td class="msg-cell">and i just do a bounded look ahead <code>await</code> <code>using</code> and see if it's an NLTH identifier</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Wed Mar 22 2023 17:17:07 GMT-0700 (Pacific Daylight Time)">00:17</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</div></td><td class="msg-cell">in +Await contexts</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Wed Mar 22 2023 17:17:20 GMT-0700 (Pacific Daylight Time)">00:17</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell">In TS I'd just do two-token lookahead in +Await</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Wed Mar 22 2023 17:17:53 GMT-0700 (Pacific Daylight Time)">00:17</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell">That is one benefit of <code>await using</code> over <code>async using</code>. For <code>await using</code>, both uses of the cover are in +Await, while for <code>async using</code>, only one is.</td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Wed Mar 22 2023 17:18:56 GMT-0700 (Pacific Daylight Time)">00:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</div></td><td class="msg-cell">and <code>await using</code> without a binding list is unaffected?</td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Wed Mar 22 2023 17:19:19 GMT-0700 (Pacific Daylight Time)">00:19</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</div></td><td class="msg-cell">well, is supposed to be, according to the cover</td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Wed Mar 22 2023 17:19:43 GMT-0700 (Pacific Daylight Time)">00:19</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> In TS I'd just do two-token lookahead in +Await</blockquote></mx-reply>In fact, I've already done that in my current work on <code>using</code> (I was experimenting with all three syntax options).</td></tr>
  <tr class="msg" id="L17"><td class="ts-cell"><a class="ts" href="#L17" alt="Wed Mar 22 2023 17:20:02 GMT-0700 (Pacific Daylight Time)">00:20</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</div></td><td class="msg-cell">is TS a hand-written recursive-descent?</td></tr>
  <tr class="msg" id="L18"><td class="ts-cell"><a class="ts" href="#L18" alt="Wed Mar 22 2023 17:22:03 GMT-0700 (Pacific Daylight Time)">00:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> and <code>await using</code> without a binding list is unaffected?</blockquote></mx-reply>I'm not sure what you mean by this. <code>await using</code> on its own, or anywhere else legal for a UnaryExpression, should end up treated as an AwaitExpression.</td></tr>
  <tr class="msg" id="L19"><td class="ts-cell"><a class="ts" href="#L19" alt="Wed Mar 22 2023 17:22:15 GMT-0700 (Pacific Daylight Time)">00:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</div></td><td class="msg-cell"> yes, that is what i meant</td></tr>
  <tr class="msg" id="L20"><td class="ts-cell"><a class="ts" href="#L20" alt="Wed Mar 22 2023 17:25:06 GMT-0700 (Pacific Daylight Time)">00:25</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell">From my understanding of cover grammars, we would eagerly parse CoverAwaitExpressionAndAwaitUsingDeclarationHead, but fail to parse the rest of ExpressionStatement. We could then retry the parse as part of AwaitUsingDeclaration, reusing the cover, and be able to successfully continue to parse. Then static semantics kick in and validate that the CoverAwaitExpressionAndAwaitUsingDeclarationHead is a valid AwaitUsingDeclarationHead (e.g., <code>await [NLT] using</code>)</td></tr>
  <tr class="msg" id="L21"><td class="ts-cell"><a class="ts" href="#L21" alt="Wed Mar 22 2023 17:25:22 GMT-0700 (Pacific Daylight Time)">00:25</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</div></td><td class="msg-cell">i am happy enough to go forward with stage 3</td></tr>
  <tr class="msg" id="L22"><td class="ts-cell"><a class="ts" href="#L22" alt="Wed Mar 22 2023 17:27:41 GMT-0700 (Pacific Daylight Time)">00:27</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell">I will amend the slides with a summary of these changes and wait to see if Waldemar is able to provide feedback in the meantime.</td></tr>
  <tr class="msg" id="L23"><td class="ts-cell"><a class="ts" href="#L23" alt="Wed Mar 22 2023 19:53:36 GMT-0700 (Pacific Daylight Time)">02:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@michaelficarra:matrix.org">Michael Ficarra</span>&gt;</div></td><td class="msg-cell">is there anything we need to do to get Decimal on the overflow, or will it be taken care of?</td></tr>
  <tr class="msg" id="L24"><td class="ts-cell"><a class="ts" href="#L24" alt="Wed Mar 22 2023 20:09:41 GMT-0700 (Pacific Daylight Time)">03:09</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@littledan:matrix.org">littledan</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> is there anything we need to do to get Decimal on the overflow, or will it be taken care of?</blockquote></mx-reply>If there is time to go through the queue for decimal, that would be great, but we could also do that next meeting</td></tr>
  <tr class="msg" id="L25"><td class="ts-cell"><a class="ts" href="#L25" alt="Wed Mar 22 2023 20:10:11 GMT-0700 (Pacific Daylight Time)">03:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@michaelficarra:matrix.org">Michael Ficarra</span>&gt;</div></td><td class="msg-cell">of course, I just wanted to record it on the list of overflow items</td></tr>
  <tr class="msg" id="L26"><td class="ts-cell"><a class="ts" href="#L26" alt="Wed Mar 22 2023 23:15:01 GMT-0700 (Pacific Daylight Time)">06:15</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell"><span class="nick-6">ljharb</span>: I made some slides just for mark, if we have time tomorrow, PTAL: <a href="https://docs.google.com/presentation/d/1s1IZSo24JpMsI_NponP8vvIKUazld62lcleKF976Ppc/edit?usp=sharing">https://docs.google.com/presentation/d/1s1IZSo24JpMsI_NponP8vvIKUazld62lcleKF976Ppc/edit?usp=sharing</a></td></tr>
  <tr class="msg" id="L27"><td class="ts-cell"><a class="ts" href="#L27" alt="Thu Mar 23 2023 07:01:22 GMT-0700 (Pacific Daylight Time)">14:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-11" title="@gibson042:matrix.org">Richard Gibson</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> <span class="nick-6">ljharb</span>: I made some slides just for mark, if we have time tomorrow, PTAL: <a href="https://docs.google.com/presentation/d/1s1IZSo24JpMsI_NponP8vvIKUazld62lcleKF976Ppc/edit?usp=sharing">https://docs.google.com/presentation/d/1s1IZSo24JpMsI_NponP8vvIKUazld62lcleKF976Ppc/edit?usp=sharing</a></blockquote></mx-reply>note the changes would need to be more substantive for dealing with <a href="https://github.com/tc39/ecma262/pull/2418"><code>v</code>-mode</a>, which has a wider set of reserved punctuators and semantics for doubled punctuators (<a href="https://github.com/tc39/proposal-regexp-v-flag#how-is-the-v-flag-different-from-the-u-flag">https://github.com/tc39/proposal-regexp-v-flag#how-is-the-v-flag-different-from-the-u-flag</a> and <a href="https://arai-a.github.io/ecma262-compare/snapshot.html?pr=2418#prod-ClassSetCharacter">https://arai-a.github.io/ecma262-compare/snapshot.html?pr=2418#prod-ClassSetCharacter</a> )</td></tr>
  <tr class="msg" id="L28"><td class="ts-cell"><a class="ts" href="#L28" alt="Thu Mar 23 2023 07:42:52 GMT-0700 (Pacific Daylight Time)">14:42</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell">Are we ensuring that RegExp.escape is future proof against potential new syntax? Should we be concerned if the output changes in a later version if we have to escape something new? We could choose to be intentionally over-aggressive with escapes, if we're not already.</td></tr>
  <tr class="msg" id="L29"><td class="ts-cell"><a class="ts" href="#L29" alt="Thu Mar 23 2023 07:53:27 GMT-0700 (Pacific Daylight Time)">14:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell">Also, rather than extending u-mode to allow other escapes, we could escape non-u-mode syntax characters using a hexadecimal representation that is legal in all modes. So, instead of adding <code>\-</code>, we could choose to escape it as <code>\x2d</code>. Same for <code>\=</code> (<code>\x3d</code>) and <code>\,</code> (<code>\x2c</code>)</td></tr>
  <tr class="msg" id="L30"><td class="ts-cell"><a class="ts" href="#L30" alt="Thu Mar 23 2023 07:53:56 GMT-0700 (Pacific Daylight Time)">14:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell">I'm not saying we shouldn't extend u-mode, but this is an option if we decide not to.</td></tr>
  <tr class="msg" id="L31"><td class="ts-cell"><a class="ts" href="#L31" alt="Thu Mar 23 2023 08:12:08 GMT-0700 (Pacific Daylight Time)">15:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell"><p>Regarding the "exhaustive list of contexts", keep in mind that several proposals add other contexts:</p>
<ul>
<li>Modifiers: <code>(?imsx-imsx:...)</code> (stage 3)</li>
<li>Comments: <code>(?#...)</code> (stage 1)</li>
<li><code>x</code>-mode line comments: <code># ...</code> (stage 1)</li>
<li>Atomic Groups: <code>(?&gt;...)</code> (stage 1)</li>
<li>Conditionals: <code>(?(...)...|...)</code> (stage 0, though I'm still hoping we'll take it eventually)</li>
</ul>
<p>At a quick glance, I think this means that <code>#</code> may need to be escaped as well, lest it be misinterpreted in <code>x</code> mode.</p>
</td></tr>
  <tr class="msg" id="L32"><td class="ts-cell"><a class="ts" href="#L32" alt="Thu Mar 23 2023 08:14:56 GMT-0700 (Pacific Daylight Time)">15:14</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell">If there's a chance we want <code>RegExp.escape</code> to always remain stable, it may be worth going over the RegExp syntax investigation I did at <a href="https://rbuckton.github.io/regexp-features/features/">https://rbuckton.github.io/regexp-features/features/</a> to ensure we're future-proof against other syntax we may choose to adopt later. Though, I admit that's not a completely exhaustive list.</td></tr>
  <tr class="msg" id="L33"><td class="ts-cell"><a class="ts" href="#L33" alt="Thu Mar 23 2023 08:15:54 GMT-0700 (Pacific Daylight Time)">15:15</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-1" title="@softwarechris:matrix.org">Chris de Almeida</span>&gt;</div></td><td class="msg-cell">I've just had to reference the notes as I had to leave early yesterday, and the conclusion/summary for each agenda item was a nice help</td></tr>
  <tr class="msg" id="L34"><td class="ts-cell"><a class="ts" href="#L34" alt="Thu Mar 23 2023 08:23:46 GMT-0700 (Pacific Daylight Time)">15:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-1" title="@jesse:igalia.com">Jesse (TC39)</span>&gt;</div></td><td class="msg-cell">how does scheduling of overflow stuff happen? asking for a friend</td></tr>
  <tr class="msg" id="L35"><td class="ts-cell"><a class="ts" href="#L35" alt="Thu Mar 23 2023 08:24:30 GMT-0700 (Pacific Daylight Time)">15:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> note the changes would need to be more substantive for dealing with <a href="https://github.com/tc39/ecma262/pull/2418"><code>v</code>-mode</a>, which has a wider set of reserved punctuators and semantics for doubled punctuators (<a href="https://github.com/tc39/proposal-regexp-v-flag#how-is-the-v-flag-different-from-the-u-flag">https://github.com/tc39/proposal-regexp-v-flag#how-is-the-v-flag-different-from-the-u-flag</a> and <a href="https://arai-a.github.io/ecma262-compare/snapshot.html?pr=2418#prod-ClassSetCharacter">https://arai-a.github.io/ecma262-compare/snapshot.html?pr=2418#prod-ClassSetCharacter</a> )</blockquote></mx-reply>The changes are just a matter of including the punctuators which have meaning (or are reserved) in v-mode; the doubled punctuators don't actually end up mattering as long as the non-doubled versions are all escaped</td></tr>
  <tr class="msg" id="L36"><td class="ts-cell"><a class="ts" href="#L36" alt="Thu Mar 23 2023 08:25:18 GMT-0700 (Pacific Daylight Time)">15:25</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">the list of reserved punctuators already includes <code>#</code>, so it would be escaped also, which would cover <code>x</code>-mode line comments too, thankfully</td></tr>
  <tr class="msg" id="L37"><td class="ts-cell"><a class="ts" href="#L37" alt="Thu Mar 23 2023 08:26:01 GMT-0700 (Pacific Daylight Time)">15:26</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> If there's a chance we want <code>RegExp.escape</code> to always remain stable, it may be worth going over the RegExp syntax investigation I did at <a href="https://rbuckton.github.io/regexp-features/features/">https://rbuckton.github.io/regexp-features/features/</a> to ensure we're future-proof against other syntax we may choose to adopt later. Though, I admit that's not a completely exhaustive list.</blockquote></mx-reply>For example, we may never do recursive matching, but it still might be a good idea to escape <code>&amp;</code> (used in <code>(?&amp;name)</code> for recursive named capture group matching, and <code>(?(R&amp;name)A|B)</code> in conditionals to test for recursion of a group).</td></tr>
  <tr class="msg" id="L38"><td class="ts-cell"><a class="ts" href="#L38" alt="Thu Mar 23 2023 08:26:38 GMT-0700 (Pacific Daylight Time)">15:26</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> For example, we may never do recursive matching, but it still might be a good idea to escape <code>&amp;</code> (used in <code>(?&amp;name)</code> for recursive named capture group matching, and <code>(?(R&amp;name)A|B)</code> in conditionals to test for recursion of a group).</blockquote></mx-reply><code>&amp;</code> needs to be escaped anyway for v-mode</td></tr>
  <tr class="msg" id="L39"><td class="ts-cell"><a class="ts" href="#L39" alt="Thu Mar 23 2023 08:26:40 GMT-0700 (Pacific Daylight Time)">15:26</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> the list of reserved punctuators already includes <code>#</code>, so it would be escaped also, which would cover <code>x</code>-mode line comments too, thankfully</blockquote></mx-reply>That's not shown in the slides though, which only mentions <code>(){}[]|,.?*+-^$=&lt;&gt;\</code></td></tr>
  <tr class="msg" id="L40"><td class="ts-cell"><a class="ts" href="#L40" alt="Thu Mar 23 2023 08:26:46 GMT-0700 (Pacific Daylight Time)">15:26</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">it does say "etc"</td></tr>
  <tr class="msg" id="L41"><td class="ts-cell"><a class="ts" href="#L41" alt="Thu Mar 23 2023 08:27:18 GMT-0700 (Pacific Daylight Time)">15:27</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-1" title="@softwarechris:matrix.org">Chris de Almeida</span>&gt;</div></td><td class="msg-cell">pull request to the agenda</td></tr>
  <tr class="msg" id="L42"><td class="ts-cell"><a class="ts" href="#L42" alt="Thu Mar 23 2023 08:27:22 GMT-0700 (Pacific Daylight Time)">15:27</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@robpalme:matrix.org">Rob Palmer</span>&gt;</div></td><td class="msg-cell">The best way is to PR the agenda as that guarantees all chairs will see it. But normally messaging the chairs in matrix is enough. I will say that after we add Ron's overflow, there is not much chance of more overflow.</td></tr>
  <tr class="msg" id="L43"><td class="ts-cell"><a class="ts" href="#L43" alt="Thu Mar 23 2023 08:27:42 GMT-0700 (Pacific Daylight Time)">15:27</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell">Yeah, but that's somewhat unclear. If it were to escape <code>A</code>, for example, that would be a problem for <a href="https://github.com/tc39/proposal-regexp-buffer-boundaries">https://github.com/tc39/proposal-regexp-buffer-boundaries</a></td></tr>
  <tr class="msg" id="L44"><td class="ts-cell"><a class="ts" href="#L44" alt="Thu Mar 23 2023 08:28:27 GMT-0700 (Pacific Daylight Time)">15:28</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-1" title="@softwarechris:matrix.org">Chris de Almeida</span>&gt;</div></td><td class="msg-cell">there's already o-f for async ex res mgmt - 30 mins.  is there an additional item from Ron?</td></tr>
  <tr class="msg" id="L45"><td class="ts-cell"><a class="ts" href="#L45" alt="Thu Mar 23 2023 08:29:02 GMT-0700 (Pacific Daylight Time)">15:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">It does also say it's only including punctuators, which would not include <code>A</code></td></tr>
  <tr class="msg" id="L46"><td class="ts-cell"><a class="ts" href="#L46" alt="Thu Mar 23 2023 08:29:13 GMT-0700 (Pacific Daylight Time)">15:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-1" title="@softwarechris:matrix.org">Chris de Almeida</span>&gt;</div></td><td class="msg-cell">oh... there was only a spare 25 minutes in the schedule to begin with</td></tr>
  <tr class="msg" id="L47"><td class="ts-cell"><a class="ts" href="#L47" alt="Thu Mar 23 2023 08:30:08 GMT-0700 (Pacific Daylight Time)">15:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell">Plus that list doesn't match the explainer currently, so there doesn't seem to be a definitive source of truth. Maybe that's a stage 2 concern, but if the point of the slides is "RegExp.escape is safe", then its important to clarify how safe.</td></tr>
  <tr class="msg" id="L48"><td class="ts-cell"><a class="ts" href="#L48" alt="Thu Mar 23 2023 08:44:05 GMT-0700 (Pacific Daylight Time)">15:44</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@eemeli:mozilla.org">eemeli</span>&gt;</div></td><td class="msg-cell">Presumably it's sufficient to guarantee that <code>RegExp.escape()</code> safe for its own <code>RegExp</code>, rather than being safe forever.</td></tr>
  <tr class="msg" id="L49"><td class="ts-cell"><a class="ts" href="#L49" alt="Thu Mar 23 2023 08:45:35 GMT-0700 (Pacific Daylight Time)">15:45</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">Well, that depends on whether anyone starts depending on it <em>not</em> escaping certain things</td></tr>
  <tr class="msg" id="L50"><td class="ts-cell"><a class="ts" href="#L50" alt="Thu Mar 23 2023 08:51:00 GMT-0700 (Pacific Daylight Time)">15:51</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell"><span class="nick-15">rbuckton</span>: Updated the slides to list proposed contexts as well, and went through all the ones you listed in your research doc as well</td></tr>
  <tr class="msg" id="L51"><td class="ts-cell"><a class="ts" href="#L51" alt="Thu Mar 23 2023 08:51:36 GMT-0700 (Pacific Daylight Time)">15:51</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">I'm kinda tempted to just say it escapes <em>every</em> ascii punctuator except <code>_</code>, since I've listed I think all of them except the two quotes and backtick at this point</td></tr>
  <tr class="msg" id="L52"><td class="ts-cell"><a class="ts" href="#L52" alt="Thu Mar 23 2023 08:51:49 GMT-0700 (Pacific Daylight Time)">15:51</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">I did also update it to include line terminators so you can't break out of <code>x</code>-mode line comments, which is something I'd previously neglected</td></tr>
  <tr class="msg" id="L53"><td class="ts-cell"><a class="ts" href="#L53" alt="Thu Mar 23 2023 08:53:09 GMT-0700 (Pacific Daylight Time)">15:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell">That's why I posed the questions earlier. Do we need to ensure <code>RegExp.escape()</code> is consistent for all time? If so, do we do that my making a best guess as to what potential syntax characters we might encounter in the future, and will that limit us in terms of what new syntax we can add? Or do we aggressively escape anything that is not alpha-numeric (or equivalent unicode characters)?</td></tr>
  <tr class="msg" id="L54"><td class="ts-cell"><a class="ts" href="#L54" alt="Thu Mar 23 2023 08:54:18 GMT-0700 (Pacific Daylight Time)">15:54</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> I'm kinda tempted to just say it escapes <em>every</em> ascii punctuator except <code>_</code>, since I've listed I think all of them except the two quotes and backtick at this point</blockquote></mx-reply>I think that may be safer, though <code>_</code> might even be worth escaping since it has meaning as part of some control verbs in Perl.</td></tr>
  <tr class="msg" id="L55"><td class="ts-cell"><a class="ts" href="#L55" alt="Thu Mar 23 2023 08:54:39 GMT-0700 (Pacific Daylight Time)">15:54</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">I think we should commit to not using <code>_</code> for anything ever</td></tr>
  <tr class="msg" id="L56"><td class="ts-cell"><a class="ts" href="#L56" alt="Thu Mar 23 2023 08:54:57 GMT-0700 (Pacific Daylight Time)">15:54</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">v-mode had that discussion already when they decided not to include it in the double-punctuator reservations</td></tr>
  <tr class="msg" id="L57"><td class="ts-cell"><a class="ts" href="#L57" alt="Thu Mar 23 2023 08:55:34 GMT-0700 (Pacific Daylight Time)">15:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell">Perl has <code>(*positive_lookahead: ... )</code>, for example</td></tr>
  <tr class="msg" id="L58"><td class="ts-cell"><a class="ts" href="#L58" alt="Thu Mar 23 2023 08:56:18 GMT-0700 (Pacific Daylight Time)">15:56</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">ah, that seems more like it's being used as an identifier character, and doesn't need to be escaped any more than any other identifier character</td></tr>
  <tr class="msg" id="L59"><td class="ts-cell"><a class="ts" href="#L59" alt="Thu Mar 23 2023 08:57:01 GMT-0700 (Pacific Daylight Time)">15:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell">PCRE also uses <code>`</code>, <code>'</code>, <code>"</code>, and <code>%</code> for callouts.</td></tr>
  <tr class="msg" id="L60"><td class="ts-cell"><a class="ts" href="#L60" alt="Thu Mar 23 2023 08:57:18 GMT-0700 (Pacific Daylight Time)">15:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell">I'm not sure we'll ever do callouts, but you can never be certain.</td></tr>
  <tr class="msg" id="L61"><td class="ts-cell"><a class="ts" href="#L61" alt="Thu Mar 23 2023 08:57:52 GMT-0700 (Pacific Daylight Time)">15:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">ok I will just say every ascii punctuator</td></tr>
  <tr class="msg" id="L62"><td class="ts-cell"><a class="ts" href="#L62" alt="Thu Mar 23 2023 08:57:55 GMT-0700 (Pacific Daylight Time)">15:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">except <code>_</code></td></tr>
  <tr class="msg" id="L63"><td class="ts-cell"><a class="ts" href="#L63" alt="Thu Mar 23 2023 08:58:12 GMT-0700 (Pacific Daylight Time)">15:58</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">And note that we might be able to make it less aggressive</td></tr>
  <tr class="msg" id="L64"><td class="ts-cell"><a class="ts" href="#L64" alt="Thu Mar 23 2023 08:58:20 GMT-0700 (Pacific Daylight Time)">15:58</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell">That's fine with me.</td></tr>
  <tr class="msg" id="L65"><td class="ts-cell"><a class="ts" href="#L65" alt="Thu Mar 23 2023 08:59:02 GMT-0700 (Pacific Daylight Time)">15:59</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">re: future constraints, this does mean that we're committing that backslash + punctuator is only ever going to mean the punctuator, but that is I think a good limit to impose</td></tr>
  <tr class="msg" id="L66"><td class="ts-cell"><a class="ts" href="#L66" alt="Thu Mar 23 2023 08:59:23 GMT-0700 (Pacific Daylight Time)">15:59</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> PCRE also uses <code>`</code>, <code>'</code>, <code>"</code>, and <code>%</code> for callouts.</blockquote></mx-reply><code>'</code> is actually used quite a bit across RegExp engines, primarily as an alternative to <code>&lt;&gt;</code> for named capture groups.</td></tr>
  <tr class="msg" id="L67"><td class="ts-cell"><a class="ts" href="#L67" alt="Thu Mar 23 2023 09:03:19 GMT-0700 (Pacific Daylight Time)">16:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> re: future constraints, this does mean that we're committing that backslash + punctuator is only ever going to mean the punctuator, but that is I think a good limit to impose</blockquote></mx-reply>As far as I can tell, no. The most likely engines that might have that would be Perl, PCRE, and Oniguruma, but I don't see anything like that so far.</td></tr>
  <tr class="msg" id="L68"><td class="ts-cell"><a class="ts" href="#L68" alt="Thu Mar 23 2023 09:04:25 GMT-0700 (Pacific Daylight Time)">16:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">Sorry, by "no" do you mean "no one uses backslash + punctuator to mean anything other than the punctuator"?</td></tr>
  <tr class="msg" id="L69"><td class="ts-cell"><a class="ts" href="#L69" alt="Thu Mar 23 2023 09:04:43 GMT-0700 (Pacific Daylight Time)">16:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> Sorry, by "no" do you mean "no one uses backslash + punctuator to mean anything other than the punctuator"?</blockquote></mx-reply>Correct, though I'm still checking.</td></tr>
  <tr class="msg" id="L70"><td class="ts-cell"><a class="ts" href="#L70" alt="Thu Mar 23 2023 09:05:11 GMT-0700 (Pacific Daylight Time)">16:05</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell">I think it would be safe to say that we also would never consider <code>\</code>+punctuator to mean anything other than the punctuator.</td></tr>
  <tr class="msg" id="L71"><td class="ts-cell"><a class="ts" href="#L71" alt="Thu Mar 23 2023 09:06:50 GMT-0700 (Pacific Daylight Time)">16:06</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell">There are other ways to introduce syntax that would be more meaningful than, say, whatever <code>\~</code> might mean.</td></tr>
  <tr class="msg" id="L72"><td class="ts-cell"><a class="ts" href="#L72" alt="Thu Mar 23 2023 09:56:40 GMT-0700 (Pacific Daylight Time)">16:56</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</div></td><td class="msg-cell">chairs, am i still up first today? if so i'll be about 2-3 mins late</td></tr>
  <tr class="msg" id="L73"><td class="ts-cell"><a class="ts" href="#L73" alt="Thu Mar 23 2023 09:57:29 GMT-0700 (Pacific Daylight Time)">16:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-1" title="@softwarechris:matrix.org">Chris de Almeida</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> chairs, am i still up first today? if so i'll be about 2-3 mins late</blockquote></mx-reply>yes -  Shared structs update</td></tr>
  <tr class="msg" id="L74"><td class="ts-cell"><a class="ts" href="#L74" alt="Thu Mar 23 2023 09:57:51 GMT-0700 (Pacific Daylight Time)">16:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</div></td><td class="msg-cell">thanks for confirmation</td></tr>
  <tr class="msg" id="L75"><td class="ts-cell"><a class="ts" href="#L75" alt="Thu Mar 23 2023 09:58:09 GMT-0700 (Pacific Daylight Time)">16:58</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</div></td><td class="msg-cell">(reason being i still don't have home internet and have to wait till 10 to kick people out of the meeting room i booked)</td></tr>
  <tr class="msg" id="L76"><td class="ts-cell"><a class="ts" href="#L76" alt="Thu Mar 23 2023 09:59:36 GMT-0700 (Pacific Daylight Time)">16:59</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-1" title="@softwarechris:matrix.org">Chris de Almeida</span>&gt;</div></td><td class="msg-cell">should be fine -- room still fairly empty over there</td></tr>
  <tr class="msg" id="L77"><td class="ts-cell"><a class="ts" href="#L77" alt="Thu Mar 23 2023 10:05:31 GMT-0700 (Pacific Daylight Time)">17:05</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-12" title="@wmartins:matrix.org">Willian Martins</span>&gt;</div></td><td class="msg-cell">I love this deck. </td></tr>
  <tr class="msg" id="L78"><td class="ts-cell"><a class="ts" href="#L78" alt="Thu Mar 23 2023 10:06:26 GMT-0700 (Pacific Daylight Time)">17:06</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@abotella:igalia.com">Andreu Botella</span>&gt;</div></td><td class="msg-cell">wait, at what stage is shared structs?</td></tr>
  <tr class="msg" id="L79"><td class="ts-cell"><a class="ts" href="#L79" alt="Thu Mar 23 2023 10:06:33 GMT-0700 (Pacific Daylight Time)">17:06</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@haxjs:matrix.org">HE Shi-Jun</span>&gt;</div></td><td class="msg-cell">Is that only me can't see shared screen?</td></tr>
  <tr class="msg" id="L80"><td class="ts-cell"><a class="ts" href="#L80" alt="Thu Mar 23 2023 10:06:40 GMT-0700 (Pacific Daylight Time)">17:06</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@abotella:igalia.com">Andreu Botella</span>&gt;</div></td><td class="msg-cell">I can see it</td></tr>
  <tr class="msg" id="L81"><td class="ts-cell"><a class="ts" href="#L81" alt="Thu Mar 23 2023 10:07:38 GMT-0700 (Pacific Daylight Time)">17:07</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-1" title="@softwarechris:matrix.org">Chris de Almeida</span>&gt;</div></td><td class="msg-cell">maybe you have something else pinned?</td></tr>
  <tr class="msg" id="L82"><td class="ts-cell"><a class="ts" href="#L82" alt="Thu Mar 23 2023 10:07:50 GMT-0700 (Pacific Daylight Time)">17:07</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-1" title="@softwarechris:matrix.org">Chris de Almeida</span>&gt;</div></td><td class="msg-cell">in top left, is there a button to switch to shared content?</td></tr>
  <tr class="msg" id="L83"><td class="ts-cell"><a class="ts" href="#L83" alt="Thu Mar 23 2023 10:08:47 GMT-0700 (Pacific Daylight Time)">17:08</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@haxjs:matrix.org">HE Shi-Jun</span>&gt;</div></td><td class="msg-cell">exit and rejoin, still can't see shared screen 😭</td></tr>
  <tr class="msg" id="L84"><td class="ts-cell"><a class="ts" href="#L84" alt="Thu Mar 23 2023 10:09:26 GMT-0700 (Pacific Daylight Time)">17:09</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-1" title="@softwarechris:matrix.org">Chris de Almeida</span>&gt;</div></td><td class="msg-cell">using app or browser?</td></tr>
  <tr class="msg" id="L85"><td class="ts-cell"><a class="ts" href="#L85" alt="Thu Mar 23 2023 10:09:33 GMT-0700 (Pacific Daylight Time)">17:09</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@usharma:igalia.com">ryzokuken</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> wait, at what stage is shared structs?</blockquote></mx-reply>1: <a href="https://github.com/tc39/proposal-structs">https://github.com/tc39/proposal-structs</a></td></tr>
  <tr class="msg" id="L86"><td class="ts-cell"><a class="ts" href="#L86" alt="Thu Mar 23 2023 10:09:49 GMT-0700 (Pacific Daylight Time)">17:09</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@haxjs:matrix.org">HE Shi-Jun</span>&gt;</div></td><td class="msg-cell">app</td></tr>
  <tr class="msg" id="L87"><td class="ts-cell"><a class="ts" href="#L87" alt="Thu Mar 23 2023 10:10:07 GMT-0700 (Pacific Daylight Time)">17:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@abotella:igalia.com">Andreu Botella</span>&gt;</div></td><td class="msg-cell">oh, I was Ctrl+Fing for "shared" in the proposal lists and couldn't find it</td></tr>
  <tr class="msg" id="L88"><td class="ts-cell"><a class="ts" href="#L88" alt="Thu Mar 23 2023 10:10:10 GMT-0700 (Pacific Daylight Time)">17:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@haxjs:matrix.org">HE Shi-Jun</span>&gt;</div></td><td class="msg-cell">it works now!</td></tr>
  <tr class="msg" id="L89"><td class="ts-cell"><a class="ts" href="#L89" alt="Thu Mar 23 2023 10:10:41 GMT-0700 (Pacific Daylight Time)">17:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@usharma:igalia.com">ryzokuken</span>&gt;</div></td><td class="msg-cell">well, ideally that'd imply Stage 0 🙈</td></tr>
  <tr class="msg" id="L90"><td class="ts-cell"><a class="ts" href="#L90" alt="Thu Mar 23 2023 10:10:55 GMT-0700 (Pacific Daylight Time)">17:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-1" title="@softwarechris:matrix.org">Chris de Almeida</span>&gt;</div></td><td class="msg-cell">it's missing from the proposals repo...</td></tr>
  <tr class="msg" id="L91"><td class="ts-cell"><a class="ts" href="#L91" alt="Thu Mar 23 2023 10:10:58 GMT-0700 (Pacific Daylight Time)">17:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@littledan:matrix.org">littledan</span>&gt;</div></td><td class="msg-cell">"Shared structs" have always been part of Shu's "structs" proposal.</td></tr>
  <tr class="msg" id="L92"><td class="ts-cell"><a class="ts" href="#L92" alt="Thu Mar 23 2023 10:10:58 GMT-0700 (Pacific Daylight Time)">17:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@haxjs:matrix.org">HE Shi-Jun</span>&gt;</div></td><td class="msg-cell">ok, i can see the screen now. not sure what happened , may be just network issue.</td></tr>
  <tr class="msg" id="L93"><td class="ts-cell"><a class="ts" href="#L93" alt="Thu Mar 23 2023 10:11:44 GMT-0700 (Pacific Daylight Time)">17:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@ljharb:matrix.org">ljharb</span>&gt;</div></td><td class="msg-cell">stage 1 (and zero) proposals are in a separate list</td></tr>
  <tr class="msg" id="L94"><td class="ts-cell"><a class="ts" href="#L94" alt="Thu Mar 23 2023 10:11:52 GMT-0700 (Pacific Daylight Time)">17:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-1" title="@softwarechris:matrix.org">Chris de Almeida</span>&gt;</div></td><td class="msg-cell">yeah it;s still missing from the list</td></tr>
  <tr class="msg" id="L95"><td class="ts-cell"><a class="ts" href="#L95" alt="Thu Mar 23 2023 10:12:02 GMT-0700 (Pacific Daylight Time)">17:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-1" title="@softwarechris:matrix.org">Chris de Almeida</span>&gt;</div></td><td class="msg-cell"><a href="https://github.com/tc39/proposals/blob/main/stage-1-proposals.md">https://github.com/tc39/proposals/blob/main/stage-1-proposals.md</a></td></tr>
  <tr class="msg" id="L96"><td class="ts-cell"><a class="ts" href="#L96" alt="Thu Mar 23 2023 10:12:07 GMT-0700 (Pacific Daylight Time)">17:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@abotella:igalia.com">Andreu Botella</span>&gt;</div></td><td class="msg-cell">yeah, I was searching in all lists, but I was searching for "shared" and couldn't find it</td></tr>
  <tr class="msg" id="L97"><td class="ts-cell"><a class="ts" href="#L97" alt="Thu Mar 23 2023 10:12:12 GMT-0700 (Pacific Daylight Time)">17:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@ljharb:matrix.org">ljharb</span>&gt;</div></td><td class="msg-cell">"fixed shape objects" is in the list</td></tr>
  <tr class="msg" id="L98"><td class="ts-cell"><a class="ts" href="#L98" alt="Thu Mar 23 2023 10:12:24 GMT-0700 (Pacific Daylight Time)">17:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@ljharb:matrix.org">ljharb</span>&gt;</div></td><td class="msg-cell">that was what it was presented as when it got stage 1, i assume</td></tr>
  <tr class="msg" id="L99"><td class="ts-cell"><a class="ts" href="#L99" alt="Thu Mar 23 2023 10:12:34 GMT-0700 (Pacific Daylight Time)">17:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-1" title="@softwarechris:matrix.org">Chris de Almeida</span>&gt;</div></td><td class="msg-cell">ohhhh</td></tr>
  <tr class="msg" id="L100"><td class="ts-cell"><a class="ts" href="#L100" alt="Thu Mar 23 2023 10:12:40 GMT-0700 (Pacific Daylight Time)">17:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-1" title="@softwarechris:matrix.org">Chris de Almeida</span>&gt;</div></td><td class="msg-cell">quick PR incoming</td></tr>
  <tr class="msg" id="L101"><td class="ts-cell"><a class="ts" href="#L101" alt="Thu Mar 23 2023 10:13:07 GMT-0700 (Pacific Daylight Time)">17:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@ljharb:matrix.org">ljharb</span>&gt;</div></td><td class="msg-cell"><span class="nick-1">Chris de Almeida</span>: i'm not sure that's appropriate</td></tr>
  <tr class="msg" id="L102"><td class="ts-cell"><a class="ts" href="#L102" alt="Thu Mar 23 2023 10:13:08 GMT-0700 (Pacific Daylight Time)">17:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@abotella:igalia.com">Andreu Botella</span>&gt;</div></td><td class="msg-cell">Maybe this is just me, but the name "isolate" shouldn't necessarily guide the direction of the language /s</td></tr>
  <tr class="msg" id="L103"><td class="ts-cell"><a class="ts" href="#L103" alt="Thu Mar 23 2023 10:13:20 GMT-0700 (Pacific Daylight Time)">17:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@ljharb:matrix.org">ljharb</span>&gt;</div></td><td class="msg-cell">at stage 1 the proposal name should describe the problem, and "shared structs" seems like a solution to me</td></tr>
  <tr class="msg" id="L104"><td class="ts-cell"><a class="ts" href="#L104" alt="Thu Mar 23 2023 10:14:59 GMT-0700 (Pacific Daylight Time)">17:14</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@littledan:matrix.org">littledan</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> Maybe this is just me, but the name "isolate" shouldn't necessarily guide the direction of the language /s</blockquote></mx-reply>heh I guess this is more generally intelligible if you replace "isolate" with "garbage collected heap"</td></tr>
  <tr class="msg" id="L105"><td class="ts-cell"><a class="ts" href="#L105" alt="Thu Mar 23 2023 10:15:28 GMT-0700 (Pacific Daylight Time)">17:15</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@littledan:matrix.org">littledan</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> at stage 1 the proposal name should describe the problem, and "shared structs" seems like a solution to me</blockquote></mx-reply>I think we can afford champions some flexibility here, but Shu is clearly referring to this proposal as "shared structs" so it's fine to go with that.</td></tr>
  <tr class="msg" id="L106"><td class="ts-cell"><a class="ts" href="#L106" alt="Thu Mar 23 2023 10:15:48 GMT-0700 (Pacific Daylight Time)">17:15</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@ljharb:matrix.org">ljharb</span>&gt;</div></td><td class="msg-cell">fair enough</td></tr>
  <tr class="msg" id="L107"><td class="ts-cell"><a class="ts" href="#L107" alt="Thu Mar 23 2023 10:17:15 GMT-0700 (Pacific Daylight Time)">17:17</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-1" title="@softwarechris:matrix.org">Chris de Almeida</span>&gt;</div></td><td class="msg-cell">I think it's reasonable to expect better parity between the title in the tc39/proposals repo and the title on the proposal repo itself</td></tr>
  <tr class="msg" id="L108"><td class="ts-cell"><a class="ts" href="#L108" alt="Thu Mar 23 2023 10:17:20 GMT-0700 (Pacific Daylight Time)">17:17</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@littledan:matrix.org">littledan</span>&gt;</div></td><td class="msg-cell">Note: I believe Shu is using the term "closed" in a mathematical sense, about how these graphs don't point to each other.</td></tr>
  <tr class="msg" id="L109"><td class="ts-cell"><a class="ts" href="#L109" alt="Thu Mar 23 2023 10:18:58 GMT-0700 (Pacific Daylight Time)">17:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@littledan:matrix.org">littledan</span>&gt;</div></td><td class="msg-cell">and "mutators" refers to the executing code (which mutates the heap--even if it's purely functional)</td></tr>
  <tr class="msg" id="L110"><td class="ts-cell"><a class="ts" href="#L110" alt="Thu Mar 23 2023 10:27:09 GMT-0700 (Pacific Daylight Time)">17:27</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@ljharb:matrix.org">ljharb</span>&gt;</div></td><td class="msg-cell">i usually default to whatever's on the agenda at advancement time in the proposals table</td></tr>
  <tr class="msg" id="L111"><td class="ts-cell"><a class="ts" href="#L111" alt="Thu Mar 23 2023 10:27:18 GMT-0700 (Pacific Daylight Time)">17:27</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@ljharb:matrix.org">ljharb</span>&gt;</div></td><td class="msg-cell">but i agree that it would be nice if champions kept that in sync :-)</td></tr>
  <tr class="msg" id="L112"><td class="ts-cell"><a class="ts" href="#L112" alt="Thu Mar 23 2023 10:48:01 GMT-0700 (Pacific Daylight Time)">17:48</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@lucacasonato:matrix.org">Luca Casonato</span>&gt;</div></td><td class="msg-cell"><span class="nick-8">shu</span>: The origin isolation is not really an issue for us in Deno, because our security model ensures that only a single tenant can execute code within a single process. Essentially the effect of cross origin isolation is the default for us. There are some server side runtimes, notably Cloudflare Workers, that run multiple tenants within a single process. They disallow all high precision timers and shared memory entirely.</td></tr>
  <tr class="msg" id="L113"><td class="ts-cell"><a class="ts" href="#L113" alt="Thu Mar 23 2023 10:52:27 GMT-0700 (Pacific Daylight Time)">17:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@abotella:igalia.com">Andreu Botella</span>&gt;</div></td><td class="msg-cell">can't you treat a reference to a SAB from inside a shared struct as if it was a per-isolate SAB object</td></tr>
  <tr class="msg" id="L114"><td class="ts-cell"><a class="ts" href="#L114" alt="Thu Mar 23 2023 10:52:43 GMT-0700 (Pacific Daylight Time)">17:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@abotella:igalia.com">Andreu Botella</span>&gt;</div></td><td class="msg-cell">different from any other SAB object pointing to the same backing store in the same isolate</td></tr>
  <tr class="msg" id="L115"><td class="ts-cell"><a class="ts" href="#L115" alt="Thu Mar 23 2023 10:56:35 GMT-0700 (Pacific Daylight Time)">17:56</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@lucacasonato:matrix.org">Luca Casonato</span>&gt;</div></td><td class="msg-cell">Technically probably possible - the identity continuity seems pretty hard (but probably possible). I think the biggest problem is wether this <em>should</em> work, because magic object cloning is not something we have right now. Also what if you have a custom class that extends SAB?</td></tr>
  <tr class="msg" id="L116"><td class="ts-cell"><a class="ts" href="#L116" alt="Thu Mar 23 2023 10:57:36 GMT-0700 (Pacific Daylight Time)">17:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@abotella:igalia.com">Andreu Botella</span>&gt;</div></td><td class="msg-cell">Is there a need for identity continuity? You can currently clone a SAB without identity continuity with HTML's <code>structuredClone(sab)</code></td></tr>
  <tr class="msg" id="L117"><td class="ts-cell"><a class="ts" href="#L117" alt="Thu Mar 23 2023 10:57:43 GMT-0700 (Pacific Daylight Time)">17:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@abotella:igalia.com">Andreu Botella</span>&gt;</div></td><td class="msg-cell">But I guess it would be needed for some use cases</td></tr>
  <tr class="msg" id="L118"><td class="ts-cell"><a class="ts" href="#L118" alt="Thu Mar 23 2023 10:58:23 GMT-0700 (Pacific Daylight Time)">17:58</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@lucacasonato:matrix.org">Luca Casonato</span>&gt;</div></td><td class="msg-cell">Yes, but there you have an explicit transfer</td></tr>
  <tr class="msg" id="L119"><td class="ts-cell"><a class="ts" href="#L119" alt="Thu Mar 23 2023 10:58:42 GMT-0700 (Pacific Daylight Time)">17:58</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@abotella:igalia.com">Andreu Botella</span>&gt;</div></td><td class="msg-cell">Oh, right, this would be an assignment transforming into a clone behind the scenes</td></tr>
  <tr class="msg" id="L120"><td class="ts-cell"><a class="ts" href="#L120" alt="Thu Mar 23 2023 10:58:45 GMT-0700 (Pacific Daylight Time)">17:58</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@lucacasonato:matrix.org">Luca Casonato</span>&gt;</div></td><td class="msg-cell">With shared structs, assignment is transfer/publish, which means there is no explicit call that needs to be made to transfer</td></tr>
  <tr class="msg" id="L121"><td class="ts-cell"><a class="ts" href="#L121" alt="Thu Mar 23 2023 10:59:17 GMT-0700 (Pacific Daylight Time)">17:59</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@lucacasonato:matrix.org">Luca Casonato</span>&gt;</div></td><td class="msg-cell">sounds confusing to users</td></tr>
  <tr class="msg" id="L122"><td class="ts-cell"><a class="ts" href="#L122" alt="Thu Mar 23 2023 11:12:35 GMT-0700 (Pacific Daylight Time)">18:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">Andreu Botella</span>: you can't make assignment a hidden clone anyway, because you need to clone it into a particular target realm, and a shared struct assignment is more like a broadcast</td></tr>
  <tr class="msg" id="L123"><td class="ts-cell"><a class="ts" href="#L123" alt="Thu Mar 23 2023 11:14:10 GMT-0700 (Pacific Daylight Time)">18:14</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@abotella:igalia.com">Andreu Botella</span>&gt;</div></td><td class="msg-cell">you'd also want <code>struct.sab === struct.sab</code>, and that would require an extra per-isolate map</td></tr>
  <tr class="msg" id="L124"><td class="ts-cell"><a class="ts" href="#L124" alt="Thu Mar 23 2023 11:15:38 GMT-0700 (Pacific Daylight Time)">18:15</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</div></td><td class="msg-cell">yeah</td></tr>
  <tr class="msg" id="L125"><td class="ts-cell"><a class="ts" href="#L125" alt="Thu Mar 23 2023 11:16:22 GMT-0700 (Pacific Daylight Time)">18:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@lucacasonato:matrix.org">Luca Casonato</span>&gt;</div></td><td class="msg-cell">You could make the assigment assign the SAB backing store into the shared struct, and then make the property access on the SAB create the JS object on demand - but that sounds slow and ugly and likely difficult to integrate</td></tr>
  <tr class="msg" id="L126"><td class="ts-cell"><a class="ts" href="#L126" alt="Thu Mar 23 2023 11:16:56 GMT-0700 (Pacific Daylight Time)">18:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@lucacasonato:matrix.org">Luca Casonato</span>&gt;</div></td><td class="msg-cell">But yeah, to fix identity discontinuity you'd need a backing store -&gt; js object map per isolate</td></tr>
  <tr class="msg" id="L127"><td class="ts-cell"><a class="ts" href="#L127" alt="Thu Mar 23 2023 11:18:55 GMT-0700 (Pacific Daylight Time)">18:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</div></td><td class="msg-cell">i think the DX of SAB objects themselves just don't matter</td></tr>
  <tr class="msg" id="L128"><td class="ts-cell"><a class="ts" href="#L128" alt="Thu Mar 23 2023 11:19:03 GMT-0700 (Pacific Daylight Time)">18:19</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</div></td><td class="msg-cell">since you can only use them via TA objects</td></tr>
  <tr class="msg" id="L129"><td class="ts-cell"><a class="ts" href="#L129" alt="Thu Mar 23 2023 11:19:16 GMT-0700 (Pacific Daylight Time)">18:19</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</div></td><td class="msg-cell">so to introduce a new kind of SAB object that can be put into shared structs seems the simplest solution to me</td></tr>
  <tr class="msg" id="L130"><td class="ts-cell"><a class="ts" href="#L130" alt="Thu Mar 23 2023 11:20:16 GMT-0700 (Pacific Daylight Time)">18:20</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@littledan:matrix.org">littledan</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> You could make the assigment assign the SAB backing store into the shared struct, and then make the property access on the SAB create the JS object on demand - but that sounds slow and ugly and likely difficult to integrate</blockquote></mx-reply>the inability of SAB to point to JS values (with cycle collection) is a fundamental limitation. This is why I like how shared structs do <em>not</em> include the ability to be backed by SABs--it would be a completely different thing.</td></tr>
  <tr class="msg" id="L131"><td class="ts-cell"><a class="ts" href="#L131" alt="Thu Mar 23 2023 11:22:08 GMT-0700 (Pacific Daylight Time)">18:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@lucacasonato:matrix.org">Luca Casonato</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> the inability of SAB to point to JS values (with cycle collection) is a fundamental limitation. This is why I like how shared structs do <em>not</em> include the ability to be backed by SABs--it would be a completely different thing.</blockquote></mx-reply>I don't understand. My comment was about engine internal code, not user code.</td></tr>
  <tr class="msg" id="L132"><td class="ts-cell"><a class="ts" href="#L132" alt="Thu Mar 23 2023 11:22:27 GMT-0700 (Pacific Daylight Time)">18:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@littledan:matrix.org">littledan</span>&gt;</div></td><td class="msg-cell">oh sorry I was going on a random tangent because I misunderstood</td></tr>
  <tr class="msg" id="L133"><td class="ts-cell"><a class="ts" href="#L133" alt="Thu Mar 23 2023 11:24:50 GMT-0700 (Pacific Daylight Time)">18:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell">mark: re <code>yield</code>. I'm not sure what the champion's position is on this, but I think my preference is that context <em>isn't</em> preserved. If it isn't preserved, there's an opportunity for a userland runtime to set context when calling <code>.next()</code>, which could be useful for something like a dataflow library.</td></tr>
  <tr class="msg" id="L134"><td class="ts-cell"><a class="ts" href="#L134" alt="Thu Mar 23 2023 11:25:42 GMT-0700 (Pacific Daylight Time)">18:25</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">(I have the opposite preference - <code>yield</code> should not be meaningfully different than <code>await</code> here)</td></tr>
  <tr class="msg" id="L135"><td class="ts-cell"><a class="ts" href="#L135" alt="Thu Mar 23 2023 11:25:56 GMT-0700 (Pacific Daylight Time)">18:25</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell"><code>yield</code> is meaningly different from <code>await</code> though.</td></tr>
  <tr class="msg" id="L136"><td class="ts-cell"><a class="ts" href="#L136" alt="Thu Mar 23 2023 11:26:02 GMT-0700 (Pacific Daylight Time)">18:26</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">Not for the purposes of this API</td></tr>
  <tr class="msg" id="L137"><td class="ts-cell"><a class="ts" href="#L137" alt="Thu Mar 23 2023 11:26:24 GMT-0700 (Pacific Daylight Time)">18:26</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@haxjs:matrix.org">HE Shi-Jun</span>&gt;</div></td><td class="msg-cell">Both sides seems reasonable 😂</td></tr>
  <tr class="msg" id="L138"><td class="ts-cell"><a class="ts" href="#L138" alt="Thu Mar 23 2023 11:26:28 GMT-0700 (Pacific Daylight Time)">18:26</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">In both cases the syntax is creating a continuation callback to be called at a future point, and that continuation should capture the current state</td></tr>
  <tr class="msg" id="L139"><td class="ts-cell"><a class="ts" href="#L139" alt="Thu Mar 23 2023 11:26:54 GMT-0700 (Pacific Daylight Time)">18:26</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@littledan:matrix.org">littledan</span>&gt;</div></td><td class="msg-cell">it would probably be helpful to look into the experience in Node.js, where this feature has long existed <em>without</em> such support in yield. Has this led to bugs? We should be able to find out.</td></tr>
  <tr class="msg" id="L140"><td class="ts-cell"><a class="ts" href="#L140" alt="Thu Mar 23 2023 11:27:09 GMT-0700 (Pacific Daylight Time)">18:27</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> it would probably be helpful to look into the experience in Node.js, where this feature has long existed <em>without</em> such support in yield. Has this led to bugs? We should be able to find out.</blockquote></mx-reply>No one uses yield so it doesn't come up</td></tr>
  <tr class="msg" id="L141"><td class="ts-cell"><a class="ts" href="#L141" alt="Thu Mar 23 2023 11:27:24 GMT-0700 (Pacific Daylight Time)">18:27</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@littledan:matrix.org">littledan</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> No one uses yield so it doesn't come up</blockquote></mx-reply>shouldn't this show up in generators all the time?</td></tr>
  <tr class="msg" id="L142"><td class="ts-cell"><a class="ts" href="#L142" alt="Thu Mar 23 2023 11:27:57 GMT-0700 (Pacific Daylight Time)">18:27</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">no one uses generators either</td></tr>
  <tr class="msg" id="L143"><td class="ts-cell"><a class="ts" href="#L143" alt="Thu Mar 23 2023 11:28:00 GMT-0700 (Pacific Daylight Time)">18:28</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> shouldn't this show up in generators all the time?</blockquote></mx-reply>I'd expect a lot of generators run to completion synchronously, so it wouldn't be observable.</td></tr>
  <tr class="msg" id="L144"><td class="ts-cell"><a class="ts" href="#L144" alt="Thu Mar 23 2023 11:28:41 GMT-0700 (Pacific Daylight Time)">18:28</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell">"no one" is far too strong. TypeScript uses them internally, and there are userland runtimes that rely on them.</td></tr>
  <tr class="msg" id="L145"><td class="ts-cell"><a class="ts" href="#L145" alt="Thu Mar 23 2023 11:28:53 GMT-0700 (Pacific Daylight Time)">18:28</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">that's an exaggeration of course, but yeah like Ron says most uses of generators IME are simple enough that it doesn't end up being relevant. to see this in real life you have to do the <code>next</code> call on a subsequent turn</td></tr>
  <tr class="msg" id="L146"><td class="ts-cell"><a class="ts" href="#L146" alt="Thu Mar 23 2023 11:28:59 GMT-0700 (Pacific Daylight Time)">18:28</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@nicolo-ribaudo:matrix.org">nicolo-ribaudo</span>&gt;</div></td><td class="msg-cell">For generators that are resumed asynchronously, wouldn't the context be preserved by the async helper used to resume the generator (a callback, a <code>promise.then</code>, etc)?</td></tr>
  <tr class="msg" id="L147"><td class="ts-cell"><a class="ts" href="#L147" alt="Thu Mar 23 2023 11:30:06 GMT-0700 (Pacific Daylight Time)">18:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@yulia:mozilla.org">yulia</span>&gt;</div></td><td class="msg-cell">dumb question: there is no chance that "context" will be confused with the decorators context? Asking because I just heard context so many times and got reminded that it can be kind of meaningless because it can mean anything. Totally not a blocking concern but wondering if anyone else had the same thought</td></tr>
  <tr class="msg" id="L148"><td class="ts-cell"><a class="ts" href="#L148" alt="Thu Mar 23 2023 11:30:12 GMT-0700 (Pacific Daylight Time)">18:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell">If <code>yield</code> <em>did</em> preserve context, I'd argue we need a mechanism to turn this off on an as-need basis otherwise we'd block a number of valid use cases.</td></tr>
  <tr class="msg" id="L149"><td class="ts-cell"><a class="ts" href="#L149" alt="Thu Mar 23 2023 11:30:35 GMT-0700 (Pacific Daylight Time)">18:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@ljharb:matrix.org">ljharb</span>&gt;</div></td><td class="msg-cell">are beginner devs using node's async stuff now?</td></tr>
  <tr class="msg" id="L150"><td class="ts-cell"><a class="ts" href="#L150" alt="Thu Mar 23 2023 11:30:36 GMT-0700 (Pacific Daylight Time)">18:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">I would be OK with a <code>yield.nocontext</code> or something I guess</td></tr>
  <tr class="msg" id="L151"><td class="ts-cell"><a class="ts" href="#L151" alt="Thu Mar 23 2023 11:30:52 GMT-0700 (Pacific Daylight Time)">18:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> dumb question: there is no chance that "context" will be confused with the decorators context? Asking because I just heard context so many times and got reminded that it can be kind of meaningless because it can mean anything. Totally not a blocking concern but wondering if anyone else had the same thought</blockquote></mx-reply>semi-serious: time to resurrect "Conveyance"!!</td></tr>
  <tr class="msg" id="L152"><td class="ts-cell"><a class="ts" href="#L152" alt="Thu Mar 23 2023 11:31:32 GMT-0700 (Pacific Daylight Time)">18:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@littledan:matrix.org">littledan</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> dumb question: there is no chance that "context" will be confused with the decorators context? Asking because I just heard context so many times and got reminded that it can be kind of meaningless because it can mean anything. Totally not a blocking concern but wondering if anyone else had the same thought</blockquote></mx-reply>Yeah it'd be great to have a name brainstorm here (in an issue, not during plenary). <a href="https://github.com/tc39/proposal-async-context/issues">https://github.com/tc39/proposal-async-context/issues</a></td></tr>
  <tr class="msg" id="L153"><td class="ts-cell"><a class="ts" href="#L153" alt="Thu Mar 23 2023 11:31:45 GMT-0700 (Pacific Daylight Time)">18:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> I would be OK with a <code>yield.nocontext</code> or something I guess</blockquote></mx-reply>That's the problem. In the cases I'm concerned with, the generator is provided by the user to a third party library. You want the library to handle the complexities involved with async context flow control, not the author of the genrator. You want them to not be concerned about choosing which <code>yield</code> variant to use.</td></tr>
  <tr class="msg" id="L154"><td class="ts-cell"><a class="ts" href="#L154" alt="Thu Mar 23 2023 11:32:14 GMT-0700 (Pacific Daylight Time)">18:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@yulia:mozilla.org">yulia</span>&gt;</div></td><td class="msg-cell">i don't have a concrete alternative and context isn't horrible. I don't know if the collision would really take place, just hadn't thought about it</td></tr>
  <tr class="msg" id="L155"><td class="ts-cell"><a class="ts" href="#L155" alt="Thu Mar 23 2023 11:32:26 GMT-0700 (Pacific Daylight Time)">18:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell">A number of languages with an <code>AsyncContext</code>-like mechanism also have some mechanism of explicitly affecting async flow control.</td></tr>
  <tr class="msg" id="L156"><td class="ts-cell"><a class="ts" href="#L156" alt="Thu Mar 23 2023 11:32:26 GMT-0700 (Pacific Daylight Time)">18:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@yulia:mozilla.org">yulia</span>&gt;</div></td><td class="msg-cell">i'll make an issue</td></tr>
  <tr class="msg" id="L157"><td class="ts-cell"><a class="ts" href="#L157" alt="Thu Mar 23 2023 11:32:31 GMT-0700 (Pacific Daylight Time)">18:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@littledan:matrix.org">littledan</span>&gt;</div></td><td class="msg-cell">The thing is, an AsyncContext instance is more like a single <em>variable</em></td></tr>
  <tr class="msg" id="L158"><td class="ts-cell"><a class="ts" href="#L158" alt="Thu Mar 23 2023 11:32:38 GMT-0700 (Pacific Daylight Time)">18:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@haxjs:matrix.org">HE Shi-Jun</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> I would be OK with a <code>yield.nocontext</code> or something I guess</blockquote></mx-reply><code><a href="http://yield.foo">yield.foo</a></code> will have diff semantic out of generator, don't like such syntax :P</td></tr>
  <tr class="msg" id="L159"><td class="ts-cell"><a class="ts" href="#L159" alt="Thu Mar 23 2023 11:33:10 GMT-0700 (Pacific Daylight Time)">18:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> A number of languages with an <code>AsyncContext</code>-like mechanism also have some mechanism of explicitly affecting async flow control.</blockquote></mx-reply>See <a href="https://learn.microsoft.com/en-us/dotnet/api/system.threading.asyncflowcontrol?view=net-8.0">https://learn.microsoft.com/en-us/dotnet/api/system.threading.asyncflowcontrol?view=net-8.0</a>, for example.</td></tr>
  <tr class="msg" id="L160"><td class="ts-cell"><a class="ts" href="#L160" alt="Thu Mar 23 2023 11:34:18 GMT-0700 (Pacific Daylight Time)">18:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">hm. I'll have to think more about <code>yield</code>.</td></tr>
  <tr class="msg" id="L161"><td class="ts-cell"><a class="ts" href="#L161" alt="Thu Mar 23 2023 11:34:25 GMT-0700 (Pacific Daylight Time)">18:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">I could be convinced it should not wrap, probably</td></tr>
  <tr class="msg" id="L162"><td class="ts-cell"><a class="ts" href="#L162" alt="Thu Mar 23 2023 11:34:32 GMT-0700 (Pacific Daylight Time)">18:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> The thing is, an AsyncContext instance is more like a single <em>variable</em></blockquote></mx-reply>.NET calls this an <code>AsyncLocal&lt;T&gt;</code>, though that is backed by something called a "Call Context"</td></tr>
  <tr class="msg" id="L163"><td class="ts-cell"><a class="ts" href="#L163" alt="Thu Mar 23 2023 11:37:52 GMT-0700 (Pacific Daylight Time)">18:37</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@ljharb:matrix.org">ljharb</span>&gt;</div></td><td class="msg-cell">tbh "context" is a better name for this proposal than for the decorator property, if we had to pick one</td></tr>
  <tr class="msg" id="L164"><td class="ts-cell"><a class="ts" href="#L164" alt="Thu Mar 23 2023 11:39:16 GMT-0700 (Pacific Daylight Time)">18:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@yulia:mozilla.org">yulia</span>&gt;</div></td><td class="msg-cell">thats fair, up until today i was taking AsyncContext as a name for granted</td></tr>
  <tr class="msg" id="L165"><td class="ts-cell"><a class="ts" href="#L165" alt="Thu Mar 23 2023 11:39:34 GMT-0700 (Pacific Daylight Time)">18:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@littledan:matrix.org">littledan</span>&gt;</div></td><td class="msg-cell">let's call it "util"</td></tr>
  <tr class="msg" id="L166"><td class="ts-cell"><a class="ts" href="#L166" alt="Thu Mar 23 2023 11:39:41 GMT-0700 (Pacific Daylight Time)">18:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@yulia:mozilla.org">yulia</span>&gt;</div></td><td class="msg-cell">oh no, what have i done</td></tr>
  <tr class="msg" id="L167"><td class="ts-cell"><a class="ts" href="#L167" alt="Thu Mar 23 2023 11:39:42 GMT-0700 (Pacific Daylight Time)">18:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@littledan:matrix.org">littledan</span>&gt;</div></td><td class="msg-cell">AsyncUtil</td></tr>
  <tr class="msg" id="L168"><td class="ts-cell"><a class="ts" href="#L168" alt="Thu Mar 23 2023 11:40:11 GMT-0700 (Pacific Daylight Time)">18:40</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@benjamn:matrix.org">Ben Newman (Apollo, @benjamn on GH)</span>&gt;</div></td><td class="msg-cell">the meaning of "context" is highly context-dependent, unfortunately</td></tr>
  <tr class="msg" id="L169"><td class="ts-cell"><a class="ts" href="#L169" alt="Thu Mar 23 2023 11:40:14 GMT-0700 (Pacific Daylight Time)">18:40</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell"><code>context</code> is a general purpose term, I'd hate for us to relegate it to a single purpose.</td></tr>
  <tr class="msg" id="L170"><td class="ts-cell"><a class="ts" href="#L170" alt="Thu Mar 23 2023 11:40:43 GMT-0700 (Pacific Daylight Time)">18:40</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</div></td><td class="msg-cell"><span class="nick-11">apaprocki</span>: i believe you but BBG is a closed-shop ecosystem, so i wouldn't weigh it too much as predictive of ecosystem integration pains for JS at large</td></tr>
  <tr class="msg" id="L171"><td class="ts-cell"><a class="ts" href="#L171" alt="Thu Mar 23 2023 11:41:31 GMT-0700 (Pacific Daylight Time)">18:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-11" title="@apaprocki:matrix.org">apaprocki</span>&gt;</div></td><td class="msg-cell">understood, merely relaying experience that for the end users, who are really just writing JS, it wasn't confusing for them to understand why it wasn't working and how to fix it</td></tr>
  <tr class="msg" id="L172"><td class="ts-cell"><a class="ts" href="#L172" alt="Thu Mar 23 2023 11:50:44 GMT-0700 (Pacific Daylight Time)">18:50</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@ljharb:matrix.org">ljharb</span>&gt;</div></td><td class="msg-cell"><span class="nick-6">eemeli</span>: pretty sure it's not polyfillable</td></tr>
  <tr class="msg" id="L173"><td class="ts-cell"><a class="ts" href="#L173" alt="Thu Mar 23 2023 11:52:23 GMT-0700 (Pacific Daylight Time)">18:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> That's the problem. In the cases I'm concerned with, the generator is provided by the user to a third party library. You want the library to handle the complexities involved with async context flow control, not the author of the genrator. You want them to not be concerned about choosing which <code>yield</code> variant to use.</blockquote></mx-reply><p>so, "the generator is provided by the user to a third party library" seems like exactly the case where we want <code>yield</code> to preserve state. taking the example from the readme:</p>
<pre><code class="language-js">  libraryTakingAnIterator(context.run('id', function* () {
    log('starting');

    yield 0;

    // if the library `await`s before resuming, we've lost our id
    log('done');
  }));
</code></pre>
<p>Maybe we should say that any library which consumes iterators in this way needs to juggle contexts properly? but on the other hand it's not clear to me how that's even possible here - how would the library ensure that the second half of the generator runs in the correct context?</p>
</td></tr>
  <tr class="msg" id="L174"><td class="ts-cell"><a class="ts" href="#L174" alt="Thu Mar 23 2023 11:52:48 GMT-0700 (Pacific Daylight Time)">18:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@benjamn:matrix.org">Ben Newman (Apollo, @benjamn on GH)</span>&gt;</div></td><td class="msg-cell">strawdog idea: you could wrap <code><a href="http://Generator.prototype.next">Generator.prototype.next</a></code></td></tr>
  <tr class="msg" id="L175"><td class="ts-cell"><a class="ts" href="#L175" alt="Thu Mar 23 2023 11:53:17 GMT-0700 (Pacific Daylight Time)">18:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">but how does the library get the original context?</td></tr>
  <tr class="msg" id="L176"><td class="ts-cell"><a class="ts" href="#L176" alt="Thu Mar 23 2023 11:53:17 GMT-0700 (Pacific Daylight Time)">18:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@littledan:matrix.org">littledan</span>&gt;</div></td><td class="msg-cell">when the queue opens back up, please feel free to ask questions about AsyncContext, even much more basic ones, about how it works at all.</td></tr>
  <tr class="msg" id="L177"><td class="ts-cell"><a class="ts" href="#L177" alt="Thu Mar 23 2023 11:53:19 GMT-0700 (Pacific Daylight Time)">18:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell">I'd expect, at least roughly, that the context value remains referenced until <code>run</code>'s callstack is exhausted and any <code>Promise</code> created is garbage collected.</td></tr>
  <tr class="msg" id="L178"><td class="ts-cell"><a class="ts" href="#L178" alt="Thu Mar 23 2023 11:55:31 GMT-0700 (Pacific Daylight Time)">18:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> <p>so, "the generator is provided by the user to a third party library" seems like exactly the case where we want <code>yield</code> to preserve state. taking the example from the readme:</p>
<pre><code class="language-js">  libraryTakingAnIterator(context.run('id', function* () {
    log('starting');

    yield 0;

    // if the library `await`s before resuming, we've lost our id
    log('done');
  }));
</code></pre>
<p>Maybe we should say that any library which consumes iterators in this way needs to juggle contexts properly? but on the other hand it's not clear to me how that's even possible here - how would the library ensure that the second half of the generator runs in the correct context?</p>
</blockquote></mx-reply>Hmm. that example feels odd to me, since execution for the generator doesn't actually start until you call <code>.next()</code>. That said, I'm fine if context propagates over <code>yield</code> if we have a mechanism to affect async flow control.</td></tr>
  <tr class="msg" id="L179"><td class="ts-cell"><a class="ts" href="#L179" alt="Thu Mar 23 2023 11:56:47 GMT-0700 (Pacific Daylight Time)">18:56</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@usharma:igalia.com">ryzokuken</span>&gt;</div></td><td class="msg-cell">note: we'll have to go upto 10m into lunch because of the delays </td></tr>
  <tr class="msg" id="L180"><td class="ts-cell"><a class="ts" href="#L180" alt="Thu Mar 23 2023 12:01:27 GMT-0700 (Pacific Daylight Time)">19:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@justinfagnani:matrix.org">justinfagnani</span>&gt;</div></td><td class="msg-cell">is anyone else not seeing the slides on Zoom?</td></tr>
  <tr class="msg" id="L181"><td class="ts-cell"><a class="ts" href="#L181" alt="Thu Mar 23 2023 12:01:36 GMT-0700 (Pacific Daylight Time)">19:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-1" title="@jesse:igalia.com">Jesse (TC39)</span>&gt;</div></td><td class="msg-cell">yeah</td></tr>
  <tr class="msg" id="L182"><td class="ts-cell"><a class="ts" href="#L182" alt="Thu Mar 23 2023 12:01:42 GMT-0700 (Pacific Daylight Time)">19:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-1" title="@jesse:igalia.com">Jesse (TC39)</span>&gt;</div></td><td class="msg-cell">oops, I mean, I am seeing the slides</td></tr>
  <tr class="msg" id="L183"><td class="ts-cell"><a class="ts" href="#L183" alt="Thu Mar 23 2023 12:01:59 GMT-0700 (Pacific Daylight Time)">19:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@danielrosenwasser:matrix.org">danielrosenwasser</span>&gt;</div></td><td class="msg-cell">quick refresh?</td></tr>
  <tr class="msg" id="L184"><td class="ts-cell"><a class="ts" href="#L184" alt="Thu Mar 23 2023 12:02:28 GMT-0700 (Pacific Daylight Time)">19:02</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@justinfagnani:matrix.org">justinfagnani</span>&gt;</div></td><td class="msg-cell">ah, that did it</td></tr>
  <tr class="msg" id="L185"><td class="ts-cell"><a class="ts" href="#L185" alt="Thu Mar 23 2023 12:02:35 GMT-0700 (Pacific Daylight Time)">19:02</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@justinfagnani:matrix.org">justinfagnani</span>&gt;</div></td><td class="msg-cell">thanks</td></tr>
  <tr class="msg" id="L186"><td class="ts-cell"><a class="ts" href="#L186" alt="Thu Mar 23 2023 12:04:06 GMT-0700 (Pacific Daylight Time)">19:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</div></td><td class="msg-cell">i would like the conversation to come back to what <span class="nick-10">littledan</span> was proposing on "whether we want this feature"</td></tr>
  <tr class="msg" id="L187"><td class="ts-cell"><a class="ts" href="#L187" alt="Thu Mar 23 2023 12:04:20 GMT-0700 (Pacific Daylight Time)">19:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</div></td><td class="msg-cell">all these details beg the question of our already having consensus on that</td></tr>
  <tr class="msg" id="L188"><td class="ts-cell"><a class="ts" href="#L188" alt="Thu Mar 23 2023 12:04:31 GMT-0700 (Pacific Daylight Time)">19:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">I do wish we had more examples yeah</td></tr>
  <tr class="msg" id="L189"><td class="ts-cell"><a class="ts" href="#L189" alt="Thu Mar 23 2023 12:04:39 GMT-0700 (Pacific Daylight Time)">19:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">this is a big complex thing</td></tr>
  <tr class="msg" id="L190"><td class="ts-cell"><a class="ts" href="#L190" alt="Thu Mar 23 2023 12:04:49 GMT-0700 (Pacific Daylight Time)">19:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">so I want to see it being useful for a bunch of things</td></tr>
  <tr class="msg" id="L191"><td class="ts-cell"><a class="ts" href="#L191" alt="Thu Mar 23 2023 12:05:00 GMT-0700 (Pacific Daylight Time)">19:05</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">and I trust justin that it is useful for all the enumerated things, but I can't visualize how yet</td></tr>
  <tr class="msg" id="L192"><td class="ts-cell"><a class="ts" href="#L192" alt="Thu Mar 23 2023 12:05:16 GMT-0700 (Pacific Daylight Time)">19:05</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@littledan:matrix.org">littledan</span>&gt;</div></td><td class="msg-cell"><span class="nick-7">Chengzhong Wu</span>gave a good presentation in WebPerfWG about this</td></tr>
  <tr class="msg" id="L193"><td class="ts-cell"><a class="ts" href="#L193" alt="Thu Mar 23 2023 12:05:17 GMT-0700 (Pacific Daylight Time)">19:05</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> Hmm. that example feels odd to me, since execution for the generator doesn't actually start until you call <code>.next()</code>. That said, I'm fine if context propagates over <code>yield</code> if we have a mechanism to affect async flow control.</blockquote></mx-reply>Actually, if <code>yield</code> propagates context then I'm not even sure a flow-control mechanism would help, since flow control would probably only affect entry to the generator, not reentry via <code>next()</code>.</td></tr>
  <tr class="msg" id="L194"><td class="ts-cell"><a class="ts" href="#L194" alt="Thu Mar 23 2023 12:05:30 GMT-0700 (Pacific Daylight Time)">19:05</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@littledan:matrix.org">littledan</span>&gt;</div></td><td class="msg-cell">Maybe next meeting, this can be given to TC39 again</td></tr>
  <tr class="msg" id="L195"><td class="ts-cell"><a class="ts" href="#L195" alt="Thu Mar 23 2023 12:07:16 GMT-0700 (Pacific Daylight Time)">19:07</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@phryneas:matrix.org">Lenz Weber-Tronic (phryneas)</span>&gt;</div></td><td class="msg-cell"><a href="https://matrix.to/#/%40bakkot%3Amatrix.org">bakkot</a> the most pressing issue I can think of at this time is in servers, where functions need to access stuff related to the current request. At this point it's an absolute pain of passing the current request context down and down and down in method arguments, and it's easily lost.</td></tr>
  <tr class="msg" id="L196"><td class="ts-cell"><a class="ts" href="#L196" alt="Thu Mar 23 2023 12:07:59 GMT-0700 (Pacific Daylight Time)">19:07</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@phryneas:matrix.org">Lenz Weber-Tronic (phryneas)</span>&gt;</div></td><td class="msg-cell">node has <code>AsyncLocalStorage</code> for that, but any framework that wants to support more platforms than that is at a loss at this time.</td></tr>
  <tr class="msg" id="L197"><td class="ts-cell"><a class="ts" href="#L197" alt="Thu Mar 23 2023 12:09:10 GMT-0700 (Pacific Daylight Time)">19:09</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">Lenz Weber-Tronic (phryneas)</span>: I believe you but I need to see it written out</td></tr>
  <tr class="msg" id="L198"><td class="ts-cell"><a class="ts" href="#L198" alt="Thu Mar 23 2023 12:09:17 GMT-0700 (Pacific Daylight Time)">19:09</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@justinfagnani:matrix.org">justinfagnani</span>&gt;</div></td><td class="msg-cell">there's both a question why it's useful, but why it's valuable as a language feature (which is the inability of userland code to correctly wrap all closure-storing APIs or intercept <code>await</code>)</td></tr>
  <tr class="msg" id="L199"><td class="ts-cell"><a class="ts" href="#L199" alt="Thu Mar 23 2023 12:09:24 GMT-0700 (Pacific Daylight Time)">19:09</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell"><span class="nick-2">bakkot</span>: I've used to thread request context information for web requests, such as the current authenticated user, request message, etc. Similar to <code>HttpContext.Current</code> in .NET (which uses the same mechanisms)</td></tr>
  <tr class="msg" id="L200"><td class="ts-cell"><a class="ts" href="#L200" alt="Thu Mar 23 2023 12:09:45 GMT-0700 (Pacific Daylight Time)">19:09</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@justinfagnani:matrix.org">justinfagnani</span>&gt;</div></td><td class="msg-cell">Angular's zones.js problems with <code>await</code> as an example</td></tr>
  <tr class="msg" id="L201"><td class="ts-cell"><a class="ts" href="#L201" alt="Thu Mar 23 2023 12:10:53 GMT-0700 (Pacific Daylight Time)">19:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@abotella:igalia.com">Andreu Botella</span>&gt;</div></td><td class="msg-cell"><span class="nick-8">shu</span>: <span class="nick-7">Chengzhong Wu</span> and me are going to prototype a V8 implementation to see performance and integration with task attribution</td></tr>
  <tr class="msg" id="L202"><td class="ts-cell"><a class="ts" href="#L202" alt="Thu Mar 23 2023 12:11:12 GMT-0700 (Pacific Daylight Time)">19:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@phryneas:matrix.org">Lenz Weber-Tronic (phryneas)</span>&gt;</div></td><td class="msg-cell"><a href="https://matrix.to/#/%40bakkot%3Amatrix.org">bakkot</a> how exactly would "written out" look in this case? Just trying to figure out how to best give you the example.<br>
Imagine you have a call stack that is 50 calls deep. Either you have a <code>, context</code> argument in every of those functions, or the one function at depth 50 can call <code>getCurrentRequest()</code> which wraps <code>requestContext.get()</code></td></tr>
  <tr class="msg" id="L203"><td class="ts-cell"><a class="ts" href="#L203" alt="Thu Mar 23 2023 12:11:22 GMT-0700 (Pacific Daylight Time)">19:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">Lenz Weber-Tronic (phryneas)</span>: written out meaning, like, code</td></tr>
  <tr class="msg" id="L204"><td class="ts-cell"><a class="ts" href="#L204" alt="Thu Mar 23 2023 12:11:31 GMT-0700 (Pacific Daylight Time)">19:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">Andreu Botella</span>: in blink as well? any benchmarks in mind?</td></tr>
  <tr class="msg" id="L205"><td class="ts-cell"><a class="ts" href="#L205" alt="Thu Mar 23 2023 12:11:38 GMT-0700 (Pacific Daylight Time)">19:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@danielrosenwasser:matrix.org">danielrosenwasser</span>&gt;</div></td><td class="msg-cell"><p>I very much don't have expertise to weigh in on this API, so I can just give trust that in the current direction; but it sounds like the feature works "in the abstract". I wish there was a prototype or sample codebase so that we could have a sample in which it could be demonstrated:</p>
<ul>
<li>"now let's add logging"</li>
<li>"now let's add ..."</li>
</ul>
<p>and see how that composes in practice. And I'm fine with discussing that in stage 2.</p>
</td></tr>
  <tr class="msg" id="L206"><td class="ts-cell"><a class="ts" href="#L206" alt="Thu Mar 23 2023 12:11:55 GMT-0700 (Pacific Daylight Time)">19:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@littledan:matrix.org">littledan</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> <span class="nick-4">Andreu Botella</span>: in blink as well? any benchmarks in mind?</blockquote></mx-reply>In blink: Yes. Benchmarks: welcome.</td></tr>
  <tr class="msg" id="L207"><td class="ts-cell"><a class="ts" href="#L207" alt="Thu Mar 23 2023 12:12:02 GMT-0700 (Pacific Daylight Time)">19:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">i.e. assume this API exists. what does code using it look like, concretely, that would run if it were in the language</td></tr>
  <tr class="msg" id="L208"><td class="ts-cell"><a class="ts" href="#L208" alt="Thu Mar 23 2023 12:12:26 GMT-0700 (Pacific Daylight Time)">19:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</div></td><td class="msg-cell"><span class="nick-10">littledan</span>: it can't be just "welcome", i'm asking how andreu plans to "see performance"?</td></tr>
  <tr class="msg" id="L209"><td class="ts-cell"><a class="ts" href="#L209" alt="Thu Mar 23 2023 12:12:57 GMT-0700 (Pacific Daylight Time)">19:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</div></td><td class="msg-cell">we know it's possible to implement</td></tr>
  <tr class="msg" id="L210"><td class="ts-cell"><a class="ts" href="#L210" alt="Thu Mar 23 2023 12:13:05 GMT-0700 (Pacific Daylight Time)">19:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-11" title="@apaprocki:matrix.org">apaprocki</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> i.e. assume this API exists. what does code using it look like, concretely, that would run if it were in the language</blockquote></mx-reply>You could survey usage of Node's API for example code, since it essentially provides the same functionality</td></tr>
  <tr class="msg" id="L211"><td class="ts-cell"><a class="ts" href="#L211" alt="Thu Mar 23 2023 12:13:14 GMT-0700 (Pacific Daylight Time)">19:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@littledan:matrix.org">littledan</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> <span class="nick-10">littledan</span>: it can't be just "welcome", i'm asking how andreu plans to "see performance"?</blockquote></mx-reply>OK, well, yeah, this is a reasonable requirement, and we should look into it. Keeping performance good is a goal as Justin has repeatedly said. Bloomberg is sponsoring Igalia's involvement in implementation work.</td></tr>
  <tr class="msg" id="L212"><td class="ts-cell"><a class="ts" href="#L212" alt="Thu Mar 23 2023 12:13:30 GMT-0700 (Pacific Daylight Time)">19:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@littledan:matrix.org">littledan</span>&gt;</div></td><td class="msg-cell">and yeah the burden should be on us to prove that it's good.</td></tr>
  <tr class="msg" id="L213"><td class="ts-cell"><a class="ts" href="#L213" alt="Thu Mar 23 2023 12:13:36 GMT-0700 (Pacific Daylight Time)">19:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@abotella:igalia.com">Andreu Botella</span>&gt;</div></td><td class="msg-cell">Yeah, we'll be looking into that. We don't yet have any benchmarks in mind, but this is still very early on</td></tr>
  <tr class="msg" id="L214"><td class="ts-cell"><a class="ts" href="#L214" alt="Thu Mar 23 2023 12:13:50 GMT-0700 (Pacific Daylight Time)">19:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@abotella:igalia.com">Andreu Botella</span>&gt;</div></td><td class="msg-cell">like, we were literally discussing this earlier today</td></tr>
  <tr class="msg" id="L215"><td class="ts-cell"><a class="ts" href="#L215" alt="Thu Mar 23 2023 12:13:54 GMT-0700 (Pacific Daylight Time)">19:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@phryneas:matrix.org">Lenz Weber-Tronic (phryneas)</span>&gt;</div></td><td class="msg-cell"><p><a href="https://matrix.to/#/%40bakkot%3Amatrix.org">bakkot</a> it does exist, in some form, in node</p>
<p>An example would be the NextJs <code>headers</code> function. This functionality would not be able at all in React-land without this API:<br>
<a href="https://beta.nextjs.org/docs/api-reference/headers">https://beta.nextjs.org/docs/api-reference/headers</a></p></td></tr>
  <tr class="msg" id="L216"><td class="ts-cell"><a class="ts" href="#L216" alt="Thu Mar 23 2023 12:13:57 GMT-0700 (Pacific Daylight Time)">19:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</div></td><td class="msg-cell">it doesn't have to be a real benchmark</td></tr>
  <tr class="msg" id="L217"><td class="ts-cell"><a class="ts" href="#L217" alt="Thu Mar 23 2023 12:14:04 GMT-0700 (Pacific Daylight Time)">19:14</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</div></td><td class="msg-cell">i'm just wondering how you plan to verify anything</td></tr>
  <tr class="msg" id="L218"><td class="ts-cell"><a class="ts" href="#L218" alt="Thu Mar 23 2023 12:14:12 GMT-0700 (Pacific Daylight Time)">19:14</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</div></td><td class="msg-cell">(not being flippant if i sounded that way)</td></tr>
  <tr class="msg" id="L219"><td class="ts-cell"><a class="ts" href="#L219" alt="Thu Mar 23 2023 12:14:31 GMT-0700 (Pacific Daylight Time)">19:14</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-7" title="@legendecas:matrix.org">Chengzhong Wu</span>&gt;</div></td><td class="msg-cell">In Node.js we have several micro-benchmarks that we can port to AsyncContext: <a href="https://github.com/nodejs/node/tree/main/benchmark/async_hooks">https://github.com/nodejs/node/tree/main/benchmark/async_hooks</a></td></tr>
  <tr class="msg" id="L220"><td class="ts-cell"><a class="ts" href="#L220" alt="Thu Mar 23 2023 12:15:45 GMT-0700 (Pacific Daylight Time)">19:15</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-7" title="@legendecas:matrix.org">Chengzhong Wu</span>&gt;</div></td><td class="msg-cell">And we can adopt OpenTelemetry's real world use cases for benchmarking if needed.</td></tr>
  <tr class="msg" id="L221"><td class="ts-cell"><a class="ts" href="#L221" alt="Thu Mar 23 2023 12:15:54 GMT-0700 (Pacific Daylight Time)">19:15</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</div></td><td class="msg-cell">sorry let me be clearer</td></tr>
  <tr class="msg" id="L222"><td class="ts-cell"><a class="ts" href="#L222" alt="Thu Mar 23 2023 12:16:08 GMT-0700 (Pacific Daylight Time)">19:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</div></td><td class="msg-cell">the performance concern is <em>not</em> that AsyncContext <em>itself</em> will be too slow</td></tr>
  <tr class="msg" id="L223"><td class="ts-cell"><a class="ts" href="#L223" alt="Thu Mar 23 2023 12:16:11 GMT-0700 (Pacific Daylight Time)">19:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</div></td><td class="msg-cell">it's fine for new features to be slow</td></tr>
  <tr class="msg" id="L224"><td class="ts-cell"><a class="ts" href="#L224" alt="Thu Mar 23 2023 12:16:31 GMT-0700 (Pacific Daylight Time)">19:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</div></td><td class="msg-cell">the way this feature must be implemented is In The Deep at the engine level</td></tr>
  <tr class="msg" id="L225"><td class="ts-cell"><a class="ts" href="#L225" alt="Thu Mar 23 2023 12:16:39 GMT-0700 (Pacific Daylight Time)">19:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</div></td><td class="msg-cell">which means it affects performance of <em>all</em> executions even if they don't use the feature</td></tr>
  <tr class="msg" id="L226"><td class="ts-cell"><a class="ts" href="#L226" alt="Thu Mar 23 2023 12:17:02 GMT-0700 (Pacific Daylight Time)">19:17</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</div></td><td class="msg-cell">i would like to see things that suggest that this feature can in fact be pay-as-you-go (or close to it), and executions that don't use the feature don't suffer performance regressions</td></tr>
  <tr class="msg" id="L227"><td class="ts-cell"><a class="ts" href="#L227" alt="Thu Mar 23 2023 12:17:16 GMT-0700 (Pacific Daylight Time)">19:17</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</div></td><td class="msg-cell">oops, missed an operative "not" above</td></tr>
  <tr class="msg" id="L228"><td class="ts-cell"><a class="ts" href="#L228" alt="Thu Mar 23 2023 12:17:29 GMT-0700 (Pacific Daylight Time)">19:17</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@benjamn:matrix.org">Ben Newman (Apollo, @benjamn on GH)</span>&gt;</div></td><td class="msg-cell">V8 is already saving/restoring the <code>v8::Context::{Get,Set}ContinuationPreservedEmbedderData</code> today, which is close to what this proposal needs</td></tr>
  <tr class="msg" id="L229"><td class="ts-cell"><a class="ts" href="#L229" alt="Thu Mar 23 2023 12:17:39 GMT-0700 (Pacific Daylight Time)">19:17</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</div></td><td class="msg-cell">please, i know how V8 works</td></tr>
  <tr class="msg" id="L230"><td class="ts-cell"><a class="ts" href="#L230" alt="Thu Mar 23 2023 12:17:54 GMT-0700 (Pacific Daylight Time)">19:17</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@benjamn:matrix.org">Ben Newman (Apollo, @benjamn on GH)</span>&gt;</div></td><td class="msg-cell">I know!</td></tr>
  <tr class="msg" id="L231"><td class="ts-cell"><a class="ts" href="#L231" alt="Thu Mar 23 2023 12:18:25 GMT-0700 (Pacific Daylight Time)">19:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@littledan:matrix.org">littledan</span>&gt;</div></td><td class="msg-cell">Yeah, it will be a clear requirement that this doesn't slow down V8. We can the existing public V8 benchmarks to verify (and I know you have CI that will also verify this after it lands).</td></tr>
  <tr class="msg" id="L232"><td class="ts-cell"><a class="ts" href="#L232" alt="Thu Mar 23 2023 12:18:30 GMT-0700 (Pacific Daylight Time)">19:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</div></td><td class="msg-cell">but that thing is set by the embedder in a very bounded way, in a way that V8 folks aren't 100% happy with anyway</td></tr>
  <tr class="msg" id="L233"><td class="ts-cell"><a class="ts" href="#L233" alt="Thu Mar 23 2023 12:18:42 GMT-0700 (Pacific Daylight Time)">19:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</div></td><td class="msg-cell">for this to become JS programmable opens up new unknowns we should understand</td></tr>
  <tr class="msg" id="L234"><td class="ts-cell"><a class="ts" href="#L234" alt="Thu Mar 23 2023 12:18:43 GMT-0700 (Pacific Daylight Time)">19:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@littledan:matrix.org">littledan</span>&gt;</div></td><td class="msg-cell">I'm very encouraged by how TaskAttribution landed and is always on in Chrome, apparently without performance overhead</td></tr>
  <tr class="msg" id="L235"><td class="ts-cell"><a class="ts" href="#L235" alt="Thu Mar 23 2023 12:18:44 GMT-0700 (Pacific Daylight Time)">19:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@benjamn:matrix.org">Ben Newman (Apollo, @benjamn on GH)</span>&gt;</div></td><td class="msg-cell">fair enough / good to know</td></tr>
  <tr class="msg" id="L236"><td class="ts-cell"><a class="ts" href="#L236" alt="Thu Mar 23 2023 12:18:58 GMT-0700 (Pacific Daylight Time)">19:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@littledan:matrix.org">littledan</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> but that thing is set by the embedder in a very bounded way, in a way that V8 folks aren't 100% happy with anyway</blockquote></mx-reply>Would be great to learn in what way V8 folks aren't happy with it for now</td></tr>
  <tr class="msg" id="L237"><td class="ts-cell"><a class="ts" href="#L237" alt="Thu Mar 23 2023 12:19:19 GMT-0700 (Pacific Daylight Time)">19:19</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</div></td><td class="msg-cell">fair, i'll try to understand this unhappiness deeply so i can articulate it</td></tr>
  <tr class="msg" id="L238"><td class="ts-cell"><a class="ts" href="#L238" alt="Thu Mar 23 2023 12:20:06 GMT-0700 (Pacific Daylight Time)">19:20</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-1" title="@jridgewell:matrix.org">Justin Ridgewell</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> Yeah it'd be great to have a name brainstorm here (in an issue, not during plenary). <a href="https://github.com/tc39/proposal-async-context/issues">https://github.com/tc39/proposal-async-context/issues</a></blockquote></mx-reply>As long as we don't call this <code>AsyncLocalStorage</code>, which is AsyncLocal-Storage and not Async-LocalStorage.</td></tr>
  <tr class="msg" id="L239"><td class="ts-cell"><a class="ts" href="#L239" alt="Thu Mar 23 2023 12:21:27 GMT-0700 (Pacific Daylight Time)">19:21</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@haxjs:matrix.org">HE Shi-Jun</span>&gt;</div></td><td class="msg-cell">I still like <code>AsyncLocal</code> which make the analog to <code>ThreadLocal</code> in other langauges.</td></tr>
  <tr class="msg" id="L240"><td class="ts-cell"><a class="ts" href="#L240" alt="Thu Mar 23 2023 12:21:59 GMT-0700 (Pacific Daylight Time)">19:21</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@haxjs:matrix.org">HE Shi-Jun</span>&gt;</div></td><td class="msg-cell">We don't have notes of current topic?</td></tr>
  <tr class="msg" id="L241"><td class="ts-cell"><a class="ts" href="#L241" alt="Thu Mar 23 2023 12:22:07 GMT-0700 (Pacific Daylight Time)">19:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-1" title="@jridgewell:matrix.org">Justin Ridgewell</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> <p>so, "the generator is provided by the user to a third party library" seems like exactly the case where we want <code>yield</code> to preserve state. taking the example from the readme:</p>
<pre><code class="language-js">  libraryTakingAnIterator(context.run('id', function* () {
    log('starting');

    yield 0;

    // if the library `await`s before resuming, we've lost our id
    log('done');
  }));
</code></pre>
<p>Maybe we should say that any library which consumes iterators in this way needs to juggle contexts properly? but on the other hand it's not clear to me how that's even possible here - how would the library ensure that the second half of the generator runs in the correct context?</p>
</blockquote></mx-reply>I think the more natural is to do <code><a href="http://context.run">context.run</a>(libraryTakingAnIterator(…))</code>, in which case both call and init time would be equivalent</td></tr>
  <tr class="msg" id="L242"><td class="ts-cell"><a class="ts" href="#L242" alt="Thu Mar 23 2023 12:22:08 GMT-0700 (Pacific Daylight Time)">19:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@abotella:igalia.com">Andreu Botella</span>&gt;</div></td><td class="msg-cell">An "async context" in common parlance would seem to refer to the entire async-local map, rather than to an entry</td></tr>
  <tr class="msg" id="L243"><td class="ts-cell"><a class="ts" href="#L243" alt="Thu Mar 23 2023 12:22:17 GMT-0700 (Pacific Daylight Time)">19:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@abotella:igalia.com">Andreu Botella</span>&gt;</div></td><td class="msg-cell">so there's also that</td></tr>
  <tr class="msg" id="L244"><td class="ts-cell"><a class="ts" href="#L244" alt="Thu Mar 23 2023 12:22:34 GMT-0700 (Pacific Daylight Time)">19:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-1" title="@jridgewell:matrix.org">Justin Ridgewell</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> We don't have notes of current topic?</blockquote></mx-reply>It's lunch, not an official presentation</td></tr>
  <tr class="msg" id="L245"><td class="ts-cell"><a class="ts" href="#L245" alt="Thu Mar 23 2023 12:24:49 GMT-0700 (Pacific Daylight Time)">19:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@haxjs:matrix.org">HE Shi-Jun</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> It's lunch, not an official presentation</blockquote></mx-reply>ok, though I would like it also have the notes (I use notes as subtitle :)</td></tr>
  <tr class="msg" id="L246"><td class="ts-cell"><a class="ts" href="#L246" alt="Thu Mar 23 2023 12:25:13 GMT-0700 (Pacific Daylight Time)">19:25</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@haxjs:matrix.org">HE Shi-Jun</span>&gt;</div></td><td class="msg-cell">especially zoom do not have auto subtitle :(</td></tr>
  <tr class="msg" id="L247"><td class="ts-cell"><a class="ts" href="#L247" alt="Thu Mar 23 2023 12:25:52 GMT-0700 (Pacific Daylight Time)">19:25</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-1" title="@jridgewell:matrix.org">Justin Ridgewell</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> <span class="nick-8">shu</span>: <span class="nick-7">Chengzhong Wu</span> and me are going to prototype a V8 implementation to see performance and integration with task attribution</blockquote></mx-reply>My hope is that this will literally have 0 performance penalty for code not using <code>AsyncContext</code>, and be like 0.00001% slowdown for code that is.</td></tr>
  <tr class="msg" id="L248"><td class="ts-cell"><a class="ts" href="#L248" alt="Thu Mar 23 2023 12:26:17 GMT-0700 (Pacific Daylight Time)">19:26</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-1" title="@jridgewell:matrix.org">Justin Ridgewell</span>&gt;</div></td><td class="msg-cell">I believe the current node addon impl has that guarantee</td></tr>
  <tr class="msg" id="L249"><td class="ts-cell"><a class="ts" href="#L249" alt="Thu Mar 23 2023 12:26:28 GMT-0700 (Pacific Daylight Time)">19:26</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@benjamn:matrix.org">Ben Newman (Apollo, @benjamn on GH)</span>&gt;</div></td><td class="msg-cell">possible jargon to distinguish between whole-map and individual items: "supertext" (not a real word) and "subtext"?</td></tr>
  <tr class="msg" id="L250"><td class="ts-cell"><a class="ts" href="#L250" alt="Thu Mar 23 2023 12:26:45 GMT-0700 (Pacific Daylight Time)">19:26</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@benjamn:matrix.org">Ben Newman (Apollo, @benjamn on GH)</span>&gt;</div></td><td class="msg-cell">I agree this is a common ambiguity when talking about context, even at a linguistic level</td></tr>
  <tr class="msg" id="L251"><td class="ts-cell"><a class="ts" href="#L251" alt="Thu Mar 23 2023 12:31:34 GMT-0700 (Pacific Daylight Time)">19:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-1" title="@jridgewell:matrix.org">Justin Ridgewell</span>&gt;</div></td><td class="msg-cell">Zoom does, but I don't know how to enable it</td></tr>
  <tr class="msg" id="L252"><td class="ts-cell"><a class="ts" href="#L252" alt="Thu Mar 23 2023 12:41:53 GMT-0700 (Pacific Daylight Time)">19:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</div></td><td class="msg-cell">my hope goes with you</td></tr>
  <tr class="msg" id="L253"><td class="ts-cell"><a class="ts" href="#L253" alt="Thu Mar 23 2023 12:45:04 GMT-0700 (Pacific Daylight Time)">19:45</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</div></td><td class="msg-cell"><p><span class="nick-10">waldemar</span>: so, re: the C++ release fence. in short, you are correct that in the C++ memory model the release fence doesn't sync-with without a corresponding acquire operation on another thread.</p>
<p>the way V8 (and JVM) reason about this i think is more at the ISA level, per ISA. like, we think a store-store fence (<code>dmb</code> on ARM) or whatever is sufficient to publish. we need to ensure no store-store reorderings happen at both the codegen level and the CPU level.</p>
<p>the <code>dmb</code> guarantees that at the CPU level. a release fence seems to guarantee that at the codegen level, but strictly speaking may be incorrect.</p>
<p>maybe manual inline assembly is better here? idk</p>
</td></tr>
  <tr class="msg" id="L254"><td class="ts-cell"><a class="ts" href="#L254" alt="Thu Mar 23 2023 12:45:22 GMT-0700 (Pacific Daylight Time)">19:45</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</div></td><td class="msg-cell">in any case V8 mixes C++ generated code and our own generated code liberally anyway, since it's a JIT</td></tr>
  <tr class="msg" id="L255"><td class="ts-cell"><a class="ts" href="#L255" alt="Thu Mar 23 2023 12:45:34 GMT-0700 (Pacific Daylight Time)">19:45</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</div></td><td class="msg-cell">and i've never wrapped my head around reasoning at the C++ memory model level</td></tr>
  <tr class="msg" id="L256"><td class="ts-cell"><a class="ts" href="#L256" alt="Thu Mar 23 2023 12:45:39 GMT-0700 (Pacific Daylight Time)">19:45</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</div></td><td class="msg-cell">because of course taht doesn't exist for our own generated code</td></tr>
  <tr class="msg" id="L257"><td class="ts-cell"><a class="ts" href="#L257" alt="Thu Mar 23 2023 12:45:57 GMT-0700 (Pacific Daylight Time)">19:45</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</div></td><td class="msg-cell">so i generally try to reason about it by divining what ARM guarantees, then trying to shape C++ to generate the right thing</td></tr>
  <tr class="msg" id="L258"><td class="ts-cell"><a class="ts" href="#L258" alt="Thu Mar 23 2023 12:46:15 GMT-0700 (Pacific Daylight Time)">19:46</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</div></td><td class="msg-cell">(or what x86 guarantees etc)</td></tr>
  <tr class="msg" id="L259"><td class="ts-cell"><a class="ts" href="#L259" alt="Thu Mar 23 2023 12:47:19 GMT-0700 (Pacific Daylight Time)">19:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</div></td><td class="msg-cell">in fact, V8 also does the even more un-specified thing around atomics where we just bitcast addresses to <code>std::atomic</code>s</td></tr>
  <tr class="msg" id="L260"><td class="ts-cell"><a class="ts" href="#L260" alt="Thu Mar 23 2023 12:47:24 GMT-0700 (Pacific Daylight Time)">19:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</div></td><td class="msg-cell">but i think that behavior may finally be getting specced?</td></tr>
  <tr class="msg" id="L261"><td class="ts-cell"><a class="ts" href="#L261" alt="Thu Mar 23 2023 12:53:55 GMT-0700 (Pacific Daylight Time)">19:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</div></td><td class="msg-cell">omg it's this sub-thread that was keeping my notification at 1</td></tr>
  <tr class="msg" id="L262"><td class="ts-cell"><a class="ts" href="#L262" alt="Thu Mar 23 2023 12:54:09 GMT-0700 (Pacific Daylight Time)">19:54</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</div></td><td class="msg-cell">and now i've made it worse for other people, sorry</td></tr>
  <tr class="msg" id="L263"><td class="ts-cell"><a class="ts" href="#L263" alt="Thu Mar 23 2023 12:59:18 GMT-0700 (Pacific Daylight Time)">19:59</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell">I may be a minute or two late getting back. My dogs need a bio break and don't care about the plenary schedule.</td></tr>
  <tr class="msg" id="L264"><td class="ts-cell"><a class="ts" href="#L264" alt="Thu Mar 23 2023 13:02:20 GMT-0700 (Pacific Daylight Time)">20:02</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> I may be a minute or two late getting back. My dogs need a bio break and don't care about the plenary schedule.</blockquote></mx-reply>I'm back</td></tr>
  <tr class="msg" id="L265"><td class="ts-cell"><a class="ts" href="#L265" alt="Thu Mar 23 2023 13:08:44 GMT-0700 (Pacific Daylight Time)">20:08</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell"><span class="nick-6">ljharb</span>: was it es-shims which deletes it? for the notes</td></tr>
  <tr class="msg" id="L266"><td class="ts-cell"><a class="ts" href="#L266" alt="Thu Mar 23 2023 13:08:59 GMT-0700 (Pacific Daylight Time)">20:08</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@ljharb:matrix.org">ljharb</span>&gt;</div></td><td class="msg-cell"><code>es6-shim</code>, specifically. core-js may, i'm not sure</td></tr>
  <tr class="msg" id="L267"><td class="ts-cell"><a class="ts" href="#L267" alt="Thu Mar 23 2023 13:09:01 GMT-0700 (Pacific Daylight Time)">20:09</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">(I just missed the name)</td></tr>
  <tr class="msg" id="L268"><td class="ts-cell"><a class="ts" href="#L268" alt="Thu Mar 23 2023 13:09:02 GMT-0700 (Pacific Daylight Time)">20:09</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-1" title="@jridgewell:matrix.org">Justin Ridgewell</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> my hope goes with you</blockquote></mx-reply>Worth also noting is that node is already eating performance with usage of <code>AsyncLocalStorage</code>, my apps are losing native <code>async</code>/<code>await</code> performance due to my need to polyfill</td></tr>
  <tr class="msg" id="L269"><td class="ts-cell"><a class="ts" href="#L269" alt="Thu Mar 23 2023 13:09:22 GMT-0700 (Pacific Daylight Time)">20:09</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@littledan:matrix.org">littledan</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> Worth also noting is that node is already eating performance with usage of <code>AsyncLocalStorage</code>, my apps are losing native <code>async</code>/<code>await</code> performance due to my need to polyfill</blockquote></mx-reply>Sure, but we also need to make sure that this doesn't make websites slower</td></tr>
  <tr class="msg" id="L270"><td class="ts-cell"><a class="ts" href="#L270" alt="Thu Mar 23 2023 13:09:25 GMT-0700 (Pacific Daylight Time)">20:09</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-1" title="@jridgewell:matrix.org">Justin Ridgewell</span>&gt;</div></td><td class="msg-cell">We already live in a slow world, and this API should be much faster than the status quo</td></tr>
  <tr class="msg" id="L271"><td class="ts-cell"><a class="ts" href="#L271" alt="Thu Mar 23 2023 13:09:29 GMT-0700 (Pacific Daylight Time)">20:09</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</div></td><td class="msg-cell">the hard line is "no speedometer regressions"</td></tr>
  <tr class="msg" id="L272"><td class="ts-cell"><a class="ts" href="#L272" alt="Thu Mar 23 2023 13:09:35 GMT-0700 (Pacific Daylight Time)">20:09</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</div></td><td class="msg-cell">hard-ish</td></tr>

</tbody></table></div></div></div>
</body></html>
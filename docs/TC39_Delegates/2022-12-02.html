<!DOCTYPE html><html><head>
  <title>TC39 Delegates on 2022-12-02</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "TC39 Delegates";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">TC39 Delegates<br>2022-12-02<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2022-12-01" class="nav-link"><span>prev</span></a>
<a href="2022-12-03" class="nav-link"><span style="float:right">next</span></a>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">
<div class="rhs-header">
<span id="error" style="color: red; display:none">error</span>

<input type="text" id="query" size="25" placeholder="Search TC39 Delegates">
<a id="search-submit" class="button icon-link" title="Search">
  <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"></path></svg>
</a>
</div>

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Thu Dec 01 2022 16:23:45 GMT-0800 (Pacific Standard Time)">00:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> <span class="nick-15">rbuckton</span>: I do want to confer with you sometime in December (but not in the next few days) about the resource management, cancellation, and proxy revocation proposals.  Do you attend SES's strategy sessions occasionally?</blockquote></mx-reply>I haven't so far, mostly due to time constraints. I can make some time though.</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Thu Dec 01 2022 16:28:17 GMT-0800 (Pacific Standard Time)">00:28</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell"><p>My suggestion was to just close over regular bindings, and when serializing determine if the binding is:</p>
<ol>
<li>rewritable (i.e., globals)</li>
<li>serializable (such as another <code>module</code>)</li>
<li>non-portable (anything else)<br>and throw if there are any non-portable values.</li>
</ol>
<p>A side benefit would be that it would be an error to accidentally reference a variable that shadows a global.</p>
</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Thu Dec 01 2022 16:29:38 GMT-0800 (Pacific Standard Time)">00:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell">To further clarify, we'd determine if a <em>binding</em> is rewritable or not rewritable, and if the binding is not rewritable, determine if its <em>value</em> is portable (i.e., serializable) or non-portable.</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Thu Dec 01 2022 16:30:06 GMT-0800 (Pacific Standard Time)">00:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@littledan:matrix.org">littledan</span>&gt;</div></td><td class="msg-cell">When blöcks was presented, there was a lot of skepticism about this particular aspect of the proposal. It is very deliberate that module blocks omits it.</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Thu Dec 01 2022 16:31:19 GMT-0800 (Pacific Standard Time)">00:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@littledan:matrix.org">littledan</span>&gt;</div></td><td class="msg-cell">I honestly don’t understand how we could make this mechanism work well enough, given how dynamic JS is and how this committee tries to meet expectations of all the edge cases working well (eg with eval)</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Thu Dec 01 2022 16:31:45 GMT-0800 (Pacific Standard Time)">00:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@littledan:matrix.org">littledan</span>&gt;</div></td><td class="msg-cell">I like that you have some details spelled out though</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Thu Dec 01 2022 16:32:45 GMT-0800 (Pacific Standard Time)">00:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell">IIRC, the blöcks proposal wanted you to substitute the bindings explicitly when you instantiated the block </td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Thu Dec 01 2022 16:32:57 GMT-0800 (Pacific Standard Time)">00:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@littledan:matrix.org">littledan</span>&gt;</div></td><td class="msg-cell">In particular I don’t know how “rewritable” would work. Module blocks is content with just reevaluating in the other realm.</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Thu Dec 01 2022 16:33:29 GMT-0800 (Pacific Standard Time)">00:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> In particular I don’t know how “rewritable” would work. Module blocks is content with just reevaluating in the other realm.</blockquote></mx-reply>That's exactly what I mean by rewritable: "these are the things that you just reevaluate in the other realm"</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Thu Dec 01 2022 16:33:36 GMT-0800 (Pacific Standard Time)">00:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@littledan:matrix.org">littledan</span>&gt;</div></td><td class="msg-cell">Ah Ok</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Thu Dec 01 2022 16:34:05 GMT-0800 (Pacific Standard Time)">00:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell">The current proposal allows you to lexically reference another <code>module</code> and explicitly breaks that model, since you're not just looking up that name in another realm.</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Thu Dec 01 2022 16:34:38 GMT-0800 (Pacific Standard Time)">00:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@littledan:matrix.org">littledan</span>&gt;</div></td><td class="msg-cell">So the other thing is, given module blocks, you can define a system which serializes a list of things and then passes them as arguments to a default-exported function. I guess a bit more unergonomic due to the duplication though.</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Thu Dec 01 2022 16:35:16 GMT-0800 (Pacific Standard Time)">00:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> So the other thing is, given module blocks, you can define a system which serializes a list of things and then passes them as arguments to a default-exported function. I guess a bit more unergonomic due to the duplication though.</blockquote></mx-reply>I had thought of that approach when I discussed the proposal with my team on Monday.</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Thu Dec 01 2022 16:35:30 GMT-0800 (Pacific Standard Time)">00:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@littledan:matrix.org">littledan</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> The current proposal allows you to lexically reference another <code>module</code> and explicitly breaks that model, since you're not just looking up that name in another realm.</blockquote></mx-reply>Yeah, I can empathize with this; this is why I raised the separate namespace idea above</td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Thu Dec 01 2022 16:36:02 GMT-0800 (Pacific Standard Time)">00:36</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell">Another approach would be to go the WASM route where you have to explicitly provide any external module references when instantiating the <code>Module</code>, which would mean no lexical scoping.</td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Thu Dec 01 2022 16:36:39 GMT-0800 (Pacific Standard Time)">00:36</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell">That would still work with bundlers, though they'd need to emit a chunk of code at the bottom of the file that linked all of the declarations together.</td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Thu Dec 01 2022 16:37:12 GMT-0800 (Pacific Standard Time)">00:37</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@littledan:matrix.org">littledan</span>&gt;</div></td><td class="msg-cell">Yeah, Nicolo has sketched out this chunk of code in a gist. It would work with module expressions + the importHook in the module constructor</td></tr>
  <tr class="msg" id="L17"><td class="ts-cell"><a class="ts" href="#L17" alt="Thu Dec 01 2022 16:37:41 GMT-0800 (Pacific Standard Time)">00:37</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@littledan:matrix.org">littledan</span>&gt;</div></td><td class="msg-cell">I got the impression that V8 was highly skeptical of this hook. Module declarations are more limited in expressiveness; more “static”</td></tr>
  <tr class="msg" id="L18"><td class="ts-cell"><a class="ts" href="#L18" alt="Thu Dec 01 2022 16:37:59 GMT-0800 (Pacific Standard Time)">00:37</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@littledan:matrix.org">littledan</span>&gt;</div></td><td class="msg-cell">Anyway there are probably bundler use cases that need the dynamic hook</td></tr>
  <tr class="msg" id="L19"><td class="ts-cell"><a class="ts" href="#L19" alt="Thu Dec 01 2022 16:38:49 GMT-0800 (Pacific Standard Time)">00:38</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell">If there was no lexical closure for modules, you could still have <code>import {} from id</code> but you'd need to define those ids when instantiating the module, i.e. <code>await import(module { import foo; }, { bindings: { foo: module {} } })</code></td></tr>
  <tr class="msg" id="L20"><td class="ts-cell"><a class="ts" href="#L20" alt="Thu Dec 01 2022 16:39:01 GMT-0800 (Pacific Standard Time)">00:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@kriskowal:matrix.org">Kris Kowal</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> That would still work with bundlers, though they'd need to emit a chunk of code at the bottom of the file that linked all of the declarations together.</blockquote></mx-reply>This is consistent with what’s possible with just module expressions and the Module constructor.</td></tr>
  <tr class="msg" id="L21"><td class="ts-cell"><a class="ts" href="#L21" alt="Thu Dec 01 2022 16:39:22 GMT-0800 (Pacific Standard Time)">00:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell">That would be roughly analogous to the blöcks proposal where you'd need to supply values for bindings.</td></tr>
  <tr class="msg" id="L22"><td class="ts-cell"><a class="ts" href="#L22" alt="Thu Dec 01 2022 16:41:05 GMT-0800 (Pacific Standard Time)">00:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@kriskowal:matrix.org">Kris Kowal</span>&gt;</div></td><td class="msg-cell">Concretely, this is Nicolò’s sketch of a module expression and Module constructor bundle generator <a href="https://gist.github.com/nicolo-ribaudo/81f18db096659ac8447ca94f50f2c37a">https://gist.github.com/nicolo-ribaudo/81f18db096659ac8447ca94f50f2c37a</a></td></tr>
  <tr class="msg" id="L23"><td class="ts-cell"><a class="ts" href="#L23" alt="Thu Dec 01 2022 16:41:57 GMT-0800 (Pacific Standard Time)">00:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell"><p>You could even do that with module declarations and stitch them together using a <code>with</code> clause:</p>
<pre><code class="language-js">module foo { }
module bar { import foo } // NOTE: not a closure, just an unsatisfied binding
import bar with { bindings: { foo } };
</code></pre>
</td></tr>
  <tr class="msg" id="L24"><td class="ts-cell"><a class="ts" href="#L24" alt="Thu Dec 01 2022 16:42:42 GMT-0800 (Pacific Standard Time)">00:42</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@kriskowal:matrix.org">Kris Kowal</span>&gt;</div></td><td class="msg-cell">In my opinion, module expressions fully solve the bundling problem.</td></tr>
  <tr class="msg" id="L25"><td class="ts-cell"><a class="ts" href="#L25" alt="Thu Dec 01 2022 16:42:43 GMT-0800 (Pacific Standard Time)">00:42</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell">Its definitely not as convenient</td></tr>
  <tr class="msg" id="L26"><td class="ts-cell"><a class="ts" href="#L26" alt="Thu Dec 01 2022 16:43:15 GMT-0800 (Pacific Standard Time)">00:43</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@kriskowal:matrix.org">Kris Kowal</span>&gt;</div></td><td class="msg-cell">Pardon module expressions + <code>Module</code> constructor.</td></tr>
  <tr class="msg" id="L27"><td class="ts-cell"><a class="ts" href="#L27" alt="Thu Dec 01 2022 16:44:05 GMT-0800 (Pacific Standard Time)">00:44</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@kriskowal:matrix.org">Kris Kowal</span>&gt;</div></td><td class="msg-cell">(<code>ModuleSource</code> constructor not being necessary to that end and if the committee is intransigent about <code>ModuleSource</code> providing a path to <code>eval</code>, I’m in favor of further separation of layers.)</td></tr>
  <tr class="msg" id="L28"><td class="ts-cell"><a class="ts" href="#L28" alt="Thu Dec 01 2022 16:44:29 GMT-0800 (Pacific Standard Time)">00:44</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> In my opinion, module expressions fully solve the bundling problem.</blockquote></mx-reply><p>I assume that a pure module expression solution would do something like:</p>
<pre><code class="language-js">const foo = module {}
const bar = module { import "#foo"; }
// replace resolver hook to resolve "#foo" with `foo`
// ...
// profit?
</code></pre>
</td></tr>
  <tr class="msg" id="L29"><td class="ts-cell"><a class="ts" href="#L29" alt="Thu Dec 01 2022 16:45:19 GMT-0800 (Pacific Standard Time)">00:45</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@kriskowal:matrix.org">Kris Kowal</span>&gt;</div></td><td class="msg-cell">Though, in my opinion, <code>ModuleSource</code> is no more egregious a path to <code>eval</code> than <code>&lt;script type=module src=*&gt;</code>. It is certainly not a direct-eval evil.</td></tr>
  <tr class="msg" id="L30"><td class="ts-cell"><a class="ts" href="#L30" alt="Thu Dec 01 2022 16:46:21 GMT-0800 (Pacific Standard Time)">00:46</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@rbuckton:matrix.org">rbuckton</span>&gt;</div></td><td class="msg-cell">I mean, there's always <code>import("data:text/javascript,console.log('hello')")</code> :)</td></tr>
  <tr class="msg" id="L31"><td class="ts-cell"><a class="ts" href="#L31" alt="Thu Dec 01 2022 16:46:35 GMT-0800 (Pacific Standard Time)">00:46</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@kriskowal:matrix.org">Kris Kowal</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> <p>I assume that a pure module expression solution would do something like:</p>
<pre><code class="language-js">const foo = module {}
const bar = module { import "#foo"; }
// replace resolver hook to resolve "#foo" with `foo`
// ...
// profit?
</code></pre>
</blockquote></mx-reply>Close enough, though it won’t have to rewrite import specifiers. It can remap original specifiers to arbitrary other module blocks to effect the same linkage as occurred in the original physical locations. This is good because specifiers are typically scoped to not reveal the full physical location.</td></tr>
  <tr class="msg" id="L32"><td class="ts-cell"><a class="ts" href="#L32" alt="Thu Dec 01 2022 16:49:27 GMT-0800 (Pacific Standard Time)">00:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@kriskowal:matrix.org">Kris Kowal</span>&gt;</div></td><td class="msg-cell">In any case, I think we get a lot of bang from the module harmony proposals even if <code>ModuleSource</code> is replaced with something like <code>Module.parse</code> that can confirm the integrity of a module string and reflect its import/export bindings. Bundlers need that and on the evaluator side, module expressions suffice. We would still want an <code>ModuleSource</code> inert constructor just to host the <code>prototype</code>, since module expressions have a <code>source</code> of that prototype. And, at the end of the day, that’s equivalent to what what we’d have with a full-power <code>ModuleSource</code> constructor under a no-unsafe-eval CSP.</td></tr>
  <tr class="msg" id="L33"><td class="ts-cell"><a class="ts" href="#L33" alt="Thu Dec 01 2022 16:50:44 GMT-0800 (Pacific Standard Time)">00:50</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@kriskowal:matrix.org">Kris Kowal</span>&gt;</div></td><td class="msg-cell">Concretely though, <code>new Module((module { import './foo.js' }).source, { importHook() { return fooModule; })</code> does the trick of remapping an import to a particular <code>Module</code> instance. You can extrapolate from there.</td></tr>
  <tr class="msg" id="L34"><td class="ts-cell"><a class="ts" href="#L34" alt="Thu Dec 01 2022 16:52:13 GMT-0800 (Pacific Standard Time)">00:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@kriskowal:matrix.org">Kris Kowal</span>&gt;</div></td><td class="msg-cell">In fact, module expressions are preferable to module declarations as a vessel for bundles because the module can be injected verbatim between the braces of a module expression.</td></tr>
  <tr class="msg" id="L35"><td class="ts-cell"><a class="ts" href="#L35" alt="Thu Dec 01 2022 16:53:05 GMT-0800 (Pacific Standard Time)">00:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@kriskowal:matrix.org">Kris Kowal</span>&gt;</div></td><td class="msg-cell">Though, no doubt in every case that matters, there will be a minification pass and a sourcemap, so that advantage isn’t likely to be realized in any case that matters.</td></tr>
  <tr class="msg" id="L36"><td class="ts-cell"><a class="ts" href="#L36" alt="Thu Dec 01 2022 16:54:13 GMT-0800 (Pacific Standard Time)">00:54</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@kriskowal:matrix.org">Kris Kowal</span>&gt;</div></td><td class="msg-cell">Where module declarations shine though is that they do not require <code>import()</code> to trampoline into user space <code>importHook</code> functions, which <span class="nick-8">shu</span> hinted could limit their usefulness in production.</td></tr>
  <tr class="msg" id="L37"><td class="ts-cell"><a class="ts" href="#L37" alt="Thu Dec 01 2022 16:56:04 GMT-0800 (Pacific Standard Time)">00:56</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@kriskowal:matrix.org">Kris Kowal</span>&gt;</div></td><td class="msg-cell">But the downside is that they place a new cognitive burden on developers, who will now need to choose between using lexical or stringy module specifiers on a case-by-case basis, depending on whether they want the bundle (or worker payload!) to come with its own singleton of a module or exit to the host’s singleton of the module.</td></tr>
  <tr class="msg" id="L38"><td class="ts-cell"><a class="ts" href="#L38" alt="Thu Dec 01 2022 16:57:43 GMT-0800 (Pacific Standard Time)">00:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@kriskowal:matrix.org">Kris Kowal</span>&gt;</div></td><td class="msg-cell">That’ll be an attractive nuisance for the worker case, since each time you “add” an entrypoint module expression/declaration to a worker, that entrypoint will retain a separate instance of its module declaration graph and connect to shared instances from the host for any remaining stringy specifiers.</td></tr>
  <tr class="msg" id="L39"><td class="ts-cell"><a class="ts" href="#L39" alt="Thu Dec 01 2022 16:59:34 GMT-0800 (Pacific Standard Time)">00:59</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@kriskowal:matrix.org">Kris Kowal</span>&gt;</div></td><td class="msg-cell">I think that’ll have some negative consequences for the ecosystem, where libraries will be compelled to export a module declaration instead of their own API, so that the consumer can decide whether they want to instantiate it or transport it.</td></tr>
  <tr class="msg" id="L40"><td class="ts-cell"><a class="ts" href="#L40" alt="Thu Dec 01 2022 16:59:54 GMT-0800 (Pacific Standard Time)">00:59</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@kriskowal:matrix.org">Kris Kowal</span>&gt;</div></td><td class="msg-cell">And in fact, they do not need module declarations to have that choice. They get the same facility from module import reflection.</td></tr>
  <tr class="msg" id="L41"><td class="ts-cell"><a class="ts" href="#L41" alt="Thu Dec 01 2022 17:02:05 GMT-0800 (Pacific Standard Time)">01:02</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@kriskowal:matrix.org">Kris Kowal</span>&gt;</div></td><td class="msg-cell">That is, <code>postMessage</code> can send an array of <code>ModuleSources</code> with a description of their linkage and the receiver can rehydrate the graph with <code>Module</code> and a little machinery, just like a bundle.</td></tr>
  <tr class="msg" id="L42"><td class="ts-cell"><a class="ts" href="#L42" alt="Thu Dec 01 2022 17:21:36 GMT-0800 (Pacific Standard Time)">01:21</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@littledan:matrix.org">littledan</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> I think that’ll have some negative consequences for the ecosystem, where libraries will be compelled to export a module declaration instead of their own API, so that the consumer can decide whether they want to instantiate it or transport it.</blockquote></mx-reply>Well, maybe reflective imports would be the bridge here… oh but this only covers the top level, not nested dependencies</td></tr>
  <tr class="msg" id="L43"><td class="ts-cell"><a class="ts" href="#L43" alt="Thu Dec 01 2022 17:24:40 GMT-0800 (Pacific Standard Time)">01:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@kriskowal:matrix.org">Kris Kowal</span>&gt;</div></td><td class="msg-cell">Reflective imports would give you a module and module source, module bindings reflection would give you the shallow dependencies, import.meta.resolve would give you host resolution, recursive reflective imports would get you the whole working set.</td></tr>
  <tr class="msg" id="L44"><td class="ts-cell"><a class="ts" href="#L44" alt="Thu Dec 01 2022 17:25:23 GMT-0800 (Pacific Standard Time)">01:25</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@kriskowal:matrix.org">Kris Kowal</span>&gt;</div></td><td class="msg-cell">Everything you need to construct a transportable artifact.</td></tr>
  <tr class="msg" id="L45"><td class="ts-cell"><a class="ts" href="#L45" alt="Thu Dec 01 2022 19:50:57 GMT-0800 (Pacific Standard Time)">03:50</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@littledan:matrix.org">littledan</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> That would still work with bundlers, though they'd need to emit a chunk of code at the bottom of the file that linked all of the declarations together.</blockquote></mx-reply>Yeah, it's exactly this chunk of code, which is implicit in what Kris is describing, that makes me feel uncertain about this direction, but in a way which is really hard to objectively back up at this point. Maybe, at some point, prototyping will give us more insight around performance issues about this. But beyond practicality, I was excited about having a fully declarative way to link modules together--probably the committee shouldn't attach much weight to this excitement.</td></tr>
  <tr class="msg" id="L46"><td class="ts-cell"><a class="ts" href="#L46" alt="Thu Dec 01 2022 21:19:38 GMT-0800 (Pacific Standard Time)">05:19</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@kriskowal:matrix.org">Kris Kowal</span>&gt;</div></td><td class="msg-cell">Given that the stated scope of the proposal is bundling, limiting the reach of module expression and declaration imports to a single file would obviate all of my concerns. The names need not even be lexical, just file local.</td></tr>
  <tr class="msg" id="L47"><td class="ts-cell"><a class="ts" href="#L47" alt="Thu Dec 01 2022 23:57:52 GMT-0800 (Pacific Standard Time)">07:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@sffc:mozilla.org">sffc</span>&gt;</div></td><td class="msg-cell"><span class="nick-14">Michael Ficarra</span>: the Google i18n team is voicing explicit support for Well-Formed Unicode Strings</td></tr>
  <tr class="msg" id="L48"><td class="ts-cell"><a class="ts" href="#L48" alt="Fri Dec 02 2022 03:05:47 GMT-0800 (Pacific Standard Time)">11:05</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@robpalme:matrix.org">Rob Palmer</span>&gt;</div></td><td class="msg-cell">We are proposing to defer the January plenary meeting by one week to avoid overlap with Chinese New Year.

<a href="https://github.com/tc39/Reflector/issues/453#issuecomment-1335074233">https://github.com/tc39/Reflector/issues/453#issuecomment-1335074233</a></td></tr>
  <tr class="msg" id="L49"><td class="ts-cell"><a class="ts" href="#L49" alt="Fri Dec 02 2022 07:15:29 GMT-0800 (Pacific Standard Time)">15:15</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@littledan:matrix.org">littledan</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> Given that the stated scope of the proposal is bundling, limiting the reach of module expression and declaration imports to a single file would obviate all of my concerns. The names need not even be lexical, just file local.</blockquote></mx-reply>I keep hearing people say that module declarations are only for bundling, and although that was definitely the focus for my investigation there initially, the current proposal serves other goals as well. The most significant and commonly raised one is having server and client code in the same file. Anyway, this goal would be served by local and not lexical module declarations as well</td></tr>
  <tr class="msg" id="L50"><td class="ts-cell"><a class="ts" href="#L50" alt="Fri Dec 02 2022 07:16:25 GMT-0800 (Pacific Standard Time)">15:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@littledan:matrix.org">littledan</span>&gt;</div></td><td class="msg-cell">I still don’t understand the concerns you have though, Kris</td></tr>
  <tr class="msg" id="L51"><td class="ts-cell"><a class="ts" href="#L51" alt="Fri Dec 02 2022 07:17:06 GMT-0800 (Pacific Standard Time)">15:17</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@littledan:matrix.org">littledan</span>&gt;</div></td><td class="msg-cell">What I really disagree with is when people state that the feature is only for bundlers</td></tr>
  <tr class="msg" id="L52"><td class="ts-cell"><a class="ts" href="#L52" alt="Fri Dec 02 2022 08:18:25 GMT-0800 (Pacific Standard Time)">16:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@kriskowal:matrix.org">Kris Kowal</span>&gt;</div></td><td class="msg-cell">Ah, Nicolò stated that the feature was primarily for bundlers. I agree that it would also be used for transmission to workers, which is really quite similar.</td></tr>
  <tr class="msg" id="L53"><td class="ts-cell"><a class="ts" href="#L53" alt="Fri Dec 02 2022 08:18:34 GMT-0800 (Pacific Standard Time)">16:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@kriskowal:matrix.org">Kris Kowal</span>&gt;</div></td><td class="msg-cell">postMessage-as-bundler</td></tr>
  <tr class="msg" id="L54"><td class="ts-cell"><a class="ts" href="#L54" alt="Fri Dec 02 2022 08:20:56 GMT-0800 (Pacific Standard Time)">16:20</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@kriskowal:matrix.org">Kris Kowal</span>&gt;</div></td><td class="msg-cell">To wit, if we could postMessage into a file and revive it over HTTP, structured clone would be a bundle format.</td></tr>
  <tr class="msg" id="L55"><td class="ts-cell"><a class="ts" href="#L55" alt="Fri Dec 02 2022 08:40:30 GMT-0800 (Pacific Standard Time)">16:40</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@littledan:matrix.org">littledan</span>&gt;</div></td><td class="msg-cell">Primarily != only</td></tr>
  <tr class="msg" id="L56"><td class="ts-cell"><a class="ts" href="#L56" alt="Fri Dec 02 2022 08:42:49 GMT-0800 (Pacific Standard Time)">16:42</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@littledan:matrix.org">littledan</span>&gt;</div></td><td class="msg-cell">I need to think more about this ecosystem implications issue. I guess we already have an ecosystem thing going on where some people distribute bundled packages…</td></tr>
  <tr class="msg" id="L57"><td class="ts-cell"><a class="ts" href="#L57" alt="Fri Dec 02 2022 09:14:52 GMT-0800 (Pacific Standard Time)">17:14</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@kriskowal:matrix.org">Kris Kowal</span>&gt;</div></td><td class="msg-cell">I’ll make a point not to misrepresent the intent. Regardless of the intent, Hyrum’s Law applies. It’ll be used in any way it’s found useful.</td></tr>
  <tr class="msg" id="L58"><td class="ts-cell"><a class="ts" href="#L58" alt="Fri Dec 02 2022 14:23:47 GMT-0800 (Pacific Standard Time)">22:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@ljharb:matrix.org">ljharb</span>&gt;</div></td><td class="msg-cell"><span class="nick-2">bakkot</span>: is there a reason that <code>union</code> makes sure <code>other</code> has a callable <code>has</code> method, when it doesn't use it?</td></tr>
  <tr class="msg" id="L59"><td class="ts-cell"><a class="ts" href="#L59" alt="Fri Dec 02 2022 15:01:28 GMT-0800 (Pacific Standard Time)">23:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell"><span class="nick-6">ljharb</span>: for consistency with the other methods</td></tr>
  <tr class="msg" id="L60"><td class="ts-cell"><a class="ts" href="#L60" alt="Fri Dec 02 2022 15:01:37 GMT-0800 (Pacific Standard Time)">23:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">we decided they should all have exactly the same expected arguments</td></tr>
  <tr class="msg" id="L61"><td class="ts-cell"><a class="ts" href="#L61" alt="Fri Dec 02 2022 15:02:56 GMT-0800 (Pacific Standard Time)">23:02</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@ljharb:matrix.org">ljharb</span>&gt;</div></td><td class="msg-cell">hm, ok. i haven't looked at the others yet, so i'm assuming some of the methods use all three, some two, some one, but all of them require all three as you indicated</td></tr>
  <tr class="msg" id="L62"><td class="ts-cell"><a class="ts" href="#L62" alt="Fri Dec 02 2022 15:03:03 GMT-0800 (Pacific Standard Time)">23:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">yup</td></tr>
  <tr class="msg" id="L63"><td class="ts-cell"><a class="ts" href="#L63" alt="Fri Dec 02 2022 15:03:34 GMT-0800 (Pacific Standard Time)">23:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">also some of them switch which ones get used depending on the relative sizes of the receiver vs the argument</td></tr>
  <tr class="msg" id="L64"><td class="ts-cell"><a class="ts" href="#L64" alt="Fri Dec 02 2022 15:04:23 GMT-0800 (Pacific Standard Time)">23:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@ljharb:matrix.org">ljharb</span>&gt;</div></td><td class="msg-cell">ah right, ok</td></tr>

</tbody></table></div></div></div>
</body></html>
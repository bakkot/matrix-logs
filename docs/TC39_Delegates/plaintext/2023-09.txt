2023-09-01
[21:06:35.0425] <Kris Kowal>
@shu We do a thing in SES that Mark calls ‚Äúenablements‚Äù to compensate for the override mistake which may be of interest: We replace the non-writable property with a getter/setter pair. The prototype is still effectively frozen, but assignment-override works. We‚Äôd be delighted to be in touch.

[09:47:45.0295] <Michael Ficarra>
Kris Kowal: Yes, we considered taking this approach for `Iterator.prototype[Symbol.toStringTag]` because of this exact issue with regenerator-runtime (see https://github.com/tc39/proposal-iterator-helpers/pull/213), but instead decided to just make the property writable

[09:51:04.0788] <ljharb>
this is interesting: https://twitter.com/webreflection/status/1697518069554299121 - isn't there some security thing around SAB that this seems to bypass via wasm?

[09:54:19.0787] <shu>
that's always been the case (since COOP/COEP shipped)

[09:54:28.0257] <shu>
it's explicitly allowed, and wpt uses it in testing

[09:54:52.0234] <shu>
the actual capability is the sharing of memory, not the SAB constructor. without COI you still can't postMessage the buffer across workers

[09:54:54.0258] <bakkot>
the problem isn't getting a SAB, it's being able to share it to workers

[09:55:05.0686] <bakkot>
see step 13.1.1 of https://html.spec.whatwg.org/#structuredserializeinternal

[09:55:59.0074] <shu>
this is my "fault" technically: https://github.com/whatwg/html/issues/4732#issuecomment-598470434

[09:56:13.0482] <shu>
but we did it for compat reasons for chrome users

[09:56:33.0040] <Kris Kowal>
> <@michaelficarra:matrix.org> Kris Kowal: Yes, we considered taking this approach for `Iterator.prototype[Symbol.toStringTag]` because of this exact issue with regenerator-runtime (see https://github.com/tc39/proposal-iterator-helpers/pull/213), but instead decided to just make the property writable

I don‚Äôt think we‚Äôd recommend ‚Äúenablements‚Äù as a general language compensation for override-mistake, but we do recommend replacing certain properties with accessors as a preparation for freezing a prototype in environments that freeze shared prototypes.

[09:59:02.0493] <shu>
the original plan, was, in fact, to make SAB always available

[10:15:48.0853] <ljharb>
ah ok, thanks, that makes sense

[10:50:53.0335] <leobalter>
Stage 3 won't become a silver bullet for proposal changes.

[11:44:00.0713] <Michael Ficarra>
of course, changes can be made in response to implementation feedback

[11:45:14.0401] <Michael Ficarra>
the point of this change is to catch necessary changes before we get to the point of implementation so we don't waste implementers' time, not to have an indicator of rock-solid stability

[14:28:11.0958] <littledan>
Huh, facilitating feature detection seems like a good thing‚Ä¶

[14:28:31.0144] <littledan>
(I saw parts of this controversy but never really followed along closely enough)

[14:30:07.0245] <littledan>
I agree with Leo. Actually, HTML integration is already a requirement in practice, just randomly enforced by certain delegates (including me), and it has been this way for years 

[14:30:14.0064] <littledan>
We should document this

[14:30:32.0088] <littledan>
* I agree with Leo. Actually, HTML integration is already a Stage 3 requirement in practice, just randomly enforced by certain delegates (including me), and it has been this way for years

[14:30:45.0382] <littledan>
It feels funny to have html be special but it just is

[14:30:58.0332] <littledan>
I think that is why we have hesitated to document it so far

[14:33:26.0642] <Michael Ficarra>
littledan: I agree but I don't think it needs to be combined with my proposed process change

[14:34:00.0040] <Michael Ficarra>
as we saw at the last meeting, it is already hard for some delegates to understand the process change

[14:34:04.0304] <littledan>
> <@michaelficarra:matrix.org> littledan: I agree but I don't think it needs to be combined with my proposed process change

Sure they are separate, maybe good for Leo to put this other point on the agenda for this meeting 

[14:34:47.0342] <littledan>
As far as I am concerned, HTML integration is already a requirement, just a poorly documented one, unlike your proposal which is a genuine change in how we work

[14:49:00.0318] <shu>
process or no process my personal resolve going forward is i will block stage 3 on proposals where there's non-trivial amounts of semantics in the integration

[14:49:16.0542] <shu>
 * process or no process my personal resolve going forward is i will block stage 3 on proposals where there's non-trivial amounts of semantics in the integration, and the integration is not yet done

[16:03:50.0015] <shu>
eh, i guess arguably the right way to feature detect is `self.crossOriginIsolated`, not the existence of the SAB constructor

[16:51:42.0541] <Michael Ficarra>
> I can share that our tamper resistance mode is enabled by default

üò©


2023-09-04
[19:43:22.0880] <rkirsling>
> TDZ, what is it good for?
lol shu I expect musical references from you now ü§£

[19:43:27.0365] <rkirsling>
 * > TDZ, what is it good for?

lol shu I expect musical references from you now ü§£

[11:42:06.0252] <shu>
> <@rkirsling:matrix.org> > TDZ, what is it good for?
> 
> lol shu I expect musical references from you now ü§£

it's actually a reference to the original title of War and Peace

[16:49:46.0996] <rkirsling>
all's fair in TDZ


2023-09-05
[10:31:51.0270] <shu>
> <@michaelficarra:matrix.org> > I can share that our tamper resistance mode is enabled by default
> 
> üò©

yes this gives me concern

[14:19:28.0859] <leobalter>
Is Daniel Minor (Mozilla) in this channel?

I've seen the agenda item proposing demotion of ShadowRealms to Stage 2. I'd love if we can link that agenda item to an open (new?) thread in the ShadowRealms repo.

Considering the facts, I'd have to agree with the arguments and recognize there's an amount of work for HTML integration I initially underestimated.

Saying that, we have work with Igalia restarting on this in October 1st. This update is as fresh as today. The budget cut happened initially along the mass layoffs and we are putting it back to order to continue the work here.

Even if the demotion is unavoidable, I'd love we can set a plan for the next steps for what would be expected for re-requesting Stage 3.

Having a thread linked to this agenda item, we can have pre-discussions and champions might be able to draw some estimates as well.

[14:19:53.0941] <leobalter>
littledan shu 

[14:20:02.0197] <leobalter>
 * littledan shu caridy 

[14:20:44.0283] <Kris Kowal>
dminor is here.

[14:20:55.0775] <leobalter>
Thank you, Kris Kowal ! I couldn't find it. 

For the ref: https://docs.google.com/presentation/d/1WJd9g3df_ibVHK3LdoKX2FboDwYQBUBJNxuRAWOYYbM/edit#slide=id.p

[14:24:49.0446] <shu>
i agree with dminor's points

[14:25:13.0337] <shu>
i think a demotion to stage 2 would be precisely to make the criteria for getting back to stage 3 clear

[14:25:28.0082] <shu>
(which is html integration)

[14:25:54.0942] <shu>
so any update Igalia or the champions want to provide on restarting that work would be towards the same goal IMO

[14:26:19.0019] <shu>
but the current state, as the slides say, is not implementable nor shippable

[14:26:38.0222] <shu>
also, recall Apple even had to unship because of a misunderstanding of what the HTML integration involved!

[14:28:32.0691] <leobalter>
I fully understand from this perspective. 

I just wish we had Michael Ficarra's mid-stage.

While we don't have the new stage, hopefully we can agree to settle the current ES-specs as a like-stage-3 quality/stable. Of course this would still be subject to new changes for anything new identified in the HTML integration. Is that agreedable?

[14:28:48.0279] <leobalter>
 * I fully understand from your perspective.

I just wish we had Michael Ficarra's mid-stage.

While we don't have the new stage, hopefully we can agree to settle the current ES-specs as a like-stage-3 quality/stable. Of course this would still be subject to new changes for anything new identified in the HTML integration. Is that agreedable?

[14:29:36.0676] <shu>
yes, i think it'd be good to reaffirm consensus that the 262 spec is fine as-is

[14:29:41.0113] <ljharb>
we've done that twice now, with import assertions and something else

[14:29:50.0753] <shu>
and that there are no further plans to redesign

[14:30:06.0581] <ljharb>
demotion to stage 2, with a consensus about what items are expected to make it re-eligible for stage 3 consensus (implying that other items aren't in scope)

[14:31:05.0364] <leobalter>
I'd propose we keep the proposed ES-spec as is, being the next steps HTML integration with tests.

With the above complete, we reconsider it eligible for Stage 3, formal consensus still needed.

[14:31:45.0158] <shu>
that sgtm. not sure if dminor had more in mind

[14:37:35.0476] <Kris Kowal>
dminor stated that Mozilla‚Äôs position (from last week‚Äôs SES meeting, recording forthcoming) is that they cannot ship without HTML integration fully specified and they are not particular about how the proposal gets staged. It could remain at stage 3 and HTML integration could be a follow-up.

[14:38:12.0449] <Kris Kowal>
They‚Äôre also amenable to backing up to Stage 2. I think Leo‚Äôs proposal fits in that range.

[14:38:39.0250] <Kris Kowal>
 * dminor stated Mozilla‚Äôs position (from last week‚Äôs SES meeting, recording forthcoming) is that they cannot ship without HTML integration fully specified and they are not particular about how the proposal gets staged. It could remain at stage 3 and HTML integration could be a follow-up.

[14:39:18.0499] <shu>
ah i think mine is a little stronger, i would prefer demotion to stage 2 over remaining at stage 3 in the holding pattern waiting on HTML integration

[14:39:39.0090] <leobalter>
This works for me, I haven't discussed this with the other champions yet, but it seems pretty reasonable.

Let me summarize the (pre) agreements I'm proposing:

- The current ES-spec draft is good as is, there are no further plans to redesign.
- We already have the tests for the ES-spec part, so no further Test262 "required".
- HTML integration needs to be complete and include some fair coverage of tests.
- White redesign is not expected, the champions are open for fixes.

I'm doubling down on tests here as I want to make sure it's shippable, a bit more than the formal requirements for Stage 3.

[14:39:44.0592] <Kris Kowal>
That is dminor‚Äôs understanding of your position as well, shu 

[14:40:04.0001] <leobalter>
I'm not sure I'll be able to attend the TC39 meeting, so registering this here in the lack of a thread.

[14:40:09.0027] <leobalter>
 * I'm not sure I'll be able to attend the TC39 meeting, so registering this here in the lack of an open thread.

[14:42:35.0940] <leobalter>
the summary I proposed is in case the demotion to Stage 2 happens. I don't see a better alternative for that right now so it feels like my best option.

[14:55:08.0150] <Kris Kowal>
Mozilla‚Äôs position https://youtu.be/xbrsdwNVYKQ?t=87

[16:13:26.0836] <dminor>
Just to be clear, our position is that we should either demote to Stage 2, or remove the HTML integration from the proposal and keep it at Stage 3. We're not ok with keeping this at Stage 3 without more specification of the HTML integration.

[16:14:16.0792] <dminor>
And V8's position as I understand it, is that removing the HTML integration is not a good idea for the web, so I think that leaves demotion to Stage 2.

[16:14:40.0908] <dminor>
But I'm happy for the details to be worked out in plenary.

[16:15:20.0065] <dminor>
 * Just to be clear, our position is that we should either demote to Stage 2, or remove the HTML integration from the proposal entirely and keep it at Stage 3. We're not ok with keeping this at Stage 3 as it stands.

[16:37:01.0325] <shu>
oh man, cutting it super close with the iterator helpers thing

[16:37:19.0240] <shu>
we were like minutes away from pressing the kill switch button before the GH thread was updated that the upstream fix was rolled out

[16:42:28.0299] <littledan>
This all sounds reasonable to me. I don‚Äôt think anyone is pushing for changes outside of the HTML integration, and our last couple demotions and repromotions gave me confidence that we as a committee can keep promises to ourselves. I am very glad that this is resuming with Igalia next month.

[16:43:31.0279] <littledan>
I don‚Äôt think mficcarra‚Äôs extra stage has anything to do with this. I would basically hope for html integration to be in place to get to the new, earlier stage (though, sure, maybe it is only a fully hard requirement at Stage 3)


2023-09-06
[19:14:53.0128] <leobalter>
ShadowRealms have different use cases, but the ones I need for my company are all Web related. So I agree we can't and shouldn't detach the HTML integration from it.

I also see no advantage of the proposal remaining on Stage 3 if I don't have a fully "ready to implement" status yet.

I concur to believe this committee will act as its best to continue moving the proposal forward even if needs to take a step back.

I'm personally positive with the change and looking forward to continue the HTML integration process with Igalia!

[07:18:10.0825] <dminor>
If we're looking for an issue to continue this conversation, I think this one that my colleague Matt opened a few months ago is the place: https://github.com/tc39/proposal-shadowrealm/issues/386

[07:38:33.0163] <Chris de Almeida>
> <@shuyuguo:matrix.org> we were like minutes away from pressing the kill switch button before the GH thread was updated that the upstream fix was rolled out

oh this is gonna make it after all?  üéâ

[07:54:41.0471] <shu>
> <@softwarechris:matrix.org> oh this is gonna make it after all?  üéâ

yes

[07:55:04.0095] <shu>
but! given that the tamper-resistant mode that freezes intrinsics is turned on by default...

[07:55:12.0451] <shu>
need to be on the lookout for other breakages

[07:56:18.0128] <Chris de Almeida>
ah.. was hoping they would change their impl

[07:57:59.0770] <shu>
they turned it off for the one broken site that was reported

[07:58:32.0345] <shu>
here's to hoping their other customers have a regenerator runtime <2 years old


2023-09-08
[02:37:40.0059] <rkirsling>
it'll take 'til next week before I can get my colleagues to fill out the Doodle but it's safe to say that at least one of the days will have more than 24 people


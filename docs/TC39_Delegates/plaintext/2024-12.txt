2024-12-02
[06:59:39.0008] <ryzokuken ðŸ‡·ðŸ‡¸>
Draft Schedule is up on the Reflector: https://github.com/tc39/Reflector/issues/545

[08:58:29.0533] <Rob Palmer>
The meeting begins in 1 minute!!!

[09:00:49.0545] <Michael Ficarra>
FYI we still don't have a TCQ link

[09:03:23.0929] <nicolo-ribaudo>
If Google meet is stuck on "Getting ready... You'll be able to join in just a moment", is it a problem on my side?

[09:03:27.0659] <ljharb>
https://tcq.app/meeting/RKti

[09:03:39.0836] <ljharb>
probably, there's a bunch of us in it

[09:04:10.0051] <nicolo-ribaudo>
Ok thanks, time to restart everything

[09:12:48.0157] <nicolo-ribaudo>
Chairs, last minute change. It seems like I will be the one presenting the TG4 status report

[09:40:01.0142] <littledan>
I like Saminaâ€™s idea to have a liaison from TC39 to IETF, analogous to our close relationship with W3C and Unicode. Is anyone interested in playing this role?

[09:45:32.0045] <saminahusain>
In the past, I think 2021, Mathew Miller was the liaison contact from  tc39

[09:49:54.0455] <bakkot>
sorry, I forgot to add to the agenda constraints that I'm not available the first hour today

[09:50:19.0099] <bakkot>
hope we can get to my iterator closing topic after that

[09:54:17.0645] <nicolo-ribaudo>
Did Chris change which diff he's showing?

[09:54:46.0548] <Michael Ficarra>
yes

[09:57:35.0768] <Michael Ficarra>
whoever is doing notes right now, please refer to https://github.com/tc39/notes/blob/main/delegates.txt for abbreviations, don't just make something up

[10:15:32.0849] <Michael Ficarra>
@eemeli:mozilla.org please add a link to the slides in the notes

[10:22:30.0844] <nicolo-ribaudo>
I always assumed the motivation on this proposal was about ergonomics and not really about performance

[10:22:37.0172] <nicolo-ribaudo>
 * I always assumed the motivation for this proposal was about ergonomics and not really about performance

[10:27:36.0120] <eemeli>
> <@michaelficarra:matrix.org> @eemeli:mozilla.org please add a link to the slides in the notes

There were no slides. The presented material was the readme of the proposal repo.

[10:28:26.0775] <eemeli>
https://github.com/eemeli/proposal-intl-currency-display-choices

[10:29:51.0544] <rbuckton>
We don't throw when you mutate a Map while iterating. I'd almost rather `getOrInsertComputed` just overwrites the key, whether it was set or deleted during the callback. If you want full locking, you can implement it yourself?

[10:30:10.0744] <shu>
rbuckton: that IS my understanding of the non-throwing approach

[10:30:11.0704] <shu>
is it not?

[10:31:41.0742] <bakkot>
the four options:

```
// common prefix
if (map.has(key)) return key;
let value = callback(key);

// option 1
if (map.has(key)) throw;

// option 2
map.set(key, value);
return value;

// option 3 (not proposed)
if (map.has(key)) return map.get(key);
map.set(key, value);
return value;

// option 4 (not proposed): change `Map.prototype.set` to check if we're currently in a `getOrInsertComputed` for this map
```

sounds like people 

[10:31:55.0553] <bakkot>
 * the four options:

```
// common prefix
if (map.has(key)) return key;
let value = callback(key);

// option 1
if (map.has(key)) throw;

// option 2
map.set(key, value);
return value;

// option 3 (not proposed)
if (map.has(key)) return map.get(key);
map.set(key, value);
return value;

// option 4 (not proposed): change `Map.prototype.set` to check if we're currently in a `getOrInsertComputed` for this map
```

sounds like people like option 2 (which I'm also happy with)

[10:32:05.0426] <nicolo-ribaudo>
I dislike these names but I have no constructive suggestion

[10:32:49.0647] <rbuckton>
I personally prefer `getOrAdd`/`getOrCreate`, but I've been too busy over the last few weeks to comment on the issue :/

[10:33:02.0763] <ljharb>
bakkot: option 3 would basically be "actual upsert"?

[10:33:16.0343] <ljharb>
 * bakkot: option 3 would basically be "actual upsert"? or is that something else

[10:33:25.0049] <bakkot>
no

[10:33:36.0429] <bakkot>
we're accounting for mutation during the callback

[10:33:40.0165] <bakkot>
not passing new values to the callback

[10:33:53.0660] <ljharb>
ah k

[10:35:14.0071] <bakkot>
 * the four options:

```
// common prefix
if (map.has(key)) return key;
let value = callback(key);

// option 1
if (map.has(key)) throw;
map.set(key, value);
return value;

// option 2
map.set(key, value);
return value;

// option 3 (not proposed)
if (map.has(key)) return map.get(key);
map.set(key, value);
return value;

// option 4 (not proposed): change `Map.prototype.set` to check if we're currently in a `getOrInsertComputed` for this map
```

sounds like people like option 2 (which I'm also happy with)

[10:35:43.0363] <rbuckton>
Regarding the naming, neither of these methods are actually an "upsert", which normally consists of either "updating an existing value" or "inserting a new value", hence the portmanteau of "update" and "insert". 

[10:45:12.0149] <Mikhail Barash>
University of Bergen's students have written a tutorial on `upsert` proposal prototype implementations in SpiderMonkey and V8. The current preliminary (rough) draft is available here: https://github.com/bldl/emplace-spidermonkey . It currently lacks the description of the implementation in V8; this will be added soon. 

[10:47:30.0897] <ljharb>
https://github.com/tc39/proposal-is-error/issues/7

[10:47:52.0013] <bakkot>
chairs: can you make sure my "iterator helpers close receiver on argument validation failure (10m, Kevin Gibbons)" topic doesn't get lost? currently it's up above the other items on the agenda

[10:48:07.0265] <bakkot>
 * chairs: can you make sure my "iterator helpers close receiver on argument validation failure (10m, Kevin Gibbons)" topic doesn't get lost? currently it's up with the already-presented items on the agenda


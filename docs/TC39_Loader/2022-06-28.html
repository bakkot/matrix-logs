<!DOCTYPE html><html><head>
  <title>TC39 Loader on 2022-06-28</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "TC39 Loader";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">TC39 Loader<br>2022-06-28<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2022-06-27" class="nav-link"><span>prev</span></a>
<span style="float:right">next</span>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">
<div class="rhs-header">
<span id="error" style="color: red; display:none">error</span>

<input type="text" id="query" size="25" placeholder="Search TC39 Loader">
<a id="search-submit" class="button icon-link" title="Search">
  <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"></path></svg>
</a>
</div>

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Tue Jun 28 2022 02:49:28 GMT-0700 (Pacific Daylight Time)">09:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@surma:matrix.org">Surma</span>&gt;</div></td><td class="msg-cell">Is there a loader call today?</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Tue Jun 28 2022 02:56:23 GMT-0700 (Pacific Daylight Time)">09:56</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@surma:matrix.org">Surma</span>&gt;</div></td><td class="msg-cell">nvm, found the notes doc and it says next call is Jul 6 :)</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Tue Jun 28 2022 02:56:44 GMT-0700 (Pacific Daylight Time)">09:56</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@surma:matrix.org">Surma</span>&gt;</div></td><td class="msg-cell">Apologies for missing the first call. I must have forgotten to subscribe to the issue</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Tue Jun 28 2022 04:11:06 GMT-0700 (Pacific Daylight Time)">11:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@surma:matrix.org">Surma</span>&gt;</div></td><td class="msg-cell"><span class="nick-16">Kris Kowal</span>: Thanks for making the slides very consumable by themselves. Enjoyed reading them.</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Tue Jun 28 2022 04:14:32 GMT-0700 (Pacific Daylight Time)">11:14</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@surma:matrix.org">Surma</span>&gt;</div></td><td class="msg-cell">One thing that is currently not quite clear after the slides: Was there tension for module blocks capturing <code>import.meta.url</code> of the module they are syntactically embedded in? I believe that’s crucial for module blocks to be successful.</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Tue Jun 28 2022 04:29:52 GMT-0700 (Pacific Daylight Time)">11:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@nicolo-ribaudo:matrix.org">nicolo-ribaudo</span>&gt;</div></td><td class="msg-cell">With the long messages above we concluded that the tension is solvable, by separating the concept of "module source" (equivalent to the actual contents of an ESM file) and "module instance" (which has the runtime metadata such as import.meta)</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Tue Jun 28 2022 04:30:46 GMT-0700 (Pacific Daylight Time)">11:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@nicolo-ribaudo:matrix.org">nicolo-ribaudo</span>&gt;</div></td><td class="msg-cell">Module blocks would be the second</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Tue Jun 28 2022 04:38:29 GMT-0700 (Pacific Daylight Time)">11:38</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@surma:matrix.org">Surma</span>&gt;</div></td><td class="msg-cell">I think that makes sense, ty</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Tue Jun 28 2022 07:36:59 GMT-0700 (Pacific Daylight Time)">14:36</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@littledan:matrix.org">littledan</span>&gt;</div></td><td class="msg-cell">Wait, I think there are three things, the "source", the "instance" (which includes imports) and then this third thing which module blocks and fragments are, where their imports aren't bound but where they do have an import.meta.url</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Tue Jun 28 2022 08:05:07 GMT-0700 (Pacific Daylight Time)">15:05</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@kriskowal:matrix.org">Kris Kowal</span>&gt;</div></td><td class="msg-cell">I assume module blocks and fragments can be used on hosts that do not provide import.meta.url. Do you mean a referrer internal slot?</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Tue Jun 28 2022 08:05:54 GMT-0700 (Pacific Daylight Time)">15:05</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@kriskowal:matrix.org">Kris Kowal</span>&gt;</div></td><td class="msg-cell">I think quite a bit hinges on this referrer property, where and whether it exists.</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Tue Jun 28 2022 08:07:52 GMT-0700 (Pacific Daylight Time)">15:07</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@kriskowal:matrix.org">Kris Kowal</span>&gt;</div></td><td class="msg-cell">There is certainly a formulation of module loaders where module instances do not capturer their referrer but are still suitable for bundlers, import mappers, hot module replacement, &amp;c.</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Tue Jun 28 2022 08:08:45 GMT-0700 (Pacific Daylight Time)">15:08</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@kriskowal:matrix.org">Kris Kowal</span>&gt;</div></td><td class="msg-cell">Though retaining the referrer wouldn’t break those motivating cases and would probably help more than hurt.</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Tue Jun 28 2022 08:37:37 GMT-0700 (Pacific Daylight Time)">15:37</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@surma:matrix.org">Surma</span>&gt;</div></td><td class="msg-cell">The use-case that drives this is the following: It’s quite common (on the web) to refer to assets using the “new URL” pattern, i.e. <code>const imgURL = new URL("./hero-image.png", import.meta.url)</code>. This ensures that the path “./hero-image.png” is resolved relative to the module. I want to make sure that this continues to work, even if the modules is postMessage()’d to another realm, which means the module block needs to have the same <code>import.meta.url</code> as the module it is syntactically embedded in.</td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Tue Jun 28 2022 08:38:21 GMT-0700 (Pacific Daylight Time)">15:38</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@littledan:matrix.org">littledan</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> I assume module blocks and fragments can be used on hosts that do not provide import.meta.url. Do you mean a referrer internal slot?</blockquote></mx-reply>Yes, that was just shorthand/an intuitive way of describing it</td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Tue Jun 28 2022 10:03:43 GMT-0700 (Pacific Daylight Time)">17:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@kriskowal:matrix.org">Kris Kowal</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> The use-case that drives this is the following: It’s quite common (on the web) to refer to assets using the “new URL” pattern, i.e. <code>const imgURL = new URL("./hero-image.png", import.meta.url)</code>. This ensures that the path “./hero-image.png” is resolved relative to the module. I want to make sure that this continues to work, even if the modules is postMessage()’d to another realm, which means the module block needs to have the same <code>import.meta.url</code> as the module it is syntactically embedded in.</blockquote></mx-reply>Agreed. In perhaps an excessively pedantic stance, I suggest that is a side-effect of carrying import.meta, which may or may not include url depending on the host. Whereas, a referrer is the key in any module related maps regardless of whether it’s a URL. In XS or in a bundle, there would not be a meaningful URL.</td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Tue Jun 28 2022 10:04:39 GMT-0700 (Pacific Daylight Time)">17:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@kriskowal:matrix.org">Kris Kowal</span>&gt;</div></td><td class="msg-cell">But yes, in the not-so-special case of web sending to web, the URL and referrer should be the same and carried with a module block to a web worker.</td></tr>

</tbody></table></div></div></div>
</body></html>
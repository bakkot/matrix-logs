<!DOCTYPE html><html><head>
  <title>TC39 Loader on 2022-12-08</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "TC39 Loader";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">TC39 Loader<br>2022-12-08<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2022-12-07" class="nav-link"><span>prev</span></a>
<span style="float:right">next</span>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">
<div class="rhs-header">
<span id="error" style="color: red; display:none">error</span>

<input type="text" id="query" size="25" placeholder="Search TC39 Loader">
<a id="search-submit" class="button icon-link" title="Search">
  <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"></path></svg>
</a>
</div>

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Thu Dec 08 2022 09:40:36 GMT-0800 (Pacific Standard Time)">17:40</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-1" title="@jridgewell:matrix.org">Justin Ridgewell</span>&gt;</div></td><td class="msg-cell">üëã just discussed module reflection, lazy, and import assertions with my team</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Thu Dec 08 2022 09:43:19 GMT-0800 (Pacific Standard Time)">17:43</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-1" title="@jridgewell:matrix.org">Justin Ridgewell</span>&gt;</div></td><td class="msg-cell"><p>A few notes we have:</p>
<ul>
<li>the <code>import module</code> syntax is acceptable if we can't move this into the assertions</li>
<li>If we do move into assertions, we really should rename <code>assert</code> (we might need to do this anyways based on implementer feedback in <a href="https://github.com/tc39/proposal-import-assertions/issues/125">https://github.com/tc39/proposal-import-assertions/issues/125</a>)</li>
<li>If we move this into assertions, we can simplify the 2nd param to dynamic import (instead of <code>import("", { assert: { key: value } })</code>, just make it <code>import("", { key: value })</code>)</li>
<li>The <code>module</code> in <code>import module</code> is confusingly named, I'm already importing from ES modules</li>
</ul>
</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Thu Dec 08 2022 09:43:54 GMT-0800 (Pacific Standard Time)">17:43</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-1" title="@jridgewell:matrix.org">Justin Ridgewell</span>&gt;</div></td><td class="msg-cell">So I'm not going to lone block import reflection anymore, but would still very much like to move it into assertions</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Thu Dec 08 2022 09:54:43 GMT-0800 (Pacific Standard Time)">17:54</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@kriskowal:matrix.org">Kris Kowal</span>&gt;</div></td><td class="msg-cell"><p>At this point, I‚Äôm in favor of changing the shape of import reflection to <code>import example from '<a href="http://example.com">example.com</a>' with { reflect: true }</code> and <code>import('example', { reflect: true })</code>, which would imply import assertions would look like <code>import example from '<a href="http://example.com">example.com</a>' with { type: 'e.g.,destination' }</code> and <code>import('<a href="http://example.com">example.com</a>', { type: 'e.g.,destination' })</code>.</p>
<p>If our constituents demand that the <code>type</code> string key must be communicated to the import hook, for example to direct content-negotiation, I can be convinced on the condition that the <code>type</code> must be threaded thru <code>importHook</code>. Evidently, the web platform doesn‚Äôt wish for this to be an assertion at all, since the <code>type</code> can be ignored and the response content-type dictates what kind of module source it will produce.</p>
<p>I will be difficult to convince that the <code>with</code> parameters be opened up as an arbitrary key-value space that virtual modules can fiddle with because of the internal complications that implies for memoizing import. I want TC39 to curate this space and be free to extend it with other properties, like <code>reflect</code>, <code>lazy</code>, <code>phase</code> or so on, with behaviors that can‚Äôt be emulated by an <code>importHook</code>.</p>
</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Thu Dec 08 2022 09:57:52 GMT-0800 (Pacific Standard Time)">17:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@kriskowal:matrix.org">Kris Kowal</span>&gt;</div></td><td class="msg-cell">My opinion shifted in that direction because our SES shim for ‚Äúhardened JavaScript‚Äù censors dynamic import to deny guest programs an escape hatch, and for that to continue being effective going forward, <code>import.module</code>, <code>import.reflect</code>, or <code>import.anything</code> would be problematic. I don‚Äôt expect that argument to convince anyone else that we should funnel reflection through dynamic import, but I also don‚Äôt expect anyone else to need to be convinced!</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Thu Dec 08 2022 10:01:09 GMT-0800 (Pacific Standard Time)">18:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@kriskowal:matrix.org">Kris Kowal</span>&gt;</div></td><td class="msg-cell">In any case, the behavior of an <code>importHook</code> doesn‚Äôt depend on the <code>reflect</code> parameter, so I don‚Äôt think it should be communicated in an options bag. The behavior of <code>importHook</code> would also not vary based on <span class="nick-10">yulia</span>‚Äôs proposed <code>lazyInit</code> (by whatever name) either. There‚Äôs an implied <code>phase</code> or <code>goalState</code> parameter that currently defaults to <code>"loaded"</code> if <code>reflect: true</code> and defaults to <code>"evaluated"</code> otherwise. Neither of those should be communicated to <code>importHook</code>.</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Thu Dec 08 2022 10:02:45 GMT-0800 (Pacific Standard Time)">18:02</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@kriskowal:matrix.org">Kris Kowal</span>&gt;</div></td><td class="msg-cell">If we did expose an options bag, we‚Äôd need something analogous to HTTP cache-control headers to dictate what properties of the options bag should be incorporated in the module key and in what order. We don‚Äôt have a suitable position to stand for those to be consistent between modules or scopes of modules (like packages).</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Thu Dec 08 2022 10:04:46 GMT-0800 (Pacific Standard Time)">18:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-1" title="@jridgewell:matrix.org">Justin Ridgewell</span>&gt;</div></td><td class="msg-cell">(Can wait till after your current thoughts are down, but I disagree with the not-being communicated to <code>importHook</code> and it not affecting the import behavior)</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Thu Dec 08 2022 10:04:48 GMT-0800 (Pacific Standard Time)">18:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@kriskowal:matrix.org">Kris Kowal</span>&gt;</div></td><td class="msg-cell">So, my reasoning is that we have to consider <em>why</em> we‚Äôd want an arbitrary options bag, and if there‚Äôs a better way to solve the same problem. My reasoning is that it‚Äôs relatively straight-forward to construct Node.js-alike behavior in terms of the current harmony state, using out-of-band information (e.g., <code>package.json</code>) that keys most of these choices on the specifier, and imposes coherence across all modules in scope.</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Thu Dec 08 2022 10:05:11 GMT-0800 (Pacific Standard Time)">18:05</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@kriskowal:matrix.org">Kris Kowal</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> (Can wait till after your current thoughts are down, but I disagree with the not-being communicated to <code>importHook</code> and it not affecting the import behavior)</blockquote></mx-reply>A concrete case will help me understand your objection.</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Thu Dec 08 2022 10:05:42 GMT-0800 (Pacific Standard Time)">18:05</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@kriskowal:matrix.org">Kris Kowal</span>&gt;</div></td><td class="msg-cell">And to be clear, I mean for a subset of the <code>with</code> options to be communicated to <code>importHook</code>, specifically <code>type</code>.</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Thu Dec 08 2022 10:06:05 GMT-0800 (Pacific Standard Time)">18:06</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@kriskowal:matrix.org">Kris Kowal</span>&gt;</div></td><td class="msg-cell">On the premise that the engine knows to incorporate <code>type</code> in the memo key.</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Thu Dec 08 2022 10:07:19 GMT-0800 (Pacific Standard Time)">18:07</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-1" title="@jridgewell:matrix.org">Justin Ridgewell</span>&gt;</div></td><td class="msg-cell">This doesn't come up until Stage 2 of compartments, right, so I'm not objecting to anything currently</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Thu Dec 08 2022 10:07:31 GMT-0800 (Pacific Standard Time)">18:07</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-1" title="@jridgewell:matrix.org">Justin Ridgewell</span>&gt;</div></td><td class="msg-cell">Why not pass the full options bag to import hook?</td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Thu Dec 08 2022 10:08:33 GMT-0800 (Pacific Standard Time)">18:08</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-1" title="@jridgewell:matrix.org">Justin Ridgewell</span>&gt;</div></td><td class="msg-cell">My mental model is that the <code>lazy</code> and <code>module</code> keywords are evaluators of the imported module, and should be passed to import</td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Thu Dec 08 2022 10:08:50 GMT-0800 (Pacific Standard Time)">18:08</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-1" title="@jridgewell:matrix.org">Justin Ridgewell</span>&gt;</div></td><td class="msg-cell">And it just starts getting weird if TC39 has to standardize the keys that are passed to it</td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Thu Dec 08 2022 10:09:37 GMT-0800 (Pacific Standard Time)">18:09</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@kriskowal:matrix.org">Kris Kowal</span>&gt;</div></td><td class="msg-cell">Passing arbitrary key values to the options bag creates composition hazards. Consider the case that A imports 'my.ttf' with bold and B imports 'my.ttf' with italic. Application C imports A and B. There is a reasonable expectation that the environment co√∂rdinates these such that in general, A and B get the same module instance.</td></tr>

</tbody></table></div></div></div>
</body></html>
<!DOCTYPE html><html><head>
  <title>TC39 Loader on 2022-07-09</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "TC39 Loader";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">TC39 Loader<br>2022-07-09<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2022-07-08" class="nav-link"><span>prev</span></a>
<span style="float:right">next</span>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">
<div class="rhs-header">
<span id="error" style="color: red; display:none">error</span>

<input type="text" id="query" size="25" placeholder="Search TC39 Loader">
<a id="search-submit" class="button icon-link" title="Search">
  <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"></path></svg>
</a>
</div>

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Fri Jul 08 2022 17:45:22 GMT-0700 (Pacific Daylight Time)">00:45</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@kriskowal:matrix.org">Kris Kowal</span>&gt;</div></td><td class="msg-cell">I’m working on a sketch of what a user code Compartment looks like through the lens of Module, ModuleSource, and ExecutionContext <a href="https://gist.github.com/kriskowal/f48fb0c68a70ccbde7cd32c85cddc63c">https://gist.github.com/kriskowal/f48fb0c68a70ccbde7cd32c85cddc63c</a></td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Fri Jul 08 2022 20:21:58 GMT-0700 (Pacific Daylight Time)">03:21</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jackworks:matrix.org">Jack Works</span>&gt;</div></td><td class="msg-cell">Have a question</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Fri Jul 08 2022 20:22:26 GMT-0700 (Pacific Daylight Time)">03:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jackworks:matrix.org">Jack Works</span>&gt;</div></td><td class="msg-cell">for example, I have a <code>const a = new Module(source, hook, meta)</code></td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Fri Jul 08 2022 20:23:20 GMT-0700 (Pacific Daylight Time)">03:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jackworks:matrix.org">Jack Works</span>&gt;</div></td><td class="msg-cell">in which level it will execute twice? in different Realm? or in different <code>Module</code> constructor?</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Fri Jul 08 2022 20:35:48 GMT-0700 (Pacific Daylight Time)">03:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@kriskowal:matrix.org">Kris Kowal</span>&gt;</div></td><td class="msg-cell">Once per object identity.</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Fri Jul 08 2022 20:58:39 GMT-0700 (Pacific Daylight Time)">03:58</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jackworks:matrix.org">Jack Works</span>&gt;</div></td><td class="msg-cell">even it is used in multiple realms?</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Fri Jul 08 2022 20:58:52 GMT-0700 (Pacific Daylight Time)">03:58</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@kriskowal:matrix.org">Kris Kowal</span>&gt;</div></td><td class="msg-cell">That is my understanding.</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Fri Jul 08 2022 20:59:37 GMT-0700 (Pacific Daylight Time)">03:59</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@kriskowal:matrix.org">Kris Kowal</span>&gt;</div></td><td class="msg-cell">My understanding at the moment is that a module block corresponds to a <code>Module</code> instance, so locally it will only initialize once. But, every time a <code>Module</code> gets serialized and deserialized, it emerges as a new <code>Module</code> instance on the far side. The only parts of the module instance that are serialized are the <code>source</code> and <code>importMeta</code>, to the extent that <code>importMeta</code> is serializable, and the module instance is not memoized by the receiver.</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Fri Jul 08 2022 21:00:22 GMT-0700 (Pacific Daylight Time)">04:00</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@kriskowal:matrix.org">Kris Kowal</span>&gt;</div></td><td class="msg-cell">The new <code>Module</code> instance would inherit the receiver execution environment’s import hook.</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Fri Jul 08 2022 21:01:40 GMT-0700 (Pacific Daylight Time)">04:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@kriskowal:matrix.org">Kris Kowal</span>&gt;</div></td><td class="msg-cell">The module instance also has the [[Context]] internal slot that binds it to the original realm, so the namespace’s objects are guaranteed to be from the originating realm.</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Fri Jul 08 2022 21:02:31 GMT-0700 (Pacific Daylight Time)">04:02</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@kriskowal:matrix.org">Kris Kowal</span>&gt;</div></td><td class="msg-cell">If we’re talking about same-origin <code>&lt;iframe&gt;</code> realms, still once because single identity.</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Fri Jul 08 2022 21:02:49 GMT-0700 (Pacific Daylight Time)">04:02</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@kriskowal:matrix.org">Kris Kowal</span>&gt;</div></td><td class="msg-cell">If we’re talking about shadow realms, once per transit.</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Fri Jul 08 2022 21:04:21 GMT-0700 (Pacific Daylight Time)">04:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@kriskowal:matrix.org">Kris Kowal</span>&gt;</div></td><td class="msg-cell">Though with shadow realms, assuming Static Module Records are treated as immutable after construction, transmitting between shadow realms or even between threads of the same process can be optimized. You still get fresh instances of the <code>Module</code> object, though.</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Fri Jul 08 2022 21:06:16 GMT-0700 (Pacific Daylight Time)">04:06</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@kriskowal:matrix.org">Kris Kowal</span>&gt;</div></td><td class="msg-cell">And the reasoning for module fragments is that every module fragment has a unique <code>ModuleSource</code> consisting of the fragment and all the fragments it transitively depends upon, so each fragment is effectively equivalent to a single module block.</td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Fri Jul 08 2022 21:08:59 GMT-0700 (Pacific Daylight Time)">04:08</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@kriskowal:matrix.org">Kris Kowal</span>&gt;</div></td><td class="msg-cell">I think there are still open questions about the local semantics, like whether each evaluation of a module fragment produces a new <code>Module</code> instance, thus a new identity, thus a new namespace instance.</td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Fri Jul 08 2022 21:09:58 GMT-0700 (Pacific Daylight Time)">04:09</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@kriskowal:matrix.org">Kris Kowal</span>&gt;</div></td><td class="msg-cell">I suspect that’s the only reasonable answer, since module instances are superficially mutable. Having a singleton would create a covert communication channel.</td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Fri Jul 08 2022 21:11:22 GMT-0700 (Pacific Daylight Time)">04:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@kriskowal:matrix.org">Kris Kowal</span>&gt;</div></td><td class="msg-cell">The one hard rule is that a module block can’t write itself into the remote module map using the local key.</td></tr>

</tbody></table></div></div></div>
</body></html>
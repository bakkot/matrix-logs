2025-07-02
[03:20:03.0894] <Michael Ficarra>
FYI a student will be opening some PRs and issues related to https://github.com/tontonialberto/ecma262-spec-inconsistencies

[05:24:44.0464] <jmdyck>
They don't seem to be aware that there are semantically different uses for [[Foo]] notation.

[05:39:21.0066] <jmdyck>
or that objects don't have 'fields'.

[05:52:05.0781] <Michael Ficarra>
yes I spoke to him about that already

[05:52:16.0440] <Michael Ficarra>
he won't be opening a PR for that

[05:53:15.0430] <jmdyck>
the if/else stuff is valid, but he's missing some variations.

[05:58:22.0548] <Michael Ficarra>
those are the only ones he's interested in

[05:58:51.0579] <Michael Ficarra>
I also got a question today about what the repeat-until step's semantics should be https://tc39.es/ecma262/multipage/ecmascript-data-types-and-values.html#sec-bigintbitwiseop

[05:59:16.0575] <Michael Ficarra>
does it imply that the steps should be executed at least once?

[05:59:47.0305] <Michael Ficarra>
like a do-while with a negated condition

[06:00:46.0084] <Michael Ficarra>
by this, I mean ones that have the consequent/alternative on the same line as the if/else/else-if

[06:01:38.0845] <jmdyck>
CreateIntrinsics step 2 is indeed problematic, but I don't think it can be broken into a series of more-parseable steps.

[06:02:15.0118] <Michael Ficarra>
yeah I don't think it needs to be broken down, but its phrasing can probably be modernised

[06:03:54.0456] <Michael Ficarra>
and probably it would be better to explicitly loop over table rows

[06:04:12.0096] <jmdyck>
My inclination is that step 2 should become its own section, where you can at least let things breathe in separate paragraphs, lists.

[06:05:34.0850] <Michael Ficarra>
once he opens the issue about it, we can dump our ideas in there and I'll label it as "editor call"

[06:05:55.0123] <Michael Ficarra>
I think he was hoping that our changes to that step could get esmeta to automatically understand it, but I don't see that happening

[06:06:49.0434] <jmdyck>
The thing about explicitly looping over table rows is you can't make a single pass over the table and completely create an object at each iteration, because there are cycles in the references.

[06:07:14.0172] <Michael Ficarra>
ah, right

[06:07:39.0870] <Michael Ficarra>
you'd have to topo-sort the table, which is... not great if you want to peruse the table manually

[06:28:15.0123] <jmdyck>
You could conceivably do 2 passes, one pass to partially create the objects (without any references), then another pass to add the references (properties + [[Prototype]]).  Then you wouldn't need a topo-sort. However, the spec says that built-in functions are created with CreateBuiltinFunction, which takes a _prototype_ arg. So if you want to respect that, you have to do a topo-sort on [[Prototype]].

[06:29:13.0041] <jmdyck>
The table wouldn't have to be topo-sorted in the source, CreateIntrinsics can just say to sort it, which is basically what it does now.

[06:29:55.0846] <jmdyck>
"The creation of the intrinsics and their properties must be ordered to avoid any dependencies upon objects that have not yet been created."

[06:30:25.0254] <jmdyck>
However, the implications of that sentence aren't obvious.

[06:38:53.0485] <jmdyck>
But even if that part of the algorithm were made more explicit, esmeta would probably still need one-off stuff to parse it.


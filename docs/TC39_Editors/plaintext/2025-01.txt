2025-01-03
[14:14:07.0911] <Michael Ficarra>
I have a work on-site next week, so I don't think I'll be able to attend editor call


2025-01-08
[14:33:03.0152] <ljharb>
shu, kevin, are yall attending today? it's just me and jmdyck rn

[14:33:23.0110] <bakkot>
yeah just a minute


2025-01-14
[19:19:16.0812] <ljharb>
is it weird to anyone else that https://tc39.es/ecma262/#sec-property-descriptor-specification-type says that an empty Record is a Property Descriptor?

[19:33:45.0104] <bakkot>
it is, though

[19:33:55.0823] <bakkot>
that's so `Object.defineProperty(foo, 'bar', {})` works

[23:32:26.0900] <ljharb>
i mean i get that an empty object has to work in a number of places. but since `{ enumerable: true }` isn't a property descriptor record either (that'd be `{ [[Enumerable]]: true }`) i'm not sure why an empty record needs to be one

[09:24:55.0943] <bakkot>
if you look at how `Object.defineProperty` works it basically mechanically converts the object into a spec record by copying over each of the relevant fields https://tc39.es/ecma262/multipage/ecmascript-data-types-and-values.html#sec-topropertydescriptor

[09:26:08.0934] <bakkot>
and then passing it to definePropertyOrThrow which switches on presence of various fields

[09:32:47.0429] <bakkot>
it could work some other way but the reason an empty record is a property descriptor record is to allow it to be written this way

[09:34:23.0359] <bakkot>
I think if we were writing it today we'd probably avoid having optional fields in the record, which we usually avoid, but it would require a bit more machinery

[09:45:36.0783] <ljharb>
I definitely understand why it's written this way

[09:46:00.0803] <ljharb>
i'm wondering if it would be cleaner to special-case "no fields" rather than having the bottom type of all records be Property Descriptor

[10:01:21.0893] <bakkot>
ah

[10:01:44.0264] <bakkot>
I prefer not to; I don't think of records as really sharing types

[10:02:10.0775] <bakkot>
it's not like you come across a random record with no context in the spec; they're always being passed around between specific algorithms which make it clear what kind of thing they're working with

[10:25:00.0257] <Michael Ficarra>
lmao is this guy trying to save disk space on GitHub's servers? https://github.com/tc39/ecma262/pull/3478#issuecomment-2589138113

[10:25:02.0465] <Michael Ficarra>
who does this?

[10:29:06.0425] <jmdyck>
Maybe he's saving space locally then pushing to github?

[10:45:25.0342] <jmdyck>
ljharb: Given `Let _e_ be Record {}. If _e_ is a Property Descriptor, then ...`, are you thinking that the condition would succeed?

[10:47:35.0394] <ljharb>
> <@michaelficarra:matrix.org> who does this?

I’ve encountered many; some are the rare folks who use the PRs and issues tab, and are also stuck on the idea of “clean”, meaning they want to remove things from the list, and that requires closing PRs. In this case, i think he looks at his own profile and says “ick, too many forks” and tries to “clean” them up. But this is like the third time this guy;s done this with the same 262 PR, so i dunno what he’s thinking

[10:47:49.0956] <ljharb>
> <@jmdyck:matrix.org> ljharb: Given `Let _e_ be Record {}. If _e_ is a Property Descriptor, then ...`, are you thinking that the condition would succeed?

it does, right now, to my reading.

[10:49:58.0792] <jmdyck>
So you think "is a Foo Record" could be true of any record, regardless of how created, as long as it only has fields that a Foo Record can have?

[10:51:20.0786] <ljharb>
yes, we have structural not nominal typing on records

[10:53:07.0502] <jmdyck>
What suggests this to you?

[10:56:59.0636] <bakkot>
well, we do for property descriptors specifically per the introductory paragraph of https://tc39.es/ecma262/multipage/ecmascript-data-types-and-values.html#sec-property-descriptor-specification-type

[10:57:42.0071] <bakkot>
I think/hope that everywhere else in the spec the difference would be never be observable; we're not really switching on the types of internal records much (ever?)

[10:58:42.0160] <shu>
there're a few places around Reference Records, and class fields

[10:59:02.0581] <shu>
but yes i also hope the difference is never observable

[11:00:02.0254] <shu>
more specifically i hope, for named records, we never create record literals without the name (but with all the fields) and use it like the named records


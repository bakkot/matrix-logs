<!DOCTYPE html><html><head>
  <meta charset="UTF-8">
  <title>TC39-TG3_ Security on 2025-11-12</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "TC39-TG3_ Security";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">TC39-TG3_ Security<br>2025-11-12<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2025-11-11" class="nav-link"><span>prev</span></a>
<a href="2025-11-13" class="nav-link"><span style="float:right">next</span></a>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">
<div class="rhs-header">
<span id="error" style="color: red; display:none">error</span>

<input type="text" id="query" size="25" placeholder="Search TC39-TG3_ Security">
<a id="search-submit" class="button icon-link" title="Search">
  <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"></path></svg>
</a>
</div>

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Tue Nov 11 2025 18:12:06 GMT-0800 (Pacific Standard Time)">02:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@ljharb:matrix.org">ljharb</span>&gt;</div></td><td class="msg-cell">i would not ever want the original data to be cleared</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Tue Nov 11 2025 18:12:17 GMT-0800 (Pacific Standard Time)">02:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@ljharb:matrix.org">ljharb</span>&gt;</div></td><td class="msg-cell">the original accessor must always be able to expose the immutable internal slot</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Tue Nov 11 2025 18:17:22 GMT-0800 (Pacific Standard Time)">02:17</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mhofman:matrix.org">Mathieu Hofman</span>&gt;</div></td><td class="msg-cell">I see the stack being a getter mostly as an explicit optimization for lazily processing stack info when needed. As such I'm not super concerned with the fact that overriding the stack would explicitly disable that lazy mechanism, but I honestly don't have a strong opinion either way at this point. </td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Tue Nov 11 2025 18:32:41 GMT-0800 (Pacific Standard Time)">02:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-11" title="@kriskowal:aelf.land">kriskowal</span>&gt;</div></td><td class="msg-cell"><span class="nick-8">Jacob Smith</span> lmk if you‚Äôd like to cover deep difference of object graphs, by whatever name, at tomorrow‚Äôs meeting.</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Tue Nov 11 2025 18:32:54 GMT-0800 (Pacific Standard Time)">02:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-11" title="@kriskowal:aelf.land">kriskowal</span>&gt;</div></td><td class="msg-cell">I think we‚Äôll otherwise open the floor to discuss proposals for next week‚Äôs plenary.</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Wed Nov 12 2025 00:35:37 GMT-0800 (Pacific Standard Time)">08:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-1" title="@jridgewell:matrix.org">Justin Ridgewell</span>&gt;</div></td><td class="msg-cell">Why though?</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Wed Nov 12 2025 00:38:42 GMT-0800 (Pacific Standard Time)">08:38</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@olivf.o1o.ch:immer.chat">Olivier Fl√ºckiger</span>&gt;</div></td><td class="msg-cell">Also, that is not what V8 is doing right now. Once you set the stack property we will collect that memory. I don't really know how important that is, but I did hear nightmare stories of big websites leaking their whole application state through error objects :) That is where my worries come from...</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Wed Nov 12 2025 00:49:20 GMT-0800 (Pacific Standard Time)">08:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@olivf.o1o.ch:immer.chat">Olivier Fl√ºckiger</span>&gt;</div></td><td class="msg-cell">So I guess my question is, what would be the argument against the setter also writing undefined (or whatever constant) into the internal slot should there be such a slot on the receiver...</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Wed Nov 12 2025 00:57:49 GMT-0800 (Pacific Standard Time)">08:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mhofman:matrix.org">Mathieu Hofman</span>&gt;</div></td><td class="msg-cell">I personally don't have any, as long as that happens only after successfully defining the own stack property on the receiver . </td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Wed Nov 12 2025 01:03:49 GMT-0800 (Pacific Standard Time)">09:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-1" title="@jridgewell:matrix.org">Justin Ridgewell</span>&gt;</div></td><td class="msg-cell">I think that would be fine.</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Wed Nov 12 2025 05:24:22 GMT-0800 (Pacific Standard Time)">13:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@dminor:mozilla.org">dminor</span>&gt;</div></td><td class="msg-cell">That makes sense to me.</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Wed Nov 12 2025 05:44:59 GMT-0800 (Pacific Standard Time)">13:44</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@ljharb:matrix.org">ljharb</span>&gt;</div></td><td class="msg-cell">because that's how every internal slot works, for one. but also because the stack trace is the thing that makes it an error</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Wed Nov 12 2025 05:45:10 GMT-0800 (Pacific Standard Time)">13:45</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@ljharb:matrix.org">ljharb</span>&gt;</div></td><td class="msg-cell">v8 is doing a bunch of stuff around error stacks right now that need fixing. for example, the hidden intrinsic own accessor property on every error instance</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Wed Nov 12 2025 05:46:21 GMT-0800 (Pacific Standard Time)">13:46</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@olivf.o1o.ch:immer.chat">Olivier Fl√ºckiger</span>&gt;</div></td><td class="msg-cell">"The only specified use of [[ErrorData]] is [...] to identify Error" <a href="https://tc39.es/ecma262/#sec-properties-of-error-instances">https://tc39.es/ecma262/#sec-properties-of-error-instances</a></td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Wed Nov 12 2025 05:46:47 GMT-0800 (Pacific Standard Time)">13:46</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@ljharb:matrix.org">ljharb</span>&gt;</div></td><td class="msg-cell">i'm not talking about the spec, which doesn't discuss stacks at all right now - but about actual semantics in practice</td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Wed Nov 12 2025 05:46:52 GMT-0800 (Pacific Standard Time)">13:46</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@ljharb:matrix.org">ljharb</span>&gt;</div></td><td class="msg-cell"><code>new Error()</code> is the only way to get a stack trace</td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Wed Nov 12 2025 05:46:58 GMT-0800 (Pacific Standard Time)">13:46</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@olivf.o1o.ch:immer.chat">Olivier Fl√ºckiger</span>&gt;</div></td><td class="msg-cell">So currently in Ecma262 errors do not have a stack trace. Many engines will give you one. And at least two engines will allow you to remove it again...</td></tr>
  <tr class="msg" id="L17"><td class="ts-cell"><a class="ts" href="#L17" alt="Wed Nov 12 2025 05:47:09 GMT-0800 (Pacific Standard Time)">13:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@ljharb:matrix.org">ljharb</span>&gt;</div></td><td class="msg-cell">sure</td></tr>
  <tr class="msg" id="L18"><td class="ts-cell"><a class="ts" href="#L18" alt="Wed Nov 12 2025 05:47:26 GMT-0800 (Pacific Standard Time)">13:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@ljharb:matrix.org">ljharb</span>&gt;</div></td><td class="msg-cell">which means there's no web compat angle forcing a direction, which means we should do the normal thing for the language.</td></tr>
  <tr class="msg" id="L19"><td class="ts-cell"><a class="ts" href="#L19" alt="Wed Nov 12 2025 05:47:55 GMT-0800 (Pacific Standard Time)">13:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@ljharb:matrix.org">ljharb</span>&gt;</div></td><td class="msg-cell">and that's an immutable slot determined at instantiation time, with a prototype accessor to read it</td></tr>
  <tr class="msg" id="L20"><td class="ts-cell"><a class="ts" href="#L20" alt="Wed Nov 12 2025 05:48:05 GMT-0800 (Pacific Standard Time)">13:48</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@ljharb:matrix.org">ljharb</span>&gt;</div></td><td class="msg-cell">the setter only exists in the proposal for web compatibility, otherwise there wouldn't be one</td></tr>
  <tr class="msg" id="L21"><td class="ts-cell"><a class="ts" href="#L21" alt="Wed Nov 12 2025 05:50:12 GMT-0800 (Pacific Standard Time)">13:50</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@olivf.o1o.ch:immer.chat">Olivier Fl√ºckiger</span>&gt;</div></td><td class="msg-cell">Only this might turn out to be half-webcompatible. As in it behaves semantically like before, but pragmatically it might use up all your applications memory...</td></tr>
  <tr class="msg" id="L22"><td class="ts-cell"><a class="ts" href="#L22" alt="Wed Nov 12 2025 05:54:47 GMT-0800 (Pacific Standard Time)">13:54</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@ljharb:matrix.org">ljharb</span>&gt;</div></td><td class="msg-cell">i would be very surprised if a string attached to an error object used up lots of memory - what long-running application is going to keep error instances around, but a <em>string</em> is the thing that uses too much memory?</td></tr>
  <tr class="msg" id="L23"><td class="ts-cell"><a class="ts" href="#L23" alt="Wed Nov 12 2025 05:55:08 GMT-0800 (Pacific Standard Time)">13:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@ljharb:matrix.org">ljharb</span>&gt;</div></td><td class="msg-cell">tbh i just don't see how that's a remotely meaningful concern</td></tr>
  <tr class="msg" id="L24"><td class="ts-cell"><a class="ts" href="#L24" alt="Wed Nov 12 2025 05:55:38 GMT-0800 (Pacific Standard Time)">13:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@olivf.o1o.ch:immer.chat">Olivier Fl√ºckiger</span>&gt;</div></td><td class="msg-cell">ah, that's the thing. we don't have a string there. but some internal representation of the stack</td></tr>
  <tr class="msg" id="L25"><td class="ts-cell"><a class="ts" href="#L25" alt="Wed Nov 12 2025 05:55:49 GMT-0800 (Pacific Standard Time)">13:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@olivf.o1o.ch:immer.chat">Olivier Fl√ºckiger</span>&gt;</div></td><td class="msg-cell">that is for example accessible to formatStackTrace</td></tr>
  <tr class="msg" id="L26"><td class="ts-cell"><a class="ts" href="#L26" alt="Wed Nov 12 2025 05:55:56 GMT-0800 (Pacific Standard Time)">13:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@ljharb:matrix.org">ljharb</span>&gt;</div></td><td class="msg-cell">you don't need to keep that once the stack is fetched tho - just the string</td></tr>
  <tr class="msg" id="L27"><td class="ts-cell"><a class="ts" href="#L27" alt="Wed Nov 12 2025 05:56:12 GMT-0800 (Pacific Standard Time)">13:56</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@ljharb:matrix.org">ljharb</span>&gt;</div></td><td class="msg-cell">or at least, the JS spec isn't forcing that</td></tr>
  <tr class="msg" id="L28"><td class="ts-cell"><a class="ts" href="#L28" alt="Wed Nov 12 2025 05:56:24 GMT-0800 (Pacific Standard Time)">13:56</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@ljharb:matrix.org">ljharb</span>&gt;</div></td><td class="msg-cell">(i don't know what formatStackTrace is)</td></tr>
  <tr class="msg" id="L29"><td class="ts-cell"><a class="ts" href="#L29" alt="Wed Nov 12 2025 05:57:41 GMT-0800 (Pacific Standard Time)">13:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@ljharb:matrix.org">ljharb</span>&gt;</div></td><td class="msg-cell">(ironically v8 is the one that blocked the structured stack trace proposal back in like 2018 for reasons unrelated to this convo, so i'm surprised they now have a stack structure with important use cases)</td></tr>
  <tr class="msg" id="L30"><td class="ts-cell"><a class="ts" href="#L30" alt="Wed Nov 12 2025 06:00:28 GMT-0800 (Pacific Standard Time)">14:00</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@olivf.o1o.ch:immer.chat">Olivier Fl√ºckiger</span>&gt;</div></td><td class="msg-cell">ookay. I mean we can write spec text all day. I am just pointing out what might cause difficulties shipping it...</td></tr>
  <tr class="msg" id="L31"><td class="ts-cell"><a class="ts" href="#L31" alt="Wed Nov 12 2025 06:00:40 GMT-0800 (Pacific Standard Time)">14:00</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@olivf.o1o.ch:immer.chat">Olivier Fl√ºckiger</span>&gt;</div></td><td class="msg-cell">(prepareStackTrace I meant)</td></tr>
  <tr class="msg" id="L32"><td class="ts-cell"><a class="ts" href="#L32" alt="Wed Nov 12 2025 06:03:22 GMT-0800 (Pacific Standard Time)">14:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@ljharb:matrix.org">ljharb</span>&gt;</div></td><td class="msg-cell">totally, i appreciate you bringing it up</td></tr>
  <tr class="msg" id="L33"><td class="ts-cell"><a class="ts" href="#L33" alt="Wed Nov 12 2025 06:03:29 GMT-0800 (Pacific Standard Time)">14:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@ljharb:matrix.org">ljharb</span>&gt;</div></td><td class="msg-cell">i'm just trying to understand why it would make a difference</td></tr>
  <tr class="msg" id="L34"><td class="ts-cell"><a class="ts" href="#L34" alt="Wed Nov 12 2025 06:04:06 GMT-0800 (Pacific Standard Time)">14:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@ljharb:matrix.org">ljharb</span>&gt;</div></td><td class="msg-cell">like, can you describe the long-running web app where it keeps around error instances, nulls out the stack trace, and where the weight of the underlying stack structure sticking around would be punitive? (but the weight of the error instances would not be)</td></tr>
  <tr class="msg" id="L35"><td class="ts-cell"><a class="ts" href="#L35" alt="Wed Nov 12 2025 06:04:35 GMT-0800 (Pacific Standard Time)">14:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@ljharb:matrix.org">ljharb</span>&gt;</div></td><td class="msg-cell">i've been doing web dev for a long long time and while indeed devs do all sorts of wacky stuff, i can't even conceive of how such an application could come into existence or what it'd do</td></tr>
  <tr class="msg" id="L36"><td class="ts-cell"><a class="ts" href="#L36" alt="Wed Nov 12 2025 06:07:24 GMT-0800 (Pacific Standard Time)">14:07</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@nicolo-ribaudo:matrix.org">nicolo-ribaudo</span>&gt;</div></td><td class="msg-cell">Just an idea but I don't actually want to be involved in this discussion so I won't defend it: maybe V8 could stringify the stack trace (calling .prepareStackTrace) when the setter runs (similarly to how it does it when the getter runs), and then store the string?</td></tr>
  <tr class="msg" id="L37"><td class="ts-cell"><a class="ts" href="#L37" alt="Wed Nov 12 2025 06:09:50 GMT-0800 (Pacific Standard Time)">14:09</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@olivf.o1o.ch:immer.chat">Olivier Fl√ºckiger</span>&gt;</div></td><td class="msg-cell">yeah, that would be the obvious solution, if we didn't have <a href="https://v8.dev/docs/stack-trace-api#customizing-stack-traces">https://v8.dev/docs/stack-trace-api#customizing-stack-traces</a></td></tr>
  <tr class="msg" id="L38"><td class="ts-cell"><a class="ts" href="#L38" alt="Wed Nov 12 2025 06:10:05 GMT-0800 (Pacific Standard Time)">14:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@olivf.o1o.ch:immer.chat">Olivier Fl√ºckiger</span>&gt;</div></td><td class="msg-cell">but we do and that is another web reality unfortunately</td></tr>
  <tr class="msg" id="L39"><td class="ts-cell"><a class="ts" href="#L39" alt="Wed Nov 12 2025 06:11:10 GMT-0800 (Pacific Standard Time)">14:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@ljharb:matrix.org">ljharb</span>&gt;</div></td><td class="msg-cell">well, a chrome reality at least</td></tr>
  <tr class="msg" id="L40"><td class="ts-cell"><a class="ts" href="#L40" alt="Wed Nov 12 2025 06:12:13 GMT-0800 (Pacific Standard Time)">14:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@ljharb:matrix.org">ljharb</span>&gt;</div></td><td class="msg-cell">that API seems like it <em>accepts</em> a structure tho - the original error doesn't <em>provide</em> it such that it matches the stack trace?</td></tr>
  <tr class="msg" id="L41"><td class="ts-cell"><a class="ts" href="#L41" alt="Wed Nov 12 2025 06:13:05 GMT-0800 (Pacific Standard Time)">14:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@ljharb:matrix.org">ljharb</span>&gt;</div></td><td class="msg-cell">eg in <code>Error.prepareStackTrace(error, structuredStackTrace)</code> - it's not retrieving the structure, it's forcing the user to pass one of their own. the implication ofc is that there's one of these internally for each error, and i guess that's the memory you're concerned about?</td></tr>
  <tr class="msg" id="L42"><td class="ts-cell"><a class="ts" href="#L42" alt="Wed Nov 12 2025 06:14:54 GMT-0800 (Pacific Standard Time)">14:14</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@olivf.o1o.ch:immer.chat">Olivier Fl√ºckiger</span>&gt;</div></td><td class="msg-cell">Yes, the problem is that the error internally has all this stuff that you see listed on that doc attached. And turning it into a string can be observable via hooking into this prepareStackTrace function. So we can't do it transparently...</td></tr>
  <tr class="msg" id="L43"><td class="ts-cell"><a class="ts" href="#L43" alt="Wed Nov 12 2025 06:15:31 GMT-0800 (Pacific Standard Time)">14:15</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@ljharb:matrix.org">ljharb</span>&gt;</div></td><td class="msg-cell">i'm confused how it's observable - that page doesn't describe any hooks</td></tr>
  <tr class="msg" id="L44"><td class="ts-cell"><a class="ts" href="#L44" alt="Wed Nov 12 2025 06:15:49 GMT-0800 (Pacific Standard Time)">14:15</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@ljharb:matrix.org">ljharb</span>&gt;</div></td><td class="msg-cell">the stack string construction <em>from the structure i provided</em> is observable, i see that</td></tr>
  <tr class="msg" id="L45"><td class="ts-cell"><a class="ts" href="#L45" alt="Wed Nov 12 2025 06:15:51 GMT-0800 (Pacific Standard Time)">14:15</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@olivf.o1o.ch:immer.chat">Olivier Fl√ºckiger</span>&gt;</div></td><td class="msg-cell">Anyway, I guess I can agree that this is a bit of a chrome specific issue.</td></tr>
  <tr class="msg" id="L46"><td class="ts-cell"><a class="ts" href="#L46" alt="Wed Nov 12 2025 06:16:00 GMT-0800 (Pacific Standard Time)">14:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@ljharb:matrix.org">ljharb</span>&gt;</div></td><td class="msg-cell">but the default stack trace's structure isn't accessible to me, is it?</td></tr>
  <tr class="msg" id="L47"><td class="ts-cell"><a class="ts" href="#L47" alt="Wed Nov 12 2025 06:16:22 GMT-0800 (Pacific Standard Time)">14:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@olivf.o1o.ch:immer.chat">Olivier Fl√ºckiger</span>&gt;</div></td><td class="msg-cell">it is, if you install your own code for prepareStackTrace</td></tr>
  <tr class="msg" id="L48"><td class="ts-cell"><a class="ts" href="#L48" alt="Wed Nov 12 2025 06:16:45 GMT-0800 (Pacific Standard Time)">14:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@ljharb:matrix.org">ljharb</span>&gt;</div></td><td class="msg-cell">‚Ä¶ are you saying that the engine calls <em>the current value of Error.prepareStackTrace</em> when making a string? O.o</td></tr>
  <tr class="msg" id="L49"><td class="ts-cell"><a class="ts" href="#L49" alt="Wed Nov 12 2025 06:17:06 GMT-0800 (Pacific Standard Time)">14:17</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@ljharb:matrix.org">ljharb</span>&gt;</div></td><td class="msg-cell">that‚Ä¶ is a horrific capability to expose to users and it would be really good to move away from it :-(</td></tr>
  <tr class="msg" id="L50"><td class="ts-cell"><a class="ts" href="#L50" alt="Wed Nov 12 2025 06:17:56 GMT-0800 (Pacific Standard Time)">14:17</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@olivf.o1o.ch:immer.chat">Olivier Fl√ºckiger</span>&gt;</div></td><td class="msg-cell">ok, now we are on the same page I guess :)</td></tr>
  <tr class="msg" id="L51"><td class="ts-cell"><a class="ts" href="#L51" alt="Wed Nov 12 2025 06:18:12 GMT-0800 (Pacific Standard Time)">14:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@nicolo-ribaudo:matrix.org">nicolo-ribaudo</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> that‚Ä¶ is a horrific capability to expose to users and it would be really good to move away from it :-(</blockquote></mx-reply>At least in Node.js packages rely on it ‚Äî Babel does, for example</td></tr>
  <tr class="msg" id="L52"><td class="ts-cell"><a class="ts" href="#L52" alt="Wed Nov 12 2025 06:18:19 GMT-0800 (Pacific Standard Time)">14:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@nicolo-ribaudo:matrix.org">nicolo-ribaudo</span>&gt;</div></td><td class="msg-cell">I don't remember for what</td></tr>
  <tr class="msg" id="L53"><td class="ts-cell"><a class="ts" href="#L53" alt="Wed Nov 12 2025 06:18:37 GMT-0800 (Pacific Standard Time)">14:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@olivf.o1o.ch:immer.chat">Olivier Fl√ºckiger</span>&gt;</div></td><td class="msg-cell">You can e.g., apply sourcemaps to stack traces</td></tr>
  <tr class="msg" id="L54"><td class="ts-cell"><a class="ts" href="#L54" alt="Wed Nov 12 2025 06:18:47 GMT-0800 (Pacific Standard Time)">14:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@ljharb:matrix.org">ljharb</span>&gt;</div></td><td class="msg-cell">oof</td></tr>
  <tr class="msg" id="L55"><td class="ts-cell"><a class="ts" href="#L55" alt="Wed Nov 12 2025 06:19:08 GMT-0800 (Pacific Standard Time)">14:19</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@ljharb:matrix.org">ljharb</span>&gt;</div></td><td class="msg-cell">do any of these use cases <em>not</em> first use captureStackTrace?</td></tr>
  <tr class="msg" id="L56"><td class="ts-cell"><a class="ts" href="#L56" alt="Wed Nov 12 2025 06:19:53 GMT-0800 (Pacific Standard Time)">14:19</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@ljharb:matrix.org">ljharb</span>&gt;</div></td><td class="msg-cell">because then the cost of holding on to the structure would only be a problem for errors that go through captureStackTrace - the others could just memoize the string and collect the structure on first access</td></tr>
  <tr class="msg" id="L57"><td class="ts-cell"><a class="ts" href="#L57" alt="Wed Nov 12 2025 06:19:58 GMT-0800 (Pacific Standard Time)">14:19</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@nicolo-ribaudo:matrix.org">nicolo-ribaudo</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> do any of these use cases <em>not</em> first use captureStackTrace?</blockquote></mx-reply>No, because there is no need for it. Most code is dealing with normal errors that already have a stack trace</td></tr>
  <tr class="msg" id="L58"><td class="ts-cell"><a class="ts" href="#L58" alt="Wed Nov 12 2025 06:20:28 GMT-0800 (Pacific Standard Time)">14:20</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@nicolo-ribaudo:matrix.org">nicolo-ribaudo</span>&gt;</div></td><td class="msg-cell">You get them from a try/catch somewhere </td></tr>
  <tr class="msg" id="L59"><td class="ts-cell"><a class="ts" href="#L59" alt="Wed Nov 12 2025 06:20:45 GMT-0800 (Pacific Standard Time)">14:20</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@ljharb:matrix.org">ljharb</span>&gt;</div></td><td class="msg-cell">hm</td></tr>
  <tr class="msg" id="L60"><td class="ts-cell"><a class="ts" href="#L60" alt="Wed Nov 12 2025 06:22:07 GMT-0800 (Pacific Standard Time)">14:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@nicolo-ribaudo:matrix.org">nicolo-ribaudo</span>&gt;</div></td><td class="msg-cell"><a href="https://github.com/evanw/node-source-map-support">https://github.com/evanw/node-source-map-support</a> is a popular package relying on it. It seems like new Node.js versions do it by themselves, I don't know if using the same hook</td></tr>
  <tr class="msg" id="L61"><td class="ts-cell"><a class="ts" href="#L61" alt="Wed Nov 12 2025 06:23:00 GMT-0800 (Pacific Standard Time)">14:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@olivf.o1o.ch:immer.chat">Olivier Fl√ºckiger</span>&gt;</div></td><td class="msg-cell">I mean we can work around the problem, as long as you don't use that prepareStackTrace api. The extra horrific part is that you can install a prepareStackTrace at anypoint :) But I guess we could live with a solution where after installing a new prepareStackTrace the already evaluated errors would not be updated...</td></tr>
  <tr class="msg" id="L62"><td class="ts-cell"><a class="ts" href="#L62" alt="Wed Nov 12 2025 06:23:37 GMT-0800 (Pacific Standard Time)">14:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@ljharb:matrix.org">ljharb</span>&gt;</div></td><td class="msg-cell">definitely the stack string should never be changeable once observed, just like some proxy trap values</td></tr>
  <tr class="msg" id="L63"><td class="ts-cell"><a class="ts" href="#L63" alt="Wed Nov 12 2025 06:24:07 GMT-0800 (Pacific Standard Time)">14:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@olivf.o1o.ch:immer.chat">Olivier Fl√ºckiger</span>&gt;</div></td><td class="msg-cell">But it means the solution will be nice in the spec but ugly in reality.</td></tr>
  <tr class="msg" id="L64"><td class="ts-cell"><a class="ts" href="#L64" alt="Wed Nov 12 2025 06:24:45 GMT-0800 (Pacific Standard Time)">14:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@olivf.o1o.ch:immer.chat">Olivier Fl√ºckiger</span>&gt;</div></td><td class="msg-cell">And I also don't know of apps which explicitly delete the stack to free that memory, but I could imagine them existing. That's why I opened the issue...</td></tr>
  <tr class="msg" id="L65"><td class="ts-cell"><a class="ts" href="#L65" alt="Wed Nov 12 2025 06:24:46 GMT-0800 (Pacific Standard Time)">14:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@ljharb:matrix.org">ljharb</span>&gt;</div></td><td class="msg-cell">if the ugly can be avoided that's great, but when things are built organically by a single implementation instead of going through a broad standards process we're often left with ugly :-( look at typed arrays :-p</td></tr>
  <tr class="msg" id="L66"><td class="ts-cell"><a class="ts" href="#L66" alt="Wed Nov 12 2025 06:25:26 GMT-0800 (Pacific Standard Time)">14:25</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@ljharb:matrix.org">ljharb</span>&gt;</div></td><td class="msg-cell">if chrome is willing to gather telemetry on that, that'd be helpful</td></tr>
  <tr class="msg" id="L67"><td class="ts-cell"><a class="ts" href="#L67" alt="Wed Nov 12 2025 06:26:15 GMT-0800 (Pacific Standard Time)">14:26</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@olivf.o1o.ch:immer.chat">Olivier Fl√ºckiger</span>&gt;</div></td><td class="msg-cell">it's actually more common than you would think. I think I have numbers</td></tr>
  <tr class="msg" id="L68"><td class="ts-cell"><a class="ts" href="#L68" alt="Wed Nov 12 2025 06:26:56 GMT-0800 (Pacific Standard Time)">14:26</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@ljharb:matrix.org">ljharb</span>&gt;</div></td><td class="msg-cell">i'd love to look into it. apps that delete the stack to free that memory but then keep the error objects around for a long time?</td></tr>
  <tr class="msg" id="L69"><td class="ts-cell"><a class="ts" href="#L69" alt="Wed Nov 12 2025 06:27:49 GMT-0800 (Pacific Standard Time)">14:27</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@olivf.o1o.ch:immer.chat">Olivier Fl√ºckiger</span>&gt;</div></td><td class="msg-cell"><a href="https://chromestatus.com/metrics/feature/timeline/popularity/2223">https://chromestatus.com/metrics/feature/timeline/popularity/2223</a></td></tr>
  <tr class="msg" id="L70"><td class="ts-cell"><a class="ts" href="#L70" alt="Wed Nov 12 2025 06:32:14 GMT-0800 (Pacific Standard Time)">14:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@olivf.o1o.ch:immer.chat">Olivier Fl√ºckiger</span>&gt;</div></td><td class="msg-cell">I get some hits with: <a href="https://github.com/search?q=%22.stack+%3D+null%22+language%3AJavaScript+&amp;type=code">https://github.com/search?q=%22.stack+%3D+null%22+language%3AJavaScript+&amp;type=code</a> ü§∑</td></tr>
  <tr class="msg" id="L71"><td class="ts-cell"><a class="ts" href="#L71" alt="Wed Nov 12 2025 06:46:02 GMT-0800 (Pacific Standard Time)">14:46</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@ljharb:matrix.org">ljharb</span>&gt;</div></td><td class="msg-cell">that shows 1.5% of pageloads that call prepareStackTrace, but not pages that null out the stack</td></tr>
  <tr class="msg" id="L72"><td class="ts-cell"><a class="ts" href="#L72" alt="Wed Nov 12 2025 06:49:08 GMT-0800 (Pacific Standard Time)">14:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@olivf.o1o.ch:immer.chat">Olivier Fl√ºckiger</span>&gt;</div></td><td class="msg-cell">ah yes, for that I don't have numbers. I meant to say prepareStackTrace is surprisingly popular so we can't just remove or break it.</td></tr>
  <tr class="msg" id="L73"><td class="ts-cell"><a class="ts" href="#L73" alt="Wed Nov 12 2025 06:49:33 GMT-0800 (Pacific Standard Time)">14:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@ljharb:matrix.org">ljharb</span>&gt;</div></td><td class="msg-cell">totally, i get that</td></tr>
  <tr class="msg" id="L74"><td class="ts-cell"><a class="ts" href="#L74" alt="Wed Nov 12 2025 06:49:50 GMT-0800 (Pacific Standard Time)">14:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@ljharb:matrix.org">ljharb</span>&gt;</div></td><td class="msg-cell">i was hoping for telemetry on the memory concern tho, since "uses prepareStackTrace" doesn't tell us that (eg, "nulls out the stack but keeps the error around for awhile")</td></tr>
  <tr class="msg" id="L75"><td class="ts-cell"><a class="ts" href="#L75" alt="Wed Nov 12 2025 06:52:17 GMT-0800 (Pacific Standard Time)">14:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@olivf.o1o.ch:immer.chat">Olivier Fl√ºckiger</span>&gt;</div></td><td class="msg-cell">I only have anecdotal evidence of very widely used apps which did catch and store errors for reporting them, failed to release said errors and through our internal stack representation leaking a lot of memory. Idk if these apps were fixed by just not keeping the errors or by overriding the stack...</td></tr>
  <tr class="msg" id="L76"><td class="ts-cell"><a class="ts" href="#L76" alt="Wed Nov 12 2025 06:52:43 GMT-0800 (Pacific Standard Time)">14:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@ljharb:matrix.org">ljharb</span>&gt;</div></td><td class="msg-cell">i'd assume the former - serializing them to strings and throwing away the objects - but that'd be helpful to clarify</td></tr>
  <tr class="msg" id="L77"><td class="ts-cell"><a class="ts" href="#L77" alt="Wed Nov 12 2025 06:53:07 GMT-0800 (Pacific Standard Time)">14:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@olivf.o1o.ch:immer.chat">Olivier Fl√ºckiger</span>&gt;</div></td><td class="msg-cell">that info is probably lost in time</td></tr>
  <tr class="msg" id="L78"><td class="ts-cell"><a class="ts" href="#L78" alt="Wed Nov 12 2025 07:22:18 GMT-0800 (Pacific Standard Time)">15:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@mhofman:matrix.org">Mathieu Hofman</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> Just an idea but I don't actually want to be involved in this discussion so I won't defend it: maybe V8 could stringify the stack trace (calling .prepareStackTrace) when the setter runs (similarly to how it does it when the getter runs), and then store the string?</blockquote></mx-reply>This is the alternative I had also in mind. My understanding is that there is a compat concern that to release the stack structure, it would require v8 to call prepareStackTrace when the stack setter is called, if the stack structure hadn't been processed yet. This sounds like an even more niche case than using the setter: use the setter without using the getter / capturing an error but immediately discard the stack without using it. I really doubt this is happening much / at all, and if it is happening some, I doubt that the user implementation of prepareStackTrace would care being called extra.</td></tr>

</tbody></table></div></div></div>
</body></html>
<!DOCTYPE html><html><head>
  <title>TC39 Signals on 2024-04-16</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "TC39 Signals";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">TC39 Signals<br>2024-04-16<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2024-04-15" class="nav-link"><span>prev</span></a>
<a href="2024-04-17" class="nav-link"><span style="float:right">next</span></a>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">
<div class="rhs-header">
<span id="error" style="color: red; display:none">error</span>

<input type="text" id="query" size="25" placeholder="Search TC39 Signals">
<a id="search-submit" class="button icon-link" title="Search">
  <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"></path></svg>
</a>
</div>

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Mon Apr 15 2024 17:21:06 GMT-0700 (Pacific Daylight Time)">00:21</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-1" title="@nullvoxpopuli:matrix.org">nullvoxpopuli</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> just because the arcs are more or less shaped into a cone I think it's easier to see that it's a signal</blockquote></mx-reply>Ye, actual radio signals are shaped like a rope with adhd</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Tue Apr 16 2024 03:48:15 GMT-0700 (Pacific Daylight Time)">10:48</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@hediet:matrix.org">Henning</span>&gt;</div></td><td class="msg-cell"><p>Hello ðŸ‘‹ Just stumbled upon <a href="https://github.com/tc39/proposal-signals/issues/96">this issue</a> and thought about reaching out. For VS Code, we have an internal <a href="https://github.com/microsoft/vscode/blob/5ccc2db0a2ed24e8c0dc3ecd7d515e4f76c87e69/src/vs/base/common/observableInternal/base.ts#L22-L88">implementation of observables</a>. You can find some demo usage (<a href="https://github.com/microsoft/vscode/blob/5ccc2db0a2ed24e8c0dc3ecd7d515e4f76c87e69/src/vs/base/test/common/observable.test.ts#L18">here</a>).<br>While our implementation/API is heavily inspired by MobX, it tries to include some of our learnings of using MobX in other projects, mostly by making many things less magic and more debuggable. Since most of VS Code uses plain simple fields and change-events, we wanted to make it very clear what is observable and what not and when a derived/autorun subscribes to something observable. Observable usage is not yet very widespread in the VS Code source and it is mostly driven by me, but it is already used in core components, such as some editor contributions and the diff editor and so far the very explicit API style paid off.</p>
<p>However, I also understand the advantages of transparent observables as presented by this proposal and don't necessarily see a need of this proposal to support use-cases such as ours, where we wanted a more explicit API. There are some things though where we also could use some browser support, mostly around inferring the name of an observable from its variable name/field.</p>
</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Tue Apr 16 2024 04:27:33 GMT-0700 (Pacific Daylight Time)">11:27</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@hediet:matrix.org">Henning</span>&gt;</div></td><td class="msg-cell">Something novel (to my knowledge) of our observable implementation is the concept of delta information, which can be used to inform observers how or why a value changed. We call observables that don't have a state and just delta information a "signal", which, alone, basically just represents an event with event args. However, observables and signals can be updated/triggered in the same transaction and also be handled at once in the same derived/autorun, which enables some new use cases of observables. This is quite useful when it matters how a certain state was reached, and not just what the state is. I think this "signal" part can be used to bring some rxjs ideas to observables. </td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Tue Apr 16 2024 06:59:18 GMT-0700 (Pacific Daylight Time)">13:59</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@shaylew:matrix.org">shaylew</span>&gt;</div></td><td class="msg-cell">ah, interesting! there seems to be a significant group of existing implementations that use "reader capabilities" of some sort. I'd been wondering if we should provide a facility to move between explicit and implicit readers, something like
`trackImplicitly: &lt;R&gt;(read: Reader, f: () =&gt; R) =&gt; R`
`trackExplicitly: &lt;R&gt;(f: (read: Reader) =&gt; R) =&gt; R`
with `get` taking an optional Reader.

... though this does have the unfortunate implication that library code would end up encouraged to use the explicit plumbing version universally (`undefined` plumbs through just fine if the caller wants to be implicit). might be too much bifurcation, and we didn't have many examples/participants using it at scale, which is why we left it out of this first iteration.

are you using the readers for async tracking/lexical capture of the tracking environment, or just for the sake of explicitness?</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Tue Apr 16 2024 07:11:09 GMT-0700 (Pacific Daylight Time)">14:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@hediet:matrix.org">Henning</span>&gt;</div></td><td class="msg-cell"><blockquote>
<p>though this does have the unfortunate implication that library code would end up encouraged to use the explicit plumbing version universally</p>
</blockquote>
<p>I agree that mixing explicit and implicit implementations might be tricky and potentially confusing.</p>
<blockquote>
<p>are you using the readers for async tracking/lexical capture of the tracking environment, or just for the sake of explicitness?</p>
</blockquote>
<p>For now, just for the sake of explicitness, as we didn't need tracking after an await yet.</p>
</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Tue Apr 16 2024 07:12:11 GMT-0700 (Pacific Daylight Time)">14:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@shaylew:matrix.org">shaylew</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> Something novel (to my knowledge) of our observable implementation is the concept of delta information, which can be used to inform observers how or why a value changed. We call observables that don't have a state and just delta information a "signal", which, alone, basically just represents an event with event args. However, observables and signals can be updated/triggered in the same transaction and also be handled at once in the same derived/autorun, which enables some new use cases of observables. This is quite useful when it matters how a certain state was reached, and not just what the state is. I think this "signal" part can be used to bring some rxjs ideas to observables.</blockquote></mx-reply>I've been looking into a couple of very different delta-based systems (<a href="https://signia.tldraw.dev/">https://signia.tldraw.dev/</a>, and separately differential dataflow which if you squint is very related) and might have to go chew on yours for a bit to tell where it places</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Tue Apr 16 2024 07:14:59 GMT-0700 (Pacific Daylight Time)">14:14</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@hediet:matrix.org">Henning</span>&gt;</div></td><td class="msg-cell"><a href="https://github.com/microsoft/vscode/blob/5ccc2db0a2ed24e8c0dc3ecd7d515e4f76c87e69/src/vs/base/test/common/observable.test.ts#L304-L345">Here is an example of how emitting and handling deltas works.</a></td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Tue Apr 16 2024 07:19:42 GMT-0700 (Pacific Daylight Time)">14:19</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@shaylew:matrix.org">shaylew</span>&gt;</div></td><td class="msg-cell">ah, are your deltas and deriveds both eager? signia's thing is making them lazy (so deltas are lossy -- if you don't read them they'll be discarded instead of piling up), so seems pretty different</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Tue Apr 16 2024 07:20:34 GMT-0700 (Pacific Daylight Time)">14:20</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@hediet:matrix.org">Henning</span>&gt;</div></td><td class="msg-cell">the deltas are not lazy per se, but of cause they could be backed by an lazy implementation</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Tue Apr 16 2024 07:20:54 GMT-0700 (Pacific Daylight Time)">14:20</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@hediet:matrix.org">Henning</span>&gt;</div></td><td class="msg-cell">signias approach is also very interesting!</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Tue Apr 16 2024 07:21:10 GMT-0700 (Pacific Daylight Time)">14:21</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@hediet:matrix.org">Henning</span>&gt;</div></td><td class="msg-cell">the deriveds in our implementation are as lazy as possible, but at the moment they cannot produce deltas (so currently only observable values and signals, i.e. atoms, can produce deltas, which can be handled in deriveds or autoruns, but there is no derived implementation that can produce them yet)</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Tue Apr 16 2024 07:22:13 GMT-0700 (Pacific Daylight Time)">14:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@shaylew:matrix.org">shaylew</span>&gt;</div></td><td class="msg-cell">can they consume them?</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Tue Apr 16 2024 07:22:40 GMT-0700 (Pacific Daylight Time)">14:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@hediet:matrix.org">Henning</span>&gt;</div></td><td class="msg-cell">yes, they can consume them - the derived example would be analog to the autorun one</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Tue Apr 16 2024 07:23:43 GMT-0700 (Pacific Daylight Time)">14:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@hediet:matrix.org">Henning</span>&gt;</div></td><td class="msg-cell">deltas can be consumed lazily or eagerly, that depends on the implementation (see autorunHandleChanges, the user can either push all the deltas into an array or combine them using a different method).</td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Tue Apr 16 2024 07:25:00 GMT-0700 (Pacific Daylight Time)">14:25</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@shaylew:matrix.org">shaylew</span>&gt;</div></td><td class="msg-cell">ahh, so the consumer sort of "receives them" eagerly but separately from their reactive body rerunning, so they get to choose whether to buffer or process the information online?</td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Tue Apr 16 2024 07:26:12 GMT-0700 (Pacific Daylight Time)">14:26</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@hediet:matrix.org">Henning</span>&gt;</div></td><td class="msg-cell">exactly. They are also not allowed to call into other code when they receive the deltas, because other observables might not have received the event at this point yet</td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Tue Apr 16 2024 07:27:55 GMT-0700 (Pacific Daylight Time)">14:27</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@shaylew:matrix.org">shaylew</span>&gt;</div></td><td class="msg-cell">"delta stuff" in some sense or another seems necessary to get an efficient way to (eg) "count how many of these input signals are `true`", so I'm definitely interested in figuring out what minimal-but-sufficient support they'd need from the implementation</td></tr>
  <tr class="msg" id="L17"><td class="ts-cell"><a class="ts" href="#L17" alt="Tue Apr 16 2024 07:28:19 GMT-0700 (Pacific Daylight Time)">14:28</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@shaylew:matrix.org">shaylew</span>&gt;</div></td><td class="msg-cell">(ideally minimal, sufficient, and not too opinionated -- not guaranteed to be a bar that's clearable...)</td></tr>
  <tr class="msg" id="L18"><td class="ts-cell"><a class="ts" href="#L18" alt="Tue Apr 16 2024 07:28:50 GMT-0700 (Pacific Daylight Time)">14:28</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@hediet:matrix.org">Henning</span>&gt;</div></td><td class="msg-cell"><a href="https://github.com/microsoft/vscode/blob/0a141d23179c76c5771df25a43546d9d9b6ed71c/src/vs/editor/contrib/inlineCompletions/browser/inlineCompletionsModel.ts#L93">Here is a production example</a> (and yes, this derived has some "ugly" side effects and is basically an autorun, but that way callers can wait on the fetch promise)</td></tr>
  <tr class="msg" id="L19"><td class="ts-cell"><a class="ts" href="#L19" alt="Tue Apr 16 2024 07:32:33 GMT-0700 (Pacific Daylight Time)">14:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@shaylew:matrix.org">shaylew</span>&gt;</div></td><td class="msg-cell">do you guarantee some particular order in the changes each thing gets to fold over?</td></tr>
  <tr class="msg" id="L20"><td class="ts-cell"><a class="ts" href="#L20" alt="Tue Apr 16 2024 07:33:45 GMT-0700 (Pacific Daylight Time)">14:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@shaylew:matrix.org">shaylew</span>&gt;</div></td><td class="msg-cell">(I'm squinting at this (on a phone) and realizing it could be cousin to Jane Street `incremental`'s `unorderedFold` nodes)</td></tr>
  <tr class="msg" id="L21"><td class="ts-cell"><a class="ts" href="#L21" alt="Tue Apr 16 2024 07:35:32 GMT-0700 (Pacific Daylight Time)">14:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@hediet:matrix.org">Henning</span>&gt;</div></td><td class="msg-cell">what do you mean with "gets to fold over"? The only guarantee is that an observer receives all deltas from an observable in the same order.
However, if an observable has multiple observers, it is not specified which observer gets the change first. But this does not matter, because the observer is not allowed to interact with other observers at this point.</td></tr>
  <tr class="msg" id="L22"><td class="ts-cell"><a class="ts" href="#L22" alt="Tue Apr 16 2024 07:36:51 GMT-0700 (Pacific Daylight Time)">14:36</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@hediet:matrix.org">Henning</span>&gt;</div></td><td class="msg-cell">btw, a <code>countTrues(o: IObservable&lt;boolean&gt;[]): IObservable&lt;number&gt;</code> can also be efficiently implemented using an <code>autorun</code> for each item in <code>o</code>. However, transactions cannot see through such side-effect autoruns anymore</td></tr>
  <tr class="msg" id="L23"><td class="ts-cell"><a class="ts" href="#L23" alt="Tue Apr 16 2024 07:39:44 GMT-0700 (Pacific Daylight Time)">14:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@shaylew:matrix.org">shaylew</span>&gt;</div></td><td class="msg-cell">the view from a single observer that observes multiple observables, I meant -- maybe fold isn't the intended way to think about it, I just saw an "initial summary" and a "summarize previous summary + incoming context into new summary" and jumped to the "ah, folding over a stream" framing</td></tr>
  <tr class="msg" id="L24"><td class="ts-cell"><a class="ts" href="#L24" alt="Tue Apr 16 2024 07:40:30 GMT-0700 (Pacific Daylight Time)">14:40</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@hediet:matrix.org">Henning</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> btw, a <code>countTrues(o: IObservable&lt;boolean&gt;[]): IObservable&lt;number&gt;</code> can also be efficiently implemented using an <code>autorun</code> for each item in <code>o</code>. However, transactions cannot see through such side-effect autoruns anymore</blockquote></mx-reply>... however that might be circumvented by having a derived for each item in <code>o</code> that has a side effect which increments/decrements some shared count variable. Then you can create one derived that reads all these deriveds and returns the count field - I think this should give you an optimal solution without deltas.</td></tr>
  <tr class="msg" id="L25"><td class="ts-cell"><a class="ts" href="#L25" alt="Tue Apr 16 2024 07:45:28 GMT-0700 (Pacific Daylight Time)">14:45</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@shaylew:matrix.org">shaylew</span>&gt;</div></td><td class="msg-cell">don't you lose if you ever have to rerun that one derived that reads all the others, or if you ever have to traverse each edge back towards the N deriveds it reads? but yeah that's sort of what you want -- you lose the topology/scheduling constraint if you just use an autorun, and the derived version tries to recover that</td></tr>
  <tr class="msg" id="L26"><td class="ts-cell"><a class="ts" href="#L26" alt="Tue Apr 16 2024 07:52:05 GMT-0700 (Pacific Daylight Time)">14:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@hediet:matrix.org">Henning</span>&gt;</div></td><td class="msg-cell"><blockquote>
<p>don't you lose if you ever have to rerun that one derived that reads all the others</p>
</blockquote>
<p>Right, this would require a derived that does not need to resubscribe to all observables when it reruns.</p>
</td></tr>
  <tr class="msg" id="L27"><td class="ts-cell"><a class="ts" href="#L27" alt="Tue Apr 16 2024 07:57:37 GMT-0700 (Pacific Daylight Time)">14:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@hediet:matrix.org">Henning</span>&gt;</div></td><td class="msg-cell">Btw. our implementation has a different problem (which I guess mobx also has):
When a source observable is changed, where n deriveds depend on it transitively, then updating that source observable is O(n), even if the change stops after the first derived.</td></tr>
  <tr class="msg" id="L28"><td class="ts-cell"><a class="ts" href="#L28" alt="Tue Apr 16 2024 08:11:24 GMT-0700 (Pacific Daylight Time)">15:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@shaylew:matrix.org">shaylew</span>&gt;</div></td><td class="msg-cell">y eah that's a thing; it seems pretty inescapable in lazy-deriveds systems. even when you rerun the minimal set of deriveds, you sometimes do more traversal/bookkeeping than would be ideal</td></tr>
  <tr class="msg" id="L29"><td class="ts-cell"><a class="ts" href="#L29" alt="Tue Apr 16 2024 08:12:52 GMT-0700 (Pacific Daylight Time)">15:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@shaylew:matrix.org">shaylew</span>&gt;</div></td><td class="msg-cell">"deep graph" "high fanout" "high fan-in" are the stress tests... along with maybe "toggling which nodes are observed" for systems that have that concept</td></tr>

</tbody></table></div></div></div>
</body></html>
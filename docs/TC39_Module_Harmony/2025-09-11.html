<!DOCTYPE html><html><head>
  <meta charset="UTF-8">
  <title>TC39 Module Harmony on 2025-09-11</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "TC39 Module Harmony";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">TC39 Module Harmony<br>2025-09-11<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2025-09-10" class="nav-link"><span>prev</span></a>
<a href="2025-09-12" class="nav-link"><span style="float:right">next</span></a>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">
<div class="rhs-header">
<span id="error" style="color: red; display:none">error</span>

<input type="text" id="query" size="25" placeholder="Search TC39 Module Harmony">
<a id="search-submit" class="button icon-link" title="Search">
  <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"></path></svg>
</a>
</div>

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Wed Sep 10 2025 20:34:49 GMT-0700 (Pacific Daylight Time)">03:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@guybedford:matrix.org">guybedford</span>&gt;</div></td><td class="msg-cell">seems there was a pretty critical oversight in the type css import spec - <a href="https://github.com/whatwg/html/issues/11629">https://github.com/whatwg/html/issues/11629</a></td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Wed Sep 10 2025 20:34:57 GMT-0700 (Pacific Daylight Time)">03:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@guybedford:matrix.org">guybedford</span>&gt;</div></td><td class="msg-cell">hopefully it gets corrected soon!</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Wed Sep 10 2025 20:35:23 GMT-0700 (Pacific Daylight Time)">03:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@guybedford:matrix.org">guybedford</span>&gt;</div></td><td class="msg-cell">see you all tomorrow</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Thu Sep 11 2025 09:02:09 GMT-0700 (Pacific Daylight Time)">16:02</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@nicolo-ribaudo:matrix.org">nicolo-ribaudo</span>&gt;</div></td><td class="msg-cell">Meeting time!</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Thu Sep 11 2025 14:28:56 GMT-0700 (Pacific Daylight Time)">21:28</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-11" title="@kriskowal:aelf.land">kriskowal</span>&gt;</div></td><td class="msg-cell"><span class="nick-9">nicolo-ribaudo</span> <span class="nick-2">guybedford</span> what’s the current deal for preserving the referrer of a module source if it’s transferred over post message to another worker, such that relative module specifiers converge on the same sources for shallow dependencies?</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Thu Sep 11 2025 14:30:23 GMT-0700 (Pacific Daylight Time)">21:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-11" title="@kriskowal:aelf.land">kriskowal</span>&gt;</div></td><td class="msg-cell">I assume it’s currently an implementation- or host-defined behavior backed by the host data internal slot, made transferrable of postmessage and structuredclone.</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Thu Sep 11 2025 14:34:07 GMT-0700 (Pacific Daylight Time)">21:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-11" title="@kriskowal:aelf.land">kriskowal</span>&gt;</div></td><td class="msg-cell">I’m mulling a mechanism to bind a module source to its specifier explicitly like <code>import(new ModuleSource('import "../x.js"'), { base: new URL('lib/y.js', import.meta.url).href })</code> or <code>import.source</code> with same args to avoid execution (and incidentally have a different module memo key)</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Thu Sep 11 2025 14:37:07 GMT-0700 (Pacific Daylight Time)">21:37</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-11" title="@kriskowal:aelf.land">kriskowal</span>&gt;</div></td><td class="msg-cell">@bakkot hinted that using dynamic import to bind sources was an option, given that we (including me) disfavor using the <code>ModuleSource</code> constructor. He was referring specifically to <code>importHook</code>, which doesn’t necessarily apply to the base module specifier but could. If the base specifier is currently an implementation specific detail that of transferrable module sources, given that it’s necessarily a serializable string, we could adopt it in 262 and bind it either way.</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Thu Sep 11 2025 15:12:53 GMT-0700 (Pacific Daylight Time)">22:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@guybedford:matrix.org">guybedford</span>&gt;</div></td><td class="msg-cell">It's just the baseURL property of the HTML module script here, which is separately serialized and deserialized when transferring a module script. Because the module script is [[HostDefined]] on the module record, both the record and its "HTML wrapper" of the module script get serialized together</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Thu Sep 11 2025 15:15:27 GMT-0700 (Pacific Daylight Time)">22:15</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-11" title="@kriskowal:aelf.land">kriskowal</span>&gt;</div></td><td class="msg-cell">Yeah, that’s what I recall. Thanks.</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Thu Sep 11 2025 15:15:30 GMT-0700 (Pacific Daylight Time)">22:15</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@guybedford:matrix.org">guybedford</span>&gt;</div></td><td class="msg-cell">I think indirection would be needed either through an instance or through another field to support configurable ids. Alternatively this could be done specifically at registry injection time i.e. return { id?, source } from the load hook</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Thu Sep 11 2025 15:16:42 GMT-0700 (Pacific Daylight Time)">22:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-11" title="@kriskowal:aelf.land">kriskowal</span>&gt;</div></td><td class="msg-cell">The <code>importHook</code> case is actually fine, because the hook is invoked knowing the cache key, which is the base specifier already.</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Thu Sep 11 2025 15:17:37 GMT-0700 (Pacific Daylight Time)">22:17</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-11" title="@kriskowal:aelf.land">kriskowal</span>&gt;</div></td><td class="msg-cell">The case of a <code>ModuleSource(text)</code> lifted from text is not really germane yet since we don’t have a lift-from-text, but I’m thinking ahead to how we bind that to the supplementary base/referrer.</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Thu Sep 11 2025 15:18:38 GMT-0700 (Pacific Daylight Time)">22:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-11" title="@kriskowal:aelf.land">kriskowal</span>&gt;</div></td><td class="msg-cell">It can’t be the <code>[[HostDefined]]</code> slot because we can’t stomp over origin metadata for purposes of CSP.</td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Thu Sep 11 2025 15:19:21 GMT-0700 (Pacific Daylight Time)">22:19</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-11" title="@kriskowal:aelf.land">kriskowal</span>&gt;</div></td><td class="msg-cell">So I think we just end up with a slot in 262 that tends to coïncide with information currently only in [[HostDefined]].</td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Thu Sep 11 2025 15:19:24 GMT-0700 (Pacific Daylight Time)">22:19</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@guybedford:matrix.org">guybedford</span>&gt;</div></td><td class="msg-cell">in the ModuleSource(text) case we might have more flexibility to override the baseURL actually since theres another field on the module script I added to track whether it is 'evalish' or not</td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Thu Sep 11 2025 15:19:43 GMT-0700 (Pacific Daylight Time)">22:19</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@guybedford:matrix.org">guybedford</span>&gt;</div></td><td class="msg-cell">so the baseURL is no longer a security check, but just for resolution at that point</td></tr>
  <tr class="msg" id="L17"><td class="ts-cell"><a class="ts" href="#L17" alt="Thu Sep 11 2025 15:20:07 GMT-0700 (Pacific Daylight Time)">22:20</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@guybedford:matrix.org">guybedford</span>&gt;</div></td><td class="msg-cell">it's more in the non-eval case that it's a csp concern to override, although I guess we could always just have two baseURLs as well - cspBaseURL and resolverBaseURL</td></tr>
  <tr class="msg" id="L18"><td class="ts-cell"><a class="ts" href="#L18" alt="Thu Sep 11 2025 15:20:34 GMT-0700 (Pacific Daylight Time)">22:20</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-11" title="@kriskowal:aelf.land">kriskowal</span>&gt;</div></td><td class="msg-cell">Alright, we agree up to this point and I think it’s just a flavor choice whether to bind the base with the ModuleSource constructor or <code>import.source</code>. I’m favoring <code>ModuleSource(text, { base })</code></td></tr>
  <tr class="msg" id="L19"><td class="ts-cell"><a class="ts" href="#L19" alt="Thu Sep 11 2025 15:21:15 GMT-0700 (Pacific Daylight Time)">22:21</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-11" title="@kriskowal:aelf.land">kriskowal</span>&gt;</div></td><td class="msg-cell">I think we agreed to have these separate a long while back.</td></tr>
  <tr class="msg" id="L20"><td class="ts-cell"><a class="ts" href="#L20" alt="Thu Sep 11 2025 15:21:25 GMT-0700 (Pacific Daylight Time)">22:21</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@guybedford:matrix.org">guybedford</span>&gt;</div></td><td class="msg-cell">I wonder if we allow <code>new ModuleSource(existingModuleSource, { base })</code> for "reassigning" the base</td></tr>
  <tr class="msg" id="L21"><td class="ts-cell"><a class="ts" href="#L21" alt="Thu Sep 11 2025 15:21:39 GMT-0700 (Pacific Daylight Time)">22:21</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@guybedford:matrix.org">guybedford</span>&gt;</div></td><td class="msg-cell">since <code>new ModuleSource()</code> is effectively the eval mode, that would bypass CSP concerns</td></tr>
  <tr class="msg" id="L22"><td class="ts-cell"><a class="ts" href="#L22" alt="Thu Sep 11 2025 15:21:43 GMT-0700 (Pacific Daylight Time)">22:21</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-11" title="@kriskowal:aelf.land">kriskowal</span>&gt;</div></td><td class="msg-cell">Yeah, that’s an option in my opinion.</td></tr>
  <tr class="msg" id="L23"><td class="ts-cell"><a class="ts" href="#L23" alt="Thu Sep 11 2025 15:22:15 GMT-0700 (Pacific Daylight Time)">22:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@guybedford:matrix.org">guybedford</span>&gt;</div></td><td class="msg-cell">I don't hate it either</td></tr>
  <tr class="msg" id="L24"><td class="ts-cell"><a class="ts" href="#L24" alt="Thu Sep 11 2025 15:22:43 GMT-0700 (Pacific Daylight Time)">22:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-11" title="@kriskowal:aelf.land">kriskowal</span>&gt;</div></td><td class="msg-cell">There are cases where relocating the base for a host-imported source is useful. Moddable uses them.</td></tr>
  <tr class="msg" id="L25"><td class="ts-cell"><a class="ts" href="#L25" alt="Thu Sep 11 2025 15:23:31 GMT-0700 (Pacific Daylight Time)">22:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-11" title="@kriskowal:aelf.land">kriskowal</span>&gt;</div></td><td class="msg-cell">For example, they often put a bunch of sources in ROM that are never executed in the initial realm but exist solely for mapping into a Compartment in different locations.</td></tr>
  <tr class="msg" id="L26"><td class="ts-cell"><a class="ts" href="#L26" alt="Thu Sep 11 2025 15:25:35 GMT-0700 (Pacific Daylight Time)">22:25</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@guybedford:matrix.org">guybedford</span>&gt;</div></td><td class="msg-cell">I guess my remaining question is how to square this with registry hooks - if the result of the hook can override the URL</td></tr>
  <tr class="msg" id="L27"><td class="ts-cell"><a class="ts" href="#L27" alt="Thu Sep 11 2025 15:25:53 GMT-0700 (Pacific Daylight Time)">22:25</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@guybedford:matrix.org">guybedford</span>&gt;</div></td><td class="msg-cell">maybe that's fine - the initial resolve picks a URL, the hook returns a module for that URL, the returned module overrides the URL</td></tr>
  <tr class="msg" id="L28"><td class="ts-cell"><a class="ts" href="#L28" alt="Thu Sep 11 2025 15:26:07 GMT-0700 (Pacific Daylight Time)">22:26</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-11" title="@kriskowal:aelf.land">kriskowal</span>&gt;</div></td><td class="msg-cell">That’s actually table stakes.</td></tr>
  <tr class="msg" id="L29"><td class="ts-cell"><a class="ts" href="#L29" alt="Thu Sep 11 2025 15:26:33 GMT-0700 (Pacific Daylight Time)">22:26</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-11" title="@kriskowal:aelf.land">kriskowal</span>&gt;</div></td><td class="msg-cell">There are lots of cases of aliasing, particularly through package.json exports/imports, where you import by one specifier and the module is executed from elsewhere.</td></tr>
  <tr class="msg" id="L30"><td class="ts-cell"><a class="ts" href="#L30" alt="Thu Sep 11 2025 15:27:04 GMT-0700 (Pacific Daylight Time)">22:27</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-11" title="@kriskowal:aelf.land">kriskowal</span>&gt;</div></td><td class="msg-cell">But some of those cases are trickier than others and there are a variety of ways to handle it.</td></tr>
  <tr class="msg" id="L31"><td class="ts-cell"><a class="ts" href="#L31" alt="Thu Sep 11 2025 15:27:10 GMT-0700 (Pacific Daylight Time)">22:27</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@guybedford:matrix.org">guybedford</span>&gt;</div></td><td class="msg-cell">the problem comes where the function is async - you would need the load hook to be sync with an async load - <code>load(url) -&gt; { url, promise&lt;ModuleSource&gt; }</code></td></tr>
  <tr class="msg" id="L32"><td class="ts-cell"><a class="ts" href="#L32" alt="Thu Sep 11 2025 15:27:27 GMT-0700 (Pacific Daylight Time)">22:27</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@guybedford:matrix.org">guybedford</span>&gt;</div></td><td class="msg-cell">async resolver <span class="nick-15">joyee</span> pointed out earlier is a real concern</td></tr>
  <tr class="msg" id="L33"><td class="ts-cell"><a class="ts" href="#L33" alt="Thu Sep 11 2025 15:28:06 GMT-0700 (Pacific Daylight Time)">22:28</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-11" title="@kriskowal:aelf.land">kriskowal</span>&gt;</div></td><td class="msg-cell">Yeah, the Compartment shim handles this case a bit more gracefully than that.</td></tr>
  <tr class="msg" id="L34"><td class="ts-cell"><a class="ts" href="#L34" alt="Thu Sep 11 2025 15:29:21 GMT-0700 (Pacific Daylight Time)">22:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@guybedford:matrix.org">guybedford</span>&gt;</div></td><td class="msg-cell">fwiw in the module source proposal, I never precluded { id, moduleSource } from allowing identity distinct from moduleSource, and did call this out in a slide</td></tr>
  <tr class="msg" id="L35"><td class="ts-cell"><a class="ts" href="#L35" alt="Thu Sep 11 2025 15:29:30 GMT-0700 (Pacific Daylight Time)">22:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-11" title="@kriskowal:aelf.land">kriskowal</span>&gt;</div></td><td class="msg-cell">The <code>importHook</code> can return a <code>ModuleSource</code>, and we’ve agreed that the <code>ModuleSource</code> carries a <code>base</code>. The Compartment is calling <code>importHook(specifier, options)</code> <em>after</em> creating an entry in the module map for the module record that the hook will fill, so cycles are handled.</td></tr>
  <tr class="msg" id="L36"><td class="ts-cell"><a class="ts" href="#L36" alt="Thu Sep 11 2025 15:30:12 GMT-0700 (Pacific Daylight Time)">22:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@guybedford:matrix.org">guybedford</span>&gt;</div></td><td class="msg-cell">could be a poor version of instance identity to allow { id?, moduleSource } where id defaults to moduleSource.baseURL when otherwise unprovided</td></tr>
  <tr class="msg" id="L37"><td class="ts-cell"><a class="ts" href="#L37" alt="Thu Sep 11 2025 15:30:48 GMT-0700 (Pacific Daylight Time)">22:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-11" title="@kriskowal:aelf.land">kriskowal</span>&gt;</div></td><td class="msg-cell">The <code>importHook</code> can also return a namespace or TBD a handle for a given module memo key (specifier, with options), to cover other cases.</td></tr>
  <tr class="msg" id="L38"><td class="ts-cell"><a class="ts" href="#L38" alt="Thu Sep 11 2025 15:32:16 GMT-0700 (Pacific Daylight Time)">22:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-11" title="@kriskowal:aelf.land">kriskowal</span>&gt;</div></td><td class="msg-cell">Again, I think the binding to ID is adequately solved by <code>new ModuleSource(source, { base })</code> so <code>importHook</code> just returns a source that might be bound to a different base. For the purposes of <code>importHook</code>, the identity of the module source instance is not taken into account. That’s only germane if you <code>import(source)</code>.</td></tr>
  <tr class="msg" id="L39"><td class="ts-cell"><a class="ts" href="#L39" alt="Thu Sep 11 2025 15:32:36 GMT-0700 (Pacific Daylight Time)">22:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@guybedford:matrix.org">guybedford</span>&gt;</div></td><td class="msg-cell">hmm I suppose <code>{ id, moduleSource }</code> is no different in ability than <code>new ModuleSource(moduleSource, { base })</code>, you're right ok I agree</td></tr>
  <tr class="msg" id="L40"><td class="ts-cell"><a class="ts" href="#L40" alt="Thu Sep 11 2025 15:33:03 GMT-0700 (Pacific Daylight Time)">22:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@guybedford:matrix.org">guybedford</span>&gt;</div></td><td class="msg-cell">the problem is just the async resolver though, if we want to permit sync pipelines</td></tr>
  <tr class="msg" id="L41"><td class="ts-cell"><a class="ts" href="#L41" alt="Thu Sep 11 2025 15:33:12 GMT-0700 (Pacific Daylight Time)">22:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-11" title="@kriskowal:aelf.land">kriskowal</span>&gt;</div></td><td class="msg-cell">That is, <code>import(specifier)</code> invokes <code>importHook</code> with a key based on the specifier and <code>import(source)</code> does not invoke <code>importHook</code> and uses the module source’s identity as the key in the module map.</td></tr>
  <tr class="msg" id="L42"><td class="ts-cell"><a class="ts" href="#L42" alt="Thu Sep 11 2025 15:33:57 GMT-0700 (Pacific Daylight Time)">22:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@guybedford:matrix.org">guybedford</span>&gt;</div></td><td class="msg-cell">agreed</td></tr>
  <tr class="msg" id="L43"><td class="ts-cell"><a class="ts" href="#L43" alt="Thu Sep 11 2025 15:34:07 GMT-0700 (Pacific Daylight Time)">22:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-11" title="@kriskowal:aelf.land">kriskowal</span>&gt;</div></td><td class="msg-cell">The Compartment shim handles synchronous pipelines with an <code>importNowHook</code> that is obliged to return synchronously.</td></tr>
  <tr class="msg" id="L44"><td class="ts-cell"><a class="ts" href="#L44" alt="Thu Sep 11 2025 15:35:15 GMT-0700 (Pacific Daylight Time)">22:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-11" title="@kriskowal:aelf.land">kriskowal</span>&gt;</div></td><td class="msg-cell">In the absence of an <code>importNowHook</code>, <code>importNow(specifier)</code> works only if the transitive dependencies have already been loaded. As <span class="nick-15">joyee</span> mentioned today, a host like Node.js can avoid the races by implementing <code>importNowHook</code> and not providing an async hook at all.</td></tr>
  <tr class="msg" id="L45"><td class="ts-cell"><a class="ts" href="#L45" alt="Thu Sep 11 2025 15:35:58 GMT-0700 (Pacific Daylight Time)">22:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-11" title="@kriskowal:aelf.land">kriskowal</span>&gt;</div></td><td class="msg-cell">But to cover the web and other environments, we have to provide the async loader path.</td></tr>
  <tr class="msg" id="L46"><td class="ts-cell"><a class="ts" href="#L46" alt="Thu Sep 11 2025 15:36:14 GMT-0700 (Pacific Daylight Time)">22:36</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-11" title="@kriskowal:aelf.land">kriskowal</span>&gt;</div></td><td class="msg-cell">As a baseline.</td></tr>
  <tr class="msg" id="L47"><td class="ts-cell"><a class="ts" href="#L47" alt="Thu Sep 11 2025 15:36:43 GMT-0700 (Pacific Daylight Time)">22:36</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@guybedford:matrix.org">guybedford</span>&gt;</div></td><td class="msg-cell">maybe we can discuss this more next time - but I still think it's nice to have a design that doesn't treat async and sync as separate whole implementations, but allows them to layer nicely</td></tr>
  <tr class="msg" id="L48"><td class="ts-cell"><a class="ts" href="#L48" alt="Thu Sep 11 2025 15:36:55 GMT-0700 (Pacific Daylight Time)">22:36</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@guybedford:matrix.org">guybedford</span>&gt;</div></td><td class="msg-cell">of course, that's not a strong requirement, but if it's possible it seems slightly preferable to me</td></tr>
  <tr class="msg" id="L49"><td class="ts-cell"><a class="ts" href="#L49" alt="Thu Sep 11 2025 15:37:22 GMT-0700 (Pacific Daylight Time)">22:37</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-11" title="@kriskowal:aelf.land">kriskowal</span>&gt;</div></td><td class="msg-cell">I agree. The question is possibility, given colored functions on the bottom.</td></tr>
  <tr class="msg" id="L50"><td class="ts-cell"><a class="ts" href="#L50" alt="Thu Sep 11 2025 15:37:44 GMT-0700 (Pacific Daylight Time)">22:37</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@guybedford:matrix.org">guybedford</span>&gt;</div></td><td class="msg-cell">well it makes for a colourful discussion</td></tr>
  <tr class="msg" id="L51"><td class="ts-cell"><a class="ts" href="#L51" alt="Thu Sep 11 2025 15:39:07 GMT-0700 (Pacific Daylight Time)">22:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-11" title="@kriskowal:aelf.land">kriskowal</span>&gt;</div></td><td class="msg-cell">It’s certainly possible to have async import fall through to the sync import if there’s a clear partition between synchronously and asynchronously loadable specifiers.</td></tr>
  <tr class="msg" id="L52"><td class="ts-cell"><a class="ts" href="#L52" alt="Thu Sep 11 2025 15:39:57 GMT-0700 (Pacific Daylight Time)">22:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@guybedford:matrix.org">guybedford</span>&gt;</div></td><td class="msg-cell">The more I think about it I actually really like <code>new ModuleSource(moduleSource, { base })</code> so far, and the way it fits into the proposal. ModuleSource constructor spec when!?</td></tr>
  <tr class="msg" id="L53"><td class="ts-cell"><a class="ts" href="#L53" alt="Thu Sep 11 2025 15:41:50 GMT-0700 (Pacific Daylight Time)">22:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-11" title="@kriskowal:aelf.land">kriskowal</span>&gt;</div></td><td class="msg-cell">Given the mood in the room, <code>ModuleSource(text)</code> might have to be in an Annex if anywhere.</td></tr>
  <tr class="msg" id="L54"><td class="ts-cell"><a class="ts" href="#L54" alt="Thu Sep 11 2025 15:42:09 GMT-0700 (Pacific Daylight Time)">22:42</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-11" title="@kriskowal:aelf.land">kriskowal</span>&gt;</div></td><td class="msg-cell">But <code>new ModuleSource(source, { base })</code> would not have to wait.</td></tr>
  <tr class="msg" id="L55"><td class="ts-cell"><a class="ts" href="#L55" alt="Thu Sep 11 2025 15:42:33 GMT-0700 (Pacific Daylight Time)">22:42</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@guybedford:matrix.org">guybedford</span>&gt;</div></td><td class="msg-cell">oh really? I wasn't aware there was still resistance to a new eval primitive</td></tr>
  <tr class="msg" id="L56"><td class="ts-cell"><a class="ts" href="#L56" alt="Thu Sep 11 2025 15:42:44 GMT-0700 (Pacific Daylight Time)">22:42</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-11" title="@kriskowal:aelf.land">kriskowal</span>&gt;</div></td><td class="msg-cell">The proposal I’m working with <span class="nick-12">Zb Tenerowicz (ZTZ/naugtur)</span> on does not rely on <code>new ModuleSource(text)</code> but our big motivating use case really benefits from it.</td></tr>
  <tr class="msg" id="L57"><td class="ts-cell"><a class="ts" href="#L57" alt="Thu Sep 11 2025 15:42:56 GMT-0700 (Pacific Daylight Time)">22:42</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@guybedford:matrix.org">guybedford</span>&gt;</div></td><td class="msg-cell">I mean, it already exists today with Blob, would just be much nicer to have a real representation</td></tr>
  <tr class="msg" id="L58"><td class="ts-cell"><a class="ts" href="#L58" alt="Thu Sep 11 2025 15:43:21 GMT-0700 (Pacific Daylight Time)">22:43</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-11" title="@kriskowal:aelf.land">kriskowal</span>&gt;</div></td><td class="msg-cell">“No new paths to evaluating text” was in the feedback at last plenary.</td></tr>
  <tr class="msg" id="L59"><td class="ts-cell"><a class="ts" href="#L59" alt="Thu Sep 11 2025 15:44:55 GMT-0700 (Pacific Daylight Time)">22:44</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@guybedford:matrix.org">guybedford</span>&gt;</div></td><td class="msg-cell">I see, I'd worry then if <code>new ModuleSource(source, { base })</code> could allow cross-agent violations between policies</td></tr>
  <tr class="msg" id="L60"><td class="ts-cell"><a class="ts" href="#L60" alt="Thu Sep 11 2025 15:45:03 GMT-0700 (Pacific Daylight Time)">22:45</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-11" title="@kriskowal:aelf.land">kriskowal</span>&gt;</div></td><td class="msg-cell">I was just lamenting the other day that a <code>gzip(Uint8Array)=&gt;Promise&lt;Uint8Array&gt;</code> function is trivialish on the current web and portable with Node.js but obligates the implementation to take a weird detour through <code>Blob</code> and <code>Response</code> with an arbitrary (<code>application/octet-stream</code> anyone?) MIME type.</td></tr>
  <tr class="msg" id="L61"><td class="ts-cell"><a class="ts" href="#L61" alt="Thu Sep 11 2025 15:46:13 GMT-0700 (Pacific Daylight Time)">22:46</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-11" title="@kriskowal:aelf.land">kriskowal</span>&gt;</div></td><td class="msg-cell">That’s interesting. I would expect a mechanism like <code>postMessage</code> to serialize both the CSP origin and import base separately and not be a problem for cross-agent enforcement.</td></tr>
  <tr class="msg" id="L62"><td class="ts-cell"><a class="ts" href="#L62" alt="Thu Sep 11 2025 15:46:40 GMT-0700 (Pacific Daylight Time)">22:46</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@guybedford:matrix.org">guybedford</span>&gt;</div></td><td class="msg-cell">right, so base is still required to be separate from the CSP-related baseURL, and we're back at two URLs on module scripts</td></tr>
  <tr class="msg" id="L63"><td class="ts-cell"><a class="ts" href="#L63" alt="Thu Sep 11 2025 15:46:49 GMT-0700 (Pacific Daylight Time)">22:46</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@guybedford:matrix.org">guybedford</span>&gt;</div></td><td class="msg-cell">well three with the responseURL</td></tr>
  <tr class="msg" id="L64"><td class="ts-cell"><a class="ts" href="#L64" alt="Thu Sep 11 2025 15:47:47 GMT-0700 (Pacific Daylight Time)">22:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-11" title="@kriskowal:aelf.land">kriskowal</span>&gt;</div></td><td class="msg-cell">This seems fine to me. Is that unpalatable?</td></tr>
  <tr class="msg" id="L65"><td class="ts-cell"><a class="ts" href="#L65" alt="Thu Sep 11 2025 15:47:59 GMT-0700 (Pacific Daylight Time)">22:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@guybedford:matrix.org">guybedford</span>&gt;</div></td><td class="msg-cell">I don't think so, it's just another pointer</td></tr>
  <tr class="msg" id="L66"><td class="ts-cell"><a class="ts" href="#L66" alt="Thu Sep 11 2025 15:48:26 GMT-0700 (Pacific Daylight Time)">22:48</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@guybedford:matrix.org">guybedford</span>&gt;</div></td><td class="msg-cell">but alternatively we could treat <code>new ModuleSource(source, { base })</code> as non-transferrable</td></tr>
  <tr class="msg" id="L67"><td class="ts-cell"><a class="ts" href="#L67" alt="Thu Sep 11 2025 15:49:54 GMT-0700 (Pacific Daylight Time)">22:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-11" title="@kriskowal:aelf.land">kriskowal</span>&gt;</div></td><td class="msg-cell">I can’t imagine why that would be better but it also wouldn’t impact any of the cases I’m concerned with.</td></tr>
  <tr class="msg" id="L68"><td class="ts-cell"><a class="ts" href="#L68" alt="Thu Sep 11 2025 15:50:13 GMT-0700 (Pacific Daylight Time)">22:50</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@guybedford:matrix.org">guybedford</span>&gt;</div></td><td class="msg-cell">also - if you don't need <code>new ModuleSource(text)</code> it might be an option to just permit <code>load -&gt; Promise&lt;{ id: string, module: ModuleSource }&gt;</code> to not have to spec the constructor</td></tr>
  <tr class="msg" id="L69"><td class="ts-cell"><a class="ts" href="#L69" alt="Thu Sep 11 2025 15:51:06 GMT-0700 (Pacific Daylight Time)">22:51</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@guybedford:matrix.org">guybedford</span>&gt;</div></td><td class="msg-cell">yeah it doesn't seem a major concern to me, just thinking it through as well. but these seem promising directions overall. please do feel free to ping me if I can help review</td></tr>
  <tr class="msg" id="L70"><td class="ts-cell"><a class="ts" href="#L70" alt="Thu Sep 11 2025 16:19:05 GMT-0700 (Pacific Daylight Time)">23:19</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">that was probably me and I do still have that opinion</td></tr>
  <tr class="msg" id="L71"><td class="ts-cell"><a class="ts" href="#L71" alt="Thu Sep 11 2025 16:19:09 GMT-0700 (Pacific Daylight Time)">23:19</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">I don't know if anyone else shares it though</td></tr>
  <tr class="msg" id="L72"><td class="ts-cell"><a class="ts" href="#L72" alt="Thu Sep 11 2025 16:20:17 GMT-0700 (Pacific Daylight Time)">23:20</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-11" title="@kriskowal:aelf.land">kriskowal</span>&gt;</div></td><td class="msg-cell">(We can make progress without <code>new ModuleSource(text)</code> but I prefer <code>new ModuleSource(sourceOrText, { base? })</code> because it would be more coherent in the preferred end state. It’s been tough, in the face of irreducible requirements, to keep the <code>importHook</code> return type simple.)</td></tr>
  <tr class="msg" id="L73"><td class="ts-cell"><a class="ts" href="#L73" alt="Thu Sep 11 2025 16:25:58 GMT-0700 (Pacific Daylight Time)">23:25</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-11" title="@kriskowal:aelf.land">kriskowal</span>&gt;</div></td><td class="msg-cell">I am hoping that, in the fullness of time, I can convince you that our carefully respecting CSP has your concerns covered, but until then, yours is an opinion I’m accommodating to the extent I can, at least, by factoring these proposals so that the concern is separable from others. For some environments, having the option of lifting text will be attractive, so having an annex to keep them aligned is an accommodation that might work for everyone.</td></tr>
  <tr class="msg" id="L74"><td class="ts-cell"><a class="ts" href="#L74" alt="Thu Sep 11 2025 16:26:26 GMT-0700 (Pacific Daylight Time)">23:26</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">I don't think anyone should respect CSP :P</td></tr>
  <tr class="msg" id="L75"><td class="ts-cell"><a class="ts" href="#L75" alt="Thu Sep 11 2025 16:26:42 GMT-0700 (Pacific Daylight Time)">23:26</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">(in the sense of, it is my opinion that it is a terrible specification, not in the sense of, we don't have to play by its rules)</td></tr>
  <tr class="msg" id="L76"><td class="ts-cell"><a class="ts" href="#L76" alt="Thu Sep 11 2025 16:26:49 GMT-0700 (Pacific Daylight Time)">23:26</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-11" title="@kriskowal:aelf.land">kriskowal</span>&gt;</div></td><td class="msg-cell">Well, <em>respect</em> in a sense.</td></tr>
  <tr class="msg" id="L77"><td class="ts-cell"><a class="ts" href="#L77" alt="Thu Sep 11 2025 16:31:23 GMT-0700 (Pacific Daylight Time)">23:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-11" title="@kriskowal:aelf.land">kriskowal</span>&gt;</div></td><td class="msg-cell">I too come from a camp that agrees that there are better ways to make the web safe than CSP, just not necessarily that SBOM provenance chains are always the best solution. Honestly, if CSP actually closed all exfiltration holes, I would consider it useful under certain circumstances.</td></tr>
  <tr class="msg" id="L78"><td class="ts-cell"><a class="ts" href="#L78" alt="Thu Sep 11 2025 16:33:40 GMT-0700 (Pacific Daylight Time)">23:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">Definitely useful under certain circumstances but they're mostly either "you are literally google" or "you are a single-team shop", which covers approximately 0% of the web</td></tr>
  <tr class="msg" id="L79"><td class="ts-cell"><a class="ts" href="#L79" alt="Thu Sep 11 2025 16:33:46 GMT-0700 (Pacific Daylight Time)">23:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">which reminds me I need to put together a talk on that subject...</td></tr>
  <tr class="msg" id="L80"><td class="ts-cell"><a class="ts" href="#L80" alt="Thu Sep 11 2025 16:34:02 GMT-0700 (Pacific Daylight Time)">23:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-11" title="@kriskowal:aelf.land">kriskowal</span>&gt;</div></td><td class="msg-cell">I’m prepared to clap.</td></tr>

</tbody></table></div></div></div>
</body></html>
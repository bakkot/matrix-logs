2023-08-01
[14:32:52.0555] <Kris Kowal>
This is the change that Caridy prepared https://tc39.es/proposal-compartments/0-module-and-module-source.html

[14:33:27.0918] <Kris Kowal>
My intention is to move this into a repository, but itâ€™s unclear to me whether we should factor this even finer before making one or more module harmony layers out of it.

[14:34:38.0305] <Kris Kowal>
Luca Casonato Would you like to see an attempt to carve off smaller proposals (in the spirit of making them importable into other proposals like expressions), like one for introducing the module instance concept without the Module constructor?


2023-08-02
[01:33:28.0330] <Luca Casonato>
Kris Kowal: I'd like to see a proposal / document that outlines the minimum shared `Module` between expressions, instance imports, and virtualisation. I _think_ this is:

```ts
interface Module {
  get source(): %AbstractModuleSource%;
}

const mod: Module; // could come from expression, instance import, or constructor

await import(mod); // these modules are importable
new Worker(mod); // or usable as the entrypoint to a Worker
self.postMessage(mod); // and structuredClonable (transferrable) to other contexts
```

[01:33:36.0902] <Luca Casonato>
 * Kris Kowal: I'd like to see a proposal / document that outlines the minimum shared `Module` between expressions, instance imports, and virtualisation. I _think_ this is:

```ts
class Module {
  get source(): %AbstractModuleSource%;
}

const mod: Module; // could come from expression, instance import, or constructor

await import(mod); // these modules are importable
new Worker(mod); // or usable as the entrypoint to a Worker
self.postMessage(mod); // and structuredClonable (transferrable) to other contexts
```

[01:34:08.0119] <Luca Casonato>
In essence, all the `Module` semantics minus actually getting ahold of a `Module` object

[01:34:59.0253] <Luca Casonato>
From there, we can pursue all three ways of getting ahold of a `Module` in parallel:
- expressions
- instance imports
- constructor (this one also introduces `ModuleSource`)

[01:35:42.0447] <Luca Casonato>
 * Kris Kowal: I'd like to see a proposal / document that outlines the minimum shared `Module` interface between expressions, instance imports, and virtualisation. I _think_ this is:

```ts
class Module {
  get source(): %AbstractModuleSource%;
}

const mod: Module; // could come from expression, instance import, or constructor

await import(mod); // these modules are importable
new Worker(mod); // or usable as the entrypoint to a Worker
self.postMessage(mod); // and structuredClonable (transferrable) to other contexts
```


2023-05-08
[13:26:21.0587] <Kris Kowal>
nicolo-ribaudo guybedford I just dropped a comment, but if discussion is warranted, I‚Äôm reminded that we at Agoric insist that all new intrinsics be reachable from globalThis by transitive property walk, until another proposal advances far enough that we‚Äôre confident we can reach all intrinsics another way.

[13:27:44.0339] <Kris Kowal>
So, I suggest keeping globalThis.ModuleSource in Import Parse Phases even if it‚Äôs otherwise inert. It also serves as the anchor for ljharb‚Äôs brand check accessor in environments in which `WebAssembly.Module` does not exist.

[13:28:10.0473] <Kris Kowal>
So it would not be constructible but would not be useless.

[13:31:49.0034] <littledan>
What does this mean?
"Phase syntax by convention,
not specification"

[13:31:57.0113] <littledan>
(from Lucas&Guy's slides)

[13:34:41.0354] <Kris Kowal>
My team also just let me know while I was away that they wouldn‚Äôt object to `import.source`, `import.module`, &c syntax even though it would break old versions of our SES lockdown shim, but we also won‚Äôt push for a change on the eve of a call for stage 3.

[13:35:09.0806] <Kris Kowal>
 * My team also just let me know while I was away that they decided that they wouldn‚Äôt object to `import.source`, `import.module`, &c syntax even though it would break old versions of our SES lockdown shim, but we also won‚Äôt push for a change on the eve of a call for stage 3.

[13:35:16.0025] <littledan>
I significantly prefer the syntax in the current proposal FWIW

[13:35:39.0056] <littledan>
but separately, didn't we want to provide some kind of access to AbstractModuleSource from the global?

[13:35:39.0866] <Kris Kowal>
I figured that it would be preferred. üëç

[13:37:06.0083] <Kris Kowal>
In the PR, Guy, Luca, and Nicol√≤ have been waffling on whether to have some kind of global access to `AbstractModuleRecord` and it hasn‚Äôt settled yet. https://github.com/tc39/proposal-import-reflection/pull/36

[13:38:21.0365] <Kris Kowal>
I erroneously stated no strong preference. We do want the new intrinsics to be accessible. I think the champions are otherwise on the fence at the moment.

[13:38:54.0707] <littledan>
tbh for something going to Stage 3, it'd be ideal if all the spec text landed by the agenda deadline

[13:39:17.0301] <Kris Kowal>
I also expect the problem to heal naturally when some subsequent proposal makes ModuleSource real.

[13:42:47.0233] <littledan>
For something to go to Stage 3, I'd hope the presentation also explains these sorts of details which are apparently still under debate (like sourceText vs @@toStringTag). Maybe this meeting should be more of a "call for final review"

[13:44:02.0589] <guybedford>
Kris Kowal: yes, at least if we ship Wasm first, then `WebAssembly.Module` will provide AbstractModuleSource reachability through the WebAssembly global.

[13:44:27.0745] <Kris Kowal>
Is WASM shipping in 262?

[13:44:57.0931] <Kris Kowal>
There will be environments in which WebAssembly will not exist but AbstractModuleSource will.


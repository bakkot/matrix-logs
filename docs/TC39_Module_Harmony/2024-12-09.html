<!DOCTYPE html><html><head>
  <title>TC39 Module Harmony on 2024-12-09</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "TC39 Module Harmony";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">TC39 Module Harmony<br>2024-12-09<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2024-11-28" class="nav-link"><span>prev</span></a>
<span style="float:right">next</span>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">
<div class="rhs-header">
<span id="error" style="color: red; display:none">error</span>

<input type="text" id="query" size="25" placeholder="Search TC39 Module Harmony">
<a id="search-submit" class="button icon-link" title="Search">
  <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"></path></svg>
</a>
</div>

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Mon Dec 09 2024 11:41:29 GMT-0800 (Pacific Standard Time)">19:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-11" title="@kriskowal:aelf.land">kriskowal</span>&gt;</div></td><td class="msg-cell"><p>At plenary, I invited <span class="nick-2">guybedford</span> and MarkM to add ESM Phase Import follow-up to the TG3 docket since that’s a venue we can all converge upon.</p>
<p>MarkM informs us out-of-band that he has a conflict this Wendesday. I will be available to do a warm-up on the topic and may have tentative slides for framing the implications, but this will not be the high-value meeting if you need to optimize your celendar.</p>
</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Mon Dec 09 2024 11:47:19 GMT-0800 (Pacific Standard Time)">19:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@guybedford:matrix.org">guybedford</span>&gt;</div></td><td class="msg-cell">I would be happy to start with an informal discussion on the topic, to follow-up with Mark's meeting in due course</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Mon Dec 09 2024 11:48:31 GMT-0800 (Pacific Standard Time)">19:48</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@guybedford:matrix.org">guybedford</span>&gt;</div></td><td class="msg-cell">I will also be on holiday after this until Jan so maybe we can schedule the main follow-up for Jan 8</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Mon Dec 09 2024 11:52:40 GMT-0800 (Pacific Standard Time)">19:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-11" title="@kriskowal:aelf.land">kriskowal</span>&gt;</div></td><td class="msg-cell">So it is written</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Mon Dec 09 2024 11:52:50 GMT-0800 (Pacific Standard Time)">19:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-11" title="@kriskowal:aelf.land">kriskowal</span>&gt;</div></td><td class="msg-cell">(On the agenda)</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Mon Dec 09 2024 12:11:41 GMT-0800 (Pacific Standard Time)">20:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-11" title="@kriskowal:aelf.land">kriskowal</span>&gt;</div></td><td class="msg-cell"><span class="nick-9">nicolo-ribaudo</span>: I believe an implication of ESM source phase imports merging in at 2.7 is that module sources + a dynamic import give you a capability to obtain the corresponding instance in the current realm. if/when we generalize this to evaluators or compartments, i think the champions will insist that the dynamic import behavior be scoped to the realm, compartment, or evaluators (what i’m calling the cohort). That seems to oblige us to entrain the notion of a realm-specific module map when or before we look at evaluators. Are there other motivations to absorb a module map in 262 (factoring it out of HTML).</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Mon Dec 09 2024 12:15:13 GMT-0800 (Pacific Standard Time)">20:15</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@nicolo-ribaudo:matrix.org">nicolo-ribaudo</span>&gt;</div></td><td class="msg-cell">My ideal spec shape would have a URL-&gt;source cohort-agnostic map in HTML, and a source-&gt;module per-cohort map in 262</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Mon Dec 09 2024 12:16:05 GMT-0800 (Pacific Standard Time)">20:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@nicolo-ribaudo:matrix.org">nicolo-ribaudo</span>&gt;</div></td><td class="msg-cell">Because I like leaving as little freedom to hosts as possible, without having to incorporate host-specific concepts in 262 to do so</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Mon Dec 09 2024 12:19:20 GMT-0800 (Pacific Standard Time)">20:19</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-11" title="@kriskowal:aelf.land">kriskowal</span>&gt;</div></td><td class="msg-cell">That would work and I agree. What would motivate that refactor?</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Mon Dec 09 2024 12:21:02 GMT-0800 (Pacific Standard Time)">20:21</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-11" title="@kriskowal:aelf.land">kriskowal</span>&gt;</div></td><td class="msg-cell">Just removing that degree of freedom seems likely to impact likelihood of correctness of frame to frame module source transfer in the implementation of ESM source phase imports as writ, assuming no further changes</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Mon Dec 09 2024 12:22:35 GMT-0800 (Pacific Standard Time)">20:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@littledan:matrix.org">littledan</span>&gt;</div></td><td class="msg-cell">URL+attribute -&gt; source I imagine</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Mon Dec 09 2024 12:23:16 GMT-0800 (Pacific Standard Time)">20:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@littledan:matrix.org">littledan</span>&gt;</div></td><td class="msg-cell">this change would be potentially observable because it would imply consistently doing the HTTP caching. When we looked into this around the time of import attributes, there was resistance to making that requirement, and an assertion that it was already happening "in practice" (due to unspecified things)</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Mon Dec 09 2024 12:23:38 GMT-0800 (Pacific Standard Time)">20:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@guybedford:matrix.org">guybedford</span>&gt;</div></td><td class="msg-cell">Interesting, that effectively makes Module Source Record the key, based on its own unique identity separate from ModuleSourcesEqual. That sounds like it could work!</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Mon Dec 09 2024 12:24:32 GMT-0800 (Pacific Standard Time)">20:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@guybedford:matrix.org">guybedford</span>&gt;</div></td><td class="msg-cell">it could be a bit finnecky ensuring sources are distinct for distinct URLs though eg same source text for a.js and b.js must be separate Module Source Records seems a bit confusing too...</td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Mon Dec 09 2024 12:24:39 GMT-0800 (Pacific Standard Time)">20:24</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@littledan:matrix.org">littledan</span>&gt;</div></td><td class="msg-cell">but because the caching isn't specified anywhere today, engines might feel the need to implement some sort of complicated multithreaded map, which could be expensive</td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Mon Dec 09 2024 12:26:04 GMT-0800 (Pacific Standard Time)">20:26</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@nicolo-ribaudo:matrix.org">nicolo-ribaudo</span>&gt;</div></td><td class="msg-cell">Presumably their [[HostDefined]] would be different (because it includes the URL), which explains why they are different records</td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Mon Dec 09 2024 12:27:29 GMT-0800 (Pacific Standard Time)">20:27</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@nicolo-ribaudo:matrix.org">nicolo-ribaudo</span>&gt;</div></td><td class="msg-cell">That missing caching is across multiple realms, right? An implementation doesn't need to cache more than today, but they'd need a way to say "if we had full caching, then these two sources would actually be a single source". But the proposal as it is today already does that </td></tr>
  <tr class="msg" id="L17"><td class="ts-cell"><a class="ts" href="#L17" alt="Mon Dec 09 2024 12:28:08 GMT-0800 (Pacific Standard Time)">20:28</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@littledan:matrix.org">littledan</span>&gt;</div></td><td class="msg-cell">yes, across realms (oh yeah that's single-threaded still)</td></tr>
  <tr class="msg" id="L18"><td class="ts-cell"><a class="ts" href="#L18" alt="Mon Dec 09 2024 12:28:37 GMT-0800 (Pacific Standard Time)">20:28</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@nicolo-ribaudo:matrix.org">nicolo-ribaudo</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> That would work and I agree. What would motivate that refactor?</blockquote></mx-reply><p>Is "I like it" a strong enough motivation? 😅</p>
<p>As long as this is entirely editorial, "it makes the spec behavior and requirements easier to understand" would be enough hopefully</p></td></tr>
  <tr class="msg" id="L19"><td class="ts-cell"><a class="ts" href="#L19" alt="Mon Dec 09 2024 12:28:46 GMT-0800 (Pacific Standard Time)">20:28</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@littledan:matrix.org">littledan</span>&gt;</div></td><td class="msg-cell">when does any of this have an observable effect? I guess when sharing the source to another same-origin iframe and observing that import() finds it in the cache?</td></tr>
  <tr class="msg" id="L20"><td class="ts-cell"><a class="ts" href="#L20" alt="Mon Dec 09 2024 12:29:21 GMT-0800 (Pacific Standard Time)">20:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@nicolo-ribaudo:matrix.org">nicolo-ribaudo</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> when does any of this have an observable effect? I guess when sharing the source to another same-origin iframe and observing that import() finds it in the cache?</blockquote></mx-reply>Yes this is the only case where we need to be careful as far as I know</td></tr>
  <tr class="msg" id="L21"><td class="ts-cell"><a class="ts" href="#L21" alt="Mon Dec 09 2024 12:29:24 GMT-0800 (Pacific Standard Time)">20:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-11" title="@kriskowal:aelf.land">kriskowal</span>&gt;</div></td><td class="msg-cell">The non-identity of namespaces for identical module sources over dynamic import in two frames makes the effect obserevable.</td></tr>
  <tr class="msg" id="L22"><td class="ts-cell"><a class="ts" href="#L22" alt="Mon Dec 09 2024 12:30:14 GMT-0800 (Pacific Standard Time)">20:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@littledan:matrix.org">littledan</span>&gt;</div></td><td class="msg-cell">this sounds reasonable to me--ultimately, that should key off the host-defined stuff. <em>but</em> engines will need to consistently, always cache those responses across realms, and I'm not sure whether they are 100% sure that they are doing this today.</td></tr>
  <tr class="msg" id="L23"><td class="ts-cell"><a class="ts" href="#L23" alt="Mon Dec 09 2024 12:30:46 GMT-0800 (Pacific Standard Time)">20:30</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@littledan:matrix.org">littledan</span>&gt;</div></td><td class="msg-cell">right, also just it executes the code 1 or 2 times</td></tr>
  <tr class="msg" id="L24"><td class="ts-cell"><a class="ts" href="#L24" alt="Mon Dec 09 2024 12:31:24 GMT-0800 (Pacific Standard Time)">20:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-11" title="@kriskowal:aelf.land">kriskowal</span>&gt;</div></td><td class="msg-cell">Do we have consensus in “both houses” that the observable effect I described above is implied by the 262 and web proposals collectively, such that an editorial refactor does not require a round at plenary?</td></tr>
  <tr class="msg" id="L25"><td class="ts-cell"><a class="ts" href="#L25" alt="Mon Dec 09 2024 12:31:44 GMT-0800 (Pacific Standard Time)">20:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@guybedford:matrix.org">guybedford</span>&gt;</div></td><td class="msg-cell">gotcha</td></tr>
  <tr class="msg" id="L26"><td class="ts-cell"><a class="ts" href="#L26" alt="Mon Dec 09 2024 12:33:01 GMT-0800 (Pacific Standard Time)">20:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@guybedford:matrix.org">guybedford</span>&gt;</div></td><td class="msg-cell">It seems 100% editorial to me</td></tr>
  <tr class="msg" id="L27"><td class="ts-cell"><a class="ts" href="#L27" alt="Mon Dec 09 2024 12:34:08 GMT-0800 (Pacific Standard Time)">20:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-11" title="@kriskowal:aelf.land">kriskowal</span>&gt;</div></td><td class="msg-cell">Good. Post-refactor, what key would dynamic import use to distinguish cohorts?</td></tr>
  <tr class="msg" id="L28"><td class="ts-cell"><a class="ts" href="#L28" alt="Mon Dec 09 2024 12:34:33 GMT-0800 (Pacific Standard Time)">20:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@nicolo-ribaudo:matrix.org">nicolo-ribaudo</span>&gt;</div></td><td class="msg-cell">The map would be per-cohort, and the cohort is captured by the dynamic import itself</td></tr>
  <tr class="msg" id="L29"><td class="ts-cell"><a class="ts" href="#L29" alt="Mon Dec 09 2024 12:34:56 GMT-0800 (Pacific Standard Time)">20:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@littledan:matrix.org">littledan</span>&gt;</div></td><td class="msg-cell">which part do you disagree with?</td></tr>
  <tr class="msg" id="L30"><td class="ts-cell"><a class="ts" href="#L30" alt="Mon Dec 09 2024 12:36:07 GMT-0800 (Pacific Standard Time)">20:36</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@nicolo-ribaudo:matrix.org">nicolo-ribaudo</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> this sounds reasonable to me--ultimately, that should key off the host-defined stuff. <em>but</em> engines will need to consistently, always cache those responses across realms, and I'm not sure whether they are 100% sure that they are doing this today.</blockquote></mx-reply>They probably can get away with a check inside the dynamic import code to "be careful" when the specifier is a source coming from a different realm, and put it in some separate map</td></tr>
  <tr class="msg" id="L31"><td class="ts-cell"><a class="ts" href="#L31" alt="Mon Dec 09 2024 12:36:53 GMT-0800 (Pacific Standard Time)">20:36</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-9" title="@nicolo-ribaudo:matrix.org">nicolo-ribaudo</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> The map would be per-cohort, and the cohort is captured by the dynamic import itself</blockquote></mx-reply>I mean: the compartment/realm/cohort is some spec record with the map in an internal slot</td></tr>
  <tr class="msg" id="L32"><td class="ts-cell"><a class="ts" href="#L32" alt="Mon Dec 09 2024 12:37:16 GMT-0800 (Pacific Standard Time)">20:37</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-11" title="@kriskowal:aelf.land">kriskowal</span>&gt;</div></td><td class="msg-cell">The current realm is a parameter of dynamic import. I’d be content with a spec fiction of a single table where the realm participates in a composite key.</td></tr>
  <tr class="msg" id="L33"><td class="ts-cell"><a class="ts" href="#L33" alt="Mon Dec 09 2024 12:37:46 GMT-0800 (Pacific Standard Time)">20:37</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@littledan:matrix.org">littledan</span>&gt;</div></td><td class="msg-cell">this sounds not totally trivial to get right</td></tr>
  <tr class="msg" id="L34"><td class="ts-cell"><a class="ts" href="#L34" alt="Mon Dec 09 2024 12:39:11 GMT-0800 (Pacific Standard Time)">20:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-11" title="@kriskowal:aelf.land">kriskowal</span>&gt;</div></td><td class="msg-cell">That is, if the cohorts are differentiated by the identity of each realm would work fine for every following plan I can imagine. Edit: I am not so sure of that 1realm:1cohort:1global correspondence in all possible futures.</td></tr>
  <tr class="msg" id="L35"><td class="ts-cell"><a class="ts" href="#L35" alt="Mon Dec 09 2024 12:55:06 GMT-0800 (Pacific Standard Time)">20:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@guybedford:matrix.org">guybedford</span>&gt;</div></td><td class="msg-cell">Every Module Source Record has a single [[Cohort]] field which in turn can point to its [[Realm]]. Then when using dynamic <code>import()</code> the [[Cohort]] is taken from the parent module's Module Source Record context. I think that should allow ECMA-262 to be fairly well-defined on these behaviours.</td></tr>

</tbody></table></div></div></div>
</body></html>
<!DOCTYPE html><html><head>
  <meta charset="UTF-8">
  <title>TC39 General on 2025-11-18</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "TC39 General";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">TC39 General<br>2025-11-18<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2025-11-14" class="nav-link"><span>prev</span></a>
<a href="2025-11-19" class="nav-link"><span style="float:right">next</span></a>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">
<div class="rhs-header">
<span id="error" style="color: red; display:none">error</span>

<input type="text" id="query" size="25" placeholder="Search TC39 General">
<a id="search-submit" class="button icon-link" title="Search">
  <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"></path></svg>
</a>
</div>

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Mon Nov 17 2025 17:06:41 GMT-0800 (Pacific Standard Time)">01:06</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@whosy:matrix.org">whosy</span>&gt;</div></td><td class="msg-cell">Maybe so.

I don't envy the work done by delegates. But I am a little jealous of the trip to Japan. It sounds like a lot of fun and I think I saw something about karaoke the other day..</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Mon Nov 17 2025 17:07:03 GMT-0800 (Pacific Standard Time)">01:07</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@whosy:matrix.org">whosy</span>&gt;</div></td><td class="msg-cell">When less busy I should seek guidance again regarding my proposal.</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Tue Nov 18 2025 04:35:19 GMT-0800 (Pacific Standard Time)">12:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@aapo.alasuutari:matrix.org">Aapo Alasuutari</span>&gt;</div></td><td class="msg-cell">Question regarding Atomics wait/waitAsync and notify: are these intended to be just fronts for a futex API, possibly backed by the OS, or is the WL locking supposed to give some guarantees on top?

There's an atomic read inside the critical section of DoWait that makes sense to me if it is intended to model the OS futex APIs possibly never suspending a thread if the futexword comparison with value fails immediately. But is that the intention, or am I completely lost?</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Tue Nov 18 2025 06:40:56 GMT-0800 (Pacific Standard Time)">14:40</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@aapo.alasuutari:matrix.org">Aapo Alasuutari</span>&gt;</div></td><td class="msg-cell">In effect what I guess I am asking is: is the critical section supposed to protect the buffer value / reading somehow as well? Looking at normal futex APIs it seems reasonable to implement the APIs using a native futex with the exception of the "fail-fast" path for waitAsync: using just futexes, the fail-fast read has to either be a separate atomic load before calling into a futex syscall, in which case it isn't done within the futex's critical section of course, or the main thread needs to spawn a separate thread for calling the syscall and then that thread needs to ... No, I guess it's just not really possible at all.</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Tue Nov 18 2025 06:42:36 GMT-0800 (Pacific Standard Time)">14:42</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@aapo.alasuutari:matrix.org">Aapo Alasuutari</span>&gt;</div></td><td class="msg-cell">Nevermind: it's possible with a parking lot futex but as far as I can tell, the futex still needs to be locked on a separate thread and the main thread would need to block until the futex thread confirms that it is going to sleep. That hardly seems like a "fail-fast" path.</td></tr>

</tbody></table></div></div></div>
</body></html>
<!DOCTYPE html><html><head>
  <title>TC39 General on 2022-12-31</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "TC39 General";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">TC39 General<br>2022-12-31<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2022-12-30" class="nav-link"><span>prev</span></a>
<a href="2023-01-02" class="nav-link"><span style="float:right">next</span></a>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">
<div class="rhs-header">
<span id="error" style="color: red; display:none">error</span>

<input type="text" id="query" size="25" placeholder="Search TC39 General">
<a id="search-submit" class="button icon-link" title="Search">
  <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"></path></svg>
</a>
</div>

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Fri Dec 30 2022 17:39:13 GMT-0800 (Pacific Standard Time)">01:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@jackworks:matrix.org">Jack Works</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> What is necessary for "compelling"? We've been using a non-portable node C++ addon for 5 years because this doesn't exist, does that count as a compelling reason?</blockquote></mx-reply>You need it so strongly and you need a hack in the engine to do that? That's a bit strange</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Fri Dec 30 2022 18:11:22 GMT-0800 (Pacific Standard Time)">02:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@me1000:matrix.org">Randy Luecke</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> You need it so strongly and you need a hack in the engine to do that? That's a bit strange</blockquote></mx-reply><p>Tolmasky (and I) work on a product where one of the major features is showing users their output values in a nice inspectable way. Basically any native object type (RegExp, Error, Promise, BooleanObject, NumberObject, etc) created in a different realm would be hard to identify without asking V8. You can see the high level problem here: <a href="https://runkit.com/me1000/63af94f29458cb00082a18e8">https://runkit.com/me1000/63af94f29458cb00082a18e8</a></p>
<p>Browsers don't have node's vm module of course, but realms exist in browsers too (iframes, windows, workers) and you can pass values between them, to say nothing of the ShadowRealm proposal.</p>
</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Fri Dec 30 2022 18:13:24 GMT-0800 (Pacific Standard Time)">02:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@kriskowal:matrix.org">Kris Kowal</span>&gt;</div></td><td class="msg-cell">It would be nice in general if a host program could inspect a guest program without effecting observable side-effects.</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Fri Dec 30 2022 18:26:47 GMT-0800 (Pacific Standard Time)">02:26</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@tolmasky:matrix.org">tolmasky</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">Jack Works</span>: I also wouldn't call it a hack to use public APIs of the engine to get this information. It is of course less ideal than being able to do it in language, especially considering that it seems to be more an accident of history which native objects can and can't be identified, especially considering almost all <em>can</em> be, with only seeming exceptions being Promise and Errors. I'd consider it "hackier" that this information is "leaked" by the language spec through various techniques (such as calling Boolean.prototype.toString(object) and detecting whether that throws an error), vs. the underlying engine's simple isBooleanObject() method). The fact that Array.isArray had to be introduced points to general utility here.</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Fri Dec 30 2022 18:29:19 GMT-0800 (Pacific Standard Time)">02:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@tolmasky:matrix.org">tolmasky</span>&gt;</div></td><td class="msg-cell">And to <span class="nick-16">Kris Kowal</span> 's point, its actually the case that Error and Promise <em>can</em> be identified, just not without triggering side effects (as mentioned above Promise.prototype.then.apply(object) can almost be used, but it changes the isHandled state, and structuredClone(object) instanceof Error can also <em>almost</em> be used, except structuredClone calls getters of the object and can thus change various things in the process)</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Fri Dec 30 2022 18:41:36 GMT-0800 (Pacific Standard Time)">02:41</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@tolmasky:matrix.org">tolmasky</span>&gt;</div></td><td class="msg-cell">I'd go so far as to argue that if you believe there is utility in "instanceof BuiltInType", then it should follow that a brand check is equally useful since "instanceof BuiltInType" immediately introduces the possibility of a bug if the object comes from another realm (a frequent occurrence in browsers where you have multiple window objects) -- this was the reason that Array.isArray was added in the first place, because "instanceof Array" would fail in those circumstances. Well... "instanceof Error", "instanceof RegExp", etc. etc. <em>still</em> fail under those circumstances. Not sure why individual cases need to be made for each of them. It is if nothing else very useful for making the simplest "in language" debug tools, like you find in code sandbox-type applications (of which there are many many, everything from the built-in consoles in browsers, to <a href="http://codesandbox.com">codesandbox.com</a>, to runkit, etc. etc.), all of which regularly deal with the state of js objects in a separate frame (and thus realm).</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Fri Dec 30 2022 22:57:18 GMT-0800 (Pacific Standard Time)">06:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@ljharb:matrix.org">ljharb</span>&gt;</div></td><td class="msg-cell">btw can someone explain to me why <code>Object.assign(new Float32Array(1), [2147483647])[0]</code> produces <code>2147483648</code>? 2147483647 is a 31 bit number so it doesn't <em>seem</em> like it'd be an overflow thing. (i'm sure the answer is "floating point" but id love a better explanation)</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Fri Dec 30 2022 22:58:55 GMT-0800 (Pacific Standard Time)">06:58</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-7" title="@devsnek:matrix.org">snek</span>&gt;</div></td><td class="msg-cell">just because an integer occupies n bits doesn't mean a float with that many bits can represent it</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Fri Dec 30 2022 22:59:33 GMT-0800 (Pacific Standard Time)">06:59</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-7" title="@devsnek:matrix.org">snek</span>&gt;</div></td><td class="msg-cell">for example, many integers greater than 2^53 in our float64s</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Fri Dec 30 2022 23:00:53 GMT-0800 (Pacific Standard Time)">07:00</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@ljharb:matrix.org">ljharb</span>&gt;</div></td><td class="msg-cell">ok, so it's not overflow exactly, it's just a gap that float32 can't represent?</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Fri Dec 30 2022 23:01:26 GMT-0800 (Pacific Standard Time)">07:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-7" title="@devsnek:matrix.org">snek</span>&gt;</div></td><td class="msg-cell">I would assume, I don't have any intuition of what values are representable by 32 bit floats</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Fri Dec 30 2022 23:01:33 GMT-0800 (Pacific Standard Time)">07:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@ljharb:matrix.org">ljharb</span>&gt;</div></td><td class="msg-cell">hmm, ok</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Fri Dec 30 2022 23:02:44 GMT-0800 (Pacific Standard Time)">07:02</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-7" title="@devsnek:matrix.org">snek</span>&gt;</div></td><td class="msg-cell">there are ways to validate that. for example you could convert the underlying buffer to Uint32, and increment it by 1 at a time to see what values come out in the float32</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Fri Dec 30 2022 23:05:23 GMT-0800 (Pacific Standard Time)">07:05</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@ljharb:matrix.org">ljharb</span>&gt;</div></td><td class="msg-cell">thanks, that makes sense</td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Fri Dec 30 2022 23:05:33 GMT-0800 (Pacific Standard Time)">07:05</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@ljharb:matrix.org">ljharb</span>&gt;</div></td><td class="msg-cell">2147483646 seems to be not representable either :-)</td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Fri Dec 30 2022 23:09:58 GMT-0800 (Pacific Standard Time)">07:09</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell"><span class="nick-6">ljharb</span>: max safe integer for 32-bit floats is 2**24</td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Fri Dec 30 2022 23:10:05 GMT-0800 (Pacific Standard Time)">07:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-6" title="@ljharb:matrix.org">ljharb</span>&gt;</div></td><td class="msg-cell">aha, thanks</td></tr>
  <tr class="msg" id="L17"><td class="ts-cell"><a class="ts" href="#L17" alt="Fri Dec 30 2022 23:10:07 GMT-0800 (Pacific Standard Time)">07:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell"><a href="https://en.wikipedia.org/wiki/Single-precision_floating-point_format#Precision_limitations_on_integer_values">https://en.wikipedia.org/wiki/Single-precision_floating-point_format#Precision_limitations_on_integer_values</a></td></tr>
  <tr class="msg" id="L18"><td class="ts-cell"><a class="ts" href="#L18" alt="Sat Dec 31 2022 12:02:26 GMT-0800 (Pacific Standard Time)">20:02</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@kriskowal:matrix.org">Kris Kowal</span>&gt;</div></td><td class="msg-cell">Yeah, floating point can express only as many integers as fit in the mantissa portion. Single precision floats are criminally smol. The neat thing about floats though is that they get one free bit of mantissa since the first bit is guaranteed to be 1! The microcontroller just always shifts it off when incrementing the mantissa. An optimization only possible in base 2.</td></tr>

</tbody></table></div></div></div>
</body></html>
<!DOCTYPE html><html><head>
  <title>TC39 General on 2021-06-14</title>
  <link rel="stylesheet" href="../style.css">
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">TC39 General<br>2021-06-14<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2021-06-13" class="nav-link"><span>prev</span></a>
<span style="float:right">next</span>
</div>
    
<ul class="room-list">
<li><a href="../TC39_Delegates/">TC39 Delegates</a></li>
<li><a href="../TC39_Editors/">TC39 Editors</a></li>
<li><a href="../TC39_General/" class="current-room">TC39 General</a></li>
<li><a href="../WHATWG/">WHATWG</a></li>
</ul>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs"><div class="log">
<table><tbody id="log-tbody">
  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Mon Jun 14 2021 00:33:42 GMT-0700 (Pacific Daylight Time)">07:33</a></td><td class="nick-cell">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</td><td class="msg-cell">some discussion from whatwg about exposing structured clone: <a href="https://github.com/whatwg/html/pull/3414#issuecomment-853998618">https://github.com/whatwg/html/pull/3414#issuecomment-853998618</a></td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Mon Jun 14 2021 01:11:58 GMT-0700 (Pacific Daylight Time)">08:11</a></td><td class="nick-cell">&lt;<span class="nick nick-9" title="@dereknongeneric:mozilla.org">DerekNonGeneric</span>&gt;</td><td class="msg-cell">funny, i was just reading the C++ impl in SM <a href="https://searchfox.org/mozilla-central/source/js/src/vm/StructuredClone.cpp">https://searchfox.org/mozilla-central/source/js/src/vm/StructuredClone.cpp</a></td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Mon Jun 14 2021 01:23:47 GMT-0700 (Pacific Daylight Time)">08:23</a></td><td class="nick-cell">&lt;<span class="nick nick-9" title="@dereknongeneric:mozilla.org">DerekNonGeneric</span>&gt;</td><td class="msg-cell">unclear if the ask is simply to expose <code>structuredClone(value, options)</code> or what else that might entail, but seems like it would be really handy for it to be available somehow <a href="https://whatpr.org/html/3414/structured-data.html#structured-cloning">https://whatpr.org/html/3414/structured-data.html#structured-cloning</a></td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Mon Jun 14 2021 08:25:26 GMT-0700 (Pacific Daylight Time)">15:25</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</td><td class="msg-cell">does anyone have recollection of a synchronous Promise introspection API? e.g. something that gives back stuff like <code>{ state: "fulfilled", value: ... }</code>?</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Mon Jun 14 2021 08:30:12 GMT-0700 (Pacific Daylight Time)">15:30</a></td><td class="nick-cell">&lt;<span class="nick nick-10" title="@yulia:mozilla.org">yulia</span>&gt;</td><td class="msg-cell">something like promise.isFulfilled or like getting the value back, or just introspection?</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Mon Jun 14 2021 08:30:21 GMT-0700 (Pacific Daylight Time)">15:30</a></td><td class="nick-cell">&lt;<span class="nick nick-10" title="@yulia:mozilla.org">yulia</span>&gt;</td><td class="msg-cell">i was talking earlier about a similar api with somemone</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Mon Jun 14 2021 08:30:33 GMT-0700 (Pacific Daylight Time)">15:30</a></td><td class="nick-cell">&lt;<span class="nick nick-10" title="@yulia:mozilla.org">yulia</span>&gt;</td><td class="msg-cell"> * i was talking earlier about a similar api with someone as an alternative for the deferred eval thing</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Mon Jun 14 2021 09:06:33 GMT-0700 (Pacific Daylight Time)">16:06</a></td><td class="nick-cell">&lt;<span class="nick nick-10" title="@dehrenberg:igalia.com">littledan</span>&gt;</td><td class="msg-cell"><span class="nick-10">yulia</span>: I think we tend to view this as violating some kind of fundamental principle</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Mon Jun 14 2021 09:09:47 GMT-0700 (Pacific Daylight Time)">16:09</a></td><td class="nick-cell">&lt;<span class="nick nick-10" title="@dehrenberg:igalia.com">littledan</span>&gt;</td><td class="msg-cell">maybe as part of <a href="https://w3ctag.github.io/promises-guide/">https://w3ctag.github.io/promises-guide/</a> but I'm not sure which part</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Mon Jun 14 2021 09:15:22 GMT-0700 (Pacific Daylight Time)">16:15</a></td><td class="nick-cell">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</td><td class="msg-cell">I vaguely recall something to this effect but can't find a proposal. Closest I can find is <a href="https://github.com/tc39/proposal-async-await/issues/16">https://github.com/tc39/proposal-async-await/issues/16</a> and some discussion in <a href="https://github.com/tc39/notes/blob/master/meetings/2015-07/july-30.md#64-advance-async-functions-to-stage-2">https://github.com/tc39/notes/blob/master/meetings/2015-07/july-30.md#64-advance-async-functions-to-stage-2</a></td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Mon Jun 14 2021 09:27:15 GMT-0700 (Pacific Daylight Time)">16:27</a></td><td class="nick-cell">&lt;<span class="nick nick-10" title="@dehrenberg:igalia.com">littledan</span>&gt;</td><td class="msg-cell">this was also discussed in the context of cancellable promises</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Mon Jun 14 2021 09:39:53 GMT-0700 (Pacific Daylight Time)">16:39</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</td><td class="msg-cell">i'm thinking of getting both state and value back</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Mon Jun 14 2021 09:40:16 GMT-0700 (Pacific Daylight Time)">16:40</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</td><td class="msg-cell">the specific context is application-level optimization opportunities to skip microtask ticks</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Mon Jun 14 2021 09:41:03 GMT-0700 (Pacific Daylight Time)">16:41</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</td><td class="msg-cell">my initial take was along the lines of what <span class="nick-10">littledan</span> said with violating some kind of anti-Zalgo principle</td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Mon Jun 14 2021 09:42:23 GMT-0700 (Pacific Daylight Time)">16:42</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</td><td class="msg-cell"><span class="nick-2">bakkot</span>: thanks for that thread, the reason that killed that transformation idea is exactly the motivation for wanting it</td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Mon Jun 14 2021 09:43:13 GMT-0700 (Pacific Daylight Time)">16:43</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</td><td class="msg-cell">though in this case, there's no problem in that the buck is passed to the application. it's up to the app to write stuff like <code>let x = promise.tryGet().state == "fulfilled" ? promise[inspectSymbol].value : await promise;</code></td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Mon Jun 14 2021 09:43:16 GMT-0700 (Pacific Daylight Time)">16:43</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</td><td class="msg-cell">err</td></tr>
  <tr class="msg" id="L17"><td class="ts-cell"><a class="ts" href="#L17" alt="Mon Jun 14 2021 09:43:25 GMT-0700 (Pacific Daylight Time)">16:43</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</td><td class="msg-cell"> * though in this case, there's no problem in that the buck is passed to the application. it's up to the app to write stuff like <code>let x = promise[inspectSymbol].state == "fulfilled" ? promise[inspectSymbol].value : await promise;</code></td></tr>
  <tr class="msg" id="L18"><td class="ts-cell"><a class="ts" href="#L18" alt="Mon Jun 14 2021 09:45:36 GMT-0700 (Pacific Daylight Time)">16:45</a></td><td class="nick-cell">&lt;<span class="nick nick-10" title="@yulia:mozilla.org">yulia</span>&gt;</td><td class="msg-cell">yeah this was my reaction as well, but this is what the write up was from that alternative: <a href="https://github.com/tc39/proposal-defer-import-eval/blob/main/alternatives.md#delegating-work-to-blocking-workers">https://github.com/tc39/proposal-defer-import-eval/blob/main/alternatives.md#delegating-work-to-blocking-workers</a></td></tr>
  <tr class="msg" id="L19"><td class="ts-cell"><a class="ts" href="#L19" alt="Mon Jun 14 2021 09:46:27 GMT-0700 (Pacific Daylight Time)">16:46</a></td><td class="nick-cell">&lt;<span class="nick nick-10" title="@yulia:mozilla.org">yulia</span>&gt;</td><td class="msg-cell">i forgot exactly what that looked like, but its a blocking api. I don't think it is realistic but it keeps coming up</td></tr>
  <tr class="msg" id="L20"><td class="ts-cell"><a class="ts" href="#L20" alt="Mon Jun 14 2021 09:47:51 GMT-0700 (Pacific Daylight Time)">16:47</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</td><td class="msg-cell">blocking seems different to me than this, which is fine with async waiting, but want to know when it would be wasteful</td></tr>
  <tr class="msg" id="L21"><td class="ts-cell"><a class="ts" href="#L21" alt="Mon Jun 14 2021 09:48:02 GMT-0700 (Pacific Daylight Time)">16:48</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</td><td class="msg-cell"> * blocking seems different to me than this, which is fine with async waiting, but wants to know when it would be wasteful</td></tr>
  <tr class="msg" id="L22"><td class="ts-cell"><a class="ts" href="#L22" alt="Mon Jun 14 2021 11:39:16 GMT-0700 (Pacific Daylight Time)">18:39</a></td><td class="nick-cell">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</td><td class="msg-cell">there was also <a href="https://github.com/tc39/proposal-atomics-wait-async/pull/30">https://github.com/tc39/proposal-atomics-wait-async/pull/30</a></td></tr>
  <tr class="msg" id="L23"><td class="ts-cell"><a class="ts" href="#L23" alt="Mon Jun 14 2021 11:39:46 GMT-0700 (Pacific Daylight Time)">18:39</a></td><td class="nick-cell">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</td><td class="msg-cell">I think for the vast majority of promises the single microtask tick is going to be irrelevant next to the time it takes for the promise to settle in the first place</td></tr>
  <tr class="msg" id="L24"><td class="ts-cell"><a class="ts" href="#L24" alt="Mon Jun 14 2021 11:48:24 GMT-0700 (Pacific Daylight Time)">18:48</a></td><td class="nick-cell">&lt;<span class="nick nick-7" title="@jamiebuilds:matrix.org">Jamie Kyle</span>&gt;</td><td class="msg-cell">Does having the state of the promise available synchronously have a huge benefit over checking it in one-tick: <a href="https://gist.github.com/jamiebuilds/44f469bece4d2c5b45daa3031e48232d">https://gist.github.com/jamiebuilds/44f469bece4d2c5b45daa3031e48232d</a></td></tr>
  <tr class="msg" id="L25"><td class="ts-cell"><a class="ts" href="#L25" alt="Mon Jun 14 2021 12:35:27 GMT-0700 (Pacific Daylight Time)">19:35</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</td><td class="msg-cell"><span class="nick-2">bakkot</span>: i agree with that intuition, that for the majority of cases it doesn't matter</td></tr>
  <tr class="msg" id="L26"><td class="ts-cell"><a class="ts" href="#L26" alt="Mon Jun 14 2021 12:35:49 GMT-0700 (Pacific Daylight Time)">19:35</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</td><td class="msg-cell"><span class="nick-2">bakkot</span>: i've gotten feedback from internal product teams that it very much does matter, to the extent that they're not using native Promises directly because of it</td></tr>
  <tr class="msg" id="L27"><td class="ts-cell"><a class="ts" href="#L27" alt="Mon Jun 14 2021 12:37:30 GMT-0700 (Pacific Daylight Time)">19:37</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</td><td class="msg-cell">and as you know, i have a soft spot for performance-driven features for minority power user apps :P</td></tr>
  <tr class="msg" id="L28"><td class="ts-cell"><a class="ts" href="#L28" alt="Mon Jun 14 2021 14:30:53 GMT-0700 (Pacific Daylight Time)">21:30</a></td><td class="nick-cell">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</td><td class="msg-cell">shu: unrelated, I'm thinking about proposing <code>ArrayBuffer.fromBase64</code> and <code>ArrayBuffer.prototype.toBase64</code>. thoughts?</td></tr>
  <tr class="msg" id="L29"><td class="ts-cell"><a class="ts" href="#L29" alt="Mon Jun 14 2021 14:32:43 GMT-0700 (Pacific Daylight Time)">21:32</a></td><td class="nick-cell">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</td><td class="msg-cell"> * <span class="nick-8">shu</span>: unrelated, I'm thinking about proposing <code>ArrayBuffer.fromBase64</code> and <code>ArrayBuffer.prototype.toBase64</code>. thoughts?</td></tr>
  <tr class="msg" id="L30"><td class="ts-cell"><a class="ts" href="#L30" alt="Mon Jun 14 2021 14:34:08 GMT-0700 (Pacific Daylight Time)">21:34</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</td><td class="msg-cell"><span class="nick-2">bakkot</span>: common, onerous enough to write in userland, not really any room for "innovation" or different ways to design it. ticks all the boxes for me for standardizing, i'm positive on it</td></tr>
  <tr class="msg" id="L31"><td class="ts-cell"><a class="ts" href="#L31" alt="Mon Jun 14 2021 14:34:38 GMT-0700 (Pacific Daylight Time)">21:34</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</td><td class="msg-cell">it's too bad we'll have competing conventions with TextEncoder/Decoder, but what you gonna do</td></tr>
  <tr class="msg" id="L32"><td class="ts-cell"><a class="ts" href="#L32" alt="Mon Jun 14 2021 14:35:22 GMT-0700 (Pacific Daylight Time)">21:35</a></td><td class="nick-cell">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</td><td class="msg-cell">those don't do base64 though</td></tr>
  <tr class="msg" id="L33"><td class="ts-cell"><a class="ts" href="#L33" alt="Mon Jun 14 2021 14:35:24 GMT-0700 (Pacific Daylight Time)">21:35</a></td><td class="nick-cell">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</td><td class="msg-cell">afaik</td></tr>
  <tr class="msg" id="L34"><td class="ts-cell"><a class="ts" href="#L34" alt="Mon Jun 14 2021 14:35:30 GMT-0700 (Pacific Daylight Time)">21:35</a></td><td class="nick-cell">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</td><td class="msg-cell">and aren't going to because base64 isn't text</td></tr>
  <tr class="msg" id="L35"><td class="ts-cell"><a class="ts" href="#L35" alt="Mon Jun 14 2021 14:35:49 GMT-0700 (Pacific Daylight Time)">21:35</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</td><td class="msg-cell">i know, i meant more like those are standalone classes, not methods</td></tr>
  <tr class="msg" id="L36"><td class="ts-cell"><a class="ts" href="#L36" alt="Mon Jun 14 2021 14:35:52 GMT-0700 (Pacific Daylight Time)">21:35</a></td><td class="nick-cell">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</td><td class="msg-cell">API surface convention</td></tr>
  <tr class="msg" id="L37"><td class="ts-cell"><a class="ts" href="#L37" alt="Mon Jun 14 2021 16:03:14 GMT-0700 (Pacific Daylight Time)">23:03</a></td><td class="nick-cell">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</td><td class="msg-cell">ah, sure</td></tr>
  <tr class="msg" id="L38"><td class="ts-cell"><a class="ts" href="#L38" alt="Mon Jun 14 2021 16:03:20 GMT-0700 (Pacific Daylight Time)">23:03</a></td><td class="nick-cell">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</td><td class="msg-cell">those are a weird convention though</td></tr>
</tbody></table>
</div></div></div>
</body></html>
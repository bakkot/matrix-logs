<!DOCTYPE html><html><head>
  <meta charset="UTF-8">
  <title>TC39 General on 2025-11-20</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "TC39 General";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">TC39 General<br>2025-11-20<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2025-11-19" class="nav-link"><span>prev</span></a>
<span style="float:right">next</span>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">
<div class="rhs-header">
<span id="error" style="color: red; display:none">error</span>

<input type="text" id="query" size="25" placeholder="Search TC39 General">
<a id="search-submit" class="button icon-link" title="Search">
  <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"></path></svg>
</a>
</div>

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Wed Nov 19 2025 18:18:08 GMT-0800 (Pacific Standard Time)">02:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-15" title="@whosy:matrix.org">whosy</span>&gt;</div></td><td class="msg-cell"><span class="nick-7">snek</span>:  Do you mean 3600JsÂ¯Â¹s?</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Wed Nov 19 2025 18:18:43 GMT-0800 (Pacific Standard Time)">02:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-7" title="@devsnek:matrix.org">snek</span>&gt;</div></td><td class="msg-cell">:&gt;</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Wed Nov 19 2025 23:02:02 GMT-0800 (Pacific Standard Time)">07:02</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@aapo.alasuutari:matrix.org">Aapo Alasuutari</span>&gt;</div></td><td class="msg-cell">Mmyup, I indeed just had a bug in my code and got quite confused about the incorrect description comment.</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Wed Nov 19 2025 23:12:58 GMT-0800 (Pacific Standard Time)">07:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@aapo.alasuutari:matrix.org">Aapo Alasuutari</span>&gt;</div></td><td class="msg-cell"><p>On a related note, the <code><a href="http://INTERPRETING.md">INTERPRETING.md</a></code> is a little out of date, eg. broadcast doesn't take or pass two parameters but instead just takes and passes a single SharedArrayBuffer between agents.</p>
<p>Also the document is seemingly missing a note about <code>setTimeout</code> which seems to be a requirement for a whopping three <code>waitAsync</code> tests. <code>atomicsHelper.js</code> does set up a custom <code>setTimeout</code> function if none exist in the global but that function is based on just <code>Promise.resolve().then(cb)</code>'ing recursively. That exercises the microtask queue until timeout, which means that the <code>Atomics.waitAsync</code> timeouts that the test is exercising do not get a chance to run (best as I can tell anyway). eg. Running the test in Node with the custom <code>setTimeout</code> function used unconditionally fails from a timeout.</p>
</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Wed Nov 19 2025 23:43:08 GMT-0800 (Pacific Standard Time)">07:43</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@aapo.alasuutari:matrix.org">Aapo Alasuutari</span>&gt;</div></td><td class="msg-cell"><a href="https://github.com/tc39/test262/pull/4692">https://github.com/tc39/test262/pull/4692</a>
<a href="https://github.com/tc39/test262/pull/4693">https://github.com/tc39/test262/pull/4693</a></td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Thu Nov 20 2025 07:15:13 GMT-0800 (Pacific Standard Time)">15:15</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-10" title="@jedel:matrix.org">Jedel</span>&gt;</div></td><td class="msg-cell"><mx-reply><blockquote> <p>On a related note, the <code><a href="http://INTERPRETING.md">INTERPRETING.md</a></code> is a little out of date, eg. broadcast doesn't take or pass two parameters but instead just takes and passes a single SharedArrayBuffer between agents.</p>
<p>Also the document is seemingly missing a note about <code>setTimeout</code> which seems to be a requirement for a whopping three <code>waitAsync</code> tests. <code>atomicsHelper.js</code> does set up a custom <code>setTimeout</code> function if none exist in the global but that function is based on just <code>Promise.resolve().then(cb)</code>'ing recursively. That exercises the microtask queue until timeout, which means that the <code>Atomics.waitAsync</code> timeouts that the test is exercising do not get a chance to run (best as I can tell anyway). eg. Running the test in Node with the custom <code>setTimeout</code> function used unconditionally fails from a timeout.</p>
</blockquote></mx-reply><blockquote>
<p>That exercises the microtask queue until timeout, which means that the Atomics.waitAsync timeouts that the test is exercising do not get a chance to run (best as I can tell anyway).</p>
</blockquote>
<p>Is that the correct behaviour? I would expect the event loop to interweave promise jobs with timeout jobs instead of trying to execute all pending promise jobs first</p>
</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Thu Nov 20 2025 09:42:19 GMT-0800 (Pacific Standard Time)">17:42</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@aclaymore:matrix.org">Ashley Claymore</span>&gt;</div></td><td class="msg-cell">That does sound like yes, those 3 tests do seem to rely on the host providing a event loop with a timeout event&nbsp;</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Thu Nov 20 2025 09:50:26 GMT-0800 (Pacific Standard Time)">17:50</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@aclaymore:matrix.org">Ashley Claymore</span>&gt;</div></td><td class="msg-cell">trying to emulate such an environment purely within 262 is naturally quite a challenge as the language does not have an event loop&nbsp;</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Thu Nov 20 2025 09:59:15 GMT-0800 (Pacific Standard Time)">17:59</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@aclaymore:matrix.org">Ashley Claymore</span>&gt;</div></td><td class="msg-cell">Maybe there is a way to avoid the setTimeout dependency, or mock it more faithfully using a subagent + broadcast - but that might mean the test uses the API under test to test that API ðŸŒ€</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Thu Nov 20 2025 13:32:11 GMT-0800 (Pacific Standard Time)">21:32</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@abotella:igalia.com">Andreu Botella (ðŸ•‘ JST, at TC39)</span>&gt;</div></td><td class="msg-cell">it's true that the JS spec doesn't specify anything about the ordering of promise jobs vs other kinds of jobs, but the HTML spec does say to run all of the "microtasks" (which include promise jobs) before any other kind of task</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Thu Nov 20 2025 13:54:01 GMT-0800 (Pacific Standard Time)">21:54</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@jasnell:matrix.org">James M Snell</span>&gt;</div></td><td class="msg-cell">Which is of itself rather difficult for anything outside of browsers to follow. It's going to be nearly impossible to get consistency with that for stuff that needs to run across multiple runtimes :-/</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Thu Nov 20 2025 13:54:30 GMT-0800 (Pacific Standard Time)">21:54</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@jasnell:matrix.org">James M Snell</span>&gt;</div></td><td class="msg-cell">node.js, for instance, of course drains next ticks before microtasks and runs immediates and timers on an entirely separate mechanism</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Thu Nov 20 2025 13:57:30 GMT-0800 (Pacific Standard Time)">21:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@abotella:igalia.com">Andreu Botella (ðŸ•‘ JST)</span>&gt;</div></td><td class="msg-cell">leaving next ticks aside, I don't think node.js is inconsistent with the HTML spec here, because in HTML tasks are not a single queue, they're multiple task queues and it's up to the browser to decide which queue the next task comes from</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Thu Nov 20 2025 13:58:58 GMT-0800 (Pacific Standard Time)">21:58</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@jasnell:matrix.org">James M Snell</span>&gt;</div></td><td class="msg-cell">Yeah, not inconsistent, just difficult at time to ensure the timing lines up</td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Thu Nov 20 2025 13:59:59 GMT-0800 (Pacific Standard Time)">21:59</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-3" title="@jasnell:matrix.org">James M Snell</span>&gt;</div></td><td class="msg-cell">it's an unfortunte sad reality that there's so much code out there... particularly in tests... that rely on assuming  strict ordering of timers and other tasks</td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Thu Nov 20 2025 14:57:33 GMT-0800 (Pacific Standard Time)">22:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-8" title="@shuyuguo:matrix.org">shu</span>&gt;</div></td><td class="msg-cell">am i still needed for atomics or no, seems like confusion was resolved</td></tr>

</tbody></table></div></div></div>
</body></html>
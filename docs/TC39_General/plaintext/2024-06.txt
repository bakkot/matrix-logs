2024-06-01
[17:02:03.0584] <jmdyck>
In general, the parser should, at any point, know the set of terminal symbols (input elements) that could validly occur next, given everything to the left. On the basis of that set, it can tell the lexer which InputElementFoo nonterminal to use as the start symbol for the next input element.

[18:24:05.0343] <sirisian>
Thanks for all that information. That helps clarify things for me.

[04:50:56.0070] <jmdyck>
A different formulation would have the parser, at each point, tell the lexer all the terminal symbols that it's expecting, and ask for one of those. That would eliminate the InputElementFoo nonterminals and the rules about when each is appropriate, and a few other nonterminals like CommonToken. So simpler in some sense. But the current formulation minimizes the information that goes from the parser to the lexer, so simpler in a different sense.


2024-06-05
[15:55:17.0220] <whosy>
I wonder if there's any want for a `Promise.sleep( duration )`. I find myself writing one-liners for this in many a project.
e.g.
`const sleep = durationMs => new Promise( resolve => setTimeout( resolve, durationMs ) );`

[15:58:52.0861] <James M Snell>
> <@whosy:matrix.org> I wonder if there's any want for a `Promise.sleep( duration )`. I find myself writing one-liners for this in many a project.
> e.g.
> `const sleep = durationMs => new Promise( resolve => setTimeout( resolve, durationMs ) );`

There are already solutions for this. scheduler.wait is mostly this. Node.js has timers/promises, etc. Given that timers tend to be implementation specific, it's likely best left as a web platform API 

[16:02:47.0786] <whosy>
Might I ask what `schedular.wait` is?
 
And I really did mean as a simple shorthand for wrapping whatever native implementation of setTimeout is in a promise.

Though I guess that does leave a big question mark about what value is returned (if any). I am very green when it comes to actual implementations and the specification side of the language, by the way.

[16:04:55.0785] <James M Snell>
`scheduler.wait(...)` is defined https://github.com/WICG/scheduling-apis ... there's more to it but it essentially allows you to do `await scheduler.wait(duration)` 

[16:07:38.0109] <whosy>
Ah, I see. I couldn't find any reference to this when I tried a quick search for npm/JavaScript or the proposals listings.

It's an interesting read, and would definitely encompass this use-case.

[16:09:04.0518] <Chris de Almeida>
> <@whosy:matrix.org> I wonder if there's any want for a `Promise.sleep( duration )`. I find myself writing one-liners for this in many a project.
> e.g.
> `const sleep = durationMs => new Promise( resolve => setTimeout( resolve, durationMs ) );`

`setTimeout` is not part of JS

[16:12:06.0675] <Chris de Almeida>
the longer answer is that in order to get some flavor of `sleep()`, you would have to add various other things in the language first in order to support it

[16:12:32.0675] <whosy>
> <@softwarechris:matrix.org> `setTimeout` is not part of JS

Yes..that's something I only considered and realised after thinking about the differing return types across implementations. As I said in the thread now, I am very much not clued in on the language spec. I've mostly just used the language without considering its development until very recently.

But the lack of a spec-defined timing mechanism, I'm guessing is why the aforementioned Scheduler API is being developed?

[16:13:51.0441] <snek>
even if the core js language had timers, the web would still need a more complex scheduling api. you can read the details about that in the scheduling api readme

[16:15:43.0452] <Chris de Almeida>
I can't speak to the motivation of the folks that advanced Scheduler, but if you already have an environment where you have production-ready foundational components available, like timing, eventing, and cancellation, and that environment is the same one in which you want to have `sleep()`, then that seems like a faster path to that goal

[16:17:56.0442] <Chris de Almeida>
that doesn't mean it can't be pursued in the language, or that it's not still useful to add to the language

[16:20:50.0448] <bakkot>
I very much hope `scheduler.wait` does not become the way to do this, but it seems pretty likely unfortunately 

[16:21:25.0676] <bakkot>
we generally try to avoid duplicating things on the web platform, so if that ships it will not be in the language probably

[16:23:41.0732] <whosy>
> <@bakkot:matrix.org> we generally try to avoid duplicating things on the web platform, so if that ships it will not be in the language probably

That was my immediate concern as well. At this point the only way to avoid duplication is to adopt part of the spec into the language, or to try and rush through a proposal to the same effect faster than Scheduler.wait it can be adopted into major browsers.
Both of which have their own challenges and pitfalls..

[16:24:32.0596] <whosy>
Or I guess option 3, create a stage-0 proposal and just ask them very nicely to drop parts of their work which..I also don't see happening.

[16:29:12.0236] <whosy>
I am quite possibly the least qualified person to speak of what should or shouldn't be done here though, so I actually would love to hear the opinions of veterans on the matter.

[16:37:50.0855] <kriskowal>
> <@softwarechris:matrix.org> `setTimeout` is not part of JS

Me too, though I called it delay in Q, and the ocap folks (like me) would insist it go on a different namespace that the otherwise I/O free Promise since we prefer to be able to pass Promise into a compartment instead of an attenuated constructor


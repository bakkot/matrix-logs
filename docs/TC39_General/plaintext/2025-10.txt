2025-10-01
[09:16:25.0937] <nicolo-ribaudo>
Again

[09:17:01.0772] <nicolo-ribaudo>
bakkot ljharb 

[09:19:24.0300] <nicolo-ribaudo>
Maybe because I pushed a PR of mine that had the wrong version of the action?

[09:19:29.0054] <nicolo-ribaudo>
* Maybe because I pushed to a PR of mine that had the wrong version of the action?

[09:19:45.0524] <ljharb>
yes, that would do it - always rebase before pushing

[09:19:53.0976] <ljharb>
i'll fix the branch, one sec

[09:20:06.0900] <annevk>
But why run deploy from a PR?

[09:20:18.0018] <ljharb>
for PR previews. an older version of the action had a bug

[09:20:32.0586] <ljharb>
ok, give it a minute and the page should hopefully be fixed

[09:20:59.0507] <bakkot>
I will rename the script so this doesn't happen

[09:21:11.0885] <bakkot>
I wanted to do a better fix but haven't had time 

[09:21:13.0602] <nicolo-ribaudo>
I'm confused about how this can do it though. I don't have write permission to the repo, so what is in my fork shouldn't matteerr?

[09:21:23.0553] <nicolo-ribaudo>
* I'm confused about how this can do it though. I don't have write permission to the repo, so what is in my fork shouldn't matter?

[09:21:45.0953] <ljharb>
actions have that permission even if you don't

[09:22:03.0133] <ljharb>
* actions can have that permission even if you don't, i believe

[09:22:52.0893] <nicolo-ribaudo>
Oh I see, we run on `pull_request_target` but running the script from the PR branch and not the script committed in the target branch

[09:23:02.0822] <bakkot>
Yeah

[09:23:10.0926] <ljharb>
we could rename the secret and that'd fix it

[09:23:26.0871] <bakkot>
Renaming the script will also fix it

[09:23:46.0328] <bakkot>
Better fix is to use the build script from the main repo also but that takes more work

[09:23:56.0247] <bakkot>
and debugging github actions is very annoying so I haven't done it yet

[09:24:08.0072] <ljharb>
renaming the script would let someone add a workflow to their own PR and push anything they wanted up there, by adding the old script name

[09:24:10.0040] <bakkot>
* Better fix is to use the build/deploy scripts from the main repo also but that takes more work

[09:24:17.0104] <ljharb>
* renaming the script would let someone add a workflow to their own PR and push anything they wanted up there, by adding the old script name, no?

[09:24:22.0322] <nicolo-ribaudo>
For ecma426 we only checkout `spec.emu` and `img/` from the PR branch, and for the rest we use files on `main`: https://github.com/tc39/ecma426/blob/6f45f6fd5884424b5131e2709aff833fa3327e2e/.github/workflows/auto-publish.yml#L28

[09:24:27.0232] <ljharb>
* renaming the script would let someone add a workflow to their own PR and push anything they wanted up there, by adding the old script name, no? (if they targeted an old enough commit on main)

[09:24:31.0176] <bakkot>
script only runs for tc39 members or when explicitly requested by a maintainer

[09:24:50.0745] <bakkot>
I am not worried about tc39 members trying to mess with things

[09:25:20.0491] <ljharb>
fair

[09:25:49.0570] <bakkot>
we definitely want to use ecmarkup from the PR branch at least, because much of what previews are for is confirming ecmarkup updates worked as expected

[09:29:47.0392] <bakkot>
https://github.com/tc39/ecma262/pull/3697 for now


2025-10-02
[17:30:56.0824] <Richard Gibson>
fixing preview is on my list; the pattern that works is at https://github.com/tc39/template-for-proposals/tree/main/.github/workflows


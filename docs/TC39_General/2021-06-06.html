<!DOCTYPE html><html><head>
  <title>TC39 General on 2021-06-06</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "TC39 General";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">TC39 General<br>2021-06-06<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2021-06-05" class="nav-link"><span>prev</span></a>
<a href="2021-06-07" class="nav-link"><span style="float:right">next</span></a>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">
<div class="rhs-header">
<span id="error" style="color: red; display:none">error</span>
<input type="text" id="query" size="25" placeholder="Search TC39 General">
<a id="search-submit" class="button icon-link" title="Search">
  <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"></path></svg>
</a>
</div>

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Sat Jun 05 2021 18:38:48 GMT-0700 (Pacific Daylight Time)">01:38</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@jschoi:matrix.org">jschoi</span>&gt;</div></td><td class="msg-cell">* Property “names” probably would no longer be apt terminology; it could be more like <code>Object.getOwnPropertyKeys</code>.</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Sat Jun 05 2021 18:44:27 GMT-0700 (Pacific Daylight Time)">01:44</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@jschoi:matrix.org">jschoi</span>&gt;</div></td><td class="msg-cell">* Property “names” probably would no longer be apt terminology for non-string values; the method name could be like <code>Object.getOwnPropertyKeys</code>.</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Sat Jun 05 2021 18:44:45 GMT-0700 (Pacific Daylight Time)">01:44</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@jschoi:matrix.org">jschoi</span>&gt;</div></td><td class="msg-cell">* Property “names” probably would no longer be apt terminology for non-string keys; the method name could be like <code>Object.getOwnPropertyKeys</code>.</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Sat Jun 05 2021 21:33:36 GMT-0700 (Pacific Daylight Time)">04:33</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@loganfsmyth:mozilla.org">loganfsmyth</span>&gt;</div></td><td class="msg-cell">Anyone know what's going on here? Are we all misunderstanding? <a href="https://stackoverflow.com/questions/67855714/eval-declaration-instantiation-when-calling-context-is-evaluating-formal-param">https://stackoverflow.com/questions/67855714/eval-declaration-instantiation-when-calling-context-is-evaluating-formal-param</a></td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Sat Jun 05 2021 22:42:33 GMT-0700 (Pacific Daylight Time)">05:42</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell"><span class="nick-16">loganfsmyth</span>: that note became stale as of <a href="https://github.com/tc39/ecma262/pull/1046">https://github.com/tc39/ecma262/pull/1046</a></td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Sat Jun 05 2021 22:43:25 GMT-0700 (Pacific Daylight Time)">05:43</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">I suppose I'll open a PR</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Sat Jun 05 2021 22:44:57 GMT-0700 (Pacific Daylight Time)">05:44</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@loganfsmyth:mozilla.org">loganfsmyth</span>&gt;</div></td><td class="msg-cell">excellent, that makes sense</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Sat Jun 05 2021 22:48:11 GMT-0700 (Pacific Daylight Time)">05:48</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell"><a href="https://github.com/tc39/ecma262/pull/2428">https://github.com/tc39/ecma262/pull/2428</a></td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Sat Jun 05 2021 22:48:42 GMT-0700 (Pacific Daylight Time)">05:48</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell"><span class="nick-16">loganfsmyth</span>: You want to answer the stackoverflow question or shall I try to dig up my old account?</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Sat Jun 05 2021 22:50:01 GMT-0700 (Pacific Daylight Time)">05:50</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-16" title="@loganfsmyth:mozilla.org">loganfsmyth</span>&gt;</div></td><td class="msg-cell">I posted an answer, thanks!</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Sun Jun 06 2021 11:39:06 GMT-0700 (Pacific Daylight Time)">18:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell"><span class="nick-13">jmdyck</span>: re <a href="https://github.com/tc39/ecma262/issues/2400">https://github.com/tc39/ecma262/issues/2400</a>, you suggest replacing "Set the code evaluation state of contextA such that when evaluation is resumed with a Completion v [...]." with "Resume contextB passing B-VALUE. Let v be the value returned by the resumed computation."</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Sun Jun 06 2021 11:39:17 GMT-0700 (Pacific Daylight Time)">18:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell"> problem: it is not generally the case that contextB is the thing which resumes the thing just suspended.</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Sun Jun 06 2021 11:40:22 GMT-0700 (Pacific Daylight Time)">18:40</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">e.g., in Await, it's not contextB which does the resumption, but rather some future Await Fulfilled Function (or Await Rejected Function, of course)</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Sun Jun 06 2021 11:40:46 GMT-0700 (Pacific Daylight Time)">18:40</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">I'm trying to think of an alternative phrasing which avoids this, but haven't come up with anything I like yet</td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Sun Jun 06 2021 11:43:00 GMT-0700 (Pacific Daylight Time)">18:43</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@jmdyck:matrix.org">jmdyck</span>&gt;</div></td><td class="msg-cell">"the thing which resumes" present tense? I say that contextB is the execution context that most recently <em>resumed</em> the evaluation of contextA.</td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Sun Jun 06 2021 11:43:29 GMT-0700 (Pacific Daylight Time)">18:43</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell"><p>I'm focusing specifically on the step</p>
<blockquote>
<p>Resume contextB passing B-VALUE. Let v be the value returned by the resumed computation.</p>
</blockquote>
</td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Sun Jun 06 2021 11:43:52 GMT-0700 (Pacific Daylight Time)">18:43</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">to me, that step implies that contextB is going to be the thing which provides <em>v</em>.</td></tr>
  <tr class="msg" id="L17"><td class="ts-cell"><a class="ts" href="#L17" alt="Sun Jun 06 2021 11:44:18 GMT-0700 (Pacific Daylight Time)">18:44</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">and, by extension, is going to be the thing which <em>subsequently</em> resumes contextA.</td></tr>
  <tr class="msg" id="L18"><td class="ts-cell"><a class="ts" href="#L18" alt="Sun Jun 06 2021 11:46:44 GMT-0700 (Pacific Daylight Time)">18:46</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@jmdyck:matrix.org">jmdyck</span>&gt;</div></td><td class="msg-cell">Ah,okay. Well, it doesn't actually <em>say</em> that contextB will be returning v and resuming contextA, though that's what I would have thought.</td></tr>
  <tr class="msg" id="L19"><td class="ts-cell"><a class="ts" href="#L19" alt="Sun Jun 06 2021 11:47:55 GMT-0700 (Pacific Daylight Time)">18:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@jmdyck:matrix.org">jmdyck</span>&gt;</div></td><td class="msg-cell">I still don't grok Await machinery</td></tr>
  <tr class="msg" id="L20"><td class="ts-cell"><a class="ts" href="#L20" alt="Sun Jun 06 2021 11:49:54 GMT-0700 (Pacific Daylight Time)">18:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">It's not just Await; the same issue arises for plain generators. contextB is the <em>previous</em> caller of <code><a href="http://Generator.prototype.next">Generator.prototype.next</a></code>, whereas <em>v</em> is going to be provided by the <em>next</em> caller of <code><a href="http://Generator.prototype.next">Generator.prototype.next</a></code>.</td></tr>
  <tr class="msg" id="L21"><td class="ts-cell"><a class="ts" href="#L21" alt="Sun Jun 06 2021 11:51:29 GMT-0700 (Pacific Daylight Time)">18:51</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell"><p>Maybe something like</p>
<blockquote>
<ol>
<li>Resume contextB passing B-VALUE.</li>
<li>Assert: when control reaches here, contextA is once again the running execution context.</li>
<li>Let <em>v</em> be the value with which contextA was resumed.</li>
</ol>
</blockquote>
</td></tr>
  <tr class="msg" id="L22"><td class="ts-cell"><a class="ts" href="#L22" alt="Sun Jun 06 2021 11:51:32 GMT-0700 (Pacific Daylight Time)">18:51</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@jmdyck:matrix.org">jmdyck</span>&gt;</div></td><td class="msg-cell">and those can be 'in' different contexts (w plain generators)?</td></tr>
  <tr class="msg" id="L23"><td class="ts-cell"><a class="ts" href="#L23" alt="Sun Jun 06 2021 11:52:05 GMT-0700 (Pacific Daylight Time)">18:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">they are necessarily going to be in different contexts, since each call to <code>.next</code> (as with all function calls) creates and pushes a new context</td></tr>
  <tr class="msg" id="L24"><td class="ts-cell"><a class="ts" href="#L24" alt="Sun Jun 06 2021 11:53:01 GMT-0700 (Pacific Daylight Time)">18:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">I guess I ought to have said "contextB is the execution context of the previous call of <a href="http://Generator.prototype.next">Generator.prototype.next</a>", not "is the caller of"</td></tr>
  <tr class="msg" id="L25"><td class="ts-cell"><a class="ts" href="#L25" alt="Sun Jun 06 2021 11:53:07 GMT-0700 (Pacific Daylight Time)">18:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@jmdyck:matrix.org">jmdyck</span>&gt;</div></td><td class="msg-cell">sorry, i need to page this in</td></tr>
  <tr class="msg" id="L26"><td class="ts-cell"><a class="ts" href="#L26" alt="Sun Jun 06 2021 11:53:22 GMT-0700 (Pacific Daylight Time)">18:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@jmdyck:matrix.org">jmdyck</span>&gt;</div></td><td class="msg-cell">haven't thought about it for a while</td></tr>
  <tr class="msg" id="L27"><td class="ts-cell"><a class="ts" href="#L27" alt="Sun Jun 06 2021 11:58:02 GMT-0700 (Pacific Daylight Time)">18:58</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">Not to worry, lots to page in</td></tr>
  <tr class="msg" id="L28"><td class="ts-cell"><a class="ts" href="#L28" alt="Sun Jun 06 2021 11:58:19 GMT-0700 (Pacific Daylight Time)">18:58</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">I'll have a PR up in a bit</td></tr>
  <tr class="msg" id="L29"><td class="ts-cell"><a class="ts" href="#L29" alt="Sun Jun 06 2021 12:02:48 GMT-0700 (Pacific Daylight Time)">19:02</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@jmdyck:matrix.org">jmdyck</span>&gt;</div></td><td class="msg-cell">okay, i think i'm more or less up to speed</td></tr>
  <tr class="msg" id="L30"><td class="ts-cell"><a class="ts" href="#L30" alt="Sun Jun 06 2021 12:03:46 GMT-0700 (Pacific Daylight Time)">19:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@jmdyck:matrix.org">jmdyck</span>&gt;</div></td><td class="msg-cell">And yeah, the wording could be improved, but I'm not sure about your suggestion.</td></tr>
  <tr class="msg" id="L31"><td class="ts-cell"><a class="ts" href="#L31" alt="Sun Jun 06 2021 12:09:58 GMT-0700 (Pacific Daylight Time)">19:09</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@jmdyck:matrix.org">jmdyck</span>&gt;</div></td><td class="msg-cell">I think it needs to be clearer that the thread of control that performs the 'Resume' step has to then (suspend and) wait until <em>it</em> is Resumed (if ever), at which time a value (v) will be supplied.</td></tr>
  <tr class="msg" id="L32"><td class="ts-cell"><a class="ts" href="#L32" alt="Sun Jun 06 2021 12:10:44 GMT-0700 (Pacific Daylight Time)">19:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@jmdyck:matrix.org">jmdyck</span>&gt;</div></td><td class="msg-cell">Maybe it would suffice if we just defined 'Resume' somewhere.</td></tr>
  <tr class="msg" id="L33"><td class="ts-cell"><a class="ts" href="#L33" alt="Sun Jun 06 2021 12:12:42 GMT-0700 (Pacific Daylight Time)">19:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">There's always an explicit suspension before the Resume, which maybe makes it clearer?</td></tr>
  <tr class="msg" id="L34"><td class="ts-cell"><a class="ts" href="#L34" alt="Sun Jun 06 2021 12:13:08 GMT-0700 (Pacific Daylight Time)">19:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">Usually, but not quite always, immediately before the Resume</td></tr>
  <tr class="msg" id="L35"><td class="ts-cell"><a class="ts" href="#L35" alt="Sun Jun 06 2021 12:15:29 GMT-0700 (Pacific Daylight Time)">19:15</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">Actually that's maybe false?</td></tr>
  <tr class="msg" id="L36"><td class="ts-cell"><a class="ts" href="#L36" alt="Sun Jun 06 2021 12:16:10 GMT-0700 (Pacific Daylight Time)">19:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@jmdyck:matrix.org">jmdyck</span>&gt;</div></td><td class="msg-cell">Note that GeneratorResume, GeneratorResumeAbrupt , and AsyncGeneratorResumeNext use the "Resume ... Let" step format, although those are all going "the other way", right?</td></tr>
  <tr class="msg" id="L37"><td class="ts-cell"><a class="ts" href="#L37" alt="Sun Jun 06 2021 12:16:13 GMT-0700 (Pacific Daylight Time)">19:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">There's always an explicit "remove the current context from the stack", though</td></tr>
  <tr class="msg" id="L38"><td class="ts-cell"><a class="ts" href="#L38" alt="Sun Jun 06 2021 12:16:51 GMT-0700 (Pacific Daylight Time)">19:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">Yeah. For those it makes sense because it really is the execution which is Resumed which is providing the value.</td></tr>
  <tr class="msg" id="L39"><td class="ts-cell"><a class="ts" href="#L39" alt="Sun Jun 06 2021 12:19:37 GMT-0700 (Pacific Daylight Time)">19:19</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@jmdyck:matrix.org">jmdyck</span>&gt;</div></td><td class="msg-cell">Having the "Resume" and "Let" in the same step helps (to some extent) convey that the 'lifetime' of the step includes a resume-to-suspend chunk of execution of another thread of control.</td></tr>
  <tr class="msg" id="L40"><td class="ts-cell"><a class="ts" href="#L40" alt="Sun Jun 06 2021 12:20:56 GMT-0700 (Pacific Daylight Time)">19:20</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">now have a draft at <a href="https://github.com/tc39/ecma262/pull/2429">https://github.com/tc39/ecma262/pull/2429</a></td></tr>
  <tr class="msg" id="L41"><td class="ts-cell"><a class="ts" href="#L41" alt="Sun Jun 06 2021 12:21:22 GMT-0700 (Pacific Daylight Time)">19:21</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">I can see the case for having it be a single step, yeah. Hmm.</td></tr>
  <tr class="msg" id="L42"><td class="ts-cell"><a class="ts" href="#L42" alt="Sun Jun 06 2021 12:34:31 GMT-0700 (Pacific Daylight Time)">19:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@jmdyck:matrix.org">jmdyck</span>&gt;</div></td><td class="msg-cell">I have notes about suggesting an AO to have one place to clarify the semantics of transferring flow of control (suspend and resume).</td></tr>
  <tr class="msg" id="L43"><td class="ts-cell"><a class="ts" href="#L43" alt="Sun Jun 06 2021 12:36:09 GMT-0700 (Pacific Daylight Time)">19:36</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@jmdyck:matrix.org">jmdyck</span>&gt;</div></td><td class="msg-cell">Rather than having to convey it "inline" at each point where it occurs.</td></tr>
  <tr class="msg" id="L44"><td class="ts-cell"><a class="ts" href="#L44" alt="Sun Jun 06 2021 12:37:49 GMT-0700 (Pacific Daylight Time)">19:37</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@jmdyck:matrix.org">jmdyck</span>&gt;</div></td><td class="msg-cell">But I didn't want to pull that into 2400.</td></tr>
  <tr class="msg" id="L45"><td class="ts-cell"><a class="ts" href="#L45" alt="Sun Jun 06 2021 12:43:47 GMT-0700 (Pacific Daylight Time)">19:43</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@jmdyck:matrix.org">jmdyck</span>&gt;</div></td><td class="msg-cell">To the original point you raised, I could change "Let v be the value returned by the resumed computation." to something like "If <em>contextA</em> is ever resumed again, let <em>v</em> be the value supplied by the context that resumes it."</td></tr>
  <tr class="msg" id="L46"><td class="ts-cell"><a class="ts" href="#L46" alt="Sun Jun 06 2021 12:45:58 GMT-0700 (Pacific Daylight Time)">19:45</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@jmdyck:matrix.org">jmdyck</span>&gt;</div></td><td class="msg-cell">or maybe "... the value supplied at the time of resumption"</td></tr>
  <tr class="msg" id="L47"><td class="ts-cell"><a class="ts" href="#L47" alt="Sun Jun 06 2021 12:47:22 GMT-0700 (Pacific Daylight Time)">19:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">I am pretty indifferent between that and the wording I used in the PR, which is "the value with which it was resumed"</td></tr>
  <tr class="msg" id="L48"><td class="ts-cell"><a class="ts" href="#L48" alt="Sun Jun 06 2021 12:47:39 GMT-0700 (Pacific Daylight Time)">19:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@jmdyck:matrix.org">jmdyck</span>&gt;</div></td><td class="msg-cell">that's fine too.</td></tr>
  <tr class="msg" id="L49"><td class="ts-cell"><a class="ts" href="#L49" alt="Sun Jun 06 2021 12:47:43 GMT-0700 (Pacific Daylight Time)">19:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">I also changed all the places which do such a resumption to "Resume ... with <em>v</em>"</td></tr>
  <tr class="msg" id="L50"><td class="ts-cell"><a class="ts" href="#L50" alt="Sun Jun 06 2021 12:50:50 GMT-0700 (Pacific Daylight Time)">19:50</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">PrepareForTailCall is going to just remain incoherent, I guess</td></tr>
  <tr class="msg" id="L51"><td class="ts-cell"><a class="ts" href="#L51" alt="Sun Jun 06 2021 12:53:35 GMT-0700 (Pacific Daylight Time)">19:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@jmdyck:matrix.org">jmdyck</span>&gt;</div></td><td class="msg-cell">I've updated that comment in 2400.</td></tr>
  <tr class="msg" id="L52"><td class="ts-cell"><a class="ts" href="#L52" alt="Sun Jun 06 2021 13:10:01 GMT-0700 (Pacific Daylight Time)">20:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@jmdyck:matrix.org">jmdyck</span>&gt;</div></td><td class="msg-cell">I forget, where do you discuss PrepareForTailCall?</td></tr>
  <tr class="msg" id="L53"><td class="ts-cell"><a class="ts" href="#L53" alt="Sun Jun 06 2021 13:14:05 GMT-0700 (Pacific Daylight Time)">20:14</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">I don't</td></tr>
  <tr class="msg" id="L54"><td class="ts-cell"><a class="ts" href="#L54" alt="Sun Jun 06 2021 13:14:19 GMT-0700 (Pacific Daylight Time)">20:14</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">I've been ignoring it because it's obnoxious, basically</td></tr>
  <tr class="msg" id="L55"><td class="ts-cell"><a class="ts" href="#L55" alt="Sun Jun 06 2021 13:18:47 GMT-0700 (Pacific Daylight Time)">20:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">what it <em>wants</em> to say is, replace the current execution context with that of the new function, such that when you ultimately reach the Return algorithm step which would take you back to the <code>Let result be Call(...). Return result.</code> steps following this PrepareForTailCall, instead move control back to the most recent <code>Let result be OrdinaryCallEvaluateBody(...)</code> step, which is where the aforementioned <code>Return result.</code> step would have returned to</td></tr>
  <tr class="msg" id="L56"><td class="ts-cell"><a class="ts" href="#L56" alt="Sun Jun 06 2021 13:19:44 GMT-0700 (Pacific Daylight Time)">20:19</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">but the problem is that "that of the new function" isn't really coherent, and in fact not all function invocations push a new context as their first step - revoked proxies, in particular, do not</td></tr>
  <tr class="msg" id="L57"><td class="ts-cell"><a class="ts" href="#L57" alt="Sun Jun 06 2021 13:22:16 GMT-0700 (Pacific Daylight Time)">20:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">so, what PrepareForTailCall does instead is just pops the current execution context <em>without</em> transferring control back to the underlying context, and continues execution into Call. When Call returns, you are supposed to understand that this transfers control back to the step which did OrdinaryCallEvaluateBody.</td></tr>
  <tr class="msg" id="L58"><td class="ts-cell"><a class="ts" href="#L58" alt="Sun Jun 06 2021 13:22:55 GMT-0700 (Pacific Daylight Time)">20:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@jmdyck:matrix.org">jmdyck</span>&gt;</div></td><td class="msg-cell">"the new function" = the function passed to <code>Call</code> immediately after the invocation of PFTC?</td></tr>
  <tr class="msg" id="L59"><td class="ts-cell"><a class="ts" href="#L59" alt="Sun Jun 06 2021 13:23:28 GMT-0700 (Pacific Daylight Time)">20:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">right</td></tr>
  <tr class="msg" id="L60"><td class="ts-cell"><a class="ts" href="#L60" alt="Sun Jun 06 2021 13:47:21 GMT-0700 (Pacific Daylight Time)">20:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@jmdyck:matrix.org">jmdyck</span>&gt;</div></td><td class="msg-cell">This involves EvaluateCall's Assert "... the above call will not return here ..."?</td></tr>
  <tr class="msg" id="L61"><td class="ts-cell"><a class="ts" href="#L61" alt="Sun Jun 06 2021 13:52:51 GMT-0700 (Pacific Daylight Time)">20:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@jmdyck:matrix.org">jmdyck</span>&gt;</div></td><td class="msg-cell">So it's similar to what I complain about in 2400, where manipulating the context stack is supposed to change where an operation will return to.</td></tr>
  <tr class="msg" id="L62"><td class="ts-cell"><a class="ts" href="#L62" alt="Sun Jun 06 2021 14:07:14 GMT-0700 (Pacific Daylight Time)">21:07</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@jmdyck:matrix.org">jmdyck</span>&gt;</div></td><td class="msg-cell">Is tail-call optimization observable in the spec?</td></tr>
  <tr class="msg" id="L63"><td class="ts-cell"><a class="ts" href="#L63" alt="Sun Jun 06 2021 14:10:51 GMT-0700 (Pacific Daylight Time)">21:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@jmdyck:matrix.org">jmdyck</span>&gt;</div></td><td class="msg-cell">(I.e., did the addition of TailCall stuff to the spec change the behavior required of implementations?)</td></tr>
  <tr class="msg" id="L64"><td class="ts-cell"><a class="ts" href="#L64" alt="Sun Jun 06 2021 14:34:34 GMT-0700 (Pacific Daylight Time)">21:34</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">Theoretically, yes, although more as a matter of social consensus than as a question of what's actually clear from the written specification: the TailCall stuff is supposed to require that implementations implement proper tail calls.</td></tr>
  <tr class="msg" id="L65"><td class="ts-cell"><a class="ts" href="#L65" alt="Sun Jun 06 2021 14:35:21 GMT-0700 (Pacific Daylight Time)">21:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">i.e., to allow you to write code which depends on very deep recursion as long as each recursive call is in tail position</td></tr>
  <tr class="msg" id="L66"><td class="ts-cell"><a class="ts" href="#L66" alt="Sun Jun 06 2021 14:36:11 GMT-0700 (Pacific Daylight Time)">21:36</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">but since the spec as currently written does not have a notion of "running out of stack space", and since execution contexts are strictly a spec fiction, it's not entirely clear to me how the PrepareForTailCall stuff is supposed to require this</td></tr>
  <tr class="msg" id="L67"><td class="ts-cell"><a class="ts" href="#L67" alt="Sun Jun 06 2021 14:38:22 GMT-0700 (Pacific Daylight Time)">21:38</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">however, as a stupid and I think unintentional side effect, it also has an effect on the realm used for the TypeError produced when invoking a revoked proxy</td></tr>
  <tr class="msg" id="L68"><td class="ts-cell"><a class="ts" href="#L68" alt="Sun Jun 06 2021 14:38:59 GMT-0700 (Pacific Daylight Time)">21:38</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">when invoking such a proxy in tail position, that is</td></tr>
  <tr class="msg" id="L69"><td class="ts-cell"><a class="ts" href="#L69" alt="Sun Jun 06 2021 14:39:22 GMT-0700 (Pacific Daylight Time)">21:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">previously it had a similar effect on the realm of the TypeError produced when invoking a class as a function, but that changed with the merge of <a href="https://github.com/tc39/ecma262/pull/2216">https://github.com/tc39/ecma262/pull/2216</a>.</td></tr>
  <tr class="msg" id="L70"><td class="ts-cell"><a class="ts" href="#L70" alt="Sun Jun 06 2021 14:39:55 GMT-0700 (Pacific Daylight Time)">21:39</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">(there's still incorrect test262 tests about this which I haven't been able to work up the willpower to fix, given how inane this corner of the spec is: <a href="https://github.com/tc39/test262/issues/2978">https://github.com/tc39/test262/issues/2978</a> )</td></tr>
  <tr class="msg" id="L71"><td class="ts-cell"><a class="ts" href="#L71" alt="Sun Jun 06 2021 14:45:55 GMT-0700 (Pacific Daylight Time)">21:45</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@jmdyck:matrix.org">jmdyck</span>&gt;</div></td><td class="msg-cell"><blockquote>
<p>the spec as currently written does not have a notion of "running out of stack space", and ... execution contexts are strictly a spec fiction</p>
</blockquote>
<p>So the observable behavior exhibited by the spec model will be the same with or without the TailCall stuff, right?</p>
</td></tr>
  <tr class="msg" id="L72"><td class="ts-cell"><a class="ts" href="#L72" alt="Sun Jun 06 2021 14:48:43 GMT-0700 (Pacific Daylight Time)">21:48</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">Other than the bit about the realm for the TypeError when invoking a revoked proxy, yes.</td></tr>
  <tr class="msg" id="L73"><td class="ts-cell"><a class="ts" href="#L73" alt="Sun Jun 06 2021 14:49:02 GMT-0700 (Pacific Daylight Time)">21:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@jmdyck:matrix.org">jmdyck</span>&gt;</div></td><td class="msg-cell">right, sorry, that.</td></tr>
  <tr class="msg" id="L74"><td class="ts-cell"><a class="ts" href="#L74" alt="Sun Jun 06 2021 14:51:47 GMT-0700 (Pacific Daylight Time)">21:51</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">The idea is that, although we mostly pretend the spec is describing an abstract (and hence unbounded) machine, you are supposed to remember when looking at this part that in fact you are going to be running it on a real (and hence bounded) device, which means that execution contexts will correspond to some finite resource, and hence the requirement in PrepareForTailCall that you discard the old execution context before doing the tail call is supposed to be understood as a requirement that you do not consume more of said finite resource</td></tr>
  <tr class="msg" id="L75"><td class="ts-cell"><a class="ts" href="#L75" alt="Sun Jun 06 2021 14:52:03 GMT-0700 (Pacific Daylight Time)">21:52</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">But again this is a "social consensus" thing, not something which is actually present in the spec-as-written</td></tr>
  <tr class="msg" id="L76"><td class="ts-cell"><a class="ts" href="#L76" alt="Sun Jun 06 2021 14:56:11 GMT-0700 (Pacific Daylight Time)">21:56</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@jmdyck:matrix.org">jmdyck</span>&gt;</div></td><td class="msg-cell">It seems like it should have been possible to express the idea/requirement without making the spec incoherent.</td></tr>
  <tr class="msg" id="L77"><td class="ts-cell"><a class="ts" href="#L77" alt="Sun Jun 06 2021 14:57:40 GMT-0700 (Pacific Daylight Time)">21:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">I think it's possible that it's coherent if you have the right mental model of how execution contexts and "Return" work, I just don't know what that model is, and the spec does not lay it out</td></tr>
  <tr class="msg" id="L78"><td class="ts-cell"><a class="ts" href="#L78" alt="Sun Jun 06 2021 14:59:01 GMT-0700 (Pacific Daylight Time)">21:59</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@jmdyck:matrix.org">jmdyck</span>&gt;</div></td><td class="msg-cell">yeah, I tried to grasp something of that mental model in 2400.</td></tr>
  <tr class="msg" id="L79"><td class="ts-cell"><a class="ts" href="#L79" alt="Sun Jun 06 2021 14:59:57 GMT-0700 (Pacific Daylight Time)">21:59</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-13" title="@jmdyck:matrix.org">jmdyck</span>&gt;</div></td><td class="msg-cell">But I suspect there are parts of the spec that have a conflicting mental model.</td></tr>

</tbody></table></div></div></div>
</body></html>
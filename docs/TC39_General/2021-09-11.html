<!DOCTYPE html><html><head>
  <title>TC39 General on 2021-09-11</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "TC39 General";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">TC39 General<br>2021-09-11<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2021-09-10" class="nav-link"><span>prev</span></a>
<a href="2021-09-12" class="nav-link"><span style="float:right">next</span></a>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">
<div class="rhs-header">
<span id="error" style="color: red; display:none">error</span>
<input type="text" id="query" size="25" placeholder="Search TC39 General">
<a id="search-submit" class="button icon-link" title="Search">
  <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"></path></svg>
</a>
</div>

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Fri Sep 10 2021 19:18:47 GMT-0700 (Pacific Daylight Time)">02:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@devsnek:matrix.org">devsnek</span>&gt;</div></td><td class="msg-cell">bakkot i think u got a good solution to my question</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Fri Sep 10 2021 19:18:55 GMT-0700 (Pacific Daylight Time)">02:18</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@devsnek:matrix.org">devsnek</span>&gt;</div></td><td class="msg-cell">zip shortest + make everything except the first one infinite</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Fri Sep 10 2021 19:44:15 GMT-0700 (Pacific Daylight Time)">02:44</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell"><code>zip-longest</code> is actually the interesting one; my thing does not give you that unless you know up front which the longest one is</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Fri Sep 10 2021 19:57:04 GMT-0700 (Pacific Daylight Time)">02:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell"><p>shortest I can come up with in ten minutes is</p>
<pre><code>def zip_longest(*parts, fillvalue=None):
  sigil = {}
  return map(
    lambda p: tuple(map(lambda x: x if x is not sigil else fillvalue, p)),
    takewhile(
      lambda p: not (all(map(lambda x: x is sigil, p))),
      zip(*(chain(x, repeat(sigil)) for x in parts))
    )
  )
</code></pre>
<p>which... I guess it's straightforward enough, but I get why python decided that was worth putting in the standard library</p>
</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Sat Sep 11 2021 08:00:37 GMT-0700 (Pacific Daylight Time)">15:00</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@devsnek:matrix.org">devsnek</span>&gt;</div></td><td class="msg-cell">itertools docs has examples for how to implement the functions <a href="https://docs.python.org/3/library/itertools.html#itertools.zip_longest">https://docs.python.org/3/library/itertools.html#itertools.zip_longest</a></td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Sat Sep 11 2021 08:45:38 GMT-0700 (Pacific Daylight Time)">15:45</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">yeah but their implementation is an explicit loop, which is gross</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Sat Sep 11 2021 10:23:28 GMT-0700 (Pacific Daylight Time)">17:23</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@jschoi:matrix.org">jschoi</span>&gt;</div></td><td class="msg-cell">Has anyone thought about proposing a logical-xor operator <code>^^</code> to parallel bitwise xor <code>^</code>?</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Sat Sep 11 2021 10:25:38 GMT-0700 (Pacific Daylight Time)">17:25</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@jschoi:matrix.org">jschoi</span>&gt;</div></td><td class="msg-cell">It was asked for and talked about on the TypeScript side, where it was closed with “making new binary operators is TC39's job, not ours”. <a href="https://github.com/microsoft/TypeScript/issues/587">https://github.com/microsoft/TypeScript/issues/587</a></td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Sat Sep 11 2021 10:26:56 GMT-0700 (Pacific Daylight Time)">17:26</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell"><span class="nick-2">jschoi</span>: what's wrong with <code>!==</code>?</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Sat Sep 11 2021 10:27:25 GMT-0700 (Pacific Daylight Time)">17:27</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">obviously it doesn't do the type coercion for you but I would be very reluctant to introduce a new operator which is only necessary when you don't know the types of your variables</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Sat Sep 11 2021 10:27:33 GMT-0700 (Pacific Daylight Time)">17:27</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@jschoi:matrix.org">jschoi</span>&gt;</div></td><td class="msg-cell">Yep, that was brought up in the TypeScript issue too. My answer is: nothing! I’m not seriously considering it, but I am wondering if it was considered, especially given that the <code>^</code> punctuator might be used for other purposes in the future.</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Sat Sep 11 2021 10:28:46 GMT-0700 (Pacific Daylight Time)">17:28</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">I don't recall seeing a discussion; you could check the mailing list archives at <a href="http://esdiscuss.org/">esdiscuss.org/</a>, but I'd be surprised if there was any serious proposal put forward</td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Sat Sep 11 2021 10:29:40 GMT-0700 (Pacific Daylight Time)">17:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@jschoi:matrix.org">jschoi</span>&gt;</div></td><td class="msg-cell">Yeah, I couldn’t find anything on ESDiscuss. But it’s good to know that the temperature for a binary <code>^^</code> in TC39 is cold. The pipe operator might use <code>^</code>, after all, which would forever preclude a binary <code>^^</code>. Thank you!</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Sat Sep 11 2021 10:57:04 GMT-0700 (Pacific Daylight Time)">17:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@devsnek:matrix.org">devsnek</span>&gt;</div></td><td class="msg-cell"><span class="nick-2">bakkot</span>: it doesn't seem to me like the new tail call wording behaves well with the "caller realm" for eval</td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Sat Sep 11 2021 10:57:54 GMT-0700 (Pacific Daylight Time)">17:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@devsnek:matrix.org">devsnek</span>&gt;</div></td><td class="msg-cell">with the old wording the stack was popped, now it is not. which realm should it point to?</td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Sat Sep 11 2021 11:01:27 GMT-0700 (Pacific Daylight Time)">18:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell"><span class="nick-5">devsnek</span>: eval isn't a tail call anyway; I don't understand the question</td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Sat Sep 11 2021 11:01:42 GMT-0700 (Pacific Daylight Time)">18:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@devsnek:matrix.org">devsnek</span>&gt;</div></td><td class="msg-cell">wdym it isn't a tail call</td></tr>
  <tr class="msg" id="L17"><td class="ts-cell"><a class="ts" href="#L17" alt="Sat Sep 11 2021 11:01:50 GMT-0700 (Pacific Daylight Time)">18:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell"><a href="https://tc39.es/ecma262/#sec-function-calls-runtime-semantics-evaluation">https://tc39.es/ecma262/#sec-function-calls-runtime-semantics-evaluation</a></td></tr>
  <tr class="msg" id="L18"><td class="ts-cell"><a class="ts" href="#L18" alt="Sat Sep 11 2021 11:02:04 GMT-0700 (Pacific Daylight Time)">18:02</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">a direct eval doesn't go through the normal call semantics</td></tr>
  <tr class="msg" id="L19"><td class="ts-cell"><a class="ts" href="#L19" alt="Sat Sep 11 2021 11:02:11 GMT-0700 (Pacific Daylight Time)">18:02</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">it has its own branch, which doesn't include the tail call stuff</td></tr>
  <tr class="msg" id="L20"><td class="ts-cell"><a class="ts" href="#L20" alt="Sat Sep 11 2021 11:02:31 GMT-0700 (Pacific Daylight Time)">18:02</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@devsnek:matrix.org">devsnek</span>&gt;</div></td><td class="msg-cell">you can do <code>return (0, eval)()</code> though</td></tr>
  <tr class="msg" id="L21"><td class="ts-cell"><a class="ts" href="#L21" alt="Sat Sep 11 2021 11:03:24 GMT-0700 (Pacific Daylight Time)">18:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">oh, for indirect eval, sure</td></tr>
  <tr class="msg" id="L22"><td class="ts-cell"><a class="ts" href="#L22" alt="Sat Sep 11 2021 11:04:06 GMT-0700 (Pacific Daylight Time)">18:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@devsnek:matrix.org">devsnek</span>&gt;</div></td><td class="msg-cell">so its like 2nd to top or 3rd to top depending on if there's a tail call now</td></tr>
  <tr class="msg" id="L23"><td class="ts-cell"><a class="ts" href="#L23" alt="Sat Sep 11 2021 11:04:22 GMT-0700 (Pacific Daylight Time)">18:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">no, it's still the second to top</td></tr>
  <tr class="msg" id="L24"><td class="ts-cell"><a class="ts" href="#L24" alt="Sat Sep 11 2021 11:04:31 GMT-0700 (Pacific Daylight Time)">18:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">the realm is no longer the realm of the caller of the function containing the tail call</td></tr>
  <tr class="msg" id="L25"><td class="ts-cell"><a class="ts" href="#L25" alt="Sat Sep 11 2021 11:04:35 GMT-0700 (Pacific Daylight Time)">18:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">that was the point of the PR</td></tr>
  <tr class="msg" id="L26"><td class="ts-cell"><a class="ts" href="#L26" alt="Sat Sep 11 2021 11:04:42 GMT-0700 (Pacific Daylight Time)">18:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@devsnek:matrix.org">devsnek</span>&gt;</div></td><td class="msg-cell">?</td></tr>
  <tr class="msg" id="L27"><td class="ts-cell"><a class="ts" href="#L27" alt="Sat Sep 11 2021 11:04:59 GMT-0700 (Pacific Daylight Time)">18:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">the realm used for <code>g</code> in <code>function f(){ g() }</code> is the same as the realm for <code>g</code> in <code>function f(){ return g() }</code></td></tr>
  <tr class="msg" id="L28"><td class="ts-cell"><a class="ts" href="#L28" alt="Sat Sep 11 2021 11:05:09 GMT-0700 (Pacific Daylight Time)">18:05</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">that was the point of the PR</td></tr>
  <tr class="msg" id="L29"><td class="ts-cell"><a class="ts" href="#L29" alt="Sat Sep 11 2021 11:05:40 GMT-0700 (Pacific Daylight Time)">18:05</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@devsnek:matrix.org">devsnek</span>&gt;</div></td><td class="msg-cell">i'm not following</td></tr>
  <tr class="msg" id="L30"><td class="ts-cell"><a class="ts" href="#L30" alt="Sat Sep 11 2021 11:07:06 GMT-0700 (Pacific Daylight Time)">18:07</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">prior to #2495, when you had a <code>g</code> which could observe its callers realm, e.g. if <code>g</code> is a revoked proxy for a callable,<br>it would observe the realm of the caller of <code>f</code> in <code>function f(){ return g() }</code>, and now it observes the realm of <code>f</code> itself, just as for <code>function f(){ g() }</code></td></tr>
  <tr class="msg" id="L31"><td class="ts-cell"><a class="ts" href="#L31" alt="Sat Sep 11 2021 11:07:22 GMT-0700 (Pacific Daylight Time)">18:07</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@devsnek:matrix.org">devsnek</span>&gt;</div></td><td class="msg-cell">no i mean, if that's the case, isn't the assertion incorrect</td></tr>
  <tr class="msg" id="L32"><td class="ts-cell"><a class="ts" href="#L32" alt="Sat Sep 11 2021 11:07:29 GMT-0700 (Pacific Daylight Time)">18:07</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@devsnek:matrix.org">devsnek</span>&gt;</div></td><td class="msg-cell">since you are continuing to use information from it</td></tr>
  <tr class="msg" id="L33"><td class="ts-cell"><a class="ts" href="#L33" alt="Sat Sep 11 2021 11:08:29 GMT-0700 (Pacific Daylight Time)">18:08</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">eh, depends on what you consider "resources"</td></tr>
  <tr class="msg" id="L34"><td class="ts-cell"><a class="ts" href="#L34" alt="Sat Sep 11 2021 11:08:49 GMT-0700 (Pacific Daylight Time)">18:08</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">we have consensus for allowing cross-realm tail calls to consume resources anyway, we just never merged that change in to the spec (and I don't plan to)</td></tr>
  <tr class="msg" id="L35"><td class="ts-cell"><a class="ts" href="#L35" alt="Sat Sep 11 2021 11:10:28 GMT-0700 (Pacific Daylight Time)">18:10</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@devsnek:matrix.org">devsnek</span>&gt;</div></td><td class="msg-cell">it just weirds me out</td></tr>
  <tr class="msg" id="L36"><td class="ts-cell"><a class="ts" href="#L36" alt="Sat Sep 11 2021 11:11:45 GMT-0700 (Pacific Daylight Time)">18:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@devsnek:matrix.org">devsnek</span>&gt;</div></td><td class="msg-cell">and if we explicitly differentiate between implementation activations of functions and the execution context stack, why do we also have to duplicate the context in asyncfunctionstart</td></tr>
  <tr class="msg" id="L37"><td class="ts-cell"><a class="ts" href="#L37" alt="Sat Sep 11 2021 11:12:04 GMT-0700 (Pacific Daylight Time)">18:12</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@devsnek:matrix.org">devsnek</span>&gt;</div></td><td class="msg-cell">i feel like i'm missing a connection here or there is a mistake</td></tr>
  <tr class="msg" id="L38"><td class="ts-cell"><a class="ts" href="#L38" alt="Sat Sep 11 2021 11:13:06 GMT-0700 (Pacific Daylight Time)">18:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell"><blockquote>
<p>if we explicitly differentiate between implementation activations of functions</p>
</blockquote>
<p>I don't know what this means. the spec does not use the phrase "implementation activations of functions"</p>
</td></tr>
  <tr class="msg" id="L39"><td class="ts-cell"><a class="ts" href="#L39" alt="Sat Sep 11 2021 11:13:29 GMT-0700 (Pacific Daylight Time)">18:13</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@devsnek:matrix.org">devsnek</span>&gt;</div></td><td class="msg-cell"><blockquote>
For example, a tail position call should only grow an implementation's activation record stack by the amount that the size of the target function's activation record exceeds the size of the calling function's activation record. If the target function's activation record is smaller, then the total size of the stack should decrease.
</blockquote>
</td></tr>
  <tr class="msg" id="L40"><td class="ts-cell"><a class="ts" href="#L40" alt="Sat Sep 11 2021 11:14:01 GMT-0700 (Pacific Daylight Time)">18:14</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">that's in a non-normative note, which is talking about implementation strategies</td></tr>
  <tr class="msg" id="L41"><td class="ts-cell"><a class="ts" href="#L41" alt="Sat Sep 11 2021 11:14:29 GMT-0700 (Pacific Daylight Time)">18:14</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">there's no corresponding notion in the normative prose</td></tr>
  <tr class="msg" id="L42"><td class="ts-cell"><a class="ts" href="#L42" alt="Sat Sep 11 2021 11:15:46 GMT-0700 (Pacific Daylight Time)">18:15</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@devsnek:matrix.org">devsnek</span>&gt;</div></td><td class="msg-cell">i think the normative text was written with that model in mind</td></tr>
  <tr class="msg" id="L43"><td class="ts-cell"><a class="ts" href="#L43" alt="Sat Sep 11 2021 11:16:09 GMT-0700 (Pacific Daylight Time)">18:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@devsnek:matrix.org">devsnek</span>&gt;</div></td><td class="msg-cell">and it makes it weird</td></tr>
  <tr class="msg" id="L44"><td class="ts-cell"><a class="ts" href="#L44" alt="Sat Sep 11 2021 11:16:53 GMT-0700 (Pacific Daylight Time)">18:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">it was written with that model in mind, but it was extremely confused, because it was conflating that with transfers of control</td></tr>
  <tr class="msg" id="L45"><td class="ts-cell"><a class="ts" href="#L45" alt="Sat Sep 11 2021 11:16:58 GMT-0700 (Pacific Daylight Time)">18:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">now there is no such conflation; it is much better</td></tr>
  <tr class="msg" id="L46"><td class="ts-cell"><a class="ts" href="#L46" alt="Sat Sep 11 2021 11:19:35 GMT-0700 (Pacific Daylight Time)">18:19</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell"><p>re:</p>
<blockquote>
<p>why do we also have to duplicate the context in asyncfunctionstart</p>
</blockquote>
<p>it's so that when the topmost context suspends (that is, the body of the function does <code>await</code>), control will return (after a couple of intervening steps) to EvaluateAsyncFunctionBody step 5, which is the correct next step to evaluate</p>
</td></tr>
  <tr class="msg" id="L47"><td class="ts-cell"><a class="ts" href="#L47" alt="Sat Sep 11 2021 11:20:32 GMT-0700 (Pacific Daylight Time)">18:20</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">if we didn't push a new context the <code>await</code> would suspend the execution context which has EvaluateAsyncFunctionBody itself, which is no good</td></tr>
  <tr class="msg" id="L48"><td class="ts-cell"><a class="ts" href="#L48" alt="Sat Sep 11 2021 11:22:34 GMT-0700 (Pacific Daylight Time)">18:22</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-5" title="@devsnek:matrix.org">devsnek</span>&gt;</div></td><td class="msg-cell">yeah i know the reasoning there (we had to revert my pr remember?), my point was there seems to be disagreement about what thing is doing the evaluation of code. is the execution context metadata for the evaluation or does it represent the evaluation itself</td></tr>
  <tr class="msg" id="L49"><td class="ts-cell"><a class="ts" href="#L49" alt="Sat Sep 11 2021 11:28:30 GMT-0700 (Pacific Daylight Time)">18:28</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">from the spec's point of view, code is just another kind of data which gets passed around. the execution context stack represents some metadata which is tracked during evaluation - e.g. [[Realm]] - as well as representing nonlocal transfers of control within the spec [but n.b. this is within the <em>spec's abstract machine</em>, not within <em>ecmascript code</em>]: an execution context can be suspended-and-popped, which transfers control back to the step subsequent to the one which pushed it, and for execution contexts which have steps after the suspend-and-pop, at some future point it can be pushed-and-resumed and control will resume at the step subsequent to the suspend-and-pop.</td></tr>
  <tr class="msg" id="L50"><td class="ts-cell"><a class="ts" href="#L50" alt="Sat Sep 11 2021 11:29:43 GMT-0700 (Pacific Daylight Time)">18:29</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">I'm not sure if this answers "what thing is doing the evaluation of code", though. not sure if by "code" you mean ES code or the spec steps.</td></tr>
  <tr class="msg" id="L51"><td class="ts-cell"><a class="ts" href="#L51" alt="Sat Sep 11 2021 11:35:14 GMT-0700 (Pacific Daylight Time)">18:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">("execution contexts which have steps after the suspend-and-pop" is synonymous with "execution contexts which are created for the evaluation of generators/async functions/async generators/TLA modules", i.e., contexts which can use Yield or Await)</td></tr>
  <tr class="msg" id="L52"><td class="ts-cell"><a class="ts" href="#L52" alt="Sat Sep 11 2021 11:35:58 GMT-0700 (Pacific Daylight Time)">18:35</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">sometimes algorithms which do suspend-and-pop use Return to transfer control back to the previous execution context, which is very strange; see <a href="https://github.com/tc39/ecma262/issues/2400">https://github.com/tc39/ecma262/issues/2400</a> for discussion/a possible fix</td></tr>

</tbody></table></div></div></div>
</body></html>
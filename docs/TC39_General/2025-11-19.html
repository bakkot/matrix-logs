<!DOCTYPE html><html><head>
  <meta charset="UTF-8">
  <title>TC39 General on 2025-11-19</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "TC39 General";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">TC39 General<br>2025-11-19<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2025-11-18" class="nav-link"><span>prev</span></a>
<a href="2025-11-20" class="nav-link"><span style="float:right">next</span></a>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">
<div class="rhs-header">
<span id="error" style="color: red; display:none">error</span>

<input type="text" id="query" size="25" placeholder="Search TC39 General">
<a id="search-submit" class="button icon-link" title="Search">
  <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"></path></svg>
</a>
</div>

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Tue Nov 18 2025 22:16:09 GMT-0800 (Pacific Standard Time)">06:16</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@aapo.alasuutari:matrix.org">Aapo Alasuutari</span>&gt;</div></td><td class="msg-cell">Anyone have any idea regarding the wait(Async)/notify thing above? I'm planning on just writing my implementation as a Futex syscall wrapper, and thus doing the "fail-fast" path outside of the critical section. Of course, the syscall will also perform the same read inside its critical section (presumably) so rather than moving anything, I'm just adding an extra read of the SAB to check if a syscall should be made or not.</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Wed Nov 19 2025 12:54:43 GMT-0800 (Pacific Standard Time)">20:54</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@aapo.alasuutari:matrix.org">Aapo Alasuutari</span>&gt;</div></td><td class="msg-cell"><p>Uhh, am I crazy or is the <code>DoWait</code>'s timeout handling text just plain wrong? This is the text:</p>
<blockquote>
<ol start="8">
<li>Let q be ? ToNumber(timeout).</li>
<li>If q is either NaN or +‚àûùîΩ, let t be +‚àû; else if q is -‚àûùîΩ, let t be 0; else let t be max(‚Ñù(q), 0).</li>
</ol>
</blockquote>
<p>But then there's a bunch of tests testing that passing <code>undefined</code> as <code>timeout</code> coerces to 0. <code>ToNumber(undefined)</code> returns <code>NaN</code> so we should go into the first branch and set t as +‚àû.</p>
</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Wed Nov 19 2025 12:55:06 GMT-0800 (Pacific Standard Time)">20:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@aapo.alasuutari:matrix.org">Aapo Alasuutari</span>&gt;</div></td><td class="msg-cell">But presumably the tests are the correct source here.</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Wed Nov 19 2025 12:59:01 GMT-0800 (Pacific Standard Time)">20:59</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@aapo.alasuutari:matrix.org">Aapo Alasuutari</span>&gt;</div></td><td class="msg-cell"><a href="https://github.com/tc39/test262/blob/main/test/built-ins/Atomics/waitAsync/bigint/undefined-for-timeout.js">https://github.com/tc39/test262/blob/main/test/built-ins/Atomics/waitAsync/bigint/undefined-for-timeout.js</a>
<a href="https://github.com/tc39/test262/blob/main/test/built-ins/Atomics/waitAsync/undefined-for-timeout.js">https://github.com/tc39/test262/blob/main/test/built-ins/Atomics/waitAsync/undefined-for-timeout.js</a>
<a href="https://github.com/tc39/test262/blob/main/test/built-ins/Atomics/wait/undefined-for-timeout.js">https://github.com/tc39/test262/blob/main/test/built-ins/Atomics/wait/undefined-for-timeout.js</a></td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Wed Nov 19 2025 13:00:05 GMT-0800 (Pacific Standard Time)">21:00</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@aapo.alasuutari:matrix.org">Aapo Alasuutari</span>&gt;</div></td><td class="msg-cell">I guess it's just the few tests that are wrong after all.</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Wed Nov 19 2025 14:31:30 GMT-0800 (Pacific Standard Time)">22:31</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell"><span class="nick-8">shu</span> is the atomics person</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Wed Nov 19 2025 15:19:22 GMT-0800 (Pacific Standard Time)">23:19</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell"><span class="nick-4">Aapo Alasuutari</span>: It looks to me like the tests are correct except for the description comment. Note that the text you quote is also summarized in the tests (eg <a href="https://github.com/tc39/test262/blob/main/test/built-ins/Atomics/wait/undefined-for-timeout.js#L11-L14">here</a>). If the last argument is undefined, the intended behaviour is to not set a timeout; that's what's being tested.</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Wed Nov 19 2025 15:20:08 GMT-0800 (Pacific Standard Time)">23:20</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@iain:mozilla.org">iain</span>&gt;</div></td><td class="msg-cell">So basically I think the only problem is that <a href="https://github.com/tc39/test262/blob/main/test/built-ins/Atomics/waitAsync/bigint/undefined-for-timeout.js#L6">this line</a> should say "Undefined timeout arg coerced to +‚àû", or maybe "Undefined timeout arg should not set timeout"</td></tr>

</tbody></table></div></div></div>
</body></html>
<!DOCTYPE html><html><head>
  <meta charset="UTF-8">
  <title>TC39 General on 2025-09-16</title>
  <link rel="stylesheet" href="../style.css">
  <script>window.room = "TC39 General";</script><script src="../render-roomlist.js"></script>
  <script src="../logs.js"></script>
</head>
<body><div class="wrapper">
<div class="sidebar">
<div class="title">TC39 General<br>2025-09-16<br><a href="plaintext/">plaintext logs</a></div>
<div class="nav">
<a href="2025-09-05" class="nav-link"><span>prev</span></a>
<a href="2025-09-17" class="nav-link"><span style="float:right">next</span></a>
</div>
    <div class="all-rooms"><noscript>JavaScript is required to load the channel index, but you can go to <a href="../..">the static index</a> directly.</noscript></div>
<div class="footer"><a href="https://github.com/bakkot/matrix-archive-bot">source on github</a></div>
</div>
<div class="rhs">
<div class="rhs-header">
<span id="error" style="color: red; display:none">error</span>

<input type="text" id="query" size="25" placeholder="Search TC39 General">
<a id="search-submit" class="button icon-link" title="Search">
  <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"></path></svg>
</a>
</div>

<div class="log"><table id="log-table"><tbody id="log-tbody">

  <tr class="msg" id="L0"><td class="ts-cell"><a class="ts" href="#L0" alt="Tue Sep 16 2025 02:57:13 GMT-0700 (Pacific Daylight Time)">09:57</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@aapo.alasuutari:matrix.org">Aapo Alasuutari</span>&gt;</div></td><td class="msg-cell">In terms of the C++/Rust memory model, SharedArrayBuffer's UNORDERED ordering is just an ordinary read or write, right? (Assuming the platform doesn't need locks to write a value of that size in a single operation.) And not Relaxed.</td></tr>
  <tr class="msg" id="L1"><td class="ts-cell"><a class="ts" href="#L1" alt="Tue Sep 16 2025 02:58:11 GMT-0700 (Pacific Daylight Time)">09:58</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@abotella:igalia.com">Andreu Botella</span>&gt;</div></td><td class="msg-cell">my understanding is that in the C++/Rust memory model, "ordinary" reads and writes to a shared buffer, even if fine by the platform, can lead to compiler optimizations that might still mess things up</td></tr>
  <tr class="msg" id="L2"><td class="ts-cell"><a class="ts" href="#L2" alt="Tue Sep 16 2025 02:58:33 GMT-0700 (Pacific Daylight Time)">09:58</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@abotella:igalia.com">Andreu Botella</span>&gt;</div></td><td class="msg-cell">I think relaxed will do the right thing</td></tr>
  <tr class="msg" id="L3"><td class="ts-cell"><a class="ts" href="#L3" alt="Tue Sep 16 2025 03:01:54 GMT-0700 (Pacific Daylight Time)">10:01</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@abotella:igalia.com">Andreu Botella</span>&gt;</div></td><td class="msg-cell">or in other words, "ordinary" reads and writes to the same memory across threads without any other kind of synchronization, are a data race, with is UB in C++ and Rust</td></tr>
  <tr class="msg" id="L4"><td class="ts-cell"><a class="ts" href="#L4" alt="Tue Sep 16 2025 03:04:09 GMT-0700 (Pacific Daylight Time)">10:04</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@abotella:igalia.com">Andreu Botella</span>&gt;</div></td><td class="msg-cell">relaxed is a stronger constraint than the spec requires</td></tr>
  <tr class="msg" id="L5"><td class="ts-cell"><a class="ts" href="#L5" alt="Tue Sep 16 2025 03:05:17 GMT-0700 (Pacific Daylight Time)">10:05</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@aapo.alasuutari:matrix.org">Aapo Alasuutari</span>&gt;</div></td><td class="msg-cell">Yeah, the spec just kindly asks devs to refrain from writing data races, so Relaxed seems to be the "right but wrong" thing.</td></tr>
  <tr class="msg" id="L6"><td class="ts-cell"><a class="ts" href="#L6" alt="Tue Sep 16 2025 03:05:42 GMT-0700 (Pacific Daylight Time)">10:05</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@aapo.alasuutari:matrix.org">Aapo Alasuutari</span>&gt;</div></td><td class="msg-cell">It's right by C++/Rust standards, but it's wrong by spec standards.</td></tr>
  <tr class="msg" id="L7"><td class="ts-cell"><a class="ts" href="#L7" alt="Tue Sep 16 2025 03:06:33 GMT-0700 (Pacific Daylight Time)">10:06</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@abotella:igalia.com">Andreu Botella</span>&gt;</div></td><td class="msg-cell">I'm pretty sure that the spec only defines minimum constraints, and relaxed is stronger than that minimum constraint, so it's fine</td></tr>
  <tr class="msg" id="L8"><td class="ts-cell"><a class="ts" href="#L8" alt="Tue Sep 16 2025 03:06:43 GMT-0700 (Pacific Daylight Time)">10:06</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@aapo.alasuutari:matrix.org">Aapo Alasuutari</span>&gt;</div></td><td class="msg-cell">But the P word!</td></tr>
  <tr class="msg" id="L9"><td class="ts-cell"><a class="ts" href="#L9" alt="Tue Sep 16 2025 03:06:46 GMT-0700 (Pacific Daylight Time)">10:06</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@abotella:igalia.com">Andreu Botella</span>&gt;</div></td><td class="msg-cell">but it's been a long time since I've looked at this</td></tr>
  <tr class="msg" id="L10"><td class="ts-cell"><a class="ts" href="#L10" alt="Tue Sep 16 2025 03:09:40 GMT-0700 (Pacific Daylight Time)">10:09</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@aapo.alasuutari:matrix.org">Aapo Alasuutari</span>&gt;</div></td><td class="msg-cell"><a href="https://rust-lang.zulipchat.com/#narrow/channel/213817-t-lang/topic/Writing.20a.20WebAssembly.20interpreter.20in.20Rust.20for.20wasm.20threads/with/488916330">https://rust-lang.zulipchat.com/#narrow/channel/213817-t-lang/topic/Writing.20a.20WebAssembly.20interpreter.20in.20Rust.20for.20wasm.20threads/with/488916330</a> for actually the exact same discussion (albeit from Wasm point of view, but it's the same point of view in the end)</td></tr>
  <tr class="msg" id="L11"><td class="ts-cell"><a class="ts" href="#L11" alt="Tue Sep 16 2025 09:51:20 GMT-0700 (Pacific Daylight Time)">16:51</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@michaelficarra:matrix.org">Michael Ficarra</span>&gt;</div></td><td class="msg-cell">probably best to avoid installing any npm packages for a little while: <a href="https://www.reversinglabs.com/blog/shai-hulud-worm-npm">https://www.reversinglabs.com/blog/shai-hulud-worm-npm</a></td></tr>
  <tr class="msg" id="L12"><td class="ts-cell"><a class="ts" href="#L12" alt="Tue Sep 16 2025 10:56:05 GMT-0700 (Pacific Daylight Time)">17:56</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-11" title="@kriskowal:aelf.land">kriskowal</span>&gt;</div></td><td class="msg-cell">The best time to plug the postinstall scripts hole was yesterday, but today will do. Thereâ€™s a tool for limiting postinstall script execution to a list configured by the project and by default denied. <a href="https://www.npmjs.com/package/@lavamoat/allow-scripts">https://www.npmjs.com/package/@lavamoat/allow-scripts</a> And I see that it might not be protecting people using some versions of yarn <a href="https://github.com/LavaMoat/LavaMoat/pull/1218">https://github.com/LavaMoat/LavaMoat/pull/1218</a> Please let me know if you have information we can post to provide guidance on how to use our package managers safely going forward. This would be a good use of the <a href="https://matrix.to/#/#tc39-tg3-security:matrix.org">#tc39-tg3-security:matrix.org</a> channel if folks would meet me there.</td></tr>
  <tr class="msg" id="L13"><td class="ts-cell"><a class="ts" href="#L13" alt="Tue Sep 16 2025 11:03:18 GMT-0700 (Pacific Daylight Time)">18:03</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@michaelficarra:matrix.org">Michael Ficarra</span>&gt;</div></td><td class="msg-cell">nothing has changed in the last decade: <a href="https://blog.npmjs.org/post/141702881055/package-install-scripts-vulnerability">https://blog.npmjs.org/post/141702881055/package-install-scripts-vulnerability</a></td></tr>
  <tr class="msg" id="L14"><td class="ts-cell"><a class="ts" href="#L14" alt="Tue Sep 16 2025 11:11:47 GMT-0700 (Pacific Daylight Time)">18:11</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-14" title="@michaelficarra:matrix.org">Michael Ficarra</span>&gt;</div></td><td class="msg-cell">hopefully enough people with publishing rights for major packages have MFA enabled on publish that it'll slow the spread</td></tr>
  <tr class="msg" id="L15"><td class="ts-cell"><a class="ts" href="#L15" alt="Tue Sep 16 2025 12:15:21 GMT-0700 (Pacific Daylight Time)">19:15</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-2" title="@bakkot:matrix.org">bakkot</span>&gt;</div></td><td class="msg-cell">npm enforces 2FA for people with publish right to popular packages</td></tr>
  <tr class="msg" id="L16"><td class="ts-cell"><a class="ts" href="#L16" alt="Tue Sep 16 2025 13:36:54 GMT-0700 (Pacific Daylight Time)">20:36</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@aapo.alasuutari:matrix.org">Aapo Alasuutari</span>&gt;</div></td><td class="msg-cell">Thinking on this a bit more, I don't think there's a way to implement ECMAScript SharedArrayBuffer related operations without inline assembly in Rust and C++: not only can you race (UB but could be fixed by using bytewise Relaxed operations), you can also do mixed-size atomic operations like CompareAndExchange: that's forbidden by C++ atomics as far as I can gleam but now we absolutely cannot fix this by using bytewise Relaxed operations as it would destroy the atomicity of the operation.

So, it's ... problematic. At least until Rust decides to allow mixed-size atomics which it well might.</td></tr>
  <tr class="msg" id="L17"><td class="ts-cell"><a class="ts" href="#L17" alt="Tue Sep 16 2025 13:45:32 GMT-0700 (Pacific Daylight Time)">20:45</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@abotella:igalia.com">Andreu Botella</span>&gt;</div></td><td class="msg-cell">IIRC such atomic operations are always within an aligned 8-byte chunk</td></tr>
  <tr class="msg" id="L18"><td class="ts-cell"><a class="ts" href="#L18" alt="Tue Sep 16 2025 13:47:13 GMT-0700 (Pacific Daylight Time)">20:47</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@abotella:igalia.com">Andreu Botella</span>&gt;</div></td><td class="msg-cell">I think it's possible to implement the backing store as an <code>[AtomicU64]</code></td></tr>
  <tr class="msg" id="L19"><td class="ts-cell"><a class="ts" href="#L19" alt="Tue Sep 16 2025 13:49:02 GMT-0700 (Pacific Daylight Time)">20:49</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@aapo.alasuutari:matrix.org">Aapo Alasuutari</span>&gt;</div></td><td class="msg-cell">Atomics can be used on any TypedArray backed by a SAB, so not limited to 8 bytes.</td></tr>
  <tr class="msg" id="L20"><td class="ts-cell"><a class="ts" href="#L20" alt="Tue Sep 16 2025 13:50:07 GMT-0700 (Pacific Daylight Time)">20:50</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@abotella:igalia.com">Andreu Botella</span>&gt;</div></td><td class="msg-cell">64 bits = 8 bytes</td></tr>
  <tr class="msg" id="L21"><td class="ts-cell"><a class="ts" href="#L21" alt="Tue Sep 16 2025 13:50:43 GMT-0700 (Pacific Daylight Time)">20:50</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@abotella:igalia.com">Andreu Botella</span>&gt;</div></td><td class="msg-cell">I don't think there's been proposals for a <code>Decimal128TypedArray</code> yet</td></tr>
  <tr class="msg" id="L22"><td class="ts-cell"><a class="ts" href="#L22" alt="Tue Sep 16 2025 13:51:01 GMT-0700 (Pacific Daylight Time)">20:51</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-11" title="@kriskowal:aelf.land">kriskowal</span>&gt;</div></td><td class="msg-cell">There has not, but the possibility has been invoked.</td></tr>
  <tr class="msg" id="L23"><td class="ts-cell"><a class="ts" href="#L23" alt="Tue Sep 16 2025 13:51:58 GMT-0700 (Pacific Daylight Time)">20:51</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@aapo.alasuutari:matrix.org">Aapo Alasuutari</span>&gt;</div></td><td class="msg-cell">Ah sorry, I misunderstood your meaning. I thought you implied that the ECMAScript spec says that all atomic operations are secretly done in 8-byte chunks.</td></tr>
  <tr class="msg" id="L24"><td class="ts-cell"><a class="ts" href="#L24" alt="Tue Sep 16 2025 13:53:10 GMT-0700 (Pacific Daylight Time)">20:53</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@aapo.alasuutari:matrix.org">Aapo Alasuutari</span>&gt;</div></td><td class="msg-cell">But anyway, that leads to a possibly worse problem where all atomic operations less than 8 bytes, and all unordered operations, became CAS loops.</td></tr>
  <tr class="msg" id="L25"><td class="ts-cell"><a class="ts" href="#L25" alt="Tue Sep 16 2025 13:55:06 GMT-0700 (Pacific Daylight Time)">20:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@abotella:igalia.com">Andreu Botella</span>&gt;</div></td><td class="msg-cell">my understanding is that Rust's atomics do use CAS loops on a larger size sometimes</td></tr>
  <tr class="msg" id="L26"><td class="ts-cell"><a class="ts" href="#L26" alt="Tue Sep 16 2025 13:55:18 GMT-0700 (Pacific Daylight Time)">20:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@aapo.alasuutari:matrix.org">Aapo Alasuutari</span>&gt;</div></td><td class="msg-cell">Yes, but this would mean CAS loops on smaller types :)</td></tr>
  <tr class="msg" id="L27"><td class="ts-cell"><a class="ts" href="#L27" alt="Tue Sep 16 2025 13:55:50 GMT-0700 (Pacific Daylight Time)">20:55</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@aapo.alasuutari:matrix.org">Aapo Alasuutari</span>&gt;</div></td><td class="msg-cell">1 byte atomic write would need to CAS-loop on the whole 8 byte replacement to make sure it doesn't mangle the other 7 bytes.</td></tr>
  <tr class="msg" id="L28"><td class="ts-cell"><a class="ts" href="#L28" alt="Tue Sep 16 2025 13:58:32 GMT-0700 (Pacific Daylight Time)">20:58</a></td><td class="nick-cell"><div class="m-ov">&lt;<span class="nick nick-4" title="@aapo.alasuutari:matrix.org">Aapo Alasuutari</span>&gt;</div></td><td class="msg-cell">But I realise I'm actually talking silly things: there is a way to fix the problem of tearing appearing with atomic operations if the backing store is <code>[AtomicU8]</code>, and that is to just use a lock. Of course, ECMAScript spec says that at least 4 byte atomics should be lock free, so that's a little awkward.</td></tr>

</tbody></table></div></div></div>
</body></html>